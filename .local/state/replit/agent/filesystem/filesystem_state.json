{"file_contents":{"Instructions.md":{"content":"# I18n System Analysis and Improvement Plan\n\n## Executive Summary\n\nAfter conducting a comprehensive analysis of the codebase, I've identified several fundamental issues with the current internationalization (i18n) system that cause recurring translation problems when new features are developed. This document outlines the root causes, provides a detailed improvement plan, and offers implementation strategies to create a robust, maintainable translation system.\n\n## Current System Analysis\n\n### Architecture Overview\n- **Implementation**: Custom React hook (`useTranslation`) with Zustand for state management\n- **Storage**: Local persistence using Zustand persist middleware\n- **Languages**: Korean (ko), English (en), Vietnamese (vi)\n- **Translation Storage**: Large monolithic object in `client/src/lib/i18n.ts` (1000+ lines)\n\n### Files Involved in Translation System\n\n#### Core Translation Files\n1. **`client/src/lib/i18n.ts`** - Main translation file (1000+ lines)\n   - Contains `useLanguageStore` (Zustand store)\n   - Contains `translations` object with all translations\n   - Contains `useTranslation` hook\n   - Translation function `t(key: string)`\n\n2. **`client/src/lib/i18n_backup.ts`** - Backup/legacy translation file\n   - Contains older translation structure\n   - May contain inconsistent key patterns\n\n#### Components Using Translations (50+ files)\n- **UI Components**: `client/src/components/ui/right-sidebar.tsx`, `language-switcher.tsx`\n- **POS Components**: `header.tsx`, `product-grid.tsx`, `shopping-cart.tsx`, `category-sidebar.tsx`\n- **Feature Components**: All page components and feature-specific components\n- **Usage Pattern**: Import `useTranslation` → destructure `{ t }` → call `t('key.path')`\n\n## Root Cause Analysis\n\n### 1. Monolithic Translation Structure\n**Problem**: All translations stored in a single massive object\n```typescript\nconst translations = {\n  ko: { /* 500+ lines */ },\n  en: { /* 500+ lines */ },\n  vi: { /* 500+ lines */ }\n}\n```\n**Impact**: \n- Difficult to maintain consistency across languages\n- Easy to miss keys when adding new features\n- Merge conflicts when multiple developers work on translations\n- No compile-time validation of translation keys\n\n### 2. Manual Key Management\n**Problem**: Translation keys are defined as strings with no type safety\n```typescript\nt('nav.pos')           // ✓ exists\nt('nav.nonexistent')   // ✗ runtime error, no compile-time warning\n```\n**Impact**:\n- Typos in translation keys go undetected until runtime\n- Refactoring component names requires manual key updates\n- No IDE autocomplete for translation keys\n\n### 3. Inconsistent Key Patterns\n**Problem**: Different naming conventions across modules\n```typescript\n// Inconsistent patterns found:\nt('nav.pos')                    // nav namespace\nt('settings.title')             // settings namespace  \nt('pos.outOfStock')            // pos namespace\nt('tables.tableManagement')    // tables namespace\n```\n**Impact**:\n- Developers unsure which namespace to use\n- Key collision possibilities\n- Difficult to find and maintain related translations\n\n### 4. No Translation Coverage Validation\n**Problem**: No automated checking for missing translations\n**Current Issues**:\n- Keys exist in Korean but missing in English/Vietnamese\n- New features add keys to one language but forget others\n- No CI/CD validation for translation completeness\n\n### 5. Runtime-Only Error Detection\n**Problem**: Missing translations only discovered at runtime\n```typescript\n// Debug logging only shows in development\nif (!value && import.meta.env.DEV) {\n  console.warn(`Missing translation key: ${key} in language: ${currentLanguage}`);\n}\n```\n**Impact**:\n- Translation issues discovered by end users\n- No prevention of incomplete translations in production\n\n### 6. Lack of Namespace Organization\n**Problem**: Flat key structure makes organization difficult\n```typescript\n// Current: All keys in one level per language\nko: {\n  nav: { pos: '...' },\n  pos: { outOfStock: '...' },\n  tables: { title: '...' }\n  // 100+ more keys...\n}\n```\n**Impact**:\n- Hard to locate related translations\n- Feature-specific translations scattered throughout file\n- Difficult to identify unused translations\n\n## Comprehensive Improvement Plan\n\n### Phase 1: Modular Translation Architecture\n\n#### 1.1 Split Translations into Modules\nCreate separate translation files per feature:\n```\nclient/src/lib/i18n/\n├── index.ts                 # Main export and hook\n├── store.ts                # Zustand store\n├── types.ts                # TypeScript types\n├── modules/\n│   ├── common.ts           # Common translations\n│   ├── navigation.ts       # Navigation translations\n│   ├── pos.ts             # POS system translations\n│   ├── tables.ts          # Table management\n│   ├── inventory.ts       # Inventory management\n│   ├── reports.ts         # Reports and analytics\n│   ├── employees.ts       # Employee management\n│   ├── attendance.ts      # Attendance tracking\n│   ├── suppliers.ts       # Supplier management\n│   └── settings.ts        # Settings and configuration\n└── utils/\n    ├── validation.ts       # Translation validation utilities\n    └── merger.ts          # Translation object merger\n```\n\n#### 1.2 TypeScript Type Safety\nDefine strict types for all translation keys:\n```typescript\n// types.ts\ninterface NavigationTranslations {\n  pos: string;\n  tables: string;\n  inventory: string;\n  reports: string;\n  employees: string;\n  attendance: string;\n  settings: string;\n}\n\ninterface CommonTranslations {\n  loading: string;\n  save: string;\n  cancel: string;\n  delete: string;\n  // ... etc\n}\n\ninterface Translations {\n  nav: NavigationTranslations;\n  common: CommonTranslations;\n  pos: POSTranslations;\n  // ... etc\n}\n\ntype TranslationKey = \n  | `nav.${keyof NavigationTranslations}`\n  | `common.${keyof CommonTranslations}`\n  | `pos.${keyof POSTranslations}`;\n```\n\n#### 1.3 Enhanced Hook with Type Safety\n```typescript\n// index.ts\nfunction useTranslation() {\n  const { currentLanguage } = useLanguageStore();\n  \n  const t = <K extends TranslationKey>(key: K): string => {\n    // Type-safe translation with autocomplete\n    const result = getNestedTranslation(translations[currentLanguage], key);\n    return result || key;\n  };\n  \n  return { t, currentLanguage };\n}\n```\n\n### Phase 2: Translation Validation System\n\n#### 2.1 Compile-Time Validation\nCreate a validation system that runs during build:\n```typescript\n// utils/validation.ts\nexport function validateTranslations() {\n  const languages = ['ko', 'en', 'vi'];\n  const errors: string[] = [];\n  \n  // Check all languages have same keys\n  const baseKeys = getAllKeys(translations.ko);\n  \n  languages.forEach(lang => {\n    const langKeys = getAllKeys(translations[lang]);\n    const missing = baseKeys.filter(key => !langKeys.includes(key));\n    const extra = langKeys.filter(key => !baseKeys.includes(key));\n    \n    if (missing.length > 0) {\n      errors.push(`${lang}: Missing keys: ${missing.join(', ')}`);\n    }\n    if (extra.length > 0) {\n      errors.push(`${lang}: Extra keys: ${extra.join(', ')}`);\n    }\n  });\n  \n  return errors;\n}\n```\n\n#### 2.2 Development-Time Checker\nAdd a development utility to continuously check translations:\n```typescript\n// utils/dev-checker.ts\nexport function setupTranslationChecker() {\n  if (import.meta.env.DEV) {\n    const errors = validateTranslations();\n    if (errors.length > 0) {\n      console.group('🌐 Translation Issues Detected');\n      errors.forEach(error => console.error(error));\n      console.groupEnd();\n    }\n  }\n}\n```\n\n#### 2.3 CLI Validation Tool\nCreate a Node.js script for CI/CD validation:\n```bash\n# package.json\n{\n  \"scripts\": {\n    \"i18n:validate\": \"tsx scripts/validate-translations.ts\",\n    \"i18n:missing\": \"tsx scripts/find-missing-keys.ts\",\n    \"i18n:unused\": \"tsx scripts/find-unused-keys.ts\"\n  }\n}\n```\n\n### Phase 3: Automated Key Management\n\n#### 3.1 Translation Key Extraction\nCreate a tool to automatically extract translation keys from components:\n```typescript\n// scripts/extract-keys.ts\nexport function extractTranslationKeys() {\n  // Scan all .tsx/.ts files for t('...') patterns\n  // Generate TypeScript interfaces automatically\n  // Update translation files with missing keys\n}\n```\n\n#### 3.2 Key Usage Tracking\nTrack which translation keys are actually used:\n```typescript\n// utils/usage-tracker.ts\nexport function trackKeyUsage(key: string) {\n  if (import.meta.env.DEV) {\n    usedKeys.add(key);\n  }\n}\n```\n\n### Phase 4: Enhanced Developer Experience\n\n#### 4.1 IDE Integration\n- **VSCode Extension**: Create autocomplete for translation keys\n- **Snippet Generator**: Quick snippets for common translation patterns\n- **Key Validator**: Real-time validation in IDE\n\n#### 4.2 Translation Management UI\nCreate a development-only UI for managing translations:\n```typescript\n// components/dev/TranslationManager.tsx (dev only)\nexport function TranslationManager() {\n  // UI for adding/editing/removing translations\n  // Real-time preview of changes\n  // Export/import functionality\n}\n```\n\n#### 4.3 Hot Reloading for Translations\nEnable hot reloading of translation changes:\n```typescript\n// utils/hot-reload.ts\nif (import.meta.env.DEV) {\n  // Watch translation files for changes\n  // Reload translations without page refresh\n}\n```\n\n### Phase 5: Standardization and Guidelines\n\n#### 5.1 Key Naming Convention\nEstablish consistent naming patterns:\n```typescript\n// Standard format: module.section.element\n'nav.primary.pos'           // Navigation > Primary Menu > POS\n'pos.cart.empty'           // POS > Cart > Empty State\n'tables.actions.cleanup'   // Tables > Actions > Cleanup\n'forms.validation.required' // Forms > Validation > Required Field\n```\n\n#### 5.2 Translation Guidelines\nCreate documentation for:\n- Key naming conventions\n- Translation style guide per language\n- Context information for translators\n- Pluralization handling\n- Dynamic content patterns\n\n#### 5.3 Review Process\nImplement translation review workflow:\n- All new translations require review\n- Language-specific reviewers\n- Automated checks in CI/CD\n- Translation freeze periods before releases\n\n## Implementation Strategy\n\n### Week 1: Foundation Setup\n1. Create modular file structure\n2. Split existing translations into modules\n3. Set up TypeScript types\n4. Implement basic validation\n\n### Week 2: Type Safety\n1. Add compile-time type checking\n2. Update all components to use typed keys\n3. Create migration guide for existing code\n4. Test with existing features\n\n### Week 3: Validation & Automation\n1. Implement validation scripts\n2. Add CI/CD integration\n3. Create development tools\n4. Set up hot reloading\n\n### Week 4: Documentation & Guidelines\n1. Create developer documentation\n2. Establish coding standards\n3. Train team on new system\n4. Create maintenance procedures\n\n## Benefits of Proposed Solution\n\n### For Developers\n- **Type Safety**: Autocomplete and compile-time validation\n- **Better DX**: Clear structure, easy to find translations\n- **Fewer Bugs**: Catch missing translations before deployment\n- **Faster Development**: Automated key management\n\n### For Maintainers\n- **Consistency**: Standardized key naming and structure\n- **Visibility**: Clear tracking of translation coverage\n- **Automation**: Reduced manual maintenance overhead\n- **Quality**: Built-in validation and review processes\n\n### For End Users\n- **Reliability**: No missing translations in production\n- **Completeness**: All features available in all languages\n- **Consistency**: Uniform translation quality across app\n- **Performance**: Optimized loading of translation data\n\n## Migration Plan\n\n### Step 1: Parallel Implementation\n- Keep existing system running\n- Implement new system alongside\n- Gradually migrate components one module at a time\n\n### Step 2: Component Migration\n```typescript\n// Before\nconst { t } = useTranslation();\nt('nav.pos'); // String-based, no validation\n\n// After  \nconst { t } = useTranslation();\nt('nav.primary.pos'); // Type-safe, autocomplete\n```\n\n### Step 3: Validation Integration\n- Add validation to CI/CD pipeline\n- Block deployments with translation issues\n- Generate reports for translation coverage\n\n### Step 4: Legacy Cleanup\n- Remove old translation files\n- Update all remaining components\n- Clean up unused translation keys\n\n## Success Metrics\n\n### Technical Metrics\n- **Translation Coverage**: 100% key coverage across all languages\n- **Type Safety**: 0 runtime translation errors\n- **Build Validation**: 0 translation issues in CI/CD\n- **Development Speed**: 50% faster addition of new translations\n\n### Quality Metrics\n- **Consistency**: Standardized key naming across all modules\n- **Maintainability**: Clear separation of concerns\n- **Documentation**: Complete documentation for all processes\n- **Team Adoption**: 100% team adoption of new standards\n\n## Conclusion\n\nThe current i18n system suffers from structural issues that make it difficult to maintain consistency and prevent errors when adding new features. The proposed modular, type-safe approach will solve these fundamental problems and provide a robust foundation for multilingual development.\n\nThe key improvements include:\n1. **Modular Architecture**: Separate files per feature for better organization\n2. **Type Safety**: Compile-time validation and IDE autocomplete\n3. **Automated Validation**: Continuous checking for translation completeness\n4. **Better Developer Experience**: Tools and processes that prevent common mistakes\n5. **Standardization**: Clear guidelines and consistent patterns\n\nThis plan will eliminate the recurring translation issues and create a sustainable system that scales with the application's growth.","size_bytes":13734},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"membership-test-report.md":{"content":"# 멤버십 관리 기능 점검 보고서\n\n## 현재 상태 분석\n\n### 📊 고객 멤버십 분포\n- **VIP**: 4명 (40%)\n- **GOLD**: 3명 (30%) \n- **SILVER**: 3명 (30%)\n\n### 🔧 수정된 문제들\n1. **SelectItem 에러 수정**: empty string 값을 'all'로 변경하여 Select 컴포넌트 에러 해결\n2. **필터링 로직 개선**: 'all' 옵션 추가로 전체 고객 조회 가능\n3. **TypeScript 에러 수정**: null 체크 추가하여 타입 안전성 확보\n\n### ✅ 작동하는 기능들\n- 멤버십 등급별 통계 표시\n- 고객 검색 및 필터링\n- 개별 고객 등급 수정\n- 자동 등급 승급 기능 (구매금액 기준)\n- 등급별 혜택 안내\n\n### 🎯 멤버십 등급 기준\n- **SILVER**: 기본 등급 (₩0 이상)\n- **GOLD**: ₩300,000 이상 구매\n- **VIP**: ₩1,000,000 이상 구매\n\n## 기능 테스트 결과\n\n### 1. 데이터베이스 상태 ✅\n- 10명의 고객 데이터가 올바르게 VIP/GOLD/SILVER로 변환됨\n- 멤버십 분포가 균등하게 설정됨\n\n### 2. UI 컴포넌트 ✅\n- 멤버십 관리 모달이 정상 작동\n- 등급별 색상 구분 (VIP: 보라색, GOLD: 노란색, SILVER: 회색)\n- 한글 라벨 표시 정상\n\n### 3. 자동 승급 로직 ✅\n- 구매금액 기준 자동 등급 계산\n- 승급 가능 고객 표시\n- 일괄 자동 승급 기능\n\n## 추천 개선사항\n\n### 1. 혜택 시스템 구현\n- 포인트 적립률 차등 적용\n- 할인율 자동 계산\n- 생일 혜택 알림\n\n### 2. 멤버십 히스토리 추적\n- 등급 변경 이력 저장\n- 승급/강등 사유 기록\n\n### 3. 보고서 기능\n- 멤버십별 매출 분석\n- 고객 충성도 지표","size_bytes":1649},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"replit.md":{"content":"# EDPOS System\n\n## Overview\n\nThis is a comprehensive restaurant management system (EDPOS) built for table-based dining operations. The application features a full-stack TypeScript architecture with a React frontend and Express backend, using PostgreSQL for data persistence and Drizzle ORM for database operations. The system focuses on table management, order processing, employee management, and attendance tracking specifically designed for restaurant operations.\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n- **Framework**: React 18 with TypeScript\n- **Routing**: Wouter for lightweight client-side routing\n- **State Management**: React Query (TanStack Query) for server state management\n- **UI Framework**: Radix UI components with shadcn/ui styling system\n- **Styling**: Tailwind CSS with custom CSS variables for theming\n- **Build Tool**: Vite for fast development and optimized builds\n\n### Backend Architecture\n- **Runtime**: Node.js with Express.js framework\n- **Language**: TypeScript with ES modules\n- **Database ORM**: Drizzle ORM for type-safe database operations\n- **Database**: PostgreSQL with persistent data storage\n- **Session Management**: PostgreSQL-based session storage\n- **Data Storage**: Migrated from in-memory to PostgreSQL database\n\n### Development Environment\n- **Monorepo Structure**: Shared schema and types between frontend and backend\n- **Hot Reload**: Vite dev server with HMR for frontend development\n- **Development Server**: tsx for TypeScript execution in development\n\n## Key Components\n\n### Database Schema (shared/schema.ts)\n- **Categories**: Product categorization with icons for menu organization\n- **Products**: Menu items with SKU, pricing, stock tracking and descriptions\n- **Tables**: Restaurant table management with capacity, status, and QR codes\n- **Orders**: Table-based order system with customer info, status workflow, and payment tracking\n- **Order Items**: Individual menu items within each order with quantities and special requests\n- **Transactions**: Legacy POS sales records (maintained for compatibility)\n- **Transaction Items**: Legacy line items (maintained for compatibility)\n- **Employees**: Staff information with roles and contact details\n- **Attendance Records**: Employee clock-in/out, break times, and overtime tracking\n\n### Frontend Components\n- **Table Grid**: Visual table layout showing real-time status and occupancy\n- **Order Dialog**: Complete ordering interface with menu selection and cart management\n- **Order Management**: Kitchen and service staff order tracking with status updates\n- **Table Management**: Administrative interface for adding/editing tables\n- **POS Interface**: Legacy point-of-sale interface (maintained for compatibility)\n- **Product Management**: Menu item administration with categories and pricing\n- **Receipt System**: Print-ready receipt generation\n- **Employee Management**: CRUD operations for staff management with role-based access\n- **Attendance Management**: Time tracking with clock-in/out, break management, and statistics\n\n### Backend Services\n- **Storage Layer**: Abstract storage interface with PostgreSQL database implementation\n- **API Routes**: RESTful endpoints for tables, orders, products, categories, employees, and attendance\n- **Order Workflow**: Automated status transitions and table management\n- **Data Validation**: Zod schemas for request/response validation with restaurant-specific rules\n- **Database Relations**: Proper foreign key relationships between tables, orders, products, and employees\n- **Time Tracking**: Automated calculation of work hours, overtime, and break time\n- **Table Status Management**: Real-time table availability and reservation system\n\n## Data Flow\n\n1. **Table Selection**: Staff selects available table from visual grid interface\n2. **Order Creation**: Menu items added to cart with special requests and customer information\n3. **Order Processing**: Order submitted with automatic table status update to \"occupied\"\n4. **Kitchen Workflow**: Orders progress through status stages (pending → confirmed → preparing → ready → served)\n5. **Payment Processing**: Orders marked as paid with automatic table status reset to \"available\"\n6. **Inventory Updates**: Stock levels automatically updated on successful orders\n7. **Employee Tracking**: Staff clock-in/out with automatic work hour calculations\n\n## External Dependencies\n\n### Core Dependencies\n- **@neondatabase/serverless**: PostgreSQL database connection for Neon\n- **drizzle-orm**: Type-safe database operations\n- **@tanstack/react-query**: Server state management and caching\n- **wouter**: Lightweight routing solution\n- **date-fns**: Date manipulation utilities\n\n### UI Dependencies\n- **@radix-ui/***: Accessible component primitives\n- **tailwindcss**: Utility-first CSS framework\n- **class-variance-authority**: Type-safe variant API for components\n- **lucide-react**: Icon library\n\n### Development Tools\n- **vite**: Build tool and dev server\n- **tsx**: TypeScript execution for development\n- **drizzle-kit**: Database migration and introspection tools\n\n## Deployment Strategy\n\n### Build Process\n1. **Frontend Build**: Vite builds React app to `dist/public`\n2. **Backend Build**: esbuild bundles server code to `dist/index.js`\n3. **Database Setup**: Drizzle migrations applied to PostgreSQL instance\n\n### Environment Configuration\n- **DATABASE_URL**: PostgreSQL connection string (required)\n- **NODE_ENV**: Environment mode (development/production)\n- **REPL_ID**: Replit-specific environment detection\n\n### Production Deployment\n- Built application served as static files with Express\n- Database migrations run via `drizzle-kit push`\n- Session storage uses PostgreSQL with connect-pg-simple\n\n### Development Features\n- **Replit Integration**: Cartographer plugin for enhanced development experience\n- **Error Overlay**: Runtime error modal for development debugging\n- **Hot Module Replacement**: Instant updates during development\n\n## Recent Changes\n\n### January 24, 2025 - Product Management System Implementation\n- **Complete Product Management System**: Replaced customer management section with comprehensive product and category management functionality\n- **Category Management**: Added full CRUD operations for product categories with icon selection and visual category cards\n- **Product Management**: Implemented complete product management with category filtering, stock tracking, and detailed product forms\n- **Translation Integration**: Added comprehensive Korean/English/Vietnamese translations for all product management features\n- **Statistics Dashboard**: Added real-time statistics cards showing total categories, products, and stock levels\n- **Interactive Forms**: Created modal dialogs for adding/editing categories and products with validation\n- **Search and Filtering**: Implemented product search by name/SKU and category-based filtering functionality\n- **Stock Status Display**: Added visual stock status indicators (재고있음/품절) with color-coded badges\n- **API Integration**: Connected all forms to existing backend API endpoints for categories and products\n\n### January 24, 2025 - Complete Translation Key Resolution\n- **Resolved All Translation Key Issues**: Systematically identified and added all missing translation keys across the entire application\n- **Enhanced Tables Module**: Added comprehensive table management translations including 'outOfService', 'people', 'customerName', 'optional', 'customerNamePlaceholder', 'customerCount', 'allCategories', 'stockCount', 'orderHistory', 'itemsSelected', 'noItemsSelected'\n- **Improved Inventory Module**: Added missing inventory translations for all languages including 'searchProducts', 'stockStatus', 'allStock', 'productName', 'currentStock', 'unitPrice', 'stockValue', 'management', 'edit', 'stockUpdate'\n- **Enhanced Common Module**: Added 'category' key to all language common sections for consistent categorization across modules\n- **Fixed Settings Navigation**: Resolved routing issue by ensuring /settings route exists in App.tsx and all navigation links work properly\n- **Added NotFound Keys**: Completed notFound module with 'backToHome' and 'backToHome' keys for all supported languages\n- **Translation System Optimization**: Improved translation function with proper environment detection and removed debug logging for production\n\n### January 23, 2025 - Comprehensive Translation System Enhancement and Current Cashier Display\n- **Resolved Translation Coverage Issues**: Added comprehensive translation keys across all modules to prevent recurring language application problems\n- **Enhanced POS System**: Implemented current working cashier display functionality in POS header that shows active cashier name or fallback text when no cashier is clocked in\n- **Navigation Translation**: Added complete navigation menu translations for all supported languages (Korean, English, Vietnamese)\n- **POS Module Expansion**: Extended POS translations to include stock status, categories, cart management, and receipt functionality\n- **Attendance System Enhancement**: Added comprehensive attendance management translations including statistics, work hours tracking, and employee status\n- **Settings and Suppliers**: Complete translation coverage for system settings and supplier management modules\n- **Real-time Data Integration**: Successfully integrated attendance data with POS header to display current working cashier information\n- **Application Stability**: Fixed critical errors preventing app startup due to broken i18n imports and missing translation keys\n\n### January 23, 2025 - Language System Fix and Comprehensive Translation Implementation  \n- **Fixed Critical i18n System**: Resolved broken internationalization file that contained plain text instead of TypeScript code\n- **Comprehensive Translation System**: Implemented complete multilingual support for Korean, English, and Vietnamese\n- **Missing Translation Keys**: Added all missing translation keys including 'tables.cleanupComplete' and other component-specific translations\n- **Hot Module Replacement**: Ensured seamless language switching with automatic component updates\n\n### January 21, 2025 - Logo Update and System Improvements\n- **Updated EDPOS Logo**: Replaced application logo with new EDPOS branding (EDPOS_1753091767028.png) across header and receipt components\n- **Hardcoded Text Elimination**: Completed removal of hardcoded text including cashier names, replaced with proper multi-language support\n- **Translation System Enhancement**: Added comprehensive POS translations across Korean, English, and Vietnamese languages\n- **Navigation System Fix**: Resolved table management navigation issues with proper sidebar and header menu integration\n- **Duplicate Key Cleanup**: Eliminated duplicate translation keys causing syntax errors in i18n system\n- **Multi-language Cashier Names**: Added default cashier names for each language (김담당자, John Smith, Nguyễn Thu Ngân)\n- **Added Inventory Management**: Complete inventory management system with stock tracking, low stock alerts, and stock value calculations\n- **Stock Update Functionality**: Added ability to add, subtract, or set stock levels with notes for audit trail\n- **Inventory Dashboard**: Created comprehensive inventory dashboard with real-time statistics and filtering options\n- **API Integration**: Built RESTful API endpoints for inventory operations and stock updates\n- **Navigation Updates**: Added inventory management to both left sidebar and top navigation menu\n\n### January 20, 2025 - UI Theme Transformation\n- **Transformed UI to Modern Green Theme**: Changed from blue theme to green grocery shop style inspired by provided design\n- **Updated Color Scheme**: Changed primary colors from blue to green throughout the application (#10b981)\n- **Enhanced Visual Design**: Added rounded corners (rounded-xl, rounded-2xl), subtle background patterns, and modern shadows\n- **Improved Product Cards**: Updated product grid with modern, rounded card design and green pricing display\n- **Updated Navigation**: Modified header dropdown, sidebar, and category selection to use green accent colors\n- **Added Background Pattern**: Implemented subtle green circular pattern background across all pages for cohesive design\n- **Logo Enhancement**: Increased logo size from h-8 to h-12 for better visibility\n- **Sidebar Migration**: Moved navigation sidebar from right to left side with updated styling\n\nThe architecture supports both development flexibility and production scalability, with clear separation between frontend and backend concerns while maintaining type safety across the entire stack.","size_bytes":12739},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"var(--background)\",\n        foreground: \"var(--foreground)\",\n        card: {\n          DEFAULT: \"var(--card)\",\n          foreground: \"var(--card-foreground)\",\n        },\n        popover: {\n          DEFAULT: \"var(--popover)\",\n          foreground: \"var(--popover-foreground)\",\n        },\n        primary: {\n          DEFAULT: \"var(--primary)\",\n          foreground: \"var(--primary-foreground)\",\n        },\n        secondary: {\n          DEFAULT: \"var(--secondary)\",\n          foreground: \"var(--secondary-foreground)\",\n        },\n        muted: {\n          DEFAULT: \"var(--muted)\",\n          foreground: \"var(--muted-foreground)\",\n        },\n        accent: {\n          DEFAULT: \"var(--accent)\",\n          foreground: \"var(--accent-foreground)\",\n        },\n        destructive: {\n          DEFAULT: \"var(--destructive)\",\n          foreground: \"var(--destructive-foreground)\",\n        },\n        border: \"var(--border)\",\n        input: \"var(--input)\",\n        ring: \"var(--ring)\",\n        chart: {\n          \"1\": \"var(--chart-1)\",\n          \"2\": \"var(--chart-2)\",\n          \"3\": \"var(--chart-3)\",\n          \"4\": \"var(--chart-4)\",\n          \"5\": \"var(--chart-5)\",\n        },\n        sidebar: {\n          DEFAULT: \"var(--sidebar-background)\",\n          foreground: \"var(--sidebar-foreground)\",\n          primary: \"var(--sidebar-primary)\",\n          \"primary-foreground\": \"var(--sidebar-primary-foreground)\",\n          accent: \"var(--sidebar-accent)\",\n          \"accent-foreground\": \"var(--sidebar-accent-foreground)\",\n          border: \"var(--sidebar-border)\",\n          ring: \"var(--sidebar-ring)\",\n        },\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":2627},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n    host: \"0.0.0.0\",\n    port: 5173,\n    hmr: process.env.NODE_ENV === \"development\" ? {\n      port: 5173,\n      host: \"0.0.0.0\",\n      clientPort: 443,\n    } : false,\n    proxy: {\n      \"/api\": {\n        target: \"http://localhost:5000\",\n        changeOrigin: true,\n      },\n    },\n  },\n});","size_bytes":1252},"attached_assets/content-1754368580753.md":{"content":"[Skip to content](https://github.com/browserslist/update-db#start-of-content)\n\n[browserslist](https://github.com/browserslist)/ **[update-db](https://github.com/browserslist/update-db)** Public\n\n- Sponsor\n\n\n\n\n\n\n\n# Sponsor browserslist/update-db\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n##### GitHub Sponsors\n\n[Learn more about Sponsors](https://github.com/sponsors)\n\n\n\n\n\n\n\n[![@ai](https://avatars.githubusercontent.com/u/19343?s=80&v=4)](https://github.com/ai)\n\n\n\n[ai](https://github.com/ai)\n\n\n\n[ai](https://github.com/ai)\n\n\n\n[Sponsor](https://github.com/sponsors/ai)\n\n\n\n\n\n\n\n\n\n##### External links\n\n\n\n\n\n![open_collective](https://github.githubassets.com/assets/open_collective-0a706523753d.svg)\n\n\n\n[opencollective.com/ **browserslist**](https://opencollective.com/browserslist)\n\n\n\n\n\n\n\n![tidelift](https://github.githubassets.com/assets/tidelift-8cea37dea8fc.svg)\n\n\n\n[tidelift.com/funding/github/ **npm/browserslist**](https://tidelift.com/funding/github/npm/browserslist)\n\n\n\n\n\n\n\n\n\n[Learn more about funding links in repositories](https://docs.github.com/repositories/managing-your-repositorys-settings-and-features/customizing-your-repository/displaying-a-sponsor-button-in-your-repository).\n\n\n\n\n[Report abuse](https://github.com/contact/report-abuse?report=browserslist%2Fupdate-db+%28Repository+Funding+Links%29)\n\n- [Notifications](https://github.com/login?return_to=%2Fbrowserslist%2Fupdate-db) You must be signed in to change notification settings\n- [Fork\\\\\n146](https://github.com/login?return_to=%2Fbrowserslist%2Fupdate-db)\n- [Star\\\\\n572](https://github.com/login?return_to=%2Fbrowserslist%2Fupdate-db)\n\n\nCLI tool to update caniuse-lite to refresh target browsers from Browserslist config\n\n\n[browsersl.ist/](https://browsersl.ist/ \"https://browsersl.ist/\")\n\n### License\n\n[MIT license](https://github.com/browserslist/update-db/blob/main/LICENSE)\n\n[572\\\\\nstars](https://github.com/browserslist/update-db/stargazers) [146\\\\\nforks](https://github.com/browserslist/update-db/forks) [Branches](https://github.com/browserslist/update-db/branches) [Tags](https://github.com/browserslist/update-db/tags) [Activity](https://github.com/browserslist/update-db/activity)\n\n[Star](https://github.com/login?return_to=%2Fbrowserslist%2Fupdate-db)\n\n[Notifications](https://github.com/login?return_to=%2Fbrowserslist%2Fupdate-db) You must be signed in to change notification settings\n\n# browserslist/update-db\n\nmain\n\n[**1** Branch](https://github.com/browserslist/update-db/branches) [**21** Tags](https://github.com/browserslist/update-db/tags)\n\n[Go to Branches page](https://github.com/browserslist/update-db/branches)[Go to Tags page](https://github.com/browserslist/update-db/tags)\n\nGo to file\n\nCode\n\nOpen more actions menu\n\n## Folders and files\n\n| Name | Name | Last commit message | Last commit date |\n| --- | --- | --- | --- |\n| ## Latest commit<br>## History<br>[146 Commits](https://github.com/browserslist/update-db/commits/main/)<br>[View commit history for this file.](https://github.com/browserslist/update-db/commits/main/) |\n| [.github](https://github.com/browserslist/update-db/tree/main/.github \".github\") | [.github](https://github.com/browserslist/update-db/tree/main/.github \".github\") |  |  |\n| [test](https://github.com/browserslist/update-db/tree/main/test \"test\") | [test](https://github.com/browserslist/update-db/tree/main/test \"test\") |  |  |\n| [.editorconfig](https://github.com/browserslist/update-db/blob/main/.editorconfig \".editorconfig\") | [.editorconfig](https://github.com/browserslist/update-db/blob/main/.editorconfig \".editorconfig\") |  |  |\n| [.gitignore](https://github.com/browserslist/update-db/blob/main/.gitignore \".gitignore\") | [.gitignore](https://github.com/browserslist/update-db/blob/main/.gitignore \".gitignore\") |  |  |\n| [.npmignore](https://github.com/browserslist/update-db/blob/main/.npmignore \".npmignore\") | [.npmignore](https://github.com/browserslist/update-db/blob/main/.npmignore \".npmignore\") |  |  |\n| [CHANGELOG.md](https://github.com/browserslist/update-db/blob/main/CHANGELOG.md \"CHANGELOG.md\") | [CHANGELOG.md](https://github.com/browserslist/update-db/blob/main/CHANGELOG.md \"CHANGELOG.md\") |  |  |\n| [LICENSE](https://github.com/browserslist/update-db/blob/main/LICENSE \"LICENSE\") | [LICENSE](https://github.com/browserslist/update-db/blob/main/LICENSE \"LICENSE\") |  |  |\n| [README.md](https://github.com/browserslist/update-db/blob/main/README.md \"README.md\") | [README.md](https://github.com/browserslist/update-db/blob/main/README.md \"README.md\") |  |  |\n| [check-npm-version.js](https://github.com/browserslist/update-db/blob/main/check-npm-version.js \"check-npm-version.js\") | [check-npm-version.js](https://github.com/browserslist/update-db/blob/main/check-npm-version.js \"check-npm-version.js\") |  |  |\n| [cli.js](https://github.com/browserslist/update-db/blob/main/cli.js \"cli.js\") | [cli.js](https://github.com/browserslist/update-db/blob/main/cli.js \"cli.js\") |  |  |\n| [eslint.config.mjs](https://github.com/browserslist/update-db/blob/main/eslint.config.mjs \"eslint.config.mjs\") | [eslint.config.mjs](https://github.com/browserslist/update-db/blob/main/eslint.config.mjs \"eslint.config.mjs\") |  |  |\n| [index.d.ts](https://github.com/browserslist/update-db/blob/main/index.d.ts \"index.d.ts\") | [index.d.ts](https://github.com/browserslist/update-db/blob/main/index.d.ts \"index.d.ts\") |  |  |\n| [index.js](https://github.com/browserslist/update-db/blob/main/index.js \"index.js\") | [index.js](https://github.com/browserslist/update-db/blob/main/index.js \"index.js\") |  |  |\n| [package.json](https://github.com/browserslist/update-db/blob/main/package.json \"package.json\") | [package.json](https://github.com/browserslist/update-db/blob/main/package.json \"package.json\") |  |  |\n| [pnpm-lock.yaml](https://github.com/browserslist/update-db/blob/main/pnpm-lock.yaml \"pnpm-lock.yaml\") | [pnpm-lock.yaml](https://github.com/browserslist/update-db/blob/main/pnpm-lock.yaml \"pnpm-lock.yaml\") |  |  |\n| [utils.js](https://github.com/browserslist/update-db/blob/main/utils.js \"utils.js\") | [utils.js](https://github.com/browserslist/update-db/blob/main/utils.js \"utils.js\") |  |  |\n| View all files |\n\n## Repository files navigation\n\n# Update Browserslist DB\n\n[Permalink: Update Browserslist DB](https://github.com/browserslist/update-db#update-browserslist-db)\n\n[![Browserslist logo by Anton Popov](https://camo.githubusercontent.com/36bab6b3ba286ba7bc47bd885abb49c967b57b425d1d41892b62f59b0c8d883d/68747470733a2f2f62726f77736572736c2e6973742f6c6f676f2e737667)](https://camo.githubusercontent.com/36bab6b3ba286ba7bc47bd885abb49c967b57b425d1d41892b62f59b0c8d883d/68747470733a2f2f62726f77736572736c2e6973742f6c6f676f2e737667)\n\nCLI tool to update `caniuse-lite` with browsers DB\nfrom [Browserslist](https://github.com/browserslist/browserslist/) config.\n\nSome queries like `last 2 versions` or `>1%` depend on actual data\nfrom `caniuse-lite`.\n\n```\nnpx update-browserslist-db@latest\n```\n\n[![Sponsored by Evil Martians](https://camo.githubusercontent.com/ab9c8688d73ee3de195179eab570775ab316510e7f0ed228c310c97e0eee864a/68747470733a2f2f6576696c6d61727469616e732e636f6d2f6261646765732f73706f6e736f7265642d62792d6576696c2d6d61727469616e732e737667)](https://evilmartians.com/?utm_source=update-browserslist-db)\n\n## Why you need to call it regularly\n\n[Permalink: Why you need to call it regularly](https://github.com/browserslist/update-db#why-you-need-to-call-it-regularly)\n\n`npx update-browserslist-db@latest` updates `caniuse-lite` version\nin your npm, yarn, or pnpm lock file.\n\nThis update will bring data about new browsers to polyfill tools\nlike Autoprefixer or Babel and reduce already unnecessary polyfills.\n\nYou need to do it regularly for three reasons:\n\n1. To use the latest browser’s versions and statistics in queries like\n`last 2 versions` or `>1%`. For example, if you created your project\n2 years ago and did not update your dependencies, `last 1 version`\nwill return 2-year-old browsers.\n2. Actual browser data will lead to using less polyfills. It will reduce\nsize of JS and CSS files and improve website performance.\n3. `caniuse-lite` deduplication: to synchronize versions in different tools.\n\n## About\n\nCLI tool to update caniuse-lite to refresh target browsers from Browserslist config\n\n\n[browsersl.ist/](https://browsersl.ist/ \"https://browsersl.ist/\")\n\n### Resources\n\n[Readme](https://github.com/browserslist/update-db#readme-ov-file)\n\n### License\n\n[MIT license](https://github.com/browserslist/update-db#MIT-1-ov-file)\n\n[Activity](https://github.com/browserslist/update-db/activity)\n\n[Custom properties](https://github.com/browserslist/update-db/custom-properties)\n\n### Stars\n\n[**572**\\\\\nstars](https://github.com/browserslist/update-db/stargazers)\n\n### Watchers\n\n[**8**\\\\\nwatching](https://github.com/browserslist/update-db/watchers)\n\n### Forks\n\n[**146**\\\\\nforks](https://github.com/browserslist/update-db/forks)\n\n[Report repository](https://github.com/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fbrowserslist%2Fupdate-db&report=browserslist+%28user%29)\n\n## [Releases\\  7](https://github.com/browserslist/update-db/releases)\n\n[1.1.3\\\\\nLatest\\\\\n\\\\\nFeb 26, 2025](https://github.com/browserslist/update-db/releases/tag/1.1.3)\n\n[\\+ 6 releases](https://github.com/browserslist/update-db/releases)\n\n## Sponsor this project\n\n- [![@ai](https://avatars.githubusercontent.com/u/19343?s=64&v=4)](https://github.com/ai)[**ai** Andrey Sitnik](https://github.com/ai)[Sponsor @ai](https://github.com/sponsors/ai)\n\n- ![open_collective](https://github.githubassets.com/assets/open_collective-0a706523753d.svg)[opencollective.com/ **browserslist**](https://opencollective.com/browserslist)\n- ![tidelift](https://github.githubassets.com/assets/tidelift-8cea37dea8fc.svg)[tidelift.com/funding/github/ **npm/browserslist**](https://tidelift.com/funding/github/npm/browserslist)\n\n[Learn more about GitHub Sponsors](https://github.com/sponsors)\n\n## [Contributors\\  8](https://github.com/browserslist/update-db/graphs/contributors)\n\n- [![@ai](https://avatars.githubusercontent.com/u/19343?s=64&v=4)](https://github.com/ai)\n- [![@kytta](https://avatars.githubusercontent.com/u/6566248?s=64&v=4)](https://github.com/kytta)\n- [![@Maxim-Mazurok](https://avatars.githubusercontent.com/u/7756211?s=64&v=4)](https://github.com/Maxim-Mazurok)\n- [![@mralaminahamed](https://avatars.githubusercontent.com/u/34349365?s=64&v=4)](https://github.com/mralaminahamed)\n- [![@Hyzual](https://avatars.githubusercontent.com/u/2051507?s=64&v=4)](https://github.com/Hyzual)\n- [![@romanlex](https://avatars.githubusercontent.com/u/3369304?s=64&v=4)](https://github.com/romanlex)\n- [![@gekkedev](https://avatars.githubusercontent.com/u/17025257?s=64&v=4)](https://github.com/gekkedev)\n- [![@Bricktech2000](https://avatars.githubusercontent.com/u/66650633?s=64&v=4)](https://github.com/Bricktech2000)\n\n## Languages\n\n- [JavaScript100.0%](https://github.com/browserslist/update-db/search?l=javascript)","size_bytes":10931},"server/db.ts":{"content":"import { Pool } from \"pg\";\nimport { drizzle } from \"drizzle-orm/node-postgres\";\nimport * as schema from \"@shared/schema\";\nimport {\n  categories,\n  products,\n  employees,\n  tables,\n  orders,\n  orderItems,\n  transactions,\n  transactionItems,\n  attendanceRecords,\n  storeSettings,\n  suppliers,\n  customers,\n} from \"@shared/schema\";\nimport { sql } from \"drizzle-orm\";\n\n// Load environment variables from .env file with higher priority\nimport { config } from \"dotenv\";\nimport path from \"path\";\n\n// Load .env.local first, then override with .env to ensure .env has priority\nconfig({ path: path.resolve(\".env.local\") });\nconfig({ path: path.resolve(\".env\") });\n\n// Use EXTERNAL_DB_URL first, then fallback to CUSTOM_DATABASE_URL, then DATABASE_URL\nlet DATABASE_URL = process.env.EXTERNAL_DB_URL || process.env.DATABASE_URL;\n\nif (!DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\n// Ensure we're using the correct database and SSL settings for external server\nif (DATABASE_URL?.includes(\"1.55.212.135\")) {\n  if (!DATABASE_URL.includes(\"sslmode=disable\")) {\n    DATABASE_URL += DATABASE_URL.includes(\"?\")\n      ? \"&sslmode=disable\"\n      : \"?sslmode=disable\";\n  }\n}\n\nexport const pool = new Pool({\n  connectionString: DATABASE_URL,\n  max: 20,\n  idleTimeoutMillis: 30000,\n  connectionTimeoutMillis: 2000,\n  ssl: DATABASE_URL?.includes(\"1.55.212.135\")\n    ? false // Disable SSL for external server\n    : DATABASE_URL?.includes(\"neon\")\n      ? { rejectUnauthorized: false }\n      : undefined,\n});\n\n// Log database connection info with detailed debugging\nconsole.log(\"🔍 Environment check:\");\nconsole.log(\"  - NODE_ENV:\", process.env.NODE_ENV);\nconsole.log(\n  \"  - CUSTOM_DATABASE_URL exists:\",\n  !!process.env.CUSTOM_DATABASE_URL,\n);\nconsole.log(\"  - DATABASE_URL exists:\", !!process.env.DATABASE_URL);\nconsole.log(\"  - EXTERNAL_DB_URL exists:\", !!process.env.EXTERNAL_DB_URL);\nconsole.log(\n  \"  - Using URL:\",\n  process.env.EXTERNAL_DB_URL\n    ? \"EXTERNAL_DB_URL\"\n    : process.env.CUSTOM_DATABASE_URL\n      ? \"CUSTOM_DATABASE_URL\"\n      : \"DATABASE_URL\",\n);\nconsole.log(\n  \"  - DATABASE_URL preview:\",\n  DATABASE_URL?.substring(0, 50) + \"...\",\n);\nconsole.log(\n  \"  - DATABASE_URL full (masked):\",\n  DATABASE_URL?.replace(/:[^:@]*@/, \":****@\"),\n);\nconsole.log(\n  \"  - Contains 1.55.212.135:\",\n  DATABASE_URL?.includes(\"1.55.212.135\"),\n);\nconsole.log(\"  - Contains neon:\", DATABASE_URL?.includes(\"neon\"));\nconsole.log(\n  \"🔗 Database connection string:\",\n  DATABASE_URL?.replace(/:[^:@]*@/, \":****@\"),\n);\n\n// Test database connection immediately\nconsole.log(\"🔍 Testing database connection...\");\npool.query(\"SELECT current_database(), current_user, version()\", (err, res) => {\n  if (err) {\n    console.error(\"❌ Database connection failed:\", err.message);\n  } else {\n    console.log(\"✅ Database connection successful:\");\n    console.log(\"  - Database:\", res.rows[0]?.current_database);\n    console.log(\"  - User:\", res.rows[0]?.current_user);\n    console.log(\"  - Version:\", res.rows[0]?.version?.substring(0, 50) + \"...\");\n  }\n});\n\nexport const db = drizzle(pool, { schema });\n\n// Initialize sample data function\nexport async function initializeSampleData() {\n  try {\n    console.log(\"Running database migrations...\");\n\n    // Run migration for membership thresholds\n    try {\n      await db.execute(sql`\n        ALTER TABLE store_settings \n        ADD COLUMN IF NOT EXISTS gold_threshold TEXT DEFAULT '300000'\n      `);\n      await db.execute(sql`\n        ALTER TABLE store_settings \n        ADD COLUMN IF NOT EXISTS vip_threshold TEXT DEFAULT '1000000'\n      `);\n\n      // Update existing records\n      await db.execute(sql`\n        UPDATE store_settings \n        SET gold_threshold = COALESCE(gold_threshold, '300000'), \n            vip_threshold = COALESCE(vip_threshold, '1000000')\n      `);\n\n      console.log(\n        \"Migration for membership thresholds completed successfully.\",\n      );\n    } catch (migrationError) {\n      console.log(\"Migration already applied or error:\", migrationError);\n    }\n\n    // Run migration for product_type column\n    try {\n      await db.execute(sql`\n        ALTER TABLE products ADD COLUMN IF NOT EXISTS product_type INTEGER DEFAULT 1\n      `);\n      await db.execute(sql`\n        UPDATE products SET product_type = 1 WHERE product_type IS NULL\n      `);\n      await db.execute(sql`\n        CREATE INDEX IF NOT EXISTS idx_products_product_type ON products(product_type)\n      `);\n\n      console.log(\"Migration for product_type column completed successfully.\");\n    } catch (migrationError) {\n      console.log(\n        \"Product type migration already applied or error:\",\n        migrationError,\n      );\n    }\n\n    // Run migration for tax_rate column\n    try {\n      await db.execute(sql`\n        ALTER TABLE products ADD COLUMN IF NOT EXISTS tax_rate DECIMAL(5,2) DEFAULT 0.00\n      `);\n      await db.execute(sql`\n        UPDATE products SET tax_rate = 0.00 WHERE tax_rate IS NULL\n      `);\n\n      console.log(\"Migration for tax_rate column completed successfully.\");\n    } catch (migrationError) {\n      console.log(\n        \"Tax rate migration already applied or error:\",\n        migrationError,\n      );\n    }\n\n    // Run migration for price_includes_tax column\n    try {\n      await db.execute(sql`\n        ALTER TABLE products ADD COLUMN IF NOT EXISTS price_includes_tax BOOLEAN DEFAULT false\n      `);\n      await db.execute(sql`\n        UPDATE products SET price_includes_tax = false WHERE price_includes_tax IS NULL\n      `);\n\n      console.log(\n        \"Migration for price_includes_tax column completed successfully.\",\n      );\n    } catch (migrationError) {\n      console.log(\n        \"Price includes tax migration already applied or error:\",\n        migrationError,\n      );\n    }\n\n    // Run migration for after_tax_price column\n    try {\n      await db.execute(sql`\n        ALTER TABLE products ADD COLUMN IF NOT EXISTS after_tax_price DECIMAL(10,2)\n      `);\n\n      console.log(\n        \"Migration for after_tax_price column completed successfully.\",\n      );\n    } catch (migrationError) {\n      console.log(\n        \"After tax price migration already applied or error:\",\n        migrationError,\n      );\n    }\n\n    // Run migration for pinCode column in store_settings\n    try {\n      await db.execute(sql`\n        ALTER TABLE store_settings ADD COLUMN IF NOT EXISTS pin_code TEXT\n      `);\n\n      console.log(\"Migration for pinCode column completed successfully.\");\n    } catch (migrationError) {\n      console.log(\n        \"PinCode migration already applied or error:\",\n        migrationError,\n      );\n    }\n\n    // Add templateCode column to invoice_templates table\n    try {\n      await db.execute(sql`\n        ALTER TABLE invoice_templates \n        ADD COLUMN IF NOT EXISTS template_code VARCHAR(50)\n      `);\n      console.log(\"Migration for templateCode column completed successfully.\");\n    } catch (error) {\n      console.log(\n        \"TemplateCode migration failed or column already exists:\",\n        error,\n      );\n    }\n\n    // Add trade_number column to invoices table and migrate data\n    try {\n      await db.execute(sql`\n        ALTER TABLE invoices ADD COLUMN IF NOT EXISTS trade_number VARCHAR(50)\n      `);\n\n      // Copy data from invoice_number to trade_number\n      await db.execute(sql`\n        UPDATE invoices SET trade_number = invoice_number WHERE trade_number IS NULL OR trade_number = ''\n      `);\n\n      // Clear invoice_number column\n      await db.execute(sql`\n        UPDATE invoices SET invoice_number = NULL\n      `);\n\n      // Create index for trade_number\n      await db.execute(sql`\n        CREATE INDEX IF NOT EXISTS idx_invoices_trade_number ON invoices(trade_number)\n      `);\n\n      console.log(\"Migration for trade_number column completed successfully.\");\n    } catch (error) {\n      console.log(\"Trade number migration failed or already applied:\", error);\n    }\n\n    // Add invoice_status column to invoices table\n    try {\n      await db.execute(sql`\n        ALTER TABLE invoices ADD COLUMN IF NOT EXISTS invoice_status INTEGER NOT NULL DEFAULT 1\n      `);\n\n      // Create index for invoice_status\n      await db.execute(sql`\n        CREATE INDEX IF NOT EXISTS idx_invoices_invoice_status ON invoices(invoice_status)\n      `);\n\n      console.log(\n        \"Migration for invoice_status column completed successfully.\",\n      );\n    } catch (error) {\n      console.log(\"Invoice status migration failed or already applied:\", error);\n    }\n\n    // Add template_number and symbol columns to orders table\n    try {\n      await db.execute(sql`\n        ALTER TABLE orders ADD COLUMN IF NOT EXISTS template_number VARCHAR(50)\n      `);\n      await db.execute(sql`\n        ALTER TABLE orders ADD COLUMN IF NOT EXISTS symbol VARCHAR(20)\n      `);\n\n      // Create indexes for template_number and symbol\n      await db.execute(sql`\n        CREATE INDEX IF NOT EXISTS idx_orders_template_number ON orders(template_number)\n      `);\n      await db.execute(sql`\n        CREATE INDEX IF NOT EXISTS idx_orders_symbol ON orders(symbol)\n      `);\n\n      console.log(\n        \"Migration for template_number and symbol columns in orders table completed successfully.\",\n      );\n    } catch (error) {\n      console.log(\n        \"Template number and symbol migration failed or already applied:\",\n        error,\n      );\n    }\n\n    // Add invoice_number column to orders table\n    try {\n      await db.execute(sql`\n        ALTER TABLE orders ADD COLUMN IF NOT EXISTS invoice_number VARCHAR(50)\n      `);\n\n      // Create index for invoice_number\n      await db.execute(sql`\n        CREATE INDEX IF NOT EXISTS idx_orders_invoice_number ON orders(invoice_number)\n      `);\n\n      console.log(\n        \"Migration for invoice_number column in orders table completed successfully.\",\n      );\n    } catch (error) {\n      console.log(\"Invoice number migration failed or already applied:\", error);\n    }\n\n    // Run migration for email constraint in employees table\n    try {\n      await db.execute(sql`\n        ALTER TABLE employees DROP CONSTRAINT IF EXISTS employees_email_unique\n      `);\n\n      await db.execute(sql`\n        CREATE UNIQUE INDEX IF NOT EXISTS employees_email_unique_idx \n        ON employees (email) \n        WHERE email IS NOT NULL AND email != ''\n      `);\n\n      await db.execute(sql`\n        UPDATE employees SET email = NULL WHERE email = ''\n      `);\n\n      console.log(\n        \"Migration for employees email constraint completed successfully.\",\n      );\n    } catch (migrationError) {\n      console.log(\n        \"Email constraint migration already applied or error:\",\n        migrationError,\n      );\n    }\n\n    // Skip sample data initialization - using external database\n    console.log(\"🔍 Checking customer table data...\");\n    const customerCount = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(customers);\n    console.log(\n      `📊 Found ${customerCount[0]?.count || 0} customers in database`,\n    );\n\n    // Note: Sample data insertion disabled for external database\n    console.log(\"ℹ️ Sample data insertion skipped - using external database\");\n\n    // Add notes column to transactions table if it doesn't exist\n    try {\n      await db.execute(sql`\n        ALTER TABLE transactions ADD COLUMN IF NOT EXISTS notes TEXT\n      `);\n      console.log(\"Migration for notes column in transactions table completed successfully.\");\n    } catch (migrationError) {\n      console.log(\"Notes column migration already applied or error:\", migrationError);\n    }\n\n    // Add invoice_id and invoice_number columns to transactions table if they don't exist\n    try {\n      await db.execute(sql`\n        ALTER TABLE transactions ADD COLUMN IF NOT EXISTS invoice_id INTEGER REFERENCES invoices(id)\n      `);\n      await db.execute(sql`\n        ALTER TABLE transactions ADD COLUMN IF NOT EXISTS invoice_number VARCHAR(50)\n      `);\n      console.log(\"Migration for invoice_id and invoice_number columns in transactions table completed successfully.\");\n    } catch (migrationError) {\n      console.log(\"Invoice columns migration already applied or error:\", migrationError);\n    }\n\n    // Initialize inventory_transactions table if it doesn't exist\n    try {\n      await db.execute(sql`\n        CREATE TABLE IF NOT EXISTS inventory_transactions (\n          id SERIAL PRIMARY KEY,\n          product_id INTEGER REFERENCES products(id) NOT NULL,\n          type VARCHAR(20) NOT NULL,\n          quantity INTEGER NOT NULL,\n          previous_stock INTEGER NOT NULL,\n          new_stock INTEGER NOT NULL,\n          notes TEXT,\n          created_at VARCHAR(50) NOT NULL\n        )\n      `);\n      console.log(\"Inventory transactions table initialized\");\n    } catch (error) {\n      console.log(\n        \"Inventory transactions table already exists or initialization failed:\",\n        error,\n      );\n    }\n\n    // Initialize einvoice_connections table if it doesn't exist\n    try {\n      await db.execute(sql`\n        CREATE TABLE IF NOT EXISTS einvoice_connections (\n          id SERIAL PRIMARY KEY,\n          symbol VARCHAR(10) NOT NULL,\n          tax_code VARCHAR(20) NOT NULL,\n          login_id VARCHAR(50) NOT NULL,\n          password TEXT NOT NULL,\n          software_name VARCHAR(50) NOT NULL,\n          login_url TEXT,\n          sign_method VARCHAR(20) NOT NULL DEFAULT 'Ký server',\n          cqt_code VARCHAR(20) NOT NULL DEFAULT 'Cấp nhật',\n          notes TEXT,\n          is_default BOOLEAN NOT NULL DEFAULT false,\n          is_active BOOLEAN NOT NULL DEFAULT true,\n          created_at TIMESTAMP DEFAULT NOW() NOT NULL,\n          updated_at TIMESTAMP DEFAULT NOW() NOT NULL\n        )\n      `);\n\n      // Create indexes for better performance\n      await db.execute(sql`\n        CREATE INDEX IF NOT EXISTS idx_einvoice_connections_symbol ON einvoice_connections(symbol)\n      `);\n      await db.execute(sql`\n        CREATE INDEX IF NOT EXISTS idx_einvoice_connections_active ON einvoice_connections(is_active)\n      `);\n\n      console.log(\"E-invoice connections table initialized\");\n    } catch (error) {\n      console.log(\n        \"E-invoice connections table already exists or initialization failed:\",\n        error,\n      );\n    }\n\n    // Initialize invoice_templates table if it doesn't exist\n    try {\n      await db.execute(sql`\n        CREATE TABLE IF NOT EXISTS invoice_templates (\n          id SERIAL PRIMARY KEY,\n          name VARCHAR(100) NOT NULL,\n          template_number VARCHAR(50) NOT NULL,\n          template_code VARCHAR(50),\n          symbol VARCHAR(20) NOT NULL,\n          use_ck BOOLEAN NOT NULL DEFAULT true,\n          notes TEXT,\n          is_default BOOLEAN NOT NULL DEFAULT false,\n          is_active BOOLEAN NOT NULL DEFAULT true,\n          created_at TIMESTAMP DEFAULT NOW() NOT NULL,\n          updated_at TIMESTAMP DEFAULT NOW() NOT NULL\n        )\n      `);\n\n      // Create indexes for better performance\n      await db.execute(sql`\n        CREATE INDEX IF NOT EXISTS idx_invoice_templates_symbol ON invoice_templates(symbol)\n      `);\n      await db.execute(sql`\n        CREATE INDEX IF NOT EXISTS idx_invoice_templates_default ON invoice_templates(is_default)\n      `);\n\n      console.log(\"Invoice templates table initialized\");\n    } catch (error) {\n      console.log(\n        \"Invoice templates table already exists or initialization failed:\",\n        error,\n      );\n    }\n\n    // Initialize invoices table if it doesn't exist\n    try {\n      await db.execute(sql`\n        CREATE TABLE IF NOT EXISTS invoices (\n          id SERIAL PRIMARY KEY,\n          invoice_number VARCHAR(50) UNIQUE NOT NULL,\n          customer_id INTEGER,\n          customer_name VARCHAR(100) NOT NULL,\n          customer_tax_code VARCHAR(20),\n          customer_address TEXT,\n          customer_phone VARCHAR(20),\n          customer_email VARCHAR(100),\n          subtotal DECIMAL(10, 2) NOT NULL,\n          tax DECIMAL(10, 2) NOT NULL,\n          total DECIMAL(10, 2) NOT NULL,\n          payment_method VARCHAR(50) NOT NULL,\n          invoice_date TIMESTAMP NOT NULL,\n          status VARCHAR(20) NOT NULL DEFAULT 'draft',\n          einvoice_status INTEGER NOT NULL DEFAULT 0,\n          notes TEXT,\n          created_at TIMESTAMP DEFAULT NOW() NOT NULL,\n          updated_at TIMESTAMP DEFAULT NOW() NOT NULL\n        )\n      `);\n\n      // Create indexes for better performance\n      await db.execute(sql`\n        CREATE INDEX IF NOT EXISTS idx_invoices_invoice_number ON invoices(invoice_number)\n      `);\n      await db.execute(sql`\n        CREATE INDEX IF NOT EXISTS idx_invoices_customer_id ON invoices(customer_id)\n      `);\n      await db.execute(sql`\n        CREATE INDEX IF NOT EXISTS idx_invoices_status ON invoices(status)\n      `);\n\n      console.log(\"Invoices table initialized\");\n    } catch (error) {\n      console.log(\n        \"Invoices table already exists or initialization failed:\",\n        error,\n      );\n    }\n\n    // Initialize printer_configs table if it doesn't exist\n    try {\n      // Check if table exists first\n      const tableExists = await db.execute(sql`\n        SELECT EXISTS (\n          SELECT FROM information_schema.tables \n          WHERE table_schema = 'public' \n          AND table_name = 'printer_configs'\n        )\n      `);\n\n      if (!tableExists.rows[0]?.exists) {\n        await db.execute(sql`\n          CREATE TABLE printer_configs (\n            id SERIAL PRIMARY KEY,\n            name VARCHAR(100) NOT NULL,\n            printer_type VARCHAR(50) NOT NULL DEFAULT 'thermal',\n            connection_type VARCHAR(50) NOT NULL DEFAULT 'usb',\n            ip_address VARCHAR(45),\n            port INTEGER DEFAULT 9100,\n            mac_address VARCHAR(17),\n            paper_width INTEGER NOT NULL DEFAULT 80,\n            print_speed INTEGER DEFAULT 100,\n            is_primary BOOLEAN NOT NULL DEFAULT false,\n            is_secondary BOOLEAN NOT NULL DEFAULT false,\n            is_active BOOLEAN NOT NULL DEFAULT true,\n            created_at TIMESTAMP DEFAULT NOW() NOT NULL,\n            updated_at TIMESTAMP DEFAULT NOW() NOT NULL\n          )\n        `);\n\n        // Create indexes for better performance\n        await db.execute(sql`\n          CREATE INDEX idx_printer_configs_primary ON printer_configs(is_primary)\n        `);\n        await db.execute(sql`\n          CREATE INDEX idx_printer_configs_active ON printer_configs(is_active)\n        `);\n\n        console.log(\"Printer configs table created successfully\");\n      } else {\n        // Add missing columns if table exists\n        try {\n          await db.execute(sql`\n            ALTER TABLE printer_configs ADD COLUMN IF NOT EXISTS is_primary BOOLEAN DEFAULT false\n          `);\n          await db.execute(sql`\n            ALTER TABLE printer_configs ADD COLUMN IF NOT EXISTS is_secondary BOOLEAN DEFAULT false\n          `);\n          console.log(\"Printer configs table columns updated\");\n        } catch (columnError) {\n          console.log(\"Printer configs columns already exist:\", columnError.message);\n        }\n      }\n    } catch (error) {\n      console.log(\n        \"Printer configs table initialization error:\",\n        error.message,\n      );\n    }\n\n    // Initialize invoice_items table if it doesn't exist\n    try {\n      await db.execute(sql`\n        CREATE TABLE IF NOT EXISTS invoice_items (\n          id SERIAL PRIMARY KEY,\n          invoice_id INTEGER REFERENCES invoices(id) NOT NULL,\n          product_id INTEGER,\n          product_name VARCHAR(200) NOT NULL,\n          quantity INTEGER NOT NULL,\n          unit_price DECIMAL(10, 2) NOT NULL,\n          total DECIMAL(10, 2) NOT NULL,\n          tax_rate DECIMAL(5, 2) NOT NULL DEFAULT 10.00\n        )\n      `);\n\n      // Create indexes for better performance\n      await db.execute(sql`\n        CREATE INDEX IF NOT EXISTS idx_invoice_items_invoice_id ON invoice_items(invoice_id)\n      `);\n      await db.execute(sql`\n        CREATE INDEX IF NOT EXISTS idx_invoice_items_product_id ON invoice_items(product_id)\n      `);\n\n      console.log(\"Invoice items table initialized\");\n    } catch (error) {\n      console.log(\n        \"Invoice items table already exists or initialization failed:\",\n        error,\n      );\n    }\n  } catch (error) {\n    console.log(\"⚠️ Sample data initialization skipped:\", error);\n  }\n}\n","size_bytes":20289},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"…\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    let message = err.message || \"Internal Server Error\";\n\n    // Handle database connection errors\n    if (message.includes('ECONNREFUSED') || message.includes('connection refused')) {\n      message = \"Database connection failed. Please check database server.\";\n      console.error(\"❌ Database connection error:\", err);\n    }\n\n    // Handle database lock errors\n    if (message.includes('INDEX_LOCKED') || message.includes('database is locked')) {\n      message = \"Database temporarily unavailable. Please try again.\";\n      console.log(\"Database lock detected, retrying...\");\n    }\n\n    // Handle authentication errors\n    if (message.includes('authentication failed') || message.includes('password authentication failed')) {\n      message = \"Database authentication failed. Please check credentials.\";\n      console.error(\"❌ Database auth error:\", err);\n    }\n\n    // Handle timeout errors\n    if (message.includes('timeout') || message.includes('connection timeout')) {\n      message = \"Database connection timeout. Please try again.\";\n      console.error(\"⏰ Database timeout error:\", err);\n    }\n\n    res.status(status).json({ message });\n    if (status >= 500) {\n      console.error('💥 Server error:', err);\n    }\n  });\n\n  // Add WebSocket popup close endpoint\n  app.post('/api/popup/close', (req, res) => {\n    const { success } = req.body;\n\n    // Import and use WebSocket server\n    import('./websocket-server').then((wsModule) => {\n      wsModule.broadcastPopupClose(success);\n    });\n\n    res.json({ success: true, message: 'Popup close signal sent' });\n  });\n\n  // Add endpoint to receive payment notification from external API\n  app.post('/api/NotifyPos/ReceiveNotify', (req, res) => {\n    try {\n      const { TransactionUuid } = req.body;\n\n      console.log('📢 Received payment notification from API! TransactionUuid:', TransactionUuid);\n\n      // Broadcast payment success via WebSocket\n      import('./websocket-server').then((wsModule) => {\n        wsModule.broadcastPaymentSuccess(TransactionUuid);\n      });\n\n      res.json({ message: 'Notification received successfully.' });\n    } catch (error) {\n      console.error('Error processing payment notification:', error);\n      res.status(500).json({ error: 'Failed to process notification' });\n    }\n  });\n\n  // Start WebSocket server for popup signals\n  try {\n    const wsModule = await import('./websocket-server');\n    wsModule.initializeWebSocketServer(server);\n    log('WebSocket server initialized on same port as HTTP server');\n  } catch (error) {\n    log('Failed to start WebSocket server:', error);\n    console.error('WebSocket error details:', error);\n    // Continue without WebSocket if it fails\n  }\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const PORT = process.env.PORT || 5001;\n\n  // Handle server errors first before trying to listen\n  server.on('error', (err: any) => {\n    if (err.code === 'EADDRINUSE') {\n      console.log(`⚠️ Port ${PORT} is busy, trying port ${PORT + 1}`);\n      setTimeout(() => {\n        server.listen({\n          port: PORT + 1,\n          host: \"0.0.0.0\",\n          reusePort: false,\n        }, () => {\n          log(`🚀 Server running on port ${PORT + 1}`);\n          import('./websocket-server').then((wsModule) => {\n            wsModule.initializeWebSocketServer(server);\n            log('WebSocket server initialized on same port as HTTP server');\n          });\n        });\n      }, 1000);\n    } else {\n      console.error('💥 Server error:', err);\n    }\n  });\n\n  // Try to start server on primary port\n  try {\n    server.listen({\n      port: PORT,\n      host: \"0.0.0.0\",\n      reusePort: false,\n    }, () => {\n      log(`🚀 Server running on port ${PORT}`);\n\n      // Initialize WebSocket server after HTTP server is running\n      import('./websocket-server').then((wsModule) => {\n        wsModule.initializeWebSocketServer(server);\n        log('WebSocket server initialized on same port as HTTP server');\n      });\n    });\n  } catch (error) {\n    console.error('Failed to start server:', error);\n  }\n})();","size_bytes":5755},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { tenantMiddleware, getTenantDatabase, TenantRequest } from \"./tenant-middleware\";\nimport {\n  insertProductSchema,\n  insertTransactionSchema,\n  insertTransactionItemSchema,\n  insertEmployeeSchema,\n  insertAttendanceSchema,\n  insertTableSchema,\n  insertOrderSchema,\n  insertOrderItemSchema,\n  insertStoreSettingsSchema,\n  insertSupplierSchema,\n  insertCustomerSchema,\n  insertPointTransactionSchema,\n  attendanceRecords,\n  products,\n  inventoryTransactions,\n  invoiceTemplates,\n  invoices,\n  invoiceItems,\n  customers,\n} from \"@shared/schema\";\nimport { initializeSampleData, db } from \"./db\";\nimport { registerTenantRoutes } from \"./tenant-routes\";\nimport { z } from \"zod\";\nimport {\n  eq,\n  desc,\n  asc,\n  and,\n  or,\n  like,\n  count,\n  sum,\n  gte,\n  lt,\n  lte,\n  ilike,\n  ne\n} from \"drizzle-orm\";\nimport {\n  sql\n} from \"drizzle-orm\";\nimport {\n  orders,\n  orderItems,\n  products,\n  categories,\n  transactions as transactionsTable,\n  transactionItems as transactionItemsTable,\n  tables\n} from \"@shared/schema\";\n\nexport async function registerRoutes(app: Express): Promise < Server > {\n  // Register tenant management routes\n  registerTenantRoutes(app);\n\n  // Apply tenant middleware to all API routes\n  app.use('/api', tenantMiddleware);\n\n  // Initialize sample data\n  await initializeSampleData();\n\n  // Ensure inventory_transactions table exists\n  try {\n    await db.execute(sql `\n      CREATE TABLE IF NOT EXISTS inventory_transactions (\n        id SERIAL PRIMARY KEY,\n        product_id INTEGER REFERENCES products(id) NOT NULL,\n        type VARCHAR(20) NOT NULL,\n        quantity INTEGER NOT NULL,\n        previous_stock INTEGER NOT NULL,\n        new_stock INTEGER NOT NULL,\n        notes TEXT,\n        created_at VARCHAR(50) NOT NULL\n      )\n    `);\n  } catch (error) {\n    console.log(\n      \"Inventory transactions table already exists or creation failed:\",\n      error,\n    );\n  }\n\n  // Categories\n  app.get(\"/api/categories\", async (req: TenantRequest, res) => {\n    try {\n      const tenantDb = await getTenantDatabase(req);\n      const categories = await storage.getCategories(tenantDb);\n      res.json(categories);\n    } catch (error) {\n      console.error(\"Error fetching categories:\", error);\n      res.status(500).json({ error: \"Failed to fetch categories\" });\n    }\n  });\n\n  app.post(\"/api/categories\", async (req: TenantRequest, res) => {\n    try {\n      const { name, icon } = req.body;\n      const tenantDb = await getTenantDatabase(req);\n\n      if (!name || !name.trim()) {\n        return res.status(400).json({ error: \"Category name is required\" });\n      }\n\n      const categoryData = {\n        name: name.trim(),\n        icon: icon || \"fas fa-utensils\",\n      };\n\n      const category = await storage.createCategory(categoryData, tenantDb);\n      res.json(category);\n    } catch (error) {\n      console.error(\"Error creating category:\", error);\n      res.status(500).json({ error: \"Failed to create category\" });\n    }\n  });\n\n  app.put(\"/api/categories/:id\", async (req: TenantRequest, res) => {\n    try {\n      const categoryId = parseInt(req.params.id);\n      const { name, icon } = req.body;\n      const tenantDb = await getTenantDatabase(req);\n\n      if (!name || !name.trim()) {\n        return res.status(400).json({ error: \"Category name is required\" });\n      }\n\n      const categoryData = {\n        name: name.trim(),\n        icon: icon || \"fas fa-utensils\",\n      };\n\n      const category = await storage.updateCategory(categoryId, categoryData, tenantDb);\n      res.json(category);\n    } catch (error) {\n      console.error(\"Error updating category:\", error);\n      res.status(500).json({ error: \"Failed to update category\" });\n    }\n  });\n\n  app.delete(\"/api/categories/:id\", async (req: TenantRequest, res) => {\n    try {\n      const categoryId = parseInt(req.params.id);\n      const tenantDb = await getTenantDatabase(req);\n\n      // Check if category has products\n      const products = await storage.getProductsByCategory(categoryId, tenantDb);\n      if (products.length > 0) {\n        return res.status(400).json({\n          error: `Không thể xóa danh mục vì còn ${products.length} sản phẩm. Vui lòng xóa hoặc chuyển các sản phẩm sang danh mục khác trước.`,\n        });\n      }\n\n      await storage.deleteCategory(categoryId, tenantDb);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting category:\", error);\n\n      // Handle foreign key constraint errors\n      if (\n        error instanceof Error &&\n        error.message.includes(\"foreign key constraint\")\n      ) {\n        return res.status(400).json({\n          error:\n            \"Không thể xóa danh mục vì vẫn còn sản phẩm thuộc danh mục này. Vui lòng xóa hoặc chuyển các sản phẩm sang danh mục khác trước.\",\n        });\n      }\n\n      res.status(500).json({ error: \"Có lỗi xảy ra khi xóa danh mục\" });\n    }\n  });\n\n  // Products\n  app.get(\"/api/products\", async (req: TenantRequest, res) => {\n    try {\n      const { category, search, includeInactive } = req.query;\n      let products;\n\n      console.log(\"=== PRODUCTS API DEBUG ===\");\n      console.log(\"Query params:\", { category, search, includeInactive });\n\n      const shouldIncludeInactive = includeInactive === \"true\";\n      const tenantDb = await getTenantDatabase(req);\n\n      if (search) {\n        console.log(\"Searching products with term:\", search);\n        products = await storage.searchProducts(\n          search as string,\n          shouldIncludeInactive,\n          tenantDb,\n        );\n      } else if (category && category !== \"all\") {\n        console.log(\"Getting products by category:\", category);\n        products = await storage.getProductsByCategory(\n          parseInt(category as string),\n          shouldIncludeInactive,\n          tenantDb,\n        );\n      } else {\n        console.log(\"Getting all products, includeInactive:\", shouldIncludeInactive);\n        products = await storage.getAllProducts(shouldIncludeInactive, tenantDb);\n      }\n\n      console.log(\"Products found:\", products.length);\n      console.log(\"First few products:\", products.slice(0, 3));\n\n      // Debug afterTaxPrice for Bánh test\n      const banhTest = products.find(p => p.name === 'Bánh test');\n      if (banhTest) {\n        console.log(\"=== BÁNH TEST DEBUG ===\");\n        console.log(\"Product ID:\", banhTest.id);\n        console.log(\"Name:\", banhTest.name);\n        console.log(\"Price:\", banhTest.price);\n        console.log(\"Tax Rate:\", banhTest.taxRate);\n        console.log(\"After Tax Price:\", banhTest.afterTaxPrice);\n        console.log(\"After Tax Price Type:\", typeof banhTest.afterTaxPrice);\n      }\n\n      res.json(products);\n    } catch (error) {\n      console.error('Products API error:', error);\n      res.status(500).json({ message: \"Failed to fetch products\" });\n    }\n  });\n\n  // Endpoint for POS to get only active products\n  app.get(\"/api/products/active\", async (req: TenantRequest, res) => {\n    try {\n      const tenantDb = await getTenantDatabase(req);\n      const products = await storage.getActiveProducts(tenantDb);\n      res.json(products);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch active products\" });\n    }\n  });\n\n  // Get single product by ID\n  app.get(\"/api/products/:id\", async (req: TenantRequest, res) => {\n    try {\n      const productId = parseInt(req.params.id);\n      if (isNaN(productId)) {\n        return res.status(400).json({ error: \"Invalid product ID\" });\n      }\n\n      const tenantDb = await getTenantDatabase(req);\n\n      const [product] = await db\n        .select({\n          id: products.id,\n          name: products.name,\n          sku: products.sku,\n          price: products.price,\n          stock: products.stock,\n          categoryId: products.categoryId,\n          categoryName: categories.name,\n          imageUrl: products.imageUrl,\n          isActive: products.isActive,\n          productType: products.productType,\n          trackInventory: products.trackInventory,\n          taxRate: products.taxRate,\n          priceIncludesTax: products.priceIncludesTax,\n          afterTaxPrice: products.afterTaxPrice,\n        })\n        .from(products)\n        .leftJoin(categories, eq(products.categoryId, categories.id))\n        .where(and(eq(products.id, productId), eq(products.isActive, true)))\n        .limit(1);\n\n      if (!product) {\n        return res.status(404).json({ error: \"Product not found\" });\n      }\n\n      console.log(`=== SINGLE PRODUCT API DEBUG ===`);\n      console.log(`Product ID: ${product.id}`);\n      console.log(`Name: ${product.name}`);\n      console.log(`Price: ${product.price}`);\n      console.log(`Tax Rate: ${product.taxRate}`);\n      console.log(`After Tax Price: ${product.afterTaxPrice}`);\n\n      res.json(product);\n    } catch (error) {\n      console.error(\"Error fetching single product:\", error);\n      res.status(500).json({ error: \"Failed to fetch product\" });\n    }\n  });\n\n  app.post(\"/api/products\", async (req: TenantRequest, res) => {\n    try {\n      console.log(\"Product creation request body:\", req.body);\n      const tenantDb = await getTenantDatabase(req);\n\n      // Ensure required fields are present\n      if (\n        !req.body.name ||\n        !req.body.sku ||\n        !req.body.price ||\n        !req.body.categoryId ||\n        req.body.taxRate === undefined\n      ) {\n        return res.status(400).json({\n          message:\n            \"Missing required fields: name, sku, price, categoryId, and taxRate are required\",\n        });\n      }\n\n      // Validate and transform the data\n      const validatedData = insertProductSchema.parse({\n        name: req.body.name,\n        sku: req.body.sku,\n        price: req.body.price.toString(),\n        stock: Number(req.body.stock) || 0,\n        categoryId: Number(req.body.categoryId),\n        productType: Number(req.body.productType) || 1,\n        trackInventory: req.body.trackInventory !== false,\n        imageUrl: req.body.imageUrl || null,\n        taxRate: req.body.taxRate.toString(),\n        afterTaxPrice: req.body.afterTaxPrice && req.body.afterTaxPrice.trim() !== \"\" ? req.body.afterTaxPrice.toString() : null,\n      });\n\n      console.log(\"Validated product data:\", validatedData);\n\n      // Check if SKU already exists (including inactive products)\n      const [existingProduct] = await db\n        .select()\n        .from(products)\n        .where(eq(products.sku, validatedData.sku));\n\n      if (existingProduct) {\n        console.log(\"SKU already exists:\", validatedData.sku);\n        return res.status(409).json({\n          message: `SKU \"${validatedData.sku}\" đã tồn tại trong hệ thống`,\n          code: \"DUPLICATE_SKU\",\n        });\n      }\n\n      const product = await storage.createProduct(validatedData, tenantDb);\n      console.log(\"Product created successfully:\", product);\n      res.status(201).json(product);\n    } catch (error) {\n      console.error(\"Product creation error:\", error);\n      if (error instanceof z.ZodError) {\n        console.error(\"Validation errors:\", error.errors);\n        return res.status(400).json({\n          message: \"Invalid product data\",\n          errors: error.errors,\n          details: error.format(),\n        });\n      }\n      res.status(500).json({\n        message: \"Failed to create product\",\n        error: error instanceof Error ? error.message : String(error),\n      });\n    }\n  });\n\n  app.put(\"/api/products/:id\", async (req: TenantRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      console.log(\"Product update request:\", id, req.body);\n\n      // Transform data to ensure proper types\n      const transformedData = {\n        ...req.body,\n        price: req.body.price ? req.body.price.toString() : undefined,\n        taxRate: req.body.taxRate ? req.body.taxRate.toString() : undefined,\n        afterTaxPrice: req.body.afterTaxPrice && req.body.afterTaxPrice.trim() !== \"\" ? req.body.afterTaxPrice.toString() : null,\n        priceIncludesTax: req.body.priceIncludesTax || false,\n        trackInventory: req.body.trackInventory !== false\n      };\n\n      // Remove undefined fields\n      Object.keys(transformedData).forEach(key => {\n        if (transformedData[key] === undefined) {\n          delete transformedData[key];\n        }\n      });\n\n      console.log(\"Transformed update data:\", transformedData);\n\n      const validatedData = insertProductSchema.partial().parse(transformedData);\n      const tenantDb = await getTenantDatabase(req);\n      const product = await storage.updateProduct(id, validatedData, tenantDb);\n\n      if (!product) {\n        return res.status(404).json({ message: \"Product not found\" });\n      }\n\n      console.log(\"Product updated successfully:\", product);\n      res.json(product);\n    } catch (error) {\n      console.error(\"Product update error:\", error);\n      if (error instanceof z.ZodError) {\n        return res\n          .status(400)\n          .json({ message: \"Invalid product data\", errors: error.errors });\n      }\n      res.status(500).json({\n        message: \"Failed to update product\",\n        error: error instanceof Error ? error.message : String(error)\n      });\n    }\n  });\n\n  app.delete(\"/api/products/:id\", async (req: TenantRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const tenantDb = await getTenantDatabase(req);\n      const deleted = await storage.deleteProduct(id, tenantDb);\n\n      if (!deleted) {\n        return res.status(404).json({ message: \"Product not found\" });\n      }\n\n      res.json({ message: \"Product deleted successfully\" });\n    } catch (error) {\n      console.error(\"Delete product error:\", error);\n\n      if (error instanceof Error) {\n        if (error.message.includes(\"Cannot delete product\")) {\n          return res.status(400).json({\n            message: error.message,\n            code: \"PRODUCT_IN_USE\",\n          });\n        }\n      }\n\n      res.status(500).json({ message: \"Failed to delete product\" });\n    }\n  });\n\n  // New endpoint to cleanup inactive products\n  app.delete(\"/api/products/cleanup/inactive\", async (req: TenantRequest, res) => {\n    try {\n      const tenantDb = await getTenantDatabase(req);\n      const deletedCount = await storage.deleteInactiveProducts(tenantDb);\n      res.json({\n        message: `Successfully deleted ${deletedCount} inactive products`,\n        deletedCount,\n      });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to cleanup inactive products\" });\n    }\n  });\n\n  app.get(\"/api/products/barcode/:sku\", async (req: TenantRequest, res) => {\n    try {\n      const sku = req.params.sku;\n      const tenantDb = await getTenantDatabase(req);\n      const product = await storage.getProductBySku(sku, tenantDb);\n\n      if (!product) {\n        return res.status(404).json({ message: \"Product not found\" });\n      }\n\n      res.json(product);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch product by SKU\" });\n    }\n  });\n\n  // Transactions\n  app.post(\"/api/transactions\", async (req: TenantRequest, res) => {\n    try {\n      const { transaction, items } = req.body;\n      const tenantDb = await getTenantDatabase(req);\n\n      console.log(\n        \"Received transaction data:\",\n        JSON.stringify({ transaction, items }, null, 2),\n      );\n\n      // Validate with original string format, then transform\n      const validatedTransaction = insertTransactionSchema.parse(transaction);\n      const validatedItems = z.array(insertTransactionItemSchema).parse(items);\n\n      console.log(\n        \"Validated data:\",\n        JSON.stringify({ validatedTransaction, validatedItems }, null, 2),\n      );\n\n      // Fetch all products to access tax rates\n      const products = await storage.getAllProducts(true, tenantDb);\n\n      // Validate stock availability and calculate totals\n      let subtotal = 0;\n      let tax = 0;\n      const stockValidationErrors = [];\n\n      for (const item of validatedItems) {\n        const product = products.find((p) => p.id === item.productId);\n        if (!product) {\n          return res\n            .status(400)\n            .json({ message: `Product with ID ${item.productId} not found` });\n        }\n\n        // Check stock availability only for products that track inventory\n        if (product.trackInventory && product.stock < item.quantity) {\n          const errorMsg = `Insufficient stock for ${product.name}. Available: ${product.stock}, Requested: ${item.quantity}`;\n          console.log(`❌ ${errorMsg}`);\n          stockValidationErrors.push(errorMsg);\n          continue; // Continue checking other items\n        }\n\n        console.log(`✅ Stock check passed for ${product.name}: Available=${product.stock}, Requested=${item.quantity}`);\n\n        const itemSubtotal = parseFloat(item.price) * item.quantity;\n        let itemTax = 0;\n\n        // Tax = (after_tax_price - price) * quantity\n        if (product.afterTaxPrice && product.afterTaxPrice !== null && product.afterTaxPrice !== \"\") {\n          const afterTaxPrice = parseFloat(product.afterTaxPrice);\n          const price = parseFloat(product.price);\n          itemTax = (afterTaxPrice - price) * item.quantity;\n        } else {\n          // No afterTaxPrice means no tax\n          itemTax = 0;\n        }\n\n        subtotal += itemSubtotal;\n        tax += itemTax;\n      }\n\n      // Return all stock validation errors if any\n      if (stockValidationErrors.length > 0) {\n        return res.status(400).json({\n          message: \"Stock validation failed for multiple products\",\n          errors: stockValidationErrors,\n          details: stockValidationErrors.join(\"; \")\n        });\n      }\n\n      const total = subtotal + tax;\n\n      // Update the transaction with calculated totals\n      const transactionWithTotals = {\n        ...validatedTransaction,\n        subtotal: subtotal.toFixed(2),\n        tax: tax.toFixed(2),\n        total: total.toFixed(2),\n        invoiceId: validatedTransaction.invoiceId || null,\n        invoiceNumber: validatedTransaction.invoiceNumber || null,\n      };\n\n      const receipt = await storage.createTransaction(\n        transactionWithTotals,\n        validatedItems,\n        tenantDb,\n      );\n      res.status(201).json(receipt);\n    } catch (error) {\n      console.error(\"Transaction creation error:\", error);\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({\n          message: \"Invalid transaction data\",\n          errors: error.errors,\n          details: error.format(),\n        });\n      }\n      res.status(500).json({\n        message: \"Failed to create transaction\",\n        error: error instanceof Error ? error.message : String(error),\n      });\n    }\n  });\n\n  app.get(\"/api/transactions\", async (req: TenantRequest, res) => {\n    try {\n      const tenantDb = await getTenantDatabase(req);\n      const transactions = await storage.getTransactions(tenantDb);\n      res.json(transactions);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch transactions\" });\n    }\n  });\n\n  // Get transactions by date range\n  app.get(\"/api/transactions/:startDate/:endDate\", async (req: TenantRequest, res) => {\n    try {\n      const { startDate, endDate } = req.params;\n\n      const start = new Date(startDate);\n      start.setUTCHours(0, 0, 0, 0);\n\n      const end = new Date(endDate);\n      end.setUTCHours(23, 59, 59, 999);\n\n      const transactions = await db.select().from(transactionsTable)\n        .where(\n          and(\n            gte(transactionsTable.createdAt, start),\n            lte(transactionsTable.createdAt, end)\n          )\n        )\n        .orderBy(desc(transactionsTable.createdAt));\n\n      // Always return an array, even if empty\n      res.json(transactions || []);\n    } catch (error) {\n      console.error(\"Error fetching transactions:\", error);\n      // Return empty array instead of error for reports\n      res.json([]);\n    }\n  });\n\n\n  app.get(\"/api/transactions/:transactionId\", async (req: TenantRequest, res) => {\n    try {\n      const transactionId = req.params.transactionId;\n      const tenantDb = await getTenantDatabase(req);\n      const receipt =\n        await storage.getTransactionByTransactionId(transactionId, tenantDb);\n\n      if (!receipt) {\n        return res.status(404).json({ message: \"Transaction not found\" });\n      }\n\n      res.json(receipt);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch transaction\" });\n    }\n  });\n\n  // Get next employee ID\n  app.get(\"/api/employees/next-id\", async (req: TenantRequest, res) => {\n    try {\n      const tenantDb = await getTenantDatabase(req);\n      const nextId = await storage.getNextEmployeeId(tenantDb);\n      res.json({ nextId });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to generate employee ID\" });\n    }\n  });\n\n  // Employees\n  app.get(\"/api/employees\", async (req: TenantRequest, res) => {\n    try {\n      const tenantDb = await getTenantDatabase(req);\n      const employees = await storage.getEmployees(tenantDb);\n      res.json(employees);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch employees\" });\n    }\n  });\n\n  app.get(\"/api/employees/:id\", async (req: TenantRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const tenantDb = await getTenantDatabase(req);\n      const employee = await storage.getEmployee(id, tenantDb);\n\n      if (!employee) {\n        return res.status(404).json({ message: \"Employee not found\" });\n      }\n\n      res.json(employee);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch employee\" });\n    }\n  });\n\n  app.post(\"/api/employees\", async (req: TenantRequest, res) => {\n    try {\n      const validatedData = insertEmployeeSchema.parse(req.body);\n      const tenantDb = await getTenantDatabase(req);\n\n      // Check if email already exists (only if email is provided and not empty)\n      if (validatedData.email && validatedData.email.trim() !== \"\") {\n        const existingEmployee = await storage.getEmployeeByEmail(\n          validatedData.email,\n          tenantDb,\n        );\n        if (existingEmployee) {\n          return res.status(400).json({\n            message: \"Email đã tồn tại trong hệ thống\",\n            code: \"DUPLICATE_EMAIL\",\n            field: \"email\",\n          });\n        }\n      }\n\n      const employee = await storage.createEmployee(validatedData, tenantDb);\n      res.status(201).json(employee);\n    } catch (error) {\n      console.log(\"error: \", error);\n      if (error instanceof z.ZodError) {\n        return res\n          .status(400)\n          .json({ message: \"Invalid employee data\", errors: error });\n      }\n      res.status(500).json({ message: \"Failed to create employee\" });\n    }\n  });\n\n  app.put(\"/api/employees/:id\", async (req: TenantRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const validatedData = insertEmployeeSchema.partial().parse(req.body);\n      const tenantDb = await getTenantDatabase(req);\n\n      // Check if email already exists (only if email is provided and not empty, excluding current employee)\n      if (validatedData.email && validatedData.email.trim() !== \"\") {\n        const existingEmployee = await storage.getEmployeeByEmail(\n          validatedData.email,\n          tenantDb,\n        );\n        if (existingEmployee && existingEmployee.id !== id) {\n          return res.status(409).json({\n            message: \"Email đã tồn tại trong hệ thống\",\n            code: \"DUPLICATE_EMAIL\",\n            field: \"email\",\n          });\n        }\n      }\n\n      const employee = await storage.updateEmployee(id, validatedData, tenantDb);\n\n      if (!employee) {\n        return res.status(404).json({ message: \"Employee not found\" });\n      }\n\n      res.json(employee);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res\n          .status(400)\n          .json({ message: \"Invalid employee data\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to update employee\" });\n    }\n  });\n\n  app.delete(\"/api/employees/:id\", async (req: TenantRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const tenantDb = await getTenantDatabase(req);\n      const deleted = await storage.deleteEmployee(id, tenantDb);\n\n      if (!deleted) {\n        return res.status(404).json({ message: \"Employee not found\" });\n      }\n\n      res.json({ message: \"Employee deleted successfully\" });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete employee\" });\n    }\n  });\n\n  // Attendance routes\n  app.get(\"/api/attendance\", async (req: TenantRequest, res) => {\n    try {\n      const { date } = req.query;\n      const tenantDb = await getTenantDatabase(req);\n\n      let whereCondition;\n      if (date && typeof date === \"string\") {\n        // Filter by specific date\n        const startOfDay = new Date(date);\n        startOfDay.setHours(0, 0, 0, 0);\n\n        const endOfDay = new Date(date);\n        endOfDay.setHours(23, 59, 59, 999);\n\n        whereCondition = and(\n          gte(attendanceRecords.clockIn, startOfDay),\n          lt(attendanceRecords.clockIn, endOfDay),\n        );\n      }\n\n      const attendance = await db\n        .select()\n        .from(attendanceRecords)\n        .where(whereCondition)\n        .orderBy(desc(attendanceRecords.clockIn));\n\n      res.json(attendance);\n    } catch (error) {\n      console.error(\"Error fetching attendance records:\", error);\n      res.status(500).json({ error: \"Failed to fetch attendance records\" });\n    }\n  });\n\n  app.get(\"/api/attendance/today/:employeeId\", async (req: TenantRequest, res) => {\n    try {\n      const employeeId = parseInt(req.params.employeeId);\n      const tenantDb = await getTenantDatabase(req);\n      const record = await storage.getTodayAttendance(employeeId, tenantDb);\n      res.json(record);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch today's attendance\" });\n    }\n  });\n\n  app.post(\"/api/attendance/clock-in\", async (req: TenantRequest, res) => {\n    try {\n      const { employeeId, notes } = req.body;\n\n      if (!employeeId) {\n        return res.status(400).json({ message: \"Employee ID is required\" });\n      }\n\n      const tenantDb = await getTenantDatabase(req);\n      const record = await storage.clockIn(parseInt(employeeId), notes, tenantDb);\n      res.status(201).json(record);\n    } catch (error) {\n      console.error(\"Clock-in API error:\", error);\n\n      let statusCode = 500;\n      let message = \"Failed to clock in\";\n\n      if (error instanceof Error) {\n        if (error.message.includes('not found')) {\n          statusCode = 404;\n          message = error.message;\n        } else if (error.message.includes('already clocked in')) {\n          statusCode = 400;\n          message = error.message;\n        } else if (error.message.includes('database')) {\n          message = \"Database error occurred\";\n        }\n      }\n\n      res.status(statusCode).json({\n        message,\n        error: error instanceof Error ? error.message : \"Unknown error\"\n      });\n    }\n  });\n\n  app.post(\"/api/attendance/clock-out/:id\", async (req: TenantRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const tenantDb = await getTenantDatabase(req);\n      const record = await storage.clockOut(id, tenantDb);\n\n      if (!record) {\n        return res.status(404).json({ message: \"Attendance record not found\" });\n      }\n\n      res.json(record);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to clock out\" });\n    }\n  });\n\n  app.post(\"/api/attendance/break-start/:id\", async (req: TenantRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const tenantDb = await getTenantDatabase(req);\n      const record = await storage.startBreak(id, tenantDb);\n\n      if (!record) {\n        return res.status(404).json({ message: \"Attendance record not found\" });\n      }\n\n      res.json(record);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to start break\" });\n    }\n  });\n\n  app.post(\"/api/attendance/break-end/:id\", async (req: TenantRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const tenantDb = await getTenantDatabase(req);\n      const record = await storage.endBreak(id, tenantDb);\n\n      if (!record) {\n        return res.status(404).json({ message: \"Attendance record not found\" });\n      }\n\n      res.json(record);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to end break\" });\n    }\n  });\n\n  app.put(\"/api/attendance/:id/status\", async (req: TenantRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const { status } = req.body;\n      const tenantDb = await getTenantDatabase(req);\n      const record = await storage.updateAttendanceStatus(id, status, tenantDb);\n\n      if (!record) {\n        return res.status(404).json({ message: \"Attendance record not found\" });\n      }\n\n      res.json(record);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update attendance status\" });\n    }\n  });\n\n  // Tables\n  app.get(\"/api/tables\", async (req: TenantRequest, res) => {\n    try {\n      const tenantDb = await getTenantDatabase(req);\n      const tables = await storage.getTables(tenantDb);\n      res.json(tables);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch tables\" });\n    }\n  });\n\n  app.get(\"/api/tables/:id\", async (req: TenantRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const tenantDb = await getTenantDatabase(req);\n      const table = await storage.getTable(id, tenantDb);\n\n      if (!table) {\n        return res.status(404).json({ message: \"Table not found\" });\n      }\n\n      res.json(table);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch table\" });\n    }\n  });\n\n  app.post(\"/api/tables\", async (req: TenantRequest, res) => {\n    try {\n      const tableData = insertTableSchema.parse(req.body);\n      const tenantDb = await getTenantDatabase(req);\n      const table = await storage.createTable(tableData, tenantDb);\n      res.status(201).json(table);\n    } catch (error) {\n      res.status(400).json({ message: \"Failed to create table\" });\n    }\n  });\n\n  app.put(\"/api/tables/:id\", async (req: TenantRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const tableData = insertTableSchema.partial().parse(req.body);\n      const tenantDb = await getTenantDatabase(req);\n      const table = await storage.updateTable(id, tableData, tenantDb);\n\n      if (!table) {\n        return res.status(404).json({ message: \"Table not found\" });\n      }\n\n      res.json(table);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update table\" });\n    }\n  });\n\n  app.put(\"/api/tables/:id/status\", async (req: TenantRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const { status } = req.body;\n      const tenantDb = await getTenantDatabase(req);\n      const table = await storage.updateTableStatus(id, status, tenantDb);\n\n      if (!table) {\n        return res.status(404).json({ message: \"Table not found\" });\n      }\n\n      res.json(table);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update table status\" });\n    }\n  });\n\n  app.delete(\"/api/tables/:id\", async (req: TenantRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const tenantDb = await getTenantDatabase(req);\n      const deleted = await storage.deleteTable(id, tenantDb);\n\n      if (!deleted) {\n        return res.status(404).json({ message: \"Table not found\" });\n      }\n\n      res.json({ message: \"Table deleted successfully\" });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete table\" });\n    }\n  });\n\n  // Orders\n  app.get(\"/api/orders\", async (req: TenantRequest, res) => {\n    try {\n      const { tableId, status } = req.query;\n      const tenantDb = await getTenantDatabase(req);\n      const orders = await storage.getOrders(\n        tableId ? parseInt(tableId as string) : undefined,\n        status as string,\n        tenantDb,\n      );\n      res.json(orders);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch orders\" });\n    }\n  });\n\n  app.get(\"/api/orders/:id\", async (req: TenantRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const tenantDb = await getTenantDatabase(req);\n      const order = await storage.getOrder(id, tenantDb);\n\n      if (!order) {\n        return res.status(404).json({ message: \"Order not found\" });\n      }\n\n      const items = await storage.getOrderItems(id, tenantDb);\n      res.json({ ...order,\n        items\n      });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch order\" });\n    }\n  });\n\n  app.post(\"/api/orders\", async (req: TenantRequest, res) => {\n    try {\n      const { order, items } = req.body;\n      const tenantDb = await getTenantDatabase(req);\n      console.log(\n        \"Received order data:\",\n        JSON.stringify({ order, items }, null, 2),\n      );\n\n      const orderData = insertOrderSchema.parse(order);\n      const itemsData = items.map((item: any) =>\n        insertOrderItemSchema.parse(item),\n      );\n\n      console.log(\n        \"Parsed order data:\",\n        JSON.stringify({ orderData, itemsData }, null, 2),\n      );\n\n      const newOrder = await storage.createOrder(orderData, itemsData, tenantDb);\n\n      // Verify items were created\n      const createdItems = await storage.getOrderItems(newOrder.id, tenantDb);\n      console.log(\n        `Created ${createdItems.length} items for order ${newOrder.id}:`,\n        createdItems,\n      );\n\n      res.status(201).json(newOrder);\n    } catch (error) {\n      console.error(\"Order creation error:\", error);\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({\n          message: \"Invalid order data\",\n          errors: error.errors,\n          details: error.format(),\n        });\n      }\n      res.status(500).json({\n        message: \"Failed to create order\",\n        error: error instanceof Error ? error.message : String(error),\n      });\n    }\n  });\n\n  app.put(\"/api/orders/:id/status\", async (req: TenantRequest, res) => {\n    console.log('=== API ORDER STATUS UPDATE DEBUG START ===');\n    \n    try {\n      const id = parseInt(req.params.id);\n      const { status } = req.body;\n      const tenantDb = await getTenantDatabase(req);\n\n      console.log(`📋 API: Order status update called:`, {\n        requestedOrderId: req.params.id,\n        parsedOrderId: id,\n        newStatus: status,\n        requestMethod: req.method,\n        requestUrl: req.url,\n        requestPath: req.path,\n        contentType: req.headers['content-type'],\n        userAgent: req.headers['user-agent'],\n        fullBody: req.body,\n        tenantDbExists: !!tenantDb,\n        timestamp: new Date().toISOString()\n      });\n\n      // Validation checks with detailed logging\n      if (isNaN(id)) {\n        console.error(`❌ API: Order ID validation failed:`, {\n          originalValue: req.params.id,\n          parsedValue: id,\n          isNaN: isNaN(id),\n          type: typeof req.params.id\n        });\n        return res.status(400).json({ message: \"Invalid order ID\" });\n      }\n\n      if (!status) {\n        console.error(`❌ API: Status validation failed:`, {\n          statusValue: status,\n          statusType: typeof status,\n          fullBody: req.body,\n          bodyKeys: Object.keys(req.body || {})\n        });\n        return res.status(400).json({ message: \"Status is required\" });\n      }\n\n      console.log(`✅ API: Validation passed, proceeding with order ${id} status update to ${status}`);\n\n      // Get current order state with detailed logging\n      console.log(`🔍 API: Fetching current order from database...`);\n      const [currentOrder] = await db\n        .select()\n        .from(orders)\n        .where(eq(orders.id, id));\n\n      if (!currentOrder) {\n        console.error(`❌ API: Order not found in database:`, {\n          searchedId: id,\n          timestamp: new Date().toISOString()\n        });\n\n        // Debug: Try to find similar orders\n        console.log(`🔍 API: Searching for orders with similar IDs...`);\n        try {\n          const similarOrders = await db\n            .select({ id: orders.id, orderNumber: orders.orderNumber, status: orders.status })\n            .from(orders)\n            .limit(10);\n          console.log(`🔍 API: Found ${similarOrders.length} orders in database:`, similarOrders);\n        } catch (debugError) {\n          console.error(`❌ API: Error during debug search:`, debugError);\n        }\n\n        return res.status(404).json({ message: \"Order not found\" });\n      }\n\n      console.log(`📊 API: Current order found:`, {\n        orderId: currentOrder.id,\n        orderNumber: currentOrder.orderNumber,\n        tableId: currentOrder.tableId,\n        currentStatus: currentOrder.status,\n        requestedStatus: status,\n        orderedAt: currentOrder.orderedAt,\n        paidAt: currentOrder.paidAt,\n        einvoiceStatus: currentOrder.einvoiceStatus,\n        paymentMethod: currentOrder.paymentMethod\n      });\n\n      // Call storage layer with detailed logging\n      console.log(`🔍 API: Calling storage.updateOrderStatus...`);\n      const order = await storage.updateOrderStatus(id, status, tenantDb);\n\n      console.log(`🔍 API: Storage layer response:`, {\n        orderReturned: !!order,\n        orderData: order ? {\n          id: order.id,\n          status: order.status,\n          paidAt: order.paidAt,\n          updatedAt: order.updatedAt\n        } : null\n      });\n\n      if (!order) {\n        console.error(`❌ API: Storage layer returned null for order ${id}`);\n        return res.status(500).json({ \n          message: \"Failed to update order status\",\n          orderId: id,\n          requestedStatus: status,\n          storageLayerResult: 'null'\n        });\n      }\n\n      console.log(`✅ API: Order status updated successfully:`, {\n        orderId: order.id,\n        orderNumber: order.orderNumber,\n        tableId: order.tableId,\n        previousStatus: currentOrder.status,\n        newStatus: order.status,\n        paymentMethod: order.paymentMethod,\n        paidAt: order.paidAt,\n        einvoiceStatus: order.einvoiceStatus,\n        updatedAt: order.updatedAt,\n        timestamp: new Date().toISOString()\n      });\n\n      // Table status logging for paid orders\n      if (status === 'paid' && order.tableId) {\n        console.log(`💳 API: Order marked as PAID - checking table ${order.tableId} status...`);\n        \n        try {\n          const [tableAfterUpdate] = await db\n            .select()\n            .from(tables)\n            .where(eq(tables.id, order.tableId));\n\n          console.log(`📋 API: Table status after payment:`, {\n            tableId: order.tableId,\n            tableNumber: tableAfterUpdate?.tableNumber,\n            tableStatus: tableAfterUpdate?.status,\n            timestamp: new Date().toISOString()\n          });\n\n          // Log all orders on this table for debugging\n          const allTableOrders = await db\n            .select({\n              id: orders.id,\n              orderNumber: orders.orderNumber,\n              status: orders.status,\n              total: orders.total\n            })\n            .from(orders)\n            .where(eq(orders.tableId, order.tableId));\n\n          console.log(`📋 API: All orders on table ${order.tableId}:`, {\n            tableId: order.tableId,\n            totalOrders: allTableOrders.length,\n            orders: allTableOrders.map(o => ({\n              id: o.id,\n              orderNumber: o.orderNumber,\n              status: o.status,\n              total: o.total\n            }))\n          });\n        } catch (tableCheckError) {\n          console.error(`❌ API: Error checking table status:`, tableCheckError);\n        }\n      }\n\n      // Comprehensive response\n      const responseData = {\n        ...order,\n        updated: true,\n        previousStatus: currentOrder.status,\n        updateTimestamp: new Date().toISOString(),\n        success: true\n      };\n\n      console.log(`📤 API: Sending response:`, responseData);\n      res.json(responseData);\n\n    } catch (error) {\n      console.error('=== API ORDER STATUS UPDATE ERROR ===');\n      console.error(`❌ API Error details:`, {\n        errorType: error?.constructor?.name,\n        errorMessage: error?.message,\n        errorStack: error?.stack,\n        requestParams: req.params,\n        requestBody: req.body,\n        timestamp: new Date().toISOString()\n      });\n\n      res.status(500).json({ \n        message: \"Failed to update order status\",\n        error: error instanceof Error ? error.message : String(error),\n        timestamp: new Date().toISOString(),\n        requestId: req.params.id\n      });\n    }\n\n    console.log('=== API ORDER STATUS UPDATE DEBUG END ===');\n  });\n\n  app.post(\"/api/orders/:id/payment\", async (req: TenantRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const { paymentMethod, amountReceived, change } = req.body;\n      const tenantDb = await getTenantDatabase(req);\n\n      console.log(`💳 Payment completion API called - Order ID: ${id}, Payment Method: ${paymentMethod}`);\n\n      // Update order with payment details and status\n      const updateData = {\n        status: \"paid\",\n        paymentMethod,\n        paidAt: new Date().toISOString(),\n      };\n\n      // Add cash payment specific data if provided\n      if (amountReceived !== undefined) {\n        updateData.amountReceived = amountReceived;\n      }\n      if (change !== undefined) {\n        updateData.change = change;\n      }\n\n      console.log(`📤 Updating order with payment data:`, updateData);\n\n      const order = await storage.updateOrder(id, updateData, tenantDb);\n\n      if (!order) {\n        console.error(`❌ Order not found for payment completion: ${id}`);\n        return res.status(404).json({ message: \"Order not found\" });\n      }\n\n      console.log(`✅ Payment completed successfully for order:`, order);\n\n      res.json({\n        ...order,\n        paymentMethod,\n        amountReceived,\n        change\n      });\n    } catch (error) {\n      console.error(\"❌ Payment completion error:\", error);\n      res.status(500).json({ \n        message: \"Failed to complete payment\",\n        error: error instanceof Error ? error.message : String(error)\n      });\n    }\n  });\n\n  // Get order items for a specific order\n  app.get('/api/order-items/:orderId', async (req: TenantRequest, res) => {\n    try {\n      console.log('=== GET ORDER ITEMS API CALLED ===');\n      const orderId = parseInt(req.params.orderId);\n      const tenantDb = await getTenantDatabase(req);\n      console.log('Order ID requested:', orderId);\n\n      if (isNaN(orderId)) {\n        console.error('Invalid order ID provided:', req.params.orderId);\n        return res.status(400).json({ message: \"Invalid order ID\" });\n      }\n\n      console.log('Fetching order items from storage...');\n      const items = await storage.getOrderItems(orderId, tenantDb);\n      console.log(`Found ${items.length} order items:`, items);\n\n      res.json(items);\n    } catch (error) {\n      console.error('=== GET ORDER ITEMS ERROR ===');\n      console.error(\"Error type:\", error.constructor.name);\n      console.error(\"Error message:\", error.message);\n      console.error(\"Error stack:\", error.stack);\n      console.error(\"Order ID:\", req.params.orderId);\n\n      res.status(500).json({\n        message: \"Failed to fetch order items\",\n        details: error.message,\n        timestamp: new Date().toISOString(),\n      });\n    }\n  });\n\n  // Delete a specific order item\n  app.delete('/api/order-items/:itemId', async (req: TenantRequest, res) => {\n    try {\n      console.log('=== DELETE ORDER ITEM API CALLED ===');\n      const itemId = parseInt(req.params.itemId);\n      const tenantDb = await getTenantDatabase(req); // Assuming tenantDb is needed here as well\n      console.log('Item ID requested:', itemId);\n\n      if (isNaN(itemId)) {\n        return res.status(400).json({ error: 'Invalid item ID' });\n      }\n\n      console.log('Deleting order item from storage...');\n      const success = await storage.deleteOrderItem(itemId, tenantDb); // Pass tenantDb to storage function\n\n      if (success) {\n        console.log('Order item deleted successfully');\n        res.json({ success: true, message: 'Order item deleted successfully' });\n      } else {\n        console.log('Order item not found');\n        res.status(404).json({ error: 'Order item not found' });\n      }\n    } catch (error) {\n      console.error('=== DELETE ORDER ITEM ERROR ===');\n      console.error('Error type:', error.constructor.name);\n      console.error('Error message:', error.message);\n      console.error('Error stack:', error.stack);\n      console.error('Item ID:', req.params.itemId);\n      res.status(500).json({\n        error: 'Failed to delete order item',\n        details: error instanceof Error ? error.message : 'Unknown error',\n        timestamp: new Date().toISOString(),\n      });\n    }\n  });\n\n  // Add order items to existing order\n  app.post(\"/api/orders/:orderId/items\", async (req: TenantRequest, res) => {\n    try {\n      console.log(\"=== ADD ORDER ITEMS API CALLED ===\");\n      const orderId = parseInt(req.params.orderId);\n      const { items } = req.body;\n      const tenantDb = await getTenantDatabase(req);\n\n      console.log(\"Request params:\", req.params);\n      console.log(\"Order ID:\", orderId);\n      console.log(\"Request body:\", JSON.stringify(req.body, null, 2));\n      console.log(\"Items to add:\", JSON.stringify(items, null, 2));\n\n      if (!orderId || isNaN(orderId)) {\n        console.error(\"Invalid order ID:\", req.params.orderId);\n        return res.status(400).json({ error: \"Invalid order ID\" });\n      }\n\n      if (!items || !Array.isArray(items) || items.length === 0) {\n        console.error(\"Invalid items data:\", items);\n        return res\n          .status(400)\n          .json({ error: \"Items array is required and cannot be empty\" });\n      }\n\n      // Check if order exists\n      const [existingOrder] = await db\n        .select()\n        .from(orders)\n        .where(eq(orders.id, orderId));\n\n      if (!existingOrder) {\n        console.error(\"Order not found:\", orderId);\n        return res.status(404).json({ error: \"Order not found\" });\n      }\n\n      console.log(\"Found existing order:\", existingOrder);\n\n      const createdItems = [];\n      for (let i = 0; i < items.length; i++) {\n        const item = items[i];\n        console.log(`Processing item ${i + 1}/${items.length}:`, item);\n\n        // Validate item data\n        if (\n          !item.productId ||\n          !item.quantity ||\n          !item.unitPrice ||\n          !item.total\n        ) {\n          console.error(\"Missing required item data:\", item);\n          throw new Error(`Item ${i + 1} is missing required fields`);\n        }\n\n        // Get product info to include in the order item\n        const [product] = await db\n          .select()\n          .from(products)\n          .where(eq(products.id, item.productId));\n\n        if (!product) {\n          console.error(\"Product not found:\", item.productId);\n          throw new Error(`Product with ID ${item.productId} not found`);\n        }\n\n        console.log(\"Found product:\", product);\n\n        try {\n          const [orderItem] = await db\n            .insert(orderItems)\n            .values({\n              orderId,\n              productId: item.productId,\n              quantity: item.quantity,\n              unitPrice: item.unitPrice,\n              total: item.total,\n              notes: item.notes || null,\n            })\n            .returning();\n\n          console.log(\"Created order item:\", orderItem);\n          createdItems.push(orderItem);\n        } catch (insertError) {\n          console.error(\"Error inserting order item:\", insertError);\n          throw insertError;\n        }\n      }\n\n      console.log(`Successfully created ${createdItems.length} items`);\n\n      // Update order total\n      try {\n        const [orderItemsSum] = await db\n          .select({\n            total: sql < number > `COALESCE(sum(CAST(${orderItems.total} AS DECIMAL)), 0)`,\n          })\n          .from(orderItems)\n          .where(eq(orderItems.orderId, orderId));\n\n        console.log(\"Order items sum result:\", orderItemsSum);\n\n        const totalAmount = Number(orderItemsSum.total) || 0;\n        const subtotalAmount = totalAmount / 1.1; // Remove 10% tax\n        const taxAmount = totalAmount - subtotalAmount;\n\n        console.log(\"Calculated amounts:\", {\n          total: totalAmount,\n          subtotal: subtotalAmount,\n          tax: taxAmount,\n        });\n\n        await db\n          .update(orders)\n          .set({\n            total: totalAmount.toFixed(2),\n            subtotal: subtotalAmount.toFixed(2),\n            tax: taxAmount.toFixed(2),\n          })\n          .where(eq(orders.id, orderId));\n\n        console.log(\"Updated order totals successfully\");\n      } catch (updateError) {\n        console.error(\"Error updating order totals:\", updateError);\n        // Don't throw here, as items were already created successfully\n      }\n\n      console.log(\"=== ADD ORDER ITEMS COMPLETED SUCCESSFULLY ===\");\n      res.json(createdItems);\n    } catch (error) {\n      console.error(\"=== ADD ORDER ITEMS ERROR ===\");\n      console.error(\"Error type:\", error.constructor.name);\n      console.error(\"Error message:\", error.message);\n      console.error(\"Error stack:\", error.stack);\n      console.error(\"Request data:\", {\n        orderId: req.params.orderId,\n        body: req.body,\n      });\n\n      res.status(500).json({\n        error: \"Failed to add items to order\",\n        details: error.message,\n        timestamp: new Date().toISOString(),\n      });\n    }\n  });\n\n  // Inventory Management\n  app.post(\"/api/inventory/update-stock\", async (req: TenantRequest, res) => {\n    try {\n      const { productId, quantity, type, notes, trackInventory } = req.body;\n      const tenantDb = await getTenantDatabase(req);\n\n      // Get current product\n      const [product] = await db\n        .select()\n        .from(products)\n        .where(eq(products.id, productId))\n        .limit(1);\n      if (!product) {\n        return res.status(404).json({ error: \"Product not found\" });\n      }\n\n      let newStock = product.stock;\n      switch (type) {\n        case \"add\":\n          newStock += quantity;\n          break;\n        case \"subtract\":\n          newStock = Math.max(0, product.stock - quantity);\n          break;\n        case \"set\":\n          newStock = quantity;\n          break;\n      }\n\n      // Update product stock and trackInventory\n      const updateData: any = { stock: newStock };\n      if (trackInventory !== undefined) {\n        updateData.trackInventory = trackInventory;\n      }\n\n      await db\n        .update(products)\n        .set(updateData)\n        .where(eq(products.id, productId));\n\n      // Create inventory transaction record\n      await db.insert(inventoryTransactions).values({\n        productId,\n        type,\n        quantity,\n        previousStock: product.stock,\n        newStock,\n        notes: notes || null,\n        createdAt: new Date().toISOString(),\n      });\n\n      res.json({ success: true, newStock });\n    } catch (error) {\n      console.error(\"Stock update error:\", error);\n      res.status(500).json({ error: \"Failed to update stock\" });\n    }\n  });\n\n  // Store Settings\n  app.get(\"/api/store-settings\", async (req: TenantRequest, res) => {\n    try {\n      const tenantDb = await getTenantDatabase(req);\n      const settings = await storage.getStoreSettings(tenantDb);\n      res.json(settings);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch store settings\" });\n    }\n  });\n\n  app.put(\"/api/store-settings\", async (req: TenantRequest, res) => {\n    try {\n      const validatedData = insertStoreSettingsSchema.partial().parse(req.body);\n      const tenantDb = await getTenantDatabase(req);\n      const settings = await storage.updateStoreSettings(validatedData, tenantDb);\n      res.json(settings);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({\n          message: \"Invalid store settings data\",\n          errors: error.errors,\n        });\n      }\n      res.status(500).json({ message: \"Failed to update store settings\" });\n    }\n  });\n\n  // Suppliers\n  app.get(\"/api/suppliers\", async (req: TenantRequest, res) => {\n    try {\n      const { status, search } = req.query;\n      const tenantDb = await getTenantDatabase(req);\n      let suppliers;\n\n      if (search) {\n        suppliers = await storage.searchSuppliers(search as string, tenantDb);\n      } else if (status && status !== \"all\") {\n        suppliers = await storage.getSuppliersByStatus(status as string, tenantDb);\n      } else {\n        suppliers = await storage.getSuppliers(tenantDb);\n      }\n\n      res.json(suppliers);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch suppliers\" });\n    }\n  });\n\n  app.get(\"/api/suppliers/:id\", async (req: TenantRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const tenantDb = await getTenantDatabase(req);\n      const supplier = await storage.getSupplier(id, tenantDb);\n\n      if (!supplier) {\n        return res.status(404).json({ message: \"Supplier not found\" });\n      }\n\n      res.json(supplier);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch supplier\" });\n    }\n  });\n\n  app.post(\"/api/suppliers\", async (req: TenantRequest, res) => {\n    try {\n      const validatedData = insertSupplierSchema.parse(req.body);\n      const tenantDb = await getTenantDatabase(req);\n      const supplier = await storage.createSupplier(validatedData, tenantDb);\n      res.status(201).json(supplier);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res\n          .status(400)\n          .json({ message: \"Invalid supplier data\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to create supplier\" });\n    }\n  });\n\n  app.put(\"/api/suppliers/:id\", async (req: TenantRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const validatedData = insertSupplierSchema.partial().parse(req.body);\n      const tenantDb = await getTenantDatabase(req);\n      const supplier = await storage.updateSupplier(id, validatedData, tenantDb);\n\n      if (!supplier) {\n        return res.status(404).json({ message: \"Supplier not found\" });\n      }\n\n      res.json(supplier);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res\n          .status(400)\n          .json({ message: \"Invalid supplier data\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to update supplier\" });\n    }\n  });\n\n  app.delete(\"/api/suppliers/:id\", async (req: TenantRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const tenantDb = await getTenantDatabase(req);\n      const deleted = await storage.deleteSupplier(id, tenantDb);\n\n      if (!deleted) {\n        return res.status(404).json({ message: \"Supplier not found\" });\n      }\n\n      res.json({ message: \"Supplier deleted successfully\" });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete supplier\" });\n    }\n  });\n\n  // Get next customer ID\n  app.get(\"/api/customers/next-id\", async (req: TenantRequest, res) => {\n    try {\n      const tenantDb = await getTenantDatabase(req);\n      const nextId = await storage.getNextCustomerId(tenantDb);\n      res.json({ nextId });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to generate customer ID\" });\n    }\n  });\n\n  // Customer management routes - Added Here\n  app.get(\"/api/customers\", async (req: TenantRequest, res) => {\n    try {\n      const tenantDb = await getTenantDatabase(req);\n      const customers = await storage.getCustomers(tenantDb);\n      res.json(customers);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch customers\" });\n    }\n  });\n\n  app.get(\"/api/customers/:id\", async (req: TenantRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const tenantDb = await getTenantDatabase(req);\n      const customer = await storage.getCustomer(id, tenantDb);\n      if (!customer) {\n        return res.status(404).json({ message: \"Customer not found\" });\n      }\n      res.json(customer);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch customer\" });\n    }\n  });\n\n  // Create customer\n  app.post(\"/api/customers\", async (req: TenantRequest, res) => {\n    try {\n      const tenantDb = await getTenantDatabase(req);\n\n      // Validate required fields\n      if (!req.body.name) {\n        return res.status(400).json({ message: \"Customer name is required\" });\n      }\n\n      // Prepare customer data with proper defaults\n      const customerData = {\n        ...req.body,\n        customerId: req.body.customerId || undefined,\n        phone: req.body.phone || null,\n        email: req.body.email || null,\n        address: req.body.address || null,\n        dateOfBirth: req.body.dateOfBirth || null,\n        membershipLevel: req.body.membershipLevel || \"Silver\",\n        notes: req.body.notes || null,\n        status: req.body.status || \"active\",\n        totalSpent: \"0\",\n        pointsBalance: 0,\n      };\n\n      const [customer] = await db.insert(customers).values(customerData).returning();\n      res.json(customer);\n    } catch (error: any) {\n      console.error(\"Error creating customer:\", error);\n\n      // Handle specific database errors\n      if (error.code === 'SQLITE_CONSTRAINT') {\n        return res.status(400).json({\n          message: \"Customer with this ID already exists\"\n        });\n      }\n\n      res.status(500).json({\n        message: \"Failed to create customer\",\n        error: error.message\n      });\n    }\n  });\n\n  app.put(\"/api/customers/:id\", async (req: TenantRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const customerData = req.body;\n      const tenantDb = await getTenantDatabase(req);\n      const customer = await storage.updateCustomer(id, customerData, tenantDb);\n      if (!customer) {\n        return res.status(404).json({ message: \"Customer not found\" });\n      }\n      res.json(customer);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res\n          .status(400)\n          .json({ message: \"Invalid customer data\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to update customer\" });\n    }\n  });\n\n  app.delete(\"/api/customers/:id\", async (req: TenantRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const tenantDb = await getTenantDatabase(req);\n      const deleted = await storage.deleteCustomer(id, tenantDb);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Customer not found\" });\n      }\n      res.json({ message: \"Customer deleted successfully\" });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete customer\" });\n    }\n  });\n\n  app.post(\"/api/customers/:id/visit\", async (req: TenantRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const { amount, points } = req.body;\n      const tenantDb = await getTenantDatabase(req);\n\n      const customer = await storage.getCustomer(id, tenantDb);\n      if (!customer) {\n        return res.status(404).json({ message: \"Customer not found\" });\n      }\n\n      const updatedCustomer = await storage.updateCustomerVisit(\n        id,\n        amount,\n        points,\n        tenantDb,\n      );\n      res.json(updatedCustomer);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update customer visit\" });\n    }\n  });\n\n  // Point Management API\n  app.get(\"/api/customers/:id/points\", async (req: TenantRequest, res) => {\n    try {\n      const customerId = parseInt(req.params.id);\n      const tenantDb = await getTenantDatabase(req);\n      const pointsData = await storage.getCustomerPoints(customerId, tenantDb);\n\n      if (!pointsData) {\n        return res.status(404).json({ message: \"Customer not found\" });\n      }\n\n      res.json(pointsData);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch customer points\" });\n    }\n  });\n\n  app.post(\"/api/customers/:id/points\", async (req: TenantRequest, res) => {\n    try {\n      const customerId = parseInt(req.params.id);\n      const pointUpdateSchema = z.object({\n        points: z.number().int().min(1),\n        description: z.string().min(1),\n        type: z.enum([\"earned\", \"redeemed\", \"adjusted\"]),\n        employeeId: z.number().optional(),\n        orderId: z.number().optional(),\n      });\n\n      const { points, description, type, employeeId, orderId } =\n        pointUpdateSchema.parse(req.body);\n      const tenantDb = await getTenantDatabase(req);\n\n      const pointTransaction = await storage.updateCustomerPoints(\n        customerId,\n        points,\n        description,\n        type,\n        employeeId,\n        orderId,\n        tenantDb,\n      );\n\n      res.status(201).json(pointTransaction);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({\n          message: \"Invalid point update data\",\n          errors: error.errors,\n        });\n      }\n      if (error instanceof Error && error.message === \"Customer not found\") {\n        return res.status(404).json({ message: \"Customer not found\" });\n      }\n      if (\n        error instanceof Error &&\n        error.message === \"Insufficient points balance\"\n      ) {\n        return res.status(400).json({ message: \"Insufficient points balance\" });\n      }\n      res.status(500).json({ message: \"Failed to update customer points\" });\n    }\n  });\n\n  app.get(\"/api/customers/:id/point-history\", async (req: TenantRequest, res) => {\n    try {\n      const customerId = parseInt(req.params.id);\n      const limit = parseInt(req.query.limit as string) || 50;\n      const tenantDb = await getTenantDatabase(req);\n\n      const pointHistory = await storage.getPointHistory(customerId, limit, tenantDb);\n      res.json(pointHistory);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch point history\" });\n    }\n  });\n\n  // New endpoints for points management modal\n  app.post(\"/api/customers/adjust-points\", async (req: TenantRequest, res) => {\n    try {\n      const pointUpdateSchema = z.object({\n        customerId: z.number().int().min(1),\n        points: z.number().int(),\n        type: z.enum([\"earned\", \"redeemed\", \"adjusted\"]),\n        description: z.string().min(1),\n      });\n\n      const { customerId, points, type, description } = pointUpdateSchema.parse(\n        req.body,\n      );\n      const tenantDb = await getTenantDatabase(req);\n\n      const pointTransaction = await storage.updateCustomerPoints(\n        customerId,\n        points,\n        description,\n        type,\n        undefined, // employeeId is optional and not provided here\n        undefined, // orderId is optional and not provided here\n        tenantDb,\n      );\n\n      res.status(201).json(pointTransaction);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({\n          message: \"Invalid point adjustment data\",\n          errors: error.errors,\n        });\n      }\n      if (error instanceof Error && error.message === \"Customer not found\") {\n        return res.status(404).json({ message: \"Customer not found\" });\n      }\n      if (\n        error instanceof Error &&\n        error.message === \"Insufficient points balance\"\n      ) {\n        return res.status(400).json({ message: \"Insufficient points balance\" });\n      }\n      res.status(500).json({ message: \"Failed to adjust customer points\" });\n    }\n  });\n\n  app.post(\"/api/customers/redeem-points\", async (req: TenantRequest, res) => {\n    try {\n      const redeemSchema = z.object({\n        customerId: z.number().int().min(1),\n        points: z.number().int().min(1),\n      });\n\n      const { customerId, points } = redeemSchema.parse(req.body);\n      const tenantDb = await getTenantDatabase(req);\n\n      const pointTransaction = await storage.updateCustomerPoints(\n        customerId,\n        -points,\n        \"포인트 결제 사용\",\n        \"redeemed\",\n        undefined, // employeeId is optional\n        undefined, // orderId is optional\n        tenantDb,\n      );\n\n      res.status(201).json(pointTransaction);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({\n          message: \"Invalid point redemption data\",\n          errors: error.errors,\n        });\n      }\n      if (error instanceof Error && error.message === \"Customer not found\") {\n        return res.status(404).json({ message: \"Customer not found\" });\n      }\n      if (\n        error instanceof Error &&\n        error.message === \"Insufficient points balance\"\n      ) {\n        return res.status(400).json({ message: \"Insufficient points balance\" });\n      }\n      res.status(500).json({ message: \"Failed to redeem customer points\" });\n    }\n  });\n\n  app.get(\"/api/point-transactions\", async (req: TenantRequest, res) => {\n    try {\n      const limit = parseInt(req.query.limit as string) || 100;\n      const tenantDb = await getTenantDatabase(req);\n      // For now, get all point transactions across all customers\n      // In a real app, you might want to add pagination and filtering\n      const allTransactions = await storage.getAllPointTransactions(limit, tenantDb);\n      res.json(allTransactions);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch point transactions\" });\n    }\n  });\n\n  // Membership thresholds management\n  app.get(\"/api/membership-thresholds\", async (req: TenantRequest, res) => {\n    try {\n      const tenantDb = await getTenantDatabase(req);\n      const thresholds = await storage.getMembershipThresholds(tenantDb);\n      res.json(thresholds);\n    } catch (error) {\n      res\n        .status(500)\n        .json({ message: \"Failed to fetch membership thresholds\" });\n    }\n  });\n\n  app.put(\"/api/membership-thresholds\", async (req: TenantRequest, res) => {\n    try {\n      const thresholdSchema = z.object({\n        GOLD: z.number().min(0),\n        VIP: z.number().min(0),\n      });\n\n      const validatedData = thresholdSchema.parse(req.body);\n      const tenantDb = await getTenantDatabase(req);\n      const thresholds =\n        await storage.updateMembershipThresholds(validatedData, tenantDb);\n\n      res.json(thresholds);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({\n          message: \"Invalid threshold data\",\n          errors: error.errors,\n        });\n      }\n      res\n        .status(500)\n        .json({ message: \"Failed to update membership thresholds\" });\n    }\n  });\n\n  // Supplier Reports APIs\n  app.get(\"/api/supplier-debts\", async (req: TenantRequest, res) => {\n    try {\n      const { startDate, endDate, supplierId } = req.query;\n      const tenantDb = await getTenantDatabase(req);\n\n      // Mock data for supplier debts - replace with actual database queries\n      const supplierDebts = [\n        {\n          id: 1,\n          supplierCode: \"SUP001\",\n          supplierName: \"Nhà cung cấp A\",\n          initialDebt: 500000,\n          newDebt: 300000,\n          payment: 200000,\n          finalDebt: 600000,\n          phone: \"010-1234-5678\",\n        },\n        {\n          id: 2,\n          supplierCode: \"SUP002\",\n          supplierName: \"Nhà cung cấp B\",\n          initialDebt: 800000,\n          newDebt: 400000,\n          payment: 300000,\n          finalDebt: 900000,\n          phone: \"010-2345-6789\",\n        },\n      ];\n\n      // Filter by supplier if specified\n      let filteredDebts = supplierDebts;\n      if (supplierId) {\n        filteredDebts = supplierDebts.filter(\n          (debt) => debt.id === parseInt(supplierId as string),\n        );\n      }\n\n      res.json(filteredDebts);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch supplier debts\" });\n    }\n  });\n\n  app.get(\"/api/supplier-purchases\", async (req: TenantRequest, res) => {\n    try {\n      const { startDate, endDate, supplierId } = req.query;\n      const tenantDb = await getTenantDatabase(req);\n\n      // Mock data for supplier purchases - replace with actual database queries\n      const supplierPurchases = [\n        {\n          id: 1,\n          supplierCode: \"SUP001\",\n          supplierName: \"Nhà cung cấp A\",\n          purchaseValue: 1500000,\n          paymentValue: 1200000,\n          netValue: 300000,\n          phone: \"010-1234-5678\",\n        },\n        {\n          id: 2,\n          supplierCode: \"SUP002\",\n          supplierName: \"Nhà cung cấp B\",\n          purchaseValue: 2000000,\n          paymentValue: 1700000,\n          netValue: 300000,\n          phone: \"010-2345-6789\",\n        },\n      ];\n\n      // Filter by supplier if specified\n      let filteredPurchases = supplierPurchases;\n      if (supplierId) {\n        filteredPurchases = supplierPurchases.filter(\n          (purchase) => purchase.id === parseInt(supplierId as string),\n        );\n      }\n\n      res.json(filteredPurchases);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch supplier purchases\" });\n    }\n  });\n\n  // Invoice templates management\n  app.get(\"/api/invoice-templates\", async (req: TenantRequest, res) => {\n    try {\n      const tenantDb = await getTenantDatabase(req);\n      const templates = await storage.getInvoiceTemplates(tenantDb);\n      res.json(templates);\n    } catch (error) {\n      console.error(\"Error fetching invoice templates:\", error);\n      res.status(500).json({ error: \"Failed to fetch invoice templates\" });\n    }\n  });\n\n  app.get(\"/api/invoice-templates/active\", async (req: TenantRequest, res) => {\n    try {\n      const tenantDb = await getTenantDatabase(req);\n      const activeTemplates = await storage.getActiveInvoiceTemplates();\n      res.json(activeTemplates);\n    } catch (error) {\n      console.error(\"Error fetching active invoice templates:\", error);\n      res.status(500).json({ error: \"Failed to fetch active invoice templates\" });\n    }\n  });\n\n  app.post(\"/api/invoice-templates\", async (req: TenantRequest, res) => {\n    try {\n      const templateData = req.body;\n      const tenantDb = await getTenantDatabase(req);\n      const template = await storage.createInvoiceTemplate(templateData, tenantDb);\n      res.status(201).json(template);\n    } catch (error) {\n      console.error(\"Invoice template creation error:\", error);\n      res.status(500).json({ message: \"Failed to create invoice template\" });\n    }\n  });\n\n  app.put(\"/api/invoice-templates/:id\", async (req: TenantRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const templateData = req.body;\n      const tenantDb = await getTenantDatabase(req);\n      const template = await storage.updateInvoiceTemplate(id, templateData, tenantDb);\n\n      if (!template) {\n        return res.status(404).json({ message: \"Invoice template not found\" });\n      }\n\n      res.json(template);\n    } catch (error) {\n      console.error(\"Invoice template update error:\", error);\n      res.status(500).json({ message: \"Failed to update invoice template\" });\n    }\n  });\n\n  app.delete(\"/api/invoice-templates/:id\", async (req: TenantRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const tenantDb = await getTenantDatabase(req);\n      const deleted = await storage.deleteInvoiceTemplate(id, tenantDb);\n\n      if (!deleted) {\n        return res.status(404).json({ message: \"Invoice template not found\" });\n      }\n\n      res.json({ message: \"Invoice template deleted successfully\" });\n    } catch (error) {\n      console.error(\"Invoice template deletion error:\", error);\n      res.status(500).json({ message: \"Failed to delete invoice template\" });\n    }\n  });\n\n  // E-invoice connections management\n  app.get(\"/api/einvoice-connections\", async (req: TenantRequest, res) => {\n    try {\n      const tenantDb = await getTenantDatabase(req);\n      const connections = await storage.getEInvoiceConnections(tenantDb);\n      res.json(connections);\n    } catch (error) {\n      res\n        .status(500)\n        .json({ message: \"Failed to fetch e-invoice connections\" });\n    }\n  });\n\n  app.post(\"/api/einvoice-connections\", async (req: TenantRequest, res) => {\n    try {\n      const connectionData = req.body;\n      const tenantDb = await getTenantDatabase(req);\n      const connection = await storage.createEInvoiceConnection(connectionData, tenantDb);\n      res.status(201).json(connection);\n    } catch (error) {\n      console.error(\"E-invoice connection creation error:\", error);\n      res\n        .status(500)\n        .json({ message: \"Failed to create e-invoice connection\" });\n    }\n  });\n\n  app.put(\"/api/einvoice-connections/:id\", async (req: TenantRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const connectionData = req.body;\n      const tenantDb = await getTenantDatabase(req);\n      const connection = await storage.updateEInvoiceConnection(\n        id,\n        connectionData,\n        tenantDb,\n      );\n\n      if (!connection) {\n        return res\n          .status(404)\n          .json({ message: \"E-invoice connection not found\" });\n      }\n\n      res.json(connection);\n    } catch (error) {\n      console.error(\"E-invoice connection update error:\", error);\n      res\n        .status(500)\n        .json({ message: \"Failed to update e-invoice connection\" });\n    }\n  });\n\n  app.delete(\"/api/einvoice-connections/:id\", async (req: TenantRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const tenantDb = await getTenantDatabase(req);\n      const deleted = await storage.deleteEInvoiceConnection(id, tenantDb);\n\n      if (!deleted) {\n        return res\n          .status(404)\n          .json({ message: \"E-invoice connection not found\" });\n      }\n\n      res.json({ message: \"E-invoice connection deleted successfully\" });\n    } catch (error) {\n      console.error(\"E-invoice connection deletion error:\", error);\n      res\n        .status(500)\n        .json({ message: \"Failed to delete e-invoice connection\" });\n    }\n  });\n\n  // Menu Analysis API\n  app.get('/api/menu-analysis', async (req, res) => {\n    try {\n      const { startDate, endDate, categoryId } = req.query;\n      const tenantDb = await getTenantDatabase(req);\n\n      console.log('Menu Analysis API called with params:', {\n        startDate,\n        endDate,\n        search: req.query.search,\n        categoryId,\n        productType: req.query.productType\n      });\n\n      console.log('Executing transaction and order queries...');\n\n      // Build date conditions\n      const dateConditions = [];\n      if (startDate && endDate) {\n        const startDateTime = new Date(startDate as string);\n        const endDateTime = new Date(endDate as string);\n        endDateTime.setHours(23, 59, 59, 999);\n        dateConditions.push(\n          gte(transactionsTable.createdAt, startDateTime),\n          lte(transactionsTable.createdAt, endDateTime)\n        );\n      } else if (startDate) {\n        const startDateTime = new Date(startDate as string);\n        dateConditions.push(gte(transactionsTable.createdAt, startDateTime));\n      } else if (endDate) {\n        const endDateTime = new Date(endDate as string);\n        endDateTime.setHours(23, 59, 59, 999);\n        dateConditions.push(lte(transactionsTable.createdAt, endDateTime));\n      }\n\n      // Build category conditions\n      const categoryConditions = [];\n      if (categoryId && categoryId !== 'all') {\n        categoryConditions.push(eq(products.categoryId, parseInt(categoryId as string)));\n      }\n\n      // Query transaction items with proper Drizzle ORM\n      const transactionResults = await db\n        .select({\n          productId: transactionItemsTable.productId,\n          productName: products.name,\n          categoryId: products.categoryId,\n          categoryName: categories.name,\n          totalQuantity: sql<number>`CAST(SUM(${transactionItemsTable.quantity}) AS INTEGER)`,\n          totalRevenue: sql<number>`CAST(SUM(CAST(${transactionItemsTable.unitPrice} AS DECIMAL(10,2)) * ${transactionItemsTable.quantity}) AS DECIMAL(10,2))`\n        })\n        .from(transactionItemsTable)\n        .innerJoin(transactionsTable, eq(transactionItemsTable.transactionId, transactionsTable.id))\n        .innerJoin(products, eq(transactionItemsTable.productId, products.id))\n        .leftJoin(categories, eq(products.categoryId, categories.id))\n        .where(and(...dateConditions, ...categoryConditions))\n        .groupBy(\n          transactionItemsTable.productId,\n          products.name,\n          products.categoryId,\n          categories.name\n        );\n\n      // Query order items with proper Drizzle ORM\n      const orderDateConditions = [];\n      if (startDate && endDate) {\n        const startDateTime = new Date(startDate as string);\n        const endDateTime = new Date(endDate as string);\n        endDateTime.setHours(23, 59, 59, 999);\n        orderDateConditions.push(\n          gte(orders.orderedAt, startDateTime),\n          lte(orders.orderedAt, endDateTime)\n        );\n      } else if (startDate) {\n        const startDateTime = new Date(startDate as string);\n        orderDateConditions.push(gte(orders.orderedAt, startDateTime));\n      } else if (endDate) {\n        const endDateTime = new Date(endDate as string);\n        endDateTime.setHours(23, 59, 59, 999);\n        orderDateConditions.push(lte(orders.orderedAt, endDateTime));\n      }\n\n      const orderResults = await db\n        .select({\n          productId: orderItems.productId,\n          productName: products.name,\n          categoryId: products.categoryId,\n          categoryName: categories.name,\n          totalQuantity: sql<number>`CAST(SUM(${orderItems.quantity}) AS INTEGER)`,\n          totalRevenue: sql<number>`CAST(SUM(CAST(${orderItems.unitPrice} AS DECIMAL(10,2)) * ${orderItems.quantity}) AS DECIMAL(10,2))`\n        })\n        .from(orderItems)\n        .innerJoin(orders, eq(orderItems.orderId, orders.id))\n        .innerJoin(products, eq(orderItems.productId, products.id))\n        .leftJoin(categories, eq(products.categoryId, categories.id))\n        .where(and(\n          ne(orders.status, 'cancelled'),\n          ...orderDateConditions,\n          ...categoryConditions\n        ))\n        .groupBy(\n          orderItems.productId,\n          products.name,\n          products.categoryId,\n          categories.name\n        );\n\n      console.log('Transaction stats:', transactionResults.length, 'items');\n      console.log('Order stats:', orderResults.length, 'items');\n\n      // Combine and aggregate results\n      const productMap = new Map();\n      const categoryMap = new Map();\n\n      // Process transaction results\n      transactionResults.forEach(item => {\n        const key = item.productId;\n        if (productMap.has(key)) {\n          const existing = productMap.get(key);\n          existing.totalQuantity += Number(item.totalQuantity || 0);\n          existing.totalRevenue += Number(item.totalRevenue || 0);\n        } else {\n          productMap.set(key, {\n            productId: item.productId,\n            productName: item.productName,\n            categoryId: item.categoryId,\n            categoryName: item.categoryName,\n            totalQuantity: Number(item.totalQuantity || 0),\n            totalRevenue: Number(item.totalRevenue || 0),\n          });\n        }\n      });\n\n      // Process order results\n      orderResults.forEach(item => {\n        const key = item.productId;\n        if (productMap.has(key)) {\n          const existing = productMap.get(key);\n          existing.totalQuantity += Number(item.totalQuantity || 0);\n          existing.totalRevenue += Number(item.totalRevenue || 0);\n        } else {\n          productMap.set(key, {\n            productId: item.productId,\n            productName: item.productName,\n            categoryId: item.categoryId,\n            categoryName: item.categoryName,\n            totalQuantity: Number(item.totalQuantity || 0),\n            totalRevenue: Number(item.totalRevenue || 0),\n          });\n        }\n      });\n\n      // Calculate category stats\n      productMap.forEach(product => {\n        const categoryKey = product.categoryId;\n        if (categoryMap.has(categoryKey)) {\n          const existing = categoryMap.get(categoryKey);\n          existing.totalQuantity += product.totalQuantity;\n          existing.totalRevenue += product.totalRevenue;\n          existing.productCount += 1;\n        } else {\n          categoryMap.set(categoryKey, {\n            categoryId: product.categoryId,\n            categoryName: product.categoryName,\n            totalQuantity: product.totalQuantity,\n            totalRevenue: product.totalRevenue,\n            productCount: 1,\n          });\n        }\n      });\n\n      const productStats = Array.from(productMap.values());\n      const categoryStats = Array.from(categoryMap.values());\n\n      // Calculate totals\n      const totalRevenue = productStats.reduce((sum, product) => sum + product.totalRevenue, 0);\n      const totalQuantity = productStats.reduce((sum, product) => sum + product.totalQuantity, 0);\n\n      // Top selling products (by quantity)\n      const topSellingProducts = productStats\n        .sort((a, b) => b.totalQuantity - a.totalQuantity)\n        .slice(0, 10);\n\n      // Top revenue products\n      const topRevenueProducts = productStats\n        .sort((a, b) => b.totalRevenue - a.totalRevenue)\n        .slice(0, 10);\n\n      const result = {\n        totalRevenue,\n        totalQuantity,\n        categoryStats,\n        productStats,\n        topSellingProducts,\n        topRevenueProducts,\n      };\n\n      console.log('Menu Analysis Results:', {\n        totalRevenue,\n        totalQuantity,\n        productCount: productStats.length,\n        categoryCount: categoryStats.length\n      });\n\n      res.json(result);\n    } catch (error) {\n      console.error('Menu analysis error:', error);\n      res.status(500).json({\n        error: 'Failed to fetch menu analysis',\n        details: error instanceof Error ? error.message : 'Unknown error'\n      });\n    }\n  });\n\n  // Customer Reports APIs\n  app.get(\"/api/customer-debts\", async (req: TenantRequest, res) => {\n    try {\n      const { startDate, endDate, customerId } = req.query;\n      const tenantDb = await getTenantDatabase(req);\n\n      // Get customer debts from database\n      const customerDebts = await db\n        .select({\n          id: customers.id,\n          customerCode: customers.customerId,\n          customerName: customers.name,\n          initialDebt: sql < number > `0`, // Mock initial debt\n          newDebt: sql < number > `COALESCE(${customers.totalSpent}, 0) * 0.1`, // 10% of total spent as debt\n          payment: sql < number > `COALESCE(${customers.totalSpent}, 0) * 0.05`, // 5% as payment\n          finalDebt: sql < number > `COALESCE(${customers.totalSpent}, 0) * 0.05`, // Final debt\n          phone: customers.phone,\n        })\n        .from(customers)\n        .where(eq(customers.status, \"active\"));\n\n      // Filter by customer if specified\n      let filteredDebts = customerDebts;\n      if (customerId) {\n        filteredDebts = customerDebts.filter(\n          (debt) => debt.id === parseInt(customerId as string),\n        );\n      }\n\n      res.json(filteredDebts);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch customer debts\" });\n    }\n  });\n\n  app.get(\"/api/customer-sales\", async (req: TenantRequest, res) => {\n    try {\n      const { startDate, endDate, customerId } = req.query;\n      const tenantDb = await getTenantDatabase(req);\n\n      // Get customer sales data from database\n      const customerSales = await db\n        .select({\n          id: customers.id,\n          customerCode: customers.customerId,\n          customerName: customers.name,\n          totalSales: customers.totalSpent,\n          visitCount: customers.visitCount,\n          averageOrder: sql < number > `CASE WHEN ${customers.visitCount} > 0 THEN ${customers.totalSpent} / ${customers.visitCount} ELSE 0 END`,\n          phone: customers.phone,\n        })\n        .from(customers)\n        .where(eq(customers.status, \"active\"));\n\n      // Filter by customer if specified\n      let filteredSales = customerSales;\n      if (customerId) {\n        filteredSales = customerSales.filter(\n          (sale) => sale.id === parseInt(customerId as string),\n        );\n      }\n\n      res.json(filteredSales);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch customer sales\" });\n    }\n  });\n\n  // Bulk create products\n  app.post(\"/api/products/bulk\", async (req: TenantRequest, res) => {\n    try {\n      const { products: productList } = req.body;\n      const tenantDb = await getTenantDatabase(req);\n\n      if (!productList || !Array.isArray(productList)) {\n        return res.status(400).json({ error: \"Invalid products data\" });\n      }\n\n      const results = [];\n      let successCount = 0;\n      let errorCount = 0;\n\n      for (const productData of productList) {\n        try {\n          console.log(`Processing product: ${JSON.stringify(productData)}`);\n\n          // Validate required fields with detailed messages\n          const missingFields = [];\n          if (!productData.name) missingFields.push(\"name\");\n          if (!productData.sku) missingFields.push(\"sku\");\n          if (!productData.price) missingFields.push(\"price\");\n          if (\n            productData.categoryId === undefined ||\n            productData.categoryId === null\n          )\n            missingFields.push(\"categoryId\");\n\n          if (missingFields.length > 0) {\n            throw new Error(\n              `Missing required fields: ${missingFields.join(\", \")}`,\n            );\n          }\n\n          // Validate data types\n          if (isNaN(parseFloat(productData.price))) {\n            throw new Error(`Invalid price: ${productData.price}`);\n          }\n\n          if (isNaN(parseInt(productData.categoryId))) {\n            throw new Error(`Invalid categoryId: ${productData.categoryId}`);\n          }\n\n          const [product] = await db\n            .insert(products)\n            .values({\n              name: productData.name,\n              sku: productData.sku,\n              price: productData.price.toString(),\n              stock: parseInt(productData.stock) || 0,\n              categoryId: parseInt(productData.categoryId),\n              imageUrl: productData.imageUrl || null,\n              taxRate: productData.taxRate\n                ? productData.taxRate.toString()\n                : \"0.00\",\n            })\n            .returning();\n\n          console.log(`Successfully created product: ${product.name}`);\n          results.push({ success: true, product });\n          successCount++;\n        } catch (error) {\n          const errorMessage = error.message || \"Unknown error\";\n          console.error(\n            `Error creating product ${productData.name || \"Unknown\"}:`,\n            errorMessage,\n          );\n          console.error(\"Product data:\", JSON.stringify(productData, null, 2));\n\n          results.push({\n            success: false,\n            error: errorMessage,\n            data: productData,\n            productName: productData.name || \"Unknown\",\n          });\n          errorCount++;\n        }\n      }\n\n      res.json({\n        success: successCount,\n        errors: errorCount,\n        results,\n        message: `${successCount} sản phẩm đã được tạo thành công${errorCount > 0 ? `, ${errorCount} sản phẩm lỗi` : \"\"}`,\n      });\n    } catch (error) {\n      console.error(\"Bulk products creation error:\", error);\n      res.status(500).json({ error: \"Failed to create products\" });\n    }\n  });\n\n  // Employee routes\n  app.get(\"/api/employees\", async (req: TenantRequest, res) => {\n    try {\n      const tenantDb = await getTenantDatabase(req);\n      const employees = await storage.getEmployees(tenantDb);\n      res.json(employees);\n    } catch (error) {\n      console.error(\"Error fetching employees:\", error);\n      res.status(500).json({ message: \"Failed to fetch employees\" });\n    }\n  });\n\n  // Employee sales report data\n  app.get(\"/api/employee-sales\", async (req: TenantRequest, res) => {\n    try {\n      const { startDate, endDate, employeeId } = req.query;\n      const tenantDb = await getTenantDatabase(req);\n\n      let query = db\n        .select({\n          employeeName: transactionsTable.cashierName,\n          total: transactionsTable.total,\n          createdAt: transactionsTable.createdAt,\n        })\n        .from(transactionsTable);\n\n      if (startDate && endDate) {\n        query = query.where(\n          and(\n            gte(transactionsTable.createdAt, startDate as string),\n            lte(transactionsTable.createdAt, endDate as string),\n          ),\n        );\n      }\n\n      if (employeeId && employeeId !== \"all\") {\n        query = query.where(\n          eq(transactionsTable.cashierName, employeeId as string),\n        );\n      }\n\n      const salesData = await query;\n      res.json(salesData);\n    } catch (error) {\n      console.error(\"Error fetching employee sales:\", error);\n      res.status(500).json({ message: \"Failed to fetch employee sales data\" });\n    }\n  });\n\n  // Add new API endpoints with proper date filtering for sales chart report\n  app.get(\n    \"/api/transactions/:startDate/:endDate/:salesMethod/:salesChannel/:analysisType/:concernType/:selectedEmployee\",\n    async (req: TenantRequest, res) => {\n      try {\n        const { startDate, endDate, salesMethod, salesChannel, analysisType, concernType, selectedEmployee } = req.params;\n        const tenantDb = await getTenantDatabase(req);\n\n        console.log(\"Transactions API called with params:\", {\n          startDate, endDate, salesMethod, salesChannel, analysisType, concernType, selectedEmployee\n        });\n\n        const transactions = await storage.getTransactions(tenantDb);\n\n        const filteredTransactions = transactions.filter((transaction) => {\n          const transactionDate = new Date(transaction.createdAt);\n          const start = new Date(startDate);\n          const end = new Date(endDate);\n          end.setHours(23, 59, 59, 999);\n\n          const dateMatch = transactionDate >= start && transactionDate <= end;\n\n          // Enhanced filtering logic based on actual transaction data\n          const methodMatch =\n            salesMethod === \"all\" ||\n            (salesMethod === \"no_delivery\" &&\n              (!transaction.deliveryMethod || transaction.deliveryMethod === \"pickup\")) ||\n            (salesMethod === \"delivery\" &&\n              transaction.deliveryMethod === \"delivery\");\n\n          const channelMatch =\n            salesChannel === \"all\" ||\n            (salesChannel === \"direct\" &&\n              (!transaction.salesChannel || transaction.salesChannel === \"direct\" || transaction.salesChannel === \"pos\")) ||\n            (salesChannel === \"other\" &&\n              transaction.salesChannel && transaction.salesChannel !== \"direct\" && transaction.salesChannel !== \"pos\");\n\n          // Employee filter\n          const employeeMatch =\n            selectedEmployee === \"all\" ||\n            transaction.cashierName === selectedEmployee ||\n            transaction.employeeId?.toString() === selectedEmployee ||\n            (transaction.cashierName && transaction.cashierName.includes(selectedEmployee));\n\n          return dateMatch && methodMatch && salesChannelMatch && employeeMatch;\n        });\n\n        res.json(filteredTransactions);\n      } catch (error) {\n        console.error(\"Error in transactions API:\", error);\n        res.status(500).json({ error: \"Failed to fetch transactions data\" });\n      }\n    },\n  );\n\n  app.get(\n    \"/api/orders/:startDate/:endDate/:selectedEmployee/:salesChannel/:salesMethod/:analysisType/:concernType\",\n    async (req: TenantRequest, res) => {\n      try {\n        const { startDate, endDate, selectedEmployee, salesChannel, salesMethod, analysisType, concernType } = req.params;\n        const tenantDb = await getTenantDatabase(req);\n\n        console.log(\"Orders API called with params:\", {\n          startDate, endDate, selectedEmployee, salesChannel, salesMethod, analysisType, concernType\n        });\n\n        const orders = await storage.getOrders(undefined, undefined, tenantDb);\n\n        const filteredOrders = orders.filter((order) => {\n          const orderDate = new Date(order.orderedAt);\n          const start = new Date(startDate);\n          const end = new Date(endDate);\n          end.setHours(23, 59, 59, 999);\n\n          const dateMatch = orderDate >= start && orderDate <= end;\n          const statusMatch = order.status === \"paid\";\n\n          const employeeMatch =\n            selectedEmployee === \"all\" ||\n            order.employeeId?.toString() === selectedEmployee;\n\n          const channelMatch =\n            salesChannel === \"all\" ||\n            (salesChannel === \"direct\" &&\n              (!order.salesChannel || order.salesChannel === \"direct\")) ||\n            (salesChannel === \"other\" &&\n              order.salesChannel && order.salesChannel !== \"direct\");\n\n          const methodMatch =\n            salesMethod === \"all\" ||\n            (salesMethod === \"no_delivery\" &&\n              (!order.deliveryMethod || order.deliveryMethod === \"pickup\")) ||\n            (salesMethod === \"delivery\" &&\n              order.deliveryMethod === \"delivery\");\n\n          return dateMatch && statusMatch && employeeMatch && channelMatch && methodMatch;\n        });\n\n        res.json(filteredOrders);\n      } catch (error) {\n        console.error(\"Error in orders API:\", error);\n        res.status(500).json({ error: \"Failed to fetch orders data\" });\n      }\n    },\n  );\n\n  // Sales channel sales data\n  // Sales Channel Sales API\n  app.get(\n    \"/api/sales-channel-sales/:startDate/:endDate/:seller/:channel\",\n    async (req: TenantRequest, res) => {\n      try {\n        const { startDate, endDate, seller, channel } = req.params;\n        const tenantDb = await getTenantDatabase(req);\n\n        // Use storage instead of direct db queries\n        const orders = await storage.getOrders(undefined, undefined, tenantDb);\n        const filteredOrders = orders.filter((order) => {\n          const orderDate = new Date(order.orderedAt);\n          const start = new Date(startDate);\n          const end = new Date(endDate);\n          end.setHours(23, 59, 59, 999);\n\n          const dateMatch = orderDate >= start && orderDate <= end;\n          const statusMatch = order.status === \"paid\";\n          const sellerMatch =\n            seller === \"all\" || order.employeeId?.toString() === seller;\n          const channelMatch =\n            channel === \"all\" || order.salesChannel === channel;\n\n          return dateMatch && statusMatch && sellerMatch && channelMatch;\n        });\n\n        const salesData = [{\n          salesChannelName: \"Direct Sales\",\n          revenue: filteredOrders.reduce(\n            (sum, order) => sum + Number(order.total),\n            0,\n          ),\n          returnValue: 0,\n          netRevenue: filteredOrders.reduce(\n            (sum, order) => sum + Number(order.total),\n            0,\n          ),\n        }, ];\n\n        res.json(salesData);\n      } catch (error) {\n        console.error(\"Error fetching sales channel sales data:\", error);\n        res\n          .status(500)\n          .json({ error: \"Failed to fetch sales channel sales data\" });\n      }\n    },\n  );\n\n  // Sales Channel Profit API\n  app.get(\n    \"/api/sales-channel-profit/:startDate/:endDate/:seller/:channel\",\n    async (req: TenantRequest, res) => {\n      try {\n        const { startDate, endDate, seller, channel } = req.params;\n        const tenantDb = await getTenantDatabase(req);\n\n        // Use storage instead of direct db queries\n        const orders = await storage.getOrders(undefined, undefined, tenantDb);\n        const filteredOrders = orders.filter((order) => {\n          const orderDate = new Date(order.orderedAt);\n          const start = new Date(startDate);\n          const end = new Date(endDate);\n          end.setHours(23, 59, 59, 999);\n\n          const dateMatch = orderDate >= start && orderDate <= end;\n          const statusMatch = order.status === \"paid\";\n          const sellerMatch =\n            seller === \"all\" || order.employeeId?.toString() === seller;\n          const channelMatch =\n            channel === \"all\" || order.salesChannel === channel;\n\n          return dateMatch && statusMatch && sellerMatch && channelMatch;\n        });\n\n        const totalAmount = filteredOrders.reduce(\n          (sum, order) => sum + Number(order.total),\n          0,\n        );\n        const profitData = [{\n          salesChannelName: \"Direct Sales\",\n          totalAmount: totalAmount,\n          discount: 0,\n          revenue: totalAmount,\n          returnValue: 0,\n          netRevenue: totalAmount,\n          totalCost: totalAmount * 0.6,\n          grossProfit: totalAmount * 0.4,\n          platformFee: 0,\n          netProfit: totalAmount * 0.4,\n        }, ];\n\n        res.json(profitData);\n      } catch (error) {\n        console.error(\"Error fetching sales channel profit data:\", error);\n        res\n          .status(500)\n          .json({ error: \"Failed to fetch sales channel profit data\" });\n      }\n    },\n  );\n\n  // Sales channel sales data\n  app.get(\n    \"/api/sales-channel-sales/:startDate/:endDate/:sellerId/:salesChannel\",\n    async (req: TenantRequest, res) => {\n      try {\n        const { startDate, endDate, sellerId, salesChannel } = req.params;\n        const tenantDb = await getTenantDatabase(req);\n\n        let query = `\n        SELECT \n          COALESCE(t.salesChannel, 'Bán trực tiếp') as salesChannelName,\n          e.name as sellerName,\n          SUM(t.total) as revenue,\n          SUM(COALESCE(t.refundAmount, 0)) as returnValue,\n          SUM(t.total - COALESCE(t.refundAmount, 0)) as netRevenue\n        FROM transactions t\n        LEFT JOIN employees e ON t.employeeId = e.id\n        WHERE DATE(t.createdAt) BETWEEN ? AND ?\n      `;\n\n        const params = [startDate, endDate];\n\n        if (sellerId !== \"all\") {\n          query += \" AND t.employeeId = ?\";\n          params.push(sellerId);\n        }\n\n        if (salesChannel !== \"all\") {\n          if (salesChannel === \"direct\") {\n            query +=\n              ' AND (t.salesChannel IS NULL OR t.salesChannel = \"Bán trực tiếp\")';\n          } else {\n            query +=\n              ' AND t.salesChannel IS NOT NULL AND t.salesChannel != \"Bán trực tiếp\"';\n          }\n        }\n\n        query +=\n          ' GROUP BY COALESCE(t.salesChannel, \"Bán trực tiếp\"), t.employeeId ORDER BY netRevenue DESC';\n\n        const salesData = await new Promise((resolve, reject) => {\n          db.all(query, params, (err, rows) => {\n            if (err) reject(err);\n            else resolve(rows);\n          });\n        });\n\n        res.json(salesData);\n      } catch (error) {\n        console.error(\"Error fetching sales channel sales data:\", error);\n        res\n          .status(500)\n          .json({ error: \"Failed to fetch sales channel sales data\" });\n      }\n    },\n  );\n\n  // Sales channel profit data\n  app.get(\n    \"/api/sales-channel-profit/:startDate/:endDate/:sellerId/:salesChannel\",\n    async (req: TenantRequest, res) => {\n      try {\n        const { startDate, endDate, sellerId, salesChannel } = req.params;\n        const tenantDb = await getTenantDatabase(req);\n\n        let query = `\n        SELECT \n          COALESCE(t.salesChannel, 'Bán trực tiếp') as salesChannelName,\n          e.name as sellerName,\n          SUM(t.totalAmount) as totalAmount,\n          SUM(COALESCE(t.discountAmount, 0)) as discount,\n          SUM(t.totalAmount - COALESCE(t.discountAmount, 0)) as revenue,\n          SUM(COALESCE(t.refundAmount, 0)) as returnValue,\n          SUM(t.totalAmount - COALESCE(t.discountAmount, 0) - COALESCE(t.refundAmount, 0)) as netRevenue,\n          SUM(COALESCE(ti.quantity * p.costPrice, 0)) as totalCost,\n          SUM(t.totalAmount - COALESCE(t.discountAmount, 0) - COALESCE(ti.quantity * p.costPrice, 0)) as grossProfit,\n          SUM(COALESCE(t.platformFee, 0)) as platformFee,\n          SUM(t.totalAmount - COALESCE(t.discountAmount, 0) - COALESCE(ti.quantity * p.costPrice, 0) - COALESCE(t.platformFee, 0)) as netProfit\n        FROM transactions t\n        LEFT JOIN employees e ON t.employeeId = e.id\n        LEFT JOIN transaction_items ti ON t.id = ti.transactionId\n        LEFT JOIN products p ON ti.productId = p.id\n        WHERE DATE(t.createdAt) BETWEEN ? AND ?\n      `;\n\n        const params = [startDate, endDate];\n\n        if (sellerId !== \"all\") {\n          query += \" AND t.employeeId = ?\";\n          params.push(sellerId);\n        }\n\n        if (salesChannel !== \"all\") {\n          if (salesChannel === \"direct\") {\n            query +=\n              ' AND (t.salesChannel IS NULL OR t.salesChannel = \"Bán trực tiếp\")';\n          } else {\n            query +=\n              ' AND t.salesChannel IS NOT NULL AND t.salesChannel != \"Bán trực tiếp\"';\n          }\n        }\n\n        query +=\n          ' GROUP BY COALESCE(t.salesChannel, \"Bán trực tiếp\"), t.employeeId ORDER BY netProfit DESC';\n\n        const profitData = await new Promise((resolve, reject) => {\n          db.all(query, params, (err, rows) => {\n            if (err) reject(err);\n            else resolve(rows);\n          });\n        });\n\n        res.json(profitData);\n      } catch (error) {\n        console.error(\"Error fetching sales channel profit data:\", error);\n        res\n          .status(500)\n          .json({ error: \"Failed to fetch sales channel profit data\" });\n      }\n    },\n  );\n\n  // Sales channel products data\n  app.get(\n    \"/api/sales-channel-products/:startDate/:endDate/:sellerId/:salesChannel/:productSearch/:productType/:categoryId\",\n    async (req: TenantRequest, res) => {\n      try {\n        const {\n          startDate,\n          endDate,\n          sellerId,\n          salesChannel,\n          productSearch,\n          productType,\n          categoryId,\n        } = req.params;\n        const tenantDb = await getTenantDatabase(req);\n\n        let query = `\n        SELECT \n          COALESCE(t.salesChannel, 'Bán trực tiếp') as salesChannelName,\n          e.name as sellerName,\n          p.sku as productCode,\n          p.name as productName,\n          SUM(ti.quantity) as quantitySold,\n          SUM(ti.quantity * ti.price) as revenue,\n          SUM(COALESCE(rti.quantity, 0)) as quantityReturned,\n          SUM(COALESCE(rti.quantity * rti.price, 0)) as returnValue,\n          SUM(ti.quantity * ti.price - COALESCE(rti.quantity * rti.price, 0)) as netRevenue\n        FROM transactions t\n        LEFT JOIN employees e ON t.employeeId = e.id        LEFT JOIN transaction_items ti ON t.id = ti.transactionId\n        LEFT JOIN products p ON ti.productId = p.id\n        LEFT JOIN categories c ON p.categoryId = c.id\n        LEFT JOIN transaction_items rti ON t.id = rti.transactionId AND rti.productId = p.id AND rti.isReturn = 1\n        WHERE DATE(t.createdAt) BETWEEN ? AND ? AND ti.isReturn != 1\n      `;\n\n        const params = [startDate, endDate];\n\n        if (sellerId !== \"all\") {\n          query += \" AND t.employeeId = ?\";\n          params.push(sellerId);\n        }\n\n        if (salesChannel !== \"all\") {\n          if (salesChannel === \"direct\") {\n            query +=\n              ' AND (t.salesChannel IS NULL OR t.salesChannel = \"Bán trực tiếp\")';\n          } else {\n            query +=\n              ' AND t.salesChannel IS NOT NULL AND t.salesChannel != \"Bán trực tiếp\"';\n          }\n        }\n\n        if (productSearch !== \"all\" && productSearch) {\n          query += \" AND (p.name LIKE ? OR p.sku LIKE ?)\";\n          params.push(`%${productSearch}%`, `%${productSearch}%`);\n        }\n\n        if (productType !== \"all\" && productType) {\n          query += \" AND p.type = ?\";\n          params.push(productType);\n        }\n\n        if (categoryId !== \"all\" && categoryId) {\n          query += \" AND p.categoryId = ?\";\n          params.push(categoryId);\n        }\n\n        query +=\n          ' GROUP BY COALESCE(t.salesChannel, \"Bán trực tiếp\"), t.employeeId, p.id ORDER BY netRevenue DESC';\n\n        const productsData = await new Promise((resolve, reject) => {\n          db.all(query, params, (err, rows) => {\n            if (err) reject(err);\n            else resolve(rows);\n          });\n        });\n\n        res.json(productsData);\n      } catch (error) {\n        console.error(\"Error fetching sales channel products data:\", error);\n        res\n          .status(500)\n          .json({ error: \"Failed to fetch sales channel products data\" });\n      }\n    },\n  );\n\n  // Financial report endpoints\n  app.get(\n    \"/api/financial-summary/:period/:year/:month?/:quarter?\",\n    async (req: TenantRequest, res) => {\n      try {\n        const { period, year, month, quarter } = req.params;\n        const tenantDb = await getTenantDatabase(req);\n\n        // Get transactions for financial calculations\n        const transactions = await storage.getTransactions(tenantDb);\n\n        let filteredTransactions = transactions.filter((transaction) => {\n          const date = new Date(transaction.createdAt);\n          const transactionYear = date.getFullYear();\n\n          if (period === \"yearly\") {\n            return transactionYear === parseInt(year);\n          } else if (period === \"monthly\") {\n            const transactionMonth = date.getMonth() + 1;\n            return (\n              transactionYear === parseInt(year) &&\n              transactionMonth === parseInt(month)\n            );\n          } else if (period === \"quarterly\") {\n            const transactionQuarter = Math.floor(date.getMonth() / 3) + 1;\n            return (\n              transactionYear === parseInt(year) &&\n              transactionQuarter === parseInt(quarter)\n            );\n          }\n          return false;\n        });\n\n        // Calculate financial metrics\n        const totalIncome = filteredTransactions.reduce(\n          (sum, t) => sum + Number(t.total),\n          0,\n        );\n        const totalExpenses = totalIncome * 0.6; // Mock expense calculation (60% of income)\n        const grossProfit = totalIncome - totalExpenses;\n        const operatingExpenses = totalIncome * 0.15; // Mock operating expenses (15% of income)\n        const netIncome = grossProfit - operatingExpenses;\n        const profitMargin =\n          totalIncome > 0 ? (netIncome / totalIncome) * 100 : 0;\n\n        const summary = {\n          totalIncome,\n          totalExpenses,\n          grossProfit,\n          operatingExpenses,\n          netIncome,\n          profitMargin,\n          transactionCount: filteredTransactions.length,\n        };\n\n        res.json(summary);\n      } catch (error) {\n        console.error(\"Error fetching financial summary:\", error);\n        res.status(500).json({ error: \"Failed to fetch financial summary\" });\n      }\n    },\n  );\n\n  app.get(\n    \"/api/income-breakdown/:period/:year/:month?/:quarter?\",\n    async (req: TenantRequest, res) => {\n      try {\n        const { period, year, month, quarter } = req.params;\n        const tenantDb = await getTenantDatabase(req);\n\n        const transactions = await storage.getTransactions(tenantDb);\n\n        let filteredTransactions = transactions.filter((transaction) => {\n          const date = new Date(transaction.createdAt);\n          const transactionYear = date.getFullYear();\n\n          if (period === \"yearly\") {\n            return transactionYear === parseInt(year);\n          } else if (period === \"monthly\") {\n            const transactionMonth = date.getMonth() + 1;\n            return (\n              transactionYear === parseInt(year) &&\n              transactionMonth === parseInt(month)\n            );\n          } else if (period === \"quarterly\") {\n            const transactionQuarter = Math.floor(date.getMonth() / 3) + 1;\n            return (\n              transactionYear === parseInt(year) &&\n              transactionQuarter === parseInt(quarter)\n            );\n          }\n          return false;\n        });\n\n        // Group by payment method\n        const incomeByMethod = {};\n        filteredTransactions.forEach((transaction) => {\n          const method = transaction.paymentMethod || \"cash\";\n          incomeByMethod[method] =\n            (incomeByMethod[method] || 0) + Number(transaction.total);\n        });\n\n        const breakdown = Object.entries(incomeByMethod).map(\n          ([method, amount]) => ({\n            category: method,\n            amount: amount,\n            percentage:\n              filteredTransactions.length > 0\n                ? (amount /\n                  filteredTransactions.reduce(\n                    (sum, t) => sum + Number(t.total),\n                    0,\n                  )) *\n                100\n                : 0,\n          }),\n        );\n\n        res.json(breakdown);\n      } catch (error) {\n        console.error(\"Error fetching income breakdown:\", error);\n        res.status(500).json({ error: \"Failed to fetch income breakdown\" });\n      }\n    },\n  );\n\n  app.get(\n    \"/api/expense-breakdown/:period/:year/:month?/:quarter?\",\n    async (req: TenantRequest, res) => {\n      try {\n        // Mock expense data since we don't have a dedicated expenses table\n        const mockExpenses = [\n          { category: \"Cost of Goods Sold\", amount: 2500000, percentage: 60 },\n          { category: \"Rent\", amount: 500000, percentage: 12 },\n          { category: \"Utilities\", amount: 200000, percentage: 5 },\n          { category: \"Staff Salaries\", amount: 800000, percentage: 19 },\n          { category: \"Marketing\", amount: 100000, percentage: 2 },\n          { category: \"Other\", amount: 83333, percentage: 2 },\n        ];\n\n        res.json(mockExpenses);\n      } catch (error) {\n        console.error(\"Error fetching expense breakdown:\", error);\n        res.status(500).json({ error: \"Failed to fetch expense breakdown\" });\n      }\n    },\n  );\n\n  app.get(\n    \"/api/cash-flow/:period/:year/:month?/:quarter?\",\n    async (req: TenantRequest, res) => {\n      try {\n        const { period, year, month, quarter } = req.params;\n        const tenantDb = await getTenantDatabase(req);\n\n        const transactions = await storage.getTransactions(tenantDb);\n\n        let filteredTransactions = transactions.filter((transaction) => {\n          const date = new Date(transaction.createdAt);\n          const transactionYear = date.getFullYear();\n\n          if (period === \"yearly\") {\n            return transactionYear === parseInt(year);\n          } else if (period === \"monthly\") {\n            const transactionMonth = date.getMonth() + 1;\n            return (\n              transactionYear === parseInt(year) &&\n              transactionMonth === parseInt(month)\n            );\n          } else if (period === \"quarterly\") {\n            const transactionQuarter = Math.floor(date.getMonth() / 3) + 1;\n            return (\n              transactionYear === parseInt(year) &&\n              transactionQuarter === parseInt(quarter)\n            );\n          }\n          return false;\n        });\n\n        const totalIncome = filteredTransactions.reduce(\n          (sum, t) => sum + Number(t.total),\n          0,\n        );\n\n        // Mock cash flow calculations\n        const operatingCashFlow = totalIncome * 0.25; // 25% of income\n        const investingCashFlow = -totalIncome * 0.05; // 5% negative (investments)\n        const financingCashFlow = totalIncome * 0.02; // 2% positive (financing)\n        const netCashFlow =\n          operatingCashFlow + investingCashFlow + financingCashFlow;\n\n        const cashFlow = {\n          operatingCashFlow,\n          investingCashFlow,\n          financingCashFlow,\n          netCashFlow,\n        };\n\n        res.json(cashFlow);\n      } catch (error) {\n        console.error(\"Error fetching cash flow:\", error);\n        res.status(500).json({ error: \"Failed to fetch cash flow\" });\n      }\n    },\n  );\n\n  // POS Login API endpoint\n  app.post(\"/api/pos/login\", async (req: TenantRequest, res) => {\n    try {\n      const { clientID, clientSecret, masterId, bankCode } = req.body;\n      const tenantDb = await getTenantDatabase(req);\n\n      console.log(\"POS Login request:\", { clientID, clientSecret, masterId, bankCode });\n\n      // Use external server URL for login\n      const apiBaseUrl = process.env.QR_API_BASE_URL || \"http://1.55.212.135:9335\";\n      const response = await fetch(`${apiBaseUrl}/api/pos/login`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Accept: \"application/json\",\n        },\n        body: JSON.stringify({\n          clientID,\n          clientSecret,\n          masterId,\n          bankCode,\n        }),\n      });\n\n      if (!response.ok) {\n        console.error(\"POS Login API error:\", response.status, response.statusText);\n        return res.status(response.status).json({\n          error: \"Failed to login for QR payment\",\n          details: `API returned ${response.status}: ${response.statusText}`,\n        });\n      }\n\n      const result = await response.json();\n      console.log(\"POS Login response:\", result);\n\n      res.json(result);\n    } catch (error) {\n      console.error(\"POS Login proxy error:\", error);\n      res.status(500).json({\n        error: \"Failed to login for QR payment\",\n        details: error.message,\n      });\n    }\n  });\n\n  // QR Payment API proxy endpoint\n  app.post(\"/api/pos/create-qr\", async (req: TenantRequest, res) => {\n    // Stock update error\n    try {\n      const { bankCode, clientID } = req.query;\n      const body = req.body;\n      const tenantDb = await getTenantDatabase(req);\n\n      console.log(\"CreateQRPos request:\", { bankCode, clientID, body });\n\n      // Use external server URL\n      const apiBaseUrl =\n        process.env.QR_API_BASE_URL || \"http://1.55.212.135:9335\";\n      const response = await fetch(\n        `${apiBaseUrl}/api/CreateQRPos?bankCode=${bankCode}&clientID=${clientID}`,\n        {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Accept: \"application/json\",\n          },\n          body: JSON.stringify(body),\n        },\n      );\n\n      if (!response.ok) {\n        console.error(\n          \"CreateQRPos API error:\",\n          response.status,\n          response.statusText,\n        );\n        return res.status(response.status).json({\n          error: \"Failed to create QR payment\",\n          details: `API returned ${response.status}: ${response.statusText}`,\n        });\n      }\n\n      const result = await response.json();\n      console.log(\"CreateQRPos response:\", result);\n\n      res.json(result);\n    } catch (error) {\n      console.error(\"CreateQRPos proxy error:\", error);\n      res.status(500).json({\n        error: \"Failed to create QR payment\",\n        details: error.message,\n      });\n    }\n  });\n\n  // Tax code lookup proxy endpoint\n  app.post(\"/api/tax-code-lookup\", async (req: TenantRequest, res) => {\n    try {\n      const { taxCode } = req.body;\n      const tenantDb = await getTenantDatabase(req);\n\n      if (!taxCode) {\n        return res.status(400).json({\n          success: false,\n          message: \"Mã số thuế không được để trống\"\n        });\n      }\n\n      // Call the external tax code API\n      const response = await fetch(\"https://infoerpvn.com:9440/api/CheckListTaxCode/v2\", {\n        method: \"POST\",\n        headers: {\n          \"token\": \"EnURbbnPhUm4GjNgE4Ogrw==\",\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify([taxCode]),\n      });\n\n      if (!response.ok) {\n        throw new Error(`External API error: ${response.status} ${response.statusText}`);\n      }\n\n      const result = await response.json();\n\n      res.json({\n        success: true,\n        data: result,\n        message: \"Tra cứu thành công\"\n      });\n\n    } catch (error) {\n      console.error(\"Tax code lookup error:\", error);\n      res.status(500).json({\n        success: false,\n        message: \"Có lỗi xảy ra khi tra cứu mã số thuế\",\n        error: error instanceof Error ? error.message : \"Unknown error\"\n      });\n    }\n  });\n\n  // Invoices management\n  app.post(\"/api/invoices\", async (req: TenantRequest, res) => {\n    try {\n      const invoiceData = req.body;\n      const tenantDb = await getTenantDatabase(req);\n      console.log(\"Creating invoice record:\", JSON.stringify(invoiceData, null, 2));\n\n      // Validate required fields\n      if (!invoiceData.total || !invoiceData.customerName) {\n        return res.status(400).json({\n          error: \"Missing required fields\",\n          details: \"total and customerName are required\",\n          received: invoiceData\n        });\n      }\n\n      // Generate trade number\n      const tradeNumber = `INV-${Date.now()}`;\n\n      // Validate and prepare invoice data with proper type conversion\n      const validatedInvoice = {\n        invoiceNumber: null,\n        tradeNumber,\n        customerId: invoiceData.customerId || null,\n        customerName: invoiceData.customerName || \"Khách hàng\",\n        customerTaxCode: invoiceData.customerTaxCode || null,\n        customerAddress: invoiceData.customerAddress || null,\n        customerPhone: invoiceData.customerPhone || null,\n        customerEmail: invoiceData.customerEmail || null,\n        subtotal: typeof invoiceData.subtotal === 'string' ? invoiceData.subtotal : invoiceData.subtotal?.toString() || \"0\",\n        tax: typeof invoiceData.tax === 'string' ? invoiceData.tax : invoiceData.tax?.toString() || \"0\",\n        total: typeof invoiceData.total === 'string' ? invoiceData.total : invoiceData.total?.toString() || \"0\",\n        paymentMethod: invoiceData.paymentMethod || 'cash',\n        invoiceDate: new Date(invoiceData.invoiceDate || new Date()),\n        status: invoiceData.status || 'draft',\n        einvoiceStatus: invoiceData.einvoiceStatus || 0,\n        notes: invoiceData.notes || null,\n        createdAt: new Date(),\n        updatedAt: new Date()\n      };\n\n      console.log(\"Validated invoice data:\", JSON.stringify(validatedInvoice, null, 2));\n\n      // Save invoice to database\n      const [savedInvoice] = await db\n        .insert(invoices)\n        .values(validatedInvoice)\n        .returning();\n\n      console.log(\"Invoice saved to database:\", savedInvoice);\n\n      // Save invoice items\n      if (invoiceData.items && Array.isArray(invoiceData.items) && invoiceData.items.length > 0) {\n        console.log(\"Processing invoice items:\", invoiceData.items.length);\n\n        const invoiceItemsData = invoiceData.items.map((item: any, index: number) => {\n          console.log(`Processing item ${index + 1}:`, item);\n\n          return {\n            invoiceId: savedInvoice.id,\n            productId: item.productId || 0,\n            productName: item.productName || `Product ${index + 1}`,\n            quantity: typeof item.quantity === 'string' ? parseInt(item.quantity) : (item.quantity || 1),\n            unitPrice: typeof item.unitPrice === 'string' ? item.unitPrice : (item.unitPrice?.toString() || \"0\"),\n            total: typeof item.total === 'string' ? item.total : (item.total?.toString() || \"0\"),\n            taxRate: typeof item.taxRate === 'string' ? item.taxRate : ((item.taxRate || 10).toString())\n          };\n        });\n\n        console.log(\"Invoice items data:\", JSON.stringify(invoiceItemsData, null, 2));\n\n        const savedItems = await db\n          .insert(invoiceItems)\n          .values(invoiceItemsData)\n          .returning();\n\n        console.log(\"Invoice items saved:\", savedItems.length);\n      } else {\n        console.log(\"No invoice items to save\");\n      }\n\n      res.status(201).json({\n        success: true,\n        invoice: savedInvoice,\n        message: \"Hóa đơn đã được lưu thành công\"\n      });\n\n    } catch (error) {\n      console.error(\"=== INVOICE CREATION ERROR ===\");\n      console.error(\"Error type:\", error?.constructor?.name);\n      console.error(\"Error message:\", error?.message);\n      console.error(\"Error stack:\", error?.stack);\n      console.error(\"Request body:\", JSON.stringify(req.body, null, 2));\n\n      // Check for specific database errors\n      let errorMessage = \"Failed to create invoice\";\n      let errorDetails = error instanceof Error ? error.message : \"Unknown error\";\n\n      if (error?.message?.includes(\"NOT NULL constraint failed\")) {\n        errorMessage = \"Missing required database fields\";\n        errorDetails = \"Some required fields are missing or null\";\n      } else if (error?.message?.includes(\"FOREIGN KEY constraint failed\")) {\n        errorMessage = \"Invalid reference data\";\n        errorDetails = \"Referenced data does not exist\";\n      } else if (error?.message?.includes(\"UNIQUE constraint failed\")) {\n        errorMessage = \"Duplicate data conflict\";\n        errorDetails = \"Data already exists in database\";\n      }\n\n      res.status(500).json({\n        error: errorMessage,\n        details: errorDetails,\n        timestamp: new Date().toISOString(),\n        requestData: req.body\n      });\n    }\n  });\n\n  app.get(\"/api/invoices\", async (req: TenantRequest, res) => {\n    try {\n      const tenantDb = await getTenantDatabase(req);\n      const invoicesList = await db\n        .select()\n        .from(invoices)\n        .orderBy(desc(invoices.createdAt));\n\n      res.json(invoicesList);\n    } catch (error) {\n      console.error(\"Error fetching invoices:\", error);\n      res.status(500).json({ error: \"Failed to fetch invoices\" });\n    }\n  });\n\n  app.get(\"/api/invoice-items/:invoiceId\", async (req: TenantRequest, res) => {\n    try {\n      const invoiceId = parseInt(req.params.invoiceId);\n      const tenantDb = await getTenantDatabase(req);\n\n      if (isNaN(invoiceId)) {\n        return res.status(400).json({ error: \"Invalid invoice ID\" });\n      }\n\n      const items = await db\n        .select()\n        .from(invoiceItems)\n        .where(eq(invoiceItems.invoiceId, invoiceId))\n        .orderBy(invoiceItems.id);\n\n      res.json(items);\n    } catch (error) {\n      console.error(\"Error fetching invoice items:\", error);\n      res.status(500).json({ error: \"Failed to fetch invoice items\" });\n    }\n  });\n\n  // Update invoice (including status fields)\n  app.put(\"/api/invoices/:id\", async (req: TenantRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const updateData = req.body;\n      const tenantDb = await getTenantDatabase(req);\n\n      console.log(\"=== UPDATING INVOICE ===\");\n      console.log(\"Invoice ID:\", id);\n      console.log(\"Update data:\", JSON.stringify(updateData, null, 2));\n\n      if (isNaN(id)) {\n        console.error(\"Invalid invoice ID:\", req.params.id);\n        return res.status(400).json({ error: \"Invalid invoice ID\" });\n      }\n\n      // Check if invoice exists first\n      const [existingInvoice] = await db\n        .select()\n        .from(invoices)\n        .where(eq(invoices.id, id))\n        .limit(1);\n\n      if (!existingInvoice) {\n        console.error(\"Invoice not found:\", id);\n        return res.status(404).json({ error: \"Invoice not found\" });\n      }\n\n      console.log(\"Existing invoice:\", existingInvoice);\n\n      // Prepare fields to update with proper mapping\n      const fieldsToUpdate: any = {};\n\n      // Handle invoiceStatus mapping\n      if (updateData.invoiceStatus !== undefined) {\n        fieldsToUpdate.invoiceStatus = updateData.invoiceStatus;\n      }\n\n      if (updateData.invoice_status !== undefined) {\n        fieldsToUpdate.invoiceStatus = updateData.invoice_status; // Map to the correct database field\n      }\n\n      // Handle other standard fields\n      const standardFields = ['status', 'einvoiceStatus', 'invoiceNumber', 'symbol', 'templateNumber', 'tradeNumber'];\n      standardFields.forEach(field => {\n        if (updateData[field] !== undefined) {\n          fieldsToUpdate[field] = updateData[field];\n        }\n      });\n\n      // Add any other fields from updateData (excluding already processed ones)\n      Object.keys(updateData).forEach(key => {\n        if (!['invoiceStatus', 'invoice_status', ...standardFields].includes(key)) {\n          if (updateData[key] !== undefined) {\n            fieldsToUpdate[key] = updateData[key];\n          }\n        }\n      });\n\n      fieldsToUpdate.updatedAt = new Date();\n\n      console.log(\"Fields to update:\", JSON.stringify(fieldsToUpdate, null, 2));\n\n      const [updatedInvoice] = await db\n        .update(invoices)\n        .set(fieldsToUpdate)\n        .where(eq(invoices.id, id))\n        .returning();\n\n      if (!updatedInvoice) {\n        console.error(\"Failed to update invoice - no result returned\");\n        return res.status(500).json({ error: \"Failed to update invoice - no result returned\" });\n      }\n\n      console.log(\"✅ Invoice updated successfully:\", updatedInvoice);\n      res.json(updatedInvoice);\n    } catch (error) {\n      console.error(\"=== INVOICE UPDATE ERROR ===\");\n      console.error(\"Error type:\", error?.constructor?.name);\n      console.error(\"Error message:\", error?.message);\n      console.error(\"Error details:\", error);\n      console.error(\"Invoice ID:\", req.params.id);\n      console.error(\"Update data:\", req.body);\n\n      res.status(500).json({\n        error: \"Failed to update invoice\",\n        details: error instanceof Error ? error.message : \"Unknown error\",\n        invoiceID: req.params.id,\n        updateData: req.body\n      });\n    }\n  });\n\n  // Update order (including template_number and symbol fields)\n  app.put(\"/api/orders/:id\", async (req: TenantRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const orderData = req.body; // Use raw body to preserve all fields\n      const tenantDb = await getTenantDatabase(req);\n\n      console.log(`=== PUT ORDER API CALLED ===`);\n      console.log(`Order ID: ${id}`);\n      console.log(`Update data:`, JSON.stringify(orderData, null, 2));\n\n      if (isNaN(id)) {\n        console.error(`❌ Invalid order ID: ${req.params.id}`);\n        return res.status(400).json({ message: \"Invalid order ID\" });\n      }\n\n      // Check if order exists first\n      const [existingOrder] = await db\n        .select()\n        .from(orders)\n        .where(eq(orders.id, id));\n\n      if (!existingOrder) {\n        console.error(`❌ Order not found: ${id}`);\n        return res.status(404).json({ message: \"Order not found\" });\n      }\n\n      console.log(`📋 Current order state:`, {\n        id: existingOrder.id,\n        orderNumber: existingOrder.orderNumber,\n        tableId: existingOrder.tableId,\n        currentStatus: existingOrder.status,\n        paymentMethod: existingOrder.paymentMethod\n      });\n\n      const order = await storage.updateOrder(id, orderData, tenantDb);\n\n      if (!order) {\n        console.error(`❌ Failed to update order ${id}`);\n        return res.status(500).json({ message: \"Failed to update order\" });\n      }\n\n      console.log(`✅ Order update API completed successfully:`, {\n        orderId: order.id,\n        status: order.status,\n        paymentMethod: order.paymentMethod,\n        paidAt: order.paidAt,\n        einvoiceStatus: order.einvoiceStatus\n      });\n\n      res.json({\n        ...order,\n        updated: true,\n        updateTimestamp: new Date().toISOString()\n      });\n    } catch (error) {\n      console.error(`❌ PUT Order API error:`, error);\n      if (error instanceof z.ZodError) {\n        return res\n          .status(400)\n          .json({ message: \"Invalid order data\", errors: error.errors });\n      }\n      res.status(500).json({ \n        message: \"Failed to update order\",\n        error: error instanceof Error ? error.message : String(error)\n      });\n    }\n  });\n\n  // Update invoice_number for both orders and invoices\n  app.put(\"/api/einvoice/update-invoice-number\", async (req: TenantRequest, res) => {\n    try {\n      const { orderId, invoiceId, invoiceNumber } = req.body;\n      const tenantDb = await getTenantDatabase(req);\n\n      console.log(\"=== UPDATING INVOICE NUMBER ===\");\n      console.log(\"Order ID:\", orderId);\n      console.log(\"Invoice ID:\", invoiceId);\n      console.log(\"Invoice Number:\", invoiceNumber);\n\n      const updateResults: any = {};\n\n      // Update orders table if orderId is provided\n      if (orderId) {\n        try {\n          const [updatedOrder] = await db\n            .update(orders)\n            .set({\n              invoiceNumber: invoiceNumber,\n              updatedAt: new Date()\n            })\n            .where(eq(orders.id, orderId))\n            .returning();\n\n          if (updatedOrder) {\n            updateResults.order = updatedOrder;\n            console.log(\"✅ Order invoice_number updated successfully:\", updatedOrder);\n          } else {\n            console.error(\"❌ Order not found for ID:\", orderId);\n            updateResults.orderError = \"Order not found\";\n          }\n        } catch (orderError) {\n          console.error(\"❌ Error updating order:\", orderError);\n          updateResults.orderError = orderError.message;\n        }\n      }\n\n      // Update invoices table if invoiceId is provided\n      if (invoiceId) {\n        try {\n          const [updatedInvoice] = await db\n            .update(invoices)\n            .set({\n              invoiceNumber: invoiceNumber,\n              updatedAt: new Date()\n            })\n            .where(eq(invoices.id, invoiceId))\n            .returning();\n\n          if (updatedInvoice) {\n            updateResults.invoice = updatedInvoice;\n            console.log(\"✅ Invoice invoice_number updated successfully:\", updatedInvoice);\n          } else {\n            console.error(\"❌ Invoice not found for ID:\", invoiceId);\n            updateResults.invoiceError = \"Invoice not found\";\n          }\n        } catch (invoiceError) {\n          console.error(\"❌ Error updating invoice:\", invoiceError);\n          updateResults.invoiceError = invoiceError.message;\n        }\n      }\n\n      res.json({\n        success: true,\n        message: \"Invoice number updated successfully\",\n        results: updateResults\n      });\n\n    } catch (error) {\n      console.error(\"=== UPDATE INVOICE NUMBER ERROR ===\");\n      console.error(\"Error:\", error);\n\n      res.status(500).json({\n        error: \"Failed to update invoice number\",\n        details: error instanceof Error ? error.message : \"Unknown error\"\n      });\n    }\n  });\n\n  // E-invoice publish proxy endpoint\n  app.post(\"/api/einvoice/publish\", async (req: TenantRequest, res) => {\n    try {\n      const publishRequest = req.body;\n      const tenantDb = await getTenantDatabase(req);\n      console.log(\"Publishing invoice with data:\", JSON.stringify(publishRequest, null, 2));\n\n      // Call the real e-invoice API\n      const response = await fetch(\"https://infoerpvn.com:9440/api/invoice/publish\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"Accept\": \"application/json\",\n          \"token\": \"EnURbbnPhUm4GjNgE4Ogrw==\"\n        },\n        body: JSON.stringify(publishRequest)\n      });\n\n      if (!response.ok) {\n        console.error(\"E-invoice API error:\", response.status, response.statusText);\n        const errorText = await response.text();\n        console.error(\"Error response:\", errorText);\n\n        return res.status(response.status).json({\n          error: \"Failed to publish invoice\",\n          details: `API returned ${response.status}: ${response.statusText}`,\n          apiResponse: errorText\n        });\n      }\n\n      const result = await response.json();\n      console.log(\"E-invoice API response:\", result);\n\n      // Check if the API returned success\n      if (result.status === true) {\n        console.log(\"Invoice published successfully:\", result);\n\n        // Return standardized response format\n        res.json({\n          success: true,\n          message: result.message || \"Hóa đơn điện tử đã được phát hành thành công\",\n          data: {\n            invoiceNo: result.data?.invoiceNo,\n            invDate: result.data?.invDate,\n            transactionID: result.data?.transactionID,\n            macqt: result.data?.macqt,\n            originalRequest: {\n              transactionID: publishRequest.transactionID,\n              invRef: publishRequest.invRef,\n              totalAmount: publishRequest.invTotalAmount,\n              customer: publishRequest.Customer\n            }\n          }\n        });\n      } else {\n        // API returned failure\n        console.error(\"E-invoice API returned failure:\", result);\n        res.status(400).json({\n          error: \"E-invoice publication failed\",\n          message: result.message || \"Unknown error from e-invoice service\",\n          details: result\n        });\n      }\n\n    } catch (error) {\n      console.error(\"E-invoice publish proxy error details:\");\n      console.error(\"- Error type:\", error.constructor.name);\n      console.error(\"- Error message:\", error.message);\n      console.error(\"- Full error:\", error);\n\n      res.status(500).json({\n        error: \"Failed to publish invoice\",\n        details: error.message,\n        errorType: error.constructor.name\n      });\n    }\n  });\n\n  // Add einvoiceStatus column to orders table if it doesn't exist\n  try {\n    await db.execute(sql `\n      ALTER TABLE orders ADD COLUMN IF NOT EXISTS einvoice_status INTEGER NOT NULL DEFAULT 0\n    `);\n    console.log(\"Added einvoiceStatus column to orders table\");\n  } catch (error) {\n    console.log(\"einvoiceStatus column already exists in orders table or addition failed:\", error);\n  }\n\n\n\n  // Printer Configs API\n  app.get('/api/printer-configs', async (req, res) => {\n    try {\n      const tenantDb = await getTenantDatabase(req);\n      const result = await db.execute(sql `\n        SELECT id, name, printer_type, connection_type, ip_address, port, \n               mac_address, paper_width, print_speed, is_employee, is_kitchen, \n               is_active, created_at, updated_at\n        FROM printer_configs \n        ORDER BY id ASC\n      `);\n\n      const configs = result.rows.map(row => ({\n        id: row.id,\n        name: row.name,\n        printerType: row.printer_type,\n        connectionType: row.connection_type,\n        ipAddress: row.ip_address,\n        port: row.port,\n        macAddress: row.mac_address,\n        paperWidth: row.paper_width,\n        printSpeed: row.print_speed,\n        isEmployee: row.is_employee,\n        isKitchen: row.is_kitchen,\n        isActive: row.is_active,\n        createdAt: row.created_at,\n        updatedAt: row.updated_at\n      }));\n\n      res.json(configs);\n    } catch (error) {\n      console.error('Error fetching printer configs:', error);\n      res.status(500).json({ error: 'Failed to fetch printer configs' });\n    }\n  });\n\n  // Get active printer configs for auto-print\n  app.get('/api/printer-configs/active', async (req, res) => {\n    try {\n      const { type } = req.query; // 'employee', 'kitchen', or 'all'\n      const tenantDb = await getTenantDatabase(req);\n\n      let whereClause = 'WHERE is_active = true';\n      if (type === 'employee') {\n        whereClause += ' AND is_employee = true';\n      } else if (type === 'kitchen') {\n        whereClause += ' AND is_kitchen = true';\n      }\n\n      const result = await db.execute(sql `\n        SELECT id, name, printer_type, connection_type, ip_address, port, \n               mac_address, paper_width, print_speed, is_employee, is_kitchen, \n               is_active, created_at, updated_at\n        FROM printer_configs \n        ${sql.raw(whereClause)}\n        ORDER BY id ASC\n      `);\n\n      const configs = result.rows.map(row => ({\n        id: row.id,\n        name: row.name,\n        printerType: row.printer_type,\n        connectionType: row.connection_type,\n        ipAddress: row.ip_address,\n        port: row.port,\n        macAddress: row.mac_address,\n        paperWidth: row.paper_width,\n        printSpeed: row.print_speed,\n        isEmployee: row.is_employee,\n        isKitchen: row.is_kitchen,\n        isActive: row.is_active,\n        createdAt: row.created_at,\n        updatedAt: row.updated_at\n      }));\n\n      res.json(configs);\n    } catch (error) {\n      console.error('Error fetching active printer configs:', error);\n      res.status(500).json({ error: 'Failed to fetch active printer configs' });\n    }\n  });\n\n  // Auto-print API endpoint\n  app.post('/api/auto-print', async (req, res) => {\n    try {\n      const { receiptData, printerType } = req.body;\n      const tenantDb = await getTenantDatabase(req);\n\n      console.log('🖨️ Auto-print request:', { printerType, receiptData: !!receiptData });\n\n      // Get active printer configs based on type\n      let whereClause = 'WHERE is_active = true';\n      if (printerType === 'employee') {\n        whereClause += ' AND is_employee = true';\n      } else if (printerType === 'kitchen') {\n        whereClause += ' AND is_kitchen = true';\n      } else if (printerType === 'both') {\n        whereClause += ' AND (is_employee = true OR is_kitchen = true)';\n      }\n\n      const result = await db.execute(sql `\n        SELECT id, name, printer_type, connection_type, ip_address, port, \n               mac_address, paper_width, print_speed, is_employee, is_kitchen\n        FROM printer_configs \n        ${sql.raw(whereClause)}\n        ORDER BY is_employee DESC, is_kitchen DESC\n      `);\n\n      if (!result.rows || result.rows.length === 0) {\n        return res.status(404).json({\n          error: 'No active printer found',\n          message: 'Không tìm thấy máy in hoặc không có cấu hình máy in'\n        });\n      }\n\n      const printResults = [];\n\n      // Print to each configured printer\n      for (const printer of result.rows) {\n        try {\n          console.log(`🖨️ Printing to: ${printer.name} (${printer.connection_type})`);\n\n          // Mock print job - In real implementation, you would send to actual printer\n          if (printer.connection_type === 'network' && printer.ip_address) {\n            // Network printer logic\n            console.log(`📡 Sending to network printer at ${printer.ip_address}:${printer.port}`);\n          } else if (printer.connection_type === 'usb') {\n            // USB printer logic\n            console.log(`🔌 Sending to USB printer: ${printer.name}`);\n          } else if (printer.connection_type === 'bluetooth' && printer.mac_address) {\n            // Bluetooth printer logic\n            console.log(`📶 Sending to Bluetooth printer: ${printer.mac_address}`);\n          }\n\n          printResults.push({\n            printerId: printer.id,\n            printerName: printer.name,\n            status: 'success',\n            message: `In thành công trên máy ${printer.name}`\n          });\n\n          // Simulate print delay\n          await new Promise(resolve => setTimeout(resolve, 100));\n\n        } catch (printerError) {\n          console.error(`❌ Print failed for ${printer.name}:`, printerError);\n          printResults.push({\n            printerId: printer.id,\n            printerName: printer.name,\n            status: 'error',\n            message: `Lỗi in trên máy ${printer.name}: ${printerError.message}`\n          });\n        }\n      }\n\n      const successCount = printResults.filter(r => r.status === 'success').length;\n      const totalCount = printResults.length;\n\n      res.json({\n        success: successCount > 0,\n        message: `In thành công ${successCount}/${totalCount} máy in`,\n        results: printResults,\n        totalPrinters: totalCount,\n        successfulPrints: successCount\n      });\n\n    } catch (error) {\n      console.error('❌ Auto-print error:', error);\n      res.status(500).json({\n        error: 'Print failed',\n        message: 'Có lỗi xảy ra khi in hóa đơn'\n      });\n    }\n  });\n\n  app.post(\"/api/printer-configs\", async (req: TenantRequest, res) => {\n    try {\n      const tenantDb = await getTenantDatabase(req);\n      const configData = req.body;\n\n      // If setting as primary, unset all other primaries\n      if (configData.isPrimary) {\n        await db.execute(sql `UPDATE printer_configs SET is_primary = false`);\n      }\n\n      // If setting as secondary, unset all other secondaries\n      if (configData.isSecondary) {\n        await db.execute(sql `UPDATE printer_configs SET is_secondary = false`);\n      }\n\n      const result = await db.execute(sql `\n        INSERT INTO printer_configs (\n          name, printer_type, connection_type, ip_address, port, mac_address,\n          paper_width, print_speed, is_employee, is_kitchen, is_active\n        ) VALUES (\n          ${configData.name}, ${configData.printerType}, ${configData.connectionType},\n          ${configData.ipAddress || null}, ${configData.port || null}, ${configData.macAddress || null},\n          ${configData.paperWidth}, ${configData.printSpeed}, ${configData.isEmployee || false}, ${configData.isKitchen || false}, ${configData.isActive !== false}\n        ) RETURNING *\n      `);\n\n      if (!result.rows || result.rows.length === 0) {\n        return res.status(500).json({ error: \"Failed to create printer config\" });\n      }\n\n      res.status(201).json(result.rows[0]);\n    } catch (error) {\n      console.error(\"Error creating printer config:\", error);\n      res.status(500).json({ error: \"Failed to create printer config\" });\n    }\n  });\n\n  app.put(\"/api/printer-configs/:id\", async (req: TenantRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const tenantDb = await getTenantDatabase(req);\n      const configData = req.body;\n\n      // If setting as employee printer, unset all other employee printers\n      if (configData.isEmployee) {\n        await db.execute(sql `UPDATE printer_configs SET is_employee = false WHERE id != ${id}`);\n      }\n\n      // If setting as kitchen printer, unset all other kitchen printers\n      if (configData.isKitchen) {\n        await db.execute(sql `UPDATE printer_configs SET is_kitchen = false WHERE id != ${id}`);\n      }\n\n      const result = await db.execute(sql `\n        UPDATE printer_configs SET\n          name = ${configData.name},\n          printer_type = ${configData.printerType},\n          connection_type = ${configData.connectionType},\n          ip_address = ${configData.ipAddress || null},\n          port = ${configData.port || null},\n          mac_address = ${configData.macAddress || null},\n          paper_width = ${configData.paperWidth},\n          print_speed = ${configData.printSpeed},\n          is_employee = ${configData.isEmployee},\n          is_kitchen = ${configData.isKitchen},\n          is_active = ${configData.isActive !== false}\n        WHERE id = ${id}\n        RETURNING *\n      `);\n\n      if (!result.rows || result.rows.length === 0) {\n        return res.status(404).json({ error: \"Printer config not found\" });\n      }\n\n      res.json(result.rows[0]);\n    } catch (error) {\n      console.error(\"Error updating printer config:\", error);\n      res.status(500).json({ error: \"Failed to update printer config\" });\n    }\n  });\n\n  app.delete(\"/api/printer-configs/:id\", async (req: TenantRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const tenantDb = await getTenantDatabase(req);\n\n      const result = await db.execute(sql `DELETE FROM printer_configs WHERE id = ${id}`);\n\n      if (result.rowCount === 0) {\n        return res.status(404).json({ error: \"Printer config not found\" });\n      }\n\n      res.json({ message: \"Printer config deleted successfully\" });\n    } catch (error) {\n      console.error(\"Error deleting printer config:\", error);\n      res.status(500).json({ error: \"Failed to delete printer config\" });\n    }\n  });\n\n  app.post(\"/api/printer-configs/:id/test\", async (req: TenantRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const tenantDb = await getTenantDatabase(req);\n\n      const result = await db.execute(sql `\n        SELECT * FROM printer_configs WHERE id = ${id}\n      `);\n\n      if (!result.rows || result.rows.length === 0) {\n        return res.status(404).json({ error: \"Printer config not found\" });\n      }\n\n      const config = result.rows[0];\n\n      // Mock test print functionality\n      console.log(`Testing printer: ${config.name}`);\n\n      res.json({\n        message: \"Test print sent successfully\",\n        printer: config.name,\n        status: \"success\"\n      });\n    } catch (error) {\n      console.error(\"Error testing printer:\", error);\n      res.status(500).json({ error: \"Failed to test printer\" });\n    }\n  });\n\n  // Save invoice as order (for both \"Phát hành\" and \"Phát hành sau\" functionality)\n  app.post(\"/api/invoices/save-as-order\", async (req: TenantRequest, res) => {\n    try {\n      const invoiceData = req.body;\n      const { publishType } = invoiceData; // \"publish\" hoặc \"draft\"\n      const tenantDb = await getTenantDatabase(req);\n      console.log(\"Creating order from invoice data:\", JSON.stringify(invoiceData, null, 2));\n\n      // Validate required fields\n      if (!invoiceData.total || !invoiceData.customerName || !invoiceData.items) {\n        return res.status(400).json({\n          error: \"Missing required fields\",\n          details: \"total, customerName and items are required\",\n          received: invoiceData\n        });\n      }\n\n      // Calculate totals\n      const subtotal = parseFloat(invoiceData.subtotal || \"0\");\n      const tax = parseFloat(invoiceData.tax || \"0\");\n      const total = parseFloat(invoiceData.total || \"0\");\n\n      // Determine einvoice status based on publish type\n      let einvoiceStatus = 0; // Default: Chưa phát hành\n      let orderStatus = 'draft';\n      let statusMessage = \"Đơn hàng đã được lưu để phát hành hóa đơn sau\";\n\n      if (publishType === \"publish\") {\n        einvoiceStatus = 1; // Đã phát hành\n        orderStatus = 'paid';\n        statusMessage = \"Hóa đơn điện tử đã được phát hành thành công\";\n      }\n\n      // Create order data\n      const orderData = {\n        orderNumber: `ORD-${Date.now()}`,\n        tableId: null, // No table for POS orders\n        customerName: invoiceData.customerName,\n        customerPhone: invoiceData.customerPhone || null,\n        customerEmail: invoiceData.customerEmail || null,\n        subtotal: subtotal.toFixed(2),\n        tax: tax.toFixed(2),\n        total: total.toFixed(2),\n        status: orderStatus,\n        paymentMethod: 'einvoice',\n        paymentStatus: publishType === \"publish\" ? 'paid' : 'pending',\n        einvoiceStatus: einvoiceStatus,\n        notes: `E-Invoice Info - Tax Code: ${invoiceData.customerTaxCode || 'N/A'}, Address: ${invoiceData.customerAddress || 'N/A'}`,\n        orderedAt: new Date(),\n        employeeId: null, // Can be set if employee info is available\n        salesChannel: 'pos'\n      };\n\n      console.log(\"Order data to save:\", orderData);\n\n      // Save order\n      const [savedOrder] = await db\n        .insert(orders)\n        .values(orderData)\n        .returning();\n\n      console.log(\"Order saved:\", savedOrder);\n\n      // Save order items\n      if (invoiceData.items && Array.isArray(invoiceData.items)) {\n        const orderItemsData = invoiceData.items.map((item: any) => ({\n          orderId: savedOrder.id,\n          productId: item.productId,\n          productName: item.productName,\n          quantity: item.quantity,\n          unitPrice: item.unitPrice.toString(),\n          total: item.total.toString(),\n          notes: `Tax Rate: ${item.taxRate}%`\n        }));\n\n        const savedItems = await db\n          .insert(orderItems)\n          .values(orderItemsData)\n          .returning();\n\n        console.log(\"Order items saved:\", savedItems.length);\n      }\n\n      res.status(201).json({\n        success: true,\n        order: savedOrder,\n        message: statusMessage,\n        einvoiceStatus: einvoiceStatus\n      });\n\n    } catch (error) {\n      console.error(\"=== SAVE ORDER FROM INVOICE ERROR ===\");\n      console.error(\"Error:\", error);\n\n      res.status(500).json({\n        error: \"Failed to save order from invoice\",\n        details: error instanceof Error ? error.message : \"Unknown error\"\n      });\n    }\n  });\n\n  // Sales Chart Report API endpoints - Updated with proper filtering\n  app.get(\"/api/transactions/:startDate/:endDate/:salesMethod/:salesChannel/:analysisType/:concernType/:selectedEmployee\", async (req: TenantRequest, res) => {\n    try {\n      const { startDate, endDate, salesMethod, salesChannel, analysisType, concernType, selectedEmployee } = req.params;\n      const tenantDb = await getTenantDatabase(req);\n\n      console.log(\"Transactions API called with params:\", { startDate, endDate, salesMethod, salesChannel, analysisType, concernType, selectedEmployee });\n\n      // Get transactions data\n      const transactions = await storage.getTransactions(tenantDb);\n\n      // Filter transactions based on parameters\n      const filteredTransactions = transactions.filter((transaction: any) => {\n        const transactionDate = new Date(transaction.createdAt);\n        const start = new Date(startDate);\n        const end = new Date(endDate);\n        end.setHours(23, 59, 59, 999);\n\n        const dateMatch = transactionDate >= start && transactionDate <= end;\n\n        // Enhanced sales method filtering\n        let salesMethodMatch = true;\n        if (salesMethod !== 'all') {\n          const paymentMethod = transaction.paymentMethod || 'cash';\n          switch (salesMethod) {\n            case 'no_delivery':\n              salesMethodMatch = !transaction.deliveryMethod || transaction.deliveryMethod === 'pickup' || transaction.deliveryMethod === 'takeaway';\n              break;\n            case 'delivery':\n              salesMethodMatch = transaction.deliveryMethod === 'delivery';\n              break;\n            default:\n              salesMethodMatch = paymentMethod.toLowerCase() === salesMethod.toLowerCase();\n          }\n        }\n\n        // Enhanced sales channel filtering\n        let salesChannelMatch = true;\n        if (salesChannel !== 'all') {\n          const channel = transaction.salesChannel || 'direct';\n          switch (salesChannel) {\n            case 'direct':\n              salesChannelMatch = !transaction.salesChannel || transaction.salesChannel === 'direct' || transaction.salesChannel === 'pos';\n              break;\n            case 'other':\n              salesChannelMatch = transaction.salesChannel && transaction.salesChannel !== 'direct' && transaction.salesChannel !== 'pos';\n              break;\n            default:\n              salesChannelMatch = channel.toLowerCase() === salesChannel.toLowerCase();\n          }\n        }\n\n        // Enhanced employee filtering\n        let employeeMatch = true;\n        if (selectedEmployee !== 'all') {\n          employeeMatch =\n            transaction.cashierName === selectedEmployee ||\n            transaction.employeeId?.toString() === selectedEmployee ||\n            (transaction.cashierName && transaction.cashierName.toLowerCase().includes(selectedEmployee.toLowerCase()));\n        }\n\n        return dateMatch && salesMethodMatch && salesChannelMatch && employeeMatch;\n      });\n\n      console.log(`Found ${filteredTransactions.length} filtered transactions out of ${transactions.length} total`);\n      res.json(filteredTransactions);\n    } catch (error) {\n      console.error(\"Error in transactions API:\", error);\n      res.status(500).json({ error: \"Failed to fetch transactions data\" });\n    }\n  });\n\n  app.get(\"/api/orders/:startDate/:endDate/:selectedEmployee/:salesChannel/:salesMethod/:analysisType/:concernType\", async (req: TenantRequest, res) => {\n    try {\n      const { startDate, endDate, selectedEmployee, salesChannel, salesMethod, analysisType, concernType } = req.params;\n      const tenantDb = await getTenantDatabase(req);\n\n      console.log(\"Orders API called with params:\", { startDate, endDate, selectedEmployee, salesChannel, salesMethod, analysisType, concernType });\n\n      // Get orders data\n      const orders = await storage.getOrders(undefined, undefined, tenantDb);\n\n      // Filter orders based on parameters with enhanced logic\n      const filteredOrders = orders.filter((order: any) => {\n        const orderDate = new Date(order.orderedAt || order.createdAt);\n        const start = new Date(startDate);\n        const end = new Date(endDate);\n        end.setHours(23, 59, 59, 999);\n\n        const dateMatch = orderDate >= start && orderDate <= end;\n\n        // Enhanced employee filtering\n        let employeeMatch = true;\n        if (selectedEmployee !== 'all') {\n          employeeMatch =\n            order.employeeId?.toString() === selectedEmployee ||\n            (order.employeeName && order.employeeName.toLowerCase().includes(selectedEmployee.toLowerCase()));\n        }\n\n        // Enhanced sales channel filtering\n        let salesChannelMatch = true;\n        if (salesChannel !== 'all') {\n          const channel = order.salesChannel || 'direct';\n          switch (salesChannel) {\n            case 'direct':\n              salesChannelMatch = !order.salesChannel || order.salesChannel === 'direct' || order.salesChannel === 'pos';\n              break;\n            case 'other':\n              salesChannelMatch = order.salesChannel && order.salesChannel !== 'direct' && order.salesChannel !== 'pos';\n              break;\n            default:\n              salesChannelMatch = channel.toLowerCase() === salesChannel.toLowerCase();\n          }\n        }\n\n        // Enhanced sales method filtering\n        let salesMethodMatch = true;\n        if (salesMethod !== 'all') {\n          switch (salesMethod) {\n            case 'no_delivery':\n              salesMethodMatch = !order.deliveryMethod || order.deliveryMethod === 'pickup' || order.deliveryMethod === 'takeaway';\n              break;\n            case 'delivery':\n              salesMethodMatch = order.deliveryMethod === 'delivery';\n              break;\n            default:\n              const paymentMethod = order.paymentMethod || 'cash';\n              salesMethodMatch = paymentMethod.toLowerCase() === salesMethod.toLowerCase();\n          }\n        }\n\n        // Only include paid orders for analysis\n        const statusMatch = order.status === 'paid';\n\n        return dateMatch && employeeMatch && salesChannelMatch && salesMethodMatch && statusMatch;\n      });\n\n      console.log(`Found ${filteredOrders.length} filtered orders out of ${orders.length} total`);\n      res.json(filteredOrders);\n    } catch (error) {\n      console.error(\"Error in orders API:\", error);\n      res.status(500).json({ error: \"Failed to fetch orders data\" });\n    }\n  });\n\n  app.get(\"/api/products/:selectedCategory/:productType/:productSearch?\", async (req: TenantRequest, res) => {\n    try {\n      const { selectedCategory, productType, productSearch } = req.params;\n      const tenantDb = await getTenantDatabase(req);\n\n      console.log(\"Products API called with params:\", { selectedCategory, productType, productSearch });\n\n      let products;\n\n      // Get products by category or all products\n      if (selectedCategory && selectedCategory !== 'all' && selectedCategory !== 'undefined') {\n        const categoryId = parseInt(selectedCategory);\n        if (!isNaN(categoryId)) {\n          products = await storage.getProductsByCategory(categoryId, true, tenantDb);\n        } else {\n          products = await storage.getAllProducts(true, tenantDb);\n        }\n      } else {\n        products = await storage.getAllProducts(true, tenantDb);\n      }\n\n      // Filter by product type if specified\n      if (productType && productType !== 'all' && productType !== 'undefined') {\n        const typeMap = {\n          combo: 3,\n          'combo-dongoi': 3,\n          product: 1,\n          'hang-hoa': 1,\n          service: 2,\n          'dich-vu': 2\n        };\n        const typeValue = typeMap[productType.toLowerCase() as keyof typeof typeMap];\n        if (typeValue) {\n          products = products.filter((product: any) => product.productType === typeValue);\n        }\n      }\n\n      // Filter by product search if provided\n      if (productSearch && productSearch !== '' && productSearch !== 'undefined' && productSearch !== 'all') {\n        const searchTerm = productSearch.toLowerCase();\n        products = products.filter((product: any) =>\n          product.name?.toLowerCase().includes(searchTerm) ||\n          product.sku?.toLowerCase().includes(searchTerm) ||\n          product.description?.toLowerCase().includes(searchTerm)\n        );\n      }\n\n      console.log(`Found ${products.length} products after filtering`);\n      res.json(products);\n    } catch (error) {\n      console.error(\"Error in products API:\", error);\n      res.status(500).json({ error: \"Failed to fetch products data\" });\n    }\n  });\n\n  app.get(\"/api/customers/:customerSearch?/:customerStatus?\", async (req: TenantRequest, res) => {\n    try {\n      const { customerSearch, customerStatus } = req.params;\n      const tenantDb = await getTenantDatabase(req);\n\n      console.log(\"Customers API called with search:\", customerSearch, \"status:\", customerStatus);\n\n      let customers = await storage.getCustomers(tenantDb);\n\n      // Filter by search if provided\n      if (customerSearch && customerSearch !== '' && customerSearch !== 'undefined' && customerSearch !== 'all') {\n        const searchTerm = customerSearch.toLowerCase();\n        customers = customers.filter((customer: any) =>\n          customer.name?.toLowerCase().includes(searchTerm) ||\n          customer.phone?.includes(customerSearch) ||\n          customer.email?.toLowerCase().includes(searchTerm) ||\n          customer.customerId?.toLowerCase().includes(searchTerm) ||\n          customer.address?.toLowerCase().includes(searchTerm)\n        );\n      }\n\n      // Filter by status if provided\n      if (customerStatus && customerStatus !== 'all' && customerStatus !== 'undefined') {\n        const now = new Date();\n        const thirtyDaysAgo = new Date();\n        thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n\n        customers = customers.filter((customer: any) => {\n          const totalSpent = Number(customer.totalSpent || 0);\n          const lastVisit = customer.lastVisit ? new Date(customer.lastVisit) : null;\n\n          switch (customerStatus) {\n            case 'active':\n              return lastVisit && lastVisit >= thirtyDaysAgo;\n            case 'inactive':\n              return !lastVisit || lastVisit < thirtyDaysAgo;\n            case 'vip':\n              return totalSpent >= 500000; // VIP customers with total spent >= 500k VND\n            case 'new':\n              const joinDate = customer.createdAt ? new Date(customer.createdAt) : null;\n              return joinDate && joinDate >= thirtyDaysAgo;\n            default:\n              return true;\n          }\n        });\n      }\n\n      console.log(`Found ${customers.length} customers after filtering`);\n      res.json(customers);\n    } catch (error) {\n      console.error(\"Error in customers API:\", error);\n      res.status(500).json({ error: \"Failed to fetch customers data\" });\n    }\n  });\n\n  // Database health check\n  app.get(\"/api/health/db\", async (req, res) => {\n    try {\n      // Test basic connection with simple query\n      const result = await db.execute(sql `SELECT \n        current_database() as database_name,\n        current_user as user_name,\n        version() as postgres_version,\n        NOW() as server_time\n      `);\n\n      const dbInfo = result && result.length > 0 ? result[0] : {};\n\n      res.json({\n        status: \"healthy\",\n        database: dbInfo.database_name,\n        user: dbInfo.user_name,\n        version: dbInfo.postgres_version,\n        serverTime: dbInfo.server_time,\n        connectionString: process.env.DATABASE_URL?.replace(/:[^:@]*@/, ':****@'),\n        usingExternalDb: !!process.env.EXTERNAL_DB_URL\n      });\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      console.error(\"Database health check failed:\", error);\n\n      res.status(500).json({\n        status: \"unhealthy\",\n        error: errorMessage,\n        connectionString: process.env.DATABASE_URL?.replace(/:[^:@]*@/, ':****@'),\n        usingExternalDb: !!process.env.EXTERNAL_DB_URL,\n        details: error\n      });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}","size_bytes":160372},"server/storage.ts":{"content":"import {\n  categories,\n  products,\n  transactions,\n  transactionItems,\n  employees,\n  attendanceRecords,\n  tables,\n  orders,\n  orderItems,\n  storeSettings,\n  suppliers,\n  type Category,\n  type Product,\n  type Transaction,\n  type TransactionItem,\n  type Employee,\n  type AttendanceRecord,\n  type Table,\n  type Order,\n  type OrderItem,\n  type StoreSettings,\n  type InsertCategory,\n  type InsertProduct,\n  type InsertTransaction,\n  type InsertTransactionItem,\n  type InsertEmployee,\n  type InsertAttendance,\n  type InsertTable,\n  type InsertOrder,\n  type InsertOrderItem,\n  type InsertStoreSettings,\n  type Receipt,\n  type InsertSupplier,\n  customers,\n  pointTransactions,\n  type Customer,\n  type InsertCustomer,\n  type PointTransaction,\n  type InsertPointTransaction,\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, ilike, and, gte, lte, or, sql, desc, not, like } from \"drizzle-orm\";\n\nexport interface IStorage {\n  // Categories\n  getCategories(): Promise<Category[]>;\n  createCategory(category: InsertCategory): Promise<Category>;\n  updateCategory(\n    id: number,\n    updateData: Partial<InsertCategory>,\n  ): Promise<Category>;\n  deleteCategory(id: number): Promise<void>;\n\n  // Products\n  getProducts(): Promise<Product[]>;\n  getProductsByCategory(\n    categoryId: number,\n    includeInactive?: boolean,\n  ): Promise<Product[]>;\n  getProduct(id: number): Promise<Product | undefined>;\n  getProductBySku(sku: string): Promise<Product | undefined>;\n  searchProducts(query: string, includeInactive?: boolean): Promise<Product[]>;\n  createProduct(product: InsertProduct): Promise<Product>;\n  updateProduct(\n    id: number,\n    product: Partial<InsertProduct>,\n  ): Promise<Product | undefined>;\n  deleteProduct(id: number): Promise<boolean>;\n  deleteInactiveProducts(): Promise<number>;\n  updateProductStock(\n    id: number,\n    quantity: number,\n  ): Promise<Product | undefined>;\n\n  // Inventory Management\n  updateInventoryStock(\n    productId: number,\n    quantity: number,\n    type: \"add\" | \"subtract\" | \"set\",\n    notes?: string,\n  ): Promise<Product | undefined>;\n\n  // Transactions\n  createTransaction(\n    transaction: InsertTransaction,\n    items: InsertTransactionItem[],\n  ): Promise<Receipt>;\n  getTransaction(id: number): Promise<Receipt | undefined>;\n  getTransactionByTransactionId(\n    transactionId: string,\n  ): Promise<Receipt | undefined>;\n  getTransactions(): Promise<Transaction[]>;\n\n  // Employees\n  getEmployees(): Promise<Employee[]>;\n  getEmployee(id: number): Promise<Employee | undefined>;\n  getEmployeeByEmployeeId(employeeId: string): Promise<Employee | undefined>;\n  createEmployee(employee: InsertEmployee): Promise<Employee>;\n  updateEmployee(\n    id: number,\n    employee: Partial<InsertEmployee>,\n  ): Promise<Employee | undefined>;\n  deleteEmployee(id: number): Promise<boolean>;\n  getNextEmployeeId(): Promise<string>;\n\n  // Attendance\n  getAttendanceRecords(\n    employeeId?: number,\n    date?: string,\n  ): Promise<AttendanceRecord[]>;\n  getAttendanceRecord(id: number): Promise<AttendanceRecord | undefined>;\n  getTodayAttendance(employeeId: number): Promise<AttendanceRecord | undefined>;\n  clockIn(employeeId: number, notes?: string): Promise<AttendanceRecord>;\n  clockOut(attendanceId: number): Promise<AttendanceRecord | undefined>;\n  startBreak(attendanceId: number): Promise<AttendanceRecord | undefined>;\n  endBreak(attendanceId: number): Promise<AttendanceRecord | undefined>;\n  updateAttendanceStatus(\n    id: number,\n    status: string,\n  ): Promise<AttendanceRecord | undefined>;\n\n  // Tables\n  getTables(): Promise<Table[]>;\n  getTable(id: number): Promise<Table | undefined>;\n  getTableByNumber(tableNumber: string): Promise<Table | undefined>;\n  createTable(table: InsertTable): Promise<Table>;\n  updateTable(\n    id: number,\n    table: Partial<InsertTable>,\n  ): Promise<Table | undefined>;\n  updateTableStatus(id: number, status: string): Promise<Table | undefined>;\n  deleteTable(id: number): Promise<boolean>;\n\n  // Orders\n  getOrders(tableId?: number, status?: string): Promise<Order[]>;\n  getOrder(id: number): Promise<Order | undefined>;\n  getOrderByNumber(orderNumber: string): Promise<Order | undefined>;\n  createOrder(order: InsertOrder, items: InsertOrderItem[]): Promise<Order>;\n  updateOrder(\n    id: number,\n    order: Partial<InsertOrder>,\n  ): Promise<Order | undefined>;\n  updateOrderStatus(id: number, status: string): Promise<Order | undefined>;\n  addOrderItems(\n    orderId: number,\n    items: InsertOrderItem[],\n  ): Promise<OrderItem[]>;\n  removeOrderItem(itemId: number): Promise<boolean>;\n  getOrderItems(orderId: number): Promise<OrderItem[]>;\n\n  // Store Settings\n  getStoreSettings(): Promise<StoreSettings>;\n  updateStoreSettings(\n    settings: Partial<InsertStoreSettings>,\n  ): Promise<StoreSettings>;\n\n  // Suppliers\n  getSuppliers(): Promise<any>;\n  getSupplier(id: number): Promise<any>;\n  getSuppliersByStatus(status: string): Promise<any>;\n  searchSuppliers(query: string): Promise<any>;\n  createSupplier(data: InsertSupplier): Promise<any>;\n  updateSupplier(id: number, data: Partial<InsertSupplier>): Promise<any>;\n  deleteSupplier(id: number): Promise<boolean>;\n\n  // Customers\n  getCustomers(): Promise<Customer[]>;\n  searchCustomers(query: string): Promise<Customer[]>;\n  getCustomer(id: number): Promise<Customer | undefined>;\n  getCustomerByCustomerId(customerId: string): Promise<Customer | undefined>;\n  createCustomer(customer: InsertCustomer): Promise<Customer>;\n  updateCustomer(\n    id: number,\n    customer: Partial<InsertCustomer>,\n  ): Promise<Customer | undefined>;\n  deleteCustomer(id: number): Promise<boolean>;\n  updateCustomerVisit(\n    customerId: number,\n    amount: number,\n    points: number,\n  ): Promise<Customer | undefined>;\n\n  // Point Management\n  getCustomerPoints(\n    customerId: number,\n  ): Promise<{ points: number } | undefined>;\n  updateCustomerPoints(\n    customerId: number,\n    points: number,\n    description: string,\n    type: \"earned\" | \"redeemed\" | \"adjusted\",\n    employeeId?: number,\n    orderId?: number,\n  ): Promise<PointTransaction>;\n  getPointHistory(\n    customerId: number,\n    limit?: number,\n  ): Promise<PointTransaction[]>;\n\n  getAllPointTransactions(limit?: number): Promise<PointTransaction[]>;\n\n  getMembershipThresholds(): Promise<{ GOLD: number; VIP: number }>;\n  updateMembershipThresholds(thresholds: {\n    GOLD: number;\n    VIP: number;\n  }): Promise<{ GOLD: number; VIP: number }>;\n  recalculateAllMembershipLevels(\n    goldThreshold: number,\n    vipThreshold: number,\n  ): Promise<void>;\n\n  getAllProducts(includeInactive?: boolean): Promise<Product[]>;\n  getActiveProducts(): Promise<Product[]>;\n\n  // E-invoice connections\n  getEInvoiceConnections(): Promise<any[]>;\n  getEInvoiceConnection(id: number): Promise<any>;\n  createEInvoiceConnection(data: any): Promise<any>;\n  updateEInvoiceConnection(id: number, data: any): Promise<any>;\n  deleteEInvoiceConnection(id: number): Promise<boolean>;\n\n  getEmployeeByEmail(email: string): Promise<Employee | undefined>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  async getCategories(tenantDb?: any): Promise<Category[]> {\n    const database = tenantDb || db;\n    return await database.select().from(categories);\n  }\n\n  async createCategory(insertCategory: InsertCategory, tenantDb?: any): Promise<Category> {\n    const database = tenantDb || db;\n    const [category] = await database\n      .insert(categories)\n      .values(insertCategory)\n      .returning();\n    return category;\n  }\n\n  async updateCategory(\n    id: number,\n    updateData: Partial<InsertCategory>,\n    tenantDb?: any,\n  ): Promise<Category> {\n    const database = tenantDb || db;\n    const [category] = await database\n      .update(categories)\n      .set(updateData)\n      .where(eq(categories.id, id))\n      .returning();\n    return category;\n  }\n\n  async deleteCategory(id: number, tenantDb?: any): Promise<void> {\n    const database = tenantDb || db;\n    await database.delete(categories).where(eq(categories.id, id));\n  }\n\n  async getProducts(tenantDb?: any): Promise<Product[]> {\n    const database = tenantDb || db;\n    const result = await database\n      .select()\n      .from(products)\n      .where(eq(products.isActive, true));\n    // Ensure productType has a default value if missing and afterTaxPrice is properly returned\n    return result.map((product) => ({\n      ...product,\n      productType: product.productType || 1,\n      afterTaxPrice: product.afterTaxPrice || null\n    }));\n  }\n\n  async getProductsByCategory(\n    categoryId: number,\n    includeInactive: boolean = false,\n    tenantDb?: any,\n  ): Promise<Product[]> {\n    const database = tenantDb || db;\n    let whereCondition = eq(products.categoryId, categoryId);\n\n    if (!includeInactive) {\n      whereCondition = and(whereCondition, eq(products.isActive, true));\n    }\n\n    const result = await database\n      .select()\n      .from(products)\n      .where(whereCondition)\n      .orderBy(products.name);\n\n    // Ensure afterTaxPrice is properly returned\n    return result.map((product) => ({\n      ...product,\n      afterTaxPrice: product.afterTaxPrice || null\n    }));\n  }\n\n  async getProduct(id: number, tenantDb?: any): Promise<Product | undefined> {\n    const database = tenantDb || db;\n    const [product] = await database\n      .select()\n      .from(products)\n      .where(and(eq(products.id, id), eq(products.isActive, true)));\n    return product || undefined;\n  }\n\n  async getProductBySku(sku: string, tenantDb?: any): Promise<Product | undefined> {\n    const database = tenantDb || db;\n    const [product] = await database\n      .select()\n      .from(products)\n      .where(and(eq(products.sku, sku), eq(products.isActive, true)));\n    return product || undefined;\n  }\n\n  async searchProducts(\n    query: string,\n    includeInactive: boolean = false,\n    tenantDb?: any,\n  ): Promise<Product[]> {\n    const database = tenantDb || db;\n    let whereCondition = or(\n      ilike(products.name, `%${query}%`),\n      ilike(products.sku, `%${query}%`)\n    );\n\n    if (!includeInactive) {\n      whereCondition = and(whereCondition, eq(products.isActive, true));\n    }\n\n    return await database.select().from(products).where(whereCondition);\n  }\n\n  async createProduct(insertProduct: InsertProduct, tenantDb?: any): Promise<Product> {\n    try {\n      console.log(\"Storage: Creating product with data:\", insertProduct);\n      const database = tenantDb || db;\n\n      const productData = {\n        name: insertProduct.name,\n        sku: insertProduct.sku,\n        price: insertProduct.price,\n        stock: insertProduct.stock,\n        categoryId: insertProduct.categoryId,\n        productType: insertProduct.productType || 1,\n        trackInventory: insertProduct.trackInventory !== false,\n        imageUrl: insertProduct.imageUrl || null,\n        isActive: true,\n      };\n\n      console.log(\"Storage: Inserting product data:\", productData);\n\n      const [product] = await database\n        .insert(products)\n        .values(productData)\n        .returning();\n\n      console.log(\"Storage: Product created successfully:\", product);\n      return product;\n    } catch (error) {\n      console.error(\"Storage: Error creating product:\", error);\n      throw error;\n    }\n  }\n\n  async updateProduct(\n    id: number,\n    updateData: Partial<InsertProduct>,\n    tenantDb?: any,\n  ): Promise<Product | undefined> {\n    const database = tenantDb || db;\n    const [product] = await database\n      .update(products)\n      .set({\n        ...updateData,\n        imageUrl: updateData.imageUrl || null,\n      })\n      .where(and(eq(products.id, id), eq(products.isActive, true)))\n      .returning();\n    return product || undefined;\n  }\n\n  async deleteProduct(id: number, tenantDb?: any): Promise<boolean> {\n    try {\n      const database = tenantDb || db;\n\n      // Check if product exists in transactions\n      const transactionItemsCheck = await database\n        .select()\n        .from(transactionItems)\n        .where(eq(transactionItems.productId, id))\n        .limit(1);\n\n      if (transactionItemsCheck.length > 0) {\n        throw new Error(\n          \"Cannot delete product: it has been used in transactions\",\n        );\n      }\n\n      // Check if product exists in order items\n      const orderItemsCheck = await database\n        .select()\n        .from(orderItems)\n        .where(eq(orderItems.productId, id))\n        .limit(1);\n\n      if (orderItemsCheck.length > 0) {\n        throw new Error(\"Cannot delete product: it has been used in orders\");\n      }\n\n      // If no references found, delete the product\n      const result = await database\n        .delete(products)\n        .where(eq(products.id, id))\n        .returning();\n\n      return result.length > 0;\n    } catch (error) {\n      console.error(\"Error deleting product:\", error);\n      throw error;\n    }\n  }\n\n  async deleteInactiveProducts(tenantDb?: any): Promise<number> {\n    const database = tenantDb || db;\n    const result = await database\n      .delete(products)\n      .where(eq(products.isActive, false))\n      .returning();\n    return result.length;\n  }\n\n  async updateProductStock(\n    id: number,\n    quantity: number,\n    tenantDb?: any,\n  ): Promise<Product | undefined> {\n    const database = tenantDb || db;\n\n    try {\n      console.log(`🔍 Starting stock update for product ID: ${id}, quantity change: ${quantity}`);\n\n      const [product] = await database\n        .select()\n        .from(products)\n        .where(eq(products.id, id));\n\n      if (!product) {\n        console.error(`❌ Product not found for stock update: ID ${id}`);\n        throw new Error(`Product with ID ${id} not found`);\n      }\n\n      console.log(`📋 Product found: ${product.name}, current stock: ${product.stock}, tracks inventory: ${product.trackInventory}`);\n\n      // Check if product tracks inventory before updating\n      if (!product.trackInventory) {\n        console.log(`⏭️ Product ${product.name} does not track inventory - skipping stock update`);\n        return product; // Return the original product without updating stock\n      }\n\n      const currentStock = product.stock || 0;\n      // Đơn giản: chỉ cần lấy tổng tồn kho hiện tại trừ đi số lượng bán\n      const newStock = currentStock - Math.abs(quantity);\n\n      // Log the stock calculation\n      console.log(`📦 Simple stock calculation for ${product.name} (ID: ${id}):`);\n      console.log(`   - Current stock: ${currentStock}`);\n      console.log(`   - Quantity to subtract: ${Math.abs(quantity)}`);\n      console.log(`   - New stock: ${newStock}`);\n\n      // Check if we have sufficient stock\n      if (newStock < 0) {\n        const errorMsg = `Insufficient stock for ${product.name}. Available: ${currentStock}, Required: ${Math.abs(quantity)}`;\n        console.error(`❌ ${errorMsg}`);\n        throw new Error(errorMsg);\n      }\n\n      const [updatedProduct] = await database\n        .update(products)\n        .set({ stock: newStock })\n        .where(eq(products.id, id))\n        .returning();\n\n      if (updatedProduct) {\n        console.log(`✅ Stock updated successfully for ${product.name}: ${currentStock} → ${newStock}`);\n\n        // Create inventory transaction record\n        try {\n          await database.execute(sql`\n            INSERT INTO inventory_transactions \n            (product_id, type, quantity, previous_stock, new_stock, notes, created_at)\n            VALUES (${id}, 'subtract', ${Math.abs(quantity)}, ${currentStock}, ${newStock}, \n                   'Stock deduction from sale', ${new Date().toISOString()})\n          `);\n          console.log(`📝 Inventory transaction recorded for ${product.name}`);\n        } catch (invError) {\n          console.error(`❌ Failed to record inventory transaction:`, invError);\n          // Don't throw here as the stock update was successful\n        }\n\n        return updatedProduct;\n      } else {\n        console.error(`❌ Failed to update stock for ${product.name} - no updated product returned`);\n        throw new Error(`Failed to update stock for product: ${product.name}`);\n      }\n    } catch (error) {\n      console.error(`❌ Error updating stock for product ID ${id}:`, error);\n      throw error; // Re-throw the error so the caller can handle it\n    }\n  }\n\n  async createTransaction(\n    insertTransaction: InsertTransaction,\n    items: InsertTransactionItem[],\n    tenantDb?: any,\n  ): Promise<Receipt> {\n    const database = tenantDb || db;\n    console.log(`🔄 Creating transaction: ${insertTransaction.transactionId}`);\n    console.log(`📦 Processing ${items.length} items for inventory deduction`);\n    console.log(`📋 Transaction details:`, JSON.stringify(insertTransaction, null, 2));\n\n    try {\n      // Create the main transaction record\n      const [transaction] = await database\n        .insert(transactions)\n        .values({\n          ...insertTransaction,\n          amountReceived: insertTransaction.amountReceived || null,\n          change: insertTransaction.change || null,\n        })\n        .returning();\n\n      console.log(`✅ Transaction record created with ID: ${transaction.id}`);\n\n      const transactionItemsWithIds: TransactionItem[] = [];\n      const stockUpdateResults: Array<{productName: string, success: boolean, error?: string}> = [];\n\n      // Process each item\n      for (let i = 0; i < items.length; i++) {\n        const item = items[i];\n        console.log(`📝 Processing item ${i + 1}/${items.length}: ${item.productName} (ID: ${item.productId}) - Qty: ${item.quantity}`);\n\n        try {\n          // Create transaction item record\n          const [transactionItem] = await database\n            .insert(transactionItems)\n            .values({\n              ...item,\n              transactionId: transaction.id,\n            })\n            .returning();\n\n          console.log(`✅ Transaction item created with ID: ${transactionItem.id}`);\n\n          // Update product stock - trừ tồn kho đơn giản\n          console.log(`🔢 Updating stock for product ID ${item.productId}: subtract ${item.quantity}`);\n\n          try {\n            const updatedProduct = await this.updateProductStock(item.productId, item.quantity, tenantDb);\n\n            if (updatedProduct) {\n              console.log(`✅ Stock successfully updated for ${item.productName}: New stock = ${updatedProduct.stock}`);\n              stockUpdateResults.push({\n                productName: item.productName,\n                success: true\n              });\n            } else {\n              const errorMsg = `Failed to update stock for ${item.productName} - no product returned`;\n              console.error(`❌ ${errorMsg}`);\n              stockUpdateResults.push({\n                productName: item.productName,\n                success: false,\n                error: errorMsg\n              });\n            }\n          } catch (stockError) {\n            const errorMsg = stockError instanceof Error ? stockError.message : String(stockError);\n            console.error(`❌ Stock update error for ${item.productName}:`, errorMsg);\n            stockUpdateResults.push({\n              productName: item.productName,\n              success: false,\n              error: errorMsg\n            });\n          }\n\n          transactionItemsWithIds.push(transactionItem);\n        } catch (itemError) {\n          console.error(`❌ Error processing transaction item ${item.productName}:`, itemError);\n          throw new Error(`Failed to process item ${item.productName}: ${itemError instanceof Error ? itemError.message : String(itemError)}`);\n        }\n      }\n\n      // Log stock update summary\n      const successfulUpdates = stockUpdateResults.filter(r => r.success);\n      const failedUpdates = stockUpdateResults.filter(r => !r.success);\n\n      console.log(`📊 Stock update summary:`);\n      console.log(`   - Successful: ${successfulUpdates.length}/${items.length}`);\n      console.log(`   - Failed: ${failedUpdates.length}/${items.length}`);\n\n      if (failedUpdates.length > 0) {\n        console.error(`❌ Failed stock updates:`, failedUpdates);\n        // Log but don't fail the transaction - the transaction was created successfully\n      }\n\n      console.log(`✅ Transaction created successfully: ${transaction.transactionId} with ${transactionItemsWithIds.length} items`);\n\n      return {\n        ...transaction,\n        items: transactionItemsWithIds,\n      };\n    } catch (error) {\n      console.error(`❌ Error creating transaction ${insertTransaction.transactionId}:`, error);\n      throw new Error(`Failed to create transaction: ${error instanceof Error ? error.message : String(error)}`);\n    }\n  }\n\n  async getTransaction(id: number): Promise<Receipt | undefined> {\n    const [transaction] = await db\n      .select()\n      .from(transactions)\n      .where(eq(transactions.id, id));\n\n    if (!transaction) return undefined;\n\n    const items = await db\n      .select()\n      .from(transactionItems)\n      .where(eq(transactionItems.transactionId, id));\n\n    return { ...transaction, items };\n  }\n\n  async getTransactionByTransactionId(\n    transactionId: string,\n  ): Promise<Receipt | undefined> {\n    const [transaction] = await db\n      .select()\n      .from(transactions)\n      .where(eq(transactions.transactionId, transactionId));\n\n    if (!transaction) return undefined;\n\n    const items = await db\n      .select()\n      .from(transactionItems)\n      .where(eq(transactionItems.transactionId, transaction.id));\n\n    return { ...transaction, items };\n  }\n\n  async getTransactions(tenantDb?: any): Promise<Transaction[]> {\n    const database = tenantDb || db;\n    return await database.select().from(transactions).orderBy(transactions.createdAt);\n  }\n\n  // Get next employee ID in sequence\n  async getNextEmployeeId(tenantDb?: any): Promise<string> {\n    const database = tenantDb || db;\n    try {\n      const lastEmployee = await database\n        .select()\n        .from(employees)\n        .orderBy(desc(employees.id))\n        .limit(1);\n\n      if (lastEmployee.length === 0) {\n        return \"EMP-001\";\n      }\n\n      // Extract number from last employee ID (EMP-001 -> 001)\n      const lastId = lastEmployee[0].employeeId;\n      const match = lastId.match(/EMP-(\\d+)/);\n\n      if (match) {\n        const lastNumber = parseInt(match[1], 10);\n        const nextNumber = lastNumber + 1;\n        return `EMP-${nextNumber.toString().padStart(3, \"0\")}`;\n      }\n\n      // Fallback if format doesn't match\n      return \"EMP-001\";\n    } catch (error) {\n      console.error(\"Error generating next employee ID:\", error);\n      return \"EMP-001\";\n    }\n  }\n\n  // Generate next customer ID\n  async getNextCustomerId(tenantDb?: any): Promise<string> {\n    const database = tenantDb || db;\n    try {\n      // Get all customer IDs that match the CUST pattern and extract numbers\n      const allCustomers = await database\n        .select({ customerId: customers.customerId })\n        .from(customers)\n        .where(like(customers.customerId, \"CUST%\"));\n\n      if (allCustomers.length === 0) {\n        return \"CUST001\";\n      }\n\n      // Extract all numbers from existing customer IDs\n      const existingNumbers = allCustomers\n        .map(customer => {\n          const match = customer.customerId.match(/CUST(\\d+)/);\n          return match ? parseInt(match[1], 10) : 0;\n        })\n        .filter(num => num > 0)\n        .sort((a, b) => b - a); // Sort descending\n\n      // Find the highest number and increment\n      const highestNumber = existingNumbers[0] || 0;\n      const nextNumber = highestNumber + 1;\n\n      return `CUST${nextNumber.toString().padStart(3, \"0\")}`;\n    } catch (error) {\n      console.error(\"Error generating next customer ID:\", error);\n      return \"CUST001\";\n    }\n  }\n\n  // Employee methods\n  async getEmployees(tenantDb?: any): Promise<Employee[]> {\n    const database = tenantDb || db;\n    return await database\n      .select()\n      .from(employees)\n      .where(eq(employees.isActive, true));\n  }\n\n  async getEmployee(id: number, tenantDb?: any): Promise<Employee | undefined> {\n    const database = tenantDb || db;\n    const [employee] = await database\n      .select()\n      .from(employees)\n      .where(and(eq(employees.id, id), eq(employees.isActive, true)));\n    return employee || undefined;\n  }\n\n  async getEmployeeByEmployeeId(\n    employeeId: string,\n    tenantDb?: any,\n  ): Promise<Employee | undefined> {\n    const database = tenantDb || db;\n    const [employee] = await database\n      .select()\n      .from(employees)\n      .where(\n        and(eq(employees.employeeId, employeeId), eq(employees.isActive, true)),\n      );\n    return employee || undefined;\n  }\n\n  async createEmployee(insertEmployee: InsertEmployee, tenantDb?: any): Promise<Employee> {\n    const database = tenantDb || db;\n    const [employee] = await database\n      .insert(employees)\n      .values(insertEmployee)\n      .returning();\n    return employee;\n  }\n\n  async updateEmployee(\n    id: number,\n    updateData: Partial<InsertEmployee>,\n    tenantDb?: any,\n  ): Promise<Employee | undefined> {\n    const database = tenantDb || db;\n    const [employee] = await database\n      .update(employees)\n      .set(updateData)\n      .where(and(eq(employees.id, id), eq(employees.isActive, true)))\n      .returning();\n    return employee || undefined;\n  }\n\n  async deleteEmployee(id: number, tenantDb?: any): Promise<boolean> {\n    const database = tenantDb || db;\n    try {\n      // Check if employee has attendance records\n      const attendanceCheck = await database\n        .select()\n        .from(attendanceRecords)\n        .where(eq(attendanceRecords.employeeId, id))\n        .limit(1);\n\n      if (attendanceCheck.length > 0) {\n        throw new Error(\"Cannot delete employee: employee has attendance records\");\n      }\n\n      // Check if employee has orders\n      const orderCheck = await database\n        .select()\n        .from(orders)\n        .where(eq(orders.employeeId, id))\n        .limit(1);\n\n      if (orderCheck.length > 0) {\n        throw new Error(\"Cannot delete employee: employee has orders\");\n      }\n\n      // If no references found, delete the employee\n      const result = await database\n        .delete(employees)\n        .where(eq(employees.id, id))\n        .returning();\n\n      return result.length > 0;\n    } catch (error) {\n      console.error(\"Error deleting employee:\", error);\n      throw error;\n    }\n  }\n\n  async getAttendanceRecords(\n    employeeId?: number,\n    date?: string,\n  ): Promise<AttendanceRecord[]> {\n    const conditions = [];\n\n    if (employeeId) {\n      conditions.push(eq(attendanceRecords.employeeId, employeeId));\n    }\n\n    if (date) {\n      const startDate = new Date(date);\n      startDate.setHours(0, 0, 0, 0);\n      const endDate = new Date(date);\n      endDate.setHours(23, 59, 59, 999);\n\n      conditions.push(\n        gte(attendanceRecords.clockIn, startDate),\n        lte(attendanceRecords.clockIn, endDate),\n      );\n    }\n\n    if (conditions.length > 0) {\n      return await db\n        .select()\n        .from(attendanceRecords)\n        .where(and(...conditions))\n        .orderBy(attendanceRecords.clockIn);\n    }\n\n    return await db\n      .select()\n      .from(attendanceRecords)\n      .orderBy(attendanceRecords.clockIn);\n  }\n\n  async getAttendanceRecord(id: number): Promise<AttendanceRecord | undefined> {\n    const [record] = await db\n      .select()\n      .from(attendanceRecords)\n      .where(eq(attendanceRecords.id, id));\n    return record || undefined;\n  }\n\n  async getTodayAttendance(\n    employeeId: number,\n  ): Promise<AttendanceRecord | undefined> {\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    const tomorrow = new Date(today);\n    tomorrow.setDate(tomorrow.getDate() + 1);\n\n    const [record] = await db\n      .select()\n      .from(attendanceRecords)\n      .where(\n        and(\n          eq(attendanceRecords.employeeId, employeeId),\n          gte(attendanceRecords.clockIn, today),\n          lte(attendanceRecords.clockIn, tomorrow),\n        ),\n      );\n    return record || undefined;\n  }\n\n  async clockIn(employeeId: number, notes?: string): Promise<AttendanceRecord> {\n    try {\n      // Check if employee exists\n      const [employee] = await db\n        .select()\n        .from(employees)\n        .where(eq(employees.id, employeeId))\n        .limit(1);\n\n      if (!employee) {\n        throw new Error(`Employee with ID ${employeeId} not found`);\n      }\n\n      // Check if already clocked in today\n      const existingRecord = await this.getTodayAttendance(employeeId);\n      if (existingRecord) {\n        throw new Error('Employee already clocked in today');\n      }\n\n      const clockInTime = new Date();\n      const [record] = await db\n        .insert(attendanceRecords)\n        .values({\n          employeeId,\n          clockIn: clockInTime,\n          status: \"present\",\n          notes: notes || null,\n        })\n        .returning();\n\n      if (!record) {\n        throw new Error('Failed to create attendance record');\n      }\n\n      return record;\n    } catch (error) {\n      console.error('Clock-in error:', error);\n      throw error;\n    }\n  }\n\n  async clockOut(attendanceId: number): Promise<AttendanceRecord | undefined> {\n    const clockOutTime = new Date();\n    const record = await this.getAttendanceRecord(attendanceId);\n    if (!record) return undefined;\n\n    const clockInTime = new Date(record.clockIn);\n    const totalMinutes =\n      (clockOutTime.getTime() - clockInTime.getTime()) / (1000 * 60);\n    let totalHours = totalMinutes / 60;\n\n    // Subtract break time if any\n    if (record.breakStart && record.breakEnd) {\n      const breakMinutes =\n        (new Date(record.breakEnd).getTime() -\n          new Date(record.breakStart).getTime()) /\n        (1000 * 60);\n      totalHours -= breakMinutes / 60;\n    }\n\n    // Calculate overtime (assuming 8 hour work day)\n    const overtime = Math.max(0, totalHours - 8);\n\n    const [updatedRecord] = await db\n      .update(attendanceRecords)\n      .set({\n        clockOut: clockOutTime,\n        totalHours: totalHours.toFixed(2),\n        overtime: overtime.toFixed(2),\n      })\n      .where(eq(attendanceRecords.id, attendanceId))\n      .returning();\n\n    return updatedRecord || undefined;\n  }\n\n  async startBreak(\n    attendanceId: number,\n  ): Promise<AttendanceRecord | undefined> {\n    const [record] = await db\n      .update(attendanceRecords)\n      .set({ breakStart: new Date() })\n      .where(eq(attendanceRecords.id, attendanceId))\n      .returning();\n    return record || undefined;\n  }\n\n  async endBreak(attendanceId: number): Promise<AttendanceRecord | undefined> {\n    const [record] = await db\n      .update(attendanceRecords)\n      .set({ breakEnd: new Date() })\n      .where(eq(attendanceRecords.id, attendanceId))\n      .returning();\n    return record || undefined;\n  }\n\n  async updateAttendanceStatus(\n    id: number,\n    status: string,\n  ): Promise<AttendanceRecord | undefined> {\n    const [record] = await db\n      .update(attendanceRecords)\n      .set({ status })\n      .where(eq(attendanceRecords.id, id))\n      .returning();\n    return record || undefined;\n  }\n\n  // Tables\n  async getTables(): Promise<Table[]> {\n    return await db.select().from(tables).orderBy(tables.tableNumber);\n  }\n\n  async getTable(id: number): Promise<Table | undefined> {\n    const [table] = await db.select().from(tables).where(eq(tables.id, id));\n    return table || undefined;\n  }\n\n  async getTableByNumber(tableNumber: string): Promise<Table | undefined> {\n    const [table] = await db\n      .select()\n      .from(tables)\n      .where(eq(tables.tableNumber, tableNumber));\n    return table || undefined;\n  }\n\n  async createTable(table: InsertTable): Promise<Table> {\n    const [newTable] = await db.insert(tables).values(table).returning();\n    return newTable;\n  }\n\n  async updateTable(\n    id: number,\n    table: Partial<InsertTable>,\n  ): Promise<Table | undefined> {\n    const [updatedTable] = await db\n      .update(tables)\n      .set(table)\n      .where(eq(tables.id, id))\n      .returning();\n    return updatedTable || undefined;\n  }\n\n  async updateTableStatus(\n    id: number,\n    status: string,\n  ): Promise<Table | undefined> {\n    const [table] = await db\n      .update(tables)\n      .set({ status })\n      .where(eq(tables.id, id))\n      .returning();\n    return table || undefined;\n  }\n\n  async deleteTable(id: number): Promise<boolean> {\n    const result = await db.delete(tables).where(eq(tables.id, id));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  // Orders\n  async getOrders(tableId?: number, status?: string, tenantDb?: any): Promise<Order[]> {\n    const database = tenantDb || db;\n    const conditions = [];\n\n    if (tableId) {\n      conditions.push(eq(orders.tableId, tableId));\n    }\n    if (status) {\n      conditions.push(eq(orders.status, status));\n    }\n\n    if (conditions.length > 0) {\n      return await database\n        .select()\n        .from(orders)\n        .where(and(...conditions))\n        .orderBy(orders.orderedAt);\n    }\n\n    return await database.select().from(orders).orderBy(orders.orderedAt);\n  }\n\n  async getOrder(id: number): Promise<Order | undefined> {\n    const [order] = await db.select().from(orders).where(eq(orders.id, id));\n    return order || undefined;\n  }\n\n  async getOrderByNumber(orderNumber: string): Promise<Order | undefined> {\n    const [order] = await db\n      .select()\n      .from(orders)\n      .where(eq(orders.orderNumber, orderNumber));\n    return order || undefined;\n  }\n\n  async createOrder(\n    order: InsertOrder,\n    items: InsertOrderItem[],\n  ): Promise<Order> {\n    const [newOrder] = await db.insert(orders).values(order).returning();\n\n    if (items.length > 0) {\n      const itemsWithOrderId = items.map((item) => ({\n        ...item,\n        orderId: newOrder.id,\n        unitPrice: item.unitPrice.toString(),\n        total: item.total.toString(),\n      }));\n      await db.insert(orderItems).values(itemsWithOrderId);\n    }\n\n    // Update table status to occupied\n    await this.updateTableStatus(newOrder.tableId, \"occupied\");\n\n    return newOrder;\n  }\n\n  async updateOrder(\n    id: number,\n    order: Partial<InsertOrder>,\n    tenantDb?: any,\n  ): Promise<Order | undefined> {\n    console.log('=== UPDATING ORDER ===');\n    console.log('Order ID:', id);\n    console.log('Update data:', order);\n\n    const database = tenantDb || db;\n\n    // Get current order state before update\n    const [currentOrder] = await database\n      .select()\n      .from(orders)\n      .where(eq(orders.id, id));\n\n    if (!currentOrder) {\n      console.error(`❌ Order not found: ${id}`);\n      return undefined;\n    }\n\n    // Handle field mapping - einvoiceStatus should map to einvoice_status in database\n    const mappedData = { ...order };\n    if (order.einvoiceStatus !== undefined) {\n      mappedData.einvoiceStatus = order.einvoiceStatus;\n      console.log('Mapped einvoiceStatus field:', order.einvoiceStatus);\n    }\n\n    // Add updatedAt timestamp\n    mappedData.updatedAt = new Date();\n\n    console.log('Final mapped data to update:', JSON.stringify(mappedData, null, 2));\n\n    const [updatedOrder] = await database\n      .update(orders)\n      .set(mappedData)\n      .where(eq(orders.id, id))\n      .returning();\n\n    if (updatedOrder) {\n      console.log('✅ Order updated successfully:', {\n        orderId: updatedOrder.id,\n        status: updatedOrder.status,\n        einvoiceStatus: updatedOrder.einvoiceStatus,\n        paymentMethod: updatedOrder.paymentMethod,\n        paidAt: updatedOrder.paidAt\n      });\n\n      // If order status was updated to 'paid' or 'completed', check table status\n      if ((order.status === \"paid\" || order.status === \"completed\") && updatedOrder.tableId) {\n        console.log(`💳 Order ${order.status} - checking table ${updatedOrder.tableId} for release`);\n\n        try {\n          // Check for other unpaid orders on the same table\n          const unpaidStatuses = [\"pending\", \"confirmed\", \"preparing\", \"ready\", \"served\"];\n          const otherUnpaidOrders = await database\n            .select()\n            .from(orders)\n            .where(\n              and(\n                eq(orders.tableId, updatedOrder.tableId),\n                not(eq(orders.id, id)), // Exclude current order\n                or(\n                  ...unpaidStatuses.map(unpaidStatus => eq(orders.status, unpaidStatus))\n                )\n              )\n            );\n\n          console.log(`🔍 Unpaid orders remaining on table ${updatedOrder.tableId}:`, {\n            count: otherUnpaidOrders.length,\n            orders: otherUnpaidOrders.map(o => ({ \n              id: o.id, \n              status: o.status, \n              orderNumber: o.orderNumber \n            }))\n          });\n\n          // Import tables from schema\n          const { tables } = await import(\"@shared/schema\");\n\n          // Only update table status to available if no other unpaid orders exist\n          if (otherUnpaidOrders.length === 0) {\n            console.log(`🔓 No unpaid orders remaining - releasing table ${updatedOrder.tableId}`);\n\n            const [updatedTable] = await database\n              .update(tables)\n              .set({ \n                status: \"available\",\n                updatedAt: new Date()\n              })\n              .where(eq(tables.id, updatedOrder.tableId))\n              .returning();\n\n            if (updatedTable) {\n              console.log(`✅ Table ${updatedOrder.tableId} released successfully`);\n            } else {\n              console.error(`❌ Failed to release table ${updatedOrder.tableId}`);\n            }\n          } else {\n            console.log(`🔒 Table ${updatedOrder.tableId} remains occupied due to ${otherUnpaidOrders.length} unpaid orders`);\n          }\n        } catch (tableError) {\n          console.error(`❌ Error processing table status for table ${updatedOrder.tableId}:`, tableError);\n        }\n      }\n    } else {\n      console.error('❌ No order returned after update');\n    }\n\n    console.log('=== END UPDATING ORDER ===');\n    return updatedOrder || undefined;\n  }\n\n  async updateOrderStatus(\n    id: number,\n    status: string,\n    tenantDb?: any,\n  ): Promise<Order | undefined> {\n    console.log(`=== STORAGE: UPDATING ORDER STATUS START ===`);\n    console.log(`🎯 Storage updateOrderStatus called:`, {\n      orderId: id,\n      newStatus: status,\n      tenantDb: !!tenantDb,\n      dbType: tenantDb ? 'tenant' : 'default',\n      timestamp: new Date().toISOString()\n    });\n\n    const database = tenantDb || db;\n\n    console.log(`🔍 Storage: Database connection info:`, {\n      databaseObject: !!database,\n      isDefaultDb: database === db,\n      timestamp: new Date().toISOString()\n    });\n\n    // First, get the current order to know its table\n    console.log(`🔍 Storage: Fetching current order with ID: ${id}`);\n    console.log(`🔍 Storage: Database query details:`, {\n      query: `SELECT * FROM orders WHERE id = ${id}`,\n      using: database === db ? 'default_db' : 'tenant_db'\n    });\n\n    let currentOrder;\n    try {\n      const queryResult = await database\n        .select()\n        .from(orders)\n        .where(eq(orders.id, id));\n\n      console.log(`🔍 Storage: Database query executed, result:`, {\n        resultCount: queryResult.length,\n        firstResult: queryResult[0] ? {\n          id: queryResult[0].id,\n          orderNumber: queryResult[0].orderNumber,\n          status: queryResult[0].status,\n          tableId: queryResult[0].tableId\n        } : null\n      });\n\n      currentOrder = queryResult[0];\n    } catch (queryError) {\n      console.error(`❌ Storage: Database query failed:`, {\n        error: queryError,\n        errorMessage: queryError?.message,\n        errorStack: queryError?.stack,\n        orderId: id\n      });\n      throw queryError;\n    }\n\n    if (!currentOrder) {\n      console.error(`❌ Storage: Order not found for ID: ${id}`);\n\n      // Enhanced debugging\n      console.log(`🔍 Storage: Debugging order not found...`);\n      try {\n        const allOrdersCount = await database\n          .select({ count: sql<number>`count(*)` })\n          .from(orders);\n        console.log(`🔍 Storage: Total orders in database:`, allOrdersCount[0]?.count);\n\n        const recentOrders = await database\n          .select({ id: orders.id, orderNumber: orders.orderNumber, status: orders.status })\n          .from(orders)\n          .orderBy(desc(orders.id))\n          .limit(10);\n        console.log(`🔍 Storage: Recent orders in database:`, recentOrders);\n\n        const exactIdSearch = await database\n          .select()\n          .from(orders)\n          .where(sql`${orders.id}::text = ${id.toString()}`);\n        console.log(`🔍 Storage: Exact ID search result:`, exactIdSearch.length);\n      } catch (debugError) {\n        console.error(`❌ Storage: Debug queries failed:`, debugError);\n      }\n\n      return undefined;\n    }\n\n    console.log(`📋 Current order before update:`, {\n      id: currentOrder.id,\n      orderNumber: currentOrder.orderNumber,\n      tableId: currentOrder.tableId,\n      currentStatus: currentOrder.status,\n      requestedStatus: status,\n      paidAt: currentOrder.paidAt,\n      einvoiceStatus: currentOrder.einvoiceStatus\n    });\n\n    // Update the order status with additional paid timestamp if needed\n    const updateData: any = { \n      status,\n      updatedAt: new Date()\n    };\n\n    if (status === \"paid\") {\n      updateData.paidAt = new Date();\n      console.log(`💳 Setting paidAt timestamp for order ${id}:`, updateData.paidAt);\n    }\n\n    console.log(`🔍 Storage: Update data being sent:`, updateData);\n    console.log(`🔍 Storage: Update query targeting order ID: ${id}`);\n    console.log(`🔍 Storage: About to execute UPDATE query...`);\n\n    let order;\n    try {\n      console.log(`📤 Storage: Executing database UPDATE...`);\n      console.log(`📤 Storage: SQL equivalent: UPDATE orders SET status='${status}', updated_at='${updateData.updatedAt}' WHERE id=${id}`);\n\n      const updateResult = await database\n        .update(orders)\n        .set(updateData)\n        .where(eq(orders.id, id))\n        .returning();\n\n      console.log(`📥 Storage: Database UPDATE completed:`, {\n        resultCount: updateResult.length,\n        resultType: typeof updateResult,\n        isArray: Array.isArray(updateResult)\n      });\n\n      order = updateResult[0];\n\n      console.log(`🔍 Storage: Database update result analysis:`, {\n        orderReturned: !!order,\n        resultLength: updateResult.length,\n        orderData: order ? {\n          id: order.id,\n          orderNumber: order.orderNumber,\n          status: order.status,\n          paidAt: order.paidAt,\n          updatedAt: order.updatedAt,\n          tableId: order.tableId\n        } : null\n      });\n\n      if (!order) {\n        console.error(`❌ Storage: No order returned after status update for ID: ${id}`);\n\n        // Detailed verification\n        console.log(`🔍 Storage: Performing post-update verification...`);\n        try {\n          const [verifyOrder] = await database\n            .select()\n            .from(orders)\n            .where(eq(orders.id, id));\n\n          console.log(`🔍 Storage: Post-update verification:`, {\n            orderExists: !!verifyOrder,\n            orderData: verifyOrder ? {\n              id: verifyOrder.id,\n              status: verifyOrder.status,\n              updatedAt: verifyOrder.updatedAt\n            } : null\n          });\n\n          if (verifyOrder) {\n            console.log(`🤔 Storage: Order exists but wasn't returned by UPDATE - possible database issue`);\n            order = verifyOrder; // Use the verified order\n          }\n        } catch (verifyError) {\n          console.error(`❌ Storage: Verification query failed:`, verifyError);\n        }\n\n        if (!order) {\n          return undefined;\n        }\n      }\n    } catch (updateError) {\n      console.error(`❌ Storage: Database UPDATE failed:`, {\n        error: updateError,\n        errorMessage: updateError?.message,\n        errorCode: updateError?.code,\n        errorStack: updateError?.stack,\n        orderId: id,\n        status: status,\n        updateData: updateData\n      });\n      throw updateError;\n    }\n\n    console.log(`✅ Order status updated successfully:`, {\n        id: order.id,\n        orderNumber: order.orderNumber,\n        tableId: order.tableId,\n        previousStatus: currentOrder.status,\n        newStatus: order.status,\n        paidAt: order.paidAt,\n        updatedAt: order.updatedAt,\n        einvoiceStatus: order.einvoiceStatus\n      });\n\n      // CRITICAL: Handle table status update when order is paid\n      if (status === \"paid\" && order.tableId) {\n        console.log(`💳 Order PAID - IMMEDIATELY processing table ${order.tableId} release`);\n\n        try {\n          // Import tables from schema\n          const { tables } = await import(\"@shared/schema\");\n\n          // Check for other ACTIVE orders on the same table (excluding current order and paid/cancelled orders)\n          const activeStatuses = [\"pending\", \"confirmed\", \"preparing\", \"ready\", \"served\"];\n          const otherActiveOrders = await database\n            .select()\n            .from(orders)\n            .where(\n              and(\n                eq(orders.tableId, order.tableId),\n                not(eq(orders.id, id)), // Exclude current order\n                or(\n                  ...activeStatuses.map(activeStatus => eq(orders.status, activeStatus))\n                )\n              )\n            );\n\n          console.log(`🔍 Active orders remaining on table ${order.tableId}:`, {\n            count: otherActiveOrders.length,\n            orders: otherActiveOrders.map(o => ({ \n              id: o.id, \n              status: o.status, \n              orderNumber: o.orderNumber \n            }))\n          });\n\n          // Get current table status\n          const [currentTable] = await database\n            .select()\n            .from(tables)\n            .where(eq(tables.id, order.tableId));\n\n          if (!currentTable) {\n            console.error(`❌ Table ${order.tableId} not found`);\n          } else {\n            console.log(`📋 Current table status:`, {\n              id: currentTable.id,\n              tableNumber: currentTable.tableNumber,\n              status: currentTable.status\n            });\n\n            // FORCE table release if no other active orders exist\n            if (otherActiveOrders.length === 0) {\n              console.log(`🔓 FORCING table ${order.tableId} release - no active orders remaining`);\n\n              const [updatedTable] = await database\n                .update(tables)\n                .set({ \n                  status: \"available\",\n                  updatedAt: new Date()\n                })\n                .where(eq(tables.id, order.tableId))\n                .returning();\n\n              if (updatedTable) {\n                console.log(`✅ Table ${order.tableId} FORCEFULLY released:`, {\n                  id: updatedTable.id,\n                  tableNumber: updatedTable.tableNumber,\n                  previousStatus: currentTable.status,\n                  newStatus: updatedTable.status\n                });\n              } else {\n                console.error(`❌ CRITICAL: Failed to release table ${order.tableId} - no table returned`);\n              }\n            } else {\n              console.log(`🔒 Table ${order.tableId} remains occupied due to ${otherActiveOrders.length} active orders:`);\n              otherActiveOrders.forEach((activeOrder, index) => {\n                console.log(`   ${index + 1}. Order ${activeOrder.orderNumber} (${activeOrder.status})`);\n              });\n            }\n          }\n        } catch (tableError) {\n          console.error(`❌ CRITICAL: Error processing table status update for table ${order.tableId}:`, tableError);\n        }\n      }\n\n      console.log(`=== END UPDATING ORDER STATUS ===`);\n      return order;\n    } catch (error) {\n      console.error(`❌ Error updating order status:`, error);\n      throw error;\n    }\n  }\n\n  async addOrderItems(\n    orderId: number,\n    items: InsertOrderItem[],\n  ): Promise<OrderItem[]> {\n    const itemsWithOrderId = items.map((item) => ({ ...item, orderId }));\n    return await db.insert(orderItems).values(itemsWithOrderId).returning();\n  }\n\n  async removeOrderItem(itemId: number): Promise<boolean> {\n    const result = await db.delete(orderItems).where(eq(orderItems.id, itemId));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  async deleteOrderItem(itemId: number, tenantDb?: any): Promise<boolean> {\n    const database = tenantDb || db;\n    const result = await database.delete(orderItems).where(eq(orderItems.id, itemId));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  async getOrderItems(orderId: number): Promise<OrderItem[]> {\n    const items = await db\n      .select({\n        id: orderItems.id,\n        orderId: orderItems.orderId,\n        productId: orderItems.productId,\n        quantity: orderItems.quantity,\n        unitPrice: orderItems.unitPrice,\n        total: orderItems.total,\n        notes: orderItems.notes,\n        productName: products.name,\n        productSku: products.sku,\n      })\n      .from(orderItems)\n      .leftJoin(products, eq(orderItems.productId, products.id))\n      .where(eq(orderItems.orderId, orderId));\n\n    return items as OrderItem[];\n  }\n\n  // Inventory Management\n  async updateInventoryStock(\n    productId: number,\n    quantity: number,\n    type: \"add\" | \"subtract\" | \"set\",\n    notes?: string,\n  ): Promise<Product | undefined> {\n    const product = await this.getProduct(productId);\n    if (!product) return undefined;\n\n    let newStock: number;\n\n    switch (type) {\n      case \"add\":\n        newStock = product.stock + quantity;\n        break;\n      case \"subtract\":\n        newStock = Math.max(0, product.stock - quantity);\n        break;\n      case \"set\":\n        newStock = quantity;\n        break;\n      default:\n        return undefined;\n    }\n\n    const [updatedProduct] = await db\n      .update(products)\n      .set({ stock: newStock })\n      .where(eq(products.id, productId))\n      .returning();\n\n    return updatedProduct || undefined;\n  }\n\n  // Store Settings\n  async getStoreSettings(tenantDb?: any): Promise<StoreSettings> {\n    const database = tenantDb || db;\n    const [settings] = await database.select().from(storeSettings).limit(1);\n\n    // If no settings exist, create default settings\n    if (!settings) {\n      const [newSettings] = await database\n        .insert(storeSettings)\n        .values({\n          storeName: \"EDPOS 레스토랑\",\n          storeCode: \"STORE001\",\n          businessType: \"restaurant\",\n          openTime: \"09:00\",\n          closeTime: \"22:00\",\n        })\n        .returning();\n      return newSettings;\n    }\n\n    return settings;\n  }\n\n  async updateStoreSettings(\n    settings: Partial<InsertStoreSettings>,\n    tenantDb?: any,\n  ): Promise<StoreSettings> {\n    const database = tenantDb || db;\n    const currentSettings = await this.getStoreSettings(tenantDb);\n\n    const [updatedSettings] = await database\n      .update(storeSettings)\n      .set({ ...settings, updatedAt: new Date() })\n      .where(eq(storeSettings.id, currentSettings.id))\n      .returning();\n\n    return updatedSettings;\n  }\n\n  // Suppliers\n  async getSuppliers(): Promise<any> {\n    return await db.select().from(suppliers).orderBy(suppliers.name);\n  }\n\n  async getSupplier(id: number): Promise<any> {\n    const [result] = await db\n      .select()\n      .from(suppliers)\n      .where(eq(suppliers.id, id));\n    return result;\n  }\n\n  async getSuppliersByStatus(status: string): Promise<any> {\n    return await db\n      .select()\n      .from(suppliers)\n      .where(eq(suppliers.status, status))\n      .orderBy(suppliers.name);\n  }\n\n  async searchSuppliers(query: string): Promise<any> {\n    return await db\n      .select()\n      .from(suppliers)\n      .where(\n        or(\n          ilike(suppliers.name, `%${query}%`),\n          ilike(suppliers.code, `%${query}%`),\n          ilike(suppliers.contactPerson, `%${query}%`),\n        ),\n      )\n      .orderBy(suppliers.name);\n  }\n\n  async createSupplier(data: InsertSupplier): Promise<any> {\n    const [result] = await db.insert(suppliers).values(data).returning();\n    return result;\n  }\n\n  async updateSupplier(\n    id: number,\n    data: Partial<InsertSupplier>,\n  ): Promise<any> {\n    const [result] = await db\n      .update(suppliers)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(suppliers.id, id))\n      .returning();\n\n    return result;\n  }\n\n  async deleteSupplier(id: number): Promise<boolean> {\n    const result = await db\n      .delete(suppliers)\n      .where(eq(suppliers.id, id))\n      .returning();\n    return result.length > 0;\n  }\n\n  // Customers\n  async getCustomers(tenantDb?: any): Promise<Customer[]> {\n    const database = tenantDb || db;\n\n    // Get membership thresholds\n    const thresholds = await this.getMembershipThresholds();\n\n    // Get all customers\n    const allCustomers = await database\n      .select()\n      .from(customers)\n      .orderBy(customers.name);\n\n    // Update membership levels based on spending\n    const updatedCustomers = [];\n    for (const customer of allCustomers) {\n      const totalSpent = parseFloat(customer.totalSpent || \"0\");\n      const calculatedLevel = this.calculateMembershipLevel(\n        totalSpent,\n        thresholds.GOLD,\n        thresholds.VIP,\n      );\n\n      // Update if membership level has changed\n      if (customer.membershipLevel !== calculatedLevel) {\n        const [updatedCustomer] = await database\n          .update(customers)\n          .set({\n            membershipLevel: calculatedLevel,\n            updatedAt: new Date(),\n          })\n          .where(eq(customers.id, customer.id))\n          .returning();\n        updatedCustomers.push(updatedCustomer);\n      } else {\n        updatedCustomers.push(customer);\n      }\n    }\n\n    return updatedCustomers;\n  }\n\n  async searchCustomers(query: string): Promise<Customer[]> {\n    return await db\n      .select()\n      .from(customers)\n      .where(\n        or(\n          ilike(customers.name, `%${query}%`),\n          ilike(customers.customerId, `%${query}%`),\n          ilike(customers.phone, `%${query}%`),\n          ilike(customers.email, `%${query}%`),\n        ),\n      )\n      .orderBy(customers.name);\n  }\n\n  async getCustomer(id: number): Promise<Customer | undefined> {\n    const [result] = await db\n      .select()\n      .from(customers)\n      .where(eq(customers.id, id));\n    return result || undefined;\n  }\n\n  async getCustomerByCustomerId(\n    customerId: string,\n  ): Promise<Customer | undefined> {\n    const [result] = await db\n      .select()\n      .from(customers)\n      .where(eq(customers.customerId, customerId));\n    return result || undefined;\n  }\n\n  async createCustomer(customerData: InsertCustomer): Promise<Customer> {\n    // Generate customer ID if not provided\n    if (!customerData.customerId) {\n      const count = await db\n        .select({ count: sql<number>`count(*)` })\n        .from(customers);\n      const customerCount = count[0]?.count || 0;\n      customerData.customerId = `CUST${String(customerCount + 1).padStart(3, \"0\")}`;\n    }\n\n    const [result] = await db\n      .insert(customers)\n      .values(customerData)\n      .returning();\n    return result;\n  }\n\n  async updateCustomer(\n    id: number,\n    customerData: Partial<InsertCustomer>,\n  ): Promise<Customer | undefined> {\n    const [result] = await db\n      .update(customers)\n      .set({ ...customerData, updatedAt: new Date() })\n      .where(eq(customers.id, id))\n      .returning();\n    return result || undefined;\n  }\n\n  async deleteCustomer(id: number): Promise<boolean> {\n    const result = await db\n      .delete(customers)\n      .where(eq(customers.id, id))\n      .returning();\n    return result.length > 0;\n  }\n\n  async updateCustomerVisit(\n    customerId: number,\n    amount: number,\n    points: number,\n  ): Promise<Customer | undefined> {\n    const [customer] = await db\n      .select()\n      .from(customers)\n      .where(eq(customers.id, customerId));\n\n    if (!customer) {\n      throw new Error(\"Customer not found\");\n    }\n\n    const newTotalSpent = parseFloat(customer.totalSpent || \"0\") + amount;\n    const newVisitCount = (customer.visitCount || 0) + 1;\n    const newPoints = (customer.points || 0) + points;\n\n    // Get membership thresholds and calculate new level\n    const thresholds = await this.getMembershipThresholds();\n    const newMembershipLevel = this.calculateMembershipLevel(\n      newTotalSpent,\n      thresholds.GOLD,\n      thresholds.VIP,\n    );\n\n    const [updated] = await db\n      .update(customers)\n      .set({\n        visitCount: newVisitCount,\n        totalSpent: newTotalSpent.toString(),\n        points: newPoints,\n        membershipLevel: newMembershipLevel,\n        updatedAt: new Date(),\n      })\n      .where(eq(customers.id, customerId))\n      .returning();\n\n    return updated;\n  }\n\n  // Point Management Methods\n  async getCustomerPoints(\n    customerId: number,\n  ): Promise<{ points: number } | undefined> {\n    const customer = await this.getCustomer(customerId);\n    if (!customer) return undefined;\n    return { points: customer.points || 0 };\n  }\n\n  async updateCustomerPoints(\n    customerId: number,\n    points: number,\n    description: string,\n    type: \"earned\" | \"redeemed\" | \"adjusted\",\n    employeeId?: number,\n    orderId?: number,\n  ): Promise<PointTransaction> {\n    const customer = await this.getCustomer(customerId);\n    if (!customer) throw new Error(\"Customer not found\");\n\n    const previousBalance = customer.points || 0;\n    let pointChange = points;\n\n    // For redeemed points, make sure it's negative\n    if (type === \"redeemed\" && pointChange > 0) {\n      pointChange = -pointChange;\n    }\n\n    const newBalance = previousBalance + pointChange;\n\n    // Ensure customer doesn't go below 0 points for redemption\n    if (newBalance < 0) {\n      throw new Error(\"Insufficient points balance\");\n    }\n\n    // Update customer points\n    await db\n      .update(customers)\n      .set({\n        points: newBalance,\n        updatedAt: new Date(),\n      })\n      .where(eq(customers.id, customerId));\n\n    // Create point transaction record\n    const [pointTransaction] = await db\n      .insert(pointTransactions)\n      .values({\n        customerId,\n        type,\n        points: pointChange,\n        description,\n        orderId,\n        employeeId,\n        previousBalance,\n        newBalance,\n      })\n      .returning();\n\n    return pointTransaction;\n  }\n\n  async getPointHistory(\n    customerId: number,\n    limit: number = 50,\n  ): Promise<PointTransaction[]> {\n    return await db\n      .select()\n      .from(pointTransactions)\n      .where(eq(pointTransactions.customerId, customerId))\n      .orderBy(sql`${pointTransactions.createdAt} DESC`)\n      .limit(limit);\n  }\n\n  async getAllPointTransactions(\n    limit: number = 100,\n  ): Promise<PointTransaction[]> {\n    return await db\n      .select()\n      .from(pointTransactions)\n      .orderBy(sql`${pointTransactions.createdAt} DESC`)\n      .limit(limit);\n  }\n\n  // Get membership thresholds\n  async getMembershipThresholds(): Promise<{ GOLD: number; VIP: number }> {\n    try {\n      const [settings] = await db.select().from(storeSettings).limit(1);\n\n      if (!settings) {\n        // Return default values if no settings exist\n        return { GOLD: 300000, VIP: 1000000 };\n      }\n\n      // Parse thresholds from settings or return defaults\n      const goldThreshold =\n        parseInt(settings.goldThreshold as string) || 300000;\n      const vipThreshold = parseInt(settings.vipThreshold as string) || 1000000;\n\n      return { GOLD: goldThreshold, VIP: vipThreshold };\n    } catch (error) {\n      console.error(\"Error fetching membership thresholds:\", error);\n      return { GOLD: 300000, VIP: 1000000 };\n    }\n  }\n\n  // Calculate membership level based on total spent\n  private calculateMembershipLevel(\n    totalSpent: number,\n    goldThreshold: number,\n    vipThreshold: number,\n  ): string {\n    if (totalSpent >= vipThreshold) return \"VIP\";\n    if (totalSpent >= goldThreshold) return \"GOLD\";\n    return \"SILVER\";\n  }\n\n  async updateMembershipThresholds(thresholds: {\n    GOLD: number;\n    VIP: number;\n  }): Promise<{ GOLD: number; VIP: number }> {\n    try {\n      // Update or insert store settings with thresholds\n      const currentSettings = await this.getStoreSettings();\n\n      await db\n        .update(storeSettings)\n        .set({\n          goldThreshold: thresholds.GOLD.toString(),\n          vipThreshold: thresholds.VIP.toString(),\n          updatedAt: new Date(),\n        })\n        .where(eq(storeSettings.id, currentSettings.id));\n\n      // Recalculate all customer membership levels with new thresholds\n      await this.recalculateAllMembershipLevels(\n        thresholds.GOLD,\n        thresholds.VIP,\n      );\n\n      return thresholds;\n    } catch (error) {\n      console.error(\"Error updating membership thresholds:\", error);\n      throw error;\n    }\n  }\n\n  // Recalculate membership levels for all customers\n  async recalculateAllMembershipLevels(\n    goldThreshold: number,\n    vipThreshold: number,\n  ) {\n    const allCustomers = await db.select().from(customers);\n\n    for (const customer of allCustomers) {\n      const totalSpent = parseFloat(customer.totalSpent || \"0\");\n      const calculatedLevel = this.calculateMembershipLevel(\n        totalSpent,\n        goldThreshold,\n        vipThreshold,\n      );\n\n      if (customer.membershipLevel !== calculatedLevel) {\n        await db\n          .update(customers)\n          .set({\n            membershipLevel: calculatedLevel,\n            updatedAt: new Date(),\n          })\n          .where(eq(customers.id, customer.id));\n      }\n    }\n  }\n\n  async getAllProducts(includeInactive: boolean = false, tenantDb?: any): Promise<Product[]> {\n    const database = tenantDb || db;\n    let result;\n    if (includeInactive) {\n      result = await database.select().from(products).orderBy(products.name);\n    } else {\n      result = await database\n        .select()\n        .from(products)\n        .where(eq(products.isActive, true))\n        .orderBy(products.name);\n    }\n\n    // Ensure afterTaxPrice is properly returned\n    return result.map((product) => ({\n      ...product,\n      afterTaxPrice: product.afterTaxPrice || null\n    }));\n  }\n\n  async getActiveProducts(tenantDb?: any): Promise<Product[]> {\n    const database = tenantDb || db;\n    const result = await database\n      .select()\n      .from(products)\n      .where(eq(products.isActive, true))\n      .orderBy(products.name);\n\n    // Ensure afterTaxPrice is properly returned\n    return result.map((product) => ({\n      ...product,\n      afterTaxPrice: product.afterTaxPrice || null\n    }));\n  }\n\n  async createProduct(productData: Omit<Product, \"id\">): Promise<Product> {\n    const [product] = await db\n      .insert(products)\n      .values({\n        ...productData,\n        productType: productData.productType || 1,\n      })\n      .returning();\n    return product;\n  }\n\n  // Invoice templates methods\n  async getInvoiceTemplates(): Promise<any[]> {\n    try {\n      const { invoiceTemplates } = await import(\"@shared/schema\");\n      return await db\n        .select()\n        .from(invoiceTemplates)\n        .orderBy(invoiceTemplates.id);\n    } catch (error) {\n      console.error(\"Error fetching invoice templates:\", error);\n      return [];\n    }\n  }\n\n  async getActiveInvoiceTemplates(): Promise<any[]> {\n    try {\n      const { invoiceTemplates } = await import(\"@shared/schema\");\n      return await db\n        .select()\n        .from(invoiceTemplates)\n        .where(eq(invoiceTemplates.isActive, true))\n        .orderBy(invoiceTemplates.id);\n    } catch (error) {\n      console.error(\"Error fetching active invoice templates:\", error);\n      return [];\n    }\n  }\n\n  async getInvoiceTemplate(id: number): Promise<any> {\n    try {\n      const { invoiceTemplates } = await import(\"@shared/schema\");\n      const [result] = await db\n        .select()\n        .from(invoiceTemplates)\n        .where(eq(invoiceTemplates.id, id));\n      return result;\n    } catch (error) {\n      console.error(\"Error fetching invoice template:\", error);\n      return null;\n    }\n  }\n\n  async createInvoiceTemplate(data: any): Promise<any> {\n    try {\n      const { invoiceTemplates } = await import(\"@shared/schema\");\n\n      // If this template is set as default, unset all other defaults\n      if (data.isDefault) {\n        await db\n          .update(invoiceTemplates)\n          .set({ isDefault: false })\n          .where(eq(invoiceTemplates.isDefault, true));\n      }\n\n      const [result] = await db\n        .insert(invoiceTemplates)\n        .values({\n          ...data,\n          createdAt: new Date(),\n          updatedAt: new Date(),\n        })\n        .returning();\n      return result;\n    } catch (error) {\n      console.error(\"Error creating invoice template:\", error);\n      throw error;\n    }\n  }\n\n  async updateInvoiceTemplate(id: number, data: any): Promise<any> {\n    try {\n      const { invoiceTemplates } = await import(\"@shared/schema\");\n\n      // If this template is set as default, unset all other defaults\n      if (data.isDefault) {\n        await db\n          .update(invoiceTemplates)\n          .set({ isDefault: false })\n          .where(eq(invoiceTemplates.isDefault, true));\n      }\n\n      const [result] = await db\n        .update(invoiceTemplates)\n        .set({\n          ...data,\n          updatedAt: new Date(),\n        })\n        .where(eq(invoiceTemplates.id, id))\n        .returning();\n      return result;\n    } catch (error) {\n      console.error(\"Error updating invoice template:\", error);\n      throw error;\n    }\n  }\n\n  async deleteInvoiceTemplate(id: number): Promise<boolean> {\n    try {\n      const { invoiceTemplates } = await import(\"@shared/schema\");\n      const result = await db\n        .delete(invoiceTemplates)\n        .where(eq(invoiceTemplates.id, id));\n      return result.rowCount > 0;\n    } catch (error) {\n      console.error(\"Error deleting invoice template:\", error);\n      return false;\n    }\n  }\n\n  // E-invoice connections methods\n  async getEInvoiceConnections(): Promise<any[]> {\n    try {\n      const { eInvoiceConnections } = await import(\"@shared/schema\");\n      return await db\n        .select()\n        .from(eInvoiceConnections)\n        .orderBy(eInvoiceConnections.symbol);\n    } catch (error) {\n      console.error(\"Error fetching e-invoice connections:\", error);\n      return [];\n    }\n  }\n\n  async getEInvoiceConnection(id: number): Promise<any> {\n    try {\n      const { eInvoiceConnections } = await import(\"@shared/schema\");\n      const [result] = await db\n        .select()\n        .from(eInvoiceConnections)\n        .where(eq(eInvoiceConnections.id, id));\n      return result;\n    } catch (error) {\n      console.error(\"Error fetching e-invoice connection:\", error);\n      return null;\n    }\n  }\n\n  async createEInvoiceConnection(data: any): Promise<any> {\n    try {\n      const { eInvoiceConnections } = await import(\"@shared/schema\");\n\n      // Generate next symbol number\n      const existingConnections = await this.getEInvoiceConnections();\n      const nextSymbol = (existingConnections.length + 1).toString();\n\n      const [result] = await db\n        .insert(eInvoiceConnections)\n        .values({\n          ...data,\n          symbol: nextSymbol,\n          createdAt: new Date(),\n          updatedAt: new Date(),\n        })\n        .returning();\n      return result;\n    } catch (error) {\n      console.error(\"Error creating e-invoice connection:\", error);\n      throw error;\n    }\n  }\n\n  async updateEInvoiceConnection(id: number, data: any): Promise<any> {\n    try {\n      const { eInvoiceConnections } = await import(\"@shared/schema\");\n      const [result] = await db\n        .update(eInvoiceConnections)\n        .set({ ...data, updatedAt: new Date() })\n        .where(eq(eInvoiceConnections.id, id))\n        .returning();\n      return result;\n    } catch (error) {\n      console.error(\"Error updating e-invoice connection:\", error);\n      throw error;\n    }\n  }\n\n  async deleteEInvoiceConnection(id: number): Promise<boolean> {\n    try {\n      const { eInvoiceConnections } = await import(\"@shared/schema\");\n      const result = await db\n        .delete(eInvoiceConnections)\n        .where(eq(eInvoiceConnections.id, id))\n        .returning();\n      return result.length > 0;\n    } catch (error) {\n      console.error(\"Error deleting e-invoice connection:\", error);\n      return false;\n    }\n  }\n\n  async getEmployeeByEmail(email: string): Promise<Employee | undefined> {\n    if (email && email.trim() !== \"\") {\n      const [employee] = await db\n        .select()\n        .from(employees)\n        .where(eq(employees.email, email));\n\n      return employee || undefined;\n    }\n    return undefined;\n  }\n}\n\nexport const storage = new DatabaseStorage();","size_bytes":68843},"server/tenant-manager.ts":{"content":"import { Pool } from \"pg\";\nimport { drizzle } from \"drizzle-orm/node-postgres\";\nimport * as schema from \"@shared/schema\";\n\ninterface TenantConfig {\n  subdomain: string;\n  databaseUrl: string;\n  storeName: string;\n  isActive: boolean;\n}\n\nclass TenantManager {\n  private tenants: Map<string, TenantConfig> = new Map();\n  private dbConnections: Map<string, any> = new Map();\n\n  constructor() {\n    this.loadTenants();\n  }\n\n  private loadTenants() {\n    // Load tenant configurations from environment or main database\n    const tenantsConfig = [\n      {\n        subdomain: \"demo\",\n        databaseUrl: process.env.EXTERNAL_DB_URL || process.env.DATABASE_URL!,\n        storeName: \"Demo Store - Cửa hàng demo\",\n        isActive: true,\n      },\n      {\n        subdomain: \"hazkitchen\",\n        databaseUrl: process.env.EXTERNAL_DB_URL || process.env.DATABASE_URL!,\n        storeName: \"Store 1 - Cửa hàng số 1\",\n        isActive: true,\n      },\n      // Add more tenants as needed\n    ];\n\n    tenantsConfig.forEach((config) => {\n      this.tenants.set(config.subdomain, config);\n    });\n  }\n\n  getTenantBySubdomain(subdomain: string): TenantConfig | null {\n    return this.tenants.get(subdomain) || null;\n  }\n\n  async getDatabaseConnection(subdomain: string) {\n    if (this.dbConnections.has(subdomain)) {\n      return this.dbConnections.get(subdomain);\n    }\n\n    const tenant = this.getTenantBySubdomain(subdomain);\n    if (!tenant) {\n      throw new Error(`Tenant not found: ${subdomain}`);\n    }\n\n    const pool = new Pool({\n      connectionString: tenant.databaseUrl,\n      max: 10,\n      idleTimeoutMillis: 60000,\n      connectionTimeoutMillis: 10000,\n      acquireTimeoutMillis: 10000,\n      ssl: tenant.databaseUrl?.includes(\"1.55.212.135\")\n        ? false // Disable SSL for external server\n        : tenant.databaseUrl?.includes(\"neon\")\n          ? { rejectUnauthorized: false }\n          : undefined,\n    });\n\n    const db = drizzle({ client: pool, schema });\n    this.dbConnections.set(subdomain, db);\n\n    return db;\n  }\n\n  getAllTenants(): TenantConfig[] {\n    return Array.from(this.tenants.values());\n  }\n\n  addTenant(config: TenantConfig) {\n    this.tenants.set(config.subdomain, config);\n  }\n\n  removeTenant(subdomain: string) {\n    this.tenants.delete(subdomain);\n    this.dbConnections.delete(subdomain);\n  }\n}\n\nexport const tenantManager = new TenantManager();\n","size_bytes":2382},"server/tenant-middleware.ts":{"content":"\nimport { Request, Response, NextFunction } from 'express';\nimport { tenantManager } from './tenant-manager';\n\nexport interface TenantRequest extends Request {\n  tenant?: {\n    subdomain: string;\n    config: any;\n    db: any;\n  };\n}\n\nexport function tenantMiddleware(req: TenantRequest, res: Response, next: NextFunction) {\n  try {\n    // For development, allow tenant to be specified via query parameter\n    let subdomain = req.query.tenant as string;\n    \n    // If no tenant parameter, extract from host header\n    if (!subdomain) {\n      const host = req.get('host') || req.get('x-forwarded-host') || '';\n      subdomain = extractSubdomain(host);\n    }\n\n    if (!subdomain) {\n      return res.status(400).json({ \n        error: 'Invalid subdomain',\n        message: 'Please access through a valid subdomain (e.g., store1.yourapp.replit.app) or add ?tenant=demo parameter'\n      });\n    }\n\n    const tenantConfig = tenantManager.getTenantBySubdomain(subdomain);\n    if (!tenantConfig) {\n      return res.status(404).json({ \n        error: 'Tenant not found',\n        message: `Store '${subdomain}' not found`\n      });\n    }\n\n    if (!tenantConfig.isActive) {\n      return res.status(403).json({ \n        error: 'Store inactive',\n        message: 'This store is currently inactive'\n      });\n    }\n\n    // Attach tenant info to request\n    req.tenant = {\n      subdomain,\n      config: tenantConfig,\n      db: null // Will be loaded lazily\n    };\n\n    next();\n  } catch (error) {\n    console.error('Tenant middleware error:', error);\n    res.status(500).json({ error: 'Internal server error' });\n  }\n}\n\nfunction extractSubdomain(host: string): string | null {\n  // Remove port if present\n  const hostWithoutPort = host.split(':')[0];\n  \n  // Handle development environment (Replit)\n  if (hostWithoutPort.includes('replit.dev') || hostWithoutPort.includes('replit.co')) {\n    // Format: c2bc841a-a304-4215-98b0-ab6349baf209-00-21m0gfgjl6ikj.worf.replit.dev\n    // For replit dev URLs, we'll look for URL parameters or use a default\n    return 'demo'; // Default for development\n  }\n  \n  // Handle production custom domain with subdomain\n  if (hostWithoutPort.includes('replit.app')) {\n    // Format: subdomain.appname.replit.app\n    const parts = hostWithoutPort.split('.');\n    if (parts.length >= 3) {\n      return parts[0];\n    }\n  }\n\n  // Handle custom domain with subdomain\n  const parts = hostWithoutPort.split('.');\n  if (parts.length >= 2) {\n    const subdomain = parts[0];\n    // Skip www prefix\n    if (subdomain === 'www') {\n      return 'demo'; // Default when www is used\n    }\n    return subdomain;\n  }\n\n  return 'demo'; // Default subdomain for development\n}\n\nexport async function getTenantDatabase(req: TenantRequest) {\n  if (!req.tenant) {\n    throw new Error('Tenant not found in request');\n  }\n\n  if (!req.tenant.db) {\n    req.tenant.db = await tenantManager.getDatabaseConnection(req.tenant.subdomain);\n  }\n\n  return req.tenant.db;\n}\n","size_bytes":2957},"server/tenant-routes.ts":{"content":"\nimport { Express } from 'express';\nimport { tenantManager } from './tenant-manager';\n\nexport function registerTenantRoutes(app: Express) {\n  // Admin routes for tenant management (should be protected)\n  app.get('/admin/tenants', async (req, res) => {\n    try {\n      const tenants = tenantManager.getAllTenants();\n      res.json(tenants);\n    } catch (error) {\n      res.status(500).json({ error: 'Failed to fetch tenants' });\n    }\n  });\n\n  app.post('/admin/tenants', async (req, res) => {\n    try {\n      const { subdomain, databaseUrl, storeName } = req.body;\n      \n      if (!subdomain || !databaseUrl || !storeName) {\n        return res.status(400).json({ \n          error: 'Missing required fields: subdomain, databaseUrl, storeName' \n        });\n      }\n\n      const tenantConfig = {\n        subdomain,\n        databaseUrl,\n        storeName,\n        isActive: true\n      };\n\n      tenantManager.addTenant(tenantConfig);\n      res.status(201).json({ message: 'Tenant created successfully', tenant: tenantConfig });\n    } catch (error) {\n      res.status(500).json({ error: 'Failed to create tenant' });\n    }\n  });\n\n  app.delete('/admin/tenants/:subdomain', async (req, res) => {\n    try {\n      const { subdomain } = req.params;\n      tenantManager.removeTenant(subdomain);\n      res.json({ message: 'Tenant removed successfully' });\n    } catch (error) {\n      res.status(500).json({ error: 'Failed to remove tenant' });\n    }\n  });\n\n  // Health check endpoint for tenant\n  app.get('/api/tenant/info', async (req: any, res) => {\n    try {\n      if (!req.tenant) {\n        return res.status(400).json({ error: 'No tenant information' });\n      }\n\n      res.json({\n        subdomain: req.tenant.subdomain,\n        storeName: req.tenant.config.storeName,\n        isActive: req.tenant.config.isActive\n      });\n    } catch (error) {\n      res.status(500).json({ error: 'Failed to get tenant info' });\n    }\n  });\n}\n","size_bytes":1922},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n\nexport function convertDatesInBody(keys = []) {\n    return (req, res, next) => {\n      keys.forEach((key) => {\n        const value = req.body[key];\n        if (typeof value === 'string') {\n          const parsed = new Date(value);\n          if (!isNaN(parsed)) {\n            req.body[key] = parsed;\n          }\n        }\n      });\n      next();\n    };\n}\n","size_bytes":2618},"server/websocket-server.ts":{"content":"import WebSocket, { WebSocketServer } from 'ws';\nimport { Server } from 'http';\n\nlet wss: WebSocketServer | null = null;\n// Keep track of all connected clients\nconst clients = new Set<WebSocket>();\n\nexport function initializeWebSocketServer(server: Server) {\n  if (wss) {\n    console.log('WebSocket server already running');\n    return;\n  }\n\n  try {\n    wss = new WebSocketServer({ server, path: '/ws' });\n  } catch (error) {\n    console.error('Failed to create WebSocket server:', error);\n    return;\n  }\n\n  wss.on('connection', (ws) => {\n    console.log('Client connected');\n    clients.add(ws);\n\n    ws.on('message', (message) => {\n      try {\n        const data = JSON.parse(message.toString());\n        console.log('📩 Received WebSocket message:', data);\n\n        // Handle different message types\n        if (data.type === 'ping') {\n          ws.send(JSON.stringify({ type: 'pong' }));\n        } else if (data.type === 'cart_update') {\n          // Broadcast cart update to all connected clients (customer displays)\n          console.log('📡 Broadcasting cart update to customer displays');\n          clients.forEach(client => {\n            if (client.readyState === client.OPEN && client !== ws) {\n              client.send(JSON.stringify({\n                type: 'cart_update',\n                cart: data.cart,\n                subtotal: data.subtotal,\n                tax: data.tax,\n                total: data.total,\n                timestamp: data.timestamp\n              }));\n            }\n          });\n        } else if (data.type === 'qr_payment') {\n          // Broadcast QR payment info to customer displays\n          console.log('📱 Broadcasting QR payment to customer displays');\n          clients.forEach(client => {\n            if (client.readyState === client.OPEN && client !== ws) {\n              client.send(JSON.stringify({\n                type: 'qr_payment',\n                qrCodeUrl: data.qrCodeUrl,\n                amount: data.amount,\n                paymentMethod: data.paymentMethod,\n                transactionUuid: data.transactionUuid,\n                timestamp: data.timestamp\n              }));\n            }\n          });\n        } else if (data.type === 'customer_display_connected') {\n          console.log('👥 Customer display connected');\n          // Mark this connection as customer display if needed\n          (ws as any).isCustomerDisplay = true;\n        }\n      } catch (error) {\n        console.error('Error processing WebSocket message:', error);\n      }\n    });\n\n    ws.on('close', () => {\n      console.log('Client disconnected');\n      clients.delete(ws);\n    });\n\n    ws.on('error', (error) => {\n      console.error('WebSocket error:', error);\n      clients.delete(ws);\n    });\n  });\n\n  console.log('WebSocket server started on the same port as HTTP server');\n}\n\nexport function broadcastPopupClose(success: boolean) {\n  if (wss) {\n    const message = JSON.stringify({\n      type: 'popup_close',\n      success\n    });\n\n    wss.clients.forEach((client: WebSocket) => {\n      if (client.readyState === WebSocket.OPEN) {\n        client.send(message);\n      }\n    });\n\n    console.log('Broadcasted popup close signal:', { success });\n  }\n}\n\nexport function broadcastPaymentSuccess(transactionUuid: string) {\n  if (wss) {\n    const message = JSON.stringify({\n      type: 'payment_success',\n      transactionUuid\n    });\n\n    wss.clients.forEach((client: WebSocket) => {\n      if (client.readyState === WebSocket.OPEN) {\n        client.send(message);\n      }\n    });\n\n    console.log('Broadcasted payment success:', { transactionUuid });\n  }\n}","size_bytes":3598},"shared/schema.ts":{"content":"import {\n  pgTable,\n  text,\n  serial,\n  decimal,\n  integer,\n  timestamp,\n  boolean,\n  varchar,\n  date,\n} from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { relations } from \"drizzle-orm\";\nimport { z } from \"zod\";\nimport { InferSelectModel, InferInsertModel } from \"drizzle-orm\";\n\nexport const categories = pgTable(\"categories\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  icon: text(\"icon\").notNull(),\n});\n\nexport const products = pgTable(\"products\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  sku: text(\"sku\").notNull().unique(),\n  price: decimal(\"price\", { precision: 10, scale: 2 }).notNull(),\n  stock: integer(\"stock\").notNull().default(0),\n  categoryId: integer(\"category_id\")\n    .references(() => categories.id)\n    .notNull(),\n  imageUrl: text(\"image_url\"),\n  isActive: boolean(\"is_active\").notNull().default(true),\n  productType: integer(\"product_type\").notNull().default(1),\n  trackInventory: boolean(\"track_inventory\").notNull().default(true),\n  taxRate: decimal(\"tax_rate\", { precision: 5, scale: 2 })\n    .notNull()\n    .default(\"0.00\"),\n  priceIncludesTax: boolean(\"price_includes_tax\").notNull().default(false),\n  afterTaxPrice: decimal(\"after_tax_price\", { precision: 10, scale: 2 }),\n});\n\nexport const transactions = pgTable(\"transactions\", {\n  id: serial(\"id\").primaryKey(),\n  transactionId: text(\"transaction_id\").notNull().unique(),\n  subtotal: decimal(\"subtotal\", { precision: 10, scale: 2 }).notNull(),\n  tax: decimal(\"tax\", { precision: 10, scale: 2 }).notNull(),\n  total: decimal(\"total\", { precision: 10, scale: 2 }).notNull(),\n  paymentMethod: text(\"payment_method\").notNull(),\n  amountReceived: decimal(\"amount_received\", { precision: 10, scale: 2 }),\n  change: decimal(\"change\", { precision: 10, scale: 2 }),\n  cashierName: text(\"cashier_name\").notNull(),\n  notes: text(\"notes\"),\n  invoiceId: integer(\"invoice_id\").references(() => invoices.id),\n  invoiceNumber: varchar(\"invoice_number\", { length: 50 }),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const transactionItems = pgTable(\"transaction_items\", {\n  id: serial(\"id\").primaryKey(),\n  transactionId: integer(\"transaction_id\")\n    .references(() => transactions.id)\n    .notNull(),\n  productId: integer(\"product_id\")\n    .references(() => products.id)\n    .notNull(),\n  productName: text(\"product_name\").notNull(),\n  price: decimal(\"price\", { precision: 10, scale: 2 }).notNull(),\n  quantity: integer(\"quantity\").notNull(),\n  total: decimal(\"total\", { precision: 10, scale: 2 }).notNull(),\n});\n\nexport const employees = pgTable(\"employees\", {\n  id: serial(\"id\").primaryKey(),\n  employeeId: text(\"employee_id\").notNull().unique(),\n  name: text(\"name\").notNull(),\n  email: text(\"email\"),\n  phone: text(\"phone\"),\n  role: text(\"role\").notNull(), // \"manager\", \"cashier\", \"admin\"\n  isActive: boolean(\"is_active\").notNull().default(true),\n  hireDate: timestamp(\"hire_date\").defaultNow().notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const attendanceRecords = pgTable(\"attendance_records\", {\n  id: serial(\"id\").primaryKey(),\n  employeeId: integer(\"employee_id\")\n    .references(() => employees.id)\n    .notNull(),\n  clockIn: timestamp(\"clock_in\").notNull(),\n  clockOut: timestamp(\"clock_out\"),\n  breakStart: timestamp(\"break_start\"),\n  breakEnd: timestamp(\"break_end\"),\n  totalHours: decimal(\"total_hours\", { precision: 4, scale: 2 }),\n  overtime: decimal(\"overtime\", { precision: 4, scale: 2 }).default(\"0.00\"),\n  status: text(\"status\").notNull().default(\"present\"), // \"present\", \"absent\", \"late\", \"half_day\"\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const storeSettings = pgTable(\"store_settings\", {\n  id: serial(\"id\").primaryKey(),\n  storeName: text(\"store_name\").notNull().default(\"EDPOS 레스토랑\"),\n  storeCode: text(\"store_code\"),\n  taxId: text(\"tax_id\"),\n  businessType: text(\"business_type\").default(\"restaurant\"),\n  pinCode: text(\"pin_code\"),\n  address: text(\"address\"),\n  phone: text(\"phone\"),\n  email: text(\"email\"),\n  openTime: text(\"open_time\").default(\"09:00\"),\n  closeTime: text(\"close_time\").default(\"22:00\"),\n  goldThreshold: text(\"gold_threshold\").default(\"300000\"),\n  vipThreshold: text(\"vip_threshold\").default(\"1000000\"),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const suppliers = pgTable(\"suppliers\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  code: text(\"code\").notNull().unique(),\n  contactPerson: text(\"contact_person\"),\n  phone: text(\"phone\"),\n  email: text(\"email\"),\n  address: text(\"address\"),\n  taxId: text(\"tax_id\"),\n  bankAccount: text(\"bank_account\"),\n  paymentTerms: text(\"payment_terms\").default(\"30일\"), // \"30일\", \"60일\", \"현금\" 등\n  status: text(\"status\").notNull().default(\"active\"), // \"active\", \"inactive\"\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const tables = pgTable(\"tables\", {\n  id: serial(\"id\").primaryKey(),\n  tableNumber: text(\"table_number\").notNull().unique(),\n  capacity: integer(\"capacity\").notNull().default(4),\n  status: text(\"status\").notNull().default(\"available\"), // \"available\", \"occupied\", \"reserved\", \"maintenance\"\n  qrCode: text(\"qr_code\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const orders = pgTable(\"orders\", {\n  id: serial(\"id\").primaryKey(),\n  orderNumber: text(\"order_number\").notNull().unique(),\n  tableId: integer(\"table_id\")\n    .references(() => tables.id)\n    .notNull(),\n  employeeId: integer(\"employee_id\").references(() => employees.id),\n  status: text(\"status\").notNull().default(\"pending\"), // \"pending\", \"confirmed\", \"preparing\", \"ready\", \"served\", \"paid\", \"cancelled\"\n  customerName: text(\"customer_name\"),\n  customerCount: integer(\"customer_count\").default(1),\n  subtotal: decimal(\"subtotal\", { precision: 10, scale: 2 }).notNull(),\n  tax: decimal(\"tax\", { precision: 10, scale: 2 }).notNull().default(\"0.00\"),\n  total: decimal(\"total\", { precision: 10, scale: 2 }).notNull(),\n  paymentMethod: text(\"payment_method\"), // \"cash\", \"card\", \"mobile\"\n  paymentStatus: text(\"payment_status\").notNull().default(\"pending\"), // \"pending\", \"paid\", \"refunded\"\n  einvoiceStatus: integer(\"einvoice_status\").notNull().default(0), // 0=Chưa phát hành, 1=Đã phát hành, 2=Tạo nháp, 3=Đã duyệt, 4=Đã bị thay thế (hủy), 5=Thay thế tạm, 6=Thay thế, 7=Đã bị điều chỉnh, 8=Điều chỉnh tạm, 9=Điều chỉnh, 10=Đã hủy\n  templateNumber: varchar(\"template_number\", { length: 50 }),\n  symbol: varchar(\"symbol\", { length: 20 }),\n  invoiceNumber: varchar(\"invoice_number\", { length: 50 }),\n  notes: text(\"notes\"),\n  orderedAt: timestamp(\"ordered_at\").defaultNow().notNull(),\n  servedAt: timestamp(\"served_at\"),\n  paidAt: timestamp(\"paid_at\"),\n});\n\nexport const orderItems = pgTable(\"order_items\", {\n  id: serial(\"id\").primaryKey(),\n  orderId: integer(\"order_id\")\n    .references(() => orders.id)\n    .notNull(),\n  productId: integer(\"product_id\")\n    .references(() => products.id)\n    .notNull(),\n  quantity: integer(\"quantity\").notNull(),\n  unitPrice: decimal(\"unit_price\", { precision: 10, scale: 2 }).notNull(),\n  total: decimal(\"total\", { precision: 10, scale: 2 }).notNull(),\n  notes: text(\"notes\"), // special requests\n});\n\nexport const insertCategorySchema = createInsertSchema(categories).omit({\n  id: true,\n});\n\nexport const insertProductSchema = createInsertSchema(products)\n  .omit({\n    id: true,\n  })\n  .extend({\n    price: z.string().refine((val) => !isNaN(Number(val)) && Number(val) > 0, {\n      message: \"Price must be a positive number\",\n    }),\n    stock: z.number().min(0, \"Stock cannot be negative\"),\n    productType: z.number().min(1).max(3, \"Product type is required\"),\n    taxRate: z\n      .string()\n      .refine(\n        (val) => !isNaN(Number(val)) && Number(val) >= 0 && Number(val) <= 100,\n        {\n          message: \"Tax rate must be between 0 and 100\",\n        },\n      ),\n    priceIncludesTax: z.boolean().optional().default(false),\n  });\n\nexport const insertTransactionSchema = createInsertSchema(transactions).omit({\n  id: true,\n  createdAt: true,\n}).extend({\n  invoiceId: z.number().optional(),\n  invoiceNumber: z.string().optional(),\n  notes: z.string().optional(),\n});\n\nexport const insertTransactionItemSchema = createInsertSchema(\n  transactionItems,\n).omit({\n  id: true,\n  transactionId: true,\n});\n\nexport const insertEmployeeSchema = createInsertSchema(employees)\n  .omit({\n    id: true,\n    createdAt: true,\n  })\n  .extend({\n    name: z.string().min(1, \"Tên nhân viên là bắt buộc\"),\n    role: z.enum([\"manager\", \"cashier\", \"admin\"], {\n      errorMap: () => ({ message: \"Role must be manager, cashier, or admin\" }),\n    }),\n    hireDate: z.coerce.date(),\n  });\n\nexport const insertAttendanceSchema = createInsertSchema(attendanceRecords)\n  .omit({\n    id: true,\n    createdAt: true,\n  })\n  .extend({\n    status: z.enum([\"present\", \"absent\", \"late\", \"half_day\"], {\n      errorMap: () => ({\n        message: \"Status must be present, absent, late, or half_day\",\n      }),\n    }),\n  });\n\nexport const insertTableSchema = createInsertSchema(tables)\n  .omit({\n    id: true,\n    createdAt: true,\n  })\n  .extend({\n    status: z.enum([\"available\", \"occupied\", \"reserved\", \"maintenance\"], {\n      errorMap: () => ({\n        message: \"Status must be available, occupied, reserved, or maintenance\",\n      }),\n    }),\n  });\n\nexport const insertOrderSchema = createInsertSchema(orders)\n  .omit({\n    id: true,\n    orderedAt: true,\n  })\n  .extend({\n    tableId: z.number().nullable().optional(),\n    status: z.enum(\n      [\n        \"pending\",\n        \"confirmed\",\n        \"preparing\",\n        \"ready\",\n        \"served\",\n        \"paid\",\n        \"cancelled\",\n      ],\n      {\n        errorMap: () => ({ message: \"Invalid order status\" }),\n      },\n    ),\n    paymentMethod: z.enum([\"cash\", \"card\", \"mobile\", \"einvoice\"]).optional(),\n    paymentStatus: z.enum([\"pending\", \"paid\", \"refunded\"], {\n      errorMap: () => ({ message: \"Invalid payment status\" }),\n    }),\n    einvoiceStatus: z.number().min(0).max(10).optional().default(0),\n  });\n\nexport const insertOrderItemSchema = createInsertSchema(orderItems).omit({\n  id: true,\n  orderId: true,\n});\n\nexport const insertStoreSettingsSchema = createInsertSchema(storeSettings).omit(\n  {\n    id: true,\n    updatedAt: true,\n  },\n);\n\nexport const insertSupplierSchema = createInsertSchema(suppliers)\n  .omit({\n    id: true,\n    createdAt: true,\n    updatedAt: true,\n  })\n  .extend({\n    status: z.enum([\"active\", \"inactive\"], {\n      errorMap: () => ({ message: \"Status must be active or inactive\" }),\n    }),\n    email: z\n      .string()\n      .email(\"Invalid email format\")\n      .optional()\n      .or(z.literal(\"\")),\n  });\n\nexport type Category = typeof categories.$inferSelect;\nexport type Product = typeof products.$inferSelect;\nexport type Transaction = typeof transactions.$inferSelect;\nexport type TransactionItem = typeof transactionItems.$inferSelect;\nexport type Employee = InferSelectModel<typeof employees>;\nexport type InsertEmployee = InferInsertModel<typeof employees>;\n\n// Customers table\nexport const customers = pgTable(\"customers\", {\n  id: serial(\"id\").primaryKey(),\n  customerId: varchar(\"customer_id\", { length: 20 }).unique().notNull(),\n  name: varchar(\"name\", { length: 100 }).notNull(),\n  phone: varchar(\"phone\", { length: 20 }),\n  email: varchar(\"email\", { length: 100 }),\n  address: text(\"address\"),\n  dateOfBirth: date(\"date_of_birth\"),\n  visitCount: integer(\"visit_count\").default(0),\n  totalSpent: decimal(\"total_spent\", { precision: 10, scale: 2 }).default(\n    \"0.00\",\n  ),\n  points: integer(\"points\").default(0),\n  membershipLevel: varchar(\"membership_level\", { length: 20 }).default(\n    \"SILVER\",\n  ),\n  notes: text(\"notes\"),\n  status: varchar(\"status\", { length: 20 }).default(\"active\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Point transactions table for tracking point history\nexport const pointTransactions = pgTable(\"point_transactions\", {\n  id: serial(\"id\").primaryKey(),\n  customerId: integer(\"customer_id\")\n    .references(() => customers.id)\n    .notNull(),\n  type: varchar(\"type\", { length: 20 }).notNull(), // 'earned', 'redeemed', 'adjusted', 'expired'\n  points: integer(\"points\").notNull(), // positive for earned, negative for redeemed\n  description: text(\"description\").notNull(),\n  orderId: integer(\"order_id\").references(() => orders.id), // when points are earned/redeemed from order\n  employeeId: integer(\"employee_id\").references(() => employees.id), // who processed the transaction\n  previousBalance: integer(\"previous_balance\").notNull(),\n  newBalance: integer(\"new_balance\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const inventoryTransactions = pgTable(\"inventory_transactions\", {\n  id: serial(\"id\").primaryKey(),\n  productId: integer(\"product_id\")\n    .references(() => products.id)\n    .notNull(),\n  type: varchar(\"type\", { length: 20 }).notNull(), // 'add', 'subtract', 'set', 'sale', 'return'\n  quantity: integer(\"quantity\").notNull(),\n  previousStock: integer(\"previous_stock\").notNull(),\n  newStock: integer(\"new_stock\").notNull(),\n  notes: text(\"notes\"),\n  invoiceId: integer(\"invoice_id\"),\n  invoiceNumber: varchar(\"invoice_number\", { length: 50 }),\n  createdAt: varchar(\"created_at\", { length: 50 }).notNull(),\n});\n\nexport const invoices = pgTable(\"invoices\", {\n  id: serial(\"id\").primaryKey(),\n  invoiceNumber: varchar(\"invoice_number\", { length: 50 }),\n  tradeNumber: varchar(\"trade_number\", { length: 50 }).unique(),\n  templateNumber: varchar(\"template_number\", { length: 50 }),\n  symbol: varchar(\"symbol\", { length: 20 }),\n  customerId: integer(\"customer_id\").references(() => customers.id),\n  customerName: varchar(\"customer_name\", { length: 100 }).notNull(),\n  customerTaxCode: varchar(\"customer_tax_code\", { length: 20 }),\n  customerAddress: text(\"customer_address\"),\n  customerPhone: varchar(\"customer_phone\", { length: 20 }),\n  customerEmail: varchar(\"customer_email\", { length: 100 }),\n  subtotal: decimal(\"subtotal\", { precision: 10, scale: 2 }).notNull(),\n  tax: decimal(\"tax\", { precision: 10, scale: 2 }).notNull(),\n  total: decimal(\"total\", { precision: 10, scale: 2 }).notNull(),\n  paymentMethod: integer(\"payment_method\").notNull().default(1), // 1=Tiền mặt,2=Chuyển khoản,3=TM/CK,4=Đối trừ công nợ\n  invoiceDate: timestamp(\"invoice_date\").notNull(),\n  status: varchar(\"status\", { length: 20 }).notNull().default(\"draft\"), // 'draft', 'published', 'cancelled'\n  einvoiceStatus: integer(\"einvoice_status\").notNull().default(0), // 0=Chưa phát hành, 1=Đã phát hành, 2=Tạo nháp, 3=Đã duyệt, 4=Đã bị thay thế (hủy), 5=Thay thế tạm, 6=Thay thế, 7=Đã bị điều chỉnh, 8=Điều chỉnh tạm, 9=Điều chỉnh, 10=Đã hủy\n  invoiceStatus: integer(\"invoice_status\").notNull().default(1), // 1=Hoàn thành, 2=Đang phục vụ, 3=Đã hủy\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const invoiceItems = pgTable(\"invoice_items\", {\n  id: serial(\"id\").primaryKey(),\n  invoiceId: integer(\"invoice_id\")\n    .references(() => invoices.id)\n    .notNull(),\n  productId: integer(\"product_id\")\n    .references(() => products.id)\n    .notNull(),\n  productName: varchar(\"product_name\", { length: 200 }).notNull(),\n  quantity: integer(\"quantity\").notNull(),\n  unitPrice: decimal(\"unit_price\", { precision: 10, scale: 2 }).notNull(),\n  total: decimal(\"total\", { precision: 10, scale: 2 }).notNull(),\n  taxRate: decimal(\"tax_rate\", { precision: 5, scale: 2 }).notNull().default(\"0.00\"),\n});\n\nexport const eInvoiceConnections = pgTable(\"einvoice_connections\", {\n  id: serial(\"id\").primaryKey(),\n  symbol: varchar(\"symbol\", { length: 10 }).notNull(),\n  taxCode: varchar(\"tax_code\", { length: 20 }).notNull(),\n  loginId: varchar(\"login_id\", { length: 50 }).notNull(),\n  password: text(\"password\").notNull(),\n  softwareName: varchar(\"software_name\", { length: 50 }).notNull(),\n  loginUrl: text(\"login_url\"),\n  signMethod: varchar(\"sign_method\", { length: 20 })\n    .notNull()\n    .default(\"Ký server\"),\n  cqtCode: varchar(\"cqt_code\", { length: 20 }).notNull().default(\"Cấp nhật\"),\n  notes: text(\"notes\"),\n  isDefault: boolean(\"is_default\").notNull().default(false),\n  isActive: boolean(\"is_active\").notNull().default(true),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const invoiceTemplates = pgTable(\"invoice_templates\", {\n  id: serial(\"id\").primaryKey(),\n  name: varchar(\"name\", { length: 100 }).notNull(),\n  templateNumber: varchar(\"template_number\", { length: 50 }).notNull(),\n  templateCode: varchar(\"template_code\", { length: 50 }),\n  symbol: varchar(\"symbol\", { length: 20 }).notNull(),\n  useCK: boolean(\"use_ck\").notNull().default(true),\n  notes: text(\"notes\"),\n  isDefault: boolean(\"is_default\").notNull().default(false),\n  isActive: boolean(\"is_active\").notNull().default(true),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const insertCustomerSchema = createInsertSchema(customers)\n  .omit({\n    id: true,\n    createdAt: true,\n    updatedAt: true,\n  })\n  .extend({\n    email: z\n      .string()\n      .email(\"Invalid email format\")\n      .optional()\n      .or(z.literal(\"\")),\n    membershipLevel: z\n      .enum([\"BRONZE\", \"SILVER\", \"GOLD\", \"PLATINUM\"])\n      .optional(),\n    status: z.enum([\"active\", \"inactive\"]).optional(),\n  });\n\nexport const insertPointTransactionSchema = createInsertSchema(\n  pointTransactions,\n)\n  .omit({\n    id: true,\n    createdAt: true,\n  })\n  .extend({\n    type: z.enum([\"earned\", \"redeemed\", \"adjusted\", \"expired\"], {\n      errorMap: () => ({\n        message: \"Type must be earned, redeemed, adjusted, or expired\",\n      }),\n    }),\n  });\n\nexport type Customer = InferSelectModel<typeof customers>;\nexport type PointTransaction = typeof pointTransactions.$inferSelect;\nexport type AttendanceRecord = typeof attendanceRecords.$inferSelect;\nexport type Table = typeof tables.$inferSelect;\nexport type Order = typeof orders.$inferSelect;\nexport type OrderItem = typeof orderItems.$inferSelect;\nexport type StoreSettings = typeof storeSettings.$inferSelect;\nexport type Supplier = typeof suppliers.$inferSelect;\n\nexport type InsertCategory = z.infer<typeof insertCategorySchema>;\nexport type InsertProduct = z.infer<typeof insertProductSchema>;\nexport type InsertTransaction = z.infer<typeof insertTransactionSchema>;\nexport type InsertTransactionItem = z.infer<typeof insertTransactionItemSchema>;\nexport type InsertAttendance = z.infer<typeof insertAttendanceSchema>;\nexport type InsertTable = z.infer<typeof insertTableSchema>;\nexport type InsertOrder = z.infer<typeof insertOrderSchema>;\nexport type InsertOrderItem = z.infer<typeof insertOrderItemSchema>;\nexport type InsertStoreSettings = z.infer<typeof insertStoreSettingsSchema>;\nexport type InsertSupplier = z.infer<typeof insertSupplierSchema>;\nexport type InsertCustomer = z.infer<typeof insertCustomerSchema>;\nexport type InsertPointTransaction = z.infer<\n  typeof insertPointTransactionSchema\n>;\n\nexport const insertEInvoiceConnectionSchema = createInsertSchema(\n  eInvoiceConnections,\n)\n  .omit({\n    id: true,\n    createdAt: true,\n    updatedAt: true,\n  })\n  .extend({\n    signMethod: z.enum([\"Ký server\", \"Ký USB Token\", \"Ký HSM\"]).optional(),\n    cqtCode: z.enum([\"Cấp nhật\", \"Cấp hai\"]).optional(),\n  });\n\nexport const insertInvoiceTemplateSchema = createInsertSchema(\n  invoiceTemplates,\n).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertInvoiceSchema = createInsertSchema(invoices).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n}).extend({\n  einvoiceStatus: z.number().min(0).max(10).optional().default(0),\n});\n\nexport const insertInvoiceItemSchema = createInsertSchema(invoiceItems).omit({\n  id: true,\n  invoiceId: true,\n});\n\nexport type EInvoiceConnection = typeof eInvoiceConnections.$inferSelect;\nexport type InsertEInvoiceConnection = z.infer<\n  typeof insertEInvoiceConnectionSchema\n>;\nexport type InvoiceTemplate = typeof invoiceTemplates.$inferSelect;\nexport type InsertInvoiceTemplate = z.infer<typeof insertInvoiceTemplateSchema>;\nexport type Invoice = typeof invoices.$inferSelect;\nexport type InvoiceItem = typeof invoiceItems.$inferSelect;\nexport type InsertInvoice = z.infer<typeof insertInvoiceSchema>;\nexport type InsertInvoiceItem = z.infer<typeof insertInvoiceItemSchema>;\n\n\n\n// Printer configs table\nexport const printerConfigs = pgTable(\"printer_configs\", {\n  id: serial(\"id\").primaryKey(),\n  name: varchar(\"name\", { length: 100 }).notNull(),\n  printerType: varchar(\"printer_type\", { length: 50 }).notNull().default(\"thermal\"),\n  connectionType: varchar(\"connection_type\", { length: 50 }).notNull().default(\"usb\"),\n  ipAddress: varchar(\"ip_address\", { length: 45 }),\n  port: integer(\"port\").default(9100),\n  macAddress: varchar(\"mac_address\", { length: 17 }),\n  paperWidth: integer(\"paper_width\").notNull().default(80),\n  printSpeed: integer(\"print_speed\").default(100),\n  isPrimary: boolean(\"is_primary\").notNull().default(false),\n  isSecondary: boolean(\"is_secondary\").notNull().default(false),\n  isActive: boolean(\"is_active\").notNull().default(true),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\n\n\nexport const insertPrinterConfigSchema = createInsertSchema(printerConfigs).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n}).extend({\n  printerType: z.enum([\"thermal\", \"inkjet\", \"laser\"]).optional(),\n  connectionType: z.enum([\"usb\", \"network\", \"bluetooth\"]).optional(),\n});\n\nexport type PrintTemplate = typeof printTemplates.$inferSelect;\nexport type PrinterConfig = typeof printerConfigs.$inferSelect;\nexport type InsertPrintTemplate = z.infer<typeof insertPrintTemplateSchema>;\nexport type InsertPrinterConfig = z.infer<typeof insertPrinterConfigSchema>;\n\n// Cart item type for frontend use\nexport type CartItem = {\n  id: number;\n  name: string;\n  price: string;\n  quantity: number;\n  total: string;\n  imageUrl?: string;\n  stock: number;\n  taxRate?: string;\n  afterTaxPrice?: string;\n};\n\n// Relations\nexport const categoriesRelations = relations(categories, ({ many }) => ({\n  products: many(products),\n}));\n\nexport const productsRelations = relations(products, ({ one, many }) => ({\n  category: one(categories, {\n    fields: [products.categoryId],\n    references: [categories.id],\n  }),\n  transactionItems: many(transactionItems),\n}));\n\nexport const transactionsRelations = relations(transactions, ({ many }) => ({\n  items: many(transactionItems),\n}));\n\nexport const transactionItemsRelations = relations(\n  transactionItems,\n  ({ one }) => ({\n    transaction: one(transactions, {\n      fields: [transactionItems.transactionId],\n      references: [transactions.id],\n    }),\n    product: one(products, {\n      fields: [transactionItems.productId],\n      references: [products.id],\n    }),\n  }),\n);\n\nexport const employeesRelations = relations(employees, ({ many }) => ({\n  attendanceRecords: many(attendanceRecords),\n}));\n\nexport const attendanceRecordsRelations = relations(\n  attendanceRecords,\n  ({ one }) => ({\n    employee: one(employees, {\n      fields: [attendanceRecords.employeeId],\n      references: [employees.id],\n    }),\n  }),\n);\n\nexport const tablesRelations = relations(tables, ({ many }) => ({\n  orders: many(orders),\n}));\n\nexport const ordersRelations = relations(orders, ({ one, many }) => ({\n  table: one(tables, {\n    fields: [orders.tableId],\n    references: [tables.id],\n  }),\n  employee: one(employees, {\n    fields: [orders.employeeId],\n    references: [employees.id],\n  }),\n  items: many(orderItems),\n}));\n\nexport const orderItemsRelations = relations(orderItems, ({ one }) => ({\n  order: one(orders, {\n    fields: [orderItems.orderId],\n    references: [orders.id],\n  }),\n  product: one(products, {\n    fields: [orderItems.productId],\n    references: [products.id],\n  }),\n}));\n\nexport const customersRelations = relations(customers, ({ many }) => ({\n  pointTransactions: many(pointTransactions),\n}));\n\nexport const pointTransactionsRelations = relations(\n  pointTransactions,\n  ({ one }) => ({\n    customer: one(customers, {\n      fields: [pointTransactions.customerId],\n      references: [customers.id],\n    }),\n    order: one(orders, {\n      fields: [pointTransactions.orderId],\n      references: [orders.id],\n    }),\n    employee: one(employees, {\n      fields: [pointTransactions.employeeId],\n      references: [employees.id],\n    }),\n  }),\n);\n\n// Receipt data type\nexport type Receipt = Transaction & {\n  items: (TransactionItem & { productName: string })[];\n};","size_bytes":25076},"client/src/App.tsx":{"content":"import { useState } from \"react\";\nimport { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { PinAuth } from \"@/components/auth/pin-auth\";\nimport POSPage from \"@/pages/pos\";\nimport TablesPage from \"@/pages/tables\";\nimport EmployeesPage from \"@/pages/employees\";\nimport InventoryPage from \"@/pages/inventory\";\nimport ReportsPage from \"@/pages/reports\";\nimport SettingsPage from \"@/pages/settings\";\nimport SuppliersPage from \"@/pages/suppliers\";\nimport AttendancePage from \"@/pages/attendance\";\nimport AttendanceQRPage from \"./pages/attendance-qr\";\nimport CustomerDisplay from \"@/pages/customer-display\";\nimport SalesOrders from \"@/pages/sales-orders\";\nimport NotFoundPage from \"./pages/not-found\";\n\nfunction Router({ onLogout }: { onLogout: () => void }) {\n  return (\n    <Switch>\n      <Route path=\"/\" component={() => <POSPage onLogout={onLogout} />} />\n      <Route path=\"/pos\" component={() => <POSPage onLogout={onLogout} />} />\n      <Route path=\"/tables\" component={() => <TablesPage onLogout={onLogout} />} />\n      <Route path=\"/inventory\" component={() => <InventoryPage onLogout={onLogout} />} />\n      <Route path=\"/reports\" component={() => <ReportsPage onLogout={onLogout} />} />\n      <Route path=\"/employees\" component={() => <EmployeesPage onLogout={onLogout} />} />\n      <Route path=\"/settings\" component={() => <SettingsPage onLogout={onLogout} />} />\n      <Route path=\"/suppliers\" component={() => <SuppliersPage onLogout={onLogout} />} />\n      <Route path=\"/attendance\" component={() => <AttendancePage onLogout={onLogout} />} />\n      <Route path=\"/attendance-qr\" component={AttendanceQRPage} />\n      <Route path=\"/inventory\" component={InventoryPage} />\n      <Route path=\"/customer-display\" component={CustomerDisplay} />\n      <Route path=\"/sales-orders\" component={SalesOrders} />\n      <Route path=\"*\" component={NotFoundPage} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n\n  const handleAuthSuccess = () => {\n    setIsAuthenticated(true);\n  };\n\n  const handleLogout = () => {\n    setIsAuthenticated(false);\n  };\n\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <Toaster />\n        {!isAuthenticated ? (\n          <PinAuth onAuthSuccess={handleAuthSuccess} />\n        ) : (\n          <Router onLogout={handleLogout} />\n        )}\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;","size_bytes":2651},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n.grocery-bg {\n  background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Cg fill-opacity='0.03'%3E%3Cpath d='M50 30c11.046 0 20 8.954 20 20s-8.954 20-20 20-20-8.954-20-20 8.954-20 20-20zm0 5c-8.284 0-15 6.716-15 15s6.716 15 15 15 15-6.716 15-15-6.716-15-15-15z' fill='%2310b981'/%3E%3C/g%3E%3C/svg%3E\");\n}\n\n:root {\n  --sidebar-width: 256px;\n}\n\n.main-content {\n  margin-left: var(--sidebar-width);\n  transition: margin-left 0.3s ease;\n}\n\n:root {\n  --background: hsl(120, 20%, 97%);\n  --foreground: hsl(0, 0%, 20%);\n  --muted: hsl(120, 10%, 94%);\n  --muted-foreground: hsl(0, 0%, 45%);\n  --popover: hsl(0, 0%, 100%);\n  --popover-foreground: hsl(0, 0%, 20%);\n  --card: hsl(0, 0%, 100%);\n  --card-foreground: hsl(0, 0%, 20%);\n  --border: hsl(120, 10%, 88%);\n  --input: hsl(120, 10%, 88%);\n  --primary: hsl(142, 76%, 45%);\n  --primary-foreground: hsl(0, 0%, 98%);\n  --secondary: hsl(120, 10%, 94%);\n  --secondary-foreground: hsl(0, 0%, 20%);\n  --accent: hsl(120, 20%, 92%);\n  --accent-foreground: hsl(0, 0%, 20%);\n  --destructive: hsl(0, 84.2%, 60.2%);\n  --destructive-foreground: hsl(60, 9.1%, 97.8%);\n  --ring: hsl(142, 76%, 45%);\n  --radius: 0.75rem;\n\n  /* Green theme colors */\n  --primary-green: hsl(142, 76%, 45%);\n  --primary-green-light: hsl(142, 76%, 55%);\n  --primary-green-dark: hsl(142, 76%, 35%);\n  --success-green: hsl(142, 76%, 45%);\n  --success-green-hover: hsl(142, 76%, 35%);\n  --warning-orange: hsl(32, 95%, 44%);\n  --warning-orange-hover: hsl(32, 95%, 34%);\n  --surface: hsl(0, 0%, 100%);\n  --background-green: hsl(120, 20%, 97%);\n  --text-primary: hsl(0, 0%, 20%);\n  --text-secondary: hsl(0, 0%, 40%);\n  --text-tertiary: hsl(0, 0%, 60%);\n  --border-light: hsl(120, 10%, 88%);\n}\n\n.dark {\n  --background: hsl(240, 10%, 3.9%);\n  --foreground: hsl(0, 0%, 98%);\n  --muted: hsl(240, 3.7%, 15.9%);\n  --muted-foreground: hsl(240, 5%, 64.9%);\n  --popover: hsl(240, 10%, 3.9%);\n  --popover-foreground: hsl(0, 0%, 98%);\n  --card: hsl(240, 10%, 3.9%);\n  --card-foreground: hsl(0, 0%, 98%);\n  --border: hsl(240, 3.7%, 15.9%);\n  --input: hsl(240, 3.7%, 15.9%);\n  --primary: hsl(207, 90%, 54%);\n  --primary-foreground: hsl(211, 100%, 99%);\n  --secondary: hsl(240, 3.7%, 15.9%);\n  --secondary-foreground: hsl(0, 0%, 98%);\n  --accent: hsl(240, 3.7%, 15.9%);\n  --accent-foreground: hsl(0, 0%, 98%);\n  --destructive: hsl(0, 62.8%, 30.6%);\n  --destructive-foreground: hsl(0, 0%, 98%);\n  --ring: hsl(240, 4.9%, 83.9%);\n  --radius: 0.5rem;\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n    font-family: 'Roboto', 'Inter', system-ui, -apple-system, sans-serif;\n  }\n}\n\n@layer components {\n  .shadow-material {\n    box-shadow: 0 2px 4px -1px rgba(0,0,0,0.2), 0 4px 5px 0 rgba(0,0,0,0.14), 0 1px 10px 0 rgba(0,0,0,0.12);\n  }\n  \n  .shadow-material-lg {\n    box-shadow: 0 8px 10px -5px rgba(0,0,0,0.2), 0 16px 24px 2px rgba(0,0,0,0.14), 0 6px 30px 5px rgba(0,0,0,0.12);\n  }\n\n  .receipt-print {\n    font-family: 'Courier New', monospace;\n    font-size: 12px;\n    line-height: 1.2;\n  }\n\n  .btn-primary {\n    @apply bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200;\n    background-color: var(--primary-blue);\n  }\n\n  .btn-primary:hover {\n    background-color: var(--primary-blue-dark);\n  }\n\n  .btn-success {\n    @apply text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200;\n    background-color: var(--success-green);\n  }\n\n  .btn-success:hover {\n    background-color: var(--success-green-hover);\n  }\n\n  .btn-warning {\n    @apply text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200;\n    background-color: var(--warning-orange);\n  }\n\n  .btn-warning:hover {\n    background-color: var(--warning-orange-hover);\n  }\n\n  .pos-surface {\n    background-color: var(--surface);\n  }\n\n  .pos-text-primary {\n    color: var(--text-primary);\n  }\n\n  .pos-text-secondary {\n    color: var(--text-secondary);\n  }\n\n  .pos-text-tertiary {\n    color: var(--text-tertiary);\n  }\n\n  .pos-border {\n    border-color: var(--border-light);\n  }\n}\n\n@layer utilities {\n  .line-clamp-2 {\n    overflow: hidden;\n    display: -webkit-box;\n    -webkit-box-orient: vertical;\n    -webkit-line-clamp: 2;\n  }\n}\n","size_bytes":4371},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/hooks/use-popup-signal.ts":{"content":"import { useEffect, useRef, useCallback } from 'react';\n\nexport function usePopupSignal() {\n  const wsRef = useRef<WebSocket | null>(null);\n  const paymentListenersRef = useRef<Map<string, (success: boolean) => void>>(new Map());\n\n  useEffect(() => {\n    // Connect WebSocket to same port as main application with /ws path\n    const isSecure = window.location.protocol === 'https:';\n    const wsProtocol = isSecure ? 'wss:' : 'ws:';\n    const wsUrl = `${wsProtocol}//${window.location.host}/ws`;\n\n    console.log('Connecting to WebSocket:', wsUrl);\n\n    try {\n      const ws = new WebSocket(wsUrl);\n      wsRef.current = ws;\n\n      ws.onopen = () => {\n        console.log('WebSocket connected successfully');\n      };\n\n      ws.onmessage = (event) => {\n        try {\n          const data = JSON.parse(event.data);\n          console.log('Received WebSocket message:', data);\n\n          if (data.type === 'popup_close') {\n            console.log('Popup close signal received:', data.success);\n            // Handle popup close here if needed\n          } else if (data.type === 'payment_success') {\n            console.log('Payment success signal received for transaction:', data.transactionUuid);\n            // Call registered listeners for this transaction\n            const listener = paymentListenersRef.current.get(data.transactionUuid);\n            if (listener) {\n              listener(true);\n              // Remove listener after calling it\n              paymentListenersRef.current.delete(data.transactionUuid);\n            }\n          }\n        } catch (error) {\n          console.error('Error parsing WebSocket message:', error);\n        }\n      };\n\n      ws.onerror = (error) => {\n        console.error('WebSocket error:', error);\n      };\n\n      ws.onclose = (event) => {\n        console.log('WebSocket connection closed:', event.code, event.reason);\n      };\n\n    } catch (error) {\n      console.error('Failed to create WebSocket connection:', error);\n    }\n\n    return () => {\n      if (wsRef.current) {\n        wsRef.current.close();\n      }\n    };\n  }, []);\n\n  const sendPopupClose = (success: boolean) => {\n    fetch('/api/popup/close', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({ success }),\n    }).catch(error => {\n      console.error('Error sending popup close signal:', error);\n    });\n  };\n\n  const listenForPaymentSuccess = useCallback((transactionUuid: string, callback: (success: boolean) => void) => {\n    paymentListenersRef.current.set(transactionUuid, callback);\n    console.log('Registered payment listener for transaction:', transactionUuid);\n  }, []);\n\n  const removePaymentListener = useCallback((transactionUuid: string) => {\n    paymentListenersRef.current.delete(transactionUuid);\n    console.log('Removed payment listener for transaction:', transactionUuid);\n  }, []);\n\n  return { \n    sendPopupClose, \n    listenForPaymentSuccess, \n    removePaymentListener \n  };\n}","size_bytes":2983},"client/src/hooks/use-pos.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport type { CartItem, Receipt } from \"@shared/schema\";\nimport { v4 as uuidv4 } from 'uuid';\n\ninterface Order {\n  id: string;\n  cart: CartItem[];\n}\n\nexport function usePOS() {\n  const [orders, setOrders] = useState<Order[]>([{ id: uuidv4(), cart: [] }]);\n  const [activeOrderId, setActiveOrderId] = useState<string>(orders[0].id);\n  const [lastReceipt, setLastReceipt] = useState<Receipt | null>(null);\n  const { toast } = useToast();\n\n  const cart = orders.find(order => order.id === activeOrderId)?.cart || [];\n\n  const checkoutMutation = useMutation({\n    mutationFn: async ({ paymentData }: { paymentData: any }) => {\n      const transactionId = `TXN-${Date.now()}`;\n      const subtotal = cart.reduce((sum, item) => sum + parseFloat(item.total), 0);\n      const taxRate = 0.0825;\n      const tax = subtotal * taxRate;\n      const total = subtotal + tax;\n\n      const transaction = {\n        transactionId,\n        subtotal: subtotal.toFixed(2),\n        tax: tax.toFixed(2),\n        total: total.toFixed(2),\n        paymentMethod: paymentData.paymentMethod === 'einvoice' ? 'einvoice' : paymentData.paymentMethod,\n        originalPaymentMethod: paymentData.originalPaymentMethod || paymentData.paymentMethod,\n        amountReceived: paymentData.amountReceived?.toFixed(2) || null,\n        change: paymentData.change?.toFixed(2) || null,\n        cashierName: \"John Smith\",\n      };\n\n      const items = cart.map(item => ({\n        productId: item.id,\n        productName: item.name,\n        price: item.price,\n        quantity: item.quantity,\n        total: item.total,\n      }));\n\n      const response = await fetch(\"/api/transactions\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ transaction, items }),\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || \"Failed to process transaction\");\n      }\n\n      return response.json();\n    },\n    onSuccess: (receipt) => {\n      setLastReceipt(receipt);\n      updateActiveOrderCart([]);\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      toast({\n        title: \"Transaction Complete\",\n        description: `Transaction ${receipt.transactionId} processed successfully`,\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Transaction Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateActiveOrderCart = (newCart: CartItem[]) => {\n    setOrders(prevOrders =>\n      prevOrders.map(order =>\n        order.id === activeOrderId ? { ...order, cart: newCart } : order\n      )\n    );\n  };\n\n\n  const createNewOrder = () => {\n    const newOrderId = uuidv4();\n    setOrders([...orders, { id: newOrderId, cart: [] }]);\n    setActiveOrderId(newOrderId);\n  };\n\n  const switchOrder = (orderId: string) => {\n    setActiveOrderId(orderId);\n  };\n\n  const removeOrder = (orderId: string) => {\n    if (orders.length <= 1) {\n      toast({\n        title: \"Cannot remove\",\n        description: \"Must have at least one order.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const filteredOrders = orders.filter(order => order.id !== orderId);\n    setOrders(filteredOrders);\n    \n    // If removing active order, switch to first remaining order\n    if (orderId === activeOrderId) {\n      setActiveOrderId(filteredOrders[0].id);\n    }\n  };\n\n  const addToCart = async (productId: number) => {\n    // Ensure we have a valid active order\n    const activeOrder = orders.find(order => order.id === activeOrderId);\n    if (!activeOrder) {\n      toast({\n        title: \"Lỗi\",\n        description: \"Không tìm thấy đơn hàng hiện tại\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    try {\n      // Fetch product data by ID\n      const response = await fetch(`/api/products/${productId}`);\n      if (!response.ok) throw new Error('Product not found');\n      const product = await response.json();\n\n      console.log(\"Fetched product for cart:\", product);\n\n      const currentCart = activeOrder.cart || [];\n      const existingItem = currentCart.find(item => item.id === product.id);\n\n      // Check if product has stock tracking enabled and if so, check stock\n      if (product.trackInventory !== false && product.stock <= 0) {\n        toast({\n          title: \"Không thể thêm\",\n          description: \"Sản phẩm đã hết hàng\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      let newCart;\n      if (existingItem) {\n        if (product.trackInventory !== false && existingItem.quantity >= product.stock) {\n          toast({\n            title: \"Không thể thêm\",\n            description: \"Đã đạt số lượng tối đa trong kho\",\n            variant: \"destructive\",\n          });\n          return;\n        }\n        newCart = currentCart.map(item =>\n          item.id === product.id\n            ? {\n                ...item,\n                quantity: item.quantity + 1,\n                total: (parseFloat(item.price) * (item.quantity + 1)).toFixed(2)\n              }\n            : item\n        );\n      } else {\n        const cartItem = {\n          id: product.id,\n          name: product.name,\n          price: parseFloat(product.price).toFixed(2),\n          quantity: 1,\n          total: parseFloat(product.price).toFixed(2),\n          stock: product.stock,\n          taxRate: product.taxRate || \"0\",\n          afterTaxPrice: product.afterTaxPrice || undefined\n        };\n        \n        console.log(\"Creating cart item:\", cartItem);\n        newCart = [...currentCart, cartItem];\n      }\n\n      updateActiveOrderCart(newCart);\n      toast({\n        title: \"Đã thêm vào giỏ\",\n        description: `${product.name} đã được thêm vào đơn hàng`,\n      });\n    } catch (error) {\n      console.error(\"Error adding to cart:\", error);\n      toast({\n        title: \"Lỗi\",\n        description: \"Không thể thêm sản phẩm vào giỏ hàng\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const removeFromCart = (productId: number) => {\n    const currentCart = orders.find(order => order.id === activeOrderId)?.cart || [];\n    const newCart = currentCart.filter(item => item.id !== productId);\n    updateActiveOrderCart(newCart);\n  };\n\n  const updateQuantity = (productId: number, newQuantity: number) => {\n    if (newQuantity <= 0) {\n      removeFromCart(productId);\n      return;\n    }\n\n    const currentCart = orders.find(order => order.id === activeOrderId)?.cart || [];\n    const newCart = currentCart.map(item =>\n      item.id === productId\n        ? {\n            ...item,\n            quantity: newQuantity,\n            total: (parseFloat(item.price) * newQuantity).toFixed(2)\n          }\n        : item\n    );\n    updateActiveOrderCart(newCart);\n  };\n\n  const clearCart = () => {\n    updateActiveOrderCart([]);\n  };\n\n  const processCheckout = async (paymentData: any): Promise<Receipt | null> => {\n    if (cart.length === 0) {\n      toast({\n        title: \"Empty Cart\",\n        description: \"Cannot process checkout with empty cart\",\n        variant: \"destructive\",\n      });\n      return null;\n    }\n\n    try {\n      const result = await checkoutMutation.mutateAsync({ paymentData });\n      return result;\n    } catch (error) {\n      return null;\n    }\n  };\n\n  return {\n    cart,\n    orders,\n    activeOrderId,\n    addToCart,\n    removeFromCart,\n    updateQuantity,\n    clearCart,\n    createNewOrder,\n    switchOrder,\n    removeOrder,\n    lastReceipt,\n    isProcessingCheckout: checkoutMutation.isPending,\n    processCheckout\n  };\n}","size_bytes":7816},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/lib/api.ts":{"content":"export const loginPosAsync = async (request: LoginPosRequest): Promise<LoginResponse> => {\n  const response = await fetch('/api/pos/login', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify(request),\n  });\n\n  if (!response.ok) {\n    throw new Error('Failed to login for QR payment');\n  }\n\n  return response.json();\n};\n\nexport interface LoginPosRequest {\n  clientID: string;\n  clientSecret: string;\n  masterId: string;\n  bankCode: string;\n}\n\nexport interface LoginResponse {\n  token: string;\n  // Add other response fields as needed\n}\n\nexport interface CreateQRPosRequest {\n  transactionUuid: string;\n  depositAmt: number;\n  posUniqueId: string;\n  accntNo: string;\n  posfranchiseeName: string;\n  posCompanyName: string;\n  posBillNo: string;\n}\n\nexport interface CreateQRPosResponse {\n  qrDataDecode: string;\n  qrUrl: string;\n  qrData: string;\n}\n\nexport const createQRPosAsync = async (request: CreateQRPosRequest, bankCode: string, clientID: string): Promise<CreateQRPosResponse> => {\n  const response = await fetch(`/api/pos/create-qr?bankCode=${bankCode}&clientID=${clientID}`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify(request),\n  });\n\n  if (!response.ok) {\n    const errorText = await response.text();\n    console.error('CreateQRPos API error:', response.status, errorText);\n    throw new Error(`Failed to create QR payment: ${response.status} ${response.statusText}`);\n  }\n\n  return response.json();\n};","size_bytes":1535},"client/src/lib/i18n.ts":{"content":"import { create } from \"zustand\";\nimport { persist } from \"zustand/middleware\";\nimport { translations as translationsA } from \"./i18n/translations\";\n\nexport type Language = \"ko\" | \"en\" | \"vi\";\n\ninterface LanguageStore {\n  currentLanguage: Language;\n  renderTrigger: number;\n  setLanguage: (language: Language) => void;\n}\n\nexport const useLanguageStore = create<LanguageStore>()(\n  persist(\n    (set) => ({\n      currentLanguage: \"ko\",\n      renderTrigger: 0,\n      setLanguage: (language: Language) => set((state) => ({ \n        currentLanguage: language,\n        renderTrigger: state.renderTrigger + 1\n      })),\n    }),\n    {\n      name: \"pos-language\",\n    },\n  ),\n);\n\n// Comprehensive translation object for multilingual POS system\nconst translations = {\n  ko: {\n    // Common\n    common: {\n      loading: \"로딩 중...\",\n      save: \"저장\",\n      cancel: \"취소\",\n      delete: \"삭제\",\n      edit: \"수정\",\n      add: \"추가\",\n      search: \"검색\",\n      filter: \"필터\",\n      back: \"뒤로\",\n      next: \"다음\",\n      previous: \"이전\",\n      confirm: \"확인\",\n      success: \"성공\",\n      error: \"오류\",\n      warning: \"경고\",\n      info: \"정보\",\n      yes: \"예\",\n      no: \"아니오\",\n      items: \"개\",\n      total: \"총계\",\n      subtotal: \"소계\",\n      tax: \"세금\",\n      discount: \"할인\",\n      date: \"날짜\",\n      time: \"시간\",\n      status: \"상태\",\n      active: \"활성\",\n      inactive: \"비활성\",\n      name: \"이름\",\n      description: \"설명\",\n      price: \"가격\",\n      quantity: \"수량\",\n      actions: \"작업\",\n      collapse: \"접기\",\n      expand: \"펼치기\",\n      restaurant: \"레스토랑\",\n      noRecords: \"기록이 없습니다\",\n      selectOtherDate: \"다른 날짜를 선택해보세요\",\n      category: \"카테고리\",\n    },\n    // Navigation\n    nav: {\n      pos: \"POS\",\n      tables: \"테이블\",\n      inventory: \"재고\",\n      reports: \"보고서\",\n      employees: \"직원\",\n      attendance: \"출석\",\n      suppliers: \"공급업체\",\n      customers: \"고객\",\n      settings: \"설정\",\n    },\n    // POS System\n    pos: {\n      title: \"POS 시스템\",\n      purchaseHistory: \"구매 내역\",\n      emptyCart: \"장바구니가 비어있습니다\",\n      addProductsToStart: \"상품을 추가하여 시작하세요\",\n      clearCart: \"장바구니 비우기\",\n      checkout: \"결제\",\n      payment: \"결제\",\n      cash: \"현금\",\n      card: \"카드\",\n      amountReceived: \"받은 금액\",\n      change: \"거스름돈\",\n      paymentMethod: \"결제 방법\",\n      orderComplete: \"주문 완료\",\n      printReceipt: \"영수증 출력\",\n      newOrder: \"새 주문\",\n      beforeWork: \"근무자 출근전\",\n      cashierName: \"계산원 이름\",\n      defaultCashier: \"김담당자\",\n      outOfStock: \"품절\",\n      currentlyOutOfStock: \"현재 품절입니다\",\n      addedToCart: \"장바구니에 추가됨\",\n      inStock: \"재고 있음\",\n      categories: \"카테고리\",\n      allCategories: \"전체\",\n      selectCategory: \"카테고리 선택\",\n      product: \"상품\",\n      products: \"상품\",\n      cart: \"장바구니\",\n      quantity: \"수량\",\n      totalAmount: \"총 금액\",\n      receiptNumber: \"영수증 번호\",\n      transactionId: \"거래 ID\",\n      customerInfo: \"고객 정보\",\n      customerName: \"고객명\",\n      customerPhone: \"고객 전화번호\",\n      paymentComplete: \"결제 완료\",\n      thankYou: \"감사합니다\",\n      receipt: \"영수증\",\n      today: \"오늘\",\n      yesterday: \"어제\",\n      thisWeek: \"이번 주\",\n      thisMonth: \"이번 달\",\n      thisYear: \"올해\",\n      productsAvailable: \"개 상품 사용 가능\",\n      gridView: \"그리드 보기\",\n      sortByName: \"이름순 정렬\",\n      noProductsFound: \"상품을 찾을 수 없습니다\",\n      allProducts: \"전체 상품\",\n      tryAdjustingSearch: \"검색어를 조정해보세요\",\n      noProductsInCategory: \"이 카테고리에 상품이 없습니다\",\n      popular: \"인기\",\n      lowStock: \"재고 부족\",\n      productScanned: \"상품 스캔됨\",\n      searchProducts: \"상품 검색\",\n      scanBarcode: \"바코드 스캔\",\n      manageProducts: \"상품 관리\",\n      scanFailed: \"스캔 실패\",\n      productNotFound: \"상품을 찾을 수 없습니다\",\n    },\n    // Tables\n    tables: {\n      title: \"테이블 관리\",\n      description: \"레스토랑 테이블 상태를 관리합니다\",\n      tableManagement: \"테이블 관리\",\n      backToPOS: \"POS로 돌아가기\",\n      available: \"사용 가능\",\n      occupied: \"사용 중\",\n      reserved: \"예약됨\",\n      maintenance: \"점검 중\",\n      outOfService: \"사용 불가\",\n      table: \"테이블\",\n      cleanupComplete: \"정리 완료\",\n      tableStatus: \"테이블 상태\",\n      orderManagement: \"주문 관리\",\n      tableSettings: \"테이블 설정\",\n      people: \"명\",\n      customerName: \"고객명\",\n      optional: \"(선택사항)\",\n      customerNamePlaceholder: \"고객명을 입력하세요\",\n      customerCount: \"고객 수\",\n      allCategories: \"전체 카테고리\",\n      stockCount: \"재고 수량\",\n      orderHistory: \"주문 내역\",\n      itemsSelected: \"개 선택됨\",\n      noItemsSelected: \"선택된 항목 없음\",\n      tableNumberRequired: \"테이블 번호는 필수입니다\",\n    },\n    // Employees\n    employees: {\n      title: \"직원 관리\",\n      description: \"직원 정보를 관리합니다\",\n      employeeManagement: \"직원 관리\",\n      addEmployee: \"직원 추가\",\n      editEmployee: \"직원 수정\",\n      employeeId: \"직원 ID\",\n      email: \"이메일\",\n      phone: \"전화번호\",\n      role: \"역할\",\n      manager: \"매니저\",\n      cashier: \"계산원\",\n      server: \"서버\",\n      kitchen: \"주방\",\n      hireDate: \"입사일\",\n      isActive: \"활성 상태\",\n      addEmployeeSuccess: \"직원이 성공적으로 추가되었습니다\",\n      addEmployeeError: \"직원 추가 중 오류가 발생했습니다\",\n      updateEmployeeSuccess: \"직원 정보가 성공적으로 업데이트되었습니다\",\n      updateEmployeeError: \"직원 정보 업데이트 중 오류가 발생했습니다\",\n      addEmployeeDesc: \"새 직원 정보를 입력하세요\",\n      editEmployeeDesc: \"직원 정보를 수정하세요\",\n    },\n    // Attendance\n    attendance: {\n      title: \"근태 관리\",\n      description: \"직원 출퇴근을 관리합니다\",\n      clockInOut: \"출퇴근\",\n      attendanceRecords: \"출근 기록\",\n      statistics: \"통계\",\n      clockIn: \"출근\",\n      clockOut: \"퇴근\",\n      breakStart: \"휴식 시작\",\n      breakEnd: \"휴식 종료\",\n      selectEmployee: \"직원 선택\",\n      notes: \"메모\",\n      recordsDescription: \"일일 출근 기록을 확인하세요\",\n      selectedDate: \"선택된 날짜\",\n      unknownEmployee: \"알 수 없는 직원\",\n      status: {\n        present: \"출근\",\n        absent: \"결근\",\n        late: \"지각\",\n        halfDay: \"반차\",\n      },\n      clockInSuccess: \"출근 처리 완료\",\n      clockInSuccessDesc: \"성공적으로 출근 처리되었습니다\",\n      clockInError: \"출근 처리 중 오류가 발생했습니다\",\n      clockOutSuccess: \"퇴근 처리 완료\",\n      clockOutSuccessDesc: \"성공적으로 퇴근 처리되었습니다\",\n      clockOutError: \"퇴근 처리 중 오류가 발생했습니다\",\n      breakStartSuccess: \"휴식 시작\",\n      breakStartSuccessDesc: \"휴식이 시작되었습니다\",\n      breakStartError: \"휴식 시작 중 오류가 발생했습니다\",\n      hours: \"시간\",\n      minutes: \"분\",\n      notesPlaceholder: \"메모를 입력하세요\",\n      workingTime: \"근무 시간\",\n      currentStatus: \"현재 상태\",\n      refresh: \"새로고침\",\n      clockInTime: \"출근 시간\",\n      clockOutTime: \"퇴근 시간\",\n      breakTime: \"휴식 시간\",\n      noRecords: \"출석 기록이 없습니다\",\n      selectOtherDate: \"다른 날짜를 선택해보세요\",\n      totalWorkingDays: \"총 근무일\",\n      totalEmployees: \"총 직원 수\",\n      totalAttendance: \"총 출석 수\",\n      totalWorkingHours: \"총 근무시간\",\n      totalOvertime: \"총 연장근무\",\n      averageWorkingHours: \"평균 근무시간\",\n      attendanceRate: \"출석률\",\n      employeeStats: \"직원 통계\",\n      days: \"일\",\n      people: \"명\",\n      times: \"회\",\n      overtimeHours: \"연장근무시간\",\n      monthlyStats: \"월별 통계\",\n      workHours: \"근무시간\",\n      overtime: \"연장근무\",\n      rate: \"비율\",\n    },\n    // Reports\n    reports: {\n      title: \"보고서\",\n      description: \"매출 및 운영 보고서를 확인하세요\",\n      dashboard: \"대시보드\",\n      salesAnalysis: \"매출 분석\",\n      menuAnalysis: \"메뉴 분석\",\n      tableAnalysis: \"테이블 분석\",\n      backToTables: \"테이블로 돌아가기\",\n    },\n    // Inventory\n    inventory: {\n      title: \"재고 관리\",\n      description: \"상품 재고를 관리합니다\",\n      lowStock: \"재고 부족\",\n      outOfStock: \"재고 없음\",\n      inStock: \"재고 있음\",\n      stockLevel: \"재고 수준\",\n      updateStock: \"재고 업데이트\",\n    },\n    // Suppliers\n    suppliers: {\n      title: \"공급업체 관리\",\n      description: \"공급업체 정보를 관리합니다\",\n      addSupplier: \"공급업체 추가\",\n      editSupplier: \"공급업체 수정\",\n      supplierName: \"공급업체명\",\n      contactPerson: \"담당자\",\n      email: \"이메일\",\n      phone: \"전화번호\",\n      address: \"주소\",\n      supplierStatus: \"상태\",\n      createSuccess: \"공급업체 생성 완료\",\n      createSuccessDesc: \"공급업체가 성공적으로 생성되었습니다.\",\n      createFailed: \"공급업체 생성 실패\",\n      createFailedDesc: \"공급업체 생성 중 오류가 발생했습니다.\",\n      updateSuccess: \"공급업체 업데이트 완료\",\n      updateSuccessDesc: \"공급업체 정보가 성공적으로 업데이트되었습니다.\",\n      updateFailed: \"공급업체 업데이트 실패\",\n    },\n    // Settings\n    settings: {\n      title: \"설정\",\n      description: \"시스템 설정을 관리합니다\",\n      storeSettings: \"매장 설정\",\n      language: \"언어\",\n      theme: \"테마\",\n      notifications: \"알림\",\n      storeName: \"매장명\",\n      storeCode: \"매장 코드\",\n      address: \"주소\",\n      phoneNumber: \"전화번호\",\n      businessHours: \"영업시간\",\n      currency: \"통화\",\n      taxRate: \"세율\",\n      receiptFooter: \"영수증 하단 메시지\",\n      saveSettings: \"설정 저장\",\n      resetSettings: \"설정 초기화\",\n      backToPos: \"POS로 돌아가기\",\n      storeInfo: \"매장 정보\",\n      categories: \"카테고리\",\n      employees: \"직원\",\n      paymentMethods: \"결제 방법\",\n      basicInfo: \"기본 정보\",\n      basicInfoDesc: \"매장의 기본 정보를 설정하세요\",\n      storeNamePlaceholder: \"매장명을 입력하세요\",\n      storeCodePlaceholder: \"매장 코드를 입력하세요\",\n      taxId: \"사업자 등록번호\",\n      taxIdPlaceholder: \"사업자 등록번호를 입력하세요\",\n      contactInfo: \"연락처 정보\",\n      contactInfoDesc: \"매장 연락처 정보를 설정하세요\",\n      email: \"이메일\",\n      emailPlaceholder: \"이메일을 입력하세요\",\n      phone: \"전화번호\",\n      phonePlaceholder: \"전화번호를 입력하세요\",\n      addressPlaceholder: \"주소를 입력하세요\",\n      operationHours: \"운영 시간\",\n      operationHoursDesc: \"매장 운영 시간을 설정하세요\",\n      openTime: \"오픈 시간\",\n      closeTime: \"마감 시간\",\n      categoryManagement: \"카테고리 관리\",\n      categoryManagementDesc: \"제품 카테고리를 관리하세요\",\n      categoriesRedirect: \"카테고리 페이지로 이동\",\n      employeeManagement: \"직원 관리\",\n      employeeManagementDesc: \"직원 정보를 관리하세요\",\n      goToEmployees: \"직원 관리로 이동\",\n      goToInventory: \"재고 관리로 이동\",\n      paymentMethodsDesc: \"결제 방법을 설정하세요\",\n      availablePayments: \"사용 가능한 결제 방법\",\n      addPayment: \"결제 방법 추가\",\n      enabled: \"사용\",\n      disabled: \"사용 안함\",\n      storeUpdated: \"매장 정보가 업데이트되었습니다\",\n      updateError: \"업데이트 중 오류가 발생했습니다\",\n    },\n    // Customers\n    customers: {\n      title: \"고객\",\n      customerId: \"고객 ID\",\n      name: \"이름\",\n      phone: \"전화번호\",\n      email: \"이메일\",\n      address: \"주소\",\n      visitCount: \"방문 횟수\",\n      totalSpent: \"총 구매액\",\n      points: \"포인트\",\n      membershipLevel: \"멤버십 등급\",\n      status: \"상태\",\n      addCustomer: \"고객 추가\",\n      editCustomer: \"고객 수정\",\n      deleteCustomer: \"고객 삭제\",\n      searchPlaceholder: \"고객명 또는 전화번호로 검색...\",\n      customerManagement: \"고객 관리\",\n      description: \"고객 정보를 관리하고 멤버십 시스템을 운영하세요\",\n      totalCustomers: \"총 고객\",\n      activeCustomers: \"활성 고객\",\n      pointsIssued: \"발행된 포인트\",\n      averageSpent: \"평균 구매액\",\n      newCustomer: \"새 고객\",\n      customerDetails: \"고객 상세정보\",\n      membershipInfo: \"멤버십 정보\",\n      purchaseHistory: \"구매 내역\",\n      pointHistory: \"포인트 내역\",\n      addPoints: \"포인트 추가\",\n      noCustomers: \"등록된 고객이 없습니다\",\n      loadingCustomerData: \"고객 데이터를 불러오는 중...\",\n      noRegisteredCustomers: \"등록된 고객이 없습니다.\",\n      totalCustomersRegistered: \"명의 고객이 등록되어 있습니다.\",\n      membershipManagement: \"멤버십 관리\",\n      pointsManagement: \"포인트 관리\",\n      vip: \"VIP\",\n      gold: \"골드\",\n      silver: \"실버\",\n    },\n    // Employees Settings\n    employeesSettings: {\n      loadingEmployeeData: \"직원 데이터를 불러오는 중...\",\n      noRegisteredEmployees: \"등록된 직원이 없습니다.\",\n      addEmployeeToStart: \"직원 추가 버튼을 클릭하여 새 직원을 등록하세요.\",\n      totalEmployeesRegistered: \"명의 직원이 등록되어 있습니다.\",\n      admin: \"관리자\",\n      manager: \"매니저\",\n      cashier: \"캐셔\",\n      active: \"활성\",\n      inactive: \"비활성\",\n      deleteConfirm: \"정말로\",\n      employeeDeleteConfirm: \"직원을 삭제하시겠습니까?\",\n      deleteSuccess: \"성공\",\n      employeeDeleted: \"직원이 삭제되었습니다.\",\n      deleteError: \"오류\",\n      employeeDeleteFailed: \"직원 삭제에 실패했습니다.\",\n      total: \"총\",\n    },\n    // Product Management\n    productManagement: {\n      title: \"품목 관리\",\n      description: \"품목군과 품목을 관리합니다\",\n      categoryTitle: \"품목군 관리\",\n      categoryDescription: \"품목군을 등록하고 관리합니다\",\n      productTitle: \"품목 관리\",\n      productDescription: \"품목을 등록하고 관리합니다\",\n      addCategory: \"품목군 추가\",\n      editCategory: \"품목군 수정\",\n      deleteCategory: \"품목군 삭제\",\n      addProduct: \"품목 추가\",\n      editProduct: \"품목 수정\",\n      deleteProduct: \"품목 삭제\",\n      categoryName: \"품목군명\",\n      categoryIcon: \"아이콘\",\n      categoryNamePlaceholder: \"품목군명을 입력하세요\",\n      productName: \"품목명\",\n      productSku: \"품목코드\",\n      productPrice: \"가격\",\n      productStock: \"재고\",\n      productCategory: \"품목군\",\n      productNamePlaceholder: \"품목명을 입력하세요\",\n      productSkuPlaceholder: \"품목코드를 입력하세요\",\n      productPricePlaceholder: \"가격을 입력하세요\",\n      productStockPlaceholder: \"재고를 입력하세요\",\n      noCategories: \"등록된 품목군이 없습니다\",\n      noProducts: \"등록된 품목이 없습니다\",\n      categoryCreateSuccess: \"품목군이 성공적으로 생성되었습니다\",\n      categoryUpdateSuccess: \"품목군이 성공적으로 수정되었습니다\",\n      categoryDeleteSuccess: \"품목군이 성공적으로 삭제되었습니다\",\n      productCreateSuccess: \"품목이 성공적으로 생성되었습니다\",\n      productUpdateSuccess: \"품목이 성공적으로 수정되었습니다\",\n      productDeleteSuccess: \"품목이 성공적으로 삭제되었습니다\",\n      deleteConfirm: \"정말로 삭제하시겠습니까?\",\n      categoryDeleteConfirm:\n        \"이 품목군을 삭제하면 연결된 모든 품목도 함께 삭제됩니다.\",\n      selectCategory: \"품목군 선택\",\n      allCategories: \"모든 품목군\",\n      totalCategories: \"총 품목군\",\n      totalProducts: \"총 품목\",\n      categoryStats: \"품목군 통계\",\n      productStats: \"품목 통계\",\n    },\n    // Not Found Page\n    notFound: {\n      title: \"페이지를 찾을 수 없습니다\",\n      description: \"죄송합니다. 요청하신 페이지를 찾을 수 없습니다.\",\n      backHome: \"홈으로 돌아가기\",\n      backToHome: \"POS로 돌아가기\",\n    },\n  },\n  en: {\n    // Common\n    common: {\n      loading: \"Loading...\",\n      save: \"Save\",\n      cancel: \"Cancel\",\n      delete: \"Delete\",\n      edit: \"Edit\",\n      add: \"Add\",\n      search: \"Search\",\n      filter: \"Filter\",\n      back: \"Back\",\n      next: \"Next\",\n      previous: \"Previous\",\n      confirm: \"Confirm\",\n      success: \"Success\",\n      error: \"Error\",\n      warning: \"Warning\",\n      info: \"Info\",\n      yes: \"Yes\",\n      no: \"No\",\n      items: \"items\",\n      total: \"Total\",\n      subtotal: \"Subtotal\",\n      tax: \"Tax\",\n      discount: \"Discount\",\n      date: \"Date\",\n      time: \"Time\",\n      status: \"Status\",\n      active: \"Active\",\n      inactive: \"Inactive\",\n      name: \"Name\",\n      description: \"Description\",\n      price: \"Price\",\n      quantity: \"Quantity\",\n      actions: \"Actions\",\n      collapse: \"Collapse\",\n      expand: \"Expand\",\n      restaurant: \"Restaurant\",\n      noRecords: \"No records found\",\n      selectOtherDate: \"Please select another date\",\n      category: \"Category\",\n    },\n    // Navigation\n    nav: {\n      pos: \"POS\",\n      tables: \"Tables\",\n      inventory: \"Inventory\",\n      reports: \"Reports\",\n      employees: \"Employees\",\n      attendance: \"Attendance\",\n      suppliers: \"Suppliers\",\n      customers: \"Customers\",\n      settings: \"Settings\",\n    },\n    // POS System\n    pos: {\n      title: \"POS System\",\n      purchaseHistory: \"Purchase History\",\n      emptyCart: \"Cart is empty\",\n      addProductsToStart: \"Add products to get started\",\n      clearCart: \"Clear Cart\",\n      checkout: \"Checkout\",\n      payment: \"Payment\",\n      cash: \"Cash\",\n      card: \"Card\",\n      amountReceived: \"Amount Received\",\n      change: \"Change\",\n      paymentMethod: \"Payment Method\",\n      orderComplete: \"Order Complete\",\n      printReceipt: \"Print Receipt\",\n      newOrder: \"New Order\",\n      beforeWork: \"Before Work Hours\",\n      cashierName: \"Cashier Name\",\n      defaultCashier: \"John Smith\",\n      outOfStock: \"Out of Stock\",\n      currentlyOutOfStock: \"Currently out of stock\",\n      addedToCart: \"Added to cart\",\n      inStock: \"In Stock\",\n      categories: \"Categories\",\n      allCategories: \"All\",\n      selectCategory: \"Select Category\",\n      product: \"Product\",\n      products: \"Products\",\n      cart: \"Cart\",\n      quantity: \"Quantity\",\n      totalAmount: \"Total Amount\",\n      receiptNumber: \"Receipt Number\",\n      transactionId: \"Transaction ID\",\n      customerInfo: \"Customer Info\",\n      customerName: \"Customer Name\",\n      customerPhone: \"Customer Phone\",\n      paymentComplete: \"Payment Complete\",\n      thankYou: \"Thank You\",\n      receipt: \"Receipt\",\n      today: \"Today\",\n      yesterday: \"Yesterday\",\n      thisWeek: \"This Week\",\n      thisMonth: \"This Month\",\n      thisYear: \"This Year\",\n      productsAvailable: \"products available\",\n      gridView: \"Grid View\",\n      sortByName: \"Sort by Name\",\n      noProductsFound: \"No products found\",\n      allProducts: \"All Products\",\n      tryAdjustingSearch: \"Try adjusting your search\",\n      noProductsInCategory: \"No products in this category\",\n      popular: \"Popular\",\n      lowStock: \"Low Stock\",\n      productScanned: \"Product Scanned\",\n      searchProducts: \"Search Products\",\n      scanBarcode: \"Scan Barcode\",\n      manageProducts: \"Manage Products\",\n      scanFailed: \"Scan Failed\",\n      productNotFound: \"Product not found\",\n    },\n    // Tables\n    tables: {\n      title: \"Table Management\",\n      description: \"Manage restaurant table status\",\n      tableManagement: \"Table Management\",\n      backToPOS: \"Back to POS\",\n      available: \"Available\",\n      occupied: \"Occupied\",\n      reserved: \"Reserved\",\n      maintenance: \"Maintenance\",\n      outOfService: \"Out of Service\",\n      table: \"Table\",\n      cleanupComplete: \"Cleanup Complete\",\n      tableStatus: \"Table Status\",\n      orderManagement: \"Order Management\",\n      tableSettings: \"Table Settings\",\n      people: \"people\",\n      customerName: \"Customer Name\",\n      optional: \"(optional)\",\n      customerNamePlaceholder: \"Enter customer name\",\n      customerCount: \"Customer Count\",\n      allCategories: \"All Categories\",\n      stockCount: \"Stock Count\",\n      orderHistory: \"Order History\",\n      itemsSelected: \"items selected\",\n      noItemsSelected: \"No items selected\",\n      tableNumberRequired: \"Table number is required\",\n    },\n    // Employees\n    employees: {\n      title: \"Employee Management\",\n      description: \"Manage employee information\",\n      employeeManagement: \"Employee Management\",\n      addEmployee: \"Add Employee\",\n      editEmployee: \"Edit Employee\",\n      employeeId: \"Employee ID\",\n      email: \"Email\",\n      phone: \"Phone\",\n      role: \"Role\",\n      manager: \"Manager\",\n      cashier: \"Cashier\",\n      server: \"Server\",\n      kitchen: \"Kitchen\",\n      hireDate: \"Hire Date\",\n      isActive: \"Active Status\",\n      addEmployeeSuccess: \"Employee added successfully\",\n      addEmployeeError: \"Error adding employee\",\n      updateEmployeeSuccess: \"Employee updated successfully\",\n      updateEmployeeError: \"Error updating employee\",\n      addEmployeeDesc: \"Enter new employee information\",\n      editEmployeeDesc: \"Edit employee information\",\n    },\n    // Attendance\n    attendance: {\n      title: \"Attendance Management\",\n      description: \"Manage employee attendance\",\n      clockInOut: \"Clock In/Out\",\n      attendanceRecords: \"Attendance Records\",\n      statistics: \"Statistics\",\n      clockIn: \"Clock In\",\n      clockOut: \"Clock Out\",\n      breakStart: \"Start Break\",\n      breakEnd: \"End Break\",\n      selectEmployee: \"Select Employee\",\n      notes: \"Notes\",\n      recordsDescription: \"View daily attendance records\",\n      selectedDate: \"Selected Date\",\n      unknownEmployee: \"Unknown Employee\",\n      status: {\n        present: \"Present\",\n        absent: \"Absent\",\n        late: \"Late\",\n        halfDay: \"Half Day\",\n      },\n      clockInSuccess: \"Clocked In Successfully\",\n      clockInSuccessDesc: \"Employee has been clocked in successfully\",\n      clockInError: \"Error clocking in\",\n      clockOutSuccess: \"Clocked Out Successfully\",\n      clockOutSuccessDesc: \"Employee has been clocked out successfully\",\n      clockOutError: \"Error clocking out\",\n      breakStartSuccess: \"Break Started\",\n      breakStartSuccessDesc: \"Break has been started\",\n      breakStartError: \"Error starting break\",\n      hours: \"hours\",\n      minutes: \"minutes\",\n      notesPlaceholder: \"Enter notes\",\n      workingTime: \"Working Time\",\n      currentStatus: \"Current Status\",\n      refresh: \"Refresh\",\n      clockInTime: \"Clock In Time\",\n      clockOutTime: \"Clock Out Time\",\n      breakTime: \"Break Time\",\n    },\n    // Reports\n    reports: {\n      title: \"Reports\",\n      description: \"View sales and operational reports\",\n      dashboard: \"Dashboard\",\n      salesAnalysis: \"Sales Analysis\",\n      menuAnalysis: \"Menu Analysis\",\n      tableAnalysis: \"Table Analysis\",\n      backToTables: \"Back to Tables\",\n    },\n    // Inventory\n    inventory: {\n      title: \"Inventory Management\",\n      description: \"Manage product inventory\",\n      lowStock: \"Low Stock\",\n      outOfStock: \"Out of Stock\",\n      inStock: \"In Stock\",\n      stockLevel: \"Stock Level\",\n      updateStock: \"Update Stock\",\n    },\n    // Suppliers\n    suppliers: {\n      title: \"Supplier Management\",\n      description: \"Manage supplier information\",\n      addSupplier: \"Add Supplier\",\n      editSupplier: \"Edit Supplier\",\n      supplierName: \"Supplier Name\",\n      contactPerson: \"Contact Person\",\n      email: \"Email\",\n      phone: \"Phone\",\n      address: \"Address\",\n      supplierStatus: \"Status\",\n      createSuccess: \"Supplier Created\",\n      createSuccessDesc: \"Supplier has been created successfully.\",\n      createFailed: \"Supplier Creation Failed\",\n      createFailedDesc: \"An error occurred while creating the supplier.\",\n      updateSuccess: \"Supplier Updated\",\n      updateSuccessDesc: \"Supplier has been updated successfully.\",\n      updateFailed: \"Supplier Update Failed\",\n    },\n    // Settings\n    settings: {\n      title: \"Settings\",\n      description: \"Manage system settings\",\n      storeSettings: \"Store Settings\",\n      language: \"Language\",\n      theme: \"Theme\",\n      notifications: \"Notifications\",\n      storeName: \"Store Name\",\n      storeCode: \"Store Code\",\n      address: \"Address\",\n      phoneNumber: \"Phone Number\",\n      businessHours: \"Business Hours\",\n      currency: \"Currency\",\n      taxRate: \"Tax Rate\",\n      receiptFooter: \"Receipt Footer Message\",\n      saveSettings: \"Save Settings\",\n      resetSettings: \"Reset Settings\",\n      backToPos: \"Back to POS\",\n      storeInfo: \"Store Information\",\n      categories: \"Categories\",\n      employees: \"Employees\",\n      paymentMethods: \"Payment Methods\",\n      basicInfo: \"Basic Information\",\n      basicInfoDesc: \"Configure basic store information\",\n      storeNamePlaceholder: \"Enter store name\",\n      storeCodePlaceholder: \"Enter store code\",\n      taxId: \"Tax ID\",\n      taxIdPlaceholder: \"Enter tax ID\",\n      contactInfo: \"Contact Information\",\n      contactInfoDesc: \"Configure store contact information\",\n      email: \"Email\",\n      emailPlaceholder: \"Enter email\",\n      phone: \"Phone\",\n      phonePlaceholder: \"Enter phone number\",\n      addressPlaceholder: \"Enter address\",\n      operationHours: \"Operation Hours\",\n      operationHoursDesc: \"Configure store operation hours\",\n      openTime: \"Open Time\",\n      closeTime: \"Close Time\",\n      categoryManagement: \"Category Management\",\n      categoryManagementDesc: \"Manage product categories\",\n      categoriesRedirect: \"Go to Categories\",\n      employeeManagement: \"Employee Management\",\n      employeeManagementDesc: \"Manage employee information\",\n      goToEmployees: \"Go to Employees\",\n      goToInventory: \"Go to Inventory\",\n      paymentMethodsDesc: \"Configure payment methods\",\n      availablePayments: \"Available Payment Methods\",\n      addPayment: \"Add Payment Method\",\n      enabled: \"Enabled\",\n      disabled: \"Disabled\",\n      storeUpdated: \"Store information updated\",\n      updateError: \"Error occurred during update\",\n    },\n    // Customers\n    customers: {\n      title: \"Customers\",\n      customerId: \"Customer ID\",\n      name: \"Name\",\n      phone: \"Phone\",\n      email: \"Email\",\n      address: \"Address\",\n      visitCount: \"Visit Count\",\n      totalSpent: \"Total Spent\",\n      points: \"Points\",\n      membershipLevel: \"Membership Level\",\n      status: \"Status\",\n      addCustomer: \"Add Customer\",\n      editCustomer: \"Edit Customer\",\n      deleteCustomer: \"Delete Customer\",\n      searchPlaceholder: \"Search by name or phone...\",\n      customerManagement: \"Customer Management\",\n      description: \"Manage customer information and membership system\",\n      totalCustomers: \"Total Customers\",\n      activeCustomers: \"Active Customers\",\n      pointsIssued: \"Points Issued\",\n      averageSpent: \"Average Spent\",\n      newCustomer: \"New Customer\",\n      customerDetails: \"Customer Details\",\n      membershipInfo: \"Membership Info\",\n      purchaseHistory: \"Purchase History\",\n      pointHistory: \"Point History\",\n      addPoints: \"Add Points\",\n      noCustomers: \"No customers registered\",\n      loadingCustomerData: \"Loading customer data...\",\n      noRegisteredCustomers: \"No customers registered.\",\n      totalCustomersRegistered: \" customers are registered.\",\n      membershipManagement: \"Membership Management\",\n      pointsManagement: \"Points Management\",\n      vip: \"VIP\",\n      gold: \"Gold\",\n      silver: \"Silver\",\n    },\n    // Employees Settings\n    employeesSettings: {\n      loadingEmployeeData: \"Loading employee data...\",\n      noRegisteredEmployees: \"No employees registered.\",\n      addEmployeeToStart:\n        \"Click Add Employee button to register new employees.\",\n      totalEmployeesRegistered: \" employees are registered.\",\n      admin: \"Admin\",\n      manager: \"Manager\",\n      cashier: \"Cashier\",\n      active: \"Active\",\n      inactive: \"Inactive\",\n      deleteConfirm: \"Are you sure to delete\",\n      employeeDeleteConfirm: \"employee?\",\n      deleteSuccess: \"Success\",\n      employeeDeleted: \"Employee has been deleted.\",\n      deleteError: \"Error\",\n      employeeDeleteFailed: \"Failed to delete employee.\",\n      total: \"Total\",\n    },\n    // Product Management\n    productManagement: {\n      title: \"Product Management\",\n      description: \"Manage product categories and items\",\n      categoryTitle: \"Category Management\",\n      categoryDescription: \"Register and manage product categories\",\n      productTitle: \"Product Management\",\n      productDescription: \"Register and manage products\",\n      addCategory: \"Add Category\",\n      editCategory: \"Edit Category\",\n      deleteCategory: \"Delete Category\",\n      addProduct: \"Add Product\",\n      editProduct: \"Edit Product\",\n      deleteProduct: \"Delete Product\",\n      categoryName: \"Category Name\",\n      categoryIcon: \"Icon\",\n      categoryNamePlaceholder: \"Enter category name\",\n      productName: \"Product Name\",\n      productSku: \"Product Code\",\n      productPrice: \"Price\",\n      productStock: \"Stock\",\n      productCategory: \"Category\",\n      productNamePlaceholder: \"Enter product name\",\n      productSkuPlaceholder: \"Enter product code\",\n      productPricePlaceholder: \"Enter price\",\n      productStockPlaceholder: \"Enter stock quantity\",\n      noCategories: \"No categories registered\",\n      noProducts: \"No products registered\",\n      categoryCreateSuccess: \"Category created successfully\",\n      categoryUpdateSuccess: \"Category updated successfully\",\n      categoryDeleteSuccess: \"Category deleted successfully\",\n      productCreateSuccess: \"Product created successfully\",\n      productUpdateSuccess: \"Product updated successfully\",\n      productDeleteSuccess: \"Product deleted successfully\",\n      deleteConfirm: \"Are you sure you want to delete?\",\n      categoryDeleteConfirm:\n        \"Deleting this category will also delete all associated products.\",\n      selectCategory: \"Select Category\",\n      allCategories: \"All Categories\",\n      totalCategories: \"Total Categories\",\n      totalProducts: \"Total Products\",\n      categoryStats: \"Category Statistics\",\n      productStats: \"Product Statistics\",\n    },\n    // Not Found Page\n    notFound: {\n      title: \"Page Not Found\",\n      description: \"Sorry, we could not find the page you are looking for.\",\n      backHome: \"Back to Home\",\n      backToHome: \"Back to POS\",\n    },\n  },\n  vi: {\n    // Common\n    common: {\n      loading: \"Đang tải...\",\n      save: \"Lưu\",\n      cancel: \"Hủy\",\n      delete: \"Xóa\",\n      edit: \"Sửa\",\n      add: \"Thêm\",\n      search: \"Tìm kiếm\",\n      filter: \"Lọc\",\n      back: \"Quay lại\",\n      next: \"Tiếp theo\",\n      previous: \"Trước\",\n      confirm: \"Xác nhận\",\n      success: \"Thành công\",\n      error: \"Lỗi\",\n      warning: \"Cảnh báo\",\n      info: \"Thông tin\",\n      yes: \"Có\",\n      no: \"Không\",\n      items: \"mục\",\n      total: \"Tổng cộng\",\n      subtotal: \"Tạm tính\",\n      tax: \"Thuế\",\n      discount: \"Giảm giá\",\n      date: \"Ngày\",\n      time: \"Thời gian\",\n      status: \"Trạng thái\",\n      active: \"Hoạt động\",\n      inactive: \"Không hoạt động\",\n      name: \"Tên\",\n      description: \"Mô tả\",\n      price: \"Giá\",\n      quantity: \"Số lượng\",\n      actions: \"Hành động\",\n      collapse: \"Thu gọn\",\n      expand: \"Mở rộng\",\n      restaurant: \"Nhà hàng\",\n      noRecords: \"Không có bản ghi\",\n      selectOtherDate: \"Vui lòng chọn ngày khác\",\n      category: \"Danh mục\",\n    },\n    // Navigation\n    nav: {\n      pos: \"POS\",\n      tables: \"Bàn\",\n      inventory: \"Kho\",\n      reports: \"Báo cáo\",\n      employees: \"Nhân viên\",\n      attendance: \"Chấm công\",\n      suppliers: \"Nhà cung cấp\",\n      customers: \"Khách hàng\",\n      settings: \"Cài đặt\",\n    },\n    // POS System\n    pos: {\n      title: \"Hệ thống POS\",\n      purchaseHistory: \"Lịch sử mua hàng\",\n      emptyCart: \"Giỏ hàng trống\",\n      addProductsToStart: \"Thêm sản phẩm để bắt đầu\",\n      clearCart: \"Xóa giỏ hàng\",\n      checkout: \"Thanh toán\",\n      payment: \"Thanh toán\",\n      cash: \"Tiền mặt\",\n      card: \"Thẻ\",\n      amountReceived: \"Số tiền nhận\",\n      change: \"Tiền thừa\",\n      paymentMethod: \"Phương thức thanh toán\",\n      orderComplete: \"Hoàn thành đơn hàng\",\n      printReceipt: \"In hóa đơn\",\n      newOrder: \"Đơn hàng mới\",\n      beforeWork: \"Trước giờ làm việc\",\n      cashierName: \"Tên thu ngân\",\n      defaultCashier: \"Nguyễn Thu Ngân\",\n      outOfStock: \"Hết hàng\",\n      currentlyOutOfStock: \"Hiện tại hết hàng\",\n      addedToCart: \"Đã thêm vào giỏ hàng\",\n      inStock: \"Còn hàng\",\n      categories: \"Danh mục\",\n      allCategories: \"Tất cả\",\n      selectCategory: \"Chọn danh mục\",\n      product: \"Sản phẩm\",\n      products: \"Sản phẩm\",\n      cart: \"Giỏ hàng\",\n      quantity: \"Số lượng\",\n      totalAmount: \"Tổng tiền\",\n      receiptNumber: \"Số hóa đơn\",\n      transactionId: \"Mã giao dịch\",\n      customerInfo: \"Thông tin khách hàng\",\n      customerName: \"Tên khách hàng\",\n      customerPhone: \"Điện thoại khách hàng\",\n      paymentComplete: \"Thanh toán thành công\",\n      thankYou: \"Cám ơn\",\n      receipt: \"Hóa đơn\",\n      today: \"Hôm nay\",\n      yesterday: \"Hôm qua\",\n      thisWeek: \"Tuần này\",\n      thisMonth: \"Tháng này\",\n      thisYear: \"Năm nay\",\n      productsAvailable: \"sản phẩm có sẵn\",\n      gridView: \"Xem lưới\",\n      sortByName: \"Sắp xếp theo tên\",\n      noProductsFound: \"Không tìm thấy sản phẩm\",\n      allProducts: \"Tất cả sản phẩm\",\n      tryAdjustingSearch: \"Thử điều chỉnh tìm kiếm\",\n      noProductsInCategory: \"Không có sản phẩm trong danh mục này\",\n      popular: \"Phổ biến\",\n      lowStock: \"Sắp hết hàng\",\n      productScanned: \"Sản phẩm đã quét\",\n      searchProducts: \"Tìm kiếm sản phẩm\",\n      scanBarcode: \"Quét mã vạch\",\n      manageProducts: \"Quản lý sản phẩm\",\n      scanFailed: \"Quét thất bại\",\n      productNotFound: \"Không tìm thấy sản phẩm\",\n    },\n    // Tables\n    tables: {\n      title: \"Quản lý bàn\",\n      description: \"Quản lý trạng thái bàn nhà hàng\",\n      tableManagement: \"Quản lý bàn\",\n      backToPOS: \"Quay lại POS\",\n      available: \"Có sẵn\",\n      occupied: \"Đã sử dụng\",\n      reserved: \"Đã đặt\",\n      maintenance: \"Bảo trì\",\n      outOfService: \"Ngưng hoạt động\",\n      table: \"Bàn\",\n      cleanupComplete: \"Hoàn thành dọn dẹp\",\n      tableStatus: \"Trạng thái bàn\",\n      orderManagement: \"Quản lý đơn hàng\",\n      tableSettings: \"Cài đặt bàn\",\n      people: \"người\",\n      customerName: \"Tên khách hàng\",\n      optional: \"(tùy chọn)\",\n      customerNamePlaceholder: \"Nhập tên khách hàng\",\n      customerCount: \"Số lượng khách\",\n      allCategories: \"Tất cả danh mục\",\n      stockCount: \"Số lượng tồn kho\",\n      orderHistory: \"Lịch sử đơn hàng\",\n      itemsSelected: \"mục đã chọn\",\n      noItemsSelected: \"Không có mục nào được chọn\",\n      tableNumberRequired: \"Số bàn là bắt buộc\",\n      tableCreateSuccess: \"Tạo bàn thành công\",\n      tableUpdateSuccess: \"Cập nhật bàn thành công\",\n      tableDeleteSuccess: \"Xóa bàn thành công\",\n      tableDeleteError: \"Không thể xóa bàn đã được sử dụng\",\n      tableNumberLabel: \"Số bàn\",\n      capacityLabel: \"Sức chứa\",\n      statusLabel: \"Trạng thái\",\n      qrCodeLabel: \"Mã QR\",\n      createdDate: \"Ngày tạo\",\n      addTable: \"Thêm bàn\",\n      editTable: \"Sửa bàn\",\n      addTableDesc: \"Nhập thông tin bàn mới\",\n      editTableDesc: \"Chỉnh sửa thông tin bàn\",\n      tableNumberPlaceholder: \"Nhập số bàn\",\n      capacityPlaceholder: \"Nhập sức chứa\",\n      \n    },\n    // Employees\n    employees: {\n      title: \"Quản lý nhân viên\",\n      description: \"Quản lý thông tin nhân viên\",\n      employeeManagement: \"Quản lý nhân viên\",\n      addEmployee: \"Thêm nhân viên\",\n      editEmployee: \"Sửa nhân viên\",\n      employeeId: \"ID nhân viên\",\n      email: \"Email\",\n      phone: \"Điện thoại\",\n      role: \"Vai trò\",\n      manager: \"Quản lý\",\n      cashier: \"Thu ngân\",\n      server: \"Phục vụ\",\n      kitchen: \"Bếp\",\n      hireDate: \"Ngày tuyển dụng\",\n      isActive: \"Trạng thái hoạt động\",\n      addEmployeeSuccess: \"Thêm nhân viên thành công\",\n      addEmployeeError: \"Lỗi khi thêm nhân viên\",\n      updateEmployeeSuccess: \"Cập nhật nhân viên thành công\",\n      updateEmployeeError: \"Lỗi khi cập nhật nhân viên\",\n      addEmployeeDesc: \"Nhập thông tin nhân viên mới\",\n      editEmployeeDesc: \"Chỉnh sửa thông tin nhân viên\",\n    },\n    // Attendance\n    attendance: {\n      title: \"Quản lý chấm công\",\n      description: \"Quản lý chấm công nhân viên\",\n      clockInOut: \"Chấm công\",\n      attendanceRecords: \"Bản ghi chấm công\",\n      statistics: \"Thống kê\",\n      clockIn: \"Chấm công vào\",\n      clockOut: \"Chấm công ra\",\n      breakStart: \"Bắt đầu nghỉ\",\n      breakEnd: \"Kết thúc nghỉ\",\n      selectEmployee: \"Chọn nhân viên\",\n      notes: \"Ghi chú\",\n      recordsDescription: \"Xem bản ghi chấm công hàng ngày\",\n      selectedDate: \"Ngày đã chọn\",\n      unknownEmployee: \"Nhân viên không xác định\",\n      status: {\n        present: \"Có mặt\",\n        absent: \"Vắng mặt\",\n        late: \"Muộn\",\n        halfDay: \"Nửa ngày\",\n      },\n      clockInSuccess: \"Chấm công vào thành công\",\n      clockInSuccessDesc: \"Nhân viên đã chấm công vào thành công\",\n      clockInError: \"Lỗi khi chấm công vào\",\n      clockOutSuccess: \"Chấm công ra thành công\",\n      clockOutSuccessDesc: \"Nhân viên đã chấm công ra thành công\",\n      clockOutError: \"Lỗi khi chấm công ra\",\n      breakStartSuccess: \"Bắt đầu nghỉ\",\n      breakStartSuccessDesc: \"Đã bắt đầu thời gian nghỉ\",\n      breakStartError: \"Lỗi khi bắt đầu nghỉ\",\n      hours: \"giờ\",\n      minutes: \"phút\",\n      notesPlaceholder: \"Nhập ghi chú\",\n      workingTime: \"Thời gian làm việc\",\n      currentStatus: \"Trạng thái hiện tại\",\n      refresh: \"Làm mới\",\n      clockInTime: \"Thời gian vào\",\n      clockOutTime: \"Thời gian ra\",\n      breakTime: \"Thời gian nghỉ\",\n      noRecords: \"Không có bản ghi chấm công\",\n      selectOtherDate: \"Vui lòng chọn ngày khác\",\n      totalWorkingDays: \"Tổng ngày làm việc\",\n      totalEmployees: \"Tổng nhân viên\",\n      totalAttendance: \"Tổng lần chấm công\",\n      totalWorkingHours: \"Tổng giờ làm việc\",\n      totalOvertime: \"Tổng giờ làm thêm\",\n      averageWorkingHours: \"Giờ làm việc trung bình\",\n      attendanceRate: \"Tỷ lệ chấm công\",\n      employeeStats: \"Thống kê nhân viên\",\n      days: \"ngày\",\n      people: \"người\",\n      times: \"lần\",\n      overtimeHours: \"Giờ làm thêm\",\n      monthlyStats: \"Thống kê tháng\",\n      workHours: \"Giờ làm việc\",\n      overtime: \"Làm thêm\",\n      rate: \"Tỷ lệ\",\n    },\n    // Reports\n    reports: {\n      title: \"Báo cáo\",\n      description: \"Xem báo cáo bán hàng và vận hành\",\n      dashboard: \"Bảng điều khiển\",\n      salesAnalysis: \"Phân tích bán hàng\",\n      menuAnalysis: \"Phân tích menu\",\n      tableAnalysis: \"Phân tích bàn\",\n      backToTables: \"Quay lại bàn\",\n    },\n    // Inventory\n    inventory: {\n      title: \"Quản lý kho\",\n      description: \"Quản lý tồn kho sản phẩm\",\n      lowStock: \"Tồn kho thấp\",\n      outOfStock: \"Hết hàng\",\n      totalValue: \"Giá trị tổng cộng\",\n      totalProducts: \"Tổng sản phẩm\",\n      inStock: \"Còn hàng\",\n      stockLevel: \"Mức tồn kho\",\n      updateStock: \"Cập nhật tồn kho\",\n      searchProducts: \"Tìm kiếm sản phẩm...\",\n      stockStatus: \"Trạng thái tồn kho\",\n      allStock: \"Tất cả tồn kho\",\n      productName: \"Tên sản phẩm\",\n      currentStock: \"Tồn kho hiện tại\",\n      unitPrice: \"Đơn giá\",\n      stockValue: \"Giá trị tồn kho\",\n      management: \"Quản lý\",\n      edit: \"Chỉnh sửa\",\n      stockUpdate: \"Cập nhật tồn kho\",\n    },\n    // Suppliers\n    suppliers: {\n      title: \"Quản lý nhà cung cấp\",\n      description: \"Quản lý thông tin nhà cung cấp\",\n      addSupplier: \"Thêm nhà cung cấp\",\n      editSupplier: \"Sửa nhà cung cấp\",\n      supplierName: \"Tên nhà cung cấp\",\n      contactPerson: \"Người liên hệ\",\n      email: \"Email\",\n      phone: \"Điện thoại\",\n      address: \"Đ ��a chỉ\",\n      supplierStatus: \"Trạng thái\",\n      createSuccess: \"Tạo nhà cung cấp thành công\",\n      createSuccessDesc: \"Nhà cung cấp đã được tạo thành công.\",\n      createFailed: \"Tạo nhà cung cấp thất bại\",\n      createFailedDesc: \"Có lỗi xảy ra khi tạo nhà cung cấp.\",\n      updateSuccess: \"Cập nhật nhà cung cấp thành công\",\n      updateSuccessDesc: \"Nhà cung cấp đã được cập nhật thành công.\",\n      updateFailed: \"Cập nhật nhà cung cấp thất bại\",\n    },\n    // Settings\n    settings: {\n      title: \"Cài đặt\",\n      description: \"Quản lý cài đặt hệ thống\",\n      storeSettings: \"Cài đặt cửa hàng\",\n      language: \"Ngôn ngữ\",\n      theme: \"Giao diện\",\n      notifications: \"Thông báo\",\n      storeName: \"Tên cửa hàng\",\n      storeCode: \"Mã cửa hàng\",\n      address: \"Địa chỉ\",\n      phoneNumber: \"Số điện thoại\",\n      businessHours: \"Giờ kinh doanh\",\n      currency: \"Tiền tệ\",\n      taxRate: \"Thuế suất\",\n      receiptFooter: \"Tin nhắn chân hóa đơn\",\n      saveSettings: \"Lưu cài đặt\",\n      resetSettings: \"Đặt lại cài đặt\",\n      backToPos: \"Quay lại POS\",\n      storeInfo: \"Thông tin cửa hàng\",\n      categories: \"Danh mục\",\n      employees: \"Nhân viên\",\n      paymentMethods: \"Phương thức thanh toán\",\n      basicInfo: \"Thông tin cơ bản\",\n      basicInfoDesc: \"Cấu hình thông tin cơ bản cửa hàng\",\n      storeNamePlaceholder: \"Nhập tên cửa hàng\",\n      storeCodePlaceholder: \"Nhập mã cửa hàng\",\n      taxId: \"Mã số thuế\",\n      taxIdPlaceholder: \"Nhập mã số thuế\",\n      contactInfo: \"Thông tin liên hệ\",\n      contactInfoDesc: \"Cấu hình thông tin liên hệ cửa hàng\",\n      email: \"Email\",\n      emailPlaceholder: \"Nhập email\",\n      phone: \"Điện thoại\",\n      phonePlaceholder: \"Nhập số điện thoại\",\n      addressPlaceholder: \"Nhập địa chỉ\",\n      operationHours: \"Giờ hoạt động\",\n      operationHoursDesc: \"Cấu hình giờ hoạt động cửa hàng\",\n      openTime: \"Giờ mở cửa\",\n      closeTime: \"Giờ đóng cửa\",\n      categoryManagement: \"Quản lý danh mục\",\n      categoryManagementDesc: \"Quản lý danh mục sản phẩm\",\n      categoriesRedirect: \"Đi đến Danh mục\",\n      employeeManagement: \"Quản lý nhân viên\",\n      employeeManagementDesc: \"Quản lý thông tin nhân viên\",\n      goToEmployees: \"Đi đến Nhân viên\",\n      goToInventory: \"Đi đến Kho hàng\",\n      paymentMethodsDesc: \"Cấu hình phương thức thanh toán\",\n      availablePayments: \"Phương thức thanh toán có sẵn\",\n      addPayment: \"Thêm phương thức thanh toán\",\n      enabled: \"Đã bật\",\n      disabled: \"Đã tắt\",\n      storeUpdated: \"Thông tin cửa hàng đã được cập nhật\",\n      updateError: \"Có lỗi xảy ra trong quá trình cập nhật\",\n    },\n    // Customers\n    customers: {\n      title: \"Khách hàng\",\n      customerId: \"Mã khách hàng\",\n      name: \"Tên\",\n      phone: \"Điện thoại\",\n      email: \"Email\",\n      address: \"Địa chỉ\",\n      visitCount: \"Số lần ghé thăm\",\n      totalSpent: \"Tổng chi tiêu\",\n      points: \"Điểm\",\n      membershipLevel: \"Cấp thành viên\",\n      status: \"Trạng thái\",\n      addCustomer: \"Thêm khách hàng\",\n      editCustomer: \"Sửa khách hàng\",\n      deleteCustomer: \"Xóa khách hàng\",\n      searchPlaceholder: \"Tìm theo tên hoặc điện thoại...\",\n      customerManagement: \"Quản lý khách hàng\",\n      description: \"Quản lý thông tin khách hàng và hệ thống thành viên\",\n      totalCustomers: \"Tổng khách hàng\",\n      activeCustomers: \"Khách hàng hoạt động\",\n      pointsIssued: \"Điểm đã phát hành\",\n      averageSpent: \"Chi tiêu trung bình\",\n      newCustomer: \"Khách hàng mới\",\n      customerDetails: \"Chi tiết khách hàng\",\n      membershipInfo: \"Thông tin thành viên\",\n      purchaseHistory: \"Lịch sử mua hàng\",\n      pointHistory: \"Lịch sử điểm\",\n      addPoints: \"Thêm điểm\",\n      noCustomers: \"Chưa có khách hàng đăng ký\",\n      loadingCustomerData: \"Đang tải dữ liệu khách hàng...\",\n      noRegisteredCustomers: \"Chưa có khách hàng đăng ký.\",\n      totalCustomersRegistered: \" khách hàng đã đăng ký.\",\n      membershipManagement: \"Quản lý thành viên\",\n      pointsManagement: \"Quản lý điểm\",\n      vip: \"VIP\",\n      gold: \"Vàng\",\n      silver: \"Bạc\",\n    },\n    // Employees Settings\n    employeesSettings: {\n      loadingEmployeeData: \"Đang tải dữ liệu nhân viên...\",\n      noRegisteredEmployees: \"Chưa có nhân viên đăng ký.\",\n      addEmployeeToStart: \"Nhấp nút Thêm Nhân viên để đăng ký nhân viên mới.\",\n      totalEmployeesRegistered: \" nhân viên đã đăng ký.\",\n      admin: \"Quản trị viên\",\n      manager: \"Quản lý\",\n      cashier: \"Thu ngân\",\n      active: \"Hoạt động\",\n      inactive: \"Không hoạt động\",\n      deleteConfirm: \"Bạn có chắc chắn xóa\",\n      employeeDeleteConfirm: \"nhân viên?\",\n      deleteSuccess: \"Thành công\",\n      employeeDeleted: \"Nhân viên đã được xóa.\",\n      deleteError: \"Lỗi\",\n      employeeDeleteFailed: \"Không thể xóa nhân viên.\",\n      total: \"Tổng\",\n    },\n    // Product Management\n    productManagement: {\n      title: \"Quản lý sản phẩm\",\n      description: \"Quản lý danh mục và sản phẩm\",\n      categoryTitle: \"Quản lý danh mục\",\n      categoryDescription: \"Đăng ký và quản lý danh mục sản phẩm\",\n      productTitle: \"Quản lý sản phẩm\",\n      productDescription: \"Đăng ký và quản lý sản phẩm\",\n      addCategory: \"Thêm danh mục\",\n      editCategory: \"Sửa danh mục\",\n      deleteCategory: \"Xóa danh mục\",\n      addProduct: \"Thêm sản phẩm\",\n      editProduct: \"Sửa sản phẩm\",\n      deleteProduct: \"Xóa sản phẩm\",\n      categoryName: \"Tên danh mục\",\n      categoryIcon: \"Biểu tượng\",\n      categoryNamePlaceholder: \"Nhập tên danh mục\",\n      productName: \"Tên sản phẩm\",\n      productSku: \"Mã sản phẩm\",\n      productPrice: \"Giá\",\n      productStock: \"Tồn kho\",\n      productCategory: \"Danh mục\",\n      productNamePlaceholder: \"Nhập tên sản phẩm\",\n      productSkuPlaceholder: \"Nhập mã sản phẩm\",\n      productPricePlaceholder: \"Nhập giá\",\n      productStockPlaceholder: \"Nhập số lượng tồn kho\",\n      noCategories: \"Chưa có danh mục nào\",\n      noProducts: \"Chưa có sản phẩm nào\",\n      categoryCreateSuccess: \"Danh mục đã được tạo thành công\",\n      categoryUpdateSuccess: \"Danh mục đã được cập nhật thành công\",\n      categoryDeleteSuccess: \"Danh mục đã được xóa thành công\",\n      productCreateSuccess: \"Sản phẩm đã được tạo thành công\",\n      productUpdateSuccess: \"Sản phẩm đã được cập nhật thành công\",\n      productDeleteSuccess: \"Sản phẩm đã được xóa thành công\",\n      deleteConfirm: \"Bạn có chắc chắn muốn xóa?\",\n      categoryDeleteConfirm:\n        \"Xóa danh mục này sẽ xóa tất cả sản phẩm liên quan.\",\n      selectCategory: \"Chọn danh mục\",\n      allCategories: \"Tất cả danh mục\",\n      totalCategories: \"Tổng danh mục\",\n      totalProducts: \"Tổng sản phẩm\",\n      categoryStats: \"Thống kê danh mục\",\n      productStats: \"Thống kê sản phẩm\",\n    },\n    // Not Found Page\n    notFound: {\n      title: \"Không tìm thấy trang\",\n      description:\n        \"Xin lỗi, chúng tôi không thể tìm thấy trang bạn đang tìm kiếm.\",\n      backHome: \"Về trang chủ\",\n      backToHome: \"Quay lại POS\",\n    },\n  },\n};\n\nexport function useTranslation() {\n  const { currentLanguage } = useLanguageStore();\n\n  const t = (key: string): string => {\n    const keys = key.split(\".\");\n    let value: any = translationsA[currentLanguage];\n\n    for (const k of keys) {\n      value = value?.[k];\n    }\n\n    return value || key;\n  };\n\n  return { t, currentLanguage };\n}\n","size_bytes":50189},"client/src/lib/i18n_backup.ts":{"content":"import { create } from 'zustand';\n\nexport type Language = 'ko' | 'en' | 'vi';\n\ninterface LanguageStore {\n  currentLanguage: Language;\n  setLanguage: (language: Language) => void;\n}\n\nexport const useLanguageStore = create<LanguageStore>((set) => ({\n  currentLanguage: (typeof window !== 'undefined' ? localStorage.getItem('language') as Language : null) || 'ko',\n  setLanguage: (language: Language) => {\n    console.log('🌐 언어 변경:', language);\n    if (typeof window !== 'undefined') {\n      localStorage.setItem('language', language);\n    }\n    set({ currentLanguage: language });\n  },\n}));\n\nexport const translations = {\n  ko: {\n    // 공통\n    common: {\n      loading: '로딩 중...',\n      save: '저장',\n      cancel: '취소',\n      edit: '편집',\n      delete: '삭제',\n      add: '추가',\n      search: '검색',\n      confirm: '확인',\n      close: '닫기',\n      submit: '제출',\n      back: '뒤로',\n      next: '다음',\n      previous: '이전',\n      select: '선택',\n      total: '총액',\n      subtotal: '소계',\n      tax: '세금',\n      change: '거스름돈',\n      quantity: '수량',\n      price: '가격',\n      name: '이름',\n      description: '설명',\n      category: '카테고리',\n      status: '상태',\n      date: '날짜',\n      time: '시간',\n      actions: '작업',\n      success: '성공',\n      error: '오류',\n      warning: '경고',\n      info: '정보',\n      restaurant: '레스토랑 본점',\n      logout: '로그아웃',\n      items: '개',\n      collapse: '접기',\n      products: '상품'\n    },\n    \n    // 네비게이션\n    nav: {\n      pos: 'POS',\n      tables: '테이블',\n      inventory: '재고',\n      employees: '직원',\n      attendance: '출근',\n      reports: '보고서'\n    },\n    \n    // POS 시스템\n    pos: {\n      title: 'POS 시스템',\n      allCategories: '전체 카테고리',\n      addToCart: '장바구니 담기',\n      cart: '장바구니',\n      emptyCart: '장바구니가 비어있습니다',\n      clearCart: '모두 삭제',\n      checkout: '결제',\n      cash: '현금',\n      card: '카드',\n      mobile: '모바일',\n      cashierName: '계산원',\n      amountReceived: '받은 금액',\n      paymentMethod: '결제 방법',\n      printReceipt: '영수증 출력',\n      newTransaction: '새 거래',\n      outOfStock: '재고 없음',\n      transactionComplete: '거래 완료',\n      transactionFailed: '거래 실패',\n      productManager: '상품 관리',\n      productName: '상품명',\n      sku: 'SKU',\n      stock: '재고',\n      imageUrl: '이미지 URL',\n      isActive: '활성 상태',\n      addProductsToStart: '시작하려면 상품을 추가하세요',\n      searchProducts: '상품 검색...',\n      scanBarcode: '바코드 스캔',\n      categories: '카테고리',\n      allProducts: '모든 상품',\n      productScanned: '상품 스캔됨',\n      scanFailed: '스캔 실패',\n      productNotFound: '상품을 찾을 수 없습니다',\n      currentlyOutOfStock: '현재 품절입니다',\n      inStock: '재고',\n      addItemsToCart: '상품을 장바구니에 추가하세요'\n    },\n    \n    // 테이블 관리\n    tables: {\n      title: '테이블 관리',\n      description: '매장 테이블과 주문을 관리합니다.',\n      backToPOS: 'POS로 돌아가기',\n      tableStatus: '테이블 현황',\n      orderManagement: '주문 관리',\n      tableSettings: '테이블 설정',\n      people: '명',\n      available: '사용 가능',\n      occupied: '사용 중',\n      reserved: '예약됨',\n      outOfService: '사용 불가',\n      cleanupComplete: '정리완료'\n    },\n    \n    // 재고 관리\n    inventory: {\n      title: '재고 관리',\n      description: '상품 재고를 관리하고 재고 현황을 확인합니다.',\n      addProduct: '상품 추가',\n      searchProducts: '상품 검색...',\n      lowStock: '재고 부족',\n      outOfStock: '품절',\n      inStock: '재고 있음',\n      allStock: '전체',\n      stockUpdate: '재고 수정',\n      quantity: '수량',\n      notes: '메모',\n      loading: '재고 정보를 불러오는 중...',\n      productName: '상품명',\n      currentStock: '현재 재고',\n      unitPrice: '단가',\n      stockValue: '재고 가치',\n      management: '관리',\n      edit: '수정',\n      noProducts: '조건에 맞는 상품이 없습니다.',\n      uncategorized: '미분류',\n      currentStockLabel: '현재 재고',\n      stockUpdateType: '수정 유형',\n      selectUpdateType: '수정 유형 선택',\n      addStock: '재고 추가',\n      subtractStock: '재고 차감',\n      setStock: '재고 설정',\n      quantityInput: '수량 입력',\n      notesOptional: '메모 (선택사항)',\n      changeReason: '변경 사유나 메모',\n      processing: '처리중...',\n      stockStatus: '재고 상태'\n    },\n    \n    // 직원 관리\n    employees: {\n      title: '직원 관리',\n      description: '직원 정보를 관리하고 추가/수정할 수 있습니다.',\n      addEmployee: '직원 추가',\n      employeeManagement: '직원 관리',\n      manager: '매니저',\n      admin: '관리자',\n      cashier: '캐셔',\n      name: '직원명'\n    },\n    \n    // 근태 관리\n    attendance: {\n      title: '근태 관리',\n      description: '직원들의 출근, 퇴근 및 근무 시간을 관리합니다.',\n      clockInOut: '출퇴근',\n      attendanceRecords: '근태 기록',\n      statistics: '통계',\n      employeeSelect: '직원 선택',\n      clockIn: '출근',\n      clockOut: '퇴근',\n      startBreak: '휴식 시작',\n      endBreak: '휴식 종료',\n      notes: '메모',\n      notesPlaceholder: '출근/퇴근 메모 (선택사항)',\n      currentStatus: '현재 상태',\n      workingTime: '근무 시간',\n      breakTime: '휴식 시간',\n      clockInSuccess: '출근 완료',\n      clockInSuccessDesc: '출근이 기록되었습니다.',\n      clockOutSuccess: '퇴근 완료',\n      clockOutSuccessDesc: '퇴근이 기록되었습니다.',\n      breakStartSuccess: '휴식 시작',\n      breakStartSuccessDesc: '휴식 시간이 시작되었습니다.',\n      breakEndSuccess: '휴식 종료',\n      breakEndSuccessDesc: '휴식 시간이 종료되었습니다.',\n      clockInError: '출근 기록에 실패했습니다.',\n      clockOutError: '퇴근 기록에 실패했습니다.',\n      breakStartError: '휴식 시작에 실패했습니다.',\n      breakEndError: '휴식 종료에 실패했습니다.',\n      selectEmployee: '직원을 선택하세요',\n      unknownEmployee: '알 수 없음',\n      recordsDescription: '직원들의 일별 근태 기록을 확인합니다.',\n      selectedDate: '날짜 선택',\n      selectOtherDate: '다른 날짜를 선택해보세요.',\n      employee: '직원',\n      clockInTime: '출근 시간',\n      clockOutTime: '퇴근 시간',\n      totalHours: '총 근무 시간',\n      overtime: '초과 근무',\n      breakDuration: '휴식 시간',\n      noRecords: '해당 날짜에 근태 기록이 없습니다.',\n      statsDescription: '월별 근태 통계를 확인합니다.',\n      selectedMonth: '선택 월',\n      monthlyStats: '월간 통계',\n      totalWorkingDays: '총 근무일',\n      totalEmployees: '총 직원 수',\n      totalAttendance: '총 출근 횟수',\n      totalWorkingHours: '총 근무 시간',\n      totalOvertime: '총 초과 근무',\n      averageWorkingHours: '평균 근무 시간',\n      attendanceRate: '출근율',\n      employeeStats: '직원별 통계',\n      days: '일',\n      people: '명',\n      times: '회',\n      hours: '시간',\n      minutes: '분',\n      percent: '%',\n      status: {\n        present: '출근',\n        absent: '결근',\n        late: '지각',\n        halfDay: '반차',\n        onBreak: '휴게 중',\n        working: '근무 중',\n        clockedOut: '퇴근 완료'\n      }\n    },\n    \n    // 매출 분석\n    reports: {\n      title: '매출 분석',\n      description: '매출 현황과 운영 지표를 분석합니다.',\n      backToTables: '테이블로 돌아가기',\n      dashboard: '대시보드',\n      salesAnalysis: '매출 분석',\n      menuAnalysis: '메뉴 분석',\n      tableAnalysis: '테이블 분석'\n    },\n\n    // 설정\n    settings: {\n      title: '시스템 설정',\n      description: '매장 정보, 직원, 결제수단 등을 관리합니다.',\n      storeInfo: '매장 정보',\n      categories: '품목 관리',\n      employees: '직원 관리',\n      payments: '결제 수단',\n      basicInfo: '기본 정보',\n      basicInfoDesc: '매장의 기본 정보를 설정합니다.',\n      contactInfo: '연락처 정보',\n      contactInfoDesc: '매장의 연락처 정보를 설정합니다.',\n      operationHours: '운영 시간',\n      operationHoursDesc: '매장의 운영 시간을 설정합니다.',\n      storeName: '매장명',\n      storeNamePlaceholder: '매장 이름을 입력하세요',\n      storeCode: '매장 코드',\n      storeCodePlaceholder: '매장 코드를 입력하세요',\n      taxId: '사업자등록번호',\n      taxIdPlaceholder: '사업자등록번호를 입력하세요',\n      address: '주소',\n      addressPlaceholder: '매장 주소를 입력하세요',\n      phone: '전화번호',\n      phonePlaceholder: '전화번호를 입력하세요',\n      email: '이메일',\n      emailPlaceholder: '이메일 주소를 입력하세요',\n      openTime: '개점 시간',\n      closeTime: '폐점 시간',\n      categoryManagement: '품목군 관리',\n      categoryManagementDesc: '제품 카테고리와 품목을 관리합니다.',\n      categoriesRedirect: '품목 관리는 재고 관리 페이지에서 할 수 있습니다.',\n      goToInventory: '재고 관리로 이동',\n      employeeManagement: '직원 정보 관리',\n      employeeManagementDesc: '직원 정보를 등록하고 관리합니다.',\n      employeesRedirect: '직원 관리는 직원 관리 페이지에서 할 수 있습니다.',\n      goToEmployees: '직원 관리로 이동',\n      paymentMethods: '결제 수단 설정',\n      paymentMethodsDesc: '사용할 결제 수단을 선택하고 관리합니다.',\n      availablePayments: '사용 가능한 결제 수단',\n      addPayment: '결제 수단 추가',\n      enabled: '사용 중',\n      disabled: '사용 안함',\n      backToPos: 'POS로 돌아가기'\n    }\n  },\n  \n  en: {\n    // Common\n    common: {\n      loading: 'Loading...',\n      save: 'Save',\n      cancel: 'Cancel',\n      edit: 'Edit',\n      delete: 'Delete',\n      add: 'Add',\n      search: 'Search',\n      confirm: 'Confirm',\n      close: 'Close',\n      submit: 'Submit',\n      back: 'Back',\n      next: 'Next',\n      previous: 'Previous',\n      select: 'Select',\n      total: 'Total',\n      subtotal: 'Subtotal',\n      tax: 'Tax',\n      change: 'Change',\n      quantity: 'Quantity',\n      price: 'Price',\n      name: 'Name',\n      description: 'Description',\n      category: 'Category',\n      status: 'Status',\n      date: 'Date',\n      time: 'Time',\n      actions: 'Actions',\n      success: 'Success',\n      error: 'Error',\n      warning: 'Warning',\n      info: 'Info',\n      restaurant: 'Main Restaurant',\n      logout: 'Logout',\n      items: 'items',\n      collapse: 'Collapse',\n      products: 'Products'\n    },\n    \n    // Navigation\n    nav: {\n      pos: 'POS',\n      tables: 'Tables',\n      inventory: 'Inventory',\n      employees: 'Employees',\n      attendance: 'Attendance',\n      reports: 'Reports'\n    },\n    \n    // POS System\n    pos: {\n      title: 'POS System',\n      allCategories: 'All Categories',\n      addToCart: 'Add to Cart',\n      cart: 'Shopping Cart',\n      emptyCart: 'Cart is empty',\n      clearCart: 'Clear All',\n      checkout: 'Checkout',\n      cash: 'Cash',\n      card: 'Card',\n      mobile: 'Mobile',\n      cashierName: 'Cashier',\n      amountReceived: 'Amount Received',\n      paymentMethod: 'Payment Method',\n      printReceipt: 'Print Receipt',\n      newTransaction: 'New Transaction',\n      outOfStock: 'Out of Stock',\n      transactionComplete: 'Transaction Complete',\n      transactionFailed: 'Transaction Failed',\n      productManager: 'Product Manager',\n      productName: 'Product Name',\n      sku: 'SKU',\n      stock: 'Stock',\n      imageUrl: 'Image URL',\n      isActive: 'Active Status',\n      addProductsToStart: 'Add products to get started',\n      searchProducts: 'Search products...',\n      scanBarcode: 'Scan Barcode',\n      categories: 'Categories',\n      allProducts: 'All Products',\n      productScanned: 'Product Scanned',\n      scanFailed: 'Scan Failed',\n      productNotFound: 'Product not found',\n      currentlyOutOfStock: 'is currently out of stock',\n      inStock: 'in stock',\n      addItemsToCart: 'Add items to cart'\n    },\n    \n    // Table Management\n    tables: {\n      title: 'Table Management',\n      description: 'Manage restaurant tables and orders.',\n      backToPOS: 'Back to POS',\n      tableStatus: 'Table Status',\n      orderManagement: 'Order Management',\n      tableSettings: 'Table Settings',\n      people: 'people',\n      available: 'Available',\n      occupied: 'Occupied',\n      reserved: 'Reserved',\n      outOfService: 'Out of Service',\n      cleanupComplete: 'Cleanup Complete'\n    },\n    \n    // Inventory Management\n    inventory: {\n      title: 'Inventory Management',\n      description: 'Manage product inventory and check stock status.',\n      addProduct: 'Add Product',\n      searchProducts: 'Search products...',\n      lowStock: 'Low Stock',\n      outOfStock: 'Out of Stock',\n      inStock: 'In Stock',\n      allStock: 'All',\n      stockUpdate: 'Stock Update',\n      quantity: 'Quantity',\n      notes: 'Notes',\n      loading: 'Loading inventory data...',\n      productName: 'Product Name',\n      currentStock: 'Current Stock',\n      unitPrice: 'Unit Price',\n      stockValue: 'Stock Value',\n      management: 'Management',\n      edit: 'Edit',\n      noProducts: 'No products match the criteria.',\n      uncategorized: 'Uncategorized',\n      currentStockLabel: 'Current Stock',\n      stockUpdateType: 'Update Type',\n      selectUpdateType: 'Select Update Type',\n      addStock: 'Add Stock',\n      subtractStock: 'Subtract Stock',\n      setStock: 'Set Stock',\n      quantityInput: 'Enter quantity',\n      notesOptional: 'Notes (optional)',\n      changeReason: 'Reason for change or memo',\n      processing: 'Processing...',\n      stockStatus: 'Stock Status'\n    },\n    \n    // Employee Management\n    employees: {\n      title: 'Employee Management',\n      description: 'Manage employee information and add/edit staff.',\n      addEmployee: 'Add Employee',\n      employeeManagement: 'Employee Management',\n      manager: 'Manager',\n      admin: 'Admin',\n      cashier: 'Cashier',\n      name: 'Employee Name'\n    },\n    \n    // Attendance Management\n    attendance: {\n      title: 'Attendance Management',\n      description: 'Manage employee clock-in/out records and work hours.',\n      clockInOut: 'Clock In/Out',\n      attendanceRecords: 'Attendance Records',\n      statistics: 'Statistics',\n      employeeSelect: 'Select Employee',\n      clockIn: 'Clock In',\n      clockOut: 'Clock Out',\n      startBreak: 'Start Break',\n      endBreak: 'End Break',\n      notes: 'Notes',\n      notesPlaceholder: 'Clock-in/out notes (optional)',\n      currentStatus: 'Current Status',\n      workingTime: 'Working Time',\n      breakTime: 'Break Time',\n      clockInSuccess: 'Clock In Complete',\n      clockInSuccessDesc: 'Clock-in has been recorded.',\n      clockOutSuccess: 'Clock Out Complete',\n      clockOutSuccessDesc: 'Clock-out has been recorded.',\n      breakStartSuccess: 'Break Started',\n      breakStartSuccessDesc: 'Break time has started.',\n      breakEndSuccess: 'Break Ended',\n      breakEndSuccessDesc: 'Break time has ended.',\n      clockInError: 'Failed to record clock-in.',\n      clockOutError: 'Failed to record clock-out.',\n      breakStartError: 'Failed to start break.',\n      breakEndError: 'Failed to end break.',\n      selectEmployee: 'Please select an employee',\n      unknownEmployee: 'Unknown',\n      recordsDescription: 'Check daily attendance records of employees.',\n      selectedDate: 'Selected Date',\n      employee: 'Employee',\n      clockInTime: 'Clock In Time',\n      clockOutTime: 'Clock Out Time',\n      totalHours: 'Total Hours',\n      overtime: 'Overtime',\n      breakDuration: 'Break Time',\n      noRecords: 'No attendance records for the selected date.',\n      selectOtherDate: 'Please select another date.',\n      statsDescription: 'Check monthly attendance statistics.',\n      selectedMonth: 'Selected Month',\n      monthlyStats: 'Monthly Statistics',\n      totalWorkingDays: 'Total Working Days',\n      totalEmployees: 'Total Employees',\n      totalAttendance: 'Total Attendance',\n      totalWorkingHours: 'Total Working Hours',\n      totalOvertime: 'Total Overtime',\n      averageWorkingHours: 'Average Working Hours',\n      attendanceRate: 'Attendance Rate',\n      employeeStats: 'Employee Statistics',\n      days: 'days',\n      people: 'people',\n      times: 'times',\n      hours: 'hours',\n      minutes: 'minutes',\n      percent: '%',\n      status: {\n        present: 'Present',\n        absent: 'Absent',\n        late: 'Late',\n        halfDay: 'Half Day',\n        onBreak: 'On Break',\n        working: 'Working',\n        clockedOut: 'Clocked Out'\n      }\n    },\n    \n    // Sales Reports\n    reports: {\n      title: 'Sales Analysis',\n      description: 'Analyze sales performance and operational metrics.',\n      backToTables: 'Back to Tables',\n      dashboard: 'Dashboard',\n      salesAnalysis: 'Sales Analysis',\n      menuAnalysis: 'Menu Analysis',\n      tableAnalysis: 'Table Analysis'\n    },\n\n    // Settings\n    settings: {\n      title: 'System Settings',\n      description: 'Manage store information, employees, payment methods and more.',\n      storeInfo: 'Store Info',\n      categories: 'Categories',\n      employees: 'Employees',\n      payments: 'Payments',\n      basicInfo: 'Basic Information',\n      basicInfoDesc: 'Configure basic store information.',\n      contactInfo: 'Contact Information',\n      contactInfoDesc: 'Configure store contact information.',\n      operationHours: 'Operation Hours',\n      operationHoursDesc: 'Set store operation hours.',\n      storeName: 'Store Name',\n      storeNamePlaceholder: 'Enter store name',\n      storeCode: 'Store Code',\n      storeCodePlaceholder: 'Enter store code',\n      taxId: 'Tax ID',\n      taxIdPlaceholder: 'Enter tax ID number',\n      address: 'Address',\n      addressPlaceholder: 'Enter store address',\n      phone: 'Phone',\n      phonePlaceholder: 'Enter phone number',\n      email: 'Email',\n      emailPlaceholder: 'Enter email address',\n      openTime: 'Open Time',\n      closeTime: 'Close Time',\n      categoryManagement: 'Category Management',\n      categoryManagementDesc: 'Manage product categories and items.',\n      categoriesRedirect: 'Category management is available in the Inventory page.',\n      goToInventory: 'Go to Inventory',\n      employeeManagement: 'Employee Management',\n      employeeManagementDesc: 'Register and manage employee information.',\n      employeesRedirect: 'Employee management is available in the Employees page.',\n      goToEmployees: 'Go to Employees',\n      paymentMethods: 'Payment Methods',\n      paymentMethodsDesc: 'Select and manage available payment methods.',\n      availablePayments: 'Available Payment Methods',\n      addPayment: 'Add Payment Method',\n      enabled: 'Enabled',\n      disabled: 'Disabled',\n      backToPos: 'Back to POS',\n      payments: {\n        cash: 'Cash',\n        creditCard: 'Credit Card', \n        debitCard: 'Debit Card',\n        momo: 'MoMo',\n        zalopay: 'ZaloPay',\n        vnpay: 'VNPay',\n        banking: 'Internet Banking',\n        shopeepay: 'ShopeePay',\n        grabpay: 'GrabPay',\n        newPayment: 'New Payment Method'\n      }\n    }\n  },\n  \n  vi: {\n    // Chung\n    common: {\n      loading: 'Đang tải...',\n      save: 'Lưu',\n      cancel: 'Hủy',\n      edit: 'Chỉnh sửa',\n      delete: 'Xóa',\n      add: 'Thêm',\n      search: 'Tìm kiếm',\n      confirm: 'Xác nhận',\n      close: 'Đóng',\n      submit: 'Gửi',\n      back: 'Quay lại',\n      next: 'Tiếp theo',\n      previous: 'Trước',\n      select: 'Chọn',\n      total: 'Tổng cộng',\n      subtotal: 'Tạm tính',\n      tax: 'Thuế',\n      change: 'Tiền thối',\n      quantity: 'Số lượng',\n      price: 'Giá',\n      name: 'Tên',\n      description: 'Mô tả',\n      category: 'Danh mục',\n      status: 'Trạng thái',\n      date: 'Ngày',\n      time: 'Thời gian',\n      actions: 'Hành động',\n      success: 'Thành công',\n      error: 'Lỗi',\n      warning: 'Cảnh báo',\n      info: 'Thông tin',\n      restaurant: 'Nhà hàng chính',\n      logout: 'Đăng xuất',\n      items: 'mặt hàng',\n      collapse: 'Thu gọn',\n      products: 'Sản phẩm'\n    },\n    \n    // Điều hướng\n    nav: {\n      pos: 'POS',\n      tables: 'Bàn',\n      inventory: 'Kho',\n      employees: 'Nhân viên',\n      attendance: 'Chấm công',\n      reports: 'Báo cáo'\n    },\n    \n    // Hệ thống POS\n    pos: {\n      title: 'Hệ thống POS',\n      allCategories: 'Tất cả danh mục',\n      addToCart: 'Thêm vào giỏ',\n      cart: 'Giỏ hàng',\n      emptyCart: 'Giỏ hàng trống',\n      clearCart: 'Xóa tất cả',\n      checkout: 'Thanh toán',\n      cash: 'Tiền mặt',\n      card: 'Thẻ',\n      mobile: 'Di động',\n      cashierName: 'Thu ngân',\n      amountReceived: 'Số tiền nhận',\n      paymentMethod: 'Phương thức thanh toán',\n      printReceipt: 'In hóa đơn',\n      newTransaction: 'Giao dịch mới',\n      outOfStock: 'Hết hàng',\n      transactionComplete: 'Giao dịch hoàn tất',\n      transactionFailed: 'Giao dịch thất bại',\n      productManager: 'Quản lý sản phẩm',\n      productName: 'Tên sản phẩm',\n      sku: 'SKU',\n      stock: 'Tồn kho',\n      imageUrl: 'URL hình ảnh',\n      isActive: 'Trạng thái hoạt động',\n      addProductsToStart: 'Thêm sản phẩm để bắt đầu',\n      searchProducts: 'Tìm kiếm sản phẩm...',\n      scanBarcode: 'Quét mã vạch',\n      categories: 'Danh mục',\n      allProducts: 'Tất cả sản phẩm',\n      productScanned: 'Đã quét sản phẩm',\n      scanFailed: 'Quét thất bại',\n      productNotFound: 'Không tìm thấy sản phẩm',\n      currentlyOutOfStock: 'hiện đang hết hàng',\n      inStock: 'còn hàng',\n      addItemsToCart: 'Thêm sản phẩm vào giỏ hàng'\n    },\n    \n    // Quản lý bàn\n    tables: {\n      title: 'Quản lý bàn',\n      description: 'Quản lý bàn và đơn hàng trong nhà hàng.',\n      backToPOS: 'Quay lại POS',\n      tableStatus: 'Tình trạng bàn',\n      orderManagement: 'Quản lý đơn hàng',\n      tableSettings: 'Cài đặt bàn',\n      people: 'người',\n      available: 'Có sẵn',\n      occupied: 'Đang sử dụng',\n      reserved: 'Đã đặt',\n      outOfService: 'Ngưng hoạt động',\n      cleanupComplete: 'Dọn dẹp xong'\n    },\n    \n    // Quản lý kho\n    inventory: {\n      title: 'Quản lý kho',\n      description: 'Quản lý kho hàng sản phẩm và kiểm tra tình trạng tồn kho.',\n      addProduct: 'Thêm sản phẩm',\n      searchProducts: 'Tìm kiếm sản phẩm...',\n      lowStock: 'Tồn kho thấp',\n      outOfStock: 'Hết hàng',\n      inStock: 'Còn hàng',\n      allStock: 'Tất cả',\n      stockUpdate: 'Cập nhật tồn kho',\n      quantity: 'Số lượng',\n      notes: 'Ghi chú',\n      loading: 'Đang tải dữ liệu tồn kho...',\n      productName: 'Tên sản phẩm',\n      currentStock: 'Tồn kho hiện tại',\n      unitPrice: 'Giá đơn vị',\n      stockValue: 'Giá trị tồn kho',\n      management: 'Quản lý',\n      edit: 'Chỉnh sửa',\n      noProducts: 'Không có sản phẩm nào phù hợp với tiêu chí.',\n      uncategorized: 'Chưa phân loại',\n      currentStockLabel: 'Tồn kho hiện tại',\n      stockUpdateType: 'Loại cập nhật',\n      selectUpdateType: 'Chọn loại cập nhật',\n      addStock: 'Thêm tồn kho',\n      subtractStock: 'Trừ tồn kho',\n      setStock: 'Đặt tồn kho',\n      quantityInput: 'Nhập số lượng',\n      notesOptional: 'Ghi chú (tùy chọn)',\n      changeReason: 'Lý do thay đổi hoặc ghi chú',\n      processing: 'Đang xử lý...',\n      stockStatus: 'Tình trạng tồn kho'\n    },\n    \n    // Quản lý nhân viên\n    employees: {\n      title: 'Quản lý nhân viên',\n      description: 'Quản lý thông tin nhân viên và thêm/sửa nhân viên.',\n      addEmployee: 'Thêm nhân viên',\n      employeeManagement: 'Quản lý nhân viên',\n      manager: 'Quản lý',\n      admin: 'Quản trị viên',\n      cashier: 'Thu ngân',\n      name: 'Tên nhân viên'\n    },\n    \n    // Quản lý chấm công\n    attendance: {\n      title: 'Quản lý chấm công',\n      description: 'Quản lý bản ghi chấm công và giờ làm việc của nhân viên.',\n      clockInOut: 'Chấm công',\n      attendanceRecords: 'Bản ghi chấm công',\n      statistics: 'Thống kê',\n      employeeSelect: 'Chọn nhân viên',\n      clockIn: 'Chấm công vào',\n      clockOut: 'Chấm công ra',\n      startBreak: 'Bắt đầu nghỉ',\n      endBreak: 'Kết thúc nghỉ',\n      notes: 'Ghi chú',\n      notesPlaceholder: 'Ghi chú chấm công (tùy chọn)',\n      currentStatus: 'Trạng thái hiện tại',\n      workingTime: 'Thời gian làm việc',\n      breakTime: 'Thời gian nghỉ',\n      clockInSuccess: 'Chấm công vào thành công',\n      clockInSuccessDesc: 'Đã ghi nhận chấm công vào.',\n      clockOutSuccess: 'Chấm công ra thành công',\n      clockOutSuccessDesc: 'Đã ghi nhận chấm công ra.',\n      breakStartSuccess: 'Bắt đầu nghỉ',\n      breakStartSuccessDesc: 'Thời gian nghỉ đã bắt đầu.',\n      breakEndSuccess: 'Kết thúc nghỉ',\n      breakEndSuccessDesc: 'Thời gian nghỉ đã kết thúc.',\n      clockInError: 'Không thể ghi nhận chấm công vào.',\n      clockOutError: 'Không thể ghi nhận chấm công ra.',\n      breakStartError: 'Không thể bắt đầu nghỉ.',\n      breakEndError: 'Không thể kết thúc nghỉ.',\n      selectEmployee: 'Vui lòng chọn nhân viên',\n      unknownEmployee: 'Không rõ',\n      recordsDescription: 'Kiểm tra bản ghi chấm công hàng ngày của nhân viên.',\n      selectedDate: 'Ngày đã chọn',\n      employee: 'Nhân viên',\n      clockInTime: 'Giờ vào',\n      clockOutTime: 'Giờ ra',\n      totalHours: 'Tổng giờ làm',\n      overtime: 'Làm thêm giờ',\n      breakDuration: 'Thời gian nghỉ',\n      noRecords: 'Không có bản ghi chấm công cho ngày đã chọn.',\n      selectOtherDate: 'Vui lòng chọn ngày khác.',\n      statsDescription: 'Kiểm tra thống kê chấm công hàng tháng.',\n      selectedMonth: 'Tháng đã chọn',\n      monthlyStats: 'Thống kê tháng',\n      totalWorkingDays: 'Tổng ngày làm việc',\n      totalEmployees: 'Tổng nhân viên',\n      totalAttendance: 'Tổng lần chấm công',\n      totalWorkingHours: 'Tổng giờ làm việc',\n      totalOvertime: 'Tổng giờ làm thêm',\n      averageWorkingHours: 'Giờ làm việc trung bình',\n      attendanceRate: 'Tỷ lệ chấm công',\n      employeeStats: 'Thống kê nhân viên',\n      days: 'ngày',\n      people: 'người',\n      times: 'lần',\n      hours: 'giờ',\n      minutes: 'phút',\n      percent: '%',\n      status: {\n        present: 'Có mặt',\n        absent: 'Vắng mặt',\n        late: 'Trễ',\n        halfDay: 'Nửa ngày',\n        onBreak: 'Đang nghỉ',\n        working: 'Đang làm việc',\n        clockedOut: 'Đã ra về'\n      }\n    },\n    \n    // Báo cáo bán hàng\n    reports: {\n      title: 'Phân tích doanh thu',\n      description: 'Phân tích hiệu suất bán hàng và chỉ số hoạt động.',\n      backToTables: 'Quay lại bàn',\n      dashboard: 'Bảng điều khiển',\n      salesAnalysis: 'Phân tích doanh thu',\n      menuAnalysis: 'Phân tích thực đơn',\n      tableAnalysis: 'Phân tích bàn'\n    },\n\n    // Cài đặt\n    settings: {\n      title: 'Cài đặt hệ thống',\n      description: 'Quản lý thông tin cửa hàng, nhân viên, phương thức thanh toán và nhiều hơn nữa.',\n      storeInfo: 'Thông tin cửa hàng',\n      categories: 'Danh mục',\n      employees: 'Nhân viên',\n      payments: 'Thanh toán',\n      basicInfo: 'Thông tin cơ bản',\n      basicInfoDesc: 'Cấu hình thông tin cơ bản của cửa hàng.',\n      contactInfo: 'Thông tin liên hệ',\n      contactInfoDesc: 'Cấu hình thông tin liên hệ của cửa hàng.',\n      operationHours: 'Giờ hoạt động',\n      operationHoursDesc: 'Đặt giờ hoạt động của cửa hàng.',\n      storeName: 'Tên cửa hàng',\n      storeNamePlaceholder: 'Nhập tên cửa hàng',\n      storeCode: 'Mã cửa hàng',\n      storeCodePlaceholder: 'Nhập mã cửa hàng',\n      taxId: 'Mã số thuế',\n      taxIdPlaceholder: 'Nhập mã số thuế',\n      address: 'Địa chỉ',\n      addressPlaceholder: 'Nhập địa chỉ cửa hàng',\n      phone: 'Điện thoại',\n      phonePlaceholder: 'Nhập số điện thoại',\n      email: 'Email',\n      emailPlaceholder: 'Nhập địa chỉ email',\n      openTime: 'Giờ mở cửa',\n      closeTime: 'Giờ đóng cửa',\n      categoryManagement: 'Quản lý danh mục',\n      categoryManagementDesc: 'Quản lý danh mục sản phẩm và mặt hàng.',\n      categoriesRedirect: 'Quản lý danh mục có sẵn trong trang Kho.',\n      goToInventory: 'Đi đến Kho',\n      employeeManagement: 'Quản lý nhân viên',\n      employeeManagementDesc: 'Đăng ký và quản lý thông tin nhân viên.',\n      employeesRedirect: 'Quản lý nhân viên có sẵn trong trang Nhân viên.',\n      goToEmployees: 'Đi đến Nhân viên',\n      paymentMethods: 'Phương thức thanh toán',\n      paymentMethodsDesc: 'Chọn và quản lý các phương thức thanh toán có sẵn.',\n      availablePayments: 'Phương thức thanh toán có sẵn',\n      addPayment: 'Thêm phương thức thanh toán',\n      enabled: 'Đã bật',\n      disabled: 'Đã tắt',\n      backToPos: 'Quay về POS',\n      payments: {\n        cash: 'Tiền mặt',\n        creditCard: 'Thẻ tín dụng',\n        debitCard: 'Thẻ ghi nợ',\n        momo: 'MoMo',\n        zalopay: 'ZaloPay',\n        vnpay: 'VNPay',\n        banking: 'Ngân hàng trực tuyến',\n        shopeepay: 'ShopeePay',\n        grabpay: 'GrabPay',\n        newPayment: 'Phương thức thanh toán mới'\n      }\n    }\n  }\n};\n\nexport const useTranslation = () => {\n  const { currentLanguage } = useLanguageStore();\n  \n  const t = (key: string): string => {\n    const keys = key.split('.');\n    let value: any = (translations as any)[currentLanguage];\n    \n    for (const k of keys) {\n      value = value?.[k];\n    }\n    \n    const result = value || key;\n    // 필요시 디버그 로그 활성화\n    // console.log(`번역 [${currentLanguage}]: ${key} => ${result}`);\n    return result;\n  };\n  \n  return { t, currentLanguage };\n};","size_bytes":31322},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data\n      ? JSON.stringify(data, (key, value) => {\n          if (value instanceof Date) {\n            return { __type: \"Date\", value: value.toISOString() };\n          }\n          return value;\n        })\n      : undefined,\n    credentials: \"include\",\n  });\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: true, // Always refetch when window focus\n      staleTime: 0, // Data is always stale, always refetch\n      gcTime: 0, // No garbage collection time, immediate cleanup\n      cacheTime: 0, // No cache time\n      retry: false,\n      refetchOnMount: \"always\", // Always refetch when component mounts\n      refetchOnReconnect: \"always\", // Always refetch when reconnecting\n      networkMode: \"always\", // Always make network requests\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":1941},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/pages/attendance-qr.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Clock, LogIn, LogOut, Coffee, Play, QrCode } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport type { Employee, AttendanceRecord } from \"@shared/schema\";\n\nexport default function AttendanceQRPage() {\n  const [selectedEmployeeId, setSelectedEmployeeId] = useState<string>(\"\");\n  const [notes, setNotes] = useState(\"\");\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { t } = useTranslation();\n\n  const { data: employees } = useQuery({\n    queryKey: ['/api/employees'],\n  });\n\n  const { data: todayAttendance, refetch: refetchTodayAttendance } = useQuery({\n    queryKey: ['/api/attendance/today', selectedEmployeeId],\n    enabled: !!selectedEmployeeId,\n  });\n\n  const clockInMutation = useMutation({\n    mutationFn: () => apiRequest('POST', '/api/attendance/clock-in', {\n      employeeId: parseInt(selectedEmployeeId),\n      notes\n    }),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/attendance'] });\n      refetchTodayAttendance();\n      setNotes(\"\");\n      toast({\n        title: \"출근 기록 완료\",\n        description: \"출근이 성공적으로 기록되었습니다.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"오류\",\n        description: \"출근 기록에 실패했습니다.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const clockOutMutation = useMutation({\n    mutationFn: () => apiRequest('POST', `/api/attendance/clock-out/${(todayAttendance as AttendanceRecord)?.id}`, {}),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/attendance'] });\n      refetchTodayAttendance();\n      toast({\n        title: \"퇴근 기록 완료\",\n        description: \"퇴근이 성공적으로 기록되었습니다.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: t('common.error'),\n        description: t('attendance.clockOutError'),\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const breakStartMutation = useMutation({\n    mutationFn: () => apiRequest('POST', `/api/attendance/break-start/${(todayAttendance as AttendanceRecord)?.id}`, {}),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/attendance'] });\n      refetchTodayAttendance();\n      toast({\n        title: t('attendance.breakStartSuccess'),\n        description: t('attendance.breakStartSuccessDesc'),\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"오류\",\n        description: \"휴식 시작 기록에 실패했습니다.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const breakEndMutation = useMutation({\n    mutationFn: () => apiRequest('POST', `/api/attendance/break-end/${(todayAttendance as AttendanceRecord)?.id}`, {}),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/attendance'] });\n      refetchTodayAttendance();\n      toast({\n        title: \"휴식 종료\",\n        description: \"휴식이 종료되었습니다.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"오류\",\n        description: \"휴식 종료 기록에 실패했습니다.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const selectedEmployee = (employees as Employee[] | undefined)?.find((emp: Employee) => emp.id === parseInt(selectedEmployeeId));\n\n  const formatTime = (dateInput: Date | string) => {\n    return new Date(dateInput).toLocaleTimeString('ko-KR', {\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  const getWorkingHours = (clockIn: Date | string, clockOut?: Date | string | null) => {\n    const start = new Date(clockIn);\n    const end = clockOut ? new Date(clockOut) : new Date();\n    const diff = (end.getTime() - start.getTime()) / (1000 * 60 * 60);\n    return diff.toFixed(1);\n  };\n\n  const getStatusBadge = (record: AttendanceRecord) => {\n    if (!record.clockOut) {\n      if (record.breakStart && !record.breakEnd) {\n        return <Badge variant=\"secondary\">휴식 중</Badge>;\n      }\n      return <Badge variant=\"default\">근무 중</Badge>;\n    }\n    return <Badge variant=\"outline\">퇴근 완료</Badge>;\n  };\n\n  return (\n    <div className=\"min-h-screen bg-green-50 flex items-center justify-center p-4\">\n      <div className=\"w-full max-w-md\">\n        <Card>\n          <CardHeader className=\"text-center\">\n            <CardTitle className=\"flex items-center justify-center gap-2\">\n              <QrCode className=\"w-6 h-6\" />\n              QR 근태 기록\n            </CardTitle>\n            <CardDescription>\n              직원을 선택하고 출근/퇴근을 기록하세요\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {/* Employee Selection */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"employee-select\">직원 선택</Label>\n              <Select value={selectedEmployeeId} onValueChange={setSelectedEmployeeId}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"직원을 선택하세요\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {(employees as Employee[] | undefined)?.map((employee: Employee) => (\n                    <SelectItem key={employee.id} value={employee.id.toString()}>\n                      <div className=\"flex items-center justify-between w-full\">\n                        <span>{employee.name}</span>\n                        <Badge variant=\"secondary\" className=\"ml-2\">\n                          {t(`employees.roles.${employee.role}`)}\n                        </Badge>\n                      </div>\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* Notes Input */}\n            {selectedEmployeeId && (\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"notes\">메모 (선택사항)</Label>\n                <Input\n                  id=\"notes\"\n                  value={notes}\n                  onChange={(e) => setNotes(e.target.value)}\n                  placeholder=\"특이사항이나 메모를 입력하세요\"\n                />\n              </div>\n            )}\n\n            {/* Current Status */}\n            {selectedEmployee && todayAttendance && (todayAttendance as AttendanceRecord) && (\n              <div className=\"bg-blue-50 p-4 rounded-lg space-y-2\">\n                <h4 className=\"font-medium\">오늘의 근무 상태</h4>\n                <div className=\"space-y-1 text-sm\">\n                  <div className=\"flex justify-between\">\n                    <span>출근 시간:</span>\n                    <span className=\"font-medium\">{formatTime((todayAttendance as AttendanceRecord).clockIn)}</span>\n                  </div>\n                  {(todayAttendance as AttendanceRecord).clockOut && (\n                    <div className=\"flex justify-between\">\n                      <span>퇴근 시간:</span>\n                      <span className=\"font-medium\">{formatTime((todayAttendance as AttendanceRecord).clockOut!)}</span>\n                    </div>\n                  )}\n                  <div className=\"flex justify-between\">\n                    <span>근무 시간:</span>\n                    <span className=\"font-medium\">{getWorkingHours((todayAttendance as AttendanceRecord).clockIn, (todayAttendance as AttendanceRecord).clockOut)}시간</span>\n                  </div>\n                  <div className=\"flex justify-between items-center\">\n                    <span>상태:</span>\n                    {getStatusBadge(todayAttendance as AttendanceRecord)}\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* Action Buttons */}\n            {selectedEmployee && (\n              <div className=\"space-y-2\">\n                {!todayAttendance ? (\n                  <Button\n                    onClick={() => clockInMutation.mutate()}\n                    disabled={clockInMutation.isPending}\n                    className=\"w-full\"\n                    size=\"lg\"\n                  >\n                    <LogIn className=\"w-4 h-4 mr-2\" />\n                    {clockInMutation.isPending ? \"처리 중...\" : \"출근 기록\"}\n                  </Button>\n                ) : (\n                  <div className=\"grid grid-cols-1 gap-2\">\n                    {!(todayAttendance as AttendanceRecord).clockOut && (\n                      <>\n                        {(todayAttendance as AttendanceRecord).breakStart && !(todayAttendance as AttendanceRecord).breakEnd ? (\n                          <Button\n                            onClick={() => breakEndMutation.mutate()}\n                            disabled={breakEndMutation.isPending}\n                            variant=\"outline\"\n                            size=\"lg\"\n                          >\n                            <Play className=\"w-4 h-4 mr-2\" />\n                            휴식 종료\n                          </Button>\n                        ) : (\n                          <Button\n                            onClick={() => breakStartMutation.mutate()}\n                            disabled={breakStartMutation.isPending}\n                            variant=\"outline\"\n                            size=\"lg\"\n                          >\n                            <Coffee className=\"w-4 h-4 mr-2\" />\n                            휴식 시작\n                          </Button>\n                        )}\n                        <Button\n                          onClick={() => clockOutMutation.mutate()}\n                          disabled={clockOutMutation.isPending}\n                          size=\"lg\"\n                        >\n                          <LogOut className=\"w-4 h-4 mr-2\" />\n                          퇴근 기록\n                        </Button>\n                      </>\n                    )}\n                  </div>\n                )}\n              </div>\n            )}\n\n            {!selectedEmployee && selectedEmployeeId === \"\" && (\n              <div className=\"text-center py-8\">\n                <Clock className=\"w-12 h-12 mx-auto text-gray-400 mb-4\" />\n                <p className=\"text-gray-500\">직원을 선택해 주세요</p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":10919},"client/src/pages/attendance.tsx":{"content":"import { useState } from \"react\";\nimport { POSHeader } from \"@/components/pos/header\";\nimport { RightSidebar } from \"@/components/ui/right-sidebar\";\nimport { AttendanceList } from \"@/components/attendance/attendance-list\";\nimport { AttendanceStats } from \"@/components/attendance/attendance-stats\";\nimport { ClockInOut } from \"@/components/attendance/clock-in-out\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Calendar, Clock, Users, ShoppingCart } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { useTranslation } from \"@/lib/i18n\";\n\nexport default function AttendancePage() {\n  const [selectedDate, setSelectedDate] = useState<string>(\n    new Date().toISOString().split('T')[0]\n  );\n  const { t } = useTranslation();\n\n  return (\n    <div className=\"min-h-screen bg-green-50 grocery-bg\">\n      {/* Header */}\n      <POSHeader />\n      \n      {/* Right Sidebar */}\n      <RightSidebar />\n      \n      <div className=\"main-content pt-16 px-6\">\n        <div className=\"max-w-5xl mx-auto py-8\">\n          {/* Page Header */}\n          <div className=\"flex justify-between items-center mb-8\">\n            <div>\n              <h1 className=\"text-3xl font-bold text-gray-900\">{t('attendance.title')}</h1>\n              <p className=\"mt-2 text-gray-600\">{t('attendance.description')}</p>\n            </div>\n            <div className=\"flex gap-4\">\n              <Link href=\"/employees\">\n                <Button variant=\"outline\">\n                  <Users className=\"w-4 h-4 mr-2\" />\n                  {t('employees.employeeManagement')}\n                </Button>\n              </Link>\n              <Link href=\"/\">\n                <Button variant=\"outline\">\n                  <ShoppingCart className=\"w-4 h-4 mr-2\" />\n                  Quay lại Bán hàng\n                </Button>\n              </Link>\n            </div>\n          </div>\n\n          <Tabs defaultValue=\"clock\" className=\"space-y-6\">\n            <TabsList className=\"grid w-full grid-cols-3\">\n              <TabsTrigger value=\"clock\" className=\"flex items-center gap-2\">\n                <Clock className=\"w-4 h-4\" />\n                {t('attendance.clockInOut')}\n              </TabsTrigger>\n              <TabsTrigger value=\"records\" className=\"flex items-center gap-2\">\n                <Calendar className=\"w-4 h-4\" />\n                {t('attendance.attendanceRecords')}\n              </TabsTrigger>\n              <TabsTrigger value=\"stats\" className=\"flex items-center gap-2\">\n                <Users className=\"w-4 h-4\" />\n                {t('attendance.statistics')}\n              </TabsTrigger>\n            </TabsList>\n\n            <TabsContent value=\"clock\">\n              <ClockInOut />\n            </TabsContent>\n\n            <TabsContent value=\"records\">\n              <AttendanceList selectedDate={selectedDate} onDateChange={setSelectedDate} />\n            </TabsContent>\n\n            <TabsContent value=\"stats\">\n              <AttendanceStats />\n            </TabsContent>\n          </Tabs>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":3117},"client/src/pages/customer-display.tsx":{"content":"\nimport { useState, useEffect } from \"react\";\nimport { CustomerDisplay } from \"@/components/pos/customer-display\";\nimport type { CartItem } from \"@shared/schema\";\n\nexport default function CustomerDisplayPage() {\n  const [cart, setCart] = useState<CartItem[]>([]);\n  const [storeInfo, setStoreInfo] = useState<any>(null);\n  const [qrPayment, setQrPayment] = useState<{\n    qrCodeUrl: string;\n    amount: number;\n    paymentMethod: string;\n    transactionUuid: string;\n  } | null>(null);\n\n  // Auto-clear QR payment after 5 minutes if not manually cleared\n  useEffect(() => {\n    if (qrPayment) {\n      console.log(\"Customer Display: QR payment shown, setting 5-minute auto-clear timer\");\n      const timeoutId = setTimeout(() => {\n        console.log(\"Customer Display: Auto-clearing QR payment after timeout\");\n        setQrPayment(null);\n      }, 5 * 60 * 1000); // 5 minutes\n\n      return () => {\n        console.log(\"Customer Display: Clearing QR payment timeout\");\n        clearTimeout(timeoutId);\n      };\n    }\n  }, [qrPayment]);\n\n  // Calculate totals\n  const subtotal = cart.reduce((sum, item) => sum + parseFloat(item.total), 0);\n  const tax = cart.reduce((sum, item) => {\n    if (item.taxRate && parseFloat(item.taxRate) > 0) {\n      return sum + (parseFloat(item.price) * parseFloat(item.taxRate) / 100 * item.quantity);\n    }\n    return sum;\n  }, 0);\n  const total = subtotal + tax;\n\n  // WebSocket connection to receive real-time updates\n  useEffect(() => {\n    console.log(\"Customer Display: Initializing WebSocket connection\");\n    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n    const wsUrl = `${protocol}//${window.location.host}/ws`;\n    \n    let ws: WebSocket;\n    let reconnectTimer: NodeJS.Timeout;\n    let isConnected = false;\n\n    const connectWebSocket = () => {\n      try {\n        ws = new WebSocket(wsUrl);\n\n        ws.onopen = () => {\n          console.log(\"Customer Display: WebSocket connected\");\n          isConnected = true;\n          // Send identification as customer display\n          try {\n            ws.send(JSON.stringify({ \n              type: 'customer_display_connected',\n              timestamp: new Date().toISOString()\n            }));\n            console.log(\"Customer Display: Identification message sent\");\n          } catch (error) {\n            console.error(\"Customer Display: Failed to send identification:\", error);\n          }\n        };\n\n        ws.onmessage = (event) => {\n          try {\n            const data = JSON.parse(event.data);\n            console.log(\"Customer Display: Received message:\", data);\n\n            switch (data.type) {\n              case 'cart_update':\n                console.log(\"Customer Display: Updating cart:\", data.cart);\n                // Use React's functional update to ensure we get the latest state\n                setCart(prevCart => {\n                  const newCart = data.cart || [];\n                  console.log(\"Customer Display: Cart state update from\", prevCart.length, \"to\", newCart.length, \"items\");\n                  return newCart;\n                });\n                // Clear QR payment when cart updates (new order started)\n                setQrPayment(prevQr => {\n                  if (prevQr) {\n                    console.log(\"Customer Display: Clearing QR payment due to cart update\");\n                    return null;\n                  }\n                  return prevQr;\n                });\n                break;\n              case 'store_info':\n                console.log(\"Customer Display: Updating store info:\", data.storeInfo);\n                setStoreInfo(data.storeInfo);\n                break;\n              case 'qr_payment':\n                console.log(\"Customer Display: Showing QR payment:\", data);\n                setQrPayment({\n                  qrCodeUrl: data.qrCodeUrl,\n                  amount: data.amount,\n                  paymentMethod: data.paymentMethod,\n                  transactionUuid: data.transactionUuid\n                });\n                break;\n              case 'payment_success':\n                console.log(\"Customer Display: Payment completed, clearing QR\");\n                setQrPayment(null);\n                setCart([]);\n                break;\n              case 'qr_payment_cancelled':\n                console.log(\"Customer Display: QR payment cancelled, clearing QR and restoring cart\");\n                setQrPayment(prevQr => {\n                  if (prevQr) {\n                    console.log(\"Customer Display: Clearing QR payment state\");\n                    return null;\n                  }\n                  return prevQr;\n                });\n                break;\n              case 'refresh_customer_display':\n                console.log(\"Customer Display: Refresh requested, reloading page in 500ms\");\n                // Add a small delay to ensure all cleanup is done\n                setTimeout(() => {\n                  console.log(\"Customer Display: Executing page reload now\");\n                  window.location.reload();\n                }, 500);\n                break;\n              case 'restore_cart_display':\n                console.log(\"Customer Display: Restoring cart display, clearing QR payment\");\n                // Force clear QR payment to show cart again\n                setQrPayment(null);\n                console.log(\"Customer Display: QR payment force cleared to restore cart view\");\n                break;\n              default:\n                console.log(\"Customer Display: Unknown message type:\", data.type);\n            }\n          } catch (error) {\n            console.error(\"Customer Display: Error parsing message:\", error);\n          }\n        };\n\n        ws.onclose = (event) => {\n          console.log(\"Customer Display: WebSocket closed:\", event.code, event.reason);\n          isConnected = false;\n          // Only reconnect if not manually closed\n          if (event.code !== 1000) {\n            reconnectTimer = setTimeout(() => {\n              console.log(\"Customer Display: Attempting to reconnect...\");\n              connectWebSocket();\n            }, 1000); // Reduced reconnect delay\n          }\n        };\n\n        ws.onerror = (error) => {\n          console.error(\"Customer Display: WebSocket error:\", error);\n          isConnected = false;\n        };\n      } catch (error) {\n        console.error(\"Customer Display: Failed to create WebSocket:\", error);\n        // Retry after 1 second\n        reconnectTimer = setTimeout(connectWebSocket, 1000);\n      }\n    };\n\n    connectWebSocket();\n\n    // Fetch initial store info\n    fetch('/api/store-settings')\n      .then(res => res.json())\n      .then(data => setStoreInfo(data))\n      .catch(err => console.error('Failed to fetch store info:', err));\n\n    return () => {\n      if (reconnectTimer) {\n        clearTimeout(reconnectTimer);\n      }\n      if (ws && isConnected) {\n        ws.close(1000, 'Component unmounting');\n      }\n    };\n  }, []);\n\n  return (\n    <CustomerDisplay\n      cart={cart}\n      subtotal={subtotal}\n      tax={tax}\n      total={total}\n      storeInfo={storeInfo}\n      qrPayment={qrPayment}\n    />\n  );\n}\n","size_bytes":7113},"client/src/pages/employees.tsx":{"content":"import { useState } from \"react\";\nimport { POSHeader } from \"@/components/pos/header\";\nimport { RightSidebar } from \"@/components/ui/right-sidebar\";\nimport { EmployeeList } from \"@/components/employees/employee-list\";\nimport { EmployeeFormModal } from \"@/components/employees/employee-form-modal\";\nimport { Button } from \"@/components/ui/button\";\nimport { UserPlus, ShoppingCart } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { useTranslation } from \"@/lib/i18n\";\n\nexport default function EmployeesPage() {\n  const [showAddModal, setShowAddModal] = useState(false);\n  const { t } = useTranslation();\n\n  return (\n    <div className=\"min-h-screen bg-green-50 grocery-bg\">\n      {/* Header */}\n      <POSHeader />\n      \n      {/* Right Sidebar */}\n      <RightSidebar />\n      \n      <div className=\"main-content pt-16 px-6\">\n        <div className=\"max-w-5xl mx-auto py-8\">\n          {/* Page Header */}\n          <div className=\"flex justify-between items-center mb-8\">\n            <div>\n              <h1 className=\"text-3xl font-bold text-gray-900\">{t('employees.title')}</h1>\n              <p className=\"mt-2 text-gray-600\">{t('employees.description')}</p>\n            </div>\n            <div className=\"flex gap-4\">\n              <Link href=\"/\">\n                <Button variant=\"outline\">\n                  <ShoppingCart className=\"w-4 h-4 mr-2\" />\n                  Quay lại Bán hàng\n                </Button>\n              </Link>\n              <Button onClick={() => setShowAddModal(true)}>\n                <UserPlus className=\"w-4 h-4 mr-2\" />\n                {t('employees.addEmployee')}\n              </Button>\n            </div>\n          </div>\n\n          {/* Employee List */}\n          <EmployeeList />\n\n          {/* Add Employee Modal */}\n          <EmployeeFormModal\n            isOpen={showAddModal}\n            onClose={() => setShowAddModal(false)}\n            mode=\"create\"\n          />\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":1971},"client/src/pages/inventory.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport {\n  Plus,\n  Package,\n  AlertTriangle,\n  TrendingUp,\n  Search,\n  Edit,\n  Trash2,\n  RotateCcw,\n} from \"lucide-react\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { POSHeader } from \"@/components/pos/header\";\nimport { RightSidebar } from \"@/components/ui/right-sidebar\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Product, Category } from \"@shared/schema\";\n\nconst stockUpdateSchema = (t: any) => z.object({\n  productId: z.number(),\n  quantity: z.number().min(1, t(\"inventory.quantityMinError\") || \"Quantity must be at least 1\"),\n  type: z.enum([\"add\", \"subtract\", \"set\"]),\n  notes: z.string().optional(),\n  trackInventory: z.boolean().optional(),\n  // Fields for new product creation\n  name: z.string().min(1, \"Tên sản phẩm là bắt buộc\"),\n  sku: z.string().min(1, \"SKU là bắt buộc\"),\n  price: z.string().optional(),\n  categoryId: z.number().optional(),\n  productType: z.number().optional(),\n  taxRate: z.string().optional(),\n});\n\ntype StockUpdateForm = z.infer<typeof stockUpdateSchema>;\n\nexport default function InventoryPage() {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [selectedCategory, setSelectedCategory] = useState<string>(\"all\");\n  const [stockFilter, setStockFilter] = useState<string>(\"all\");\n  const [showStockDialog, setShowStockDialog] = useState(false);\n  const [selectedProduct, setSelectedProduct] = useState<Product | null>(null);\n\n  const queryClient = useQueryClient();\n\n  const { data: products = [], isLoading: productsLoading } = useQuery<\n    Product[]\n  >({\n    queryKey: [\"/api/products\"],\n  });\n\n  const { data: categories = [] } = useQuery<Category[]>({\n    queryKey: [\"/api/categories\"],\n  });\n\n  const stockUpdateForm = useForm<StockUpdateForm>({\n    resolver: zodResolver(stockUpdateSchema(t)),\n    defaultValues: {\n      quantity: 1,\n      type: \"add\",\n    },\n  });\n\n  const updateStockMutation = useMutation({\n    mutationFn: async (data: StockUpdateForm) => {\n      console.log(\"Updating stock:\", data);\n      const response = await fetch(\"/api/inventory/update-stock\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(data),\n      });\n      if (!response.ok) {\n        throw new Error(\"Failed to update stock\");\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      setShowStockDialog(false);\n      stockUpdateForm.reset();\n      toast({\n        title: t(\"inventory.updateSuccess\") || \"Cập nhật thành công\",\n        description:\n          t(\"inventory.updateSuccessDescription\") ||\n          \"Thông tin sản phẩm đã được cập nhật\",\n      });\n    },\n    onError: (error) => {\n      console.error(\"Update stock error:\", error);\n      toast({\n        title: t(\"inventory.updateFailed\") || \"Cập nhật thất bại\",\n        description:\n          t(\"inventory.updateFailedDescription\") ||\n          \"Không thể cập nhật sản phẩm. Vui lòng thử lại.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateProductTrackInventoryMutation = useMutation({\n    mutationFn: async ({ id, trackInventory }: { id: number; trackInventory: boolean }) => {\n      const response = await fetch(`/api/products/${id}/track-inventory`, {\n        method: \"PATCH\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({ trackInventory }),\n      });\n      if (!response.ok) {\n        throw new Error(\"Failed to update track inventory\");\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      toast({\n        title: \"Thành công\",\n        description: \"Trạng thái theo dõi tồn kho đã được cập nhật\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Lỗi\",\n        description: \"Không thể cập nhật trạng thái theo dõi tồn kho\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const createProductMutation = useMutation({\n    mutationFn: async (data: any) => {\n      console.log(\"Sending product data:\", data);\n      const response = await fetch(\"/api/products\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(data),\n      });\n      if (!response.ok) {\n        throw new Error(\"Failed to create product\");\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      setShowStockDialog(false);\n      stockUpdateForm.reset();\n      toast({\n        title: t(\"inventory.createSuccess\") || \"Tạo mới thành công\",\n        description:\n          t(\"inventory.createSuccessDescription\") ||\n          \"Sản phẩm mới đã được thêm vào kho hàng\",\n      });\n    },\n    onError: (error: any) => {\n      console.error(\"Create product error:\", error);\n\n      // Check if it's a duplicate SKU error\n      if (\n        error?.response?.status === 409 &&\n        error?.response?.data?.code === \"DUPLICATE_SKU\"\n      ) {\n        toast({\n          title: t(\"inventory.duplicateSku\") || \"Đã tồn tại sản phẩm trong kho\",\n          description:\n            t(\"inventory.duplicateSkuDescription\") ||\n            \"SKU này đã được sử dụng cho sản phẩm khác\",\n          variant: \"destructive\",\n        });\n      } else {\n        toast({\n          title: t(\"inventory.createFailed\") || \"Tạo mới thất bại\",\n          description:\n            t(\"inventory.createFailedDescription\") ||\n            \"Không thể tạo sản phẩm mới. Vui lòng thử lại.\",\n          variant: \"destructive\",\n        });\n      }\n    },\n  });\n\n  const deleteProductMutation = useMutation({\n    mutationFn: async (productId: number) => {\n      const response = await fetch(`/api/products/${productId}`, {\n        method: \"DELETE\",\n      });\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.message || \"Failed to delete product\");\n      }\n      return response;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      toast({\n        title: \"\",\n        description: t(\"inventory.deleteSuccess\") || \"Xóa sản phẩm thành công\",\n      });\n    },\n    onError: (error) => {\n      console.error(\"Delete product error:\", error);\n\n      let errorMessage = t(\"inventory.deleteFailedDescription\") || \"Không thể xóa sản phẩm. Vui lòng thử lại.\";\n\n      if (error instanceof Error && error.message.includes(\"Cannot delete product\")) {\n        if (error.message.includes(\"transactions\")) {\n          errorMessage = \"Không thể xóa sản phẩm vì đã được sử dụng trong các giao dịch bán hàng.\";\n        } else if (error.message.includes(\"orders\")) {\n          errorMessage = \"Không thể xóa sản phẩm vì đã được sử dụng trong các đơn hàng.\";\n        }\n      }\n\n      toast({\n        title: t(\"inventory.deleteFailed\") || \"Xóa thất bại\",\n        description: errorMessage,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const cleanupMutation = useMutation({\n    mutationFn: async () => {\n      const response = await fetch(\"/api/products/cleanup/inactive\", {\n        method: \"DELETE\",\n      });\n      if (!response.ok) {\n        throw new Error(\"Failed to cleanup inactive products\");\n      }\n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      toast({\n        title: \"Dọn dẹp thành công\",\n        description: `Đã xóa ${data.deletedCount} sản phẩm vô hiệu khỏi cơ sở dữ liệu`,\n      });\n    },\n    onError: (error) => {\n      console.error(\"Cleanup error:\", error);\n      toast({\n        title: \"Dọn dẹp thất bại\",\n        description: \"Không thể xóa các sản phẩm vô hiệu. Vui lòng thử lại.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n\n\n  const filteredProducts = products.filter((product) => {\n    const matchesSearch =\n      product.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      product.sku.toLowerCase().includes(searchTerm.toLowerCase());\n    const matchesCategory =\n      selectedCategory === \"all\" ||\n      product.categoryId.toString() === selectedCategory;\n    const matchesStock =\n      stockFilter === \"all\" ||\n      (stockFilter === \"low\" && product.stock <= 10 && product.stock > 0) ||\n      (stockFilter === \"out\" && product.stock === 0) ||\n      (stockFilter === \"in\" && product.stock > 10);\n\n    return matchesSearch && matchesCategory && matchesStock;\n  });\n\n  const lowStockCount = products.filter(\n    (p) => p.stock <= 10 && p.stock > 0,\n  ).length;\n  const outOfStockCount = products.filter((p) => p.stock === 0).length;\n  const totalValue = products.reduce(\n    (sum, p) => sum + parseFloat(p.price) * p.stock,\n    0,\n  );\n\n  const handleStockUpdate = (product: Product) => {\n    setSelectedProduct(product);\n    if (product.id === 0) {\n      // Reset form for new product\n      stockUpdateForm.reset({\n        productId: 0,\n        quantity: 0,\n        type: \"set\",\n        name: \"\",\n        sku: \"\",\n        price: \"0\",\n        categoryId: categories[0]?.id || 1,\n        productType: 1,\n        trackInventory: true,\n        taxRate: \"8.00\",\n      });\n    } else {\n      // Load existing product data for editing\n      stockUpdateForm.reset({\n        productId: product.id,\n        quantity: 1,\n        type: \"add\",\n        name: product.name,\n        sku: product.sku,\n        price: product.price,\n        categoryId: product.categoryId,\n        productType: product.productType || 1,\n        trackInventory: product.trackInventory !== false,\n      });\n    }\n    setShowStockDialog(true);\n  };\n\n  const handleDeleteProduct = (product: Product) => {\n    if (\n      window.confirm(\n        `Bạn có chắc chắn muốn xóa vĩnh viễn sản phẩm \"${product.name}\" khỏi cơ sở dữ liệu? Hành động này không thể hoàn tác.`,\n      )\n    ) {\n      deleteProductMutation.mutate(product.id);\n    }\n  };\n\n  const handleCleanupInactiveProducts = () => {\n    if (\n      window.confirm(\n        \"Bạn có chắc chắn muốn xóa vĩnh viễn tất cả sản phẩm vô hiệu khỏi cơ sở dữ liệu? Hành động này không thể hoàn tác.\",\n      )\n    ) {\n      cleanupMutation.mutate();\n    }\n  };\n\n  const onStockUpdate = (data: StockUpdateForm) => {\n    if (selectedProduct?.id === 0) {\n      // Creating new product\n      const newProductData = {\n        name: data.name || \"\",\n        sku: data.sku || \"\",\n        price: data.price || \"0\",\n        stock: data.quantity || 0,\n        categoryId: data.categoryId || 1,\n        productType: data.productType || 1,\n        taxRate: data.taxRate || \"8.00\",\n        imageUrl: null,\n        isActive: true,\n        trackInventory: data.trackInventory !== false,\n      };\n      console.log(\"Creating product with data:\", newProductData);\n      createProductMutation.mutate(newProductData);\n    } else {\n      // Updating existing product stock - include trackInventory\n      const updateData = {\n        productId: selectedProduct.id,\n        quantity: data.quantity,\n        type: data.type,\n        notes: data.notes,\n        trackInventory: data.trackInventory\n      };\n      console.log(\"Updating stock with data:\", updateData);\n      updateStockMutation.mutate(updateData);\n    }\n  };\n\n  const getStockStatus = (stock: number) => {\n    if (stock === 0)\n      return { label: t(\"inventory.outOfStock\"), color: \"bg-red-500\" };\n    if (stock <= 10)\n      return { label: t(\"inventory.lowStock\"), color: \"bg-yellow-500\" };\n    return { label: t(\"inventory.inStock\"), color: \"bg-green-500\" };\n  };\n\n  return (\n    <div className=\"min-h-screen bg-green-50 grocery-bg\">\n      <POSHeader />\n      <RightSidebar />\n\n      <div className=\"main-content pt-16 px-6\">\n        <div className=\"max-w-7xl mx-auto py-8\">\n          {/* Page Header */}\n          <div className=\"flex justify-between items-center mb-8\">\n            <div>\n              <h1 className=\"text-3xl font-bold text-gray-900\">\n                {t(\"inventory.title\")}\n              </h1>\n              <p className=\"text-gray-600 mt-2\">{t(\"inventory.description\")}</p>\n            </div>\n          </div>\n\n          {/* Statistics Cards */}\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8\">\n            <Card className=\"border-green-200\">\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                <CardTitle className=\"text-sm font-medium text-gray-600\">\n                  {t(\"inventory.totalProducts\")}\n                </CardTitle>\n                <Package className=\"h-4 w-4 text-green-600\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold text-gray-900\">\n                  {products.length}\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card className=\"border-green-200\">\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                <CardTitle className=\"text-sm font-medium text-gray-600\">\n                  {t(\"inventory.lowStock\")}\n                </CardTitle>\n                <AlertTriangle className=\"h-4 w-4 text-yellow-600\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold text-yellow-600\">\n                  {lowStockCount}\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card className=\"border-green-200\">\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                <CardTitle className=\"text-sm font-medium text-gray-600\">\n                  {t(\"inventory.outOfStock\")}\n                </CardTitle>\n                <AlertTriangle className=\"h-4 w-4 text-red-600\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold text-red-600\">\n                  {outOfStockCount}\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card className=\"border-green-200\">\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                <CardTitle className=\"text-sm font-medium text-gray-600\">\n                  {t(\"inventory.totalValue\")}\n                </CardTitle>\n                <TrendingUp className=\"h-4 w-4 text-green-600\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold text-green-600\">\n                  {totalValue.toLocaleString()} ₫\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* Filters */}\n          <Card className=\"mb-8 border-green-200\">\n            <CardContent className=\"pt-6\">\n              <div className=\"flex flex-col md:flex-row gap-4\">\n                <div className=\"flex-1\">\n                  <div className=\"relative\">\n                    <Search className=\"absolute left-3 top-3 h-4 w-4 text-gray-400\" />\n                    <Input\n                      placeholder={t(\"inventory.searchProducts\")}\n                      value={searchTerm}\n                      onChange={(e) => setSearchTerm(e.target.value)}\n                      className=\"pl-10\"\n                    />\n                  </div>\n                </div>\n                <Select\n                  value={selectedCategory}\n                  onValueChange={setSelectedCategory}\n                >\n                  <SelectTrigger className=\"w-[200px]\">\n                    <SelectValue placeholder={t(\"common.category\")} />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">{t(\"common.category\")}</SelectItem>\n                    {categories.map((category) => (\n                      <SelectItem\n                        key={category.id}\n                        value={category.id.toString()}\n                      >\n                        {category.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <Select value={stockFilter} onValueChange={setStockFilter}>\n                  <SelectTrigger className=\"w-[200px]\">\n                    <SelectValue placeholder={t(\"inventory.stockStatus\")} />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">\n                      {t(\"inventory.allStock\")}\n                    </SelectItem>\n                    <SelectItem value=\"in\">{t(\"inventory.inStock\")}</SelectItem>\n                    <SelectItem value=\"low\">\n                      {t(\"inventory.lowStock\")}\n                    </SelectItem>\n                    <SelectItem value=\"out\">\n                      {t(\"inventory.outOfStock\")}\n                    </SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Products Table */}\n          <Card className=\"border-green-200\">\n            <CardHeader className=\"flex flex-row items-center justify-between\">\n              <CardTitle className=\"text-left\">\n                {t(\"inventory.stockStatus\")}\n              </CardTitle>\n              <div className=\"flex gap-2\">\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => {\n                    // Create a placeholder product for adding new items\n                    const newProduct: Product = {\n                      id: 0,\n                      name: \"\",\n                      sku: \"\",\n                      categoryId: 1,\n                      price: \"0\",\n                      stock: 0,\n                      imageUrl: null,\n                      isActive: true,\n                    };\n                    handleStockUpdate(newProduct);\n                  }}\n                  className=\"text-blue-600 border-blue-300 hover:bg-blue-50\"\n                >\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  {t(\"inventory.addNewItem\")}\n                </Button>\n              </div>\n            </CardHeader>\n            <CardContent>\n              {productsLoading ? (\n                <div className=\"text-center py-8\">\n                  <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-green-500 mx-auto\"></div>\n                  <p className=\"mt-4 text-gray-600\">{t(\"inventory.loading\")}</p>\n                </div>\n              ) : (\n                <div className=\"overflow-x-auto\">\n                  <table className=\"w-full table-auto\">\n                    <thead>\n                      <tr className=\"border-b border-green-200\">\n                        <th className=\"text-left py-3 px-2 font-medium text-gray-700 w-auto min-w-[120px]\">\n                          <div className=\"leading-tight break-words\">\n                            {t(\"inventory.productName\")}\n                          </div>\n                        </th>\n                        <th className=\"text-left py-3 px-2 font-medium text-gray-700 w-auto min-w-[80px]\">\n                          <div className=\"leading-tight break-words\">\n                            SKU\n                          </div>\n                        </th>\n                        <th className=\"text-left py-3 px-2 font-medium text-gray-700 w-auto min-w-[100px]\">\n                          <div className=\"leading-tight break-words\">\n                            {t(\"tables.productType\")}\n                          </div>\n                        </th>\n                        <th className=\"text-left py-3 px-2 font-medium text-gray-700 w-auto min-w-[90px]\">\n                          <div className=\"leading-tight break-words\">\n                            {t(\"common.category\")}\n                          </div>\n                        </th>\n                        <th className=\"text-center py-3 px-2 font-medium text-gray-700 w-auto min-w-[80px]\">\n                          <div className=\"leading-tight break-words\">\n                            {t(\"inventory.currentStock\")}\n                          </div>\n                        </th>\n                        <th className=\"text-center py-3 px-2 font-medium text-gray-700 w-auto min-w-[80px]\">\n                          <div className=\"leading-tight break-words\">\n                            {t(\"common.status\")}\n                          </div>\n                        </th>\n                        <th className=\"text-center py-3 px-2 font-medium text-gray-700 w-auto min-w-[100px]\">\n                          <div className=\"leading-tight break-words\">\n                            {t(\"inventory.trackInventory\")}\n                          </div>\n                        </th>\n                        <th className=\"text-right py-3 px-2 font-medium text-gray-700 w-auto min-w-[80px]\">\n                          <div className=\"leading-tight break-words\">\n                            {t(\"inventory.unitPrice\")}\n                          </div>\n                        </th>\n                        <th className=\"text-right py-3 px-2 font-medium text-gray-700 w-auto min-w-[100px]\">\n                          <div className=\"leading-tight break-words\">\n                            {t(\"inventory.stockValue\")}\n                          </div>\n                        </th>\n                        <th className=\"text-center py-3 px-2 font-medium text-gray-700 w-auto min-w-[100px]\">\n                          <div className=\"leading-tight break-words\">\n                            {t(\"inventory.management\")}\n                          </div>\n                        </th>\n                      </tr>\n                    </thead>\n                    <tbody>\n                      {filteredProducts.map((product) => {\n                        const category = categories.find(\n                          (c) => c.id === product.categoryId,\n                        );\n                        const status = getStockStatus(product.stock);\n                        const stockValue =\n                          parseFloat(product.price) * product.stock;\n\n                        return (\n                          <tr\n                            key={product.id}\n                            className=\"border-b border-gray-100 hover:bg-green-50/50\"\n                          >\n                            <td className=\"py-4 px-2\">\n                              <div className=\"font-medium text-gray-900 break-words\">\n                                {product.name}\n                              </div>\n                            </td>\n                            <td className=\"py-4 px-2 text-gray-600\">\n                              <div className=\"break-words\">\n                                {product.sku}\n                              </div>\n                            </td>\n                            <td className=\"py-4 px-2\">\n                              <Badge\n                                variant=\"outline\"\n                                className=\"text-blue-700 border-blue-300 text-xs\"\n                              >\n                                {product.productType === 1 ? t(\"tables.goodsType\") : \n                                 product.productType === 2 ? t(\"tables.materialType\") : \n                                 product.productType === 3 ? t(\"tables.finishedProductType\") : \n                                 t(\"tables.goodsType\")}\n                              </Badge>\n                            </td>\n                            <td className=\"py-4 px-2\">\n                              <Badge\n                                variant=\"outline\"\n                                className=\"text-green-700 border-green-300 text-xs\"\n                              >\n                                {category?.name || t(\"inventory.uncategorized\")}\n                              </Badge>\n                            </td>\n                            <td className=\"py-4 px-2 text-center\">\n                              <span className=\"text-lg font-semibold\">\n                                {product.stock}\n                              </span>\n                            </td>\n                            <td className=\"py-4 px-2 text-center\">\n                              <Badge className={`${status.color} text-white text-xs`}>\n                                {status.label}\n                              </Badge>\n                            </td>\n                            <td className=\"py-4 px-2 text-center\">\n                              <Checkbox\n                                checked={product.trackInventory !== false}\n                                disabled={true}\n                              />\n                            </td>\n                            <td className=\"py-4 px-2 text-right text-gray-900\">\n                              <div className=\"break-words\">\n                                {parseFloat(product.price).toLocaleString()} ₫\n                              </div>\n                            </td>\n                            <td className=\"py-4 px-2 text-right font-medium text-gray-900\">\n                              <div className=\"break-words\">\n                                {stockValue.toLocaleString()} ₫\n                              </div>\n                            </td>\n                            <td className=\"py-4 px-2 text-center\">\n                              <div className=\"flex gap-2 justify-center\">\n                                <Button\n                                  variant=\"outline\"\n                                  size=\"sm\"\n                                  onClick={() => handleStockUpdate(product)}\n                                  className=\"text-green-600 border-green-300 hover:bg-green-50\"\n                                >\n                                  <Edit className=\"h-4 w-4 mr-1\" />\n                                  {t(\"inventory.edit\")}\n                                </Button>\n                                <Button\n                                  variant=\"outline\"\n                                  size=\"sm\"\n                                  onClick={() => handleDeleteProduct(product)}\n                                  className=\"text-red-600 border-red-300 hover:bg-red-50\"\n                                >\n                                  <Trash2 className=\"h-4 w-4 mr-1\" />\n                                  {t(\"inventory.delete\")}\n                                </Button>\n                              </div>\n                            </td>\n                          </tr>\n                        );\n                      })}\n                    </tbody>\n                  </table>\n\n                  {filteredProducts.length === 0 && (\n                    <div className=\"text-center py-12\">\n                      <Package className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                      <p className=\"text-gray-600\">\n                        {t(\"inventory.noProducts\")}\n                      </p>\n                    </div>\n                  )}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n\n      {/* Stock Update Dialog */}\n      <Dialog open={showStockDialog} onOpenChange={setShowStockDialog}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle>\n              {selectedProduct?.id === 0\n                ? t(\"inventory.addNewStock\")\n                : t(\"inventory.stockUpdate\")}\n            </DialogTitle>\n          </DialogHeader>\n\n          {selectedProduct && (\n            <Form {...stockUpdateForm}>\n              <form\n                onSubmit={stockUpdateForm.handleSubmit(onStockUpdate)}\n                className=\"space-y-4\"\n              >\n                {selectedProduct?.id !== 0 && (\n                  <div className=\"bg-green-50 p-4 rounded-lg\">\n                    <h3 className=\"font-medium text-gray-900\">\n                      {selectedProduct.name}\n                    </h3>\n                    <p className=\"text-sm text-gray-600\">\n                      {t(\"inventory.currentStockLabel\")}:{\" \"}\n                      {selectedProduct.stock}\n                      {t(\"common.items\")}\n                    </p>\n                  </div>\n                )}\n\n                {selectedProduct?.id === 0 && (\n                  <>\n                    <FormField\n                      control={stockUpdateForm.control}\n                      name=\"name\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>\n                            {t(\"inventory.productNameLabel\")}\n                          </FormLabel>\n                          <FormControl>\n                            <Input\n                              placeholder={t(\n                                \"inventory.productNamePlaceholder\",\n                              )}\n                              {...field}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={stockUpdateForm.control}\n                      name=\"sku\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t(\"inventory.skuLabel\")}</FormLabel>\n                          <FormControl>\n                            <Input\n                              placeholder={t(\"inventory.skuPlaceholder\")}\n                              {...field}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={stockUpdateForm.control}\n                      name=\"productType\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t(\"tables.productType\")}</FormLabel>\n                          <Select\n                            onValueChange={(value) =>\n                              field.onChange(parseInt(value))\n                            }\n                            value={field.value?.toString() || \"1\"}\n                          >\n                            <FormControl>\n                              <SelectTrigger>\n                                <SelectValue\n                                  placeholder={t(\"tables.selectProductType\")}\n                                />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              <SelectItem value=\"1\">{t(\"tables.goodsType\")}</SelectItem>\n                              <SelectItem value=\"2\">{t(\"tables.materialType\")}</SelectItem>\n                              <SelectItem value=\"3\">{t(\"tables.finishedProductType\")}</SelectItem>\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={stockUpdateForm.control}\n                      name=\"price\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t(\"inventory.priceLabel\")}</FormLabel>\n                          <FormControl>\n                            <Input\n                              placeholder={t(\"inventory.pricePlaceholder\")}\n                              {...field}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={stockUpdateForm.control}\n                      name=\"taxRate\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Thuế (%)</FormLabel>\n                          <FormControl>\n                            <Input\n                              type=\"number\"\n                              step=\"0.01\"\n                              min=\"0\"\n                              max=\"100\"\n                              placeholder=\"8.00\"\n                              {...field}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={stockUpdateForm.control}\n                      name=\"categoryId\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t(\"inventory.categoryLabel\")}</FormLabel>\n                          <Select\n                            onValueChange={(value) =>\n                              field.onChange(parseInt(value))\n                            }\n                            value={field.value?.toString()}\n                          >\n                            <FormControl>\n                              <SelectTrigger>\n                                <SelectValue\n                                  placeholder={t(\n                                    \"inventory.categoryPlaceholder\",\n                                  )}\n                                />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              {categories.map((category) => (\n                                <SelectItem\n                                  key={category.id}\n                                  value={category.id.toString()}\n                                >\n                                  {category.name}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </>\n                )}\n\n                {selectedProduct?.id !== 0 && (\n                  <FormField\n                    control={stockUpdateForm.control}\n                    name=\"type\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>{t(\"inventory.updateType\")}</FormLabel>\n                        <Select\n                          onValueChange={field.onChange}\n                          defaultValue={field.value}\n                        >\n                          <FormControl>\n                            <SelectTrigger>\n                              <SelectValue\n                                placeholder={t(\"inventory.selectUpdateType\")}\n                              />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            <SelectItem value=\"add\">\n                              {t(\"inventory.addStock\")}\n                            </SelectItem>\n                            <SelectItem value=\"subtract\">\n                              {t(\"inventory.subtractStock\")}\n                            </SelectItem>\n                            <SelectItem value=\"set\">\n                              {t(\"inventory.setStock\")}\n                            </SelectItem>\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                )}\n\n                <FormField\n                  control={stockUpdateForm.control}\n                  name=\"trackInventory\"\n                  render={({ field }) => (\n                    <FormItem className=\"flex flex-row items-start space-x-3 space-y-0\">\n                      <FormControl>\n                        <Checkbox\n                          checked={field.value !== false}\n                          onCheckedChange={field.onChange}\n                        />\n                      </FormControl>\n                      <div className=\"space-y-1 leading-none\">\n                        <FormLabel>\n                          {t(\"inventory.trackInventory\")}\n                        </FormLabel>\n                      </div>\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={stockUpdateForm.control}\n                  name=\"quantity\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>\n                        {selectedProduct?.id === 0\n                          ? t(\"inventory.initialStockQuantity\")\n                          : t(\"inventory.stockQuantity\")}\n                      </FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"number\"\n                          min=\"0\"\n                          placeholder={\n                            selectedProduct?.id === 0\n                              ? t(\"inventory.initialStockPlaceholder\")\n                              : t(\"inventory.quantityInput\")\n                          }\n                          {...field}\n                          onChange={(e) =>\n                            field.onChange(parseInt(e.target.value) || 0)\n                          }\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {selectedProduct?.id !== 0 && (\n                  <FormField\n                    control={stockUpdateForm.control}\n                    name=\"notes\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>{t(\"inventory.editReason\")}</FormLabel>\n                        <FormControl>\n                          <Input\n                            placeholder={t(\"inventory.changeReason\")}\n                            {...field}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                )}\n\n                <div className=\"flex justify-end space-x-2 pt-4\">\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => setShowStockDialog(false)}\n                  >\n                    {t(\"common.cancel\")}\n                  </Button>\n                  <Button\n                    type=\"submit\"\n                    disabled={\n                      updateStockMutation.isPending ||\n                      createProductMutation.isPending\n                    }\n                    className=\"bg-green-600 hover:bg-green-700\"\n                  >\n                    {updateStockMutation.isPending ||\n                    createProductMutation.isPending ? (\n                      <>\n                        <RotateCcw className=\"h-4 w-4 mr-2 animate-spin\" />\n                        {t(\"inventory.processing\")}\n                      </>\n                    ) : selectedProduct?.id === 0 ? (\n                      t(\"inventory.save\")\n                    ) : (\n                      t(\"inventory.stockUpdate\")\n                    )}\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":41221},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { AlertCircle, Home } from \"lucide-react\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport { Link } from \"wouter\";\n\nexport default function NotFound() {\n  const { t } = useTranslation();\n  \n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-green-50 grocery-bg\">\n      <Card className=\"w-full max-w-md mx-4 bg-white/80 backdrop-blur-sm border-white/20\">\n        <CardContent className=\"pt-6\">\n          <div className=\"text-center\">\n            <AlertCircle className=\"h-16 w-16 text-red-500 mx-auto mb-4\" />\n            <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">{t('notFound.title')}</h1>\n            <p className=\"text-gray-600 mb-6\">{t('notFound.description')}</p>\n            \n            <Link href=\"/\">\n              <Button className=\"bg-green-600 hover:bg-green-700\">\n                <Home className=\"w-4 h-4 mr-2\" />\n                {t('notFound.backToHome')}\n              </Button>\n            </Link>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":1151},"client/src/pages/pos.tsx":{"content":"import React, { useState } from \"react\";\nimport { POSHeader } from \"@/components/pos/header\";\nimport { RightSidebar } from \"@/components/ui/right-sidebar\";\nimport { CategorySidebar } from \"@/components/pos/category-sidebar\";\nimport { ProductGrid } from \"@/components/pos/product-grid\";\nimport { ShoppingCart } from \"@/components/pos/shopping-cart\";\nimport { ReceiptModal } from \"@/components/pos/receipt-modal\";\nimport { ProductManagerModal } from \"@/components/pos/product-manager-modal\";\nimport { usePOS } from \"@/hooks/use-pos\";\n\ninterface POSPageProps {\n  onLogout?: () => void;\n}\n\nexport default function POS({ onLogout }: POSPageProps) {\n  const [showReceiptModal, setShowReceiptModal] = useState(false);\n  const [showProductManagerModal, setShowProductManagerModal] = useState(false);\n  const [selectedCategory, setSelectedCategory] = useState<number | \"all\">(\"all\");\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [lastCartItems, setLastCartItems] = useState<any[]>([]);\n\n  const {\n    cart,\n    orders,\n    activeOrderId,\n    addToCart,\n    removeFromCart,\n    updateQuantity,\n    clearCart,\n    createNewOrder,\n    switchOrder,\n    removeOrder,\n    lastReceipt,\n    isProcessingCheckout,\n    processCheckout\n  } = usePOS();\n\n  const handleCheckout = async (paymentData: any) => {\n    console.log(\"=== POS PAGE CHECKOUT DEBUG ===\");\n    console.log(\"Cart before checkout:\", cart);\n    console.log(\"Cart length:\", cart.length);\n\n    // Prepare cart items with proper data types and validation\n    const cartItemsBeforeCheckout = cart.map(item => {\n      // Ensure price is a number\n      let itemPrice = item.price;\n      if (typeof itemPrice === 'string') {\n        itemPrice = parseFloat(itemPrice);\n      }\n      if (isNaN(itemPrice) || itemPrice <= 0) {\n        itemPrice = 0;\n      }\n\n      // Ensure quantity is a positive integer\n      let itemQuantity = item.quantity;\n      if (typeof itemQuantity === 'string') {\n        itemQuantity = parseInt(itemQuantity);\n      }\n      if (isNaN(itemQuantity) || itemQuantity <= 0) {\n        itemQuantity = 1;\n      }\n\n      // Ensure taxRate is a number\n      let itemTaxRate = item.taxRate;\n      if (typeof itemTaxRate === 'string') {\n        itemTaxRate = parseFloat(itemTaxRate);\n      }\n      if (isNaN(itemTaxRate)) {\n        itemTaxRate = 10; // Default 10%\n      }\n\n      return {\n        id: item.id,\n        name: item.name || `Product ${item.id}`,\n        price: itemPrice,\n        quantity: itemQuantity,\n        sku: item.sku || `ITEM${String(item.id).padStart(3, '0')}`,\n        taxRate: itemTaxRate\n      };\n    });\n\n    console.log(\"✅ Processed cart items:\", cartItemsBeforeCheckout);\n\n    // Validate processed items\n    const invalidItems = cartItemsBeforeCheckout.filter(item => \n      !item.id || !item.name || item.price <= 0 || item.quantity <= 0\n    );\n\n    if (invalidItems.length > 0) {\n      console.error(\"❌ Invalid items found after processing:\", invalidItems);\n      alert(\"Có sản phẩm không hợp lệ trong giỏ hàng. Vui lòng kiểm tra lại.\");\n      return;\n    }\n\n    // Set cart items before checkout to ensure they're available for receipt modal\n    setLastCartItems([...cartItemsBeforeCheckout]); // Use spread to ensure new array reference\n\n    console.log(\"✅ Cart items validation passed, processing checkout...\");\n\n    try {\n      const receipt = await processCheckout(paymentData);\n      if (receipt) {\n        console.log(\"✅ Receipt processed successfully\");\n        console.log(\"✅ Opening receipt modal with cartItems:\", cartItemsBeforeCheckout.length, \"items\");\n        setShowReceiptModal(true);\n      } else {\n        console.error(\"❌ Failed to process checkout - no receipt returned\");\n        alert(\"Lỗi thanh toán. Vui lòng thử lại.\");\n      }\n    } catch (error) {\n      console.error(\"❌ Checkout process failed:\", error);\n      alert(\"Lỗi thanh toán. Vui lòng thử lại.\");\n    }\n  };\n\n  try {\n    return (\n      <div className=\"min-h-screen bg-green-50 grocery-bg\">\n      {/* Header */}\n      <POSHeader onLogout={onLogout} />\n\n      {/* Right Sidebar */}\n      <RightSidebar />\n\n      <div className=\"main-content flex h-screen pt-16\">\n        {/* Category Sidebar */}\n        <CategorySidebar\n          selectedCategory={selectedCategory}\n          onCategorySelect={setSelectedCategory}\n          searchQuery={searchQuery}\n          onSearchChange={setSearchQuery}\n          onOpenProductManager={() => setShowProductManagerModal(true)}\n          onAddToCart={addToCart}\n        />\n\n        {/* Product Grid */}\n        <ProductGrid\n          selectedCategory={selectedCategory}\n          searchQuery={searchQuery}\n          onAddToCart={(product) => addToCart(product)}\n        />\n\n        {/* Shopping Cart */}\n        <ShoppingCart\n          cart={cart}\n          onUpdateQuantity={updateQuantity}\n          onRemoveItem={removeFromCart}\n          onClearCart={clearCart}\n          onCheckout={handleCheckout}\n          isProcessing={isProcessingCheckout}\n          orders={orders}\n          activeOrderId={activeOrderId}\n          onCreateNewOrder={createNewOrder}\n          onSwitchOrder={switchOrder}\n          onRemoveOrder={removeOrder}\n        />\n      </div>\n\n      {/* Modals */}\n      <ReceiptModal\n        isOpen={showReceiptModal}\n        onClose={() => {\n          console.log(\"🔴 Closing receipt modal\");\n          setShowReceiptModal(false);\n        }}\n        receipt={lastReceipt}\n        cartItems={lastCartItems}\n      />\n\n      <ProductManagerModal\n        isOpen={showProductManagerModal}\n        onClose={() => setShowProductManagerModal(false)}\n      />\n      </div>\n    );\n  } catch (error) {\n    console.error(\"❌ POS Page Error:\", error);\n    return (\n      <div className=\"min-h-screen bg-red-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <h1 className=\"text-2xl font-bold text-red-600 mb-4\">Có lỗi xảy ra</h1>\n          <p className=\"text-gray-600 mb-4\">Vui lòng tải lại trang</p>\n          <button \n            onClick={() => window.location.reload()} \n            className=\"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600\"\n          >\n            Tải lại trang\n          </button>\n        </div>\n      </div>\n    );\n  }\n}","size_bytes":6288},"client/src/pages/reports.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { POSHeader } from \"@/components/pos/header\";\nimport { RightSidebar } from \"@/components/ui/right-sidebar\";\nimport { SalesReport } from \"@/components/reports/sales-report\";\nimport { SalesChartReport } from \"@/components/reports/sales-chart-report\";\nimport { MenuReport } from \"@/components/reports/menu-report\";\nimport { TableReport } from \"@/components/reports/table-report\";\nimport { DashboardOverview } from \"@/components/reports/dashboard-overview\";\nimport { OrderReport } from \"@/components/reports/order-report\";\nimport { InventoryReport } from \"@/components/reports/inventory-report\";\nimport { CustomerReport } from \"@/components/reports/customer-report\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { BarChart3, PieChart, TrendingUp, Utensils, Package, Users, Calendar, ShoppingCart } from \"lucide-react\";\nimport { Link, useSearch } from \"wouter\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport { EmployeeReport } from \"@/components/reports/employee-report\";\nimport { SalesChannelReport } from \"@/components/reports/sales-channel-report\";\nimport { FinancialReport } from \"@/components/reports/financial-report\";\n\nexport default function ReportsPage() {\n  const { t } = useTranslation();\n  const search = useSearch();\n  const [activeTab, setActiveTab] = useState(\"overview\");\n\n  useEffect(() => {\n    const params = new URLSearchParams(search);\n    const tab = params.get('tab');\n    if (tab && ['overview', 'sales', 'menu', 'table', 'saleschart'].includes(tab)) {\n      setActiveTab(tab);\n    }\n  }, [search]);\n  return (\n    <div className=\"min-h-screen bg-green-50 grocery-bg\">\n      {/* Header */}\n      <POSHeader />\n\n      {/* Right Sidebar */}\n      <RightSidebar />\n\n      <div className=\"main-content pt-16 px-6\">\n        <div className=\"max-w-5xl mx-auto py-8\">\n          {/* Page Header */}\n          <div className=\"flex justify-between items-center mb-8\">\n            <div>\n              <h1 className=\"text-3xl font-bold text-gray-900\">{t('reports.title')}</h1>\n              <p className=\"mt-2 text-gray-600\">{t('reports.description')}</p>\n            </div>\n            <div className=\"flex gap-4\">\n              <Link href=\"/\">\n                <Button variant=\"outline\">\n                  <ShoppingCart className=\"w-4 h-4 mr-2\" />\n                  Quay lại Bán hàng\n                </Button>\n              </Link>\n            </div>\n          </div>\n\n\n\n          <Tabs value={activeTab} onValueChange={setActiveTab} className=\"space-y-6\">\n            <div className=\"w-full overflow-x-auto\">\n              <TabsList className=\"h-auto min-h-[40px] items-center justify-start rounded-md p-2 text-muted-foreground flex flex-wrap gap-1 bg-white border border-green-200 w-full shadow-sm\">\n                <TabsTrigger\n                  value=\"overview\"\n                  className=\"flex items-center gap-1 text-xs sm:text-sm px-2 sm:px-3 py-1.5 sm:py-2 whitespace-nowrap data-[state=active]:bg-green-500 data-[state=active]:text-white data-[state=active]:shadow-md hover:bg-green-100 transition-colors\"\n                >\n                  <TrendingUp className=\"w-3 h-3 sm:w-4 sm:h-4\" />\n                  <span>{t('reports.dashboard')}</span>\n                </TabsTrigger>\n                <TabsTrigger\n                  value=\"sales\"\n                  className=\"flex items-center gap-1 text-xs sm:text-sm px-2 sm:px-3 py-1.5 sm:py-2 whitespace-nowrap data-[state=active]:bg-green-500 data-[state=active]:text-white data-[state=active]:shadow-md hover:bg-green-100 transition-colors\"\n                >\n                  <BarChart3 className=\"w-3 h-3 sm:w-4 sm:h-4\" />\n                  <span>{t('reports.salesAnalysis')}</span>\n                </TabsTrigger>\n                <TabsTrigger\n                  value=\"menu\"\n                  className=\"flex items-center gap-1 text-xs sm:text-sm px-2 sm:px-3 py-1.5 sm:py-2 whitespace-nowrap data-[state=active]:bg-green-500 data-[state=active]:text-white data-[state=active]:shadow-md hover:bg-green-100 transition-colors\"\n                >\n                  <PieChart className=\"w-3 h-3 sm:w-4 sm:h-4\" />\n                  <span>{t('reports.menuAnalysis')}</span>\n                </TabsTrigger>\n                <TabsTrigger\n                  value=\"table\"\n                  className=\"flex items-center gap-1 text-xs sm:text-sm px-2 sm:px-3 py-1.5 sm:py-2 whitespace-nowrap data-[state=active]:bg-green-500 data-[state=active]:text-white data-[state=active]:shadow-md hover:bg-green-100 transition-colors\"\n                >\n                  <Utensils className=\"w-3 h-3 sm:w-4 sm:h-4\" />\n                  <span>{t('reports.tableAnalysis')}</span>\n                </TabsTrigger>\n                <TabsTrigger\n                  value=\"saleschart\"\n                  className=\"flex items-center gap-1 text-xs sm:text-sm px-2 sm:px-3 py-1.5 sm:py-2 whitespace-nowrap data-[state=active]:bg-green-500 data-[state=active]:text-white data-[state=active]:shadow-md hover:bg-green-100 transition-colors\"\n                >\n                  <BarChart3 className=\"w-3 h-3 sm:w-4 sm:h-4\" />\n                  <span>{t('reports.salesReport')}</span>\n                </TabsTrigger>\n                \n                \n              </TabsList>\n            </div>\n\n            <TabsContent value=\"overview\">\n              <DashboardOverview />\n            </TabsContent>\n\n            <TabsContent value=\"sales\">\n              <SalesReport />\n            </TabsContent>\n\n            <TabsContent value=\"menu\">\n              <MenuReport />\n            </TabsContent>\n\n            <TabsContent value=\"table\">\n              <TableReport />\n            </TabsContent>\n\n            <TabsContent value=\"saleschart\">\n              <SalesChartReport />\n            </TabsContent>\n\n            \n\n            \n          </Tabs>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":6067},"client/src/pages/sales-orders.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { RightSidebar } from \"@/components/ui/right-sidebar\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from \"@/components/ui/alert-dialog\";\nimport { Calendar, Search, FileText, Package, Printer, Mail, X, Download } from \"lucide-react\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport * as XLSX from 'xlsx';\nimport { EInvoiceModal } from \"@/components/pos/einvoice-modal\";\n\n\ninterface Invoice {\n  id: number;\n  invoiceNumber: string;\n  tradeNumber: string;\n  templateNumber: string;\n  symbol: string;\n  customerName: string;\n  customerTaxCode: string;\n  customerAddress: string;\n  customerPhone: string;\n  customerEmail: string;\n  subtotal: string;\n  tax: string;\n  total: string;\n  paymentMethod: number | string; // Allow string for new payment methods\n  invoiceDate: string;\n  status: string;\n  einvoiceStatus: number;\n  invoiceStatus: number;\n  notes: string;\n  createdAt: string;\n}\n\ninterface InvoiceItem {\n  id: number;\n  invoiceId: number;\n  productId: number;\n  productName: string;\n  quantity: number;\n  unitPrice: string;\n  total: string;\n  taxRate: string;\n}\n\ninterface Order {\n  id: number;\n  orderNumber: string;\n  tableId?: number;\n  employeeId?: number;\n  status: string;\n  customerName?: string;\n  customerCount: number;\n  subtotal: string;\n  tax: string;\n  total: string;\n  paymentMethod?: string; // Allow string for new payment methods\n  paymentStatus: string;\n  einvoiceStatus: number;\n  notes?: string;\n  orderedAt: string;\n}\n\n// Helper function to safely determine item type\n  const getItemType = (item: any): 'invoice' | 'order' => {\n    if (item?.type) return item.type;\n    if (item?.orderNumber) return 'order';\n    if (item?.invoiceNumber || item?.tradeNumber) return 'invoice';\n    return 'invoice'; // default fallback\n  };\n\nexport default function SalesOrders() {\n  const { t } = useTranslation();\n  const queryClient = useQueryClient();\n  const [startDate, setStartDate] = useState(() => {\n    const today = new Date();\n    return today.toISOString().split('T')[0];\n  });\n  const [endDate, setEndDate] = useState(() => {\n    const today = new Date();\n    return today.toISOString().split('T')[0];\n  });\n  const [customerSearch, setCustomerSearch] = useState(\"\");\n  const [orderNumberSearch, setOrderNumberSearch] = useState(\"\");\n  const [customerCodeSearch, setCustomerCodeSearch] = useState(\"\");\n  const [selectedInvoice, setSelectedInvoice] = useState<Invoice | null>(null);\n  const [isEditing, setIsEditing] = useState(false);\n  const [editableInvoice, setEditableInvoice] = useState<Invoice | null>(null);\n  const [showCancelDialog, setShowCancelDialog] = useState(false);\n  const [selectedOrderIds, setSelectedOrderIds] = useState<Set<string>>(new Set());\n  const [showBulkCancelDialog, setShowBulkCancelDialog] = useState(false);\n  const [currentPage, setCurrentPage] = useState(1);\n  const [itemsPerPage, setItemsPerPage] = useState(20);\n  const [showPublishDialog, setShowPublishDialog] = useState(false);\n  const [showEInvoiceModal, setShowEInvoiceModal] = useState(false);\n\n\n\n  // Query invoices\n  const { data: invoices = [], isLoading: invoicesLoading, error: invoicesError } = useQuery({\n    queryKey: [\"/api/invoices\", currentPage, itemsPerPage],\n    queryFn: async () => {\n      try {\n        const response = await apiRequest(\"GET\", `/api/invoices?page=${currentPage}&limit=${itemsPerPage}`);\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        const data = await response.json();\n        return Array.isArray(data) ? data : [];\n      } catch (error) {\n        console.error('Error fetching invoices:', error);\n        return [];\n      }\n    },\n    retry: 3,\n    retryDelay: 1000,\n  });\n\n  // Query orders\n  const { data: orders = [], isLoading: ordersLoading, error: ordersError } = useQuery({\n    queryKey: [\"/api/orders\", currentPage, itemsPerPage],\n    queryFn: async () => {\n      try {\n        const response = await apiRequest(\"GET\", `/api/orders?page=${currentPage}&limit=${itemsPerPage}`);\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        const data = await response.json();\n        return Array.isArray(data) ? data : [];\n      } catch (error) {\n        console.error('Error fetching orders:', error);\n        return [];\n      }\n    },\n    retry: 3,\n    retryDelay: 1000,\n  });\n\n  const isLoading = invoicesLoading || ordersLoading;\n  const hasError = invoicesError || ordersError;\n\n  // Query invoice items for selected invoice\n  const { data: invoiceItems = [] } = useQuery({\n    queryKey: [\"/api/invoice-items\", selectedInvoice?.id],\n    queryFn: async () => {\n      if (!selectedInvoice?.id) return [];\n      try {\n        const response = await apiRequest(\"GET\", `/api/invoice-items/${selectedInvoice.id}`);\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        const data = await response.json();\n        return Array.isArray(data) ? data : [];\n      } catch (error) {\n        console.error('Error fetching invoice items:', error);\n        return [];\n      }\n    },\n    enabled: !!selectedInvoice?.id && (getItemType(selectedInvoice) === 'invoice' || !selectedInvoice?.type),\n    retry: 2,\n  });\n\n  // Query order items for selected order\n  const { data: orderItems = [] } = useQuery({\n    queryKey: [\"/api/order-items\", selectedInvoice?.id],\n    queryFn: async () => {\n      if (!selectedInvoice?.id) return [];\n      try {\n        const response = await apiRequest(\"GET\", `/api/order-items/${selectedInvoice.id}`);\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        const data = await response.json();\n        return Array.isArray(data) ? data : [];\n      } catch (error) {\n        console.error('Error fetching order items:', error);\n        return [];\n      }\n    },\n    enabled: !!selectedInvoice?.id && getItemType(selectedInvoice) === 'order',\n    retry: 2,\n  });\n\n  // Mutation for updating invoice\n  const updateInvoiceMutation = useMutation({\n    mutationFn: async (updatedInvoice: Invoice) => {\n      const response = await apiRequest(\"PUT\", `/api/invoices/${updatedInvoice.id}`, updatedInvoice);\n      return response.json();\n    },\n    onSuccess: () => {\n      // Refresh invoices list\n      queryClient.invalidateQueries({ queryKey: [\"/api/invoices\"] });\n      setIsEditing(false);\n      setEditableInvoice(null);\n      // Update selected invoice with new data\n      if (editableInvoice) {\n        setSelectedInvoice(editableInvoice);\n      }\n    },\n  });\n\n  // Mutation for bulk canceling orders\n  const bulkCancelOrdersMutation = useMutation({\n    mutationFn: async (orderKeys: string[]) => {\n      const results = [];\n      for (const orderKey of orderKeys) {\n        const [type, id] = orderKey.split('-');\n        try {\n          let response;\n\n          if (type === 'order') {\n            // For orders, update status to 'cancelled'\n            response = await apiRequest(\"PUT\", `/api/orders/${id}/status`, { \n              status: \"cancelled\"\n            });\n          } else {\n            // For invoices, update both invoiceStatus and invoice_status to 3 (Đã hủy)\n            response = await apiRequest(\"PUT\", `/api/invoices/${id}`, { \n              invoiceStatus: 3, // 3 = Đã hủy\n              invoice_status: 3, // 3 = Đã hủy (database column)\n              status: 'cancelled' // Also update general status\n            });\n          }\n\n          if (!response.ok) {\n            const errorText = await response.text();\n            throw new Error(`Failed to cancel ${type} ${id}: ${errorText}`);\n          }\n\n          results.push({ orderKey, success: true });\n        } catch (error) {\n          console.error(`Error canceling ${type} ${id}:`, error);\n          results.push({ orderKey, success: false, error: error.message });\n        }\n      }\n      return results;\n    },\n    onSuccess: (results) => {\n      console.log('Bulk cancel results:', results);\n\n      // Count successful cancellations\n      const successCount = results.filter(r => r.success).length;\n      const failCount = results.length - successCount;\n\n      // Close dialog\n      setShowBulkCancelDialog(false);\n\n      // Clear selections\n      setSelectedOrderIds(new Set());\n\n      // Refresh data\n      queryClient.invalidateQueries({ queryKey: [\"/api/invoices\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/orders\"] });\n\n      // Update selected invoice if it was cancelled\n      if (selectedInvoice) {\n        const selectedOrderKey = `${selectedInvoice.type}-${selectedInvoice.id}`;\n        const wasCancelled = results.find(r => r.orderKey === selectedOrderKey && r.success);\n        if (wasCancelled) {\n          setSelectedInvoice({\n            ...selectedInvoice,\n            invoiceStatus: 3,\n            invoice_status: 3,\n            displayStatus: 3,\n            status: selectedInvoice.type === 'order' ? 'cancelled' : selectedInvoice.status\n          });\n          setIsEditing(false);\n          setEditableInvoice(null);\n        }\n      }\n\n      // Show success message\n      if (successCount > 0) {\n        alert(`Đã hủy thành công ${successCount} đơn hàng${failCount > 0 ? `, ${failCount} đơn thất bại` : ''}`);\n      } else {\n        alert(`Không thể hủy đơn hàng nào`);\n      }\n    },\n    onError: (error) => {\n      console.error('Bulk cancel error:', error);\n      setShowBulkCancelDialog(false);\n      alert(`Lỗi hủy đơn hàng: ${error.message}`);\n    },\n  });\n\n  // Mutation for publishing invoice\n  const publishRequestMutation = useMutation({\n    mutationFn: async (invoiceData: any) => {\n      const response = await apiRequest(\"POST\", \"/api/einvoice/publish\", invoiceData);\n      return response.json();\n    },\n    onSuccess: async (result, variables) => {\n      console.log('✅ E-invoice published successfully:', result);\n\n      if (result.success && selectedInvoice) {\n        try {\n          // Determine the correct API endpoint based on item type\n          const updateEndpoint = getItemType(selectedInvoice) === 'order' \n            ? `/api/orders/${selectedInvoice.id}`\n            : `/api/invoices/${selectedInvoice.id}`;\n\n          // Map API response data properly\n          const invoiceNo = result.data?.invoiceNo || result.invoiceNumber || null;\n          const symbol = result.data?.symbol || result.symbol || 'AA/25E';\n          const templateNumber = result.data?.templateNumber || result.templateNumber || '1C25TYY';\n\n          // Prepare update data with proper field mapping\n          const updateData = {\n            einvoiceStatus: 1, // Đã phát hành\n            invoiceStatus: 1, // Hoàn thành\n            status: 'published',\n            invoiceNumber: invoiceNo,\n            symbol: symbol,\n            templateNumber: templateNumber,\n            tradeNumber: invoiceNo || selectedInvoice.tradeNumber || selectedInvoice.displayNumber\n          };\n\n          console.log('🔄 API Response data:', {\n            success: result.success,\n            data: result.data,\n            invoiceNo: result.data?.invoiceNo,\n            symbol: result.data?.symbol,\n            templateNumber: result.data?.templateNumber\n          });\n\n          console.log('🔄 Updating item with data:', updateData);\n\n          // Update invoice/order with published status and invoice details\n          const updateResponse = await apiRequest(\"PUT\", updateEndpoint, updateData);\n\n          if (updateResponse.ok) {\n            const updatedItem = await updateResponse.json();\n            console.log('✅ Update response:', updatedItem);\n\n            // Update local state\n            setSelectedInvoice({\n              ...selectedInvoice,\n              einvoiceStatus: 1,\n              invoiceStatus: 1,\n              status: 'published',\n              invoiceNumber: invoiceNo || selectedInvoice.invoiceNumber,\n              symbol: symbol,\n              templateNumber: templateNumber,\n              tradeNumber: invoiceNo || selectedInvoice.tradeNumber\n            });\n\n            // Refresh data to ensure consistency\n            queryClient.invalidateQueries({ queryKey: [\"/api/invoices\"] });\n            queryClient.invalidateQueries({ queryKey: [\"/api/orders\"] });\n\n            console.log('✅ Invoice/Order updated successfully with published status');\n\n            alert(`Hóa đơn điện tử đã được phát hành thành công!\\nSố hóa đơn: ${invoiceNo || 'N/A'}\\nKý hiệu: ${symbol || 'N/A'}`);\n          } else {\n            const errorText = await updateResponse.text();\n            console.error('❌ Failed to update invoice/order:', {\n              status: updateResponse.status,\n              statusText: updateResponse.statusText,\n              error: errorText,\n              updateData: updateData\n            });\n\n            // Try to parse error as JSON for more details\n            try {\n              const errorJson = JSON.parse(errorText);\n              console.error('❌ Detailed error:', errorJson);\n              alert(`Hóa đơn đã phát hành nhưng không thể cập nhật trạng thái: ${errorJson.error || errorJson.message || 'Lỗi không xác định'}`);\n            } catch (parseError) {\n              alert(`Hóa đơn đã phát hành nhưng không thể cập nhật trạng thái: ${errorText || 'Lỗi kết nối database'}`);\n            }\n          }\n        } catch (error) {\n          console.error('❌ Error updating invoice/order after publish:', {\n            error: error,\n            message: error?.message,\n            stack: error?.stack\n          });\n\n          const errorMessage = error?.message || error?.toString() || 'Lỗi không xác định';\n          alert(`Hóa đơn đã phát hành nhưng không thể cập nhật trạng thái: ${errorMessage}`);\n        }\n      } else {\n        alert(`Lỗi phát hành hóa đơn: ${result.message || 'Không xác định'}`);\n      }\n    },\n    onError: (error) => {\n      console.error('❌ Error publishing invoice:', error);\n      alert(`Lỗi phát hành hóa đơn: ${error.message}`);\n    }\n  });\n\n  // Mutation for canceling invoice or order\n  const cancelInvoiceMutation = useMutation({\n    mutationFn: async (item: { id: number, type: string }) => {\n      try {\n        let response;\n\n        if (item.type === 'order') {\n          // For orders, update status to 'cancelled'\n          response = await apiRequest(\"PUT\", `/api/orders/${item.id}/status`, { \n            status: \"cancelled\"\n          });\n        } else {\n          // For invoices, update both invoiceStatus and invoice_status to 3 (Đã hủy)\n          response = await apiRequest(\"PUT\", `/api/invoices/${item.id}`, { \n            invoiceStatus: 3, // 3 = Đã hủy\n            invoice_status: 3, // 3 = Đã hủy (database column)\n            status: 'cancelled' // Also update general status\n          });\n        }\n\n        if (!response.ok) {\n          let errorMessage = `HTTP ${response.status}`;\n          try {\n            const errorData = await response.text();\n            errorMessage = errorData || errorMessage;\n          } catch (textError) {\n            console.error('Could not parse error response:', textError);\n          }\n          throw new Error(`Không thể hủy đơn hàng: ${errorMessage}`);\n        }\n\n        // Try to parse JSON response, but don't fail if it's not JSON\n        try {\n          const contentType = response.headers.get('content-type');\n          if (contentType && contentType.includes('application/json')) {\n            return await response.json();\n          } else {\n            return { success: true, message: 'Order cancelled successfully' };\n          }\n        } catch (jsonError) {\n          console.warn('Response is not valid JSON, but request was successful:', jsonError);\n          return { success: true, message: 'Order cancelled successfully' };\n        }\n      } catch (error) {\n        console.error('Cancel order/invoice error:', error);\n        throw error;\n      }\n    },\n    onSuccess: (data, item) => {\n      console.log('Order/Invoice cancelled successfully:', item);\n\n      // 1. Đóng dialog xác nhận\n      setShowCancelDialog(false);\n\n      // 2. Refresh danh sách hóa đơn và đơn hàng\n      queryClient.invalidateQueries({ queryKey: [\"/api/invoices\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/orders\"] });\n\n      // 3. Cập nhật trạng thái của selectedInvoice nếu đang hiển thị\n      if (selectedInvoice && selectedInvoice.id === item.id && selectedInvoice.type === item.type) {\n        setSelectedInvoice({\n          ...selectedInvoice,\n          invoiceStatus: 3, // Đã hủy\n          invoice_status: 3, // Đã hủy (database column)\n          displayStatus: 3,\n          status: item.type === 'order' ? 'cancelled' : selectedInvoice.status\n        });\n\n        // Reset editing states\n        setIsEditing(false);\n        setEditableInvoice(null);\n      }\n\n      console.log('Order/Invoice cancelled and status updated');\n    },\n    onError: (error) => {\n      console.error('Error canceling invoice:', error);\n      setShowCancelDialog(false);\n      // Could add toast notification here\n      alert(`Lỗi hủy đơn hàng: ${error.message}`);\n    },\n  });\n\n  const getPaymentMethodName = (method: number | string) => {\n    switch (method) {\n      case 1:\n      case 'cash':\n        return \"Tiền mặt\";\n      case 2:\n      case 'creditCard':\n      case 'debitCard':\n        return \"Chuyển khoản\";\n      case 3:\n        return \"TM/CK\";\n      case 4:\n      case 'qrCode':\n      case 'momo':\n      case 'zalopay':\n      case 'vnpay':\n      case 'grabpay':\n        return \"QR Code InfoCAMS\";\n      case 'Đối trừ công nợ': // Assuming this might come from order data\n        return \"Đối trừ công nợ\";\n      default:\n        return \"Tiền mặt\"; // Default to cash if unknown\n    }\n  };\n\n  const getStatusBadge = (status: string) => {\n    const statusColors = {\n      draft: \"bg-gray-100 text-gray-800\",\n      published: \"bg-green-100 text-green-800\",\n      cancelled: \"bg-red-100 text-red-800\",\n    };\n\n    const statusLabels = {\n      draft: \"Nháp\",\n      published: \"Đã xuất\",\n      cancelled: \"Đã hủy\",\n    };\n\n    return (\n      <Badge className={statusColors[status as keyof typeof statusColors] || statusColors.draft}>\n        {statusLabels[status as keyof typeof statusLabels] || status}\n      </Badge>\n    );\n  };\n\n  const getEInvoiceStatusBadge = (status: number) => {\n    const statusLabels = {\n      0: \"Chưa phát hành\",\n      1: \"Đã phát hành\",\n      2: \"Tạo nháp\",\n      3: \"Đã duyệt\",\n      4: \"Đã bị thay thế (hủy)\",\n      5: \"Thay thế tạm\",\n      6: \"Thay thế\",\n      7: \"Đã bị điều chỉnh\",\n      8: \"Điều chỉnh tạm\",\n      9: \"Điều chỉnh\",\n      10: \"Đã hủy\",\n    };\n\n    const statusColors = {\n      0: \"bg-gray-100 text-gray-800\",\n      1: \"bg-green-100 text-green-800\",\n      2: \"bg-blue-100 text-blue-800\",\n      3: \"bg-green-100 text-green-800\",\n      4: \"bg-red-100 text-red-800\",\n      5: \"bg-yellow-100 text-yellow-800\",\n      6: \"bg-green-100 text-green-800\",\n      7: \"bg-orange-100 text-orange-800\",\n      8: \"bg-yellow-100 text-yellow-800\",\n      9: \"bg-orange-100 text-orange-800\",\n      10: \"bg-red-100 text-red-800\",\n    };\n\n    return (\n      <Badge className={statusColors[status as keyof typeof statusColors] || statusColors[0]}>\n        {statusLabels[status as keyof typeof statusLabels] || \"Không xác định\"}\n      </Badge>\n    );\n  };\n\n  const getInvoiceStatusBadge = (status: number) => {\n    const statusLabels = {\n      1: \"Hoàn thành\",\n      2: \"Đang phục vụ\", \n      3: \"Đã hủy\",\n    };\n\n    const statusColors = {\n      1: \"bg-green-100 text-green-800\",\n      2: \"bg-blue-100 text-blue-800\",\n      3: \"bg-red-100 text-red-800\",\n    };\n\n    return (\n      <Badge className={statusColors[status as keyof typeof statusColors] || statusColors[1]}>\n        {statusLabels[status as keyof typeof statusColors] || \"Hoàn thành\"}\n      </Badge>\n    );\n  };\n\n  // Combine invoices and orders data with safe array checks\n  const combinedData = [\n    ...(Array.isArray(invoices) ? invoices.map((invoice: Invoice) => ({\n      ...invoice,\n      type: 'invoice' as const,\n      date: invoice.invoiceDate,\n      displayNumber: invoice.tradeNumber || invoice.invoiceNumber || `INV-${String(invoice.id).padStart(13, '0')}`,\n      displayStatus: invoice.invoiceStatus || 1,\n      // Ensure all required fields are present\n      customerName: invoice.customerName || 'Khách hàng lẻ',\n      customerPhone: invoice.customerPhone || '',\n      customerAddress: invoice.customerAddress || '',\n      customerTaxCode: invoice.customerTaxCode || '',\n      symbol: invoice.symbol || invoice.templateNumber || '',\n      einvoiceStatus: invoice.einvoiceStatus || 0\n    })) : []),\n    ...(Array.isArray(orders) ? orders.map((order: Order) => ({\n      ...order,\n      type: 'order' as const,\n      date: order.orderedAt,\n      displayNumber: order.orderNumber || `ORD-${String(order.id).padStart(13, '0')}`,\n      displayStatus: order.status === 'paid' ? 1 : order.status === 'pending' ? 2 : order.status === 'cancelled' ? 3 : 2,\n      customerName: order.customerName || 'Khách hàng lẻ',\n      invoiceStatus: order.status === 'paid' ? 1 : order.status === 'pending' ? 2 : order.status === 'cancelled' ? 3 : 2,\n      // Map order fields to invoice-like fields for consistency\n      customerPhone: '',\n      customerAddress: '',\n      customerTaxCode: '',\n      symbol: order.symbol || order.templateNumber || '',\n      invoiceNumber: order.orderNumber || `ORD-${String(order.id).padStart(8, '0')}`,\n      tradeNumber: order.orderNumber || '',\n      invoiceDate: order.orderedAt,\n      einvoiceStatus: order.einvoiceStatus || 0\n    })) : [])\n  ];\n\n  const filteredInvoices = Array.isArray(combinedData) ? combinedData.filter((item: any) => {\n    try {\n      if (!item || !item.date) return false;\n\n      const itemDate = new Date(item.date);\n      if (isNaN(itemDate.getTime())) return false;\n\n      const start = new Date(startDate);\n      const end = new Date(endDate);\n      end.setHours(23, 59, 59, 999);\n\n      const dateMatch = itemDate >= start && itemDate <= end;\n      const customerMatch = !customerSearch || \n        (item.customerName && item.customerName.toLowerCase().includes(customerSearch.toLowerCase()));\n      const orderMatch = !orderNumberSearch || \n        (item.displayNumber && item.displayNumber.toLowerCase().includes(orderNumberSearch.toLowerCase()));\n      const customerCodeMatch = !customerCodeSearch || \n        (item.customerTaxCode && item.customerTaxCode.toLowerCase().includes(customerCodeSearch.toLowerCase()));\n\n      return dateMatch && customerMatch && orderMatch && customerCodeMatch;\n    } catch (error) {\n      console.error('Error filtering item:', item, error);\n      return false;\n    }\n  }) : [];\n\n  const formatCurrency = (amount: string | number | undefined | null): string => {\n    const num = typeof amount === 'string' ? parseFloat(amount) : amount;\n    if (typeof num !== 'number' || isNaN(num)) {\n      return '0';\n    }\n    // Always round to integer and format without decimals\n    return Math.floor(num).toLocaleString('vi-VN');\n  };\n\n  const formatDate = (dateStr: string | undefined | null): string => {\n    if (!dateStr) return '';\n    try {\n      return new Date(dateStr).toLocaleDateString('vi-VN', {\n        day: '2-digit',\n        month: '2-digit',\n        year: 'numeric'\n      });\n    } catch (error) {\n      console.error('Error formatting date:', dateStr, error);\n      return '';\n    }\n  };\n\n  const handleEditInvoice = () => {\n    if (selectedInvoice) {\n      setEditableInvoice({ ...selectedInvoice });\n      setIsEditing(true);\n    }\n  };\n\n  const handleSaveInvoice = () => {\n    if (editableInvoice) {\n      updateInvoiceMutation.mutate(editableInvoice);\n    }\n  };\n\n  const handleCancelEdit = () => {\n    setIsEditing(false);\n    setEditableInvoice(null);\n  };\n\n  const updateEditableInvoiceField = (field: keyof Invoice | 'orderedAt' | 'orderNumber' | 'customerName' | 'customerPhone' | 'customerAddress' | 'symbol' | 'invoiceNumber' | 'notes', value: any) => {\n    if (editableInvoice) {\n      setEditableInvoice({\n        ...editableInvoice,\n        [field]: value\n      });\n    }\n  };\n\n\n\n  const calculateTotals = () => {\n    const totals = filteredInvoices.reduce((acc, item) => {\n      acc.subtotal += parseFloat(item.subtotal || '0');\n      acc.tax += parseFloat(item.tax || '0');\n      acc.total += parseFloat(item.total || '0');\n      return acc;\n    }, { subtotal: 0, tax: 0, total: 0 });\n\n    return totals;\n  };\n\n  // Helper functions for checkbox selection\n  const handleSelectOrder = (orderId: number, orderType: string, checked: boolean) => {\n    const orderKey = `${orderType}-${orderId}`;\n    const newSelectedIds = new Set(selectedOrderIds);\n\n    if (checked) {\n      newSelectedIds.add(orderKey);\n    } else {\n      newSelectedIds.delete(orderKey);\n    }\n\n    setSelectedOrderIds(newSelectedIds);\n  };\n\n  const handleSelectAll = (checked: boolean) => {\n    if (checked) {\n      const allOrderKeys = filteredInvoices.map(item => `${item.type}-${item.id}`);\n      setSelectedOrderIds(new Set(allOrderKeys));\n    } else {\n      setSelectedOrderIds(new Set());\n    }\n  };\n\n  const isOrderSelected = (orderId: number, orderType: string) => {\n    return selectedOrderIds.has(`${orderType}-${orderId}`);\n  };\n\n  const isAllSelected = filteredInvoices.length > 0 && selectedOrderIds.size === filteredInvoices.length;\n  const isIndeterminate = selectedOrderIds.size > 0 && selectedOrderIds.size < filteredInvoices.length;\n\n  // Function to export selected orders to Excel\n  const exportSelectedOrdersToExcel = () => {\n    if (selectedOrderIds.size === 0) {\n      alert('Vui lòng chọn ít nhất một đơn hàng để xuất Excel');\n      return;\n    }\n\n    // Get selected orders\n    const selectedOrders = filteredInvoices.filter(item => \n      selectedOrderIds.has(`${item.type}-${item.id}`)\n    );\n\n    // Create workbook first\n    const wb = XLSX.utils.book_new();\n\n    // Create worksheet with empty data first\n    const ws = XLSX.utils.aoa_to_sheet([]);\n\n    // Set default font for entire sheet\n    ws['!defaultFont'] = { name: 'Times New Roman', sz: 11 };\n\n    // Add title row (A1)\n    XLSX.utils.sheet_add_aoa(ws, [['DANH SÁCH ĐƠN HÀNG BÁN']], { origin: 'A1' });\n\n    // Merge title cells A1:O1\n    if (!ws['!merges']) ws['!merges'] = [];\n    ws['!merges'].push({ s: { r: 0, c: 0 }, e: { r: 0, c: 14 } });\n\n    // Add empty row for spacing\n    XLSX.utils.sheet_add_aoa(ws, [[]], { origin: 'A2' });\n\n    // Add header row at A3\n    const headers = [\n      'Số đơn bán', 'Ngày đơn bán', 'Bàn', 'Mã khách hàng', 'Tên khách hàng',\n      'Thành tiền', 'Giảm giá', 'Tiền thuế', 'Đã thanh toán',\n      'Mã nhân viên', 'Tên nhân viên', 'Ký hiệu hóa đơn', 'Số hóa đơn', 'Ghi chú', 'Trạng thái'\n    ];\n    XLSX.utils.sheet_add_aoa(ws, [headers], { origin: 'A3' });\n\n    // Add data rows starting from A4\n    const dataRows = selectedOrders.map((item, index) => {\n      const orderNumber = item.tradeNumber || item.invoiceNumber || item.orderNumber || `DB${new Date().getFullYear()}${String(item.id).padStart(6, '0')}`;\n      const orderDate = formatDate(item.date);\n      // Only show table info for orders, leave empty for invoices\n      const table = item.type === 'order' && item.tableId ? `Bàn ${item.tableId}` : '';\n      const customerCode = item.customerTaxCode || `KH000${String(index + 1).padStart(3, '0')}`;\n      const customerName = item.customerName || 'Khách lẻ';\n      const subtotal = parseFloat(item.subtotal || '0');\n      const discount = 0;\n      const tax = parseFloat(item.tax || '0');\n      const total = parseFloat(item.total || '0');\n      const paid = total;\n      const employeeCode = item.employeeId || 'NV0001';\n      const employeeName = 'Phạm Vân Duy';\n      const symbol = item.symbol || '';\n      const invoiceNumber = item.invoiceNumber || String(item.id).padStart(8, '0');\n      const status = item.displayStatus === 1 ? 'Đã hoàn thành' : \n                   item.displayStatus === 2 ? 'Đang phục vụ' : 'Đã hủy';\n\n      return [\n        orderNumber, orderDate, table, customerCode, customerName,\n        subtotal, discount, tax, paid,\n        employeeCode, employeeName, symbol, invoiceNumber, item.notes || '', status\n      ];\n    });\n\n    XLSX.utils.sheet_add_aoa(ws, dataRows, { origin: 'A4' });\n\n    // Set column widths\n    ws['!cols'] = [\n      { wch: 15 }, { wch: 13 }, { wch: 8 }, { wch: 12 }, { wch: 15 },\n      { wch: 12 }, { wch: 10 }, { wch: 10 }, { wch: 12 },\n      { wch: 12 }, { wch: 15 }, { wch: 12 }, { wch: 12 }, { wch: 20 }, { wch: 12 }\n    ];\n\n    // Set row heights\n    ws['!rows'] = [\n      { hpt: 25 }, // Title row\n      { hpt: 15 }, // Empty row  \n      { hpt: 20 }, // Header row\n      ...Array(selectedOrders.length).fill({ hpt: 18 }) // Data rows\n    ];\n\n    // Apply styles to all cells\n    const range = XLSX.utils.decode_range(ws['!ref'] || 'A1:O1');\n\n    // Style title cell (A1)\n    if (ws['A1']) {\n      ws['A1'].s = {\n        font: { name: 'Times New Roman', sz: 16, bold: true, color: { rgb: '000000' } },\n        alignment: { horizontal: 'center', vertical: 'center' },\n        fill: { patternType: 'solid', fgColor: { rgb: 'FFFFFF' } }\n      };\n    }\n\n    // Style header row (row 3)\n    for (let col = 0; col <= 14; col++) {\n      const cellAddress = XLSX.utils.encode_cell({ r: 2, c: col });\n      if (ws[cellAddress]) {\n        ws[cellAddress].s = {\n          font: { name: 'Times New Roman', sz: 11, bold: true, color: { rgb: 'FFFFFF' } },\n          fill: { patternType: 'solid', fgColor: { rgb: '92D050' } },\n          alignment: { horizontal: 'center', vertical: 'center' },\n          border: {\n            top: { style: 'thin', color: { rgb: '000000' } },\n            bottom: { style: 'thin', color: { rgb: '000000' } },\n            left: { style: 'thin', color: { rgb: '000000' } },\n            right: { style: 'thin', color: { rgb: '000000' } }\n          }\n        };\n      }\n    }\n\n    // Style data rows (starting from row 4)\n    for (let row = 3; row < 3 + selectedOrders.length; row++) {\n      const isEven = (row - 3) % 2 === 0;\n      const bgColor = isEven ? 'FFFFFF' : 'F2F2F2';\n\n      for (let col = 0; col <= 14; col++) {\n        const cellAddress = XLSX.utils.encode_cell({ r: row, c: col });\n        const isCurrency = [5, 6, 7, 8].includes(col); // Columns F, G, H, I\n\n        if (ws[cellAddress]) {\n          ws[cellAddress].s = {\n            font: { name: 'Times New Roman', sz: 11, color: { rgb: '000000' } },\n            fill: { patternType: 'solid', fgColor: { rgb: bgColor } },\n            alignment: { \n              horizontal: isCurrency ? 'right' : 'center', \n              vertical: 'center' \n            },\n            border: {\n              top: { style: 'thin', color: { rgb: 'BFBFBF' } },\n              bottom: { style: 'thin', color: { rgb: 'BFBFBF' } },\n              left: { style: 'thin', color: { rgb: 'BFBFBF' } },\n              right: { style: 'thin', color: { rgb: 'BFBFBF' } }\n            }\n          };\n\n          // Apply number format for currency columns\n          if (isCurrency && typeof ws[cellAddress].v === 'number') {\n            ws[cellAddress].z = '#,##0';\n          }\n        }\n      }\n    }\n\n    // Add worksheet to workbook\n    XLSX.utils.book_append_sheet(wb, ws, 'Danh sách đơn hàng');\n\n    // Set workbook properties\n    wb.Props = {\n      Title: \"Danh sách đơn hàng bán\",\n      Subject: \"Báo cáo đơn hàng\", \n      Author: \"EDPOS System\",\n      CreatedDate: new Date()\n    };\n\n    // Generate filename with timestamp\n    const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');\n    const defaultFilename = `danh-sach-don-hang-ban_${timestamp}.xlsx`;\n\n    // Write file with proper options for styling\n    try {\n      XLSX.writeFile(wb, defaultFilename, { \n        bookType: 'xlsx',\n        cellStyles: true,\n        sheetStubs: false,\n        compression: true\n      });\n\n      console.log('✅ Excel file exported successfully with Times New Roman formatting');\n      alert('File Excel đã được xuất thành công với định dạng Times New Roman!');\n    } catch (error) {\n      console.error('❌ Error exporting Excel file:', error);\n      // Fallback export without advanced formatting\n      XLSX.writeFile(wb, defaultFilename, { bookType: 'xlsx' });\n      alert('File Excel đã được xuất nhưng có thể thiếu một số định dạng.');\n    }\n  };\n\n  const totals = calculateTotals();\n\n  return (\n    <div className=\"min-h-screen bg-green-50\">\n      <RightSidebar />\n\n      <div className=\"main-content p-6\">\n        <div className=\"max-w-full mx-auto\">\n          {/* Header */}\n          <div className=\"mb-6\">\n            <div className=\"flex items-center gap-2 mb-4\">\n              <FileText className=\"w-6 h-6 text-green-600\" />\n              <h1 className=\"text-2xl font-bold text-gray-800\">Danh sách đơn hàng bán</h1>\n            </div>\n          </div>\n\n          {/* Filters */}\n          <Card className=\"mb-6\">\n            <CardHeader>\n              <CardTitle className=\"text-lg\">Bộ lọc</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium mb-2\">Từ ngày</label>\n                  <Input\n                    type=\"date\"\n                    value={startDate}\n                    onChange={(e) => setStartDate(e.target.value)}\n                  />\n                </div>\n                <div>\n                  <label className=\"block text-sm font-medium mb-2\">Đến ngày</label>\n                  <Input\n                    type=\"date\"\n                    value={endDate}\n                    onChange={(e) => setEndDate(e.target.value)}\n                  />\n                </div>\n                <div>\n                  <label className=\"block text-sm font-medium mb-2\">Khách hàng</label>\n                  <Input\n                    placeholder=\"Tìm theo tên khách hàng\"\n                    value={customerSearch}\n                    onChange={(e) => setCustomerSearch(e.target.value)}\n                    className=\"w-full\"\n                  />\n                </div>\n                <div>\n                  <label className=\"block text-sm font-medium mb-2\">Khách viên</label>\n                  <Input\n                    placeholder=\"Tìm theo số hóa đơn\"\n                    value={orderNumberSearch}\n                    onChange={(e) => setOrderNumberSearch(e.target.value)}\n                    className=\"w-full\"\n                  />\n                </div>\n              </div>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4\">\n                <div>\n                  <label className=\"block text-sm font-medium mb-2\">Số đơn bán</label>\n                  <Input\n                    placeholder=\"Tìm theo số đơn bán\"\n                    value={orderNumberSearch}\n                    onChange={(e) => setOrderNumberSearch(e.target.value)}\n                    className=\"w-full\"\n                  />\n                </div>\n                <div>\n                  <label className=\"block text-sm font-medium mb-2\">Mã khách hàng</label>\n                  <Input\n                    placeholder=\"Tìm theo mã khách hàng\"\n                    value={customerCodeSearch}\n                    onChange={(e) => setCustomerCodeSearch(e.target.value)}\n                    className=\"w-full\"\n                  />\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <div className=\"grid grid-cols-1 gap-6\">\n            {/* Invoices List */}\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center justify-between\">\n                  <CardTitle className=\"text-lg\">Danh sách đơn hàng</CardTitle>\n                  <div className=\"flex gap-2\">\n                    <Button \n                      size=\"sm\" \n                      variant=\"outline\" \n                      className=\"flex items-center gap-2 border-red-500 text-red-600 hover:bg-red-50\"\n                      disabled={selectedOrderIds.size === 0}\n                      onClick={() => setShowBulkCancelDialog(true)}\n                    >\n                      <X className=\"w-4 h-4\" />\n                      Hủy đơn ({selectedOrderIds.size})\n                    </Button>\n                    <Button \n                      size=\"sm\" \n                      variant=\"outline\" \n                      className=\"flex items-center gap-2 border-green-500 text-green-600 hover:bg-green-50\"\n                      disabled={selectedOrderIds.size === 0}\n                      onClick={exportSelectedOrdersToExcel}\n                    >\n                      <Download className=\"w-4 h-4\" />\n                      Xuất excel ({selectedOrderIds.size})\n                    </Button>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                {isLoading ? (\n                  <div className=\"text-center py-8\">\n                    <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto\"></div>\n                    <p className=\"mt-2 text-gray-500\">Đang tải...</p>\n                  </div>\n                ) : hasError ? (\n                  <div className=\"text-center py-8\">\n                    <div className=\"text-red-500 mb-4\">\n                      <X className=\"w-8 h-8 mx-auto mb-2\" />\n                      <p className=\"font-medium\">Lỗi kết nối cơ sở dữ liệu</p>\n                    </div>\n                    <p className=\"text-gray-500 mb-4\">Không thể tải dữ liệu đơn hàng. Vui lòng thử lại.</p>\n                    <Button onClick={() => {\n                      queryClient.invalidateQueries({ queryKey: [\"/api/invoices\"] });\n                      queryClient.invalidateQueries({ queryKey: [\"/api/orders\"] });\n                    }}>\n                      Thử lại\n                    </Button>\n                  </div>\n                ) : (\n                  <div>\n                    {/* Table with horizontal scroll similar to settings page */}\n                    <div className=\"w-full overflow-x-auto border rounded-md bg-white\">\n                    <table className=\"w-full min-w-[1600px] table-fixed\">\n                      <thead>\n                        <tr className=\"bg-gray-50 border-b\">\n                          <th className=\"w-[50px] px-3 py-3 text-center font-medium text-sm text-gray-600\">\n                            <Checkbox\n                              checked={isAllSelected}\n                              ref={(el) => {\n                                if (el) el.indeterminate = isIndeterminate;\n                              }}\n                              onCheckedChange={handleSelectAll}\n                            />\n                          </th>\n                          <th className=\"w-[120px] px-3 py-3 text-left font-medium text-sm text-gray-600\">\n                            <div className=\"leading-tight\">Số đơn bán</div>\n                          </th>\n                          <th className=\"w-[100px] px-3 py-3 text-left font-medium text-sm text-gray-600\">\n                            <div className=\"leading-tight\">Ngày đơn bán</div>\n                          </th>\n                          <th className=\"w-[60px] px-3 py-3 text-left font-medium text-sm text-gray-600\">\n                            <div className=\"leading-tight\">Bàn</div>\n                          </th>\n                          <th className=\"w-[120px] px-3 py-3 text-left font-medium text-sm text-gray-600\">\n                            <div className=\"leading-tight\">Mã khách hàng</div>\n                          </th>\n                          <th className=\"w-[150px] px-3 py-3 text-left font-medium text-sm text-gray-600\">\n                            <div className=\"leading-tight\">Tên khách hàng</div>\n                          </th>\n                          <th className=\"w-[100px] px-3 py-3 text-right font-medium text-sm text-gray-600\">\n                            <div className=\"leading-tight\">Thành tiền</div>\n                          </th>\n                          <th className=\"w-[80px] px-3 py-3 text-right font-medium text-sm text-gray-600\">\n                            <div className=\"leading-tight\">Giảm giá</div>\n                          </th>\n                          <th className=\"w-[90px] px-3 py-3 text-right font-medium text-sm text-gray-600\">\n                            <div className=\"leading-tight\">Tiền thuế</div>\n                          </th>\n                          <th className=\"w-[110px] px-3 py-3 text-right font-medium text-sm text-gray-600\">\n                            <div className=\"leading-tight\">Đã thanh toán</div>\n                          </th>\n                          <th className=\"w-[110px] px-3 py-3 text-left font-medium text-sm text-gray-600\">\n                            <div className=\"leading-tight\">Mã nhân viên</div>\n                          </th>\n                          <th className=\"w-[120px] px-3 py-3 text-left font-medium text-sm text-gray-600\">\n                            <div className=\"leading-tight\">Tên nhân viên</div>\n                          </th>\n                          <th className=\"w-[120px] px-3 py-3 text-left font-medium text-sm text-gray-600\">\n                            <div className=\"leading-tight\">Ký hiệu hóa đơn</div>\n                          </th>\n                          <th className=\"w-[110px] px-3 py-3 text-left font-medium text-sm text-gray-600\">\n                            <div className=\"leading-tight\">Số hóa đơn</div>\n                          </th>\n                          <th className=\"w-[200px] px-3 py-3 text-left font-medium text-sm text-gray-600\">\n                            <div className=\"leading-tight\">Ghi chú</div>\n                          </th>\n                          <th className=\"w-[100px] px-3 py-3 text-center font-medium text-sm text-gray-600\">\n                            <div className=\"leading-tight\">Trạng thái</div>\n                          </th>\n                        </tr>\n                      </thead>\n                      <tbody className=\"divide-y\">\n                        {filteredInvoices.length === 0 ? (\n                          <tr>\n                            <td colSpan={16} className=\"p-8 text-center text-sm text-gray-500\">\n                              <div className=\"flex flex-col items-center gap-2\">\n                                <FileText className=\"w-8 h-8 text-gray-400\" />\n                                <p>Không có đơn hàng nào</p>\n                                <p className=\"text-xs\">Thử thay đổi bộ lọc để xem kết quả khác</p>\n                              </div>\n                            </td>\n                          </tr>\n                        ) : (\n                      filteredInvoices.map((item, index) => {\n                            const customerCode = item.customerTaxCode || `KH000${String(index + 1).padStart(3, '0')}`;\n                            const discount = 0; // Giảm giá mặc định là 0\n                            const tax = parseFloat(item.tax || '0');\n                            const subtotal = parseFloat(item.subtotal || '0');\n                            const total = parseFloat(item.total || '0');\n                            const paid = total; // Đã thanh toán = tổng tiền\n                            const employeeCode = item.employeeId || 'NV0001';\n                            const employeeName = 'Phạm Vân Duy';\n                            const symbol = item.symbol || '';\n                            const invoiceNumber = item.invoiceNumber || String(item.id).padStart(8, '0');\n                            const notes = item.notes || '';\n\n                            // Lấy symbol từ dữ liệu gốc của item\n                            const itemSymbol = item.symbol || item.templateNumber || '';\n\n                            return (\n                              <>\n                                <tr\n                                  key={`${item.type}-${item.id}`}\n                                  className={`hover:bg-gray-50 ${\n                                    selectedInvoice?.id === item.id && selectedInvoice?.type === item.type ? 'bg-blue-100' : ''\n                                  }`}\n                                  onClick={() => {\n                                    const itemWithType = {\n                                      ...item,\n                                      type: item.type || (item.orderNumber ? 'order' : 'invoice')\n                                    };\n                                    setSelectedInvoice(itemWithType);\n                                  }}\n                                >\n                                  <td className=\"px-3 py-3 text-center\">\n                                    <Checkbox\n                                      checked={isOrderSelected(item.id, item.type)}\n                                      onCheckedChange={(checked) => handleSelectOrder(item.id, item.type, checked as boolean)}\n                                      onClick={(e) => e.stopPropagation()}\n                                    />\n                                  </td>\n                                  <td className=\"px-3 py-3\">\n                                    <div className=\"font-medium truncate\" title={item.displayNumber}>\n                                      {item.displayNumber}\n                                    </div>\n                                  </td>\n                                  <td className=\"px-3 py-3\">\n                                    <div className=\"text-sm truncate\">\n                                      {formatDate(item.date)}\n                                    </div>\n                                  </td>\n                                  <td className=\"px-3 py-3\">\n                                    <div className=\"text-sm\">\n                                      {getItemType(item) === 'order' && item.tableId ? `Bàn ${item.tableId}` : ''}\n                                    </div>\n                                  </td>\n                                  <td className=\"px-3 py-3\">\n                                    <div className=\"text-sm font-mono truncate\" title={customerCode}>\n                                      {customerCode}\n                                    </div>\n                                  </td>\n                                  <td className=\"px-3 py-3\">\n                                    <div className=\"text-sm truncate\" title={item.customerName || 'Khách hàng lẻ'}>\n                                      {item.customerName || 'Khách hàng lẻ'}\n                                    </div>\n                                  </td>\n                                  <td className=\"px-3 py-3 text-right\">\n                                    <div className=\"text-sm font-medium\">\n                                      {formatCurrency(subtotal)}\n                                    </div>\n                                  </td>\n                                  <td className=\"px-3 py-3 text-right\">\n                                    <div className=\"text-sm\">\n                                      {formatCurrency(discount)}\n                                    </div>\n                                  </td>\n                                  <td className=\"px-3 py-3 text-right\">\n                                    <div className=\"text-sm\">\n                                      {formatCurrency(tax)}\n                                    </div>\n                                  </td>\n                                  <td className=\"px-3 py-3 text-right\">\n                                    <div className=\"text-sm font-medium\">\n                                      {formatCurrency(paid)}\n                                    </div>\n                                  </td>\n                                  <td className=\"px-3 py-3\">\n                                    <div className=\"text-sm font-mono\">\n                                      {employeeCode}\n                                    </div>\n                                  </td>\n                                  <td className=\"px-3 py-3\">\n                                    <div className=\"text-sm truncate\" title={employeeName}>\n                                      {employeeName}\n                                    </div>\n                                  </td>\n                                  <td className=\"px-3 py-3\">\n                                    <div className=\"text-sm\">\n                                      {itemSymbol || '-'}\n                                    </div>\n                                  </td>\n                                  <td className=\"px-3 py-3\">\n                                    <div className=\"text-sm font-mono\">\n                                      {invoiceNumber}\n                                    </div>\n                                  </td>\n                                  <td className=\"px-3 py-3\">\n                                    <div className=\"text-sm truncate\" title={notes || '-'}>\n                                      {notes || '-'}\n                                    </div>\n                                  </td>\n                                  <td className=\"px-3 py-3 text-center\">\n                                    {getInvoiceStatusBadge(item.displayStatus)}\n                                  </td>\n                                </tr>\n                                {/* Detail row for selected invoice - shown inline under selected row */}\n                                {selectedInvoice && selectedInvoice.id === item.id && selectedInvoice.type === item.type && (\n                                  <tr>\n                                    <td colSpan={16} className=\"p-0\">\n                                      <div className=\"p-4 border-l-4 border-blue-500 bg-gray-50\">\n                                        <Card className=\"shadow-lg\">\n                                          <CardHeader className=\"pb-3\">\n                                            <CardTitle className=\"text-lg text-blue-700\">Chi tiết đơn hàng</CardTitle>\n                                          </CardHeader>\n                                          <CardContent className=\"space-y-4\">\n                                            {/* Invoice Info */}\n                                            <div className=\"bg-white p-4 rounded-lg overflow-x-auto\">\n                                              <div className=\"min-w-[1200px]\">\n                                                <table className=\"w-full text-sm border-collapse\">\n                                                  <tbody>\n                                                    <tr>\n                                                      <td className=\"py-1 pr-4 font-medium whitespace-nowrap\">Số đơn bán:</td>\n                                                      <td className=\"py-1 pr-6 text-blue-600 font-medium\">\n                                                        {isEditing && editableInvoice ? (\n                                                          <Input \n                                                            value={editableInvoice.tradeNumber || editableInvoice.invoiceNumber || editableInvoice.orderNumber || ''}\n                                                            onChange={(e) => updateEditableInvoiceField(getItemType(selectedInvoice) === 'order' ? 'orderNumber' : 'tradeNumber', e.target.value)}\n                                                            className=\"w-32\"\n                                                          />\n                                                        ) : (\n                                                          selectedInvoice.displayNumber\n                                                        )}\n                                                      </td>\n                                                      <td className=\"py-1 pr-4 font-medium whitespace-nowrap\">Ngày:</td>\n                                                      <td className=\"py-1 pr-6\">\n                                                        {isEditing && editableInvoice ? (\n                                                          <Input \n                                                            type=\"date\"\n                                                            value={(editableInvoice.invoiceDate || editableInvoice.orderedAt)?.split('T')[0]}\n                                                            onChange={(e) => updateEditableInvoiceField(getItemType(selectedInvoice) === 'order' ? 'orderedAt' : 'invoiceDate', e.target.value)}\n                                                            className=\"w-32\"\n                                                          />\n                                                        ) : (\n                                                          formatDate(selectedInvoice.date)\n                                                        )}\n                                                      </td>\n                                                      <td className=\"py-1 pr-4 font-medium whitespace-nowrap\">Khách hàng:</td>\n                                                      <td className=\"py-1 pr-6 text-blue-600 font-medium\">\n                                                        {isEditing && editableInvoice ? (\n                                                          <Input \n                                                            value={editableInvoice.customerName}\n                                                            onChange={(e) => updateEditableInvoiceField('customerName', e.target.value)}\n                                                            className=\"w-40\"\n                                                          />\n                                                        ) : (\n                                                          selectedInvoice.customerName\n                                                        )}\n                                                      </td>\n                                                      <td className=\"py-1 pr-4 font-medium whitespace-nowrap\">Điện thoại:</td>\n                                                      <td className=\"py-1 pr-6\">\n                                                        {isEditing && editableInvoice ? (\n                                                          <Input \n                                                            value={editableInvoice.customerPhone || ''}\n                                                            onChange={(e) => updateEditableInvoiceField('customerPhone', e.target.value)}\n                                                            className=\"w-32\"\n                                                          />\n                                                        ) : (\n                                                          selectedInvoice.customerPhone || '-'\n                                                        )}\n                                                      </td>\n                                                      <td className=\"py-1 pr-4 font-medium whitespace-nowrap\">Trạng thái:</td>\n                                                      <td className=\"py-1\">{getInvoiceStatusBadge(selectedInvoice.displayStatus)}</td>\n                                                    </tr>\n                                                    <tr>\n                                                      <td className=\"py-1 pr-4 font-medium whitespace-nowrap\">Thu ngân:</td>\n                                                      <td className=\"py-1 pr-6\">Nguyễn Văn A</td>\n                                                      <td className=\"py-1 pr-4 font-medium whitespace-nowrap\">Hình thức bán:</td>\n                                                      <td className=\"py-1 pr-6\">{getItemType(selectedInvoice) === 'order' ? 'Bán tại bàn' : 'Bán tại cửa hàng'}</td>\n                                                      <td className=\"py-1 pr-4 font-medium whitespace-nowrap\">Bàn:</td>\n                                                      <td className=\"py-1 pr-6\">{getItemType(selectedInvoice) === 'order' && selectedInvoice.tableId ? `Tầng 2 - Bàn ${selectedInvoice.tableId}` : '-'}</td>\n                                                      <td className=\"py-1 pr-4 font-medium whitespace-nowrap\">Ký hiệu hóa đơn:</td>\n                                                      <td className=\"py-1 pr-6\">\n                                                        {isEditing && editableInvoice ? (\n                                                          <Input \n                                                            value={editableInvoice.symbol || ''}\n                                                            onChange={(e) => updateEditableInvoiceField('symbol', e.target.value)}\n                                                            className=\"w-24\"\n                                                          />\n                                                        ) : (\n                                                          selectedInvoice.einvoiceStatus !== 0 ? (selectedInvoice.symbol || '') : '-'\n                                                        )}\n                                                      </td>\n                                                      <td className=\"py-1 pr-4 font-medium whitespace-nowrap\">Số hóa đơn:</td>\n                                                      <td className=\"py-1 pr-6\">\n                                                        {isEditing && editableInvoice ? (\n                                                          <Input \n                                                            value={editableInvoice.invoiceNumber || ''}\n                                                            onChange={(e) => updateEditableInvoiceField('invoiceNumber', e.target.value)}\n                                                            className=\"w-32\"\n                                                          />\n                                                        ) : (\n                                                          selectedInvoice.invoiceNumber || String(selectedInvoice.id).padStart(8, '0')\n                                                        )}\n                                                      </td>\n                                                      <td className=\"py-1 pr-4 font-medium whitespace-nowrap\">Trạng thái HĐ:</td>\n                                                      <td className=\"py-1\">{getEInvoiceStatusBadge(selectedInvoice.einvoiceStatus || 0)}</td>\n                                                    </tr>\n                                                  </tbody>\n                                                </table>\n                                              </div>\n                                            </div>\n\n                                            {/* Invoice/Order Items */}\n                                            <div>\n                                              <h4 className=\"font-medium mb-3\">Danh sách hàng hóa</h4>\n                                              <div className=\"border rounded-lg overflow-hidden\">\n                                                <div className=\"grid grid-cols-12 gap-2 text-xs font-medium text-gray-700 bg-gray-50 p-2\">\n                                                  <div className=\"col-span-1\">STT</div>\n                                                  <div className=\"col-span-3\">Mã hàng</div>\n                                                  <div className=\"col-span-3\">Tên hàng</div>\n                                                  <div className=\"col-span-1\">ĐVT</div>\n                                                  <div className=\"col-span-1\">SL</div>\n                                                  <div className=\"col-span-1\">Đơn giá</div>\n                                                  <div className=\"col-span-1\">Thành tiền</div>\n                                                  <div className=\"col-span-1\">Thuế GTGT</div>\n                                                </div>\n                                                {(() => {\n                                                  const items = getItemType(selectedInvoice) === 'order' ? orderItems : invoiceItems;\n                                                  if (!items || items.length === 0) {\n                                                    return (\n                                                      <div className=\"text-center py-4 text-gray-500 border-t\">\n                                                        Không có sản phẩm nào\n                                                      </div>\n                                                    );\n                                                  }\n                                                  return items.map((item: any, index: number) => (\n                                                    <div key={item.id} className=\"grid grid-cols-12 gap-2 text-xs p-2 border-t\">\n                                                      <div className=\"col-span-1\">{index + 1}</div>\n                                                      <div className=\"col-span-3\">SP{String(item.productId).padStart(3, '0')}</div>\n                                                      <div className=\"col-span-3\">{item.productName}</div>\n                                                      <div className=\"col-span-1\">Cái</div>\n                                                      <div className=\"col-span-1 text-center\">{item.quantity}</div>\n                                                      <div className=\"col-span-1 text-right\">{formatCurrency(item.unitPrice)}</div>\n                                                      <div className=\"col-span-1 text-right\">{formatCurrency(item.total)}</div>\n                                                      <div className=\"col-span-1 text-center\">{item.taxRate || 0}%</div>\n                                                    </div>\n                                                  ));\n                                                })()}\n                                              </div>\n                                            </div>\n\n                                            {/* Summary */}\n                                            <div className=\"bg-blue-50 p-4 rounded-lg\">\n                                              <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                                                <div className=\"space-y-2\">\n                                                  {(() => {\n                                                    // Calculate totals from items with actual tax rates\n                                                    const subtotal = parseFloat(selectedInvoice.subtotal || '0');\n                                                    const tax = parseFloat(selectedInvoice.tax || '0');\n                                                    const discount = 0; \n                                                    const totalPayment = subtotal + tax - discount;\n                                                    return (\n                                                      <>\n                                                        <div className=\"flex justify-between\">\n                                                          <span>Tổng tiền thanh toán:</span>\n                                                          <span className=\"font-bold\">{formatCurrency(totalPayment)}</span>\n                                                        </div>\n                                                        <div className=\"flex justify-between\">\n                                                          <span>Thành tiền:</span>\n                                                          <span className=\"font-bold\">{formatCurrency(subtotal)}</span>\n                                                        </div>\n                                                        <div className=\"flex justify-between text-red-600\">\n                                                          <span>Giảm giá:</span>\n                                                          <span>{formatCurrency(discount)}</span>\n                                                        </div>\n                                                        <div className=\"flex justify-between\">\n                                                          <span>Thuế GTGT:</span>\n                                                          <span className=\"font-bold\">{formatCurrency(tax)}</span>\n                                                        </div>\n                                                      </>\n                                                    );\n                                                  })()}\n                                                </div>\n                                                <div className=\"space-y-2\">\n                                                  {(() => {\n                                                    const isPaid = selectedInvoice.displayStatus === 1 || \n                                                                  selectedInvoice.status === 'paid' || \n                                                                  selectedInvoice.paymentStatus === 'paid';\n                                                    const paidAmount = isPaid ? parseFloat(selectedInvoice.total || '0') : 0;\n                                                    const paymentMethod = selectedInvoice.paymentMethod;\n\n                                                    return (\n                                                      <>\n                                                        <div className=\"flex justify-between\">\n                                                          <span>Khách hàng trả:</span>\n                                                          <span className=\"font-bold\">{formatCurrency(paidAmount)}</span>\n                                                        </div>\n                                                        <div className=\"flex justify-between\">\n                                                          <span>Tiền mặt:</span>\n                                                          <span className=\"font-bold\">\n                                                            {isPaid && paymentMethod === 1 ? formatCurrency(paidAmount) : '0'}\n                                                          </span>\n                                                        </div>\n                                                        <div className=\"flex justify-between\">\n                                                          <span>Chuyển khoản:</span>\n                                                          <span className=\"font-bold\">\n                                                            {isPaid && paymentMethod === 2 ? formatCurrency(paidAmount) : '0'}\n                                                          </span>\n                                                        </div>\n                                                        <div className=\"flex justify-between\">\n                                                          <span>QR Code InfoCAMS:</span>\n                                                          <span className=\"font-bold\">\n                                                            {isPaid && paymentMethod === 3 ? formatCurrency(paidAmount) : '0'}\n                                                          </span>\n                                                        </div>\n                                                      </>\n                                                    );\n                                                  })()}\n                                                </div>\n                                              </div>\n                                            </div>\n\n                                            {/* Notes */}\n                                            <div>\n                                              <label className=\"block text-sm font-medium mb-2\">Ghi chú</label>\n                                              {isEditing && editableInvoice ? (\n                                                <textarea\n                                                  value={editableInvoice.notes || ''}\n                                                  onChange={(e) => updateEditableInvoiceField('notes', e.target.value)}\n                                                  className=\"w-full p-3 border rounded min-h-[80px] resize-none\"\n                                                  placeholder=\"Nhập ghi chú...\"\n                                                />\n                                              ) : (\n                                                <div className=\"p-3 bg-gray-50 rounded border min-h-[80px]\">\n                                                  {selectedInvoice.notes || 'Không có ghi chú'}\n                                                </div>\n                                              )}\n                                            </div>\n\n                                            {/* Action Buttons */}\n                                            <div className=\"flex gap-2 pt-4 border-t\">\n                                              <Button \n                                                size=\"sm\" \n                                                className=\"flex items-center gap-2 bg-red-600 hover:bg-red-700 text-white\"\n                                                onClick={() => {\n                                                  if (selectedInvoice && selectedInvoice.invoiceStatus !== 3) {\n                                                    setShowCancelDialog(true);\n                                                  }\n                                                }}\n                                                disabled={selectedInvoice?.invoiceStatus === 3 || cancelInvoiceMutation.isPending}\n                                              >\n                                                <X className=\"w-4 h-4\" />\n                                                {cancelInvoiceMutation.isPending ? 'Đang hủy...' : 'Hủy đơn'}\n                                              </Button>\n                                              {!isEditing ? (\n                                                <>\n                                                  <Button \n                                                    size=\"sm\" \n                                                    variant=\"outline\" \n                                                    className=\"flex items-center gap-2 border-green-500 text-green-600 hover:bg-green-50\"\n                                                    onClick={handleEditInvoice}\n                                                  >\n                                                    <FileText className=\"w-4 h-4\" />\n                                                    Sửa đơn\n                                                  </Button>\n                                                  <Button \n                                                    size=\"sm\" \n                                                    variant=\"outline\" \n                                                    className=\"flex items-center gap-2 border-blue-500 text-blue-600 hover:bg-blue-50\"\n                                                    onClick={() => {\n                                                      if (selectedInvoice) {\n                                                        console.log('Opening E-invoice modal for invoice:', selectedInvoice?.id);\n                                                        console.log('Selected invoice data:', selectedInvoice);\n                                                        setShowEInvoiceModal(true);\n                                                      }\n                                                    }}\n                                                    disabled={selectedInvoice?.einvoiceStatus !== 0}\n                                                  >\n                                                    <Mail className=\"w-4 h-4\" />\n                                                    Phát hành\n                                                  </Button>\n                                                </>\n                                              ) : (\n                                                <>\n                                                  <Button \n                                                    size=\"sm\" \n                                                    variant=\"outline\" \n                                                    className=\"flex items-center gap-2 border-blue-500 text-blue-600 hover:bg-blue-50\"\n                                                    onClick={handleSaveInvoice}\n                                                    disabled={updateInvoiceMutation.isPending}\n                                                  >\n                                                    <Package className=\"w-4 h-4\" />\n                                                    {updateInvoiceMutation.isPending ? 'Đang lưu...' : 'Lưu'}\n                                                  </Button>\n                                                  <Button \n                                                    size=\"sm\" \n                                                    variant=\"outline\" \n                                                    className=\"flex items-center gap-2 border-yellow-500 text-yellow-600 hover:bg-yellow-50\"\n                                                    onClick={handleCancelEdit}\n                                                  >\n                                                    <X className=\"w-4 h-4\" />\n                                                    Hủy sửa\n                                                  </Button>\n                                                </>\n                                              )}\n                                              <Button \n                                                size=\"sm\" \n                                                variant=\"outline\" \n                                                className=\"flex items-center gap-2 border-red-500 text-red-600 hover:bg-red-50\"\n                                                onClick={() => {\n                                                  setSelectedInvoice(null);\n                                                  setIsEditing(false);\n                                                  setEditableInvoice(null);\n                                                }}\n                                              >\n                                                <X className=\"w-4 h-4\" />\n                                                Đóng\n                                              </Button>\n                                            </div>\n                                          </CardContent>\n                                        </Card>\n                                      </div>\n                                    </td>\n                                  </tr>\n                                )}\n                              </>\n                            );\n                          })\n                        )}\n                      </tbody>\n                    </table>\n                    </div>\n                    {/* Pagination controls */}\n                    <div className=\"flex justify-between items-center mt-4\">\n                      <div className=\"flex items-center space-x-2\">\n                        <span className=\"text-sm text-gray-600\">Số hàng mỗi trang:</span>\n                        <select\n                          value={itemsPerPage}\n                          onChange={(e) => {\n                            setItemsPerPage(parseInt(e.target.value, 10));\n                            setCurrentPage(1); // Reset to first page on items per page change\n                          }}\n                          className=\"border rounded p-1 text-sm\"\n                        >\n                          <option value={10}>10</option>\n                          <option value={20}>20</option>\n                          <option value={50}>50</option>\n                          <option value={100}>100</option>\n                        </select>\n                      </div>\n                      <div className=\"flex items-center space-x-2\">\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => setCurrentPage((prev) => Math.max(prev - 1, 1))}\n                          disabled={currentPage === 1}\n                        >\n                          Trước\n                        </Button>\n                        <span className=\"text-sm text-gray-600\">\n                          Trang {currentPage} / {Math.ceil(filteredInvoices.length / itemsPerPage) || 1}\n                        </span>\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => setCurrentPage((prev) => Math.min(prev + 1, Math.ceil(filteredInvoices.length / itemsPerPage) || 1))}\n                          disabled={currentPage >= (Math.ceil(filteredInvoices.length / itemsPerPage) || 1)}\n                        >\n                          Sau\n                        </Button>\n                      </div>\n                    </div>\n                  </div>\n                )}\n\n                {/* Totals */}\n                <div className=\"mt-4 pt-4 border-t bg-blue-50 p-3 rounded\">\n                  <div className=\"grid grid-cols-3 gap-4 text-sm\">\n                    <div>\n                      <span className=\"font-medium\">Tổng tiền hàng:</span>\n                      <div className=\"font-bold text-blue-600\">{formatCurrency(totals.subtotal)}</div>\n                    </div>\n                    <div>\n                      <span className=\"font-medium\">Tổng thuế:</span>\n                      <div className=\"font-bold text-orange-600\">{formatCurrency(totals.tax)}</div>\n                    </div>\n                    <div>\n                      <span className=\"font-medium\">Tổng cộng:</span>\n                      <div className=\"font-bold text-green-600\">{formatCurrency(totals.total)}</div>\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </div>\n\n      {/* Bulk Cancel Orders Confirmation Dialog */}\n      <AlertDialog open={showBulkCancelDialog} onOpenChange={setShowBulkCancelDialog}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Hủy đơn hàng bán</AlertDialogTitle>\n            <AlertDialogDescription>\n              Bạn có chắc muốn hủy {selectedOrderIds.size} đơn hàng đã chọn không? Hành động này không thể hoàn tác.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Bỏ qua</AlertDialogCancel>\n            <AlertDialogAction \n              onClick={() => {\n                const orderKeys = Array.from(selectedOrderIds);\n                bulkCancelOrdersMutation.mutate(orderKeys);\n              }}\n              disabled={bulkCancelOrdersMutation.isPending}\n              className=\"bg-red-600 hover:bg-red-700\"\n            >\n              {bulkCancelOrdersMutation.isPending ? 'Đang hủy...' : `Hủy ${selectedOrderIds.size} đơn`}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      {/* E-Invoice Modal */}\n      {selectedInvoice && showEInvoiceModal && (\n        <EInvoiceModal\n          isOpen={showEInvoiceModal}\n          onClose={() => setShowEInvoiceModal(false)}\n          onConfirm={async (result) => { // Renamed invoiceResult to result for consistency\n            console.log('E-invoice published successfully:', result);\n\n            if (result.success && selectedInvoice) {\n              try {\n                // Determine the correct API endpoint based on item type\n                const updateEndpoint = getItemType(selectedInvoice) === 'order' \n                  ? `/api/orders/${selectedInvoice.id}`\n                  : `/api/invoices/${selectedInvoice.id}`;\n\n                // Prepare update data with all required fields from API response\n                const updateData = {\n                  einvoiceStatus: result.einvoiceStatus || 1, // Đã phát hành\n                  invoiceStatus: result.invoiceStatus || 1, // Hoàn thành\n                  status: result.status || 'published',\n                  invoiceNumber: result.invoiceNumber || null,\n                  symbol: result.symbol || selectedInvoice.symbol,\n                  templateNumber: result.templateNumber || selectedInvoice.templateNumber\n                };\n\n                // For orders, also update tradeNumber\n                if (getItemType(selectedInvoice) === 'order') {\n                  updateData.tradeNumber = result.invoiceNumber || selectedInvoice.tradeNumber;\n                } else {\n                  // For invoices, update tradeNumber as well\n                  updateData.tradeNumber = result.invoiceNumber || selectedInvoice.tradeNumber;\n                }\n\n                console.log('🔄 Updating item with data:', updateData);\n\n                // Update invoice/order with published status and invoice details\n                const updateResponse = await apiRequest(\"PUT\", updateEndpoint, updateData);\n\n                if (updateResponse.ok) {\n                  // Update local state\n                  setSelectedInvoice({\n                    ...selectedInvoice,\n                    einvoiceStatus: 1,\n                    invoiceStatus: 1,\n                    status: 'published',\n                    invoiceNumber: result.invoiceNumber || selectedInvoice.invoiceNumber,\n                    symbol: updateData.symbol,\n                    templateNumber: updateData.templateNumber,\n                    tradeNumber: updateData.tradeNumber\n                  });\n\n                  // Refresh data to ensure consistency\n                  queryClient.invalidateQueries({ queryKey: [\"/api/invoices\"] });\n                  queryClient.invalidateQueries({ queryKey: [\"/api/orders\"] });\n\n                  console.log('✅ Invoice/Order updated successfully with published status');\n\n                  alert(`Hóa đơn điện tử đã được phát hành thành công!\\nSố hóa đơn: ${result.invoiceNumber || 'N/A'}\\nKý hiệu: ${updateData.symbol || 'N/A'}`);\n                } else {\n                  const errorText = await updateResponse.text();\n                  console.error('❌ Failed to update invoice/order:', errorText);\n                  alert('Hóa đơn đã phát hành nhưng không thể cập nhật trạng thái trong hệ thống');\n                }\n              } catch (error) {\n                console.error('❌ Error updating invoice/order after publish:', error);\n                alert('Hóa đơn đã phát hành nhưng không thể cập nhật trạng thái');\n              }\n            } else {\n              alert(`Lỗi phát hành hóa đơn: ${result.message || 'Không xác định'}`);\n            }\n\n            setShowEInvoiceModal(false);\n          }}\n          total={(() => {\n            if (!selectedInvoice) return 0;\n\n            // Calculate total including tax\n            const subtotal = parseFloat(selectedInvoice.subtotal || '0');\n            const tax = parseFloat(selectedInvoice.tax || '0');\n            return Math.round(subtotal + tax);\n          })()}\n          cartItems={(() => {\n            // Get items for this invoice/order\n            const items = getItemType(selectedInvoice) === 'order' ? orderItems : invoiceItems;\n\n            if (!items || items.length === 0) {\n              return [];\n            }\n\n            return items.map((item: any) => ({\n              id: item.id,\n              name: item.productName,\n              price: parseFloat(item.unitPrice || '0'),\n              quantity: item.quantity,\n              sku: `SP${String(item.productId).padStart(3, '0')}`,\n              taxRate: parseFloat(item.taxRate || '10') // Default to 10% if not specified\n            }));\n          })()}\n          selectedPaymentMethod=\"cash\"\n        />\n      )}\n\n      {/* Publish Invoice Dialog */}\n      {selectedInvoice && (\n        <AlertDialog open={showPublishDialog} onOpenChange={setShowPublishDialog}>\n          <AlertDialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n            <AlertDialogHeader>\n              <AlertDialogTitle className=\"text-blue-600\">Phát hành hóa đơn điện tử</AlertDialogTitle>\n              <div className=\"text-sm text-gray-600\">\n                Đơn hàng: {selectedInvoice.displayNumber} - {selectedInvoice.customerName}\n              </div>\n            </AlertDialogHeader>\n            <div className=\"space-y-4\">\n              <div className=\"bg-blue-50 p-4 rounded-lg\">\n                <h4 className=\"font-medium mb-3\">Thông tin nhà cung cấp hóa đơn điện tử</h4>\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <label className=\"block text-sm font-medium mb-1\">Đơn vị HĐĐT</label>\n                    <div className=\"p-2 bg-white rounded border\">EasyInvoice</div>\n                  </div>\n                  <div>\n                    <label className=\"block text-sm font-medium mb-1\">Mẫu số Hóa đơn GTGT</label>\n                    <div className=\"p-2 bg-white rounded border\">1C25TYY</div>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"bg-gray-50 p-4 rounded-lg\">\n                <h4 className=\"font-medium mb-3\">Thông tin khách hàng</h4>\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <label className=\"block text-sm font-medium mb-1\">Mã số thuế</label>\n                    <div className=\"p-2 bg-white rounded border\">{selectedInvoice.customerTaxCode || '0123456789'}</div>\n                  </div>\n                  <div className=\"flex items-center\">\n                    <Button size=\"sm\" variant=\"outline\" className=\"text-blue-600 border-blue-500\">\n                      Lấy thông tin\n                    </Button>\n                  </div>\n                </div>\n                <div className=\"grid grid-cols-2 gap-4 mt-3\">\n                  <div>\n                    <label className=\"block text-sm font-medium mb-1\">Tên đơn vị</label>\n                    <div className=\"p-2 bg-white rounded border\">{selectedInvoice.customerName || 'Khách hàng lẻ'}</div>\n                  </div>\n                  <div>\n                    <label className=\"block text-sm font-medium mb-1\">Số CMND/CCCD</label>\n                    <div className=\"p-2 bg-white rounded border\">{selectedInvoice.customerPhone || selectedInvoice.customerTaxCode || '0123456789'}</div>\n                  </div>\n                </div>\n                <div className=\"mt-3\">\n                  <label className=\"block text-sm font-medium mb-1\">Địa chỉ</label>\n                  <div className=\"p-2 bg-white rounded border\">{selectedInvoice.customerAddress || 'Cầu Giấy, Hà Nội'}</div>\n                </div>\n                <div className=\"mt-3\">\n                  <label className=\"block text-sm font-medium mb-1\">Email</label>\n                  <div className=\"p-2 bg-white rounded border\">{selectedInvoice.customerEmail || 'ngocnv@gmail.com'}</div>\n                </div>\n              </div>\n\n              {/* Invoice Items */}\n              <div className=\"bg-white p-4 rounded-lg border\">\n                <h4 className=\"font-medium mb-3\">Danh sách sản phẩm</h4>\n                <div className=\"max-h-40 overflow-y-auto\">\n                  <table className=\"w-full text-sm\">\n                    <thead className=\"bg-gray-50\">\n                      <tr>\n                        <th className=\"text-left p-2\">Tên sản phẩm</th>\n                        <th className=\"text-center p-2\">SL</th>\n                        <th className=\"text-right p-2\">Đơn giá</th>\n                        <th className=\"text-right p-2\">Thành tiền</th>\n                      </tr>\n                    </thead>\n                    <tbody>\n                      {(() => {\n                        const items = getItemType(selectedInvoice) === 'order' ? orderItems : invoiceItems;\n                        if (!items || items.length === 0) {\n                          return (\n                            <tr>\n                              <td colSpan={4} className=\"text-center p-4 text-gray-500\">\n                                Không có sản phẩm nào\n                              </td>\n                            </tr>\n                          );\n                        }\n                        return items.map((item: any, index: number) => (\n                          <tr key={item.id} className=\"border-t\">\n                            <td className=\"p-2\">{item.productName}</td>\n                            <td className=\"p-2 text-center\">{item.quantity}</td>\n                            <td className=\"p-2 text-right\">{formatCurrency(item.unitPrice)}</td>\n                            <td className=\"p-2 text-right\">{formatCurrency(item.total)}</td>\n                          </tr>\n                        ));\n                      })()}\n                    </tbody>\n                  </table>\n                </div>\n              </div>\n\n              <div className=\"bg-green-50 p-4 rounded-lg\">\n                <div className=\"space-y-2\">\n                  <div className=\"flex justify-between\">\n                    <span>Thành tiền:</span>\n                    <span className=\"font-medium\">{formatCurrency(selectedInvoice.subtotal || 0)} ₫</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span>Thuế GTGT:</span>\n                    <span className=\"font-medium\">{formatCurrency(selectedInvoice.tax || 0)} ₫</span>\n                  </div>\n                  <div className=\"flex justify-between border-t pt-2\">\n                    <span className=\"font-medium\">Tổng tiền hóa đơn:</span>\n                    <span className=\"text-xl font-bold text-blue-600\">\n                      {formatCurrency(selectedInvoice.total || 0)} ₫\n                    </span>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"flex items-center gap-2\">\n                <Button size=\"sm\" variant=\"outline\" className=\"text-gray-600\">\n                  <Calendar className=\"w-4 h-4 mr-2\" />\n                  Hiện bản phím ảo\n                </Button>\n              </div>\n            </div>\n            <AlertDialogFooter>\n              <div className=\"flex gap-2 w-full\">\n                <Button \n                  className=\"flex-1 bg-green-600 hover:bg-green-700\"\n                  onClick={() => {\n                    if (selectedInvoice) {\n                      // Generate a new GUID for transactionID\n                      const generateGuid = () => {\n                        return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(\n                          /[xy]/g,\n                          function (c) {\n                            const r = (Math.random() * 16) | 0;\n                            const v = c === \"x\" ? r : (r & 0x3) | 0x8;\n                            return v.toString(16);\n                          },\n                        );\n                      };\n\n                      // Get items for this invoice/order\n                      const items = getItemType(selectedInvoice) === 'order' ? orderItems : invoiceItems;\n\n                      if (!items || items.length === 0) {\n                        alert('Không có sản phẩm nào để phát hành hóa đơn');\n                        return;\n                      }\n\n                      // Calculate totals from items with actual tax rates\n                      const subtotal = parseFloat(selectedInvoice.subtotal || '0');\n                      const tax = parseFloat(selectedInvoice.tax || '0');\n                      const discount = 0; \n                      const totalPayment = subtotal + tax - discount;\n\n                      console.log('Publishing invoice with data:', {\n                        invoiceId: selectedInvoice.id,\n                        type: selectedInvoice.type,\n                        subtotal,\n                        tax,\n                        total,\n                        itemsCount: items.length\n                      });\n\n                      // Prepare publish request\n                      const publishRequest = {\n                        login: {\n                          providerId: 1,\n                          url: \"https://infoerpvn.com:9440\",\n                          ma_dvcs: \"0316578736\",\n                          username: \"0316578736\",\n                          password: \"123456a@\",\n                          tenantId: \"\",\n                        },\n                        transactionID: generateGuid(),\n                        invRef: selectedInvoice.displayNumber || `INV-${Date.now()}`,\n                        invSubTotal: Math.round(subtotal),\n                        invVatRate: 10, // This is a default, but the actual rate is used in product mapping\n                        invVatAmount: Math.round(tax),\n                        invDiscAmount: 0,\n                        invTotalAmount: Math.round(totalPayment),\n                        paidTp: \"TM\",\n                        note: selectedInvoice.notes || \"\",\n                        hdNo: \"\",\n                        createdDate: new Date().toISOString(),\n                        clsfNo: \"01GTKT0/001\",\n                        spcfNo: \"1C25TYY\",\n                        templateCode: \"1C25TYY\",\n                        buyerNotGetInvoice: 0,\n                        exchCd: \"VND\",\n                        exchRt: 1,\n                        bankAccount: \"\",\n                        bankName: \"\",\n                        customer: {\n                          custCd: selectedInvoice.customerTaxCode || \"\",\n                          custNm: selectedInvoice.customerName || \"Khách hàng lẻ\",\n                          custCompany: selectedInvoice.customerName || \"Khách hàng lẻ\",\n                          taxCode: selectedInvoice.customerTaxCode || \"\",\n                          custCity: \"\",\n                          custDistrictName: \"\",\n                          custAddrs: selectedInvoice.customerAddress || \"\",\n                          custPhone: selectedInvoice.customerPhone || \"\",\n                          custBankAccount: \"\",\n                          custBankName: \"\",\n                          email: selectedInvoice.customerEmail || \"\",\n                          emailCC: \"\",\n                        },\n                        products: items.map((item: any) => {\n                          const basePrice = parseFloat(item.unitPrice);\n                          const quantity = item.quantity;\n                          // Use actual tax rate from item or default to 10%\n                          const taxRate = parseFloat(item.taxRate || '10'); \n                          const itemSubtotal = basePrice * quantity;\n                          \n                          let totalTax = 0;\n\n                          // Calculate tax based on product's actual tax configuration\n                          if (\n                            item?.afterTaxPrice &&\n                            item.afterTaxPrice !== null &&\n                            item.afterTaxPrice !== \"\"\n                          ) {\n                            // Use afterTaxPrice if available\n                            const afterTaxPrice = parseFloat(item.afterTaxPrice);\n                            const taxPerUnit = afterTaxPrice - basePrice;\n                            totalTax += taxPerUnit * quantity;\n                          } else if (item?.taxRate && parseFloat(item.taxRate) > 0) {\n                            // Fallback to taxRate if no afterTaxPrice but taxRate exists\n                            const taxPerUnit = basePrice * (taxRate / 100);\n                            totalTax += taxPerUnit * quantity;\n                          }\n                          // No tax if neither afterTaxPrice nor taxRate is available\n\n                          const itemTotal = itemSubtotal + totalTax;\n\n                          return {\n                            itmCd: `SP${String(item.productId).padStart(3, '0')}`,\n                            itmName: item.productName,\n                            itmKnd: 1,\n                            unitNm: \"Cái\",\n                            qty: quantity,\n                            unprc: basePrice,\n                            amt: Math.round(itemSubtotal),\n                            discRate: 0,\n                            discAmt: 0,\n                            vatRt: taxRate.toString(), // Include the tax rate used\n                            vatAmt: Math.round(totalTax),\n                            totalAmt: Math.round(itemTotal),\n                          };\n                        }),\n                      };\n\n                      // Close dialog first\n                      setShowPublishDialog(false);\n\n                      // Call publish API\n                      publishRequestMutation.mutate(publishRequest);\n                    }\n                  }}\n                  disabled={publishRequestMutation.isPending}\n                >\n                  <Mail className=\"w-4 h-4 mr-2\" />\n                  {publishRequestMutation.isPending ? 'Đang phát hành...' : 'Phát hành'}\n                </Button>\n                <Button \n                  variant=\"outline\"\n                  className=\"flex-1 border-gray-500 text-gray-600\"\n                  onClick={() => setShowPublishDialog(false)}\n                >\n                  <X className=\"w-4 h-4 mr-2\" />\n                  Hủy bỏ\n                </Button>\n              </div>\n            </AlertDialogFooter>\n          </AlertDialogContent>\n        </AlertDialog>\n      )}\n\n      {/* Cancel Order Confirmation Dialog */}\n      <AlertDialog open={showCancelDialog} onOpenChange={setShowCancelDialog}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Hủy đơn hàng bán</AlertDialogTitle>\n            <AlertDialogDescription>\n              Bạn có chắc muốn hủy đơn hàng {selectedInvoice?.tradeNumber || selectedInvoice?.invoiceNumber || `DH${String(selectedInvoice?.id).padStart(8, '0')}`} này không?\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Bỏ qua</AlertDialogCancel>\n            <AlertDialogAction \n              onClick={() => {\n                if (selectedInvoice) {\n                  console.log('Cancelling order/invoice:', selectedInvoice.id, selectedInvoice.type);\n                  cancelInvoiceMutation.mutate({ \n                    id: selectedInvoice.id, \n                    type: selectedInvoice.type || 'invoice' \n                  });\n                }\n              }}\n              disabled={cancelInvoiceMutation.isPending}\n              className=\"bg-red-600 hover:bg-red-700\"\n            >\n              {cancelInvoiceMutation.isPending ? 'Đang hủy...' : 'Đồng ý'}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n\n    </div>\n  );\n}","size_bytes":101532},"client/src/pages/settings.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from \"@/components/ui/alert-dialog\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport {\n  type StoreSettings,\n  type InsertStoreSettings,\n  type Customer,\n} from \"@shared/schema\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  Store,\n  Package,\n  Users,\n  CreditCard,\n  Settings as SettingsIcon,\n  Home,\n  MapPin,\n  Phone,\n  Mail,\n  Save,\n  Plus,\n  Trash2,\n  Edit,\n  Search,\n  Clock,\n  UserCheck,\n  Tag,\n  ShoppingCart,\n} from \"lucide-react\";\nimport { CustomerFormModal } from \"@/components/customers/customer-form-modal\";\nimport { CustomerPointsModal } from \"@/components/customers/customer-points-modal\";\nimport { MembershipModal } from \"@/components/membership/membership-modal\";\nimport { PointsManagementModal } from \"@/components/customers/points-management-modal\";\nimport { EmployeeFormModal } from \"@/components/employees/employee-form-modal\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\n\n// E-invoice software providers mapping\nconst EINVOICE_PROVIDERS = [\n  { name: \"EasyInvoice\", value: \"1\" },\n  { name: \"VnInvoice\", value: \"2\" },\n  { name: \"FptInvoice\", value: \"3\" },\n  { name: \"MifiInvoice\", value: \"4\" },\n  { name: \"EHoaDon\", value: \"5\" },\n  { name: \"BkavInvoice\", value: \"6\" },\n  { name: \"MInvoice\", value: \"7\" },\n  { name: \"SInvoice\", value: \"8\" },\n  { name: \"WinInvoice\", value: \"9\" }\n];\n\nexport default function Settings() {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [activeTab, setActiveTab] = useState(\"store\");\n\n  // Customer management state\n  const [showCustomerForm, setShowCustomerForm] = useState(false);\n  const [editingCustomer, setEditingCustomer] = useState<Customer | null>(null);\n  const [customerSearchTerm, setCustomerSearchTerm] = useState(\"\");\n  const [showMembershipModal, setShowMembershipModal] = useState(false);\n  const [showPointsModal, setShowPointsModal] = useState(false);\n  const [showPointsManagementModal, setShowPointsManagementModal] =\n    useState(false);\n  const [selectedCustomer, setSelectedCustomer] = useState<Customer | null>(\n    null,\n  );\n\n  // Employee management state\n  const [showEmployeeForm, setShowEmployeeForm] = useState(false);\n  const [editingEmployee, setEditingEmployee] = useState<any>(null);\n  const [employeeSearchTerm, setEmployeeSearchTerm] = useState(\"\");\n\n  // E-invoice management state\n  const [showEInvoiceForm, setShowEInvoiceForm] = useState(false);\n  const [editingEInvoice, setEditingEInvoice] = useState<any>(null);\n  const [showEInvoiceDeleteDialog, setShowEInvoiceDeleteDialog] =\n    useState(false);\n  const [eInvoiceToDelete, setEInvoiceToDelete] = useState<any>(null);\n  const [eInvoiceForm, setEInvoiceForm] = useState({\n    taxCode: \"\",\n    loginId: \"\",\n    password: \"\",\n    softwareName: \"\",\n    loginUrl: \"\",\n    signMethod: \"Ký server\",\n    cqtCode: \"Cấp nhật\",\n    notes: \"\",\n    isActive: true,\n  });\n  const [eInvoiceFormErrors, setEInvoiceFormErrors] = useState({\n    taxCode: \"\",\n    loginId: \"\",\n    password: \"\",\n    softwareName: \"\",\n    loginUrl: \"\",\n  });\n\n  // Product management state\n  const [showCategoryForm, setShowCategoryForm] = useState(false);\n  const [showProductForm, setShowProductForm] = useState(false);\n  const [editingCategory, setEditingCategory] = useState<any>(null);\n  const [editingProduct, setEditingProduct] = useState<any>(null);\n  const [showDeleteDialog, setShowDeleteDialog] = useState(false);\n  const [categoryToDelete, setCategoryToDelete] = useState<any>(null);\n  const [showCustomerDeleteDialog, setShowCustomerDeleteDialog] =\n    useState(false);\n  const [customerToDelete, setCustomerToDelete] = useState<any>(null);\n  const [showProductDeleteDialog, setShowProductDeleteDialog] = useState(false);\n  const [productToDelete, setProductToDelete] = useState<any>(null);\n  const [showEmployeeDeleteDialog, setShowEmployeeDeleteDialog] =\n    useState(false);\n  const [employeeToDelete, setEmployeeToDelete] = useState<any>(null);\n\n  const confirmDeleteEmployee = async () => {\n    if (!employeeToDelete) return;\n\n    try {\n      const response = await fetch(`/api/employees/${employeeToDelete.id}`, {\n        method: \"DELETE\",\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n\n      await queryClient.refetchQueries({\n        queryKey: [\"/api/employees\"],\n      });\n\n      toast({\n        title: \"Thành công\",\n        description: \"Nhân viên đã được xóa thành công\",\n      });\n\n      setShowEmployeeDeleteDialog(false);\n      setEmployeeToDelete(null);\n    } catch (error) {\n      console.error(\"Employee delete error:\", error);\n      toast({\n        title: \"Lỗi\",\n        description: \"Có lỗi xảy ra khi xóa nhân viên\",\n        variant: \"destructive\",\n      });\n    }\n  };\n  const [selectedCategoryFilter, setSelectedCategoryFilter] =\n    useState<string>(\"all\");\n  const [productSearchTerm, setProductSearchTerm] = useState(\"\");\n  const [categoryForm, setCategoryForm] = useState({\n    name: \"\",\n    icon: \"fas fa-utensils\",\n  });\n  const [productForm, setProductForm] = useState({\n    name: \"\",\n    sku: \"\",\n    price: \"\",\n    stock: \"0\",\n    categoryId: \"\",\n    description: \"\",\n    isActive: \"true\",\n    trackInventory: true,\n    taxRate: \"\",\n    afterTaxPrice: \"\",\n  });\n\n  // Fetch store settings\n  const { data: storeData, isLoading } = useQuery<StoreSettings>({\n    queryKey: [\"/api/store-settings\"],\n  });\n\n  // Fetch customers\n  const { data: customersData, isLoading: customersLoading } = useQuery<\n    Customer[]\n  >({\n    queryKey: [\"/api/customers\"],\n  });\n\n  // Fetch employees\n  const { data: employeesRawData, isLoading: employeesLoading } = useQuery<\n    any[]\n  >({\n    queryKey: [\"/api/employees\"],\n  });\n\n  // Sort employees by ID descending (newest first)\n  const employeesData = employeesRawData?.sort((a, b) => b.id - a.id);\n\n  // Filter employees based on search term\n  const filteredEmployees = employeesData\n    ? employeesData.filter(\n        (employee: any) =>\n          employee.name\n            .toLowerCase()\n            .includes(employeeSearchTerm.toLowerCase()) ||\n          employee.employeeId\n            .toLowerCase()\n            .includes(employeeSearchTerm.toLowerCase()) ||\n          (employee.phone && employee.phone.includes(employeeSearchTerm)),\n      )\n    : [];\n\n  // Fetch categories\n  const { data: categoriesData, isLoading: categoriesLoading } = useQuery<\n    any[]\n  >({\n    queryKey: [\"/api/categories\"],\n  });\n\n  // Fetch products (include inactive products in settings)\n  const { data: productsData, isLoading: productsLoading } = useQuery<any[]>({\n    queryKey: [\"/api/products\", { includeInactive: true }],\n    queryFn: async () => {\n      const response = await fetch(\"/api/products?includeInactive=true\");\n      if (!response.ok) throw new Error(\"Failed to fetch products\");\n      return response.json();\n    },\n  });\n\n  // Store settings state\n  const [storeSettings, setStoreSettings] = useState({\n    storeName: \"EDPOS 레스토랑\",\n    storeCode: \"STORE001\",\n    address: \"서울시 강남구 테헤란로 123\",\n    phone: \"02-1234-5678\",\n    email: \"contact@edpos.com\",\n    taxId: \"123-45-67890\",\n    businessType: \"restaurant\",\n    pinCode: \"\",\n    openTime: \"09:00\",\n    closeTime: \"22:00\",\n  });\n\n  // Update local state when data is loaded\n  useEffect(() => {\n    if (storeData) {\n      setStoreSettings({\n        storeName: storeData.storeName || \"EDPOS 레스토랑\",\n        storeCode: storeData.storeCode || \"STORE001\",\n        address: storeData.address || \"\",\n        phone: storeData.phone || \"\",\n        email: storeData.email || \"\",\n        taxId: storeData.taxId || \"\",\n        businessType: storeData.businessType || \"restaurant\",\n        pinCode: storeData.pinCode || \"\",\n        openTime: storeData.openTime || \"09:00\",\n        closeTime: storeData.closeTime || \"22:00\",\n      });\n    }\n  }, [storeData]);\n\n  // Load payment methods from localStorage on mount\n  useEffect(() => {\n    const savedPaymentMethods = localStorage.getItem(\"paymentMethods\");\n    if (savedPaymentMethods) {\n      try {\n        const parsed = JSON.parse(savedPaymentMethods);\n        setPaymentMethods(parsed);\n      } catch (error) {\n        console.error(\"Error parsing saved payment methods:\", error);\n      }\n    }\n  }, []);\n\n  // Mutation to update store settings\n  const updateStoreSettingsMutation = useMutation({\n    mutationFn: async (settings: Partial<InsertStoreSettings>) => {\n      const response = await apiRequest(\"PUT\", \"/api/store-settings\", settings);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/store-settings\"] });\n      toast({\n        title: t(\"common.success\"),\n        description: t(\"settings.storeUpdated\"),\n      });\n    },\n    onError: () => {\n      toast({\n        title: t(\"common.error\"),\n        description: t(\"settings.updateError\"),\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Payment methods state - Vietnamese market localized\n  const [paymentMethods, setPaymentMethods] = useState([\n    {\n      id: 1,\n      name: \"Tiền mặt\",\n      nameKey: \"cash\",\n      type: \"cash\",\n      enabled: true,\n      icon: \"💵\",\n    },\n    {\n      id: 2,\n      name: \"Thẻ tín dụng\",\n      nameKey: \"creditCard\",\n      type: \"card\",\n      enabled: false,\n      icon: \"💳\",\n    },\n    {\n      id: 3,\n      name: \"Thẻ ghi nợ\",\n      nameKey: \"debitCard\",\n      type: \"debit\",\n      enabled: false,\n      icon: \"💳\",\n    },\n    {\n      id: 4,\n      name: \"MoMo\",\n      nameKey: \"momo\",\n      type: \"digital\",\n      enabled: false,\n      icon: \"📱\",\n    },\n    {\n      id: 5,\n      name: \"ZaloPay\",\n      nameKey: \"zalopay\",\n      type: \"digital\",\n      enabled: false,\n      icon: \"📱\",\n    },\n    {\n      id: 6,\n      name: \"VNPay\",\n      nameKey: \"vnpay\",\n      type: \"digital\",\n      enabled: false,\n      icon: \"💳\",\n    },\n    {\n      id: 7,\n      name: \"QR Code\",\n      nameKey: \"qrCode\",\n      type: \"qr\",\n      enabled: true,\n      icon: \"📱\",\n    },\n    {\n      id: 8,\n      name: \"ShopeePay\",\n      nameKey: \"shopeepay\",\n      type: \"digital\",\n      enabled: false,\n      icon: \"🛒\",\n    },\n    {\n      id: 9,\n      name: \"GrabPay\",\n      nameKey: \"grabpay\",\n      type: \"digital\",\n      enabled: false,\n      icon: \"🚗\",\n    },\n  ]);\n\n  // Payment method editing state\n  const [editingPaymentMethod, setEditingPaymentMethod] = useState<any>(null);\n  const [showPaymentMethodForm, setShowPaymentMethodForm] = useState(false);\n  const [paymentMethodForm, setPaymentMethodForm] = useState({\n    name: \"\",\n    icon: \"\",\n  });\n\n  const handleStoreSettingChange = (field: string, value: string) => {\n    setStoreSettings((prev) => ({\n      ...prev,\n      [field]: value,\n    }));\n  };\n\n  const saveStoreSettings = () => {\n    updateStoreSettingsMutation.mutate(storeSettings);\n    // Save payment methods to localStorage so other components can access them\n    localStorage.setItem(\"paymentMethods\", JSON.stringify(paymentMethods));\n  };\n\n  const togglePaymentMethod = (id: number) => {\n    const updatedMethods = paymentMethods.map((method) =>\n      method.id === id ? { ...method, enabled: !method.enabled } : method,\n    );\n    setPaymentMethods(updatedMethods);\n    // Save to localStorage immediately when toggled\n    localStorage.setItem(\"paymentMethods\", JSON.stringify(updatedMethods));\n  };\n\n  const addPaymentMethod = () => {\n    const newMethod = {\n      id: paymentMethods.length + 1,\n      name: \"Phương thức thanh toán mới\",\n      nameKey: \"newPayment\",\n      type: \"custom\",\n      enabled: false,\n      icon: \"💳\",\n    };\n    const updatedMethods = [...paymentMethods, newMethod];\n    setPaymentMethods(updatedMethods);\n    // Save to localStorage immediately when added\n    localStorage.setItem(\"paymentMethods\", JSON.stringify(updatedMethods));\n  };\n\n  const removePaymentMethod = (id: number) => {\n    const updatedMethods = paymentMethods.filter((method) => method.id !== id);\n    setPaymentMethods(updatedMethods);\n    // Save to localStorage immediately when removed\n    localStorage.setItem(\"paymentMethods\", JSON.stringify(updatedMethods));\n  };\n\n  // Payment method management functions\n  const handleEditPaymentMethod = (method: any) => {\n    setPaymentMethodForm({\n      name: method.name,\n      icon: method.icon,\n    });\n    setEditingPaymentMethod(method);\n    setShowPaymentMethodForm(true);\n  };\n\n  const handleUpdatePaymentMethod = () => {\n    if (!paymentMethodForm.name.trim() || !editingPaymentMethod) return;\n\n    const updatedMethods = paymentMethods.map((method) =>\n      method.id === editingPaymentMethod.id\n        ? { ...method, name: paymentMethodForm.name.trim(), icon: paymentMethodForm.icon }\n        : method\n    );\n\n    setPaymentMethods(updatedMethods);\n    localStorage.setItem(\"paymentMethods\", JSON.stringify(updatedMethods));\n\n    setShowPaymentMethodForm(false);\n    setEditingPaymentMethod(null);\n    setPaymentMethodForm({ name: \"\", icon: \"\" });\n\n    toast({\n      title: \"Thành công\",\n      description: \"Phương thức thanh toán đã được cập nhật thành công\",\n    });\n  };\n\n  const resetPaymentMethodForm = () => {\n    setPaymentMethodForm({ name: \"\", icon: \"\" });\n    setEditingPaymentMethod(null);\n  };\n\n  // Customer management functions\n  const handleEditCustomer = (customer: any) => {\n    setEditingCustomer(customer);\n    setShowCustomerForm(true);\n  };\n\n  const handleDeleteCustomer = (customerId: number, customerName: string) => {\n    setCustomerToDelete({ id: customerId, name: customerName });\n    setShowCustomerDeleteDialog(true);\n  };\n\n  const confirmDeleteCustomer = async () => {\n    if (!customerToDelete) return;\n\n    try {\n      const response = await fetch(`/api/customers/${customerToDelete.id}`, {\n        method: \"DELETE\",\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n\n      await queryClient.refetchQueries({ queryKey: [\"/api/customers\"] });\n\n      toast({\n        title: \"Thành công\",\n        description: \"Khách hàng đã được xóa thành công\",\n      });\n\n      setShowCustomerDeleteDialog(false);\n      setCustomerToDelete(null);\n    } catch (error) {\n      console.error(\"Customer delete error:\", error);\n      toast({\n        title: \"Lỗi\",\n        description: \"Có lỗi xảy ra khi xóa khách hàng\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleManagePoints = (customer: Customer) => {\n    setSelectedCustomer(customer);\n    setShowPointsModal(true);\n  };\n\n  const handleCloseCustomerForm = () => {\n    setShowCustomerForm(false);\n    setEditingCustomer(null);\n  };\n\n  // Filter customers based on search term\n  const filteredCustomers = customersData\n    ? customersData.filter(\n        (customer: Customer) =>\n          customer.name\n            .toLowerCase()\n            .includes(customerSearchTerm.toLowerCase()) ||\n          customer.customerId\n            .toLowerCase()\n            .includes(customerSearchTerm.toLowerCase()) ||\n          (customer.phone && customer.phone.includes(customerSearchTerm)),\n      )\n    : [];\n\n  // Product management functions\n  const resetCategoryForm = () => {\n    setCategoryForm({ name: \"\", icon: \"fas fa-utensils\" });\n    setEditingCategory(null);\n  };\n\n  const resetProductForm = () => {\n    setProductForm({\n      name: \"\",\n      sku: \"\",\n      price: \"\",\n      stock: \"0\",\n      categoryId: \"\",\n      description: \"\",\n      isActive: \"true\",\n      trackInventory: true,\n      taxRate: \"\",\n      afterTaxPrice: \"\",\n    });\n    setEditingProduct(null);\n  };\n\n  const handleCreateCategory = async () => {\n    if (!categoryForm.name.trim()) {\n      toast({\n        title: t(\"common.error\"),\n        description: \"Vui lòng nhập tên danh mục\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    try {\n      const response = await fetch(\"/api/categories\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(categoryForm),\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n\n      const result = await response.json();\n\n      // Refetch data immediately\n      await queryClient.refetchQueries({ queryKey: [\"/api/categories\"] });\n      await queryClient.refetchQueries({ queryKey: [\"/api/products\"] });\n\n      toast({\n        title: t(\"common.success\"),\n        description: \"Danh mục đã được tạo thành công\",\n      });\n      setShowCategoryForm(false);\n      resetCategoryForm();\n    } catch (error) {\n      console.error(\"Category creation error:\", error);\n      toast({\n        title: t(\"common.error\"),\n        description: \"Có lỗi xảy ra khi tạo danh mục\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleUpdateCategory = async () => {\n    if (!categoryForm.name.trim()) {\n      toast({\n        title: t(\"common.error\"),\n        description: \"Vui lòng nhập tên danh mục\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!editingCategory) {\n      toast({\n        title: t(\"common.error\"),\n        description: \"Không tìm thấy danh mục cần cập nhật\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    try {\n      const response = await fetch(`/api/categories/${editingCategory.id}`, {\n        method: \"PUT\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(categoryForm),\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n\n      const result = await response.json();\n\n      // Close dialog and reset form\n      setShowCategoryForm(false);\n      resetCategoryForm();\n\n      // Refetch data immediately\n      await queryClient.refetchQueries({ queryKey: [\"/api/categories\"] });\n      await queryClient.refetchQueries({ queryKey: [\"/api/products\"] });\n\n      toast({\n        title: t(\"common.success\"),\n        description: \"Danh mục đã được cập nhật thành công\",\n      });\n    } catch (error) {\n      console.error(\"Category update error:\", error);\n      toast({\n        title: t(\"common.error\"),\n        description: \"Có lỗi xảy ra khi cập nhật danh mục\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleDeleteCategory = async (categoryId: number) => {\n    // Check if category has products\n    const categoryProducts = productsData?.filter(\n      (product: any) => product.categoryId === categoryId,\n    );\n\n    if (categoryProducts && categoryProducts.length > 0) {\n      toast({\n        title: t(\"common.error\"),\n        description: `Không thể xóa danh mục này vì còn ${categoryProducts.length} sản phẩm. Vui lòng xóa hoặc chuyển các sản phẩm sang danh mục khác trước.`,\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Find category to show in dialog\n    const category = categoriesData?.find((c: any) => c.id === categoryId);\n    setCategoryToDelete(category);\n    setShowDeleteDialog(true);\n  };\n\n  const confirmDeleteCategory = async () => {\n    if (!categoryToDelete) return;\n\n    try {\n      const response = await fetch(`/api/categories/${categoryToDelete.id}`, {\n        method: \"DELETE\",\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(\n          errorData.error || `HTTP error! status: ${response.status}`,\n        );\n      }\n\n      // Refetch data immediately\n      await queryClient.refetchQueries({ queryKey: [\"/api/categories\"] });\n      await queryClient.refetchQueries({ queryKey: [\"/api/products\"] });\n\n      toast({\n        title: t(\"common.success\"),\n        description: \"Danh mục đã được xóa thành công\",\n      });\n\n      setShowDeleteDialog(false);\n      setCategoryToDelete(null);\n    } catch (error) {\n      console.error(\"Category delete error:\", error);\n\n      let errorMessage = \"Có lỗi xảy ra khi xóa danh mục\";\n      if (error instanceof Error) {\n        if (error.message.includes(\"products\")) {\n          errorMessage =\n            \"Không thể xóa danh mục vì vẫn còn sản phẩm trong danh mục này. Vui lòng xóa hoặc chuyển các sản phẩm sang danh mục khác trước.\";\n        } else {\n          errorMessage = error.message;\n        }\n      }\n\n      toast({\n        title: t(\"common.error\"),\n        description: errorMessage,\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleCreateProduct = async () => {\n    if (\n      !productForm.name.trim() ||\n      !productForm.sku.trim() ||\n      !productForm.categoryId\n    )\n      return;\n\n    try {\n      const productData = {\n        ...productForm,\n        price: productForm.price,\n        stock: parseInt(productForm.stock) || 0,\n        categoryId: parseInt(productForm.categoryId),\n        isActive: productForm.isActive === \"true\",\n        trackInventory: productForm.trackInventory,\n        taxRate: productForm.taxRate ? parseFloat(productForm.taxRate).toString() : \"0\",\n        afterTaxPrice: productForm.afterTaxPrice || null,\n      };\n\n      const response = await apiRequest(\"POST\", \"/api/products\", productData);\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      toast({\n        title: t(\"common.success\"),\n        description: t(\"productManagement.productCreateSuccess\"),\n      });\n      setShowProductForm(false);\n      resetProductForm();\n    } catch (error) {\n      toast({\n        title: t(\"common.error\"),\n        description: t(\"common.error\"),\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleUpdateProduct = async () => {\n    if (\n      !productForm.name.trim() ||\n      !productForm.sku.trim() ||\n      !productForm.categoryId ||\n      !editingProduct\n    )\n      return;\n\n    try {\n      const productData = {\n        ...productForm,\n        price: productForm.price,\n        stock: parseInt(productForm.stock) || 0,\n        categoryId: parseInt(productForm.categoryId),\n        isActive: productForm.isActive === \"true\",\n        trackInventory: productForm.trackInventory,\n        taxRate: productForm.taxRate ? parseFloat(productForm.taxRate).toString() : \"0\",\n        afterTaxPrice: productForm.afterTaxPrice || null,\n      };\n\n      const response = await apiRequest(\n        \"PUT\",\n        `/api/products/${editingProduct.id}`,\n        productData,\n      );\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      toast({\n        title: t(\"common.success\"),\n        description: t(\"productManagement.productUpdateSuccess\"),\n      });\n      setShowProductForm(false);\n      resetProductForm();\n    } catch (error) {\n      toast({\n        title: t(\"common.error\"),\n        description: t(\"common.error\"),\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleDeleteProduct = async (\n    productId: number,\n    productName: string,\n  ) => {\n    setProductToDelete({ id: productId, name: productName });\n    setShowProductDeleteDialog(true);\n  };\n\n  const confirmDeleteProduct = async () => {\n    if (!productToDelete) return;\n\n    try {\n      await apiRequest(\"DELETE\", `/api/products/${productToDelete.id}`);\n\n      await queryClient.refetchQueries({ queryKey: [\"/api/products\"] });\n\n      toast({\n        title: t(\"common.success\"),\n        description: \"Sản phẩm đã được xóa thành công\",\n      });\n\n      setShowProductDeleteDialog(false);\n      setProductToDelete(null);\n    } catch (error) {\n      console.error(\"Product delete error:\", error);\n      toast({\n        title: t(\"common.error\"),\n        description: \"Có lỗi xảy ra khi xóa sản phẩm\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleEditCategory = (category: any) => {\n    setCategoryForm({\n      name: category.name || \"\",\n      icon: category.icon || \"fas fa-utensils\",\n    });\n    setEditingCategory(category);\n    setShowCategoryForm(true);\n  };\n\n  const handleEditProduct = (product: any) => {\n    setProductForm({\n      name: product.name,\n      sku: product.sku,\n      price: product.price.toString(),\n      stock: product.stock.toString(),\n      categoryId: product.categoryId.toString(),\n      description: product.description || \"\",\n      isActive: product.isActive ? \"true\" : \"false\",\n      trackInventory: product.trackInventory !== undefined ? product.trackInventory : true,\n      taxRate: product.taxRate ? parseFloat(product.taxRate).toString() : \"\",\n      afterTaxPrice: product.afterTaxPrice ? product.afterTaxPrice.toString() : \"\",\n    });\n    setEditingProduct(product);\n    setShowProductForm(true);\n  };\n\n  // Filter products based on category and search term\n  const filteredProducts = productsData\n    ? productsData.filter((product: any) => {\n        const matchesCategory =\n          selectedCategoryFilter === \"all\" ||\n          product.categoryId.toString() === selectedCategoryFilter;\n        const matchesSearch =\n          product.name\n            .toLowerCase()\n            .includes(productSearchTerm.toLowerCase()) ||\n          product.sku.toLowerCase().includes(productSearchTerm.toLowerCase());\n        return matchesCategory && matchesSearch;\n      })\n    : [];\n\n  // Fetch E-invoice connections\n  const { data: eInvoiceConnections = [], isLoading: eInvoiceLoading } =\n    useQuery<any[]>({\n      queryKey: [\"/api/einvoice-connections\"],\n    });\n\n  // E-invoice mutations\n  const createEInvoiceMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest(\n        \"POST\",\n        \"/api/einvoice-connections\",\n        data,\n      );\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({\n        queryKey: [\"/api/einvoice-connections\"],\n      });\n      toast({\n        title: \"Thành công\",\n        description: \"Kết nối HĐĐT đã được tạo thành công\",\n      });\n      setShowEInvoiceForm(false);\n      resetEInvoiceForm();\n    },\n    onError: () => {\n      toast({\n        title: \"Lỗi\",\n        description: \"Có l i xảy ra khi tạo kết nối HĐĐT\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateEInvoiceMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number; data: any }) => {\n      const response = await apiRequest(\n        \"PUT\",\n        `/api/einvoice-connections/${id}`,\n        data,\n      );\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({\n        queryKey: [\"/api/einvoice-connections\"],\n      });\n      toast({\n        title: \"Thành công\",\n        description: \"Kết nối HĐĐT đã được cập nhật thành công\",\n      });\n      setShowEInvoiceForm(false);\n      resetEInvoiceForm();\n    },\n    onError: () => {\n      toast({\n        title: \"Lỗi\",\n        description: \"Có lỗi xảy ra khi cập nhật kết nối HĐĐT\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteEInvoiceMutation = useMutation({\n    mutationFn: async (id: number) => {\n      const response = await apiRequest(\n        \"DELETE\",\n        `/api/einvoice-connections/${id}`,\n      );\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({\n        queryKey: [\"/api/einvoice-connections\"],\n      });\n      toast({\n        title: \"Thành công\",\n        description: \"Kết nối HĐĐT đã được xóa thành công\",\n      });\n      setShowEInvoiceDeleteDialog(false);\n      setEInvoiceToDelete(null);\n    },\n    onError: () => {\n      toast({\n        title: \"Lỗi\",\n        description: \"Có lỗi xảy ra khi xóa kết nối HĐĐT\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // E-invoice management functions\n  const resetEInvoiceForm = () => {\n    setEInvoiceForm({\n      taxCode: \"\",\n      loginId: \"\",\n      password: \"\",\n      softwareName: \"\",\n      loginUrl: \"\",\n      signMethod: \"Ký server\",\n      cqtCode: \"Cấp nhật\",\n      notes: \"\",\n      isActive: true,\n    });\n    setEInvoiceFormErrors({\n      taxCode: \"\",\n      loginId: \"\",\n      password: \"\",\n      softwareName: \"\",\n      loginUrl: \"\",\n    });\n    setEditingEInvoice(null);\n  };\n\n  const validateEInvoiceForm = () => {\n    const errors = {\n      taxCode: \"\",\n      loginId: \"\",\n      password: \"\",\n      softwareName: \"\",\n      loginUrl: \"\",\n    };\n\n    if (!eInvoiceForm.taxCode.trim()) {\n      errors.taxCode = \"Mã số thuế là bắt buộc\";\n    }\n\n    if (!eInvoiceForm.loginId.trim()) {\n      errors.loginId = \"ID đăng nhập là bắt buộc\";\n    }\n\n    if (!eInvoiceForm.password.trim()) {\n      errors.password = \"Mật khẩu là bắt buộc\";\n    }\n\n    if (!eInvoiceForm.softwareName.trim()) {\n      errors.softwareName = \"Phần mềm HĐĐT là bắt buộc\";\n    }\n\n    if (!eInvoiceForm.loginUrl.trim()) {\n      errors.loginUrl = \"Đường dẫn đăng nhập là bắt buộc\";\n    }\n\n    setEInvoiceFormErrors(errors);\n    return !Object.values(errors).some((error) => error !== \"\");\n  };\n\n  const handleCreateEInvoice = () => {\n    if (!validateEInvoiceForm()) {\n      toast({\n        title: \"Lỗi\",\n        description: \"Vui lòng điền đầy đủ thông tin bắt buộc\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    createEInvoiceMutation.mutate(eInvoiceForm);\n  };\n\n  const handleUpdateEInvoice = () => {\n    if (!validateEInvoiceForm()) {\n      toast({\n        title: \"Lỗi\",\n        description: \"Vui lòng điền đầy đủ thông tin bắt buộc\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!editingEInvoice) return;\n\n    updateEInvoiceMutation.mutate({\n      id: editingEInvoice.id,\n      data: eInvoiceForm,\n    });\n  };\n\n  const handleEditEInvoice = (eInvoice: any) => {\n    console.log(\"Editing E-invoice:\", eInvoice);\n    setEInvoiceForm({\n      taxCode: eInvoice.taxCode || \"\",\n      loginId: eInvoice.loginId || \"\",\n      password: eInvoice.password || \"\",\n      softwareName: eInvoice.softwareName || \"\",\n      loginUrl: eInvoice.loginUrl || \"\",\n      signMethod: eInvoice.signMethod || \"Ký server\",\n      cqtCode: eInvoice.cqtCode || \"Cấp nhật\",\n      notes: eInvoice.notes === \"-\" ? \"\" : (eInvoice.notes || \"\"),\n      isActive: eInvoice.isActive !== undefined ? eInvoice.isActive : true,\n    });\n    setEInvoiceFormErrors({\n      taxCode: \"\",\n      loginId: \"\",\n      password: \"\",\n      softwareName: \"\",\n      loginUrl: \"\",\n    });\n    setEditingEInvoice(eInvoice);\n    setShowEInvoiceForm(true);\n  };\n\n  const handleDeleteEInvoice = (id: number, softwareName: string) => {\n    setEInvoiceToDelete({ id, softwareName });\n    setShowEInvoiceDeleteDialog(true);\n  };\n\n  const confirmDeleteEInvoice = () => {\n    if (!eInvoiceToDelete) return;\n    deleteEInvoiceMutation.mutate(eInvoiceToDelete.id);\n  };\n\n  const toggleEInvoiceDefault = (id: number) => {\n    const connection = eInvoiceConnections.find((conn) => conn.id === id);\n    if (!connection) return;\n\n    updateEInvoiceMutation.mutate({\n      id,\n      data: { ...connection, isDefault: !connection.isDefault },\n    });\n  };\n  // Invoice template management state\n  const [showTemplateForm, setShowTemplateForm] = useState(false);\n  const [editingTemplate, setEditingTemplate] = useState<any>(null);\n  const [showTemplateDeleteDialog, setShowTemplateDeleteDialog] = useState(false);\n  const [templateToDelete, setTemplateToDelete] = useState<any>(null);\n  const [templateForm, setTemplateForm] = useState({\n    name: \"\",\n    templateNumber: \"\",\n    templateCode: \"\", // Added templateCode field\n    symbol: \"\",\n    useCK: true,\n    notes: \"\",\n    isDefault: false,\n  });\n\n  const resetTemplateForm = () => {\n    setTemplateForm({\n      name: \"\",\n      templateNumber: \"\",\n      templateCode: \"\", // Reset templateCode field\n      symbol: \"\",\n      useCK: true,\n      notes: \"\",\n      isDefault: false,\n    });\n    setEditingTemplate(null);\n  };\n\n  // Fetch invoice templates\n  const { data: invoiceTemplates = [], isLoading: templatesLoading } = useQuery<any[]>({\n    queryKey: [\"/api/invoice-templates\"],\n  });\n\n  // Invoice template mutations\n  const createTemplateMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest(\"POST\", \"/api/invoice-templates\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/invoice-templates\"] });\n      toast({\n        title: \"Thành công\",\n        description: \"Mẫu số HĐĐT đã được tạo thành công\",\n      });\n      setShowTemplateForm(false);\n      resetTemplateForm();\n    },\n    onError: () => {\n      toast({\n        title: \"Lỗi\", \n        description: \"Có lỗi xảy ra khi tạo mẫu số HĐĐT\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateTemplateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number; data: any }) => {\n      const response = await apiRequest(\"PUT\", `/api/invoice-templates/${id}`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/invoice-templates\"] });\n      toast({\n        title: \"Thành công\",\n        description: \"Mẫu số HĐĐT đã được cập nhật thành công\",\n      });\n      setShowTemplateForm(false);\n      resetTemplateForm();\n    },\n    onError: () => {\n      toast({\n        title: \"Lỗi\",\n        description: \"Có lỗi xảy ra khi cập nhật mẫu số HĐĐT\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteTemplateMutation = useMutation({\n    mutationFn: async (id: number) => {\n      const response = await apiRequest(\"DELETE\", `/api/invoice-templates/${id}`);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/invoice-templates\"] });\n      toast({\n        title: \"Thành công\",\n        description: \"Mẫu số HĐĐT đã được xóa thành công\",\n      });\n      setShowTemplateDeleteDialog(false);\n      setTemplateToDelete(null);\n    },\n    onError: () => {\n      toast({\n        title: \"Lỗi\",\n        description: \"Có lỗi xảy ra khi xóa mẫu số HĐĐT\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleCreateTemplate = () => {\n    if (!templateForm.name.trim() || !templateForm.templateNumber.trim() || !templateForm.symbol.trim()) {\n      toast({\n        title: \"Lỗi\",\n        description: \"Vui lòng điền đầy đủ thông tin bắt buộc\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // If this template is set as default, we need to handle that\n    const templateData = {\n      ...templateForm,\n      name: templateForm.name.trim(),\n      templateNumber: templateForm.templateNumber.trim(),\n      templateCode: templateForm.templateCode.trim(), // Include templateCode\n      symbol: templateForm.symbol.trim(),\n      notes: templateForm.notes.trim() || null,\n    };\n\n    createTemplateMutation.mutate(templateData);\n  };\n\n  const handleUpdateTemplate = () => {\n    if (!templateForm.name.trim() || !templateForm.templateNumber.trim() || !templateForm.symbol.trim()) {\n      toast({\n        title: \"Lỗi\",\n        description: \"Vui lòng điền đầy đủ thông tin bắt buộc\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!editingTemplate) return;\n\n    const templateData = {\n      ...templateForm,\n      name: templateForm.name.trim(),\n      templateNumber: templateForm.templateNumber.trim(),\n      templateCode: templateForm.templateCode.trim(), // Include templateCode\n      symbol: templateForm.symbol.trim(),\n      notes: templateForm.notes.trim() || null,\n    };\n\n    updateTemplateMutation.mutate({\n      id: editingTemplate.id,\n      data: templateData,\n    });\n  };\n\n  const handleEditTemplate = (template: any) => {\n    setTemplateForm({\n      name: template.name || \"\",\n      templateNumber: template.templateNumber || \"\",\n      templateCode: template.templateCode || \"\", // Set templateCode from template\n      symbol: template.symbol || \"\",\n      useCK: template.useCK !== undefined ? template.useCK : true,\n      notes: template.notes || \"\",\n      isDefault: template.isDefault !== undefined ? template.isDefault : false,\n    });\n    setEditingTemplate(template);\n    setShowTemplateForm(true);\n  };\n\n  const handleDeleteTemplate = (id: number, name: string) => {\n    setTemplateToDelete({ id, name });\n    setShowTemplateDeleteDialog(true);\n  };\n\n  const confirmDeleteTemplate = () => {\n    if (!templateToDelete) return;\n    deleteTemplateMutation.mutate(templateToDelete.id);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 pt-20 relative\">\n      {/* Background Pattern */}\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <div\n          className=\"absolute inset-0 opacity-5\"\n          style={{\n            backgroundImage: `radial-gradient(circle at 25% 25%, #10b981 0%, transparent 50%),\n                           radial-gradient(circle at 75% 25%, #059669 0%, transparent 50%),\n                           radial-gradient(circle at 25% 75%, #065f46 0%, transparent 50%),\n                           radial-gradient(circle at 75% 75%, #059669 0%, transparent 50%)`,\n            backgroundSize: \"100px 100px\",\n          }}\n        ></div>\n      </div>\n\n      <div className=\"relative z-10 container mx-auto p-6\">\n        <div className=\"mb-8\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h1 className=\"text-3xl font-bold text-gray-900 mb-2 flex items-center gap-3\">\n                <SettingsIcon className=\"w-8 h-8 text-green-600\" />\n                {t(\"settings.title\")}\n              </h1>\n              <p className=\"text-gray-600\">{t(\"settings.description\")}</p>\n            </div>\n            <Button\n              onClick={() => (window.location.href = \"/pos\")}\n              variant=\"outline\"\n              className=\"bg-white hover:bg-green-50 border-green-200 text-green-700 hover:text-green-800\"\n            >\n              <Home className=\"w-4 h-4 mr-2\" />\n              {t(\"settings.backToPos\")}\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"w-full\">\n          <Tabs\n            value={activeTab}\n            onValueChange={setActiveTab}\n            className=\"space-y-6\"\n          >\n            <div className=\"w-full overflow-hidden\">\n              <TabsList\n                className=\"w-full flex flex-wrap items-center justify-center gap-2 bg-white/80 backdrop-blur-sm border border-gray-200 rounded-xl p-4 min-h-[70px]\"\n              >\n                <TabsTrigger\n                  value=\"store\"\n                  className=\"flex items-center gap-1.5 text-xs sm:text-sm px-2 sm:px-3 py-2 data-[state=active]:bg-green-500 data-[state=active]:text-white data-[state=active]:shadow-md hover:bg-green-100 transition-all duration-200 rounded-lg font-medium text-center flex-shrink-0\"\n                >\n                  <Store className=\"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0\" />\n                  <span className=\"hidden lg:inline\">\n                    {t(\"settings.storeInfo\")}\n                  </span>\n                  <span className=\"lg:hidden\">Cửa hàng</span>\n                </TabsTrigger>\n                <TabsTrigger\n                  value=\"customers\"\n                  className=\"flex items-center gap-1.5 text-xs sm:text-sm px-2 sm:px-3 py-2 data-[state=active]:bg-green-500 data-[state=active]:text-white data-[state=active]:shadow-md hover:bg-green-100 transition-all duration-200 rounded-lg font-medium text-center flex-shrink-0\"\n                >\n                  <UserCheck className=\"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0\" />\n                  <span className=\"hidden lg:inline\">\n                    {t(\"customers.title\")}\n                  </span>\n                  <span className=\"lg:hidden\">Khách hàng</span>\n                </TabsTrigger>\n                <TabsTrigger\n                  value=\"categories\"\n                  className=\"flex items-center gap-1.5 text-xs sm:text-sm px-2 sm:px-3 py-2 data-[state=active]:bg-green-500 data-[state=active]:text-white data-[state=active]:shadow-md hover:bg-green-100 transition-all duration-200 rounded-lg font-medium text-center flex-shrink-0\"\n                >\n                  <Package className=\"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0\" />\n                  <span className=\"hidden lg:inline\">\n                    {t(\"settings.categories\")}\n                  </span>\n                  <span className=\"lg:hidden\">Sản phẩm</span>\n                </TabsTrigger>\n                <TabsTrigger\n                  value=\"employees\"\n                  className=\"flex items-center gap-1.5 text-xs sm:text-sm px-2 sm:px-3 py-2 data-[state=active]:bg-green-500 data-[state=active]:text-white data-[state=active]:shadow-md hover:bg-green-100 transition-all duration-200 rounded-lg font-medium text-center flex-shrink-0\"\n                >\n                  <Users className=\"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0\" />\n                  <span className=\"hidden lg:inline\">\n                    {t(\"settings.employees\")}\n                  </span>\n                  <span className=\"lg:hidden\">Nhân viên</span>\n                </TabsTrigger>\n                <TabsTrigger\n                  value=\"payments\"\n                  className=\"flex items-center gap-1.5 text-xs sm:text-sm px-2 sm:px-3 py-2 data-[state=active]:bg-green-500 data-[state=active]:text-white data-[state=active]:shadow-md hover:bg-green-100 transition-all duration-200 rounded-lg font-medium text-center flex-shrink-0\"\n                >\n                  <CreditCard className=\"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0\" />\n                  <span className=\"hidden lg:inline\">\n                    {t(\"settings.paymentMethods\")}\n                  </span>\n                  <span className=\"lg:hidden\">Thanh toán</span>\n                </TabsTrigger>\n              </TabsList>\n            </div>\n\n            {/* Store Information Tab */}\n            <TabsContent value=\"store\">\n              <Tabs defaultValue=\"basic\" className=\"space-y-6\">\n                <TabsList\n                  className=\"flex justify-start md:justify-center gap-2 bg-white/80 backdrop-blur-sm border border-gray-200 rounded-xl p-2 py-4\"\n                >\n                  <TabsTrigger\n                    value=\"basic\"\n                    className=\"flex items-center gap-1.5 text-xs sm:text-sm px-3 sm:px-4 py-2 data-[state=active]:bg-green-500 data-[state=active]:text-white data-[state=active]:shadow-md hover:bg-green-100 transition-all duration-200 rounded-lg font-medium whitespace-nowrap flex-shrink-0\"\n                  >\n                    <Store className=\"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0\" />\n                    <span className=\"hidden md:inline\">\n                      {t(\"settings.basicInfo\")}\n                    </span>\n                    <span className=\"md:hidden\">Cơ bản</span>\n                  </TabsTrigger>\n                  <TabsTrigger\n                    value=\"einvoice\"\n                    className=\"flex items-center gap-1.5 text-xs sm:text-sm px-3 sm:px-4 py-2 data-[state=active]:bg-green-500 data-[state=active]:text-white data-[state=active]:shadow-md hover:bg-green-100 transition-all duration-200 rounded-lg font-medium whitespace-nowrap flex-shrink-0\"\n                  >\n                    <SettingsIcon className=\"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0\" />\n                    <span className=\"hidden md:inline\">\n                      {t(\"settings.einvoiceSetup\")}\n                    </span>\n                    <span className=\"md:hidden\">HĐĐT</span>\n                  </TabsTrigger>\n                  <TabsTrigger\n                    value=\"operations\"\n                    className=\"flex items-center gap-1.5 text-xs sm:text-sm px-3 sm:px-4 py-2 data-[state=active]:bg-green-500 data-[state=active]:text-white data-[state=active]:shadow-md hover:bg-green-100 transition-all duration-200 rounded-lg font-medium whitespace-nowrap flex-shrink-0\"\n                  >\n                    <Clock className=\"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0\" />\n                    <span className=\"hidden md:inline\">\n                      {t(\"settings.operations\")}\n                    </span>\n                    <span className=\"md:hidden\">HĐ</span>\n                  </TabsTrigger>\n                </TabsList>\n\n                <TabsContent value=\"basic\">\n                  <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n                    <Card className=\"bg-white/80 backdrop-blur-sm border-white/20\">\n                      <CardHeader>\n                        <CardTitle className=\"flex items-center gap-2\">\n                          <Store className=\"w-5 h-5 text-green-600\" />\n                          {t(\"settings.basicInfo\")}\n                        </CardTitle>\n                        <CardDescription>\n                          {t(\"settings.basicInfoDesc\")}\n                        </CardDescription>\n                      </CardHeader>\n                      <CardContent className=\"space-y-4\">\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"storeName\">\n                            {t(\"settings.storeName\")}\n                          </Label>\n                          <Input\n                            id=\"storeName\"\n                            value={storeSettings.storeName}\n                            onChange={(e) =>\n                              handleStoreSettingChange(\n                                \"storeName\",\n                                e.target.value,\n                              )\n                            }\n                            placeholder={t(\"settings.storeNamePlaceholder\")}\n                          />\n                        </div>\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"storeCode\">\n                            {t(\"settings.storeCode\")}\n                          </Label>\n                          <Input\n                            id=\"storeCode\"\n                            value={storeSettings.storeCode}\n                            onChange={(e) =>\n                              handleStoreSettingChange(\n                                \"storeCode\",\n                                e.target.value,\n                              )\n                            }\n                            placeholder={t(\"settings.storeCodePlaceholder\")}\n                          />\n                        </div>\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"taxId\">{t(\"settings.taxId\")}</Label>\n                          <Input\n                            id=\"taxId\"\n                            value={storeSettings.taxId}\n                            onChange={(e) =>\n                              handleStoreSettingChange(\"taxId\", e.target.value)\n                            }\n                            placeholder={t(\"settings.taxIdPlaceholder\")}\n                          />\n                        </div>\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"businessType\">\n                            {t(\"settings.businessType\")}\n                          </Label>\n                          <Select\n                            value={storeSettings.businessType}\n                            onValueChange={(value) =>\n                              handleStoreSettingChange(\"businessType\", value)\n                            }\n                          >\n                            <SelectTrigger>\n                              <SelectValue\n                                placeholder={t(\n                                  \"settings.businessTypePlaceholder\",\n                                )}\n                              />\n                            </SelectTrigger>\n                            <SelectContent>\n                              <SelectItem value=\"retail\">\n                                {t(\"settings.posRetail\")}\n                              </SelectItem>\n                              <SelectItem value=\"restaurant\">\n                                {t(\"settings.posRestaurant\")}\n                              </SelectItem>\n                            </SelectContent>\n                          </Select>\n                        </div>\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"pinCode\">\n                            {t(\"settings.pinCodeLabel\")}\n                          </Label>\n                          <Input\n                            id=\"pinCode\"\n                            type=\"password\"\n                            value={storeSettings.pinCode}\n                            onChange={(e) => {\n                              const value = e.target.value.replace(/\\D/g, ''); // Chỉ cho phép số\n                              handleStoreSettingChange(\"pinCode\", value);\n                            }}\n                            placeholder={t(\"settings.pinCodePlaceholder\")}\n                            maxLength={6}\n                            pattern=\"[0-9]*\"\n                          />\n                          {storeSettings.pinCode && storeSettings.pinCode.length < 4 && (\n                            <p className=\"text-sm text-orange-500\">\n                              Mã PIN nên có ít nhất 4 chữ số\n                            </p>\n                          )}\n                        </div>\n                      </CardContent>\n                    </Card>\n\n                    <Card className=\"bg-white/80 backdrop-blur-sm border-white/20\">\n                      <CardHeader>\n                        <CardTitle className=\"flex items-center gap-2\">\n                          <MapPin className=\"w-5 h-5 text-green-600\" />\n                          {t(\"settings.contactInfo\")}\n                        </CardTitle>\n                        <CardDescription>\n                          {t(\"settings.contactInfoDesc\")}\n                        </CardDescription>\n                      </CardHeader>\n                      <CardContent className=\"space-y-4\">\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"address\">\n                            {t(\"settings.address\")}\n                          </Label>\n                          <Textarea\n                            id=\"address\"\n                            value={storeSettings.address}\n                            onChange={(e) =>\n                              handleStoreSettingChange(\n                                \"address\",\n                                e.target.value,\n                              )\n                            }\n                            placeholder={t(\"settings.addressPlaceholder\")}\n                            rows={3}\n                          />\n                        </div>\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"phone\">{t(\"settings.phone\")}</Label>\n                          <Input\n                            id=\"phone\"\n                            type=\"tel\"\n                            value={storeSettings.phone}\n                            onChange={(e) =>\n                              handleStoreSettingChange(\"phone\", e.target.value)\n                            }\n                            placeholder={t(\"settings.phonePlaceholder\")}\n                          />\n                        </div>\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"email\">{t(\"settings.email\")}</Label>\n                          <Input\n                            id=\"email\"\n                            type=\"email\"\n                            value={storeSettings.email}\n                            onChange={(e) =>\n                              handleStoreSettingChange(\"email\", e.target.value)\n                            }\n                            placeholder={t(\"settings.emailPlaceholder\")}\n                          />\n                        </div>\n                      </CardContent>\n                    </Card>\n                  </div>\n                  <div className=\"flex justify-end mt-6\">\n                    <Button\n                      onClick={saveStoreSettings}\n                      disabled={updateStoreSettingsMutation.isPending}\n                      className=\"bg-green-600 hover:bg-green-700\"\n                    >\n                      <Save className=\"w-4 h-4 mr-2\" />\n                      {updateStoreSettingsMutation.isPending\n                        ? t(\"common.loading\")\n                        : t(\"common.save\")}\n                    </Button>\n                  </div>\n                </TabsContent>\n\n                <TabsContent value=\"einvoice\">\n                  <Card className=\"bg-white/80 backdrop-blur-sm border-white/20\">\n                    <CardHeader>\n                      <CardTitle className=\"flex items-center gap-2\">\n                        <SettingsIcon className=\"w-5 h-5 text-green-600\" />\n                        {t(\"settings.einvoiceSetup\")}\n                      </CardTitle>\n                      <CardDescription>\n                        {t(\"settings.einvoiceDesc\")}\n                      </CardDescription>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"space-y-6\">\n                        {/* Sub tabs for E-invoice */}\n                        <Tabs defaultValue=\"connections\" className=\"w-full\">\n                          <TabsList\n                            className=\"grid grid-cols-2 h-10 items-center justify-center gap-1 bg-white/80 backdrop-blur-sm border border-gray-200 rounded-xl p-1\"\n                          >\n                            <TabsTrigger\n                              value=\"connections\"\n                              className=\"text-xs sm:text-sm px-2 sm:px-3 py-1.5 data-[state=active]:bg-green-500 data-[state=active]:text-white data-[state=active]:shadow-md hover:bg-green-100 transition-all duration-200 rounded-md font-medium\"\n                            >\n                              <span className=\"hidden md:inline\">\n                                {t(\"settings.connectionManagement\")}\n                              </span>\n                              <span className=\"md:hidden\">Kết nối</span>\n                            </TabsTrigger>\n                            <TabsTrigger\n                              value=\"settings\"\n                              className=\"text-xs sm:text-sm px-2 sm:px-3 py-1.5 data-[state=active]:bg-green-500 data-[state=active]:text-white data-[state=active]:shadow-md hover:bg-green-100 transition-all duration-200 rounded-md font-medium\"\n                            >\n                              <span className=\"hidden md:inline\">\n                                {t(\"settings.templateManagement\")}\n                              </span>\n                              <span className=\"md:hidden\">Mẫu số</span>\n                            </TabsTrigger>\n                          </TabsList>\n\n                          <TabsContent value=\"connections\" className=\"mt-6\">\n                            <div className=\"flex justify-between items-center mb-6\">\n                              <div>\n                                <h3 className=\"text-lg font-medium\">\n                                  {t(\"settings.connectionsList\")}\n                                </h3>\n                                <p className=\"text-sm text-gray-600\">\n                                  {t(\"settings.connectionsDesc\")}\n                                </p>\n                              </div>\n                              <Button\n                                onClick={() => {\n                                  resetEInvoiceForm();\n                                  setShowEInvoiceForm(true);\n                                }}\n                                className=\"bg-blue-600 hover:bg-blue-700\"\n                              >\n                                <Plus className=\"w-4 h-4 mr-2\" />\n                                {t(\"settings.addConnection\")}\n                              </Button>\n                            </div>\n\n                            {/* E-invoice connections table */}\n                            <div className=\"w-full overflow-x-auto border rounded-md bg-white\">\n                              <table className=\"w-full min-w-[1200px] table-fixed\">\n                                <thead>\n                                  <tr className=\"bg-gray-50 border-b\">\n                                    <th className=\"w-[60px] px-3 py-3 text-center font-medium text-sm text-gray-600\">\n                                      <div className=\"leading-tight\">{t(\"settings.symbolLabel\")}</div>\n                                    </th>\n                                    <th className=\"w-[120px] px-3 py-3 text-left font-medium text-sm text-gray-600\">\n                                      <div className=\"leading-tight\">{t(\"settings.taxIdLabel\")}</div>\n                                    </th>\n                                    <th className=\"w-[120px] px-3 py-3 text-left font-medium text-sm text-gray-600\">\n                                      <div className=\"leading-tight\">{t(\"settings.loginIdLabel\")}</div>\n                                    </th>\n                                    <th className=\"w-[80px] px-3 py-3 text-left font-medium text-sm text-gray-600\">\n                                      <div className=\"leading-tight\">{t(\"settings.passwordLabel\")}</div>\n                                    </th>\n                                    <th className=\"w-[120px] px-3 py-3 text-left font-medium text-sm text-gray-600\">\n                                      <div className=\"leading-tight\">{t(\"settings.softwareLabel\")}</div>\n                                    </th>\n                                    <th className=\"w-[180px] px-3 py-3 text-left font-medium text-sm text-gray-600\">\n                                      <div className=\"leading-tight\">{t(\"settings.loginUrlLabel\")}</div>\n                                    </th>\n                                    <th className=\"w-[120px] px-3 py-3 text-left font-medium text-sm text-gray-600\">\n                                      <div className=\"leading-tight\">{t(\"settings.signMethodLabel\")}</div>\n                                    </th>\n                                    <th className=\"w-[100px] px-3 py-3 text-left font-medium text-sm text-gray-600\">\n                                      <div className=\"leading-tight\">{t(\"settings.cqtCodeLabel\")}</div>\n                                    </th>\n                                    <th className=\"w-[100px] px-3 py-3 text-left font-medium text-sm text-gray-600\">\n                                      <div className=\"leading-tight\">{t(\"common.notes\")}</div>\n                                    </th>\n                                    <th className=\"w-[80px] px-3 py-3 text-center font-medium text-sm text-gray-600\">\n                                      <div className=\"leading-tight\">{t(\"settings.defaultConnection\")}</div>\n                                    </th>\n                                    <th className=\"w-[100px] px-3 py-3 text-center font-medium text-sm text-gray-600\">\n                                      <div className=\"leading-tight\">{t(\"common.actions\")}</div>\n                                    </th>\n                                  </tr>\n                                </thead>\n                                <tbody className=\"divide-y\">\n                                  {eInvoiceConnections.length === 0 ? (\n                                    <tr>\n                                      <td colSpan={11} className=\"p-8 text-center text-sm text-gray-500\">\n                                        <div className=\"flex flex-col items-center gap-2\">\n                                          <SettingsIcon className=\"w-8 h-8 text-gray-400\" />\n                                          <p>Chưa có kết nối HĐĐT nào</p>\n                                          <p className=\"text-xs\">\n                                            Nhấn \"Thêm kết nối\" để bắt đầu\n                                          </p>\n                                        </div>\n                                      </td>\n                                    </tr>\n                                  ) : (\n                                    eInvoiceConnections.map((connection) => (\n                                      <tr key={connection.id} className=\"hover:bg-gray-50\">\n                                        <td className=\"px-3 py-3 text-center\">\n                                          <div className=\"text-sm\">{connection.symbol}</div>\n                                        </td>\n                                        <td className=\"px-3 py-3\">\n                                          <div className=\"text-sm font-mono truncate\" title={connection.taxCode}>\n                                            {connection.taxCode}\n                                          </div>\n                                        </td>\n                                        <td className=\"px-3 py-3\">\n                                          <div className=\"text-sm truncate\" title={connection.loginId}>\n                                            {connection.loginId}\n                                          </div>\n                                        </td>\n                                        <td className=\"px-3 py-3\">\n                                          <div className=\"text-sm font-mono\">\n                                            *********\n                                          </div>\n                                        </td>\n                                        <td className=\"px-3 py-3\">\n                                          <Badge variant=\"outline\" className=\"text-xs\">\n                                            {connection.softwareName}\n                                          </Badge>\n                                        </td>\n                                        <td className=\"px-3 py-3\">\n                                          <div \n                                            className=\"text-sm text-blue-600 hover:underline cursor-pointer truncate\" \n                                            title={connection.loginUrl}\n                                          >\n                                            {connection.loginUrl}\n                                          </div>\n                                        </td>\n                                        <td className=\"px-3 py-3\">\n                                          <div className=\"text-sm truncate\" title={connection.signMethod}>\n                                            {connection.signMethod}\n                                          </div>\n                                        </td>\n                                        <td className=\"px-3 py-3\">\n                                          <div className=\"text-sm truncate\" title={connection.cqtCode}>\n                                            {connection.cqtCode}\n                                          </div>\n                                        </td>\n                                        <td className=\"px-3 py-3\">\n                                          <div className=\"text-sm truncate\" title={connection.notes || \"-\"}>\n                                            {connection.notes || \"-\"}\n                                          </div>\n                                        </td>\n                                        <td className=\"px-3 py-3 text-center\">\n                                          <input\n                                            type=\"checkbox\"\n                                            className=\"rounded\"\n                                            checked={connection.isDefault}\n                                            readOnly\n                                          />\n                                        </td>\n                                        <td className=\"px-3 py-3\">\n                                          <div className=\"flex items-center justify-center gap-1\">\n                                            <Button\n                                              variant=\"ghost\"\n                                              size=\"sm\"\n                                              onClick={() => {\n                                                console.log(\"Edit button clicked for connection:\", connection);\n                                                handleEditEInvoice(connection);\n                                              }}\n                                            >\n                                              <Edit className=\"w-3 h-3\" />\n                                            </Button>\n                                            <Button\n                                              variant=\"ghost\"\n                                              size=\"sm\"\n                                              className=\"text-red-500 hover:text-red-700\"\n                                              onClick={() =>\n                                                handleDeleteEInvoice(\n                                                  connection.id,\n                                                  connection.softwareName,\n                                                )\n                                              }\n                                            >\n                                              <Trash2 className=\"w-3 h-3\" />\n                                            </Button>\n                                          </div>\n                                        </td>\n                                      </tr>\n                                    ))\n                                  )}\n                                </tbody>\n                              </table>\n                            </div>\n                          </TabsContent>\n\n                          <TabsContent value=\"settings\" className=\"mt-6\">\n                            <div className=\"space-y-6\">\n                              <div className=\"flex justify-between items-center\">\n                                <div>\n                                  <h3 className=\"text-lg font-medium\">\n                                    {t(\"settings.templateManagement\")}\n                                  </h3>\n                                  <p className=\"text-sm text-gray-600\">\n                                    {t(\"settings.templatesDesc\")}\n                                  </p>\n                                </div>\n                                <Button \n                                  className=\"bg-blue-600 hover:bg-blue-700\"\n                                  onClick={() => {\n                                    resetTemplateForm();\n                                    setShowTemplateForm(true);\n                                  }}\n                                >\n                                  <Plus className=\"w-4 h-4 mr-2\" />\n                                  {t(\"settings.addTemplate\")}\n                                </Button>\n                              </div>\n\n                              {/* Invoice templates table */}\n                              <div className=\"w-full overflow-x-auto border rounded-md bg-white\">\n                                <table className=\"w-full min-w-[1000px] table-fixed\">\n                                  <thead>\n                                    <tr className=\"bg-gray-50 border-b\">\n                                      <th className=\"w-[60px] px-3 py-3 text-center font-medium text-sm text-gray-600\">\n                                        <div className=\"leading-tight\">{t(\"settings.templateIndex\")}</div>\n                                      </th>\n                                      <th className=\"w-[120px] px-3 py-3 text-left font-medium text-sm text-gray-600\">\n                                        <div className=\"leading-tight\">{t(\"settings.templateName\")}</div>\n                                      </th>\n                                      <th className=\"w-[130px] px-3 py-3 text-left font-medium text-sm text-gray-600\">\n                                        <div className=\"leading-tight\">{t(\"settings.templateNumber\")}</div>\n                                      </th>\n                                      <th className=\"w-[160px] px-3 py-3 text-left font-medium text-sm text-gray-600\">\n                                        <div className=\"leading-tight\">{t(\"settings.templateCode\")}</div>\n                                      </th>\n                                      <th className=\"w-[100px] px-3 py-3 text-left font-medium text-sm text-gray-600\">\n                                        <div className=\"leading-tight\">{t(\"settings.templateSymbol\")}</div>\n                                      </th>\n                                      <th className=\"w-[120px] px-3 py-3 text-center font-medium text-sm text-gray-600\">\n                                        <div className=\"leading-tight\">{t(\"common.templateUsage\")}</div>\n                                      </th>\n                                      <th className=\"w-[120px] px-3 py-3 text-left font-medium text-sm text-gray-600\">\n                                        <div className=\"leading-tight\">{t(\"common.notes\")}</div>\n                                      </th>\n                                      <th className=\"w-[80px] px-3 py-3 text-center font-medium text-sm text-gray-600\">\n                                        <div className=\"leading-tight\">{t(\"settings.templateDefault\")}</div>\n                                      </th>\n                                      <th className=\"w-[110px] px-3 py-3 text-center font-medium text-sm text-gray-600\">\n                                        <div className=\"leading-tight\">{t(\"common.actions\")}</div>\n                                      </th>\n                                    </tr>\n                                  </thead>\n                                  <tbody className=\"divide-y\">\n                                    {templatesLoading ? (\n                                      <tr>\n                                        <td colSpan={9} className=\"p-8 text-center text-sm text-gray-500\">\n                                          Đang tải dữ liệu...\n                                        </td>\n                                      </tr>\n                                    ) : invoiceTemplates.length === 0 ? (\n                                      <tr>\n                                        <td colSpan={9} className=\"p-8 text-center text-sm text-gray-500\">\n                                          <div className=\"flex flex-col items-center gap-2\">\n                                            <SettingsIcon className=\"w-8 h-8 text-gray-400\" />\n                                            <p>Chưa có mẫu số HĐĐT nào</p>\n                                            <p className=\"text-xs\">\n                                              Nhấn \"Thêm mẫu số\" để bắt đầu\n                                            </p>\n                                          </div>\n                                        </td>\n                                      </tr>\n                                    ) : (\n                                      invoiceTemplates.map((template, index) => (\n                                        <tr key={template.id} className=\"hover:bg-gray-50\">\n                                          <td className=\"px-3 py-3 text-center\">\n                                            <div className=\"text-sm\">{index + 1}</div>\n                                          </td>\n                                          <td className=\"px-3 py-3\">\n                                            <div className=\"text-sm font-medium truncate\" title={template.name}>\n                                              {template.name}\n                                            </div>\n                                          </td>\n                                          <td className=\"px-3 py-3\">\n                                            <div className=\"text-sm truncate\" title={template.templateNumber}>\n                                              {template.templateNumber}\n                                            </div>\n                                          </td>\n                                          <td className=\"px-3 py-3\">\n                                            <div className=\"text-sm truncate\" title={template.templateCode}>\n                                              {template.templateCode || \"-\"}\n                                            </div>\n                                          </td>\n                                          <td className=\"px-3 py-3\">\n                                            <div className=\"text-sm truncate\" title={template.symbol}>\n                                              {template.symbol}\n                                            </div>\n                                          </td>\n                                          <td className=\"px-3 py-3 text-center\">\n                                            <Badge\n                                              variant=\"default\"\n                                              className={`text-xs ${template.useCK ? \"bg-green-100 text-green-800\" : \"bg-gray-100 text-gray-800\"}`}\n                                            >\n                                              {template.useCK ? \"Sử dụng\" : \"Không sử dụng\"}\n                                            </Badge>\n                                          </td>\n                                          <td className=\"px-3 py-3\">\n                                            <div className=\"text-sm truncate\" title={template.notes || \"-\"}>\n                                              {template.notes || \"-\"}\n                                            </div>\n                                          </td>\n                                          <td className=\"px-3 py-3 text-center\">\n                                            <input\n                                              type=\"checkbox\"\n                                              className=\"rounded\"\n                                              checked={template.isDefault}\n                                              readOnly\n                                            />\n                                          </td>\n                                          <td className=\"px-3 py-3\">\n                                            <div className=\"flex items-center justify-center gap-1\">\n                                              <Button \n                                                variant=\"ghost\" \n                                                size=\"sm\"\n                                                onClick={() => handleEditTemplate(template)}\n                                              >\n                                                <Edit className=\"w-3 h-3\" />\n                                              </Button>\n                                              <Button \n                                                variant=\"ghost\" \n                                                size=\"sm\" \n                                                className=\"text-red-500 hover:text-red-700\"\n                                                onClick={() => handleDeleteTemplate(template.id, template.name)}\n                                              >\n                                                <Trash2 className=\"w-3 h-3\" />\n                                              </Button>\n                                            </div>\n                                          </td>\n                                        </tr>\n                                      ))\n                                    )}\n                                  </tbody>\n                                </table>\n                              </div>\n                            </div>\n                          </TabsContent>\n                        </Tabs>\n                      </div>\n                    </CardContent>\n                  </Card>\n                </TabsContent>\n\n                <TabsContent value=\"operations\">\n                  <Card className=\"bg-white/80 backdrop-blur-sm border-white/20\">\n                    <CardHeader>\n                      <CardTitle className=\"flex items-center gap-2\">\n                        <Clock className=\"w-5 h-5 text-green-600\" />\n                        {t(\"settings.operationHours\")}\n                      </CardTitle>\n                      <CardDescription>\n                        {t(\"settings.operationHoursDesc\")}\n                      </CardDescription>\n                    </CardHeader>\n                    <CardContent className=\"space-y-4\">\n                      <div className=\"grid grid-cols-2 gap-4\">\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"openTime\">\n                            {t(\"settings.openTime\")}\n                          </Label>\n                          <Input\n                            id=\"openTime\"\n                            type=\"time\"\n                            value={storeSettings.openTime}\n                            onChange={(e) =>\n                              handleStoreSettingChange(\n                                \"openTime\",\n                                e.target.value,\n                              )\n                            }\n                          />\n                        </div>\n                        <div className=\"space-y-2\">\n                          <Label htmlFor=\"closeTime\">\n                            {t(\"settings.closeTime\")}\n                          </Label>\n                          <Input\n                            id=\"closeTime\"\n                            type=\"time\"\n                            value={storeSettings.closeTime}\n                            onChange={(e) =>\n                              handleStoreSettingChange(\n                                \"closeTime\",\n                                e.target.value,\n                              )\n                            }\n                          />\n                        </div>\n                      </div>\n                      <div className=\"flex justify-end mt-6\">\n                        <Button\n                          onClick={saveStoreSettings}\n                          disabled={updateStoreSettingsMutation.isPending}\n                          className=\"bg-green-600 hover:bg-green-700\"\n                        >\n                          <Save className=\"w-4 h-4 mr-2\" />\n                          {updateStoreSettingsMutation.isPending\n                            ? t(\"common.loading\")\n                            : t(\"common.save\")}\n                        </Button>\n                      </div>\n                    </CardContent>\n                  </Card>\n                </TabsContent>\n              </Tabs>\n            </TabsContent>\n\n            {/* Customers Tab */}\n            <TabsContent value=\"customers\">\n              <div className=\"space-y-6\">\n                {/* Customer Statistics */}\n                <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6\">\n                  <Card className=\"bg-white/80 backdrop-blur-sm border-white/20\">\n                    <CardContent className=\"p-6\">\n                      <div className=\"flex items-center justify-between\">\n                        <div>\n                          <p className=\"text-sm font-medium text-gray-600\">\n                            {t(\"customers.totalCustomers\")}\n                          </p>\n                          <p className=\"text-2xl font-bold text-green-600\">\n                            {customersData ? customersData.length : 0}\n                          </p>\n                        </div>\n                        <UserCheck className=\"w-8 h-8 text-green-600\" />\n                      </div>\n                    </CardContent>\n                  </Card>\n\n                  <Card className=\"bg-white/80 backdrop-blur-sm border-white/20\">\n                    <CardContent className=\"p-6\">\n                      <div className=\"flex items-center justify-between\">\n                        <div>\n                          <p className=\"text-sm font-medium text-gray-600\">\n                            {t(\"customers.activeCustomers\")}\n                          </p>\n                          <p className=\"text-2xl font-bold text-blue-600\">\n                            {customersData\n                              ? customersData.filter(\n                                  (c) => c.status === \"active\",\n                                ).length\n                              : 0}\n                          </p>\n                        </div>\n                        <Users className=\"w-8 h-8 text-blue-600\" />\n                      </div>\n                    </CardContent>\n                  </Card>\n\n                  <Card className=\"bg-white/80 backdrop-blur-sm border-white/20\">\n                    <CardContent className=\"p-6\">\n                      <div className=\"flex items-center justify-between\">\n                        <div>\n                          <p className=\"text-sm font-medium text-gray-600\">\n                            {t(\"customers.pointsIssued\")}\n                          </p>\n                          <p className=\"text-2xl font-bold text-purple-600\">\n                            {customersData\n                              ? customersData\n                                  .reduce(\n                                    (total, c) => total + (c.points || 0),\n                                    0,\n                                  )\n                                  .toLocaleString()\n                              : 0}\n                          </p>\n                        </div>\n                        <CreditCard className=\"w-8 h-8 text-purple-600\" />\n                      </div>\n                    </CardContent>\n                  </Card>\n\n                  <Card className=\"bg-white/80 backdrop-blur-sm border-white/20\">\n                    <CardContent className=\"p-6\">\n                      <div className=\"flex items-center justify-between\">\n                        <div>\n                          <p className=\"text-sm font-medium text-gray-600\">\n                            {t(\"customers.averageSpent\")}\n                          </p>\n                          <p className=\"text-2xl font-bold text-orange-600\">\n                            {customersData && customersData.length > 0\n                              ? Math.round(\n                                  customersData.reduce(\n                                    (total, c) =>\n                                      total + parseFloat(c.totalSpent || \"0\"),\n                                    0,\n                                  ) / customersData.length,\n                                ).toLocaleString()\n                              : \"0\"}{\" \"}\n                            ₫\n                          </p>\n                        </div>\n                        <CreditCard className=\"w-8 h-8 text-orange-600\" />\n                      </div>\n                    </CardContent>\n                  </Card>\n                </div>\n\n                {/* Customer Management */}\n                <Card className=\"bg-white/80 backdrop-blur-sm border-white/20\">\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center gap-2\">\n                      <UserCheck className=\"w-5 h-5 text-green-600\" />\n                      {t(\"customers.customerManagement\")}\n                    </CardTitle>\n                    <CardDescription>\n                      {t(\"customers.description\")}\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"flex justify-between items-center mb-6\">\n                      <div className=\"flex items-center gap-4\">\n                        <Input\n                          placeholder={t(\"customers.searchPlaceholder\")}\n                          className=\"w-64\"\n                          value={customerSearchTerm}\n                          onChange={(e) =>\n                            setCustomerSearchTerm(e.target.value)\n                          }\n                        />\n                        <Button variant=\"outline\" size=\"sm\">\n                          <Search className=\"w-4 h-4 mr-2\" />\n                          {t(\"common.search\")}\n                        </Button>\n                      </div>\n                      <Button\n                        className=\"bg-green-600 hover:bg-green-700\"\n                        onClick={() => setShowCustomerForm(true)}\n                      >\n                        <Plus classNameName=\"w-4 h-4 mr-2\" />\n                        {t(\"customers.addCustomer\")}\n                      </Button>\n                    </div>\n\n                    {customersLoading ? (\n                      <div className=\"text-center py-8\">\n                        <p className=\"text-gray-500\">\n                          {t(\"customers.loadingCustomerData\")}\n                        </p>\n                      </div>\n                    ) : filteredCustomers.length === 0 ? (\n                      <div className=\"text-center py-8\">\n                        <UserCheck className=\"w-12 h-12 mx-auto text-gray-400 mb-4\" />\n                        <p className=\"text-gray-500\">\n                          {t(\"customers.noRegisteredCustomers\")}\n                        </p>\n                      </div>\n                    ) : (\n                      <div className=\"rounded-md border\">\n                        <div className=\"grid grid-cols-8 gap-4 p-4 font-medium text-sm text-gray-600 bg-gray-50 border-b\">\n                          <div>{t(\"customers.customerId\")}</div>\n                          <div>{t(\"customers.name\")}</div>\n                          <div>{t(\"customers.phone\")}</div>\n                          <div>{t(\"customers.visitCount\")}</div>\n                          <div>{t(\"customers.totalSpent\")}</div>\n                          <div>{t(\"customers.points\")}</div>\n                          <div>{t(\"customers.membershipLevel\")}</div>\n                          <div className=\"text-center\">\n                            {t(\"common.actions\")}\n                          </div>\n                        </div>\n\n                        <div className=\"divide-y\">\n                          {filteredCustomers.map((customer) => (\n                            <div\n                              key={customer.id}\n                              className=\"grid grid-cols-8 gap-4 p-4 items-center\"\n                            >\n                              <div className=\"font-mono text-sm\">\n                                {customer.customerId}\n                              </div>\n                              <div className=\"font-medium\">{customer.name}</div>\n                              <div className=\"text-sm text-gray-600\">\n                                {customer.phone || \"-\"}\n                              </div>\n                              <div className=\"text-center\">\n                                {customer.visitCount || 0}\n                              </div>\n                              <div className=\"text-sm font-medium\">\n                                {parseFloat(\n                                  customer.totalSpent || \"0\",\n                                ).toLocaleString()}{\" \"}\n                                ₫\n                              </div>\n                              <div className=\"text-center\">\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"sm\"\n                                  className=\"font-medium text-purple-600 hover:text-purple-700 hover:bg-purple-50\"\n                                  onClick={() => handleManagePoints(customer)}\n                                >\n                                  {customer.points || 0}P\n                                </Button>\n                              </div>\n                              <div>\n                                <Badge\n                                                                 variant=\"default\"\n                                  className={`${\n                                    customer.membershipLevel === \"VIP\"\n                                      ? \"bg-purple-500\"\n                                      : customer.membershipLevel === \"GOLD\"\n                                        ? \"bg-yellow-500\"\n                                        : customer.membershipLevel === \"SILVER\"\n                                          ? \"bg-gray-300 text-black\"\n                                          : \"bg-gray-400\"\n                                  } text-white`}\n                                >\n                                  {customer.membershipLevel === \"VIP\"\n                                    ? t(\"customers.vip\")\n                                    : customer.membershipLevel === \"GOLD\"\n                                      ? t(\"customers.gold\")\n                                      : customer.membershipLevel === \"SILVER\"\n                                        ? t(\"customers.silver\")\n                                        : customer.membershipLevel}\n                                </Badge>\n                              </div>\n                              <div className=\"flex items-center justify-center gap-2\">\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"sm\"\n                                  onClick={() => handleEditCustomer(customer)}\n                                >\n                                  <Edit className=\"w-4 h-4\" />\n                                </Button>\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"sm\"\n                                  className=\"text-blue-500 hover:text-blue-700\"\n                                  onClick={() => handleManagePoints(customer)}\n                                >\n                                  <CreditCard className=\"w-4 h-4\" />\n                                </Button>\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"sm\"\n                                  className=\"text-red-500 hover:text-red-700\"\n                                  onClick={() =>\n                                    handleDeleteCustomer(\n                                      customer.id,\n                                      customer.name,\n                                    )\n                                  }\n                                >\n                                  <Trash2 className=\"w-4 h-4\" />\n                                </Button>\n                              </div>\n                            </div>\n                          ))}\n                        </div>\n                      </div>\n                    )}\n\n                    <div className=\"flex justify-between items-center mt-6\">\n                      <div className=\"text-sm text-gray-600\">\n                        {t(\"customers.total\")}{\" \"}\n                        {customersData ? customersData.length : 0}{\" \"}\n                        {t(\"customers.totalCustomersRegistered\")}\n                      </div>\n                      <div className=\"flex gap-2\">\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => setShowMembershipModal(true)}\n                        >\n                          <UserCheck className=\"w-4 h-4 mr-2\" />\n                          {t(\"customers.membershipManagement\")}\n                        </Button>\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => setShowPointsManagementModal(true)}\n                        >\n                          <CreditCard className=\"w-4 h-4 mr-2\" />\n                          {t(\"customers.pointsManagement\")}\n                        </Button>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n            </TabsContent>\n\n            {/* Categories Tab - Product Management */}\n            <TabsContent value=\"categories\">\n              <div className=\"space-y-6\">\n                {/* Statistics Cards */}\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                  <Card className=\"bg-white/80 backdrop-blur-sm border-white/20\">\n                    <CardContent className=\"p-6\">\n                      <div className=\"flex items-center justify-between\">\n                        <div>\n                          <p className=\"text-sm font-medium text-gray-600\">\n                            {t(\"settings.totalCategories\")}\n                          </p>\n                          <p className=\"text-2xl font-bold text-green-600\">\n                            {categoriesData ? categoriesData.length : 0}\n                          </p>\n                        </div>\n                        <Tag className=\"w-8 h-8 text-green-600\" />\n                      </div>\n                    </CardContent>\n                  </Card>\n\n                  <Card className=\"bg-white/80 backdrop-blur-sm border-white/20\">\n                    <CardContent className=\"p-6\">\n                      <div className=\"flex items-center justify-between\">\n                        <div>\n                          <p className=\"text-sm font-medium text-gray-600\">\n                            {t(\"settings.totalProducts\")}\n                          </p>\n                          <p className=\"text-2xl font-bold text-blue-600\">\n                            {productsData ? productsData.length : 0}\n                          </p>\n                        </div>\n                        <ShoppingCart className=\"w-8h-8 text-blue-600\" />\n                      </div>\n                    </CardContent>\n                  </Card>\n\n                  <Card className=\"bg-white/80 backdrop-blur-sm border-white/20\">\n                    <CardContent className=\"p-6\">\n                      <div className=\"flex items-center justify-between\">\n                        <div>\n                          <p className=\"text-sm font-medium text-gray-600\">\n                            {t(\"settings.totalStockQuantity\")}\n                          </p>\n                          <p className=\"text-2xl font-bold text-purple-600\">\n                            {productsData\n                              ? productsData.reduce(\n                                  (total: number, product: any) =>\n                                    total + (product.stock || 0),\n                                  0,\n                                )\n                              : 0}\n                          </p>\n                        </div>\n                        <Package className=\"w-8 h-8 text-purple-600\" />\n                      </div>\n                    </CardContent>\n                  </Card>\n                </div>\n\n                {/* Category Management */}\n                <Card className=\"bg-white/80 backdrop-blur-sm border-white/20\">\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center gap-2\">\n                      <Tag className=\"w-5 h-5 text-green-600\" />\n                      {t(\"settings.categoryTitle\")}\n                    </CardTitle>\n                    <CardDescription>\n                      {t(\"settings.categoryManagementDesc\")}\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"flex justify-between items-center mb-6\">\n                      <div className=\"flex items-center gap-4\">\n                        <Input\n                          placeholder={t(\n                            \"settings.searchCategoriesPlaceholder\",\n                          )}\n                          className=\"w-64\"\n                        />\n                        <Button variant=\"outline\" size=\"sm\">\n                          <Search className=\"w-4 h-4 mr-2\" />\n                          {t(\"common.search\")}\n                        </Button>\n                      </div>\n                      <Button\n                        className=\"bg-green-600 hover:bg-green-700\"\n                        onClick={() => {\n                          resetCategoryForm();\n                          setShowCategoryForm(true);\n                        }}\n                      >\n                        <Plus className=\"w-4 h-4 mr-2\" />\n                        {t(\"settings.addCategory\")}\n                      </Button>\n                    </div>\n\n                    {categoriesLoading ? (\n                      <div className=\"text-center py-8\">\n                        <p className=\"text-gray-500\">{t(\"common.loading\")}</p>\n                      </div>\n                    ) : !categoriesData || categoriesData.length === 0 ? (\n                      <div className=\"text-center py-8\">\n                        <Tag className=\"w-12 h-12 mx-auto text-gray-400 mb-4\" />\n                        <p className=\"text-gray-500\">\n                          {t(\"settings.noCategories\")}\n                        </p>\n                      </div>\n                    ) : (\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                        {categoriesData.map((category: any) => (\n                          <Card\n                            key={category.id}\n                            className=\"border-2 hover:border-green-300 transition-colors\"\n                          >\n                            <CardContent className=\"p-4\">\n                              <div className=\"flex items-center justify-between mb-3\">\n                                <div className=\"flex items-center gap-3\">\n                                  {category.icon && (\n                                    <div className=\"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center\">\n                                      <span className=\"text-xl\">\n                                        {category.icon === \"fas fa-utensils\"\n                                          ? \"🍽️\"\n                                          : category.icon === \"fas fa-coffee\"\n                                            ? \"☕\"\n                                            : category.icon === \"fas fa-cookie\"\n                                              ? \"🍪\"\n                                              : category.icon ===\n                                                  \"fas fa-ice-cream\"\n                                                ? \"🍨\"\n                                                : category.icon ===\n                                                    \"fas fa-beer\"\n                                                  ? \"🍺\"\n                                                  : category.icon ===\n                                                      \"fas fa-apple-alt\"\n                                                    ? \"🍎\"\n                                                    : \"🍽️\"}\n                                      </span>\n                                    </div>\n                                  )}\n                                  <div>\n                                    <h3 className=\"font-semibold\">\n                                      {category.name}\n                                    </h3>\n                                    <p className=\"text-sm text-gray-500\">\n                                      {productsData\n                                        ? productsData.filter(\n                                            (p: any) =>\n                                              p.categoryId === category.id,\n                                          ).length\n                                        : 0}{\" \"}\n                                      sản phẩm\n                                    </p>\n                                  </div>\n                                </div>\n                                <div className=\"flex gap-1\">\n                                  <Button\n                                    variant=\"ghost\"\n                                    size=\"sm\"\n                                    onClick={() => handleEditCategory(category)}\n                                  >\n                                    <Edit className=\"w-4 h-4\" />\n                                  </Button>\n                                  <Button\n                                    variant=\"ghost\"\n                                    size=\"sm\"\n                                    className=\"text-red-500 hover:text-red-700\"\n                                    onClick={() =>\n                                      handleDeleteCategory(category.id)\n                                    }\n                                  >\n                                    <Trash2 className=\"w-4 h-4\" />\n                                  </Button>\n                                </div>\n                              </div>\n                            </CardContent>\n                          </Card>\n                        ))}\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n\n                {/* Product Management */}\n                <Card className=\"bg-white/80 backdrop-blur-sm border-white/20\">\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center gap-2\">\n                      <ShoppingCart className=\"w-5 h-5 text-green-600\" />\n                      {t(\"settings.productTitle\")}\n                    </CardTitle>\n                    <CardDescription>\n                      {t(\"settings.productManagementDesc\")}\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"flex justify-between items-center mb-6\">\n                      <div className=\"flex items-center gap-4\">\n                        <Input\n                          placeholder={t(\"settings.productNamePlaceholder\")}\n                          className=\"w-64\"\n                          value={productSearchTerm}\n                          onChange={(e) => setProductSearchTerm(e.target.value)}\n                        />\n                        <Select\n                          value={selectedCategoryFilter}\n                          onValueChange={setSelectedCategoryFilter}\n                        >\n                          <SelectTrigger className=\"w-48\">\n                            <SelectValue\n                              placeholder={t(\"settings.selectCategory\")}\n                            />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"all\">\n                              {t(\"settings.allCategories\")}\n                            </SelectItem>\n                            {categoriesData?.map((category: any) => (\n                              <SelectItem\n                                key={category.id}\n                                value={category.id.toString()}\n                              >\n                                {category.name}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <Button variant=\"outline\" size=\"sm\">\n                          <Search className=\"w-4 h-4 mr-2\" />\n                          {t(\"common.search\")}\n                        </Button>\n                      </div>\n                      <Button\n                        className=\"bg-green-600 hover:bg-green-700\"\n                        onClick={() => {\n                          resetProductForm();\n                          setShowProductForm(true);\n                        }}\n                      >\n                        <Plus className=\"w-4 h-4 mr-2\" />\n                        {t(\"settings.addProduct\")}\n                      </Button>\n                    </div>\n\n                    {productsLoading ? (\n                      <div className=\"text-center py-8\">\n                        <p className=\"text-gray-500\">{t(\"common.loading\")}</p>\n                      </div>\n                    ) : filteredProducts.length === 0 ? (\n                      <div className=\"text-center py-8\">\n                        <ShoppingCart className=\"w-12 h-12 mx-auto text-gray-400 mb-4\" />\n                        <p className=\"text-gray-500\">\n                          {t(\"settings.noProducts\")}\n                        </p>\n                      </div>\n                    ) : (\n                      <div className=\"w-full overflow-x-auto border rounded-md\">\n                        <table className=\"w-full min-w-[1100px] table-fixed\">\n                          <thead>\n                            <tr className=\"bg-gray-50 border-b\">\n                              <th className=\"w-[200px] px-4 py-3 text-left font-medium text-sm text-gray-600\">\n                                <div className=\"leading-tight break-words\">\n                                  {t(\"settings.productName\")}\n                                </div>\n                              </th>\n                              <th className=\"w-[120px] px-4 py-3 text-left font-medium text-sm text-gray-600\">\n                                <div className=\"leading-tight break-words\">\n                                  {t(\"settings.productSku\")}\n                                </div>\n                              </th>\n                              <th className=\"w-[120px] px-4 py-3 text-left font-medium text-sm text-gray-600\">\n                                <div className=\"leading-tight break-words\">\n                                  {t(\"settings.productCategory\")}\n                                </div>\n                              </th>\n                              <th className=\"w-[120px] px-4 py-3 text-right font-medium text-sm text-gray-600\">\n                                <div className=\"leading-tight break-words\">\n                                  {t(\"settings.productPrice\")}\n                                </div>\n                              </th>\n                              <th className=\"w-[80px] px-4 py-3 text-center font-medium text-sm text-gray-600\">\n                                <div className=\"leading-tight break-words\">\n                                  {t(\"settings.productStock\")}\n                                </div>\n                              </th>\n                              <th className=\"w-[120px] px-4 py-3 text-center font-medium text-sm text-gray-600\">\n                                <div className=\"leading-tight break-words\">\n                                  {t(\"settings.stockStatus\")}\n                                </div>\n                              </th>\n                              <th className=\"w-[140px] px-4 py-3 text-center font-medium text-sm text-gray-600\">\n                                <div className=\"leading-tight\">\n                                  {t(\"settings.usageStatus\")}\n                                </div>\n                              </th>\n                              <th className=\"w-[120px] px-4 py-3 text-center font-medium text-sm text-gray-600\">\n                                <div className=\"leading-tight break-words\">\n                                  {t(\"common.actions\")}\n                                </div>\n                              </th>\n                            </tr>\n                          </thead>\n                          <tbody className=\"divide-y\">\n                            {filteredProducts.map((product: any) => {\n                              const category = categoriesData?.find(\n                                (c: any) => c.id === product.categoryId,\n                              );\n                              return (\n                                <tr\n                                  key={product.id}\n                                  className=\"hover:bg-gray-50\"\n                                >\n                                  <td className=\"px-4 py-3\">\n                                    <div\n                                      className=\"font-medium truncate\"\n                                      title={product.name}\n                                    >\n                                      {product.name}\n                                    </div>\n                                  </td>\n                                  <td className=\"px-4 py-3\">\n                                    <div\n                                      className=\"font-mono text-sm truncate\"\n                                      title={product.sku}\n                                    >\n                                      {product.sku}\n                                    </div>\n                                  </td>\n                                  <td className=\"px-4 py-3\">\n                                    <Badge\n                                      variant=\"outline\"\n                                      className=\"text-xs truncate\"\n                                    >\n                                      {category?.name || \"N/A\"}\n                                    </Badge>\n                                  </td>\n                                  <td className=\"px-4 py-3 text-right\">\n                                    <div className=\"font-medium text-sm\">\n                                      {parseFloat(\n                                        product.price || \"0\",\n                                      ).toLocaleString()}{\" \"}\n                                      ₫\n                                    </div>\n                                  </td>\n                                  <td className=\"px-4 py-3 text-center\">\n                                    <div className=\"text-sm\">\n                                      {product.stock || 0}\n                                    </div>\n                                  </td>\n                                  <td className=\"px-4 py-3 text-center\">\n                                    <Badge\n                                      variant={\n                                        product.stock > 0\n                                          ? \"default\"\n                                          : \"destructive\"\n                                      }\n                                      className={`text-xs ${\n                                        product.stock > 0\n                                          ? \"bg-green-100 text-green-800\"\n                                          : \"\"\n                                      }`}\n                                    >\n                                      {product.stock > 0\n                                        ? t(\"settings.inStock\")\n                                        : t(\"settings.outOfStock\")}\n                                    </Badge>\n                                  </td>\n                                  <td className=\"px-4 py-3 text-center\">\n                                    <Badge\n                                      variant={\n                                        product.isActive === true ||\n                                        product.isActive === 1\n                                          ? \"default\"\n                                          : \"secondary\"\n                                      }\n                                      className={`text-xs ${\n                                        product.isActive === true ||\n                                        product.isActive === 1\n                                          ? \"bg-blue-100 text-blue-800\"\n                                          : \"bg-gray-100 text-gray-800\"\n                                      }`}\n                                    >\n                                      {product.isActive === true ||\n                                      product.isActive === 1\n                                        ? t(\"settings.yes\")\n                                        : t(\"common.no\")}\n                                    </Badge>\n                                  </td>\n                                  <td className=\"px-4 py-3\">\n                                    <div className=\"flex items-center justify-center gap-1\">\n                                      <Button\n                                        variant=\"ghost\"\n                                        size=\"sm\"\n                                        onClick={() =>\n                                          handleEditProduct(product)\n                                        }\n                                      >\n                                        <Edit className=\"w-4 h-4\" />\n                                      </Button>\n                                      <Button\n                                        variant=\"ghost\"\n                                        size=\"sm\"\n                                        className=\"text-red-500 hover:text-red-700\"\n                                        onClick={() =>\n                                          handleDeleteProduct(\n                                            product.id,\n                                            product.name,\n                                          )\n                                        }\n                                      >\n                                        <Trash2 className=\"w-4 h-4\" />\n                                      </Button>\n                                    </div>\n                                  </td>\n                                </tr>\n                              );\n                            })}\n                          </tbody>\n                        </table>\n                      </div>\n                    )}\n\n                    <div className=\"flex justify-between items-center mt-6\">\n                      <div className=\"text-sm text-gray-600\">\n                        {t(\"settings.total\")} {filteredProducts.length}{\" \"}\n                        {t(\"settings.productsShowing\")}\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n            </TabsContent>\n\n            {/* Employees Tab */}\n            <TabsContent value=\"employees\">\n              <div className=\"space-y-6\">\n                <Card className=\"bg-white/80 backdrop-blur-sm border-white/20\">\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center gap-2\">\n                      <Users className=\"w-5 h-5 text-green-600\" />\n                      {t(\"settings.employeeManagement\")}\n                    </CardTitle>\n                    <CardDescription>\n                      {t(\"settings.employeeManagementDesc\")}\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"flex justify-between items-center mb-6\">\n                      <div className=\"flex items-center gap-4\">\n                        <Input\n                          placeholder={t(\"employees.searchPlaceholder\")}\n                          className=\"w-64\"\n                          value={employeeSearchTerm}\n                          onChange={(e) =>\n                            setEmployeeSearchTerm(e.target.value)\n                          }\n                          onKeyPress={(e) => {\n                            if (e.key === \"Enter\") {\n                              // Trigger search when Enter is pressed\n                              setEmployeeSearchTerm(e.currentTarget.value);\n                            }\n                          }}\n                        />\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => {\n                            // Force re-render of filtered results\n                            setEmployeeSearchTerm(employeeSearchTerm);\n                          }}\n                        >\n                          <Search className=\"w-4 h-4 mr-2\" />\n                          {t(\"common.search\")}\n                        </Button>\n                      </div>\n                      <Button\n                        className=\"bg-green-600 hover:bg-green-700\"\n                        onClick={() => setShowEmployeeForm(true)}\n                      >\n                        <Plus className=\"w-4 h-4 mr-2\" />\n                        {t(\"employees.addEmployee\")}\n                      </Button>\n                    </div>\n\n                    {employeesLoading ? (\n                      <div className=\"text-center py-8\">\n                        <p className=\"text-gray-500\">\n                          Đang tải dữ liệu nhân viên...\n                        </p>\n                      </div>\n                    ) : !filteredEmployees || filteredEmployees.length === 0 ? (\n                      <div className=\"text-center py-8\">\n                        <Users className=\"w-12 h-12 mx-auto text-gray-400 mb-4\" />\n                        <p className=\"text-gray-500\">\n                          {employeeSearchTerm\n                            ? \"Không tìm thấy nhân viên nào phù hợp\"\n                            : \"Chưa có nhân viên nào được đăng ký\"}\n                        </p>\n                        <p className=\"text-sm text-gray-400 mt-2\">\n                          {employeeSearchTerm\n                            ? \"Thử tìm kiếm với từ khóa khác\"\n                            : \"Thêm nhân viên đầu tiên để bắt đầu\"}\n                        </p>\n                      </div>\n                    ) : (\n                      <div className=\"w-full overflow-x-auto border rounded-md\">\n                        <table className=\"w-full min-w-[900px] table-fixed\">\n                          <thead>\n                            <tr className=\"bg-gray-50 border-b\">\n                              <th className=\"w-[140px] px-4 py-3 text-left font-medium text-sm text-gray-600\">\n                                {t(\"employees.employeeId\")}\n                              </th>\n                              <th className=\"w-[180px] px-4 py-3 text-left font-medium text-sm text-gray-600\">\n                                {t(\"employees.name\")}\n                              </th>\n                              <th className=\"w-[140px] px-4 py-3 text-left font-medium text-sm text-gray-600\">\n                                {t(\"employees.role\")}\n                              </th>\n                              <th className=\"w-[150px] px-4 py-3 text-left font-medium text-sm text-gray-600\">\n                                {t(\"employees.phone\")}\n                              </th>\n                              <th className=\"w-[120px] px-4 py-3 text-left font-medium text-sm text-gray-600\">\n                                {t(\"employees.status\")}\n                              </th>\n                              <th className=\"w-[130px] px-4 py-3 text-center font-medium text-sm text-gray-600\">\n                                {t(\"common.actions\")}\n                              </th>\n                            </tr>\n                          </thead>\n                          <tbody className=\"divide-y\">\n                            {filteredEmployees.map((employee: any) => (\n                              <tr\n                                key={employee.id}\n                                className=\"hover:bg-gray-50\"\n                              >\n                                <td className=\"px-4 py-3\">\n                                  <div\n                                    className=\"font-mono text-sm truncate\"\n                                    title={employee.employeeId}\n                                  >\n                                    {employee.employeeId}\n                                  </div>\n                                </td>\n                                <td className=\"px-4 py-3\">\n                                  <div\n                                    className=\"text-sm truncate\"\n                                    title={employee.name}\n                                  >\n                                    {employee.name}\n                                  </div>\n                                </td>\n                                <td className=\"px-4 py-3\">\n                                  <Badge\n                                    variant={\n                                      employee.role === \"admin\"\n                                        ? \"destructive\"\n                                        : employee.role === \"manager\"\n                                          ? \"default\"\n                                          : \"secondary\"\n                                    }\n                                    className=\"text-xs\"\n                                  >\n                                    {employee.role === \"admin\"\n                                      ? t(\"employees.roles.admin\")\n                                      : employee.role === \"manager\"\n                                        ? t(\"employees.roles.manager\")\n                                        : employee.role === \"cashier\"\n                                          ? t(\"employees.roles.cashier\")\n                                          : employee.role}\n                                  </Badge>\n                                </td>\n                                <td className=\"px-4 py-3\">\n                                  <div\n                                    className=\"text-sm text-gray-600 truncate\"\n                                    title={employee.phone || \"-\"}\n                                  >\n                                    {employee.phone || \"-\"}\n                                  </div>\n                                </td>\n                                <td className=\"px-4 py-3\">\n                                  <Badge\n                                    variant={\n                                      employee.isActive\n                                        ? \"default\"\n                                        : \"secondary\"\n                                    }\n                                    className={`text-xs ${\n                                      employee.isActive\n                                        ? \"bg-green-100 text-green-800\"\n                                        : \"\"\n                                    }`}\n                                  >\n                                    {employee.isActive\n                                      ? t(\"employees.active\")\n                                      : t(\"employees.inactive\")}\n                                  </Badge>\n                                </td>\n                                <td className=\"px-4 py-3\">\n                                  <div className=\"flex items-center justify-center gap-1\">\n                                    <Button\n                                      variant=\"ghost\"\n                                      size=\"sm\"\n                                      onClick={() => {\n                                        setEditingEmployee(employee);\n                                        setShowEmployeeForm(true);\n                                      }}\n                                    >\n                                      <Edit className=\"w-4 h-4\" />\n                                    </Button>\n                                    <Button\n                                      variant=\"ghost\"\n                                      size=\"sm\"\n                                      className=\"text-red-500 hover:text-red-700\"\n                                      onClick={() => {\n                                        setEmployeeToDelete(employee);\n                                        setShowEmployeeDeleteDialog(true);\n                                      }}\n                                    >\n                                      <Trash2 className=\"w-4 h-4\" />\n                                    </Button>\n                                  </div>\n                                </td>\n                              </tr>\n                            ))}\n                          </tbody>\n                        </table>\n                      </div>\n                    )}\n\n                    <div className=\"flex justify-between items-center mt-6\">\n                      <div className=\"text-sm text-gray-600\">\n                        Tổng số nhân viên:{\" \"}\n                        {employeesData ? employeesData.length : 0}\n                      </div>\n                      <div className=\"flex gap-2\">\n                        <Button variant=\"outline\" size=\"sm\">\n                          <Clock className=\"w-4 h-4 mr-2\" />\n                          {t(\"attendance.title\")}\n                        </Button>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n            </TabsContent>\n\n            {/* Payment Methods Tab */}\n            <TabsContent value=\"payments\">\n              <Card className=\"bg-white/80 backdrop-blur-sm border-white/20\">\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <CreditCard className=\"w-5 h-5 text-green-600\" />\n                    {t(\"settings.paymentMethods\")}\n                  </CardTitle>\n                  <CardDescription>\n                    {t(\"settings.paymentMethodsDesc\")}\n                  </CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-4\">\n                    <div className=\"flex justify-between items-center\">\n                      <h3 className=\"text-lg font-medium\">\n                        {t(\"settings.availablePayments\")}\n                      </h3>\n                      <Button\n                        onClick={addPaymentMethod}\n                        size=\"sm\"\n                        className=\"bg-green-600 hover:bg-green-700\"\n                      >\n                        <Plus className=\"w-4 h-4 mr-2\" />\n                        {t(\"settings.addPayment\")}\n                      </Button>\n                    </div>\n\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                      {paymentMethods.map((method) => (\n                        <div\n                          key={method.id}\n                          className={`p-4 rounded-lg border-2 transition-all ${\n                            method.enabled\n                              ? \"border-green-200 bg-green-50\"\n                              : \"border-gray-200 bg-gray-50\"\n                          }`}\n                        >\n                          <div className=\"flex items-center justify-between mb-3\">\n                            <div className=\"flex items-center gap-2\">\n                              <span className=\"text-2xl\">{method.icon}</span>\n                              <span className=\"font-medium\">\n                                {method.name}\n                              </span>\n                            </div>\n                            <div className=\"flex items-center gap-2\">\n                              <Switch\n                                checked={method.enabled}\n                                onCheckedChange={() =>\n                                  togglePaymentMethod(method.id)\n                                }\n                              />\n                              <Button\n                                size=\"sm\"\n                                variant=\"ghost\"\n                                onClick={() => handleEditPaymentMethod(method)}\n                                className=\"text-blue-500 hover:text-blue-700 hover:bg-blue-50\"\n                              >\n                                <Edit className=\"w-4 h-4\" />\n                              </Button>\n                              <Button\n                                size=\"sm\"\n                                variant=\"ghost\"\n                                onClick={() => removePaymentMethod(method.id)}\n                                className=\"text-red-500 hover:text-red-700 hover:bg-red-50\"\n                              >\n                                <Trash2 className=\"w-4 h-4\" />\n                              </Button>\n                            </div>\n                          </div>\n                          <Badge\n                            variant={method.enabled ? \"default\" : \"secondary\"}\n                          >\n                            {method.enabled\n                              ? t(\"settings.enabled\")\n                              : t(\"settings.disabled\")}\n                          </Badge>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </TabsContent>\n          </Tabs>\n        </div>\n      </div>\n\n      {/* Customer Form Modal */}\n      <CustomerFormModal\n        isOpen={showCustomerForm}\n        onClose={handleCloseCustomerForm}\n        customer={editingCustomer}\n      />\n\n      {/* Customer Points Modal */}\n      {selectedCustomer && (\n        <CustomerPointsModal\n          open={showPointsModal}\n          onOpenChange={setShowPointsModal}\n          customerId={selectedCustomer.id}\n          customerName={selectedCustomer.name}\n        />\n      )}\n\n      {/* Membership Management Modal */}\n      <MembershipModal\n        isOpen={showMembershipModal}\n        onClose={() => setShowMembershipModal(false)}\n      />\n\n      {/* Points Management Modal */}\n      <PointsManagementModal\n        isOpen={showPointsManagementModal}\n        onClose={() => setShowPointsManagementModal(false)}\n      />\n\n      {/* Employee Form Modal */}\n      <EmployeeFormModal\n        isOpen={showEmployeeForm}\n        onClose={() => {\n          setShowEmployeeForm(false);\n          setEditingEmployee(null);\n        }}\n        mode={editingEmployee ? \"edit\" : \"create\"}\n        employee={editingEmployee}\n      />\n\n      {/* Category Form Modal */}\n      <Dialog open={showCategoryForm} onOpenChange={setShowCategoryForm}>\n        <DialogContent className=\"sm:max-w-[425px]\">\n          <DialogHeader>\n            <DialogTitle>\n              {editingCategory ? \"Sửa danh mục\" : t(\"settings.addCategory\")}\n            </DialogTitle>\n            <DialogDescription>\n              {editingCategory\n                ? \"Cập nhật thông tin danh mục sản phẩm\"\n                : t(\"settings.categoryManagementDesc\")}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"grid gap-4 py-4\">\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"categoryName\" className=\"text-right\">\n                {t(\"settings.categoryName\")}\n              </Label>\n              <Input\n                id=\"categoryName\"\n                value={categoryForm.name}\n                onChange={(e) =>\n                  setCategoryForm((prev) => ({ ...prev, name: e.target.value }))\n                }\n                className=\"col-span-3\"\n                placeholder={t(\"settings.categoryNamePlaceholder\")}\n              />\n            </div>\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"categoryIcon\" className=\"text-right\">\n                {t(\"settings.categoryIcon\")}\n              </Label>\n              <Select\n                value={categoryForm.icon}\n                onValueChange={(value) =>\n                  setCategoryForm((prev) => ({ ...prev, icon: value }))\n                }\n              >\n                <SelectTrigger className=\"col-span-3\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"fas fa-utensils\">\n                    🍽️ Món ăn chính\n                  </SelectItem>\n                  <SelectItem value=\"fas fa-coffee\">☕ Đồ uống</SelectItem>\n                  <SelectItem value=\"fas fa-cookie\">🍪 Đồ ăn vặt</SelectItem>\n                  <SelectItem value=\"fas fa-ice-cream\">\n                    🍨 Tráng miệng\n                  </SelectItem>\n                  <SelectItem value=\"fas fa-beer\">🍺 Đồ uống có cồn</SelectItem>\n                  <SelectItem value=\"fas fa-apple-alt\">🍎 Trái cây</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setShowCategoryForm(false);\n                resetCategoryForm();\n              }}\n            >\n              {t(\"common.cancel\")}\n            </Button>\n            <Button\n              onClick={\n                editingCategory ? handleUpdateCategory : handleCreateCategory\n              }\n              className=\"bg-green-600 hover:bg-green-700\"\n            >\n              {editingCategory ? \"Cập nhật\" : t(\"common.create\")}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Product Form Modal */}\n      <Dialog open={showProductForm} onOpenChange={setShowProductForm}>\n        <DialogContent className=\"sm:max-w-[600px]\">\n          <DialogHeader>\n            <DialogTitle>\n              {editingProduct\n                ? t(\"settings.editProductTitle\")\n                : t(\"settings.addProductTitle\")}\n            </DialogTitle>\n            <DialogDescription>\n              {editingProduct\n                ? t(\"settings.editProductDesc\")\n                : t(\"settings.addProductDesc\")}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"grid gap-4 py-4\">\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"productName\" className=\"text-right\">\n                {t(\"settings.productName\")}\n              </Label>\n              <Input\n                id=\"productName\"\n                value={productForm.name}\n                onChange={(e) =>\n                  setProductForm((prev) => ({ ...prev, name: e.target.value }))\n                }\n                className=\"col-span-3\"\n                placeholder={t(\"settings.productNamePlaceholder\")}\n              />\n            </div>\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"productSku\" className=\"text-right\">\n                SKU\n              </Label>\n              <Input\n                id=\"productSku\"\n                value={productForm.sku}\n                onChange={(e) =>\n                  setProductForm({ ...productForm, sku: e.target.value })\n                }\n                className=\"col-span-3\"\n                placeholder=\"Nhập SKU sản phẩm\"\n                disabled={!!editingProduct}\n              />\n            </div>\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"trackInventory\" className=\"text-right\">\n                {t(\"settings.trackInventory\")}\n              </Label>\n              <div className=\"col-span-3 flex items-center space-x-2\">\n                <Checkbox\n                  id=\"trackInventory\"\n                  checked={productForm.trackInventory !== false}\n                  onCheckedChange={(checked) =>\n                    setProductForm({\n                      ...productForm,\n                      trackInventory: checked as boolean,\n                    })\n                  }\n                />\n                <Label htmlFor=\"trackInventory\" className=\"text-sm\">\n                  {t(\"settings.enableInventoryTracking\")}\n                </Label>\n              </div>\n            </div>\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"productCategory\" className=\"text-right\">\n                {t(\"settings.productCategory\")}\n              </Label>\n              <Select\n                value={productForm.categoryId}\n                onValueChange={(value) =>\n                  setProductForm((prev) => ({ ...prev, categoryId: value }))\n                }\n              >\n                <SelectTrigger className=\"col-span-3\">\n                  <SelectValue placeholder={t(\"settings.selectCategory\")} />\n                </SelectTrigger>\n                <SelectContent>\n                  {categoriesData?.map((category: any) => (\n                    <SelectItem\n                      key={category.id}\n                      value={category.id.toString()}\n                    >\n                      {category.name}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"productPrice\" className=\"text-right\">\n                {t(\"settings.productPrice\")}\n              </Label>\n              <Input\n                id=\"productPrice\"\n                type=\"number\"\n                step=\"0.01\"\n                value={productForm.price}\n                onChange={(e) => {\n                  const basePrice = e.target.value;\n                  setProductForm((prev) => ({ ...prev, price: basePrice }));\n\n                  // Auto calculate after tax price when base price changes\n                  if (basePrice && productForm.taxRate) {\n                    const basePriceNum = parseFloat(basePrice);\n                    const taxRateNum = parseFloat(productForm.taxRate);\n                    if (!isNaN(basePriceNum) && !isNaN(taxRateNum)) {\n                      const afterTaxPrice = basePriceNum * (1 + taxRateNum / 100);\n                      setProductForm((prev) => ({ ...prev, afterTaxPrice: Math.floor(afterTaxPrice).toString() }));\n                    }\n                  }\n                }}\n                className=\"col-span-3\"\n                placeholder={t(\"settings.productPricePlaceholder\")}\n              />\n            </div>\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"taxRate\" className=\"text-right\">\n                {t(\"settings.taxRatePercent\")}\n              </Label>\n              <Input\n                id=\"taxRate\"\n                type=\"number\"\n                step=\"0.01\"\n                min=\"0\"\n                max=\"100\"\n                value={productForm.taxRate || \"\"}\n                onChange={(e) => {\n                  const taxRate = e.target.value;\n                  setProductForm((prev) => ({ ...prev, taxRate }));\n\n                  // Auto calculate after tax price when tax rate changes\n                  if (taxRate && productForm.price) {\n                    const basePriceNum = parseFloat(productForm.price);\n                    const taxRateNum = parseFloat(taxRate);\n                    if (!isNaN(basePriceNum) && !isNaN(taxRateNum)) {\n                      const afterTaxPrice = basePriceNum * (1 + taxRateNum / 100);\n                      setProductForm((prev) => ({ ...prev, afterTaxPrice: Math.floor(afterTaxPrice).toString() }));\n                    }\n                  }\n                }}\n                className=\"col-span-3\"\n                placeholder={t(\"settings.taxRatePlaceholder\")}\n              />\n            </div>\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"afterTaxPrice\" className=\"text-right\">\n                {t(\"settings.afterTaxPrice\")}\n              </Label>\n              <Input\n                id=\"afterTaxPrice\"\n                type=\"number\"\n                value={productForm.afterTaxPrice || \"\"}\n                onChange={(e) => {\n                  const afterTaxPrice = e.target.value;\n                  setProductForm((prev) => ({ ...prev, afterTaxPrice }));\n\n                  // Auto calculate base price from after tax price\n                  if (afterTaxPrice && productForm.taxRate) {\n                    const afterTaxPriceNum = parseFloat(afterTaxPrice);\n                    const taxRateNum = parseFloat(productForm.taxRate);\n                    if (!isNaN(afterTaxPriceNum) && !isNaN(taxRateNum)) {\n                      const basePrice = afterTaxPriceNum / (1 + taxRateNum / 100);\n                      setProductForm((prev) => ({ ...prev, price: Math.round(basePrice).toString() }));\n                    }\n                  }\n                }}\n                className=\"col-span-3\"\n                placeholder={t(\"settings.afterTaxPricePlaceholder\")}\n              />\n            </div>\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"productStock\" className=\"text-right\">\n                {t(\"settings.productStock\")}\n              </Label>\n              <Input\n                id=\"productStock\"\n                type=\"number\"\n                value={productForm.stock}\n                onChange={(e) =>\n                  setProductForm((prev) => ({ ...prev, stock: e.target.value }))\n                }\n                className=\"col-span-3\"\n                placeholder={t(\"settings.productStockPlaceholder\")}\n              />\n            </div>\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"productDescription\" className=\"text-right\">\n                {t(\"settings.productDescriptionLabel\")}\n              </Label>\n              <Textarea\n                id=\"productDescription\"\n                value={productForm.description}\n                onChange={(e) =>\n                  setProductForm((prev) => ({\n                    ...prev,\n                    description: e.target.value,\n                  }))\n                }\n                className=\"col-span-3\"\n                placeholder={t(\"settings.productDescriptionPlaceholder\")}\n                rows={3}\n              />\n            </div>\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"productIsActive\" className=\"text-right\">\n                {t(\"settings.usageStatusLabel\")}\n              </Label>\n              <Select\n                value={productForm.isActive}\n                onValueChange={(value) =>\n                  setProductForm((prev) => ({ ...prev, isActive: value }))\n                }\n              >\n                <SelectTrigger className=\"col-span-3\">\n                  <SelectValue placeholder={t(\"settings.selectUsageStatus\")} />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"true\">{t(\"settings.usageStatusActive\")}</SelectItem>\n                  <SelectItem value=\"false\">{t(\"settings.usageStatusInactive\")}</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowProductForm(false)}>\n              {t(\"common.cancel\")}\n            </Button>\n            <Button\n              onClick={\n                editingProduct ? handleUpdateProduct : handleCreateProduct\n              }\n              className=\"bg-green-600 hover:bg-green-700\"\n            >\n              {editingProduct ? t(\"common.update\") : t(\"common.create\")}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Delete Category Confirmation Dialog */}\n      <AlertDialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>\n        <AlertDialogContent className=\"sm:max-w-[425px]\">\n          <AlertDialogHeader>\n            <AlertDialogTitle className=\"flex items-center gap-2 text-red-600\">\n              <Trash2 className=\"w-5 h-5\" />\n              Xác nhận xóa danh mục\n            </AlertDialogTitle>\n            <AlertDialogDescription className=\"text-left\">\n              <div className=\"space-y-3\">\n                <p>\n                  Bạn có chắc chắn muốn xóa danh mục{\" \"}\n                  <span className=\"font-semibold text-gray-900\">\n                    \"{categoryToDelete?.name}\"\n                  </span>{\" \"}\n                  không?\n                </p>\n                <div className=\"bg-red-50 border border-red-200 rounded-lg p-3\">\n                  <div className=\"flex items-start gap-2\">\n                    <div className=\"w-2 h-2 bg-red-400 rounded-full mt-2 flex-shrink-0\"></div>\n                    <p className=\"text-sm text-red-700\">\n                      <strong>Cảnh báo:</strong> Hành động này không thể hoàn\n                      tác. Danh mục sẽ bị xóa vĩnh viễn khỏi hệ thống.\n                    </p>\n                  </div>\n                </div>\n                <p className=\"text-sm text-gray-600\">\n                  Hãy đảm bảo rằng không còn sản phẩm nào trong danh mục này\n                  trước khi xóa.\n                </p>\n              </div>\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter className=\"gap-2\">\n            <AlertDialogCancel\n              onClick={() => {\n                setShowDeleteDialog(false);\n                setCategoryToDelete(null);\n              }}\n              className=\"hover:bg-gray-100\"\n            >\n              Hủy bỏ\n            </AlertDialogCancel>\n            <AlertDialogAction\n              onClick={confirmDeleteCategory}\n              className=\"bg-red-600 hover:bg-red-700 focus:ring-red-600\"\n            >\n              <Trash2 className=\"w-4 h-4 mr-2\" />\n              Xóa danh mục\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      {/* Customer Delete Confirmation Dialog */}\n      <AlertDialog\n        open={showCustomerDeleteDialog}\n        onOpenChange={setShowCustomerDeleteDialog}\n      >\n        <AlertDialogContent className=\"sm:max-w-[425px]\">\n          <AlertDialogHeader>\n            <AlertDialogTitle className=\"flex items-center gap-2 text-red-600\">\n              <Trash2 className=\"w-5 h-5\" />\n              Xác nhận xóa khách hàng\n            </AlertDialogTitle>\n            <AlertDialogDescription className=\"text-left\">\n              <div className=\"space-y-3\">\n                <p>\n                  Bạn có chắc chắn muốn xóa khách hàng{\" \"}\n                  <span className=\"font-semibold text-gray-900\">\n                    \"{customerToDelete?.name}\"\n                  </span>{\" \"}\n                  không?\n                </p>\n                <div className=\"bg-red-50 border border-red-200 rounded-lg p-3\">\n                  <div className=\"flex items-start gap-2\">\n                    <div className=\"w-2 h-2 bg-red-400 rounded-full mt-2 flex-shrink-0\"></div>\n                    <p className=\"text-sm text-red-700\">\n                      <strong>Cảnh báo:</strong> Hành động này không thể hoàn\n                      tác. Tất cả dữ liệu của khách hàng sẽ bị xóa vĩnh viễn\n                      khỏi hệ thống.\n                    </p>\n                  </div>\n                </div>\n                <p className=\"text-sm text-gray-600\">\n                  Điều này bao gồm lịch sử mua hàng, điểm tích lũy và thông tin\n                  cá nhân.\n                </p>\n              </div>\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter className=\"gap-2\">\n            <AlertDialogCancel\n              onClick={() => {\n                setShowCustomerDeleteDialog(false);\n                setCustomerToDelete(null);\n              }}\n              className=\"hover:bg-gray-100\"\n            >\n              Hủy bỏ\n            </AlertDialogCancel>\n            <AlertDialogAction\n              onClick={confirmDeleteCustomer}\n              className=\"bg-red-600 hover:bg-red-700 focus:ring-red-600\"\n            >\n              <Trash2 className=\"w-4 h-4 mr-2\" />\n              Xóa khách hàng\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      {/* Product Delete Confirmation Dialog */}\n      <AlertDialog\n        open={showProductDeleteDialog}\n        onOpenChange={setShowProductDeleteDialog}\n      >\n        <AlertDialogContent className=\"sm:max-w-[425px]\">\n          <AlertDialogHeader>\n            <AlertDialogTitle className=\"flex items-center gap-2 text-red-600\">\n              <Trash2 className=\"w-5 h-5\" />\n              Xác nhận xóa sản phẩm\n            </AlertDialogTitle>\n            <AlertDialogDescription className=\"text-left\">\n              <div className=\"space-y-3\">\n                <p>\n                  Bạn có chắc chắn muốn xóa sản phẩm{\" \"}\n                  <span className=\"font-semibold text-gray-900\">\n                    \"{productToDelete?.name}\"\n                  </span>{\" \"}\n                  không?\n                </p>\n                <div className=\"bg-red-50 border border-red-200 rounded-lg p-3\">\n                  <div className=\"flex items-start gap-2\">\n                    <div className=\"w-2 h-2 bg-red-400 rounded-full mt-2 flex-shrink-0\"></div>\n                    <p className=\"text-sm text-red-700\">\n                      <strong>Cảnh báo:</strong> Hành động này không thể hoàn\n                      tác. Sản phẩm sẽ bị xóa vĩnh viễn khỏi hệ thống.\n                    </p>\n                  </div>\n                </div>\n                <p className=\"text-sm text-gray-600\">\n                  Điều này sẽ ảnh hưởng đến các đơn hàng và báo cáo có chứa sản\n                  phẩm này.\n                </p>\n              </div>\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter className=\"gap-2\">\n            <AlertDialogCancel\n              onClick={() => {\n                setShowProductDeleteDialog(false);\n                setProductToDelete(null);\n              }}\n              className=\"hover:bg-gray-100\"\n            >\n              Hủy bỏ\n            </AlertDialogCancel>\n            <AlertDialogAction\n              onClick={confirmDeleteProduct}\n              className=\"bg-red-600 hover:bg-red-700 focus:ring-red-600\"\n            >\n              <Trash2 className=\"w-4 h-4 mr-2\" />\n              Xóa sản phẩm\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      {/* Employee Delete Confirmation Dialog */}\n      <AlertDialog\n        open={showEmployeeDeleteDialog}\n        onOpenChange={setShowEmployeeDeleteDialog}\n      >\n        <AlertDialogContent className=\"sm:max-w-[425px]\">\n          <AlertDialogHeader>\n            <AlertDialogTitle className=\"flex items-center gap-2 text-red-600\">\n              <Trash2 className=\"w-5 h-5\" />\n              Xác nhận xóa nhân viên\n            </AlertDialogTitle>\n            <AlertDialogDescription className=\"text-left\">\n              <div className=\"space-y-3\">\n                <p>\n                  Bạn có chắc chắn muốn xóa nhân viên{\" \"}\n                  <span className=\"font-semibold text-gray-900\">\n                    \"{employeeToDelete?.name}\"\n                  </span>{\" \"}\n                  không?\n                </p>\n                <div className=\"bg-red-50 border border-red-200 rounded-lg p-3\">\n                  <div className=\"flex items-start gap-2\">\n                    <div className=\"w-2 h-2 bg-red-400 rounded-full mt-2 flex-shrink-0\"></div>\n                    <p className=\"text-sm text-red-700\">\n                      <strong>Cảnh báo:</strong> Hành động này không thể hoàn\n                      tác. Thông tin nhân viên sẽ bị xóa vĩnh viễn khỏi hệ\n                      thống.\n                    </p>\n                  </div>\n                </div>\n                <p className=\"text-sm text-gray-600\">\n                  Điều này bao gồm lịch sử làm việc, chấm công và các quyền truy\n                  cập.\n                </p>\n              </div>\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter className=\"gap-2\">\n            <AlertDialogCancel\n              onClick={() => {\n                setShowEmployeeDeleteDialog(false);\n                setEmployeeToDelete(null);\n              }}\n              className=\"hover:bg-gray-100\"\n            >\n              Hủy bỏ\n            </AlertDialogCancel>\n            <AlertDialogAction\n              onClick={confirmDeleteEmployee}\n              className=\"bg-red-600 hover:bg-red-700 focus:ring-red-600\"\n            >\n              <Trash2 className=\"w-4 h-4 mr-2\" />\n              Xóa nhân viên\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      {/* E-invoice Form Modal */}\n      <AlertDialog\n        open={showEInvoiceDeleteDialog}\n        onOpenChange={setShowEInvoiceDeleteDialog}\n      >\n        <AlertDialogContent className=\"sm:max-w-[425px]\">\n          <AlertDialogHeader>\n            <AlertDialogTitle className=\"flex items-center gap-2 text-red-600\">\n              <Trash2 className=\"w-5 h-5\" />\n              Xác nhận xóa kết nối HĐĐT\n            </AlertDialogTitle>\n            <AlertDialogDescription className=\"text-left\">\n              <div className=\"space-y-3\">\n                <p>\n                  Bạn có chắc chắn muốn xóa kết nối{\" \"}\n                  <span className=\"font-semibold text-gray-900\">\n                    \"{eInvoiceToDelete?.softwareName}\"\n                  </span>{\" \"}\n                  không?\n                </p>\n                <div className=\"bg-red-50 border border-red-200 rounded-lg p-3\">\n                  <div className=\"flex items-start gap-2\">\n                    <div className=\"w-2 h-2 bg-red-400 rounded-full mt-2 flex-shrink-0\"></div>\n                    <p className=\"text-sm text-red-700\">\n                      <strong>Cảnh báo:</strong> Hành động này không thể hoàn\n                      tác. Kết nối HĐĐT sẽ bị xóa vĩnh viễn khỏi hệ thống.\n                    </p>\n                  </div>\n                </div>\n                <p className=\"text-sm text-gray-600\">\n                  Điều này có thể ảnh hưởng đến việc xuất hóa đơn điện tử.\n                </p>\n              </div>\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter className=\"gap-2\">\n            <AlertDialogCancel\n              onClick={() => {\n                setShowEInvoiceDeleteDialog(false);\n                setEInvoiceToDelete(null);\n              }}\n              className=\"hover:bg-gray-100\"\n            >\n              Hủy bỏ\n            </AlertDialogCancel>\n            <AlertDialogAction\n              onClick={confirmDeleteEInvoice}\n              className=\"bg-red-600 hover:bg-red-700 focus:ring-red-600\"\n            >\n              <Trash2 className=\"w-4 h-4 mr-2\" />\n              Xóa kết nối\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n      {/* E-invoice Form Modal */}\n      <Dialog open={showEInvoiceForm} onOpenChange={setShowEInvoiceForm}>\n        <DialogContent className=\"sm:max-w-[600px]\">\n          <DialogHeader>\n            <DialogTitle>\n              {editingEInvoice ? t(\"settings.editConnectionTitle\") : t(\"settings.addConnectionTitle\")}\n            </DialogTitle>\n            <DialogDescription>\n              {editingEInvoice\n                ? t(\"settings.editConnectionDesc\")\n                : t(\"settings.addConnectionDesc\")}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"grid gap-4 py-4\">\n            <div className=\"grid grid-cols-4 items-start gap-4\">\n              <Label htmlFor=\"taxCode\" className=\"text-right mt-2\">\n                {t(\"settings.taxIdRequired\")} <span className=\"text-red-500\">*</span>\n              </Label>\n              <div className=\"col-span-3 space-y-1\">\n                <Input\n                  id=\"taxCode\"\n                  value={eInvoiceForm.taxCode}\n                  onChange={(e) => {\n                    setEInvoiceForm((prev) => ({\n                      ...prev,\n                      taxCode: e.target.value,\n                    }));\n                    if (eInvoiceFormErrors.taxCode) {\n                      setEInvoiceFormErrors((prev) => ({\n                        ...prev,\n                        taxCode: \"\",\n                      }));\n                    }\n                  }}\n                  className={`${eInvoiceFormErrors.taxCode ? \"border-red-500\" : \"\"}`}\n                  placeholder=\"Nhập mã số thuế\"\n                />\n                {eInvoiceFormErrors.taxCode && (\n                  <p className=\"text-sm text-red-500\">\n                    {eInvoiceFormErrors.taxCode}\n                  </p>\n                )}\n              </div>\n            </div>\n            <div className=\"grid grid-cols-4 items-start gap-4\">\n              <Label htmlFor=\"loginId\" className=\"text-right mt-2\">\n                {t(\"settings.loginIdLabel\")} <span className=\"text-red-500\">*</span>\n              </Label>\n              <div className=\"col-span-3 space-y-1\">\n                <Input\n                  id=\"loginId\"\n                  value={eInvoiceForm.loginId}\n                  onChange={(e) => {\n                    setEInvoiceForm((prev) => ({\n                      ...prev,\n                      loginId: e.target.value,\n                    }));\n                    if (eInvoiceFormErrors.loginId) {\n                      setEInvoiceFormErrors((prev) => ({\n                        ...prev,\n                        loginId: \"\",\n                      }));\n                    }\n                  }}\n                  className={`${eInvoiceFormErrors.loginId ? \"border-red-500\" : \"\"}`}\n                  placeholder=\"Nhập ID đăng nhập\"\n                />\n                {eInvoiceFormErrors.loginId && (\n                  <p className=\"text-sm text-red-500\">\n                    {eInvoiceFormErrors.loginId}\n                  </p>\n                )}\n              </div>\n            </div>\n            <div className=\"grid grid-cols-4 items-start gap-4\">\n              <Label htmlFor=\"password\" className=\"text-right mt-2\">\n                {t(\"settings.passwordLabel\")} <span className=\"text-red-500\">*</span>\n              </Label>\n              <div className=\"col-span-3 space-y-1\">\n                <Input\n                  id=\"password\"\n                  type=\"password\"\n                  value={eInvoiceForm.password}\n                  onChange={(e) => {\n                    setEInvoiceForm((prev) => ({\n                      ...prev,\n                      password: e.target.value,\n                    }));\n                    if (eInvoiceFormErrors.password) {\n                      setEInvoiceFormErrors((prev) => ({\n                        ...prev,\n                        password: \"\",\n                      }));\n                    }\n                  }}\n                  className={`${eInvoiceFormErrors.password ? \"border-red-500\" : \"\"}`}\n                  placeholder=\"Nhập mật khẩu\"\n                />\n                {eInvoiceFormErrors.password && (\n                  <p className=\"text-sm text-red-500\">\n                    {eInvoiceFormErrors.password}\n                  </p>\n                )}\n              </div>\n            </div>\n            <div className=\"grid grid-cols-4 items-start gap-4\">\n              <Label htmlFor=\"softwareName\" className=\"text-right mt-2\">\n                {t(\"settings.softwareLabel\")} <span className=\"text-red-500\">*</span>\n              </Label>\n              <div className=\"col-span-3 space-y-1\">\n                <Select\n                  value={eInvoiceForm.softwareName}\n                  onValueChange={(value) => {\n                    setEInvoiceForm((prev) => ({\n                      ...prev,\n                      softwareName: value,\n                    }));\n                    if (eInvoiceFormErrors.softwareName) {\n                      setEInvoiceFormErrors((prev) => ({\n                        ...prev,\n                        softwareName: \"\",\n                      }));\n                    }\n                  }}\n                >\n                  <SelectTrigger\n                    className={`${eInvoiceFormErrors.softwareName ? \"border-red-500\" : \"\"}`}\n                  >\n                    <SelectValue placeholder={t(\"settings.selectSoftwarePlaceholder\")} />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {EINVOICE_PROVIDERS.map((provider) => (\n                      <SelectItem key={provider.value} value={provider.name}>\n                        {provider.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                {eInvoiceFormErrors.softwareName && (\n                  <p className=\"text-sm text-red-500\">\n                    {eInvoiceFormErrors.softwareName}\n                  </p>\n                )}\n              </div>\n            </div>\n            <div className=\"grid grid-cols-4 items-start gap-4\">\n              <Label htmlFor=\"loginUrl\" className=\"text-right mt-2\">\n                {t(\"settings.loginUrlLabel\")} <span className=\"text-red-500\">*</span>\n              </Label>\n              <div className=\"col-span-3 space-y-1\">\n                <Input\n                  id=\"loginUrl\"\n                  value={eInvoiceForm.loginUrl}\n                  onChange={(e) => {\n                    setEInvoiceForm((prev) => ({\n                      ...prev,\n                      loginUrl: e.target.value,\n                    }));\n                    if (eInvoiceFormErrors.loginUrl) {\n                      setEInvoiceFormErrors((prev) => ({\n                        ...prev,\n                        loginUrl: \"\",\n                      }));\n                    }\n                  }}\n                  className={`${eInvoiceFormErrors.loginUrl ? \"border-red-500\" : \"\"}`}\n                  placeholder=\"https://api.example.com\"\n                />\n                {eInvoiceFormErrors.loginUrl && (\n                  <p className=\"text-sm text-red-500\">\n                    {eInvoiceFormErrors.loginUrl}\n                  </p>\n                )}\n              </div>\n            </div>\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"signMethod\" className=\"text-right\">\n                {t(\"settings.signMethodLabel\")}\n              </Label>\n              <Select\n                value={eInvoiceForm.signMethod}\n                onValueChange={(value) =>\n                  setEInvoiceForm((prev) => ({ ...prev, signMethod: value }))\n                }\n              >\n                <SelectTrigger className=\"col-span-3\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"Ký server\">{t(\"settings.signMethodServer\")}</SelectItem>\n                  <SelectItem value=\"Ký USB Token\">{t(\"settings.signMethodUsbToken\")}</SelectItem>\n                  <SelectItem value=\"Ký HSM\">{t(\"settings.signMethodHsm\")}</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"cqtCode\" className=\"text-right\">\n                {t(\"settings.cqtCodeLabel\")}\n              </Label>\n              <Select\n                value={eInvoiceForm.cqtCode}\n                onValueChange={(value) =>\n                  setEInvoiceForm((prev) => ({ ...prev, cqtCode: value }))\n                }\n              >\n                <SelectTrigger className=\"col-span-3\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"Cấp nhật\">{t(\"settings.cqtCodeLevel1\")}</SelectItem>\n                  <SelectItem value=\"Cấp hai\">{t(\"settings.cqtCodeLevel2\")}</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"notes\" className=\"text-right\">\n                {t(\"settings.notesLabel\")}\n              </Label>\n              <Textarea\n                id=\"notes\"\n                value={eInvoiceForm.notes}\n                onChange={(e) =>\n                  setEInvoiceForm((prev) => ({\n                    ...prev,\n                    notes: e.target.value,\n                  }))\n                }\n                className=\"col-span-3\"\n                placeholder={t(\"settings.notesPlaceholder\")}\n                rows={3}\n              />\n            </div>\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"isDefault\" className=\"text-right\">\n                {t(\"settings.defaultConnection\")}\n              </Label>\n              <div className=\"col-span-3 flex items-center space-x-2\">\n                <Switch\n                  id=\"isDefault\"\n                  checked={eInvoiceForm.isActive}\n                  onCheckedChange={(checked) =>\n                    setEInvoiceForm((prev) => ({ ...prev, isActive: checked }))\n                  }\n                />\n                <Label htmlFor=\"isDefault\" className=\"text-sm\">\n                  {t(\"settings.setAsDefaultConnection\")}\n                </Label>\n              </div>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setShowEInvoiceForm(false);\n                resetEInvoiceForm();\n              }}\n            >\n              {t(\"settings.cancel\")}\n            </Button>\n            <Button\n              onClick={\n                editingEInvoice ? handleUpdateEInvoice : handleCreateEInvoice\n              }\n              className=\"bg-green-600 hover:bg-green-700\"\n            >\n              {editingEInvoice ? t(\"common.update\") : t(\"settings.addConnection\")}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n      {/* Invoice Template Form Modal */}\n      <Dialog open={showTemplateForm} onOpenChange={setShowTemplateForm}>\n        <DialogContent className=\"sm:max-w-[425px]\">\n          <DialogHeader>\n            <DialogTitle>\n              {editingTemplate ? t(\"settings.editTemplateTitle\") : t(\"settings.addTemplateTitle\")}\n            </DialogTitle>\n            <DialogDescription>\n              {editingTemplate \n                ? t(\"settings.editTemplateDesc\")\n                : t(\"settings.addTemplateDesc\")\n              }\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"grid gap-4 py-4\">\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"templateName\" className=\"text-right\">\n                {t(\"settings.templateNameLabel\")}\n              </Label>\n              <Input\n                id=\"templateName\"\n                value={templateForm.name}\n                onChange={(e) =>\n                  setTemplateForm((prev) => ({ ...prev, name: e.target.value }))\n                }\n                className=\"col-span-3\"\n                placeholder=\"Ví dụ: Mẫu số 1\"\n              />\n            </div>\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"templateNumber\" className=\"text-right\">\n                {t(\"settings.templateNumberLabel\")}\n              </Label>\n              <Input\n                id=\"templateNumber\"\n                value={templateForm.templateNumber}\n                onChange={(e) =>\n                  setTemplateForm((prev) => ({\n                    ...prev,\n                    templateNumber: e.target.value,\n                  }))\n                }\n                className=\"col-span-3\"\n                placeholder=\"Ví dụ: 01GTKT0/001\"\n              />\n            </div>\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"templateCode\" className=\"text-right\">\n                {t(\"settings.templateCodeLabel\")}\n              </Label>\n              <Input\n                id=\"templateCode\"\n                value={templateForm.templateCode}\n                onChange={(e) =>\n                  setTemplateForm((prev) => ({\n                    ...prev,\n                    templateCode: e.target.value,\n                  }))\n                }\n                className=\"col-span-3\"\n                placeholder=\"Ví dụ: 123451/88890345\"\n              />\n            </div>\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"symbol\" className=\"text-right\">\n                {t(\"settings.templateSymbolLabel\")}\n              </Label>\n              <Input\n                id=\"symbol\"\n                value={templateForm.symbol}\n                onChange={(e) =>\n                  setTemplateForm((prev) => ({ ...prev, symbol: e.target.value }))\n                }\n                className=\"col-span-3\"\n                placeholder=\"Ví dụ: AA/19E\"\n              />\n            </div>\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"useCK\" className=\"text-right\">\n                {t(\"settings.templateUsage\")}\n              </Label>\n              <Switch\n                id=\"useCK\"\n                checked={templateForm.useCK}\n                onCheckedChange={(checked) =>\n                  setTemplateForm((prev) => ({ ...prev, useCK: checked }))\n                }\n              />\n            </div>\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"notes\" className=\"text-right\">\n                {t(\"common.notes\")}\n              </Label>\n              <Textarea\n                id=\"notes\"\n                value={templateForm.notes}\n                onChange={(e) =>\n                  setTemplateForm((prev) => ({ ...prev, notes: e.target.value }))\n                }\n                className=\"col-span-3\"\n                placeholder={t(\"common.notesPlaceholder\")}\n                rows={3}\n              />\n            </div>\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"isDefault\" className=\"text-right\">\n                {t(\"settings.templateDefault\")}\n              </Label>\n              <div className=\"col-span-3 flex items-center space-x-2\">\n                <Switch\n                  id=\"isDefault\"\n                  checked={templateForm.isDefault}\n                  onCheckedChange={(checked) =>\n                    setTemplateForm((prev) => ({ ...prev, isDefault: checked }))\n                  }\n                />\n                <Label htmlFor=\"isDefault\" className=\"text-sm\">\n                  {t(\"settings.templateSetDefault\")}\n                </Label>\n              </div>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setShowTemplateForm(false);\n                resetTemplateForm();\n              }}\n            >\n              {t(\"common.cancel\")}\n            </Button>\n            <Button\n              onClick={editingTemplate ? handleUpdateTemplate : handleCreateTemplate}\n              disabled={createTemplateMutation.isPending || updateTemplateMutation.isPending}\n              className=\"bg-green-600 hover:bg-green-700\"\n            >\n              {(createTemplateMutation.isPending || updateTemplateMutation.isPending) \n                ? (editingTemplate ? t(\"common.updating\") : t(\"common.creating\"))\n                : (editingTemplate ? t(\"common.update\") : t(\"settings.addTemplate\"))\n              }\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Template Delete Confirmation Dialog */}\n      <AlertDialog\n        open={showTemplateDeleteDialog}\n        onOpenChange={setShowTemplateDeleteDialog}\n      >\n        <AlertDialogContent className=\"sm:max-w-[425px]\">\n          <AlertDialogHeader>\n            <AlertDialogTitle className=\"flex items-center gap-2 text-red-600\">\n              <Trash2 className=\"w-5 h-5\" />\n              Xác nhận xóa mẫu số HĐĐT\n            </AlertDialogTitle>\n            <AlertDialogDescription className=\"text-left\">\n              <div className=\"space-y-3\">\n                <p>\n                  Bạn có chắc chắn muốn xóa mẫu số{\" \"}\n                  <span className=\"font-semibold text-gray-900\">\n                    \"{templateToDelete?.name}\"\n                  </span>{\" \"}\n                  không?\n                </p>\n                <div className=\"bg-red-50 border border-red-200 rounded-lg p-3\">\n                  <div className=\"flex items-start gap-2\">\n                    <div className=\"w-2 h-2 bg-red-400 rounded-full mt-2 flex-shrink-0\"></div>\n                    <p className=\"text-sm text-red-700\">\n                      <strong>Cảnh báo:</strong> Hành động này không thể hoàn\n                      tác. Mẫu số HĐĐT sẽ bị xóa vĩnh viễn khỏi hệ thống.\n                    </p>\n                  </div>\n                </div>\n                <p className=\"text-sm text-gray-600\">\n                  Điều này có thể ảnh hưởng đến việc xuất hóa đơn điện tử.\n                </p>\n              </div>\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter className=\"gap-2\">\n            <AlertDialogCancel\n              onClick={() => {\n                setShowTemplateDeleteDialog(false);\n                setTemplateToDelete(null);\n              }}\n              className=\"hover:bg-gray-100\"\n            >\n              Hủy bỏ\n            </AlertDialogCancel>\n            <AlertDialogAction\n              onClick={confirmDeleteTemplate}\n              className=\"bg-red-600 hover:bg-red-700 focus:ring-red-600\"\n            >\n              <Trash2 className=\"w-4 h-4 mr-2\" />\n              Xóa mẫu số\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      {/* Payment Method Form Modal */}\n      <Dialog open={showPaymentMethodForm} onOpenChange={setShowPaymentMethodForm}>\n        <DialogContent className=\"sm:max-w-[425px]\">\n          <DialogHeader>\n            <DialogTitle>\n              Chỉnh sửa phương thức thanh toán\n            </DialogTitle>\n            <DialogDescription>\n              Cập nhật thông tin của phương thức thanh toán\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"grid gap-4 py-4\">\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"paymentMethodName\" className=\"text-right\">\n                Tên phương thức\n              </Label>\n              <Input\n                id=\"paymentMethodName\"\n                value={paymentMethodForm.name}\n                onChange={(e) =>\n                  setPaymentMethodForm((prev) => ({ ...prev, name: e.target.value }))\n                }\n                className=\"col-span-3\"\n                placeholder=\"Nhập tên phương thức thanh toán\"\n              />\n            </div>\n            <div className=\"grid grid-cols-4 items-center gap-4\">\n              <Label htmlFor=\"paymentMethodIcon\" className=\"text-right\">\n                Biểu tượng\n              </Label>\n              <Input\n                id=\"paymentMethodIcon\"\n                value={paymentMethodForm.icon}\n                onChange={(e) =>\n                  setPaymentMethodForm((prev) => ({ ...prev, icon: e.target.value }))\n                }\n                className=\"col-span-3\"\n                placeholder=\"Nhập emoji biểu tượng\"\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setShowPaymentMethodForm(false);\n                resetPaymentMethodForm();\n              }}\n            >\n              Hủy bỏ\n            </Button>\n            <Button\n              onClick={handleUpdatePaymentMethod}\n              className=\"bg-green-600 hover:bg-green-700\"\n            >\n              Cập nhật\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":178874},"client/src/pages/suppliers.tsx":{"content":"\nimport { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Link } from \"wouter\";\nimport { POSHeader } from \"@/components/pos/header\";\nimport { RightSidebar } from \"@/components/ui/right-sidebar\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Building2, Search, Plus, Edit, Trash2, Phone, Mail, MapPin } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport type { Supplier } from \"@shared/schema\";\nimport { SupplierFormModal } from \"@/components/suppliers/supplier-form-modal\";\n\nexport default function SuppliersPage() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [selectedStatus, setSelectedStatus] = useState<string>(\"all\");\n  const [showForm, setShowForm] = useState(false);\n  const [editingSupplier, setEditingSupplier] = useState<Supplier | null>(null);\n  const { toast } = useToast();\n  const { t } = useTranslation();\n  const queryClient = useQueryClient();\n\n  const { data: suppliers, isLoading } = useQuery({\n    queryKey: ['/api/suppliers', { status: selectedStatus, search: searchQuery }],\n    queryFn: async () => {\n      const params = new URLSearchParams();\n      if (selectedStatus !== 'all') params.append('status', selectedStatus);\n      if (searchQuery) params.append('search', searchQuery);\n      \n      const response = await apiRequest('GET', `/api/suppliers?${params}`);\n      return response.json();\n    },\n  });\n\n  const deleteSupplierMutation = useMutation({\n    mutationFn: async (id: number) => {\n      const response = await apiRequest('DELETE', `/api/suppliers/${id}`);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/suppliers'] });\n      toast({\n        title: t('suppliers.deleteSuccess'),\n        description: t('suppliers.deleteSuccessDesc'),\n      });\n    },\n    onError: () => {\n      toast({\n        title: t('suppliers.deleteFailed'),\n        description: t('suppliers.deleteFailedDesc'),\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleEdit = (supplier: Supplier) => {\n    setEditingSupplier(supplier);\n    setShowForm(true);\n  };\n\n  const handleDelete = (id: number) => {\n    if (confirm(t('suppliers.confirmDelete'))) {\n      deleteSupplierMutation.mutate(id);\n    }\n  };\n\n  const handleFormClose = () => {\n    setShowForm(false);\n    setEditingSupplier(null);\n  };\n\n  const filteredSuppliers = suppliers || [];\n\n  return (\n    <div className=\"min-h-screen bg-green-50 grocery-bg\">\n      <POSHeader />\n      <RightSidebar />\n      \n      <div className=\"main-content pt-16 px-6\">\n        <div className=\"max-w-7xl mx-auto py-8\">\n          {/* Page Header */}\n          <div className=\"flex justify-between items-center mb-8\">\n            <div>\n              <h1 className=\"text-3xl font-bold text-gray-900\">{t('suppliers.title')}</h1>\n              <p className=\"mt-2 text-gray-600\">{t('suppliers.description')}</p>\n            </div>\n            <div className=\"flex gap-4\">\n              <Button onClick={() => setShowForm(true)}>\n                <Plus className=\"w-4 h-4 mr-2\" />\n                {t('suppliers.addSupplier')}\n              </Button>\n              <Link href=\"/\">\n                <Button variant=\"outline\">\n                  {t('common.backToPOS')}\n                </Button>\n              </Link>\n            </div>\n          </div>\n\n          {/* Filters */}\n          <div className=\"flex gap-4 mb-6\">\n            <div className=\"relative flex-1 max-w-md\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4\" />\n              <Input\n                placeholder={t('suppliers.searchPlaceholder')}\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                className=\"pl-10\"\n              />\n            </div>\n            \n            <div className=\"flex gap-2\">\n              <Button\n                variant={selectedStatus === \"all\" ? \"default\" : \"outline\"}\n                size=\"sm\"\n                onClick={() => setSelectedStatus(\"all\")}\n              >\n                {t('common.all')}\n              </Button>\n              <Button\n                variant={selectedStatus === \"active\" ? \"default\" : \"outline\"}\n                size=\"sm\"\n                onClick={() => setSelectedStatus(\"active\")}\n              >\n                {t('suppliers.active')}\n              </Button>\n              <Button\n                variant={selectedStatus === \"inactive\" ? \"default\" : \"outline\"}\n                size=\"sm\"\n                onClick={() => setSelectedStatus(\"inactive\")}\n              >\n                {t('suppliers.inactive')}\n              </Button>\n            </div>\n          </div>\n\n          {/* Suppliers Grid */}\n          {isLoading ? (\n            <div className=\"text-center py-8\">\n              <div className=\"text-gray-500\">{t('common.loading')}</div>\n            </div>\n          ) : filteredSuppliers.length === 0 ? (\n            <Card>\n              <CardContent className=\"text-center py-8\">\n                <Building2 className=\"w-12 h-12 mx-auto mb-4 text-gray-300\" />\n                <p className=\"text-gray-500\">{t('suppliers.noSuppliers')}</p>\n              </CardContent>\n            </Card>\n          ) : (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {filteredSuppliers.map((supplier: Supplier) => (\n                <Card key={supplier.id}>\n                  <CardHeader>\n                    <div className=\"flex justify-between items-start\">\n                      <div>\n                        <CardTitle className=\"text-lg\">{supplier.name}</CardTitle>\n                        <CardDescription>{supplier.code}</CardDescription>\n                      </div>\n                      <Badge variant={supplier.status === 'active' ? 'default' : 'secondary'}>\n                        {supplier.status === 'active' ? t('suppliers.active') : t('suppliers.inactive')}\n                      </Badge>\n                    </div>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-2\">\n                      {supplier.contactPerson && (\n                        <div className=\"flex items-center text-sm text-gray-600\">\n                          <Building2 className=\"w-4 h-4 mr-2\" />\n                          {supplier.contactPerson}\n                        </div>\n                      )}\n                      {supplier.phone && (\n                        <div className=\"flex items-center text-sm text-gray-600\">\n                          <Phone className=\"w-4 h-4 mr-2\" />\n                          {supplier.phone}\n                        </div>\n                      )}\n                      {supplier.email && (\n                        <div className=\"flex items-center text-sm text-gray-600\">\n                          <Mail className=\"w-4 h-4 mr-2\" />\n                          {supplier.email}\n                        </div>\n                      )}\n                      {supplier.address && (\n                        <div className=\"flex items-center text-sm text-gray-600\">\n                          <MapPin className=\"w-4 h-4 mr-2\" />\n                          {supplier.address}\n                        </div>\n                      )}\n                      {supplier.paymentTerms && (\n                        <div className=\"text-sm text-gray-600\">\n                          <span className=\"font-medium\">{t('suppliers.paymentTerms')}:</span> {supplier.paymentTerms}\n                        </div>\n                      )}\n                    </div>\n                    \n                    <div className=\"flex gap-2 mt-4\">\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={() => handleEdit(supplier)}\n                      >\n                        <Edit className=\"w-3 h-3 mr-1\" />\n                        {t('common.edit')}\n                      </Button>\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={() => handleDelete(supplier.id)}\n                        className=\"text-red-600 hover:text-red-700\"\n                      >\n                        <Trash2 className=\"w-3 h-3 mr-1\" />\n                        {t('common.delete')}\n                      </Button>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Supplier Form Modal */}\n      <SupplierFormModal\n        isOpen={showForm}\n        onClose={handleFormClose}\n        supplier={editingSupplier}\n      />\n    </div>\n  );\n}\n","size_bytes":9096},"client/src/pages/tables.tsx":{"content":"import { useState } from \"react\";\nimport { POSHeader } from \"@/components/pos/header\";\nimport { RightSidebar } from \"@/components/ui/right-sidebar\";\nimport { TableGrid } from \"@/components/tables/table-grid\";\nimport { OrderManagement } from \"@/components/orders/order-management\";\nimport { TableManagement } from \"@/components/tables/table-management\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Utensils, Settings, ClipboardList, ShoppingCart } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { useTranslation } from \"@/lib/i18n\";\n\nexport default function TablesPage() {\n  const [selectedTableId, setSelectedTableId] = useState<number | null>(null);\n  const { t } = useTranslation();\n\n  return (\n    <div className=\"min-h-screen bg-green-50 grocery-bg\">\n      {/* Header */}\n      <POSHeader />\n      \n      {/* Right Sidebar */}\n      <RightSidebar />\n      \n      <div className=\"main-content pt-16 px-6\">\n        <div className=\"max-w-5xl mx-auto py-8\">\n          {/* Page Header */}\n          <div className=\"flex justify-between items-center mb-8\">\n            <div>\n              <h1 className=\"text-3xl font-bold text-gray-900\">{t('tables.title')}</h1>\n              <p className=\"mt-2 text-gray-600\">{t('tables.description')}</p>\n            </div>\n            <div className=\"flex gap-4\">\n              <Link href=\"/\">\n                <Button variant=\"outline\">\n                  <ShoppingCart className=\"w-4 h-4 mr-2\" />\n                  Quay lại Bán hàng\n                </Button>\n              </Link>\n            </div>\n          </div>\n\n          <Tabs defaultValue=\"tables\" className=\"space-y-6\">\n            <TabsList className=\"grid w-full grid-cols-3\">\n              <TabsTrigger value=\"tables\" className=\"flex items-center gap-2\">\n                <Utensils className=\"w-4 h-4\" />\n                {t('tables.tableStatus')}\n              </TabsTrigger>\n              <TabsTrigger value=\"orders\" className=\"flex items-center gap-2\">\n                <ClipboardList className=\"w-4 h-4\" />\n                {t('tables.orderManagement')}\n              </TabsTrigger>\n              <TabsTrigger value=\"management\" className=\"flex items-center gap-2\">\n                <Settings className=\"w-4 h-4\" />\n                {t('tables.tableSettings')}\n              </TabsTrigger>\n            </TabsList>\n\n            <TabsContent value=\"tables\">\n              <TableGrid onTableSelect={setSelectedTableId} selectedTableId={selectedTableId} />\n            </TabsContent>\n\n            <TabsContent value=\"orders\">\n              <OrderManagement />\n            </TabsContent>\n\n            <TabsContent value=\"management\">\n              <TableManagement />\n            </TabsContent>\n          </Tabs>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":2859},"client/src/components/attendance/attendance-list.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Calendar, Clock, User } from \"lucide-react\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport type { AttendanceRecord, Employee } from \"@shared/schema\";\n\ninterface AttendanceListProps {\n  selectedDate: string;\n  onDateChange: (date: string) => void;\n}\n\nexport function AttendanceList({ selectedDate, onDateChange }: AttendanceListProps) {\n  const { t } = useTranslation();\n  const { data: employees } = useQuery({\n    queryKey: ['/api/employees'],\n  });\n\n  const { data: attendanceRecords, isLoading } = useQuery({\n    queryKey: ['/api/attendance', selectedDate],\n    queryFn: async () => {\n      const response = await fetch(`/api/attendance?date=${selectedDate}`);\n      if (!response.ok) {\n        throw new Error('Failed to fetch attendance records');\n      }\n      return response.json();\n    }\n  });\n\n  const getEmployeeName = (employeeId: number) => {\n    const employee = employees?.find((emp: Employee) => emp.id === employeeId);\n    return employee?.name || t('attendance.unknownEmployee');\n  };\n\n  const formatTime = (dateString: string | null) => {\n    if (!dateString) return \"-\";\n    return new Date(dateString).toLocaleTimeString('vi-VN', {\n      hour: '2-digit',\n      minute: '2-digit',\n      hour12: false\n    });\n  };\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('vi-VN', {\n      day: '2-digit',\n      month: '2-digit',\n      year: 'numeric'\n    });\n  };\n\n  const getStatusBadge = (status: string) => {\n    const statusConfig = {\n      present: { label: t('attendance.status.present'), variant: \"default\" as const },\n      absent: { label: t('attendance.status.absent'), variant: \"destructive\" as const },\n      late: { label: t('attendance.status.late'), variant: \"secondary\" as const },\n      half_day: { label: t('attendance.status.halfDay'), variant: \"outline\" as const },\n    };\n\n    const config = statusConfig[status as keyof typeof statusConfig] || { label: status, variant: \"outline\" as const };\n    return <Badge variant={config.variant}>{config.label}</Badge>;\n  };\n\n  const calculateBreakTime = (breakStart: string | null, breakEnd: string | null) => {\n    if (!breakStart || !breakEnd) return \"-\";\n    const start = new Date(breakStart);\n    const end = new Date(breakEnd);\n    const minutes = (end.getTime() - start.getTime()) / (1000 * 60);\n    const hours = Math.floor(minutes / 60);\n    const mins = Math.floor(minutes % 60);\n    return hours > 0 ? `${hours}${t('attendance.hours')} ${mins}${t('attendance.minutes')}` : `${mins}${t('attendance.minutes')}`;\n  };\n\n  return (\n    <Card>\n      <CardHeader>\n        <div className=\"flex justify-between items-center\">\n          <div>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Calendar className=\"w-5 h-5\" />\n              {t('attendance.attendanceRecords')}\n            </CardTitle>\n            <CardDescription>\n              {t('attendance.recordsDescription')}\n            </CardDescription>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Label htmlFor=\"date-picker\">{t('attendance.selectedDate')}:</Label>\n            <Input\n              id=\"date-picker\"\n              type=\"date\"\n              value={selectedDate}\n              onChange={(e) => onDateChange(e.target.value)}\n              className=\"w-auto\"\n            />\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent>\n        {isLoading ? (\n          <div className=\"flex justify-center py-8\">\n            <div className=\"text-gray-500\">{t('common.loading')}</div>\n          </div>\n        ) : !attendanceRecords || !Array.isArray(attendanceRecords) || attendanceRecords.length === 0 ? (\n          <div className=\"text-center py-8\">\n            <Clock className=\"w-12 h-12 mx-auto text-gray-400 mb-4\" />\n            <p className=\"text-gray-500\">{t('attendance.noRecords')}</p>\n            <p className=\"text-sm text-gray-400 mt-2\">{t('attendance.selectOtherDate')}</p>\n          </div>\n        ) : (\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>{t('employees.name')}</TableHead>\n                <TableHead>{t('common.status')}</TableHead>\n                <TableHead>{t('attendance.clockInTime')}</TableHead>\n                <TableHead>{t('attendance.clockOutTime')}</TableHead>\n                <TableHead>{t('attendance.breakTime')}</TableHead>\n                <TableHead>{t('attendance.totalHours')}</TableHead>\n                <TableHead>{t('attendance.overtime')}</TableHead>\n                <TableHead>{t('attendance.notes')}</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {attendanceRecords.map((record: AttendanceRecord) => (\n                <TableRow key={record.id}>\n                  <TableCell>\n                    <div className=\"flex items-center gap-2\">\n                      <User className=\"w-4 h-4 text-gray-400\" />\n                      {getEmployeeName(record.employeeId)}\n                    </div>\n                  </TableCell>\n                  <TableCell>{getStatusBadge(record.status)}</TableCell>\n                  <TableCell>{formatTime(record.clockIn)}</TableCell>\n                  <TableCell>{formatTime(record.clockOut)}</TableCell>\n                  <TableCell>{calculateBreakTime(record.breakStart, record.breakEnd)}</TableCell>\n                  <TableCell>\n                    {record.totalHours ? `${record.totalHours}${t('attendance.hours')}` : \"-\"}\n                  </TableCell>\n                  <TableCell>\n                    {record.overtime && parseFloat(record.overtime) > 0 ? (\n                      <Badge variant=\"secondary\">{record.overtime}{t('attendance.hours')}</Badge>\n                    ) : \"-\"}\n                  </TableCell>\n                  <TableCell className=\"max-w-xs\">\n                    {record.notes ? (\n                      <span className=\"text-sm text-gray-600\">{record.notes}</span>\n                    ) : \"-\"}\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        )}\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":6553},"client/src/components/attendance/attendance-stats.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { BarChart3, Clock, Users, TrendingUp, Calendar } from \"lucide-react\";\nimport type { AttendanceRecord, Employee } from \"@shared/schema\";\nimport { useTranslation } from \"@/lib/i18n\";\n\nexport function AttendanceStats() {\n  const { t, currentLanguage } = useTranslation();\n  const [selectedMonth, setSelectedMonth] = useState<string>(\n    new Date().toISOString().slice(0, 7) // YYYY-MM format\n  );\n\n  const { data: employees } = useQuery({\n    queryKey: ['/api/employees'],\n  });\n\n  const { data: attendanceRecords } = useQuery({\n    queryKey: ['/api/attendance'],\n  });\n\n  const getMonthlyStats = () => {\n    if (!attendanceRecords || !employees) return null;\n\n    const monthRecords = attendanceRecords.filter((record: AttendanceRecord) => {\n      const recordDate = new Date(record.clockIn);\n      const recordMonth = recordDate.toISOString().slice(0, 7);\n      return recordMonth === selectedMonth;\n    });\n\n    const stats = {\n      totalWorkingDays: new Set(monthRecords.map((r: AttendanceRecord) => \n        new Date(r.clockIn).toDateString()\n      )).size,\n      totalEmployees: employees.length,\n      totalAttendance: monthRecords.length,\n      totalWorkingHours: monthRecords.reduce((sum: number, record: AttendanceRecord) => \n        sum + (parseFloat(record.totalHours || \"0\")), 0\n      ),\n      totalOvertime: monthRecords.reduce((sum: number, record: AttendanceRecord) => \n        sum + (parseFloat(record.overtime || \"0\")), 0\n      ),\n      averageWorkingHours: 0,\n      attendanceRate: 0,\n    };\n\n    stats.averageWorkingHours = stats.totalAttendance > 0 \n      ? stats.totalWorkingHours / stats.totalAttendance \n      : 0;\n\n    stats.attendanceRate = stats.totalWorkingDays > 0 \n      ? (stats.totalAttendance / (stats.totalEmployees * stats.totalWorkingDays)) * 100 \n      : 0;\n\n    return stats;\n  };\n\n  const getEmployeeStats = () => {\n    if (!attendanceRecords || !employees) return [];\n\n    return employees.map((employee: Employee) => {\n      const employeeRecords = attendanceRecords.filter((record: AttendanceRecord) => {\n        const recordDate = new Date(record.clockIn);\n        const recordMonth = recordDate.toISOString().slice(0, 7);\n        return record.employeeId === employee.id && recordMonth === selectedMonth;\n      });\n\n      const totalHours = employeeRecords.reduce((sum: number, record: AttendanceRecord) => \n        sum + (parseFloat(record.totalHours || \"0\")), 0\n      );\n\n      const overtimeHours = employeeRecords.reduce((sum: number, record: AttendanceRecord) => \n        sum + (parseFloat(record.overtime || \"0\")), 0\n      );\n\n      const lateCount = employeeRecords.filter((r: AttendanceRecord) => r.status === 'late').length;\n      const absentCount = employeeRecords.filter((r: AttendanceRecord) => r.status === 'absent').length;\n\n      return {\n        employee,\n        totalDays: employeeRecords.length,\n        totalHours: totalHours.toFixed(1),\n        overtimeHours: overtimeHours.toFixed(1),\n        lateCount,\n        absentCount,\n        attendanceRate: employeeRecords.length > 0 \n          ? ((employeeRecords.length - absentCount) / employeeRecords.length) * 100 \n          : 0,\n      };\n    });\n  };\n\n  const monthlyStats = getMonthlyStats();\n  const employeeStats = getEmployeeStats();\n\n  const formatMonth = (monthStr: string) => {\n    const date = new Date(monthStr + \"-01\");\n    const locale = currentLanguage === 'ko' ? 'ko-KR' : currentLanguage === 'vi' ? 'vi-VN' : 'en-US';\n    return date.toLocaleDateString(locale, { \n      year: 'numeric', \n      month: 'long' \n    });\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Date Selector */}\n      <Card>\n        <CardHeader>\n          <div className=\"flex justify-between items-center\">\n            <div>\n              <CardTitle className=\"flex items-center gap-2\">\n                <BarChart3 className=\"w-5 h-5\" />\n                {t('attendance.monthlyStats')}\n              </CardTitle>\n              <CardDescription>\n                {t('attendance.monthlyStatsDesc')}\n              </CardDescription>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Label htmlFor=\"month-picker\">{t('attendance.selectMonth')}:</Label>\n              <Input\n                id=\"month-picker\"\n                type=\"month\"\n                value={selectedMonth}\n                onChange={(e) => setSelectedMonth(e.target.value)}\n                className=\"w-auto\"\n              />\n            </div>\n          </div>\n        </CardHeader>\n      </Card>\n\n      {/* Monthly Overview */}\n      {monthlyStats && (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-gray-600\">{t('attendance.totalWorkDays')}</p>\n                  <p className=\"text-3xl font-bold\">{monthlyStats.totalWorkingDays}</p>\n                </div>\n                <Calendar className=\"w-8 h-8 text-blue-500\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-gray-600\">{t('attendance.totalAttendance')}</p>\n                  <p className=\"text-3xl font-bold\">{monthlyStats.totalAttendance}</p>\n                </div>\n                <Users className=\"w-8 h-8 text-green-500\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-gray-600\">{t('attendance.totalWorkHours')}</p>\n                  <p className=\"text-3xl font-bold\">{monthlyStats.totalWorkingHours.toFixed(1)}</p>\n                  <p className=\"text-xs text-gray-500\">{t('attendance.hours')}</p>\n                </div>\n                <Clock className=\"w-8 h-8 text-purple-500\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-gray-600\">{t('attendance.totalOvertime')}</p>\n                  <p className=\"text-3xl font-bold\">{monthlyStats.totalOvertime.toFixed(1)}</p>\n                  <p className=\"text-xs text-gray-500\">{t('attendance.hours')}</p>\n                </div>\n                <TrendingUp className=\"w-8 h-8 text-orange-500\" />\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      )}\n\n      {/* Summary Stats */}\n      {monthlyStats && (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"text-lg\">{t('attendance.averageWorkHours')}</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-blue-600\">\n                {monthlyStats.averageWorkingHours.toFixed(1)} {t('attendance.hours')}\n              </div>\n              <p className=\"text-sm text-gray-600 mt-2\">{t('attendance.dailyAverageWorkHours')}</p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"text-lg\">{t('attendance.attendanceRate')}</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-green-600\">\n                {monthlyStats.attendanceRate.toFixed(1)}%\n              </div>\n              <p className=\"text-sm text-gray-600 mt-2\">{t('attendance.overallAttendanceRate')}</p>\n            </CardContent>\n          </Card>\n        </div>\n      )}\n\n      {/* Employee Stats */}\n      <Card>\n        <CardHeader>\n          <CardTitle>{t('attendance.employeeStats')} ({formatMonth(selectedMonth)})</CardTitle>\n          <CardDescription>\n            {t('attendance.employeeStatsDesc')}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          {employeeStats.length === 0 ? (\n            <div className=\"text-center py-8\">\n              <Users className=\"w-12 h-12 mx-auto text-gray-400 mb-4\" />\n              <p className=\"text-gray-500\">{t('attendance.noRecords')}</p>\n            </div>\n          ) : (\n            <div className=\"space-y-4\">\n              {employeeStats.map(({ employee, totalDays, totalHours, overtimeHours, lateCount, absentCount, attendanceRate }) => (\n                <div key={employee.id} className=\"border rounded-lg p-4\">\n                  <div className=\"flex justify-between items-start mb-3\">\n                    <div>\n                      <h3 className=\"font-semibold\">{employee.name}</h3>\n                      <p className=\"text-sm text-gray-600\">{t(`employees.roles.${employee.role}`)}</p>\n                    </div>\n                    <Badge variant={attendanceRate >= 95 ? \"default\" : attendanceRate >= 85 ? \"secondary\" : \"destructive\"}>\n                      {t('attendance.attendanceRate')} {attendanceRate.toFixed(1)}%\n                    </Badge>\n                  </div>\n\n                  <div className=\"grid grid-cols-2 md:grid-cols-5 gap-4 text-sm\">\n                    <div>\n                      <p className=\"text-gray-600\">{t('attendance.workDays')}</p>\n                      <p className=\"font-semibold\">{totalDays}{t('attendance.days')}</p>\n                    </div>\n                    <div>\n                      <p className=\"text-gray-600\">{t('attendance.totalWorkHours')}</p>\n                      <p className=\"font-semibold\">{totalHours}{t('attendance.hours')}</p>\n                    </div>\n                    <div>\n                      <p className=\"text-gray-600\">{t('attendance.overtimeHours')}</p>\n                      <p className=\"font-semibold\">{overtimeHours}{t('attendance.hours')}</p>\n                    </div>\n                    <div>\n                      <p className=\"text-gray-600\">{t('attendance.lateCount')}</p>\n                      <p className=\"font-semibold text-orange-600\">{lateCount}{t('attendance.times')}</p>\n                    </div>\n                    <div>\n                      <p className=\"text-gray-600\">{t('attendance.absentCount')}</p>\n                      <p className=\"font-semibold text-red-600\">{absentCount}{t('attendance.times')}</p>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":11071},"client/src/components/attendance/clock-in-out.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Clock, LogIn, LogOut, Coffee, Play, QrCode, RefreshCw } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport QRCode from \"qrcode\";\nimport type { Employee, AttendanceRecord } from \"@shared/schema\";\n\nexport function ClockInOut() {\n  const [selectedEmployeeId, setSelectedEmployeeId] = useState<number | null>(null);\n  const [notes, setNotes] = useState(\"\");\n  const [isQRModalOpen, setIsQRModalOpen] = useState(false);\n  const [qrCodeUrl, setQrCodeUrl] = useState(\"\");\n  const [isRefreshing, setIsRefreshing] = useState(false);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { t } = useTranslation();\n\n  const { data: employees } = useQuery({\n    queryKey: ['/api/employees'],\n  });\n\n  const { data: todayAttendance, refetch: refetchTodayAttendance } = useQuery({\n    queryKey: ['/api/attendance/today', selectedEmployeeId],\n    enabled: !!selectedEmployeeId,\n  });\n\n  const clockInMutation = useMutation({\n    mutationFn: () => apiRequest('POST', '/api/attendance/clock-in', { \n      employeeId: selectedEmployeeId, \n      notes \n    }),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/attendance'] });\n      refetchTodayAttendance();\n      setNotes(\"\");\n      toast({\n        title: t('attendance.clockInSuccess'),\n        description: t('attendance.clockInSuccessDesc'),\n      });\n    },\n    onError: () => {\n      toast({\n        title: t('common.error'),\n        description: t('attendance.clockInError'),\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const clockOutMutation = useMutation({\n    mutationFn: () => apiRequest('POST', `/api/attendance/clock-out/${(todayAttendance as AttendanceRecord)?.id}`, {}),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/attendance'] });\n      refetchTodayAttendance();\n      toast({\n        title: t('attendance.clockOutSuccess'),\n        description: t('attendance.clockOutSuccessDesc'),\n      });\n    },\n    onError: () => {\n      toast({\n        title: t('common.error'),\n        description: t('attendance.clockOutError'),\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const breakStartMutation = useMutation({\n    mutationFn: () => apiRequest('POST', `/api/attendance/break-start/${(todayAttendance as AttendanceRecord)?.id}`, {}),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/attendance'] });\n      refetchTodayAttendance();\n      toast({\n        title: t('attendance.breakStartSuccess'),\n        description: t('attendance.breakStartSuccessDesc'),\n      });\n    },\n    onError: () => {\n      toast({\n        title: t('common.error'),\n        description: t('attendance.breakStartError'),\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const breakEndMutation = useMutation({\n    mutationFn: () => apiRequest('POST', `/api/attendance/break-end/${(todayAttendance as AttendanceRecord)?.id}`, {}),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/attendance'] });\n      refetchTodayAttendance();\n      toast({\n        title: t('attendance.breakEndSuccess'),\n        description: t('attendance.breakEndSuccessDesc'),\n      });\n    },\n    onError: () => {\n      toast({\n        title: t('common.error'),\n        description: t('attendance.breakEndError'),\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const selectedEmployee = (employees as Employee[] | undefined)?.find((emp: Employee) => emp.id === selectedEmployeeId);\n\n  const formatTime = (dateInput: Date | string) => {\n    return new Date(dateInput).toLocaleTimeString('vi-VN', {\n      hour: '2-digit',\n      minute: '2-digit',\n      hour12: false\n    });\n  };\n\n  const getWorkingHours = (clockIn: Date | string, clockOut?: Date | string | null) => {\n    const start = new Date(clockIn);\n    const end = clockOut ? new Date(clockOut) : new Date();\n    const diff = (end.getTime() - start.getTime()) / (1000 * 60 * 60);\n    return diff.toFixed(1);\n  };\n\n  const getStatusBadge = (record: AttendanceRecord) => {\n    if (!record.clockOut) {\n      if (record.breakStart && !record.breakEnd) {\n        return <Badge variant=\"secondary\">{t('attendance.status.onBreak')}</Badge>;\n      }\n      return <Badge variant=\"default\">{t('attendance.status.working')}</Badge>;\n    }\n    return <Badge variant=\"outline\">{t('attendance.status.clockedOut')}</Badge>;\n  };\n\n  const generateQRCode = async () => {\n    try {\n      const attendanceUrl = `${window.location.origin}/attendance-qr`;\n      const qrDataURL = await QRCode.toDataURL(attendanceUrl, {\n        width: 256,\n        margin: 2,\n        color: {\n          dark: '#000000',\n          light: '#FFFFFF'\n        }\n      });\n      setQrCodeUrl(qrDataURL);\n      setIsQRModalOpen(true);\n    } catch (error) {\n      toast({\n        title: t('common.error'),\n        description: \"QR 코드 생성에 실패했습니다.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  return (\n    <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n      {/* Employee Selection */}\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Clock className=\"w-5 h-5\" />\n                {t('attendance.employeeSelect')}\n              </CardTitle>\n              <CardDescription>\n                {t('attendance.selectEmployee')}\n              </CardDescription>\n            </div>\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={generateQRCode}\n              className=\"flex items-center gap-2\"\n            >\n              <QrCode className=\"w-4 h-4\" />\n              {t('attendance.qrAttendance')}\n            </Button>\n          </div>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"grid grid-cols-1 gap-2\">\n            {(employees as Employee[] | undefined)?.map((employee: Employee) => (\n              <Button\n                key={employee.id}\n                variant={selectedEmployeeId === employee.id ? \"default\" : \"outline\"}\n                className=\"justify-start\"\n                onClick={() => setSelectedEmployeeId(employee.id)}\n              >\n                <div className=\"flex items-center justify-between w-full\">\n                  <span>{employee.name}</span>\n                  <Badge variant=\"secondary\">{t(`employees.roles.${employee.role}`)}</Badge>\n                </div>\n              </Button>\n            )) || (\n              <p className=\"text-gray-500 text-center py-4\">{t('common.loading')}</p>\n            )}\n          </div>\n\n          {selectedEmployeeId && (\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"notes\">{t('attendance.notes')}</Label>\n              <Input\n                id=\"notes\"\n                value={notes}\n                onChange={(e) => setNotes(e.target.value)}\n                placeholder={t('attendance.notesPlaceholder')}\n              />\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Clock In/Out Actions */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Clock className=\"w-5 h-5\" />\n            {t('attendance.clockInOut')}\n          </CardTitle>\n          <CardDescription>\n            {selectedEmployee ? `${selectedEmployee.name}${t('attendance.workingTime')}` : t('attendance.selectEmployee')}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          {!selectedEmployee ? (\n            <div className=\"text-center py-8\">\n              <Clock className=\"w-12 h-12 mx-auto text-gray-400 mb-4\" />\n              <p className=\"text-gray-500\">{t('attendance.selectEmployee')}</p>\n            </div>\n          ) : (\n            <div className=\"space-y-4\">\n              {/* Today's Status */}\n              {todayAttendance && (todayAttendance as AttendanceRecord) && (\n                <div className=\"bg-blue-50 p-4 rounded-lg\">\n                  <div className=\"flex justify-between items-center mb-2\">\n                    <h4 className=\"font-medium\">{t('attendance.currentStatus')}</h4>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => {\n                        setIsRefreshing(true);\n                        refetchTodayAttendance();\n                        setTimeout(() => setIsRefreshing(false), 1000);\n                      }}\n                      className=\"h-6 w-6 p-0\"\n                      title={t('attendance.refresh')}\n                    >\n                      <RefreshCw className={`w-4 h-4 transition-transform duration-1000 ${isRefreshing ? 'rotate-180' : ''}`} />\n                    </Button>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <div className=\"flex justify-between items-center\">\n                      <span>{t('attendance.clockInTime')}:</span>\n                      <span className=\"font-medium\">{formatTime((todayAttendance as AttendanceRecord).clockIn)}</span>\n                    </div>\n                    {(todayAttendance as AttendanceRecord).clockOut && (\n                      <div className=\"flex justify-between items-center\">\n                        <span>{t('attendance.clockOutTime')}:</span>\n                        <span className=\"font-medium\">{formatTime((todayAttendance as AttendanceRecord).clockOut!)}</span>\n                      </div>\n                    )}\n                    <div className=\"flex justify-between items-center\">\n                      <span>{t('attendance.workingTime')}:</span>\n                      <span className=\"font-medium\">{getWorkingHours((todayAttendance as AttendanceRecord).clockIn, (todayAttendance as AttendanceRecord).clockOut)}{t('attendance.hours')}</span>\n                    </div>\n                    <div className=\"flex justify-between items-center\">\n                      <span>{t('common.status')}:</span>\n                      {getStatusBadge(todayAttendance as AttendanceRecord)}\n                    </div>\n                  </div>\n                </div>\n              )}\n\n              {/* Action Buttons */}\n              <div className=\"grid grid-cols-2 gap-2\">\n                {!todayAttendance ? (\n                  <Button\n                    onClick={() => clockInMutation.mutate()}\n                    disabled={clockInMutation.isPending}\n                    className=\"col-span-2\"\n                  >\n                    <LogIn className=\"w-4 h-4 mr-2\" />\n                    {clockInMutation.isPending ? t('common.loading') : t('attendance.clockIn')}\n                  </Button>\n                ) : (\n                  <>\n                    {!(todayAttendance as AttendanceRecord).clockOut && (\n                      <>\n                        {(todayAttendance as AttendanceRecord).breakStart && !(todayAttendance as AttendanceRecord).breakEnd ? (\n                          <Button\n                            onClick={() => breakEndMutation.mutate()}\n                            disabled={breakEndMutation.isPending}\n                            variant=\"outline\"\n                          >\n                            <Play className=\"w-4 h-4 mr-2\" />\n                            {t('attendance.breakEnd')}\n                          </Button>\n                        ) : (\n                          <Button\n                            onClick={() => breakStartMutation.mutate()}\n                            disabled={breakStartMutation.isPending}\n                            variant=\"outline\"\n                          >\n                            <Coffee className=\"w-4 h-4 mr-2\" />\n                            {t('attendance.breakStart')}\n                          </Button>\n                        )}\n                        <Button\n                          onClick={() => clockOutMutation.mutate()}\n                          disabled={clockOutMutation.isPending}\n                        >\n                          <LogOut className=\"w-4 h-4 mr-2\" />\n                          {t('attendance.clockOut')}\n                        </Button>\n                      </>\n                    )}\n                  </>\n                )}\n              </div>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* QR Code Modal */}\n      <Dialog open={isQRModalOpen} onOpenChange={setIsQRModalOpen}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <QrCode className=\"w-5 h-5\" />\n              {t('attendance.qrCodeTitle')}\n            </DialogTitle>\n            <DialogDescription>\n              {t('attendance.qrCodeDescription')}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"flex flex-col items-center space-y-4 py-4\">\n            {qrCodeUrl && (\n              <div className=\"bg-white p-4 rounded-lg border-2 border-gray-200\">\n                <img \n                  src={qrCodeUrl} \n                  alt=\"QR Code for Attendance\" \n                  className=\"w-64 h-64\"\n                />\n              </div>\n            )}\n            <div className=\"text-center space-y-2\">\n              <p className=\"text-sm text-gray-600\">\n                {t('attendance.qrCodeInstructions')}\n              </p>\n              <p className=\"text-xs text-gray-500\">\n                URL: {window.location.origin}/attendance-qr\n              </p>\n            </div>\n            <div className=\"flex gap-2 w-full\">\n              <Button\n                variant=\"outline\"\n                onClick={() => {\n                  navigator.clipboard.writeText(`${window.location.origin}/attendance-qr`);\n                  toast({\n                    title: t('attendance.copySuccess'),\n                    description: t('attendance.copySuccessDesc'),\n                  });\n                }}\n                className=\"flex-1\"\n              >\n                {t('attendance.urlCopy')}\n              </Button>\n              <Button\n                onClick={() => setIsQRModalOpen(false)}\n                className=\"flex-1\"\n              >\n                {t('common.close')}\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":15010},"client/src/components/auth/pin-auth.tsx":{"content":"\nimport { useState, useEffect } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Shield, Lock, Eye, EyeOff } from \"lucide-react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\ninterface PinAuthProps {\n  onAuthSuccess: () => void;\n}\n\nexport function PinAuth({ onAuthSuccess }: PinAuthProps) {\n  const [pin, setPin] = useState(\"\");\n  const [showPin, setShowPin] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n  const { toast } = useToast();\n\n  // Fetch store settings để lấy PIN\n  const { data: storeData } = useQuery({\n    queryKey: [\"/api/store-settings\"],\n    queryFn: async () => {\n      const response = await apiRequest(\"GET\", \"/api/store-settings\");\n      return response.json();\n    },\n  });\n\n  useEffect(() => {\n    // Kiểm tra nếu đã đăng nhập trong session này\n    const isAuthenticated = sessionStorage.getItem(\"pinAuthenticated\");\n    if (isAuthenticated === \"true\") {\n      onAuthSuccess();\n    }\n  }, [onAuthSuccess]);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!pin.trim()) {\n      toast({\n        title: \"Lỗi\",\n        description: \"Vui lòng nhập mã PIN\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsLoading(true);\n\n    try {\n      // Kiểm tra PIN với dữ liệu từ store settings\n      if (storeData?.pinCode && pin === storeData.pinCode) {\n        // Lưu trạng thái đăng nhập vào sessionStorage\n        sessionStorage.setItem(\"pinAuthenticated\", \"true\");\n        \n        toast({\n          title: \"Đăng nhập thành công\",\n          description: \"Chào mừng bạn đến với hệ thống POS\",\n        });\n        \n        onAuthSuccess();\n      } else {\n        toast({\n          title: \"Mã PIN không đúng\",\n          description: \"Vui lòng kiểm tra lại mã PIN\",\n          variant: \"destructive\",\n        });\n        setPin(\"\");\n      }\n    } catch (error) {\n      toast({\n        title: \"Lỗi hệ thống\",\n        description: \"Có lỗi xảy ra khi xác thực\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handlePinChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const value = e.target.value.replace(/\\D/g, ''); // Chỉ cho phép số\n    if (value.length <= 6) {\n      setPin(value);\n    }\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter') {\n      handleSubmit(e as any);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-green-400 via-green-500 to-green-600 flex items-center justify-center p-4\">\n      {/* Background Pattern */}\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <div\n          className=\"absolute inset-0 opacity-10\"\n          style={{\n            backgroundImage: `radial-gradient(circle at 25% 25%, #ffffff 0%, transparent 50%),\n                           radial-gradient(circle at 75% 25%, #ffffff 0%, transparent 50%),\n                           radial-gradient(circle at 25% 75%, #ffffff 0%, transparent 50%),\n                           radial-gradient(circle at 75% 75%, #ffffff 0%, transparent 50%)`,\n            backgroundSize: \"100px 100px\",\n          }}\n        ></div>\n      </div>\n\n      <Card className=\"w-full max-w-md bg-white/95 backdrop-blur-sm shadow-2xl border-0 relative z-10\">\n        <CardHeader className=\"text-center space-y-4 pb-2\">\n          <div className=\"mx-auto w-16 h-16 bg-green-500 rounded-full flex items-center justify-center\">\n            <Shield className=\"w-8 h-8 text-white\" />\n          </div>\n          <div>\n            <CardTitle className=\"text-2xl font-bold text-gray-900\">\n              Xác thực bảo mật\n            </CardTitle>\n            <CardDescription className=\"text-gray-600 mt-2\">\n              Nhập mã PIN để truy cập hệ thống POS\n            </CardDescription>\n          </div>\n        </CardHeader>\n\n        <CardContent className=\"space-y-6 pt-4\">\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"pin\" className=\"text-sm font-medium text-gray-700\">\n                Mã PIN\n              </Label>\n              <div className=\"relative\">\n                <Input\n                  id=\"pin\"\n                  type={showPin ? \"text\" : \"password\"}\n                  value={pin}\n                  onChange={handlePinChange}\n                  onKeyPress={handleKeyPress}\n                  placeholder=\"Nhập mã PIN (4-6 chữ số)\"\n                  className=\"pr-10 text-center text-lg tracking-widest font-mono\"\n                  maxLength={6}\n                  autoFocus\n                  disabled={isLoading}\n                />\n                <Button\n                  type=\"button\"\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  className=\"absolute right-2 top-1/2 -translate-y-1/2 h-6 w-6 p-0\"\n                  onClick={() => setShowPin(!showPin)}\n                >\n                  {showPin ? (\n                    <EyeOff className=\"w-4 h-4 text-gray-500\" />\n                  ) : (\n                    <Eye className=\"w-4 h-4 text-gray-500\" />\n                  )}\n                </Button>\n              </div>\n            </div>\n\n            <Button\n              type=\"submit\"\n              className=\"w-full bg-green-600 hover:bg-green-700 text-white py-3 text-lg font-semibold\"\n              disabled={isLoading || pin.length < 4}\n            >\n              {isLoading ? (\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin\"></div>\n                  Đang xác thực...\n                </div>\n              ) : (\n                <div className=\"flex items-center gap-2\">\n                  <Lock className=\"w-5 h-5\" />\n                  Đăng nhập\n                </div>\n              )}\n            </Button>\n          </form>\n\n          <div className=\"text-center\">\n            <p className=\"text-xs text-gray-500\">\n              Liên hệ quản trị viên nếu bạn quên mã PIN\n            </p>\n          </div>\n\n          {/* Virtual Keypad for mobile */}\n          <div className=\"grid grid-cols-3 gap-2 mt-6\">\n            {[1, 2, 3, 4, 5, 6, 7, 8, 9].map((num) => (\n              <Button\n                key={num}\n                type=\"button\"\n                variant=\"outline\"\n                className=\"h-12 text-lg font-semibold\"\n                onClick={() => {\n                  if (pin.length < 6) {\n                    setPin(prev => prev + num);\n                  }\n                }}\n                disabled={isLoading || pin.length >= 6}\n              >\n                {num}\n              </Button>\n            ))}\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              className=\"h-12 text-lg font-semibold text-red-600\"\n              onClick={() => setPin(\"\")}\n              disabled={isLoading || pin.length === 0}\n            >\n              Xóa\n            </Button>\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              className=\"h-12 text-lg font-semibold\"\n              onClick={() => {\n                if (pin.length < 6) {\n                  setPin(prev => prev + \"0\");\n                }\n              }}\n              disabled={isLoading || pin.length >= 6}\n            >\n              0\n            </Button>\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              className=\"h-12 text-lg font-semibold text-red-600\"\n              onClick={() => setPin(prev => prev.slice(0, -1))}\n              disabled={isLoading || pin.length === 0}\n            >\n              ←\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":8237},"client/src/components/customers/customer-form-modal.tsx":{"content":"\nimport { useState, useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport type { Customer, InsertCustomer } from \"@shared/schema\";\nimport { z } from \"zod\";\n\nconst customerFormSchema = z.object({\n  customerId: z.string().optional(),\n  name: z.string().min(1, \"이름은 필수입니다\"),\n  phone: z.string().optional(),\n  email: z.string().optional().refine((email) => !email || /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email), {\n    message: \"올바른 이메일 형식이 아닙니다\"\n  }),\n  address: z.string().optional(),\n  dateOfBirth: z.string().optional(),\n  membershipLevel: z.enum([\"Silver\", \"Gold\", \"VIP\"]).optional(),\n  notes: z.string().optional(),\n  status: z.enum([\"active\", \"inactive\"]).optional(),\n});\n\ntype CustomerFormData = z.infer<typeof customerFormSchema>;\n\ninterface CustomerFormModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  customer?: Customer | null;\n}\n\nexport function CustomerFormModal({ isOpen, onClose, customer }: CustomerFormModalProps) {\n  const { toast } = useToast();\n  const { t } = useTranslation();\n  const queryClient = useQueryClient();\n\n  // Generate customer ID for new customers\n  const generateCustomerId = async () => {\n    try {\n      const response = await apiRequest(\"GET\", \"/api/customers/next-id\");\n      const data = await response.json();\n      return data.nextId;\n    } catch (error) {\n      console.error(\"Error generating customer ID:\", error);\n      // Fallback to CUST001 if API fails\n      return \"CUST001\";\n    }\n  };\n\n  const form = useForm<CustomerFormData>({\n    resolver: zodResolver(customerFormSchema),\n    defaultValues: {\n      customerId: customer?.customerId || \"\",\n      name: customer?.name || \"\",\n      phone: customer?.phone || \"\",\n      email: customer?.email || \"\",\n      address: customer?.address || \"\",\n      dateOfBirth: customer?.dateOfBirth || \"\",\n      membershipLevel: customer?.membershipLevel || \"Silver\",\n      notes: customer?.notes || \"\",\n      status: customer?.status || \"active\",\n    },\n  });\n\n  // Reset form when customer changes and auto-generate ID for new customers\n  useEffect(() => {\n    if (customer) {\n      form.reset({\n        customerId: customer.customerId,\n        name: customer.name,\n        phone: customer.phone || \"\",\n        email: customer.email || \"\",\n        address: customer.address || \"\",\n        dateOfBirth: customer.dateOfBirth || \"\",\n        membershipLevel: customer.membershipLevel || \"Silver\",\n        notes: customer.notes || \"\",\n        status: customer.status || \"active\",\n      });\n    } else {\n      // Auto-generate customer ID for new customers\n      generateCustomerId().then((nextId) => {\n        form.reset({\n          customerId: nextId,\n          name: \"\",\n          phone: \"\",\n          email: \"\",\n          address: \"\",\n          dateOfBirth: \"\",\n          membershipLevel: \"Silver\",\n          notes: \"\",\n          status: \"active\",\n        });\n      });\n    }\n  }, [customer, form]);\n\n  const createMutation = useMutation({\n    mutationFn: async (data: CustomerFormData) => {\n      const response = await apiRequest(\"POST\", \"/api/customers\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/customers\"] });\n      toast({\n        title: t('common.success'),\n        description: customer ? \"고객 정보가 업데이트되었습니다.\" : \"새 고객이 추가되었습니다.\",\n      });\n      onClose();\n      form.reset();\n    },\n    onError: (error: any) => {\n      toast({\n        title: t('common.error'),\n        description: error.message || \"고객 정보 저장에 실패했습니다.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: CustomerFormData) => {\n      const response = await apiRequest(\"PUT\", `/api/customers/${customer!.id}`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/customers\"] });\n      toast({\n        title: t('common.success'),\n        description: \"고객 정보가 업데이트되었습니다.\",\n      });\n      onClose();\n      form.reset();\n    },\n    onError: (error: any) => {\n      toast({\n        title: t('common.error'),\n        description: error.message || \"고객 정보 업데이트에 실패했습니다.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: CustomerFormData) => {\n    // Clean up empty strings to null/undefined for optional fields\n    const cleanData = {\n      ...data,\n      phone: data.phone || undefined,\n      email: data.email || undefined,\n      address: data.address || undefined,\n      dateOfBirth: data.dateOfBirth || undefined,\n      notes: data.notes || undefined,\n      customerId: data.customerId || undefined,\n    };\n\n    if (customer) {\n      updateMutation.mutate(cleanData);\n    } else {\n      createMutation.mutate(cleanData);\n    }\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle>{customer ? t('customers.editCustomer') : t('customers.addCustomer')}</DialogTitle>\n          <DialogDescription>\n            {customer ? t('customers.customerFormDesc') : t('customers.customerFormDesc')}\n          </DialogDescription>\n        </DialogHeader>\n\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <FormField\n                control={form.control}\n                name=\"customerId\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t('customers.customerId')}</FormLabel>\n                    <FormControl>\n                      <Input \n                        {...field} \n                        placeholder={customer ? t('customers.customerId') : t('common.autoGenerated')} \n                        disabled={true}\n                        className=\"bg-gray-50\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"name\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t('customers.name')} *</FormLabel>\n                    <FormControl>\n                      <Input {...field} placeholder={t('customers.namePlaceholder')} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <FormField\n                control={form.control}\n                name=\"phone\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t('customers.phone')}</FormLabel>\n                    <FormControl>\n                      <Input {...field} placeholder={t('customers.phonePlaceholder')} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"email\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t('customers.email')}</FormLabel>\n                    <FormControl>\n                      <Input {...field} type=\"email\" placeholder={t('customers.emailPlaceholder')} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n\n            <FormField\n              control={form.control}\n              name=\"address\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>{t('customers.address')}</FormLabel>\n                  <FormControl>\n                    <Textarea {...field} placeholder={t('customers.addressPlaceholder')} rows={2} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <FormField\n                control={form.control}\n                name=\"dateOfBirth\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t('customers.birthday')}</FormLabel>\n                    <FormControl>\n                      <Input {...field} type=\"date\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"membershipLevel\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t('customers.membershipLevel')}</FormLabel>\n                    <Select onValueChange={field.onChange} value={field.value}>\n                      <FormControl>\n                        <SelectTrigger>\n                          <SelectValue placeholder={t('common.select')} />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        <SelectItem value=\"Silver\">Silver</SelectItem>\n                        <SelectItem value=\"Gold\">Gold</SelectItem>\n                        <SelectItem value=\"VIP\">VIP</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n\n            <FormField\n              control={form.control}\n              name=\"status\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>{t('customers.status')}</FormLabel>\n                  <Select onValueChange={field.onChange} defaultValue={field.value}>\n                    <FormControl>\n                      <SelectTrigger>\n                        <SelectValue placeholder={t('common.select')} />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent>\n                      <SelectItem value=\"active\">{t('common.active')}</SelectItem>\n                      <SelectItem value=\"inactive\">{t('common.inactive')}</SelectItem>\n                    </SelectContent>\n                  </Select>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"notes\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>{t('common.notes')}</FormLabel>\n                  <FormControl>\n                    <Textarea {...field} placeholder={t('common.notesPlaceholder')} rows={3} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <div className=\"flex justify-end gap-2\">\n              <Button type=\"button\" variant=\"outline\" onClick={onClose}>\n                {t('common.cancel')}\n              </Button>\n              <Button \n                type=\"submit\" \n                disabled={createMutation.isPending || updateMutation.isPending}\n              >\n                {customer ? t('common.update') : t('common.create')}\n              </Button>\n            </div>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":12460},"client/src/components/customers/customer-points-modal.tsx":{"content":"import { useState } from 'react';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from '@/components/ui/dialog';\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from '@/components/ui/form';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Separator } from '@/components/ui/separator';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { useToast } from '@/hooks/use-toast';\nimport { apiRequest } from '@/lib/queryClient';\nimport { useTranslation } from '@/lib/i18n';\nimport { format } from 'date-fns';\nimport { CreditCard, TrendingUp, TrendingDown, Activity, Clock } from 'lucide-react';\n\nconst pointUpdateSchema = z.object({\n  points: z.number().min(1, 'Points must be at least 1'),\n  description: z.string().min(1, 'Description is required'),\n  type: z.enum(['earned', 'redeemed', 'adjusted']),\n});\n\ntype PointUpdateForm = z.infer<typeof pointUpdateSchema>;\n\ninterface CustomerPointsModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  customerId: number;\n  customerName: string;\n}\n\ninterface PointTransaction {\n  id: number;\n  customerId: number;\n  type: 'earned' | 'redeemed' | 'adjusted' | 'expired';\n  points: number;\n  description: string;\n  orderId?: number;\n  employeeId?: number;\n  previousBalance: number;\n  newBalance: number;\n  createdAt: string;\n}\n\nexport function CustomerPointsModal({\n  open,\n  onOpenChange,\n  customerId,\n  customerName,\n}: CustomerPointsModalProps) {\n  const [activeTab, setActiveTab] = useState<'overview' | 'update' | 'history'>('overview');\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n  const { t } = useTranslation();\n\n  const form = useForm<PointUpdateForm>({\n    resolver: zodResolver(pointUpdateSchema),\n    defaultValues: {\n      points: 0,\n      description: '',\n      type: 'earned',\n    },\n  });\n\n  // Fetch customer points\n  const { data: pointsData, isLoading: pointsLoading } = useQuery({\n    queryKey: ['customer-points', customerId],\n    queryFn: async () => {\n      const response = await fetch(`/api/customers/${customerId}/points`);\n      if (!response.ok) throw new Error('Failed to fetch customer points');\n      return response.json();\n    },\n    enabled: open && !!customerId,\n  });\n\n  // Fetch point history\n  const { data: pointHistory, isLoading: historyLoading } = useQuery({\n    queryKey: ['customer-point-history', customerId],\n    queryFn: async () => {\n      const response = await fetch(`/api/customers/${customerId}/point-history`);\n      if (!response.ok) throw new Error('Failed to fetch point history');\n      return response.json();\n    },\n    enabled: open && !!customerId,\n  });\n\n  // Update points mutation\n  const updatePointsMutation = useMutation({\n    mutationFn: async (data: PointUpdateForm) => {\n      const response = await fetch(`/api/customers/${customerId}/points`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(data),\n      });\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Failed to update points');\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({\n        queryKey: ['customer-points', customerId],\n      });\n      queryClient.invalidateQueries({\n        queryKey: ['customer-point-history', customerId],\n      });\n      queryClient.invalidateQueries({\n        queryKey: ['/api/customers'],\n      });\n      toast({\n        title: t(\"common.success\"),\n        description: t(\"customers.pointsUpdated\"),\n      });\n      form.reset();\n      setActiveTab('overview');\n    },\n    onError: (error: any) => {\n      toast({\n        title: t(\"customers.pointsUpdateFailed\"),\n        description: error.message || t(\"customers.pointsUpdateError\"),\n        variant: 'destructive',\n      });\n    },\n  });\n\n  const onSubmit = (data: PointUpdateForm) => {\n    updatePointsMutation.mutate(data);\n  };\n\n  const getTransactionIcon = (type: string) => {\n    switch (type) {\n      case 'earned':\n        return <TrendingUp className=\"h-4 w-4 text-green-600\" />;\n      case 'redeemed':\n        return <TrendingDown className=\"h-4 w-4 text-red-600\" />;\n      case 'adjusted':\n        return <Activity className=\"h-4 w-4 text-blue-600\" />;\n      default:\n        return <Clock className=\"h-4 w-4 text-gray-600\" />;\n    }\n  };\n\n  const getTransactionColor = (type: string) => {\n    switch (type) {\n      case 'earned':\n        return 'text-green-600';\n      case 'redeemed':\n        return 'text-red-600';\n      case 'adjusted':\n        return 'text-blue-600';\n      default:\n        return 'text-gray-600';\n    }\n  };\n\n  const getTypeLabel = (type: string) => {\n    switch (type) {\n      case 'earned':\n        return t(\"customers.earned\");\n      case 'redeemed':\n        return t(\"customers.redeemed\");\n      case 'adjusted':\n        return t(\"customers.adjusted\");\n      case 'expired':\n        return t(\"customers.expired\");\n      default:\n        return type;\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <CreditCard className=\"h-5 w-5\" />\n            {customerName} - {t(\"customers.pointManagement\")}\n          </DialogTitle>\n          <DialogDescription>\n            {t(\"customers.pointManagementDescription\")}\n          </DialogDescription>\n        </DialogHeader>\n\n        {/* Tab Navigation */}\n        <div className=\"flex border-b\">\n          <button\n            onClick={() => setActiveTab('overview')}\n            className={`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${\n              activeTab === 'overview'\n                ? 'border-green-500 text-green-600'\n                : 'border-transparent text-gray-500 hover:text-gray-700'\n            }`}\n          >\n            {t(\"customers.pointOverview\")}\n          </button>\n          <button\n            onClick={() => setActiveTab('update')}\n            className={`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${\n              activeTab === 'update'\n                ? 'border-green-500 text-green-600'\n                : 'border-transparent text-gray-500 hover:text-gray-700'\n            }`}\n          >\n            {t(\"customers.updatePoints\")}\n          </button>\n          <button\n            onClick={() => setActiveTab('history')}\n            className={`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${\n              activeTab === 'history'\n                ? 'border-green-500 text-green-600'\n                : 'border-transparent text-gray-500 hover:text-gray-700'\n            }`}\n          >\n            {t(\"customers.pointHistory\")}\n          </button>\n        </div>\n\n        <div className=\"mt-6\">\n          {activeTab === 'overview' && (\n            <div className=\"space-y-6\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <CreditCard className=\"h-5 w-5\" />\n                    {t(\"customers.currentPoints\")}\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  {pointsLoading ? (\n                    <div className=\"animate-pulse\">\n                      <div className=\"h-8 bg-gray-200 rounded w-32\"></div>\n                    </div>\n                  ) : (\n                    <div className=\"text-3xl font-bold text-green-600\">\n                      {(pointsData?.points || 0).toLocaleString()} P\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n\n              {/* Recent Transactions Preview */}\n              {pointHistory && pointHistory.length > 0 && (\n                <Card>\n                  <CardHeader>\n                    <CardTitle>{t(\"customers.recentPointHistory\")}</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-3\">\n                      {pointHistory.slice(0, 5).map((transaction: PointTransaction) => (\n                        <div key={transaction.id} className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\n                          <div className=\"flex items-center gap-3\">\n                            {getTransactionIcon(transaction.type)}\n                            <div>\n                              <div className=\"font-medium\">{transaction.description}</div>\n                              <div className=\"text-sm text-gray-500\">\n                                {format(new Date(transaction.createdAt), 'yyyy-MM-dd HH:mm')}\n                              </div>\n                            </div>\n                          </div>\n                          <div className=\"text-right\">\n                            <div className={`font-medium ${getTransactionColor(transaction.type)}`}>\n                              {transaction.points > 0 ? '+' : ''}{transaction.points.toLocaleString()} P\n                            </div>\n                            <div className=\"text-sm text-gray-500\">\n                              {t(\"customers.balance\")}: {transaction.newBalance.toLocaleString()} P\n                            </div>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                    {pointHistory.length > 5 && (\n                      <div className=\"mt-4 text-center\">\n                        <Button\n                          variant=\"outline\"\n                          onClick={() => setActiveTab('history')}\n                        >\n                          {t(\"customers.viewAllHistory\")}\n                        </Button>\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n              )}\n            </div>\n          )}\n\n          {activeTab === 'update' && (\n            <Card>\n              <CardHeader>\n                <CardTitle>{t(\"customers.updatePoints\")}</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <Form {...form}>\n                  <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"type\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t(\"customers.transactionType\")}</FormLabel>\n                          <Select onValueChange={field.onChange} value={field.value}>\n                            <FormControl>\n                              <SelectTrigger>\n                                <SelectValue placeholder={t(\"customers.selectTransactionType\")} />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              <SelectItem value=\"earned\">{t(\"customers.earned\")}</SelectItem>\n                              <SelectItem value=\"redeemed\">{t(\"customers.redeemed\")}</SelectItem>\n                              <SelectItem value=\"adjusted\">{t(\"customers.adjusted\")}</SelectItem>\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"points\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t(\"customers.points\")}</FormLabel>\n                          <FormControl>\n                            <Input\n                              type=\"number\"\n                              placeholder={t(\"customers.enterPoints\")}\n                              {...field}\n                              onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"description\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t(\"customers.reason\")}</FormLabel>\n                          <FormControl>\n                            <Textarea\n                              placeholder={t(\"customers.enterReason\")}\n                              {...field}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <div className=\"flex gap-2 pt-4\">\n                      <Button\n                        type=\"submit\"\n                        disabled={updatePointsMutation.isPending}\n                        className=\"bg-green-600 hover:bg-green-700\"\n                      >\n                        {updatePointsMutation.isPending ? t(\"common.processing\") : t(\"customers.processPoints\")}\n                      </Button>\n                      <Button\n                        type=\"button\"\n                        variant=\"outline\"\n                        onClick={() => form.reset()}\n                      >\n                        {t(\"common.reset\")}\n                      </Button>\n                    </div>\n                  </form>\n                </Form>\n              </CardContent>\n            </Card>\n          )}\n\n          {activeTab === 'history' && (\n            <Card>\n              <CardHeader>\n                <CardTitle>{t(\"customers.pointHistory\")}</CardTitle>\n              </CardHeader>\n              <CardContent>\n                {historyLoading ? (\n                  <div className=\"space-y-3\">\n                    {[...Array(5)].map((_, i) => (\n                      <div key={i} className=\"animate-pulse\">\n                        <div className=\"h-16 bg-gray-200 rounded\"></div>\n                      </div>\n                    ))}\n                  </div>\n                ) : pointHistory && pointHistory.length > 0 ? (\n                  <div className=\"space-y-3\">\n                    {pointHistory.map((transaction: PointTransaction) => (\n                      <div key={transaction.id} className=\"flex items-center justify-between p-4 border rounded-lg\">\n                        <div className=\"flex items-center gap-3\">\n                          {getTransactionIcon(transaction.type)}\n                          <div>\n                            <div className=\"font-medium\">{transaction.description}</div>\n                            <div className=\"text-sm text-gray-500\">\n                              {format(new Date(transaction.createdAt), 'yyyy-MM-dd HH:mm:ss')}\n                            </div>\n                            <Badge variant=\"outline\" className=\"mt-1\">\n                              {getTypeLabel(transaction.type)}\n                            </Badge>\n                          </div>\n                        </div>\n                        <div className=\"text-right\">\n                          <div className={`font-medium ${getTransactionColor(transaction.type)}`}>\n                            {transaction.points > 0 ? '+' : ''}{transaction.points.toLocaleString()} P\n                          </div>\n                          <div className=\"text-sm text-gray-500\">\n                            {t(\"customers.previousBalance\")}: {transaction.previousBalance.toLocaleString()} P\n                          </div>\n                          <div className=\"text-sm font-medium\">\n                            {t(\"customers.balance\")}: {transaction.newBalance.toLocaleString()} P\n                          </div>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                ) : (\n                  <div className=\"text-center py-8 text-gray-500\">\n                    {t(\"customers.noPointHistory\")}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          )}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":16963},"client/src/components/customers/points-management-modal.tsx":{"content":"import { useState } from \"react\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport { type Customer } from \"@shared/schema\";\nimport { \n  CreditCard, \n  Plus, \n  Minus, \n  History, \n  Search,\n  Calculator,\n  Gift,\n  AlertCircle,\n  TrendingUp,\n  TrendingDown,\n  X,\n  Save\n} from \"lucide-react\";\n\ninterface PointsManagementModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\ninterface PointTransaction {\n  id: number;\n  customerId: number;\n  points: number;\n  type: 'earned' | 'redeemed' | 'adjusted' | 'expired';\n  description: string;\n  createdAt: string;\n}\n\nexport function PointsManagementModal({ isOpen, onClose }: PointsManagementModalProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { t } = useTranslation();\n  \n  // State for point operations\n  const [selectedCustomer, setSelectedCustomer] = useState<Customer | null>(null);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [pointsAmount, setPointsAmount] = useState('');\n  const [adjustmentReason, setAdjustmentReason] = useState('');\n  const [operationType, setOperationType] = useState<'add' | 'subtract' | 'set'>('add');\n  const [activeTab, setActiveTab] = useState('management');\n\n  // Fetch customers\n  const { data: customers, isLoading: customersLoading } = useQuery<Customer[]>({\n    queryKey: ['/api/customers'],\n    enabled: isOpen,\n  });\n\n  // Fetch point transactions history\n  const { data: pointTransactions, isLoading: transactionsLoading } = useQuery<PointTransaction[]>({\n    queryKey: ['/api/point-transactions'],\n    enabled: isOpen && activeTab === 'history',\n  });\n\n  // Point adjustment mutation\n  const adjustPointsMutation = useMutation({\n    mutationFn: async ({ customerId, points, type, description }: { \n      customerId: number; \n      points: number; \n      type: string; \n      description: string \n    }) => {\n      const response = await apiRequest('POST', '/api/customers/adjust-points', {\n        customerId,\n        points,\n        type,\n        description\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/customers'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/point-transactions'] });\n      queryClient.invalidateQueries({ queryKey: ['customer-points', selectedCustomer?.id] });\n      toast({\n        title: t(\"customers.customerUpdated\"),\n        description: t(\"customers.pointsManagementDesc\"),\n      });\n      setPointsAmount('');\n      setAdjustmentReason('');\n      setSelectedCustomer(null);\n    },\n    onError: () => {\n      toast({\n        title: t(\"common.error\"),\n        description: t(\"customers.customerError\"),\n        variant: 'destructive',\n      });\n    },\n  });\n\n  // Point payment mutation\n  const processPaymentMutation = useMutation({\n    mutationFn: async ({ customerId, points }: { customerId: number; points: number }) => {\n      const response = await apiRequest('POST', '/api/customers/redeem-points', {\n        customerId,\n        points\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/customers'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/point-transactions'] });\n      queryClient.invalidateQueries({ queryKey: ['customer-points', selectedCustomer?.id] });\n      toast({\n        title: t(\"common.success\"),\n        description: t(\"customers.processPayment\"),\n      });\n      setPointsAmount('');\n      setSelectedCustomer(null);\n    },\n    onError: () => {\n      toast({\n        title: t(\"common.error\"),\n        description: t(\"customers.customerError\"),\n        variant: 'destructive',\n      });\n    },\n  });\n\n  const handlePointsAdjustment = () => {\n    if (!selectedCustomer || !pointsAmount || !adjustmentReason) {\n      toast({\n        title: t(\"common.error\"),\n        description: t(\"customers.customerFormDesc\"),\n        variant: 'destructive',\n      });\n      return;\n    }\n\n    const points = parseInt(pointsAmount);\n    const currentPoints = selectedCustomer.points || 0;\n    \n    let finalPoints = points;\n    let type = 'adjusted';\n    \n    if (operationType === 'add') {\n      finalPoints = points;\n      type = 'earned';\n    } else if (operationType === 'subtract') {\n      finalPoints = -points;\n      type = 'redeemed';\n    } else if (operationType === 'set') {\n      finalPoints = points - currentPoints;\n      type = 'adjusted';\n    }\n\n    adjustPointsMutation.mutate({\n      customerId: selectedCustomer.id,\n      points: finalPoints,\n      type,\n      description: adjustmentReason\n    });\n  };\n\n  const handlePointsPayment = () => {\n    if (!selectedCustomer || !pointsAmount) {\n      toast({\n        title: t(\"common.error\"),\n        description: t(\"customers.customerSelection\"),\n        variant: 'destructive',\n      });\n      return;\n    }\n\n    const points = parseInt(pointsAmount);\n    const currentPoints = selectedCustomer.points || 0;\n    \n    if (points > currentPoints) {\n      toast({\n        title: t(\"customers.insufficientPoints\"),\n        description: t(\"customers.insufficientPoints\"),\n        variant: 'destructive',\n      });\n      return;\n    }\n\n    processPaymentMutation.mutate({\n      customerId: selectedCustomer.id,\n      points\n    });\n  };\n\n  const filteredCustomers = customers?.filter(customer => {\n    const searchLower = searchTerm.toLowerCase();\n    return customer.name?.toLowerCase().includes(searchLower) ||\n           customer.customerId?.toLowerCase().includes(searchLower) ||\n           customer.phone?.toLowerCase().includes(searchLower);\n  }) || [];\n\n  const totalPoints = customers?.reduce((sum, customer) => sum + (customer.points || 0), 0) || 0;\n  const avgPoints = customers?.length ? Math.round(totalPoints / customers.length) : 0;\n\n  if (!isOpen) return null;\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-6xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <CreditCard className=\"w-6 h-6 text-blue-600\" />\n            {t(\"customers.pointsManagementTitle\")}\n          </DialogTitle>\n          <DialogDescription>\n            {t(\"customers.pointsManagementDesc\")}\n          </DialogDescription>\n        </DialogHeader>\n\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"space-y-6\">\n          <TabsList className=\"grid w-full grid-cols-3\">\n            <TabsTrigger value=\"management\">{t(\"customers.pointsAdjustment\")}</TabsTrigger>\n            <TabsTrigger value=\"payment\">{t(\"customers.pointsPayment\")}</TabsTrigger>\n            <TabsTrigger value=\"history\">{t(\"customers.history\")}</TabsTrigger>\n          </TabsList>\n\n          {/* Points Statistics */}\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm font-medium text-gray-600\">{t(\"customers.totalPoints\")}</p>\n                    <p className=\"text-2xl font-bold text-blue-600\">{totalPoints.toLocaleString()}P</p>\n                  </div>\n                  <CreditCard className=\"w-8 h-8 text-blue-600\" />\n                </div>\n              </CardContent>\n            </Card>\n            \n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm font-medium text-gray-600\">{t(\"customers.averagePoints\")}</p>\n                    <p className=\"text-2xl font-bold text-green-600\">{avgPoints.toLocaleString()}P</p>\n                  </div>\n                  <Calculator className=\"w-8 h-8 text-green-600\" />\n                </div>\n              </CardContent>\n            </Card>\n            \n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm font-medium text-gray-600\">{t(\"customers.total\")} {t(\"customers.customers\")}</p>\n                    <p className=\"text-2xl font-bold text-purple-600\">{customers?.length || 0}{t(\"customers.customers\")}</p>\n                  </div>\n                  <Gift className=\"w-8 h-8 text-purple-600\" />\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          <TabsContent value=\"management\" className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Calculator className=\"w-5 h-5 text-blue-600\" />\n                  {t(\"customers.pointsEditTitle\")}\n                </CardTitle>\n                <CardDescription>{t(\"customers.pointsEditDesc\")}</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                  {/* Customer Selection */}\n                  <div className=\"space-y-4\">\n                    <Label>{t(\"customers.customerSelection\")}</Label>\n                    <div className=\"space-y-2\">\n                      <Input\n                        placeholder={t(\"customers.searchCustomers\")}\n                        value={searchTerm}\n                        onChange={(e) => setSearchTerm(e.target.value)}\n                      />\n                      <div className=\"max-h-64 overflow-y-auto border rounded-md\">\n                        {filteredCustomers.map((customer) => (\n                          <div\n                            key={customer.id}\n                            className={`p-3 cursor-pointer hover:bg-gray-50 border-b ${\n                              selectedCustomer?.id === customer.id ? 'bg-blue-50 border-blue-200' : ''\n                            }`}\n                            onClick={() => setSelectedCustomer(customer)}\n                          >\n                            <div className=\"flex justify-between items-center\">\n                              <div>\n                                <p className=\"font-medium\">{customer.name}</p>\n                                <p className=\"text-sm text-gray-500\">{customer.customerId}</p>\n                              </div>\n                              <Badge variant=\"outline\">\n                                {(customer.points || 0).toLocaleString()}P\n                              </Badge>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Point Adjustment */}\n                  <div className=\"space-y-4\">\n                    <Label>{t(\"customers.pointsAdjustment\")}</Label>\n                    {selectedCustomer && (\n                      <div className=\"p-4 bg-blue-50 rounded-lg\">\n                        <p className=\"font-medium\">{selectedCustomer.name}</p>\n                        <p className=\"text-sm text-gray-600\">{t(\"customers.currentPoints\")}: {(selectedCustomer.points || 0).toLocaleString()}P</p>\n                      </div>\n                    )}\n                    \n                    <div className=\"space-y-3\">\n                      <div>\n                        <Label>{t(\"customers.adjustmentType\")}</Label>\n                        <Select value={operationType} onValueChange={(value: 'add' | 'subtract' | 'set') => setOperationType(value)}>\n                          <SelectTrigger>\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"add\">{t(\"customers.addPoints\")}</SelectItem>\n                            <SelectItem value=\"subtract\">{t(\"customers.subtractPoints\")}</SelectItem>\n                            <SelectItem value=\"set\">{t(\"customers.setPoints\")}</SelectItem>\n                          </SelectContent>\n                        </Select>\n                      </div>\n\n                      <div>\n                        <Label>\n                          {operationType === 'add' ? t(\"customers.pointsToAdd\") : \n                           operationType === 'subtract' ? t(\"customers.pointsToSubtract\") : \n                           t(\"customers.pointsToSet\")}\n                        </Label>\n                        <Input\n                          type=\"number\"\n                          placeholder={t(\"customers.pointsToUsePlaceholder\")}\n                          value={pointsAmount}\n                          onChange={(e) => setPointsAmount(e.target.value)}\n                        />\n                      </div>\n\n                      <div>\n                        <Label>{t(\"customers.adjustmentReason\")}</Label>\n                        <Textarea\n                          placeholder={t(\"customers.adjustmentReasonPlaceholder\")}\n                          value={adjustmentReason}\n                          onChange={(e) => setAdjustmentReason(e.target.value)}\n                        />\n                      </div>\n\n                      <Button \n                        onClick={handlePointsAdjustment}\n                        className=\"w-full\"\n                        disabled={!selectedCustomer || !pointsAmount || !adjustmentReason || adjustPointsMutation.isPending}\n                      >\n                        {adjustPointsMutation.isPending ? t(\"customers.processing\") : \n                         operationType === 'add' ? <Plus className=\"w-4 h-4 mr-2\" /> : \n                         operationType === 'subtract' ? <Minus className=\"w-4 h-4 mr-2\" /> : \n                         <Calculator className=\"w-4 h-4 mr-2\" />}\n                        {operationType === 'add' ? t(\"customers.addPoints\") : \n                         operationType === 'subtract' ? t(\"customers.subtractPoints\") : \n                         t(\"customers.setPoints\")}\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"payment\" className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <CreditCard className=\"w-5 h-5 text-green-600\" />\n                  {t(\"customers.pointsPaymentTitle\")}\n                </CardTitle>\n                <CardDescription>{t(\"customers.pointsPaymentDesc\")}</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                  {/* Customer Selection for Payment */}\n                  <div className=\"space-y-4\">\n                    <Label>{t(\"customers.paymentCustomerSelection\")}</Label>\n                    <div className=\"space-y-2\">\n                      <Input\n                        placeholder={t(\"customers.searchCustomers\")}\n                        value={searchTerm}\n                        onChange={(e) => setSearchTerm(e.target.value)}\n                      />\n                      <div className=\"max-h-64 overflow-y-auto border rounded-md\">\n                        {filteredCustomers.map((customer) => (\n                          <div\n                            key={customer.id}\n                            className={`p-3 cursor-pointer hover:bg-gray-50 border-b ${\n                              selectedCustomer?.id === customer.id ? 'bg-green-50 border-green-200' : ''\n                            }`}\n                            onClick={() => setSelectedCustomer(customer)}\n                          >\n                            <div className=\"flex justify-between items-center\">\n                              <div>\n                                <p className=\"font-medium\">{customer.name}</p>\n                                <p className=\"text-sm text-gray-500\">{customer.customerId}</p>\n                              </div>\n                              <Badge variant=\"outline\" className={\n                                (customer.points || 0) >= 1000 ? 'bg-green-100 text-green-800' : \n                                (customer.points || 0) >= 500 ? 'bg-yellow-100 text-yellow-800' : \n                                'bg-gray-100 text-gray-800'\n                              }>\n                                {(customer.points || 0).toLocaleString()}P\n                              </Badge>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Payment Processing */}\n                  <div className=\"space-y-4\">\n                    <Label>{t(\"customers.pointsPayment\")}</Label>\n                    {selectedCustomer && (\n                      <div className=\"p-4 bg-green-50 rounded-lg\">\n                        <p className=\"font-medium\">{selectedCustomer.name}</p>\n                        <p className=\"text-sm text-gray-600\">{t(\"customers.availablePoints\")}: {(selectedCustomer.points || 0).toLocaleString()}P</p>\n                      </div>\n                    )}\n                    \n                    <div className=\"space-y-3\">\n                      <div>\n                        <Label>{t(\"customers.pointsToUse\")}</Label>\n                        <Input\n                          type=\"number\"\n                          placeholder={t(\"customers.pointsToUsePlaceholder\")}\n                          value={pointsAmount}\n                          onChange={(e) => setPointsAmount(e.target.value)}\n                        />\n                        {selectedCustomer && pointsAmount && parseInt(pointsAmount) > (selectedCustomer.points || 0) && (\n                          <p className=\"text-sm text-red-600 flex items-center gap-1 mt-1\">\n                            <AlertCircle className=\"w-4 h-4\" />\n                            {t(\"customers.insufficientPoints\")}\n                          </p>\n                        )}\n                      </div>\n\n                      {pointsAmount && selectedCustomer && (\n                        <div className=\"p-3 bg-gray-50 rounded-lg\">\n                          <div className=\"flex justify-between text-sm\">\n                            <span>{t(\"customers.pointsAfterPayment\")}:</span>\n                            <span className=\"font-medium\">\n                              {Math.max(0, (selectedCustomer.points || 0) - parseInt(pointsAmount || '0')).toLocaleString()}P\n                            </span>\n                          </div>\n                        </div>\n                      )}\n\n                      <Button \n                        onClick={handlePointsPayment}\n                        className=\"w-full bg-green-600 hover:bg-green-700\"\n                        disabled={!selectedCustomer || !pointsAmount || parseInt(pointsAmount || '0') > (selectedCustomer?.points || 0) || processPaymentMutation.isPending}\n                      >\n                        {processPaymentMutation.isPending ? t(\"customers.processing\") : \n                         <>\n                           <CreditCard className=\"w-4 h-4 mr-2\" />\n                           {t(\"customers.processPayment\")}\n                         </>}\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"history\" className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <History className=\"w-5 h-5 text-purple-600\" />\n                  {t(\"customers.historyTitle\")}\n                </CardTitle>\n                <CardDescription>{t(\"customers.historyDesc\")}</CardDescription>\n              </CardHeader>\n              <CardContent>\n                {transactionsLoading ? (\n                  <div className=\"text-center py-8\">\n                    <p className=\"text-gray-500\">{t(\"customers.loadingHistory\")}</p>\n                  </div>\n                ) : !pointTransactions || pointTransactions.length === 0 ? (\n                  <div className=\"text-center py-8\">\n                    <History className=\"w-12 h-12 mx-auto text-gray-400 mb-4\" />\n                    <p className=\"text-gray-500\">{t(\"customers.noHistory\")}</p>\n                  </div>\n                ) : (\n                  <div className=\"space-y-3\">\n                    {pointTransactions.map((transaction) => {\n                      const customer = customers?.find(c => c.id === transaction.customerId);\n                      return (\n                        <div key={transaction.id} className=\"flex items-center justify-between p-4 border rounded-lg\">\n                          <div className=\"flex items-center gap-3\">\n                            <div className={`w-10 h-10 rounded-full flex items-center justify-center ${\n                              transaction.type === 'earned' ? 'bg-green-100' :\n                              transaction.type === 'redeemed' ? 'bg-red-100' :\n                              transaction.type === 'adjusted' ? 'bg-blue-100' :\n                              'bg-gray-100'\n                            }`}>\n                              {transaction.type === 'earned' ? <TrendingUp className=\"w-5 h-5 text-green-600\" /> :\n                               transaction.type === 'redeemed' ? <TrendingDown className=\"w-5 h-5 text-red-600\" /> :\n                               transaction.type === 'adjusted' ? <Calculator className=\"w-5 h-5 text-blue-600\" /> :\n                               <AlertCircle className=\"w-5 h-5 text-gray-600\" />}\n                            </div>\n                            <div>\n                              <p className=\"font-medium\">{customer?.name || t(\"customers.unknown\")}</p>\n                              <p className=\"text-sm text-gray-600\">{transaction.description}</p>\n                              <p className=\"text-xs text-gray-400\">\n                                {new Date(transaction.createdAt).toLocaleDateString('ko-KR', {\n                                  year: 'numeric',\n                                  month: 'short',\n                                  day: 'numeric',\n                                  hour: '2-digit',\n                                  minute: '2-digit'\n                                })}\n                              </p>\n                            </div>\n                          </div>\n                          <div className=\"text-right\">\n                            <p className={`font-medium ${\n                              transaction.points > 0 ? 'text-green-600' : 'text-red-600'\n                            }`}>\n                              {transaction.points > 0 ? '+' : ''}{transaction.points.toLocaleString()}P\n                            </p>\n                            <Badge variant=\"outline\" className=\"mt-1\">\n                              {transaction.type === 'earned' ? t(\"customers.earned\") :\n                               transaction.type === 'redeemed' ? t(\"customers.redeemed\") :\n                               transaction.type === 'adjusted' ? t(\"customers.adjusted\") :\n                               t(\"customers.expired\")}\n                            </Badge>\n                          </div>\n                        </div>\n                      );\n                    })}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":24572},"client/src/components/employees/employee-form-modal.tsx":{"content":"import React from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport {\n  insertEmployeeSchema,\n  type Employee,\n  type InsertEmployee,\n} from \"@shared/schema\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport { z } from \"zod\";\n\ninterface EmployeeFormModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  mode: \"create\" | \"edit\";\n  employee?: Employee;\n}\n\nexport function EmployeeFormModal({\n  isOpen,\n  onClose,\n  mode,\n  employee,\n}: EmployeeFormModalProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { t } = useTranslation();\n\n  // Create translated validation schema\n  const translatedEmployeeSchema = z.object({\n    employeeId: z.string().min(1, t(\"employees.employeeIdRequired\")),\n    name: z.string().min(1, t(\"employees.nameRequired\")),\n    email: z.string().email(t(\"employees.emailInvalid\")).optional().or(z.literal(\"\")),\n    phone: z.string().nullable(),\n    role: z.enum([\"admin\", \"manager\", \"cashier\", \"kitchen\", \"server\"]),\n    isActive: z.boolean(),\n    hireDate: z.date(),\n  });\n\n  // Generate employee ID for new employees\n  const generateEmployeeId = async () => {\n    try {\n      const response = await apiRequest(\"GET\", \"/api/employees/next-id\");\n      const data = await response.json();\n      return data.nextId;\n    } catch (error) {\n      console.error(\"Error generating employee ID:\", error);\n      // Fallback to EMP-001 if API fails\n      return \"EMP-001\";\n    }\n  };\n\n  const form = useForm<InsertEmployee>({\n    resolver: zodResolver(translatedEmployeeSchema),\n    defaultValues: {\n      employeeId: \"\",\n      name: \"\",\n      email: \"\",\n      phone: null,\n      role: \"cashier\",\n      isActive: true,\n      hireDate: new Date(),\n    },\n  });\n\n  // Set employee ID for new employees or populate form for edit\n  React.useEffect(() => {\n    if (mode === \"create\" && !employee?.employeeId) {\n      generateEmployeeId().then((nextId) => {\n        form.reset({\n          employeeId: nextId,\n          name: \"\",\n          email: \"\",\n          phone: null,\n          role: \"cashier\",\n          isActive: true,\n          hireDate: new Date(),\n        });\n      });\n    } else if (mode === \"edit\" && employee) {\n      form.reset({\n        employeeId: employee.employeeId,\n        name: employee.name,\n        email: employee.email || \"\",\n        phone: employee.phone || null,\n        role: employee.role,\n        isActive: employee.isActive ?? true,\n        hireDate: employee.hireDate ? new Date(employee.hireDate) : new Date(),\n      });\n    }\n  }, [mode, employee, form]);\n\n  const createMutation = useMutation({\n    mutationFn: async (data: InsertEmployee) => {\n      const response = await apiRequest(\"POST\", \"/api/employees\", data);\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw errorData;\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/employees\"] });\n      toast({\n        title: t(\"common.success\"),\n        description: t(\"employees.addEmployeeSuccess\"),\n      });\n      onClose();\n      generateEmployeeId().then((nextId) => {\n        form.reset({\n          employeeId: nextId,\n          name: \"\",\n          email: \"\",\n          phone: null,\n          role: \"cashier\",\n          isActive: true,\n          hireDate: new Date(),\n        });\n      });\n    },\n    onError: (error: any) => {\n      let errorMessage = t(\"employees.addEmployeeError\");\n      // Checking for the error in the expected format\n      if (error instanceof Error && error.message) {\n        const errorData = JSON.parse(\n          error.message.slice(error.message.indexOf(\"{\")),\n        ); // Extract JSON part of the message\n        if (errorData.code === \"DUPLICATE_EMAIL\") {\n          errorMessage = t(\"employees.emailAlreadyExists\");\n          // Set error on the email field\n          form.setError(\"email\", {\n            type: \"manual\",\n            message: t(\"employees.emailAlreadyInSystem\"),\n          });\n        }\n      }\n      toast({\n        title: t(\"common.error\"),\n        description: errorMessage,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: InsertEmployee) => {\n      const response = await apiRequest(\n        \"PUT\",\n        `/api/employees/${employee?.id}`,\n        data,\n      );\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw errorData;\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/employees\"] });\n      toast({\n        title: t(\"common.success\"),\n        description: t(\"employees.updateEmployeeSuccess\"),\n      });\n      onClose();\n    },\n    onError: (error: any) => {\n      let errorMessage = t(\"employees.updateEmployeeError\");\n\n      // Parse error similar to createMutation\n      if (error && typeof error === 'object' && error.code === \"DUPLICATE_EMAIL\") {\n        errorMessage = t(\"employees.emailAlreadyExists\");\n        form.setError(\"email\", {\n          type: \"manual\",\n          message: t(\"employees.emailAlreadyInSystem\"),\n        });\n      }\n\n      toast({\n        title: t(\"common.error\"),\n        description: errorMessage,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: InsertEmployee) => {\n    if (mode === \"create\") {\n      createMutation.mutate(data);\n    } else {\n      updateMutation.mutate(data);\n    }\n  };\n\n  const isLoading = createMutation.isPending || updateMutation.isPending;\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"sm:max-w-[500px]\">\n        <DialogHeader>\n          <DialogTitle>\n            {mode === \"create\"\n              ? t(\"employees.addEmployee\")\n              : t(\"employees.editEmployee\")}\n          </DialogTitle>\n          <DialogDescription>\n            {mode === \"create\"\n              ? t(\"employees.employeeFormDesc\")\n              : t(\"employees.employeeFormDesc\")}\n          </DialogDescription>\n        </DialogHeader>\n\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n            <FormField\n              control={form.control}\n              name=\"employeeId\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>{t(\"employees.employeeId\")}</FormLabel>\n                  <FormControl>\n                    <Input\n                      placeholder=\"EMP001\"\n                      {...field}\n                      readOnly={true}\n                      className=\"bg-gray-100\"\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"name\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>\n                    {t(\"employees.name\")}{\" \"}\n                    <span className=\"text-red-500\">*</span>\n                  </FormLabel>\n                  <FormControl>\n                    <Input\n                      placeholder={t(\"employees.namePlaceholder\")}\n                      {...field}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"email\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>{t(\"employees.email\")}</FormLabel>\n                  <FormControl>\n                    <Input\n                      type=\"email\"\n                      placeholder=\"hong@company.com\"\n                      {...field}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"phone\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>{t(\"employees.phone\")}</FormLabel>\n                  <FormControl>\n                    <Input\n                      placeholder=\"010-1234-5678\"\n                      value={field.value || \"\"}\n                      onChange={field.onChange}\n                      onBlur={field.onBlur}\n                      name={field.name}\n                      ref={field.ref}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"role\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>{t(\"employees.role\")}</FormLabel>\n                  <Select\n                    onValueChange={field.onChange}\n                    defaultValue={field.value}\n                  >\n                    <FormControl>\n                      <SelectTrigger>\n                        <SelectValue placeholder={t(\"employees.selectRole\")} />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent>\n                      <SelectItem value=\"cashier\">\n                        {t(\"employees.roles.cashier\")}\n                      </SelectItem>\n                      <SelectItem value=\"manager\">\n                        {t(\"employees.roles.manager\")}\n                      </SelectItem>\n                      <SelectItem value=\"admin\">\n                        {t(\"employees.roles.admin\")}\n                      </SelectItem>\n                    </SelectContent>\n                  </Select>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <div className=\"flex justify-end gap-2 pt-4\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={onClose}\n                disabled={isLoading}\n              >\n                {t(\"common.cancel\")}\n              </Button>\n              <Button type=\"submit\" disabled={isLoading}>\n                {isLoading\n                  ? t(\"employees.saving\")\n                  : mode === \"create\"\n                    ? t(\"employees.add\")\n                    : t(\"employees.save\")}\n              </Button>\n            </div>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":11160},"client/src/components/employees/employee-list.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Edit, Trash2, User, Mail, Phone, Calendar } from \"lucide-react\";\nimport { EmployeeFormModal } from \"./employee-form-modal\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport type { Employee } from \"@shared/schema\";\n\nexport function EmployeeList() {\n  const [selectedEmployee, setSelectedEmployee] = useState<Employee | null>(null);\n  const [showEditModal, setShowEditModal] = useState(false);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { t } = useTranslation();\n\n  const { data: employeesData, isLoading } = useQuery<Employee[]>({\n    queryKey: ['/api/employees'],\n  });\n\n  // Sort employees by ID descending (newest first)\n  const employees = employeesData?.sort((a, b) => b.id - a.id);\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      const response = await apiRequest('DELETE', `/api/employees/${id}`);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/employees'] });\n      toast({\n        title: t('common.success'),\n        description: t('employees.deleteSuccess'),\n      });\n    },\n    onError: () => {\n      toast({\n        title: t('common.error'),\n        description: t('employees.deleteError'),\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleEdit = (employee: Employee) => {\n    setSelectedEmployee(employee);\n    setShowEditModal(true);\n  };\n\n  const handleDelete = (employee: Employee) => {\n    if (confirm(t('employees.confirmDelete').replace('{{name}}', employee.name))) {\n      deleteMutation.mutate(employee.id);\n    }\n  };\n\n  const getRoleBadge = (role: string) => {\n    const roleConfig = {\n      admin: { variant: \"destructive\" as const },\n      manager: { variant: \"default\" as const },\n      cashier: { variant: \"secondary\" as const },\n    };\n    \n    const config = roleConfig[role as keyof typeof roleConfig] || { variant: \"outline\" as const };\n    const label = t(`employees.roles.${role}` as any) || role;\n    return <Badge variant={config.variant}>{label}</Badge>;\n  };\n\n  const formatDate = (date: string | Date) => {\n    return new Date(date).toLocaleDateString('ko-KR');\n  };\n\n  if (isLoading) {\n    return (\n      <Card>\n        <CardContent className=\"p-6\">\n          <div className=\"flex justify-center\">\n            <div className=\"text-gray-500\">{t('common.loading')}</div>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <>\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <User className=\"w-5 h-5\" />\n            {t('employees.employeeList')}\n          </CardTitle>\n          <CardDescription>\n            {t('employees.currentEmployeeCount').replace('{{count}}', String(employees?.length || 0))}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          {!employees || employees.length === 0 ? (\n            <div className=\"text-center py-8\">\n              <User className=\"w-12 h-12 mx-auto text-gray-400 mb-4\" />\n              <p className=\"text-gray-500\">{t('employees.noEmployeesFound')}</p>\n              <p className=\"text-sm text-gray-400 mt-2\">{t('employees.addEmployeeHint')}</p>\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table className=\"min-w-[1200px]\">\n                <TableHeader>\n                  <TableRow>\n                    <TableHead className=\"min-w-[120px]\">{t('employees.employeeId')}</TableHead>\n                    <TableHead className=\"min-w-[150px]\">{t('employees.name')}</TableHead>\n                    <TableHead className=\"min-w-[200px]\">{t('employees.email')}</TableHead>\n                    <TableHead className=\"min-w-[150px]\">{t('employees.phone')}</TableHead>\n                    <TableHead className=\"min-w-[160px]\">{t('employees.role')}</TableHead>\n                    <TableHead className=\"min-w-[130px]\">{t('employees.hireDate')}</TableHead>\n                    <TableHead className=\"min-w-[140px]\">{t('employees.status')}</TableHead>\n                    <TableHead className=\"min-w-[150px]\">{t('employees.employeeManagement')}</TableHead>\n                  </TableRow>\n                </TableHeader>\n              <TableBody>\n                {employees.map((employee: Employee) => (\n                  <TableRow key={employee.id}>\n                    <TableCell className=\"font-medium\">{employee.employeeId}</TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-2\">\n                        <User className=\"w-4 h-4 text-gray-400\" />\n                        {employee.name}\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-2\">\n                        <Mail className=\"w-4 h-4 text-gray-400\" />\n                        {employee.email}\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      {employee.phone ? (\n                        <div className=\"flex items-center gap-2\">\n                          <Phone className=\"w-4 h-4 text-gray-400\" />\n                          {employee.phone}\n                        </div>\n                      ) : (\n                        <span className=\"text-gray-400\">-</span>\n                      )}\n                    </TableCell>\n                    <TableCell>{getRoleBadge(employee.role)}</TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-2\">\n                        <Calendar className=\"w-4 h-4 text-gray-400\" />\n                        {formatDate(employee.hireDate)}\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      <Badge variant={employee.isActive ? \"default\" : \"secondary\"}>\n                        {employee.isActive ? t('employees.active') : t('employees.inactive')}\n                      </Badge>\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex gap-2\">\n                        <Button \n                          variant=\"outline\" \n                          size=\"sm\"\n                          onClick={() => handleEdit(employee)}\n                        >\n                          <Edit className=\"w-4 h-4\" />\n                        </Button>\n                        <Button \n                          variant=\"outline\" \n                          size=\"sm\"\n                          onClick={() => handleDelete(employee)}\n                          disabled={deleteMutation.isPending}\n                        >\n                          <Trash2 className=\"w-4 h-4\" />\n                        </Button>\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Edit Employee Modal */}\n      {selectedEmployee && (\n        <EmployeeFormModal\n          isOpen={showEditModal}\n          onClose={() => {\n            setShowEditModal(false);\n            setSelectedEmployee(null);\n          }}\n          mode=\"edit\"\n          employee={selectedEmployee}\n        />\n      )}\n    </>\n  );\n}","size_bytes":7838},"client/src/components/membership/membership-modal.tsx":{"content":"import { useState } from \"react\";\nimport * as React from \"react\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport { type Customer } from \"@shared/schema\";\nimport { \n  Crown, \n  Medal, \n  Award, \n  Users, \n  TrendingUp, \n  Gift,\n  Star,\n  Search,\n  Save,\n  X\n} from \"lucide-react\";\n\ninterface MembershipModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nexport function MembershipModal({ isOpen, onClose }: MembershipModalProps) {\n  const { toast } = useToast();\n  const { t } = useTranslation();\n  const queryClient = useQueryClient();\n  const [selectedTier, setSelectedTier] = useState<string>('');\n  const [searchTerm, setSearchTerm] = useState('');\n  const [isEditingThresholds, setIsEditingThresholds] = useState(false);\n  const [thresholds, setThresholds] = useState({\n    GOLD: 300000,\n    VIP: 1000000\n  });\n\n  // Fetch customers\n  const { data: customers, isLoading } = useQuery<Customer[]>({\n    queryKey: ['/api/customers'],\n    enabled: isOpen,\n  });\n\n  // Fetch membership thresholds\n  const { data: fetchedThresholds } = useQuery<{ GOLD: number; VIP: number }>({\n    queryKey: ['/api/membership-thresholds'],\n    enabled: isOpen,\n  });\n\n  // Update thresholds when data is fetched\n  React.useEffect(() => {\n    if (fetchedThresholds) {\n      setThresholds(fetchedThresholds);\n    }\n  }, [fetchedThresholds]);\n\n  const membershipTiers = [\n    {\n      level: 'SILVER',\n      name: t(\"customers.silver\"),\n      icon: Medal,\n      color: 'bg-gray-100 text-gray-800 border-gray-200',\n      benefits: [t(\"customers.basicPointsEarning\"), t(\"customers.birthdayDiscount5\")],\n      minSpent: 0,\n      description: t(\"customers.basicLevelDesc\")\n    },\n    {\n      level: 'GOLD', \n      name: t(\"customers.gold\"),\n      icon: Award,\n      color: 'bg-yellow-100 text-yellow-800 border-yellow-200',\n      benefits: [t(\"customers.pointsEarning15\"), t(\"customers.birthdayDiscount10\"), t(\"customers.freeDrinkMonthly\")],\n      minSpent: thresholds.GOLD,\n      description: t(\"customers.premiumLevelDesc\")\n    },\n    {\n      level: 'VIP',\n      name: t(\"customers.vip\"),\n      icon: Crown,\n      color: 'bg-purple-100 text-purple-800 border-purple-200',\n      benefits: [t(\"customers.pointsEarning2x\"), t(\"customers.birthdayDiscount20\"), t(\"customers.freeDrink2Monthly\"), t(\"customers.vipRoomAccess\")],\n      minSpent: thresholds.VIP,\n      description: t(\"customers.vipLevelDesc\")\n    }\n  ];\n\n  // Update customer membership\n  const updateMembershipMutation = useMutation({\n    mutationFn: async ({ customerId, membershipLevel }: { customerId: number; membershipLevel: string }) => {\n      const response = await fetch(`/api/customers/${customerId}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ membershipLevel }),\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/customers'] });\n      toast({\n        title: t(\"common.success\"),\n        description: t(\"customers.customerUpdated\"),\n      });\n    },\n    onError: () => {\n      toast({\n        title: t(\"common.error\"),\n        description: t(\"customers.customerError\"),\n        variant: 'destructive',\n      });\n    },\n  });\n\n  // Update membership thresholds\n  const updateThresholdsMutation = useMutation({\n    mutationFn: async (newThresholds: { GOLD: number; VIP: number }) => {\n      const response = await fetch('/api/membership-thresholds', {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(newThresholds),\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/membership-thresholds'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/customers'] });\n      toast({\n        title: t(\"common.success\"),\n        description: \"Đã cập nhật mức chi tiêu nâng hạng\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: t(\"common.error\"),\n        description: \"Không thể cập nhật mức chi tiêu\",\n        variant: 'destructive',\n      });\n    },\n  });\n\n  const handleUpdateMembership = (customerId: number, newLevel: string) => {\n    updateMembershipMutation.mutate({ customerId, membershipLevel: newLevel });\n  };\n\n  const autoUpgradeBasedOnSpending = (customerId: number, totalSpent: number) => {\n    let newLevel = 'SILVER';\n    if (totalSpent >= thresholds.VIP) newLevel = 'VIP';\n    else if (totalSpent >= thresholds.GOLD) newLevel = 'GOLD';\n    \n    handleUpdateMembership(customerId, newLevel);\n  };\n\n  const saveThresholds = () => {\n    updateThresholdsMutation.mutate(thresholds);\n    setIsEditingThresholds(false);\n  };\n\n  const autoUpgradeAllCustomers = () => {\n    customers?.forEach(customer => {\n      const totalSpent = parseFloat(customer.totalSpent || '0');\n      const currentLevel = customer.membershipLevel || 'SILVER';\n      let suggestedLevel = 'SILVER';\n      \n      if (totalSpent >= thresholds.VIP) suggestedLevel = 'VIP';\n      else if (totalSpent >= thresholds.GOLD) suggestedLevel = 'GOLD';\n      \n      if (currentLevel !== suggestedLevel) {\n        autoUpgradeBasedOnSpending(customer.id, totalSpent);\n      }\n    });\n  };\n\n  const filteredCustomers = customers?.filter(customer => {\n    const matchesSearch = customer.name?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n                         customer.customerId?.toLowerCase().includes(searchTerm.toLowerCase());\n    const matchesTier = !selectedTier || selectedTier === 'all' || customer.membershipLevel?.toLowerCase().includes(selectedTier.toLowerCase());\n    return matchesSearch && matchesTier;\n  }) || [];\n\n  const membershipStats = customers?.reduce((acc, customer) => {\n    const level = customer.membershipLevel || 'SILVER';\n    acc[level] = (acc[level] || 0) + 1;\n    return acc;\n  }, {} as Record<string, number>) || {};\n\n  if (!isOpen) return null;\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-6xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Crown className=\"w-6 h-6 text-purple-600\" />\n            {t(\"customers.membershipManagementTitle\")}\n          </DialogTitle>\n          <DialogDescription>\n            {t(\"customers.membershipManagementDesc\")}\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-6\">\n          {/* Membership Tiers Overview */}\n          <div>\n            <h3 className=\"text-lg font-semibold mb-4 flex items-center gap-2\">\n              <Star className=\"w-5 h-5 text-yellow-500\" />\n              {t(\"customers.membershipTierGuide\")}\n            </h3>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n              {membershipTiers.map((tier) => {\n                const IconComponent = tier.icon;\n                const count = membershipStats[tier.level] || 0;\n                \n                return (\n                  <Card key={tier.level} className={`border-2 ${tier.color.includes('gray') ? 'border-gray-200' : tier.color.includes('yellow') ? 'border-yellow-200' : 'border-purple-200'}`}>\n                    <CardHeader className=\"pb-3\">\n                      <CardTitle className=\"flex items-center gap-2 text-lg\">\n                        <IconComponent className=\"w-5 h-5\" />\n                        {tier.name}\n                        <Badge variant=\"outline\" className=\"ml-auto\">\n                          {count}명\n                        </Badge>\n                      </CardTitle>\n                      <CardDescription>{tier.description}</CardDescription>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"space-y-2\">\n                        <div className=\"text-sm font-medium flex items-center gap-2\">\n                          {t(\"customers.minPurchaseAmount\")}: \n                          {isEditingThresholds && tier.level !== 'SILVER' ? (\n                            <Input\n                              type=\"number\"\n                              value={thresholds[tier.level as keyof typeof thresholds]}\n                              onChange={(e) => setThresholds(prev => ({\n                                ...prev,\n                                [tier.level]: parseInt(e.target.value) || 0\n                              }))}\n                              className=\"w-32 h-6 text-xs\"\n                            />\n                          ) : (\n                            <span>₩{tier.minSpent.toLocaleString()}</span>\n                          )}\n                        </div>\n                        <div className=\"space-y-1\">\n                          <div className=\"text-sm font-medium\">{t(\"customers.membershipBenefits\")}:</div>\n                          {tier.benefits.map((benefit, index) => (\n                            <div key={index} className=\"text-xs text-gray-600 flex items-center gap-1\">\n                              <Gift className=\"w-3 h-3\" />\n                              {benefit}\n                            </div>\n                          ))}\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                );\n              })}\n            </div>\n          </div>\n\n          {/* Customer Management */}\n          <div>\n            <div className=\"flex items-center justify-between mb-4\">\n              <h3 className=\"text-lg font-semibold flex items-center gap-2\">\n                <Users className=\"w-5 h-5 text-blue-500\" />\n                {t(\"customers.customerMembershipManagement\")}\n              </h3>\n              <div className=\"flex gap-2\">\n                {isEditingThresholds ? (\n                  <>\n                    <Button\n                      onClick={saveThresholds}\n                      size=\"sm\"\n                      className=\"bg-green-600 hover:bg-green-700\"\n                    >\n                      <Save className=\"w-4 h-4 mr-2\" />\n                      Lưu mức chi tiêu\n                    </Button>\n                    <Button\n                      onClick={() => setIsEditingThresholds(false)}\n                      variant=\"outline\"\n                      size=\"sm\"\n                    >\n                      <X className=\"w-4 h-4 mr-2\" />\n                      Hủy\n                    </Button>\n                  </>\n                ) : (\n                  <Button\n                    onClick={() => setIsEditingThresholds(true)}\n                    variant=\"outline\"\n                    size=\"sm\"\n                  >\n                    <Save className=\"w-4 h-4 mr-2\" />\n                    Sửa mức chi tiêu\n                  </Button>\n                )}\n                <Button\n                  onClick={autoUpgradeAllCustomers}\n                  variant=\"outline\"\n                  size=\"sm\"\n                >\n                  <TrendingUp className=\"w-4 h-4 mr-2\" />\n                  {t(\"customers.autoUpgrade\")}\n                </Button>\n              </div>\n            </div>\n\n            {/* Filters */}\n            <div className=\"flex gap-4 mb-4\">\n              <div className=\"flex-1\">\n                <Input\n                  placeholder={t(\"customers.searchPlaceholder\")}\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                  className=\"max-w-md\"\n                />\n              </div>\n              <Select value={selectedTier} onValueChange={setSelectedTier}>\n                <SelectTrigger className=\"w-48\">\n                  <SelectValue placeholder={t(\"customers.filterByTier\")} />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">{t(\"customers.allTiers\")}</SelectItem>\n                  <SelectItem value=\"silver\">{t(\"customers.silver\")}</SelectItem>\n                  <SelectItem value=\"gold\">{t(\"customers.gold\")}</SelectItem>\n                  <SelectItem value=\"vip\">{t(\"customers.vip\")}</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* Customer List */}\n            {isLoading ? (\n              <div className=\"text-center py-8\">\n                <p className=\"text-gray-500\">{t(\"common.loading\")}</p>\n              </div>\n            ) : (\n              <div className=\"border rounded-lg\">\n                <div className=\"grid grid-cols-7 gap-4 p-4 font-medium text-sm text-gray-600 bg-gray-50 border-b\">\n                  <div>{t(\"customers.customerId\")}</div>\n                  <div>{t(\"customers.name\")}</div>\n                  <div>{t(\"customers.membershipLevel\")}</div>\n                  <div>{t(\"customers.totalSpent\")}</div>\n                  <div>{t(\"customers.visitCount\")}</div>\n                  <div>{t(\"customers.points\")}</div>\n                  <div className=\"text-center\">{t(\"common.actions\")}</div>\n                </div>\n                <div className=\"divide-y max-h-96 overflow-y-auto\">\n                  {filteredCustomers.map((customer) => {\n                    const currentTier = membershipTiers.find(t => t.level === (customer.membershipLevel || 'SILVER'));\n                    const totalSpent = parseFloat(customer.totalSpent || '0');\n                    const suggestedTier = totalSpent >= thresholds.VIP ? 'VIP' : totalSpent >= thresholds.GOLD ? 'GOLD' : 'SILVER';\n                    const needsUpgrade = suggestedTier !== (customer.membershipLevel || 'SILVER');\n                    \n                    return (\n                      <div key={customer.id} className=\"grid grid-cols-7 gap-4 p-4 items-center\">\n                        <div className=\"font-mono text-sm\">{customer.customerId || ''}</div>\n                        <div className=\"font-medium\">{customer.name}</div>\n                        <div>\n                          <Badge className={currentTier?.color || 'bg-gray-100 text-gray-800'}>\n                            {currentTier?.name || customer.membershipLevel}\n                          </Badge>\n                          {needsUpgrade && (\n                            <Badge variant=\"outline\" className=\"ml-1 text-orange-600\">\n                              {t(\"customers.upgradeAvailable\")}\n                            </Badge>\n                          )}\n                        </div>\n                        <div className=\"text-sm\">{totalSpent.toLocaleString()} ₫</div>\n                        <div className=\"text-sm\">{customer.visitCount || 0}회</div>\n                        <div className=\"text-sm\">{customer.points || 0}P</div>\n                        <div className=\"flex items-center justify-center gap-2\">\n                          <Select\n                            value={customer.membershipLevel || 'SILVER'}\n                            onValueChange={(newLevel) => handleUpdateMembership(customer.id, newLevel)}\n                          >\n                            <SelectTrigger className=\"w-20 h-8\">\n                              <SelectValue />\n                            </SelectTrigger>\n                            <SelectContent>\n                              <SelectItem value=\"SILVER\">{t(\"customers.silver\")}</SelectItem>\n                              <SelectItem value=\"GOLD\">{t(\"customers.gold\")}</SelectItem>\n                              <SelectItem value=\"VIP\">{t(\"customers.vip\")}</SelectItem>\n                            </SelectContent>\n                          </Select>\n                          {needsUpgrade && (\n                            <Button\n                              size=\"sm\"\n                              variant=\"outline\"\n                              onClick={() => autoUpgradeBasedOnSpending(customer.id, totalSpent)}\n                              className=\"text-orange-600 hover:text-orange-700\"\n                            >\n                              <TrendingUp className=\"w-3 h-3\" />\n                            </Button>\n                          )}\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n\n        <div className=\"flex justify-end gap-2 pt-4 border-t\">\n          <Button variant=\"outline\" onClick={onClose}>\n            <X className=\"w-4 h-4 mr-2\" />\n            {t(\"customers.close\")}\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":17198},"client/src/components/orders/order-dialog.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Plus, Minus, ShoppingCart } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { Table, Product, Category } from \"@shared/schema\";\nimport { useTranslation } from \"@/lib/i18n\";\n\ninterface OrderDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  table: Table | null;\n  existingOrder?: any;\n  mode?: \"create\" | \"edit\";\n}\n\ninterface CartItem {\n  product: Product;\n  quantity: number;\n  notes?: string;\n}\n\nexport function OrderDialog({\n  open,\n  onOpenChange,\n  table,\n  existingOrder,\n  mode = \"create\",\n}: OrderDialogProps) {\n  const [cart, setCart] = useState<CartItem[]>([]);\n  const [customerName, setCustomerName] = useState(\"\");\n  const [customerCount, setCustomerCount] = useState(1);\n  const [selectedCategory, setSelectedCategory] = useState<number | null>(null);\n  const [existingItems, setExistingItems] = useState<any[]>([]);\n  const { toast } = useToast();\n  const { t } = useTranslation();\n  const queryClient = useQueryClient();\n\n  const { data: products, isLoading: productsLoading } = useQuery({\n    queryKey: [\"/api/products\"],\n  });\n\n  const { data: categories, isLoading: categoriesLoading } = useQuery({\n    queryKey: [\"/api/categories\"],\n  });\n\n  const { data: existingOrderItems, refetch: refetchExistingItems } = useQuery({\n    queryKey: [\"/api/order-items\", existingOrder?.id],\n    enabled: !!(existingOrder?.id && mode === \"edit\" && open),\n    staleTime: 0,\n    queryFn: async () => {\n      console.log(\"Fetching existing order items for order:\", existingOrder.id);\n      const response = await apiRequest(\n        \"GET\",\n        `/api/order-items/${existingOrder.id}`,\n      );\n      const data = await response.json();\n      console.log(\"Existing order items response:\", data);\n      return data;\n    },\n  });\n\n  // Refetch existing items when dialog opens in edit mode\n  useEffect(() => {\n    if (mode === \"edit\" && open && existingOrder?.id) {\n      console.log(\"Dialog opened in edit mode, refetching existing items\");\n      refetchExistingItems();\n    }\n  }, [mode, open, existingOrder?.id, refetchExistingItems]);\n\n  const createOrderMutation = useMutation({\n    mutationFn: async (orderData: { order: any; items: any[] }) => {\n      console.log('=== ORDER MUTATION STARTED ===');\n      console.log('Mode:', mode);\n      console.log('Existing order:', existingOrder);\n      console.log(\n        mode === \"edit\"\n          ? \"Updating order with data:\"\n          : \"Creating order with data:\",\n        JSON.stringify(orderData, null, 2),\n      );\n\n      try {\n        if (mode === \"edit\" && existingOrder) {\n          console.log(`Adding ${orderData.items.length} items to existing order ${existingOrder.id}`);\n          const response = await apiRequest(\"POST\", `/api/orders/${existingOrder.id}/items`, {\n            items: orderData.items,\n          });\n          console.log('Add items response:', response);\n          return response;\n        } else {\n          console.log('Creating new order...');\n          const response = await apiRequest(\"POST\", \"/api/orders\", orderData);\n          console.log('Create order response:', response);\n          return response;\n        }\n      } catch (error) {\n        console.error('=== ORDER MUTATION ERROR ===');\n        console.error('Error details:', error);\n        throw error;\n      }\n    },\n    onSuccess: (response) => {\n      console.log('=== ORDER MUTATION SUCCESS ===');\n      console.log(\n        mode === \"edit\"\n          ? \"Order updated successfully:\"\n          : \"Order created successfully:\",\n        response,\n      );\n\n      // Invalidate queries to refresh data\n      queryClient.invalidateQueries({ queryKey: [\"/api/orders\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/tables\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/order-items\"] });\n\n      // Force refetch table data to ensure immediate UI update\n      queryClient.refetchQueries({ queryKey: [\"/api/tables\"] });\n      queryClient.refetchQueries({ queryKey: [\"/api/orders\"] });\n\n      // Reset form state\n      setCart([]);\n      setCustomerName(\"\");\n      setCustomerCount(1);\n      setExistingItems([]);\n      onOpenChange(false);\n\n      toast({\n        title: t('orders.orderUpdateSuccess'),\n        description: t('orders.orderUpdateSuccessDesc'),\n      });\n    },\n    onError: (error: any) => {\n      console.error('=== ORDER MUTATION ERROR ===');\n      console.error(\"Full error object:\", error);\n      console.error(\"Error message:\", error.message);\n      console.error(\"Error response:\", error.response);\n      console.error(\"Error response data:\", error.response?.data);\n\n      let errorMessage = t(\"orders.orderFailed\");\n\n      if (error.response?.data?.details) {\n        errorMessage = error.response.data.details;\n      } else if (error.response?.data?.error) {\n        errorMessage = error.response.data.error;\n      } else if (error.response?.data?.message) {\n        errorMessage = error.response.data.message;\n      } else if (error.message) {\n        errorMessage = error.message;\n      }\n\n      toast({\n        title: t(\"common.error\"),\n        description: mode === \"edit\" ? \"Bạn chưa sửa đơn hàng\" : `Lỗi tạo đơn hàng: ${errorMessage}`,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const filteredProducts = products\n    ? (products as Product[]).filter(\n        (product: Product) =>\n          !selectedCategory || product.categoryId === selectedCategory,\n      )\n    : [];\n\n  const addToCart = (product: Product) => {\n    // Check if product is out of stock\n    if (product.stock <= 0) {\n      toast({\n        title: t(\"common.error\"),\n        description: `${product.name} đã hết hàng`,\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setCart((prev) => {\n      const existing = prev.find((item) => item.product.id === product.id);\n      if (existing) {\n        // Check if adding one more would exceed stock\n        if (existing.quantity >= product.stock) {\n          toast({\n            title: t(\"common.warning\"),\n            description: `Chỉ còn ${product.stock} ${product.name} trong kho`,\n            variant: \"destructive\",\n          });\n          return prev;\n        }\n        return prev.map((item) =>\n          item.product.id === product.id\n            ? { ...item, quantity: item.quantity + 1 }\n            : item,\n        );\n      }\n      return [...prev, { product, quantity: 1 }];\n    });\n  };\n\n  const removeFromCart = (productId: number) => {\n    setCart((prev) => {\n      const existing = prev.find((item) => item.product.id === productId);\n      if (existing && existing.quantity > 1) {\n        return prev.map((item) =>\n          item.product.id === productId\n            ? { ...item, quantity: item.quantity - 1 }\n            : item,\n        );\n      }\n      return prev.filter((item) => item.product.id !== productId);\n    });\n  };\n\n  const updateItemNotes = (productId: number, notes: string) => {\n    setCart((prev) =>\n      prev.map((item) =>\n        item.product.id === productId ? { ...item, notes } : item,\n      ),\n    );\n  };\n\n  const calculateTotal = () => {\n    const cartTotal = cart.reduce(\n      (total, item) => {\n        const itemSubtotal = item.product.price * item.quantity;\n        return total + itemSubtotal;\n      },\n      0,\n    );\n\n    // In edit mode, also add existing items subtotal (pre-tax)\n    const existingTotal =\n      mode === \"edit\" && existingItems.length > 0\n        ? existingItems.reduce((total, item) => {\n            // Use unitPrice * quantity for existing items (pre-tax amount)\n            const itemSubtotal = Number(item.unitPrice || 0) * Number(item.quantity || 0);\n            return total + itemSubtotal;\n          }, 0)\n        : 0;\n\n    return cartTotal + existingTotal;\n  };\n\n  const calculateTax = () => {\n    let totalTax = 0;\n\n    // Calculate tax for items in the current cart\n    cart.forEach((item) => {\n      const product = products?.find((p: Product) => p.id === item.product.id);\n      let itemTax = 0;\n\n      // Tax = (after_tax_price - price) * quantity\n      if (product?.afterTaxPrice && product.afterTaxPrice !== null && product.afterTaxPrice !== \"\") {\n        const afterTaxPrice = parseFloat(product.afterTaxPrice);\n        const price = parseFloat(product.price);\n        itemTax = (afterTaxPrice - price) * item.quantity;\n      }\n      // No tax if no afterTaxPrice in database\n\n      totalTax += itemTax;\n    });\n\n    // Calculate tax for existing items in edit mode\n    if (mode === \"edit\" && existingItems.length > 0) {\n      existingItems.forEach((item) => {\n        const product = products?.find((p: Product) => p.id === item.productId);\n        let itemTax = 0;\n\n        // Tax = (after_tax_price - price) * quantity\n        if (product?.afterTaxPrice && product.afterTaxPrice !== null && product.afterTaxPrice !== \"\") {\n          const afterTaxPrice = parseFloat(product.afterTaxPrice);\n          const price = parseFloat(product.price);\n          itemTax = (afterTaxPrice - price) * item.quantity;\n        }\n        // No tax if no afterTaxPrice in database\n\n        totalTax += itemTax;\n      });\n    }\n\n    return totalTax;\n  };\n\n\n  const calculateGrandTotal = () => {\n    return calculateTotal() + calculateTax();\n  };\n\n  const handlePlaceOrder = () => {\n    // In edit mode, allow update even with empty cart\n    // In create mode, require items in cart\n    if (!table || (mode !== \"edit\" && cart.length === 0)) return;\n\n    if (mode === \"edit\" && existingOrder) {\n      // Check if there are new items to add\n      if (cart.length === 0) {\n        // No new items to add, but still need to refresh data and invalidate queries\n        console.log('No new items to add, refreshing data and closing dialog');\n\n        // Invalidate and refetch all related queries to ensure data is fresh\n        queryClient.invalidateQueries({ queryKey: [\"/api/orders\"] });\n        queryClient.invalidateQueries({ queryKey: [\"/api/tables\"] });\n        queryClient.invalidateQueries({ queryKey: [\"/api/order-items\"] });\n\n        // Force immediate refetch to update UI\n        queryClient.refetchQueries({ queryKey: [\"/api/tables\"] });\n        queryClient.refetchQueries({ queryKey: [\"/api/orders\"] });\n\n        toast({\n          title: t('orders.orderUpdateSuccess'),\n          description: 'Dữ liệu đã được làm mới thành công',\n        });\n\n        // Reset form state and close dialog\n        setCart([]);\n        setCustomerName(\"\");\n        setCustomerCount(1);\n        setExistingItems([]);\n        onOpenChange(false);\n        return;\n      }\n\n      // For edit mode, only send the new items to be added\n      const items = cart.map((item) => {\n        const product = products?.find((p: Product) => p.id === item.product.id);\n        const basePrice = item.product.price;\n        const quantity = item.quantity;\n        const itemSubtotal = basePrice * quantity;\n\n        let itemTax = 0;\n        // Tax = (after_tax_price - price) * quantity\n        if (product?.afterTaxPrice && product.afterTaxPrice !== null && product.afterTaxPrice !== \"\") {\n          const afterTaxPrice = parseFloat(product.afterTaxPrice);\n          const price = parseFloat(product.price);\n          itemTax = (afterTaxPrice - price) * quantity;\n        }\n        // No tax if no afterTaxPrice in database\n\n        const itemTotal = itemSubtotal + itemTax;\n\n        return {\n          productId: item.product.id,\n          quantity: item.quantity,\n          unitPrice: item.product.price.toString(),\n          total: itemTotal.toString(),\n          notes: item.notes || null,\n        };\n      });\n\n      console.log(\"Adding items to existing order:\", { items });\n      createOrderMutation.mutate({ order: existingOrder, items });\n    } else {\n      // Create mode - original logic\n      const orderNumber = `ORD-${Date.now()}`;\n      const subtotalAmount = cart.reduce(\n        (sum, item) => sum + item.product.price * item.quantity,\n        0,\n      );\n      const taxAmount = calculateTax(); // Use the new calculateTax function\n      const totalAmount = subtotalAmount + taxAmount;\n\n      const order = {\n        orderNumber: `ORD-${Date.now()}`,\n        tableId: table.id,\n        employeeId: null, // Set to null since no employees exist\n        customerName: customerName || null,\n        customerCount: parseInt(customerCount) || 1,\n        subtotal: subtotalAmount.toString(),\n        tax: taxAmount.toString(),\n        total: totalAmount.toString(),\n        status: \"served\",\n        paymentStatus: \"pending\",\n        orderedAt: new Date().toISOString(),\n      };\n\n      const items = cart.map((item) => {\n        const product = products?.find((p: Product) => p.id === item.product.id);\n        const basePrice = item.product.price;\n        const quantity = item.quantity;\n        const itemSubtotal = basePrice * quantity;\n\n        let itemTax = 0;\n        // Tax = (after_tax_price - price) * quantity\n        if (product?.afterTaxPrice && product.afterTaxPrice !== null && product.afterTaxPrice !== \"\") {\n          const afterTaxPrice = parseFloat(product.afterTaxPrice);\n          const price = parseFloat(product.price);\n          itemTax = (afterTaxPrice - price) * quantity;\n        }\n        // No tax if no afterTaxPrice in database\n\n        const itemTotal = itemSubtotal + itemTax;\n\n        return {\n          productId: item.product.id,\n          quantity: item.quantity,\n          unitPrice: item.product.price.toString(),\n          total: itemTotal.toString(),\n          notes: item.notes || null,\n        };\n      });\n\n      console.log(\"Placing order:\", { order, items });\n      createOrderMutation.mutate({ order, items });\n    }\n  };\n\n  const handleClose = () => {\n    setCart([]);\n    setCustomerName(\"\");\n    setCustomerCount(1);\n    setSelectedCategory(null);\n    // Only clear existing items if we're not in edit mode\n    if (mode !== \"edit\") {\n      setExistingItems([]);\n    }\n    onOpenChange(false);\n  };\n\n  useEffect(() => {\n    if (table && open) {\n      if (mode === \"edit\" && existingOrder) {\n        setCustomerName(existingOrder.customerName || \"\");\n        setCustomerCount(existingOrder.customerCount || 1);\n      } else {\n        setCustomerCount(Math.min(table.capacity, 1));\n      }\n    }\n  }, [table, open, mode, existingOrder]);\n\n  useEffect(() => {\n    if (\n      mode === \"edit\" &&\n      existingOrderItems &&\n      Array.isArray(existingOrderItems)\n    ) {\n      console.log(\"Setting existing items:\", existingOrderItems);\n      setExistingItems(existingOrderItems);\n    } else if (mode === \"edit\" && open && existingOrder?.id) {\n      // Clear existing items when dialog opens in edit mode but no data yet\n      setExistingItems([]);\n    }\n  }, [mode, existingOrderItems, open, existingOrder?.id]);\n\n  if (!table) return null;\n\n  return (\n    <Dialog open={open} onOpenChange={handleClose}>\n      <DialogContent className=\"max-w-6xl max-h-[95vh] overflow-hidden flex flex-col\">\n        <DialogHeader className=\"flex-shrink-0\">\n          <DialogTitle className=\"flex items-center gap-2\">\n            <ShoppingCart className=\"w-5 h-5\" />\n            {mode === \"edit\"\n              ? `${t(\"orders.editOrderTitle\")} ${table.tableNumber}`\n              : `Bàn ${table.tableNumber}`}\n          </DialogTitle>\n          <DialogDescription>\n            {mode === \"edit\"\n              ? t(\"orders.editOrderDesc\").replace(\"{orderNumber}\", existingOrder?.orderNumber || \"\")\n              : `${t(\"tables.tableCapacity\")}: ${table.capacity}${t(\"orders.people\")} | ${t(\"tables.selectMenuToOrder\")}`}\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 flex-1 min-h-0 overflow-hidden\">\n          {/* Menu Selection */}\n          <div className=\"lg:col-span-2 space-y-4 flex flex-col min-h-0\">\n            {/* Customer Info */}\n            <Card className=\"flex-shrink-0\">\n              <CardContent className=\"p-4\">\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <Label htmlFor=\"customerName\">\n                      {t(\"tables.customerName\")} ({t(\"tables.optional\")})\n                    </Label>\n                    <Input\n                      id=\"customerName\"\n                      value={customerName}\n                      onChange={(e) => setCustomerName(e.target.value)}\n                      placeholder={t(\"tables.customerNamePlaceholder\")}\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"customerCount\">\n                      {t(\"tables.customerCount\")}\n                    </Label>\n                    <Input\n                      id=\"customerCount\"\n                      type=\"number\"\n                      min={1}\n                      max={table.capacity}\n                      value={customerCount}\n                      onChange={(e) =>\n                        setCustomerCount(parseInt(e.target.value) || 1)\n                      }\n                    />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Category Filter */}\n            <div className=\"flex gap-2 overflow-x-auto pb-2 flex-shrink-0\">\n              <Button\n                variant={selectedCategory === null ? \"default\" : \"outline\"}\n                size=\"sm\"\n                onClick={() => setSelectedCategory(null)}\n              >\n                {t(\"tables.allCategories\")}\n              </Button>\n              {Array.isArray(categories) &&\n                categories.map((category: Category) => (\n                  <Button\n                    key={category.id}\n                    variant={\n                      selectedCategory === category.id ? \"default\" : \"outline\"\n                    }\n                    size=\"sm\"\n                    onClick={() => setSelectedCategory(category.id)}\n                    className=\"whitespace-nowrap\"\n                  >\n                    {category.name}\n                  </Button>\n                ))}\n            </div>\n\n            {/* Products Grid */}\n            <div className=\"grid grid-cols-2 gap-3 overflow-y-auto flex-1 min-h-0\">\n              {filteredProducts.map((product: Product) => (\n                <Card\n                  key={product.id}\n                  className={`transition-shadow ${\n                    Number(product.stock) > 0\n                      ? \"cursor-pointer hover:shadow-md\"\n                      : \"cursor-not-allowed opacity-60\"\n                  }`}\n                >\n                  <CardContent\n                    className=\"p-3\"\n                    onClick={() =>\n                      Number(product.stock) > 0 && addToCart(product)\n                    }\n                  >\n                    <div className=\"space-y-2\">\n                      <h4 className=\"font-medium text-sm\">{product.name}</h4>\n                      <p className=\"text-xs text-gray-600 line-clamp-2\">\n                        {product.sku}\n                      </p>\n                      <div className=\"flex justify-between items-center\">\n                        <span\n                          className={`font-bold ${\n                            Number(product.stock) > 0\n                              ? \"text-blue-600\"\n                              : \"text-gray-400\"\n                          }`}\n                        >\n                          {Number(product.price).toLocaleString()} ₫\n                        </span>\n                        <Badge\n                          variant={\n                            Number(product.stock) > 0\n                              ? \"default\"\n                              : \"destructive\"\n                          }\n                        >\n                          {Number(product.stock) > 0\n                            ? `${t(\"tables.stockCount\")} ${product.stock}`\n                            : \"Hết hàng\"}\n                        </Badge>\n                      </div>\n                      {Number(product.stock) === 0 && (\n                        <div className=\"text-xs text-red-500 font-medium\">\n                          Sản phẩm hiện đang hết hàng\n                        </div>\n                      )}\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </div>\n\n          {/* Cart */}\n          <div className=\"flex flex-col min-h-0 h-full\">\n            <div className=\"flex items-center justify-between mb-4 flex-shrink-0\">\n              <h3 className=\"text-lg font-semibold\">\n                {mode === \"edit\"\n                  ? t(\"orders.itemsAndNewItems\")\n                  : t(\"tables.orderHistory\")}\n              </h3>\n              <Badge variant=\"secondary\">\n                {mode === \"edit\"\n                  ? `${existingItems.length + cart.length} ${t(\"common.items\")}`\n                  : `${cart.length}${t(\"tables.itemsSelected\")}`}\n              </Badge>\n            </div>\n\n            {/* Scrollable Content Area */}\n            <div className=\"flex-1 overflow-y-auto space-y-4 min-h-0\">\n              {/* Existing Items (Edit Mode Only) */}\n              {mode === \"edit\" && existingItems.length > 0 && (\n                <>\n                  <div className=\"space-y-2\">\n                    <h4 className=\"text-sm font-medium text-gray-600\">\n                      {t(\"orders.previouslyOrdered\")}\n                    </h4>\n                    <div className=\"max-h-32 overflow-y-auto space-y-2\">\n                      {existingItems.map((item, index) => (\n                        <Card key={`existing-${index}`} className=\"bg-gray-50\">\n                          <CardContent className=\"p-3\">\n                            <div className=\"flex justify-between items-start\">\n                              <div className=\"flex-1\">\n                                <h4 className=\"font-medium text-sm\">\n                                  {item.productName}\n                                </h4>\n                                <p className=\"text-xs text-gray-500\">{t(\"orders.alreadyOrdered\")}</p>\n                              </div>\n                              <div className=\"flex items-center gap-2\">\n                                <div className=\"text-right\">\n                                  <span className=\"text-sm font-bold\">\n                                    {Math.floor(Number(item.total)).toLocaleString()} ₫\n                                  </span>\n                                  <p className=\"text-xs text-gray-500\">\n                                    x{item.quantity}\n                                  </p>\n                                </div>\n                                <Button\n                                  size=\"sm\"\n                                  variant=\"destructive\"\n                                  onClick={() => {\n                                    if (window.confirm(`Bạn có chắc chắn muốn xóa \"${item.productName}\" khỏi đơn hàng?`)) {\n                                      // Remove item from existing items list\n                                      setExistingItems(prev => prev.filter((_, i) => i !== index));\n\n                                      // Call API to delete the order item\n                                      apiRequest('DELETE', `/api/order-items/${item.id}`)\n                                        .then(async () => {\n                                          console.log('🗑️ Order Dialog: Successfully deleted item:', item.productName);\n\n                                          toast({\n                                            title: \"Xóa món thành công\",\n                                            description: `Đã xóa \"${item.productName}\" khỏi đơn hàng`,\n                                          });\n\n                                          // Recalculate order total if this is an existing order\n                                          if (existingOrder?.id) {\n                                            try {\n                                              console.log('🧮 Order Dialog: Starting order total recalculation for order:', existingOrder.id);\n\n                                              // Fetch current order items after deletion\n                                              const response = await apiRequest('GET', `/api/order-items/${existingOrder.id}`);\n                                              const remainingItems = await response.json();\n\n                                              console.log('📦 Order Dialog: Remaining items after deletion:', remainingItems?.length || 0);\n\n                                              // Calculate new total based on remaining items\n                                              let newSubtotal = 0;\n                                              let newTax = 0;\n\n                                              if (Array.isArray(remainingItems) && remainingItems.length > 0) {\n                                                remainingItems.forEach((remainingItem: any) => {\n                                                  const basePrice = Number(remainingItem.unitPrice || 0);\n                                                  const quantity = Number(remainingItem.quantity || 0);\n\n                                                  // Calculate subtotal and tax exactly as in other components\n                                                  if (Array.isArray(remainingItems) && remainingItems.length > 0) {\n                                                    remainingItems.forEach((remainingItem: any) => {\n                                                      const basePrice = Number(remainingItem.unitPrice || 0);\n                                                      const quantity = Number(remainingItem.quantity || 0);\n                                                      const product = products?.find((p: any) => p.id === remainingItem.productId);\n\n                                                      // Calculate subtotal\n                                                      newSubtotal += basePrice * quantity;\n\n                                                      // Calculate tax using Math.floor((after_tax_price - price) * quantity)\n                                                      if (\n                                                        product?.afterTaxPrice &&\n                                                        product.afterTaxPrice !== null &&\n                                                        product.afterTaxPrice !== \"\"\n                                                      ) {\n                                                        const afterTaxPrice = parseFloat(product.afterTaxPrice);\n                                                        const taxPerUnit = afterTaxPrice - basePrice;\n                                                        newTax += Math.floor(taxPerUnit * quantity);\n                                                      }\n                                                    });\n                                                  }\n                                                  });\n                                              }\n                                              // If no items left, totals should be 0\n                                              else {\n                                                console.log('📝 Order Dialog: No items left, setting totals to zero');\n                                                newSubtotal = 0;\n                                                newTax = 0;\n                                              }\n\n                                              const newTotal = newSubtotal + newTax;\n\n                                              console.log('💰 Order Dialog: Calculated new totals:', {\n                                                newSubtotal,\n                                                newTax,\n                                                newTotal,\n                                                itemsCount: remainingItems?.length || 0\n                                              });\n\n                                              // Update order with new totals\n                                              apiRequest('PUT', `/api/orders/${existingOrder.id}`, {\n                                                subtotal: newSubtotal.toString(),\n                                                tax: newTax.toString(),\n                                                total: newTotal.toString()\n                                              }).then(() => {\n                                                console.log('✅ Order Dialog: Order totals updated successfully');\n\n                                                // Force refresh of all related data to ensure UI updates immediately\n                                                Promise.all([\n                                                  queryClient.invalidateQueries({ queryKey: [\"/api/orders\"] }),\n                                                  queryClient.invalidateQueries({ queryKey: [\"/api/tables\"] }),\n                                                  queryClient.invalidateQueries({ queryKey: [\"/api/order-items\"] }),\n                                                  queryClient.invalidateQueries({ queryKey: [\"/api/order-items\", existingOrder.id] })\n                                                ]).then(() => {\n                                                  // Force immediate refetch to update table grid display\n                                                  return Promise.all([\n                                                    queryClient.refetchQueries({ queryKey: [\"/api/orders\"] }),\n                                                    queryClient.refetchQueries({ queryKey: [\"/api/tables\"] })\n                                                  ]);\n                                                });\n                                              });\n\n                                              console.log('🔄 Order Dialog: All queries refreshed successfully');\n\n                                            } catch (error) {\n                                              console.error('❌ Order Dialog: Error recalculating order total:', error);\n                                              toast({\n                                                title: \"Cảnh báo\",\n                                                description: \"Món đã được xóa nhưng có lỗi khi cập nhật tổng tiền\",\n                                                variant: \"destructive\",\n                                              });\n                                            }\n                                          }\n\n                                          // Invalidate queries to refresh data\n                                          queryClient.invalidateQueries({ queryKey: [\"/api/order-items\"] });\n                                          queryClient.invalidateQueries({ queryKey: [\"/api/orders\"] });\n                                        })\n                                        .catch((error) => {\n                                          console.error('Error deleting order item:', error);\n                                          // Restore the item if deletion failed\n                                          setExistingItems(prev => [...prev.slice(0, index), item, ...prev.slice(index)]);\n                                          toast({\n                                            title: \"Lỗi xóa món\",\n                                            description: \"Không thể xóa món khỏi đơn hàng\",\n                                            variant: \"destructive\",\n                                          });\n                                        });\n                                    }\n                                  }}\n                                  className=\"h-6 w-6 p-0\"\n                                >\n                                  <Minus className=\"w-3 h-3\" />\n                                </Button>\n                              </div>\n                            </div>\n                          </CardContent>\n                        </Card>\n                      ))}\n                    </div>\n                  </div>\n                  {cart.length > 0 && <Separator />}\n                  {cart.length > 0 && (\n                    <h4 className=\"text-sm font-medium text-gray-550\">\n                      {t(\"orders.newItemsToAdd\")}\n                    </h4>\n                  )}\n                </>\n              )}\n\n              {cart.length === 0 ? (\n                <div className=\"text-center py-8 text-gray-500\">\n                  <ShoppingCart className=\"w-12 h-12 mx-auto mb-4 text-gray-300\" />\n                  <p>{t(\"tables.noItemsSelected\")}</p>\n                </div>\n              ) : (\n                <div\n                  className={`${mode === \"edit\" ? \"max-h-[300px]\" : \"max-h-[520px]\"} overflow-y-auto space-y-3`}\n                >\n                  {cart.map((item) => (\n                    <Card key={item.product.id}>\n                      <CardContent className=\"p-3\">\n                        <div className=\"space-y-2\">\n                          <div className=\"flex justify-between items-start\">\n                            <h4 className=\"font-medium text-sm\">\n                              {item.product.name}\n                            </h4>\n                            <span className=\"text-sm font-bold\">\n                              {Math.floor(\n                                Number(item.product.price) * item.quantity\n                              ).toLocaleString()}{\" \"}\n                              ₫\n                            </span>\n                          </div>\n\n                          <div className=\"flex items-center justify-between\">\n                            <div className=\"flex items-center gap-2\">\n                              <Button\n                                size=\"sm\"\n                                variant=\"outline\"\n                                onClick={() => removeFromCart(item.product.id)}\n                                className=\"h-6 w-6 p-0\"\n                              >\n                                <Minus className=\"w-3 h-3\" />\n                              </Button>\n                              <span className=\"text-sm font-medium w-8 text-center\">\n                                {item.quantity}\n                              </span>\n                              <Button\n                                size=\"sm\"\n                                variant=\"outline\"\n                                onClick={() => addToCart(item.product)}\n                                className=\"h-6 w-6 p-0\"\n                                disabled={item.quantity >= item.product.stock}\n                              >\n                                <Plus className=\"w-3 h-3\" />\n                              </Button>\n                            </div>\n                            <span className=\"text-xs text-gray-500\">\n                              {t(\"tables.unitPrice\")}: {Number(item.product.price).toLocaleString()} ₫\n                            </span>\n                          </div>\n\n                          <Textarea\n                            placeholder={t(\"tables.specialRequests\")}\n                            value={item.notes || \"\"}\n                            onChange={(e) =>\n                              updateItemNotes(item.product.id, e.target.value)\n                            }\n                            className=\"text-xs h-16\"\n                          />\n                        </div>\n                      </CardContent>\n                    </Card>\n                  ))}\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n\n        {/* DialogFooter with Summary and Order Button */}\n        {(cart.length > 0 || (mode === \"edit\" && existingItems.length > 0) || (mode === \"edit\")) && (\n          <DialogFooter className=\"pt-4 pb-2 flex-shrink-0 border-t bg-white\">\n            <div className=\"flex items-center justify-between w-full\">\n              {/* Summary items in horizontal layout */}\n              <div className=\"flex items-center gap-4 text-sm flex-wrap\">\n                {mode === \"edit\" && existingItems.length > 0 && (\n                  <>\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"text-gray-600\">{t(\"orders.previousItems\")}</span>\n                      <span className=\"font-medium\">\n                        {Math.floor(\n                          existingItems\n                            .reduce((total, item) => {\n                              // Use unitPrice * quantity for existing items (pre-tax amount)\n                              const itemSubtotal = Number(item.unitPrice || 0) * Number(item.quantity || 0);\n                              return total + itemSubtotal;\n                            }, 0)\n                        ).toLocaleString()}{\" \"}\n                        ₫\n                      </span>\n                    </div>\n                    {cart.length > 0 && (\n                      <div className=\"w-px h-4 bg-gray-300\"></div>\n                    )}\n                  </>\n                )}\n                {cart.length > 0 && mode === \"edit\" && (\n                  <>\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"text-gray-600\">{t(\"orders.newItems\")}</span>\n                      <span className=\"font-medium\">\n                        {Math.floor(\n                          cart\n                            .reduce(\n                              (total, item) =>\n                                total +\n                                Number(item.product.price) * item.quantity,\n                              0,\n                            )\n                        ).toLocaleString()}{\" \"}\n                        ₫\n                      </span>\n                    </div>\n                    <div className=\"w-px h-4 bg-gray-300\"></div>\n                  </>\n                )}\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-gray-600\">{t(\"tables.subtotalLabel\")}</span>\n                  <span className=\"font-medium\">\n                    {Math.floor(calculateTotal()).toLocaleString()} ₫\n                  </span>\n                </div>\n                <div className=\"w-px h-4 bg-gray-300\"></div>\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-gray-600\">{t(\"tables.taxLabel\")}</span>\n                  <span className=\"font-medium\">\n                    {Math.floor(calculateTax()).toLocaleString()} ₫\n                  </span>\n                </div>\n                <div className=\"w-px h-4 bg-gray-300\"></div>\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-gray-600 font-bold\">\n                    {t(\"tables.totalLabel\")}\n                  </span>\n                  <span className=\"font-bold text-lg text-blue-600\">\n                    {Math.floor(calculateGrandTotal()).toLocaleString()} ₫\n                  </span>\n                </div>\n              </div>\n\n              {/* Action button */}\n              <Button\n                onClick={handlePlaceOrder}\n                disabled={createOrderMutation.isPending}\n                className=\"bg-green-600 hover:bg-green-700 text-white px-8 py-2 flex-shrink-0\"\n                size=\"lg\"\n              >\n                {createOrderMutation.isPending\n                  ? mode === \"edit\"\n                    ? t(\"orders.updating\")\n                    : t(\"tables.placing\")\n                  : mode === \"edit\"\n                    ? (cart.length === 0 ? t(\"orders.updateAndRefresh\") : t(\"orders.updateOrder\"))\n                    : t(\"tables.placeOrder\")}\n              </Button>\n            </div>\n          </DialogFooter>\n        )}\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":40816},"client/src/components/orders/order-management.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Eye, Clock, CheckCircle2, DollarSign, Users, CreditCard, QrCode, Search } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { PaymentMethodModal } from \"@/components/pos/payment-method-modal\";\nimport { EInvoiceModal } from \"@/components/pos/einvoice-modal\";\nimport { ReceiptModal } from \"@/components/pos/receipt-modal\";\nimport QRCodeLib from \"qrcode\";\nimport type { Order, Table, Product, OrderItem } from \"@shared/schema\";\n\nexport function OrderManagement() {\n  const [selectedOrder, setSelectedOrder] = useState<Order | null>(null);\n  const [orderDetailsOpen, setOrderDetailsOpen] = useState(false);\n  const [paymentModalOpen, setPaymentModalOpen] = useState(false);\n  const [orderForPayment, setOrderForPayment] = useState<Order | null>(null);\n  const [paymentMethodsOpen, setPaymentMethodsOpen] = useState(false);\n  const [showQRPayment, setShowQRPayment] = useState(false);\n  const [qrCodeUrl, setQrCodeUrl] = useState(\"\");\n  const [selectedPaymentMethod, setSelectedPaymentMethod] = useState<any>(null);\n  const [pointsPaymentOpen, setPointsPaymentOpen] = useState(false);\n  const [selectedCustomer, setSelectedCustomer] = useState<any>(null);\n  const [pointsAmount, setPointsAmount] = useState(\"\");\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [mixedPaymentOpen, setMixedPaymentOpen] = useState(false);\n  const [mixedPaymentData, setMixedPaymentData] = useState<any>(null);\n  const [qrLoading, setQrLoading] = useState(false);\n  const [showPaymentMethodModal, setShowPaymentMethodModal] = useState(false);\n  const [showEInvoiceModal, setShowEInvoiceModal] = useState(false);\n  const [showReceiptModal, setShowReceiptModal] = useState(false);\n  const [selectedReceipt, setSelectedReceipt] = useState<any>(null);\n  const [showReceiptPreview, setShowReceiptPreview] = useState(false);\n  const [previewReceipt, setPreviewReceipt] = useState<any>(null);\n  const { toast } = useToast();\n  const { t } = useTranslation();\n  const queryClient = useQueryClient();\n\n  const { data: orders, isLoading: ordersLoading } = useQuery({\n    queryKey: ['/api/orders'],\n    refetchInterval: 15000, // Refetch every 15 seconds for faster updates\n    refetchOnWindowFocus: true, // Refetch when window regains focus\n    staleTime: 5000, // Consider data stale after 5 seconds\n  });\n\n  const { data: tables } = useQuery({\n    queryKey: ['/api/tables'],\n  });\n\n  const { data: products } = useQuery({\n    queryKey: ['/api/products'],\n  });\n\n  const { data: customers } = useQuery({\n    queryKey: ['/api/customers'],\n    enabled: pointsPaymentOpen,\n  });\n\n  const { data: orderItems, isLoading: orderItemsLoading } = useQuery({\n    queryKey: ['/api/order-items', selectedOrder?.id],\n    enabled: !!selectedOrder?.id && orderDetailsOpen,\n    queryFn: async () => {\n      if (!selectedOrder?.id) return [];\n      const response = await apiRequest('GET', `/api/order-items/${selectedOrder.id}`);\n      const data = await response.json();\n      return Array.isArray(data) ? data : [];\n    },\n  });\n\n  const updateOrderStatusMutation = useMutation({\n    mutationFn: ({ orderId, status }: { orderId: number; status: string }) => {\n      console.log('🎯 updateOrderStatusMutation.mutationFn called:', {\n        orderId,\n        status,\n        timestamp: new Date().toISOString()\n      });\n      return apiRequest('PUT', `/api/orders/${orderId}/status`, { status });\n    },\n    onSuccess: (data, variables) => {\n      console.log('✅ updateOrderStatusMutation.onSuccess called:', {\n        variables,\n        responseData: data,\n        timestamp: new Date().toISOString()\n      });\n\n      queryClient.invalidateQueries({ queryKey: ['/api/orders'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/tables'] });\n      \n      toast({\n        title: t('common.success'),\n        description: t('orders.orderStatusUpdated'),\n      });\n    },\n    onError: (error, variables) => {\n      console.error('❌ updateOrderStatusMutation.onError called:', {\n        error: error,\n        errorMessage: error?.message,\n        variables,\n        timestamp: new Date().toISOString()\n      });\n\n      toast({\n        title: t('common.error'),\n        description: t('orders.orderStatusUpdateFailed'),\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const completePaymentMutation = useMutation({\n    mutationFn: async ({ orderId, paymentMethod }: { orderId: number; paymentMethod: string }) => {\n      console.log('🎯 completePaymentMutation called - using centralized payment completion');\n      console.log('📋 Order Management: Starting payment completion for order:', orderId);\n      return await completeOrderPayment(orderId, { paymentMethod });\n    },\n    onSuccess: async (result, variables) => {\n      console.log('🎯 Order Management completePaymentMutation.onSuccess called');\n\n      toast({\n        title: 'Thanh toán thành công',\n        description: 'Đơn hàng đã được thanh toán',\n      });\n\n      // Fetch the completed order and its items for receipt\n      try {\n        const [completedOrder, orderItemsData] = await Promise.all([\n          queryClient.fetchQuery({\n            queryKey: ['/api/orders', variables.orderId],\n            queryFn: async () => {\n              const response = await apiRequest('GET', `/api/orders/${variables.orderId}`);\n              return response.json();\n            }\n          }),\n          queryClient.fetchQuery({\n            queryKey: ['/api/order-items', variables.orderId],\n            queryFn: async () => {\n              const response = await apiRequest('GET', `/api/order-items/${variables.orderId}`);\n              return response.json();\n            }\n          })\n        ]);\n\n        if (completedOrder && orderItemsData) {\n          console.log('✅ Order Management payment completed - preparing receipt data');\n\n          // Use EXACT same calculation logic as Order Details display\n          let subtotal = 0;\n          let totalTax = 0;\n\n          const processedItems = Array.isArray(orderItemsData) ? orderItemsData.map((item: any) => {\n            const basePrice = Number(item.unitPrice || 0);\n            const quantity = Number(item.quantity || 0);\n            const product = Array.isArray(products) ? products.find((p: any) => p.id === item.productId) : null;\n\n            // Calculate subtotal exactly as Order Details display\n            const itemSubtotal = basePrice * quantity;\n            subtotal += itemSubtotal;\n\n            // Tax = (after_tax_price - price) * quantity\n            let itemTax = 0;\n            if (product?.afterTaxPrice && product.afterTaxPrice !== null && product.afterTaxPrice !== \"\") {\n              const afterTaxPrice = parseFloat(product.afterTaxPrice);\n              const price = parseFloat(product.price);\n              itemTax = (afterTaxPrice - price) * quantity;\n              totalTax += itemTax;\n            }\n\n            return {\n              id: item.id,\n              productId: item.productId,\n              productName: item.productName || getProductInfo(item.productId)?.name || 'Unknown Product',\n              quantity: item.quantity,\n              price: item.unitPrice,\n              total: item.total,\n              sku: item.productSku || `SP${item.productId}`,\n              taxRate: product?.taxRate ? parseFloat(product.taxRate) : 10\n            };\n          }) : [];\n\n          const finalTotal = subtotal + totalTax;\n\n          // Create comprehensive receipt object\n          const receiptData = {\n            ...completedOrder,\n            transactionId: `TXN-${Date.now()}`,\n            items: processedItems,\n            subtotal: subtotal.toFixed(2),\n            tax: totalTax.toFixed(2),\n            total: finalTotal.toFixed(2),\n            paymentMethod: variables.paymentMethod || 'cash',\n            amountReceived: finalTotal.toFixed(2),\n            change: '0.00',\n            cashierName: 'Order Management',\n            createdAt: new Date().toISOString()\n          };\n\n          console.log('📄 Order Management receipt data prepared:', receiptData);\n\n          // Close all dialogs first\n          setOrderDetailsOpen(false);\n          setPaymentMethodsOpen(false);\n          setShowPaymentMethodModal(false);\n          setShowEInvoiceModal(false);\n          setOrderForPayment(null);\n\n          // Show receipt modal\n          setSelectedReceipt(receiptData);\n          setShowReceiptModal(true);\n        }\n      } catch (error) {\n        console.error('Error fetching order details for receipt:', error);\n        toast({\n          title: 'Cảnh báo',\n          description: 'Thanh toán thành công nhưng không thể hiển thị hóa đơn',\n          variant: 'destructive',\n        });\n      }\n    },\n    onError: (error) => {\n      console.log('❌ Order Management completePaymentMutation.onError called:', error);\n      toast({\n        title: 'Lỗi',\n        description: 'Không thể hoàn tất thanh toán',\n        variant: \"destructive\",\n      });\n      setOrderForPayment(null);\n    },\n  });\n\n  const pointsPaymentMutation = useMutation({\n    mutationFn: async ({ customerId, points, orderId, paymentMethod, remainingAmount }: {\n      customerId: number;\n      points: number;\n      orderId: number;\n      paymentMethod?: string;\n      remainingAmount?: number;\n    }) => {\n      // First redeem points\n      await apiRequest('POST', '/api/customers/redeem-points', {\n        customerId,\n        points\n      });\n\n      // Then mark order as paid\n      await apiRequest('PUT', `/api/orders/${orderId}/status`, {\n        status: 'paid',\n        paymentMethod: paymentMethod || 'points',\n        customerId,\n        remainingAmount: remainingAmount || 0\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/orders'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/tables'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/customers'] });\n      setOrderDetailsOpen(false);\n      setPointsPaymentOpen(false);\n      setSelectedCustomer(null);\n      setPointsAmount(\"\");\n      setSearchTerm(\"\");\n      toast({\n        title: t('common.success'),\n        description: t('orders.pointsPaymentTitle'),\n      });\n    },\n    onError: () => {\n      toast({\n        title: 'Lỗi',\n        description: 'Không thể hoàn tất thanh toán bằng điểm',\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const mixedPaymentMutation = useMutation({\n    mutationFn: async ({ customerId, points, orderId, paymentMethod }: {\n      customerId: number;\n      points: number;\n      orderId: number;\n      paymentMethod: string;\n    }) => {\n      // First redeem all available points\n      await apiRequest('POST', '/api/customers/redeem-points', {\n        customerId,\n        points\n      });\n\n      // Then mark order as paid with mixed payment\n      await apiRequest('PUT', `/api/orders/${orderId}/status`, {\n        status: 'paid',\n        paymentMethod: `points + ${paymentMethod}`,\n        customerId\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/orders'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/tables'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/customers'] });\n      setOrderDetailsOpen(false);\n      setMixedPaymentOpen(false);\n      setMixedPaymentData(null);\n      setSelectedCustomer(null);\n      setPointsAmount(\"\");\n      setSearchTerm(\"\");\n      toast({\n        title: 'Thanh toán thành công',\n        description: 'Đơn hàng đã được thanh toán bằng điểm + tiền mặt/chuyển khoản',\n      });\n    },\n    onError: () => {\n      toast({\n        title: 'Lỗi',\n        description: 'Không thể hoàn tất thanh toán hỗn hợp',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  const getOrderStatusBadge = (status: string) => {\n    const statusConfig = {\n      pending: { label: t('orders.status.pending'), variant: \"secondary\" as const, color: \"bg-yellow-500\" },\n      confirmed: { label: t('orders.status.confirmed'), variant: \"default\" as const, color: \"bg-blue-500\" },\n      preparing: { label: t('orders.status.preparing'), variant: \"destructive\" as const, color: \"bg-orange-500\" },\n      ready: { label: t('orders.status.ready'), variant: \"outline\" as const, color: \"bg-green-500\" },\n      served: { label: t('orders.status.served'), variant: \"outline\" as const, color: \"bg-green-600\" },\n      paid: { label: t('orders.status.paid'), variant: \"outline\" as const, color: \"bg-gray-500\" },\n      cancelled: { label: t('orders.status.cancelled'), variant: \"destructive\" as const, color: \"bg-red-500\" },\n    };\n\n    return statusConfig[status as keyof typeof statusConfig] || statusConfig.pending;\n  };\n\n  const getTableInfo = (tableId: number) => {\n    if (!tables) return null;\n    return (tables as Table[]).find((table: Table) => table.id === tableId);\n  };\n\n  const getProductInfo = (productId: number) => {\n    if (!products) return null;\n    return (products as Product[]).find((product: Product) => product.id === productId);\n  };\n\n  // CENTRALIZED payment completion function - all payment flows go through here\n  const completeOrderPayment = async (orderId: number, paymentData: any) => {\n    console.log('🎯 CENTRALIZED Payment Completion - Order ID:', orderId, 'Payment Data:', paymentData);\n\n    try {\n      // Step 1: Update order status to 'paid' - THIS IS THE CRITICAL STEP\n      console.log('📋 Step 1: Updating order status to PAID for order:', orderId);\n\n      console.log('🔍 API Call Details:', {\n        url: `/api/orders/${orderId}/status`,\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ status: 'paid' })\n      });\n\n      const statusResponse = await apiRequest('PUT', `/api/orders/${orderId}/status`, { status: 'paid' });\n\n      console.log('🔍 API Response Status:', statusResponse.status, statusResponse.statusText);\n\n      if (!statusResponse.ok) {\n        const errorText = await statusResponse.text();\n        console.error('❌ API Response Error:', errorText);\n        throw new Error(`Failed to update order status: ${errorText}`);\n      }\n\n      const updatedOrder = await statusResponse.json();\n      console.log('✅ Step 1 COMPLETED: Order status updated to PAID:', {\n        orderId: updatedOrder.id,\n        orderNumber: updatedOrder.orderNumber,\n        tableId: updatedOrder.tableId,\n        status: updatedOrder.status,\n        paidAt: updatedOrder.paidAt,\n        updated: updatedOrder.updated,\n        previousStatus: updatedOrder.previousStatus\n      });\n\n      // Step 2: Update additional payment details\n      console.log('📋 Step 2: Updating payment details for order:', orderId);\n\n      const paymentDetailsResponse = await fetch(`/api/orders/${orderId}`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          paymentMethod: paymentData.paymentMethod || 'cash',\n          einvoiceStatus: paymentData.einvoiceStatus || 0,\n          paidAt: new Date().toISOString(),\n          invoiceNumber: paymentData.invoiceNumber || null,\n          symbol: paymentData.symbol || null,\n          templateNumber: paymentData.templateNumber || null\n        })\n      });\n\n      if (!paymentDetailsResponse.ok) {\n        console.warn('⚠️ Step 2 FAILED: Could not update payment details, but order is already PAID');\n      } else {\n        console.log('✅ Step 2 COMPLETED: Payment details updated');\n      }\n\n      // Step 3: Refresh UI and trigger events\n      console.log('📋 Step 3: Refreshing UI and triggering events');\n\n      await Promise.all([\n        queryClient.invalidateQueries({ queryKey: ['/api/orders'] }),\n        queryClient.invalidateQueries({ queryKey: ['/api/tables'] }),\n        queryClient.refetchQueries({ queryKey: ['/api/orders'] })\n      ]);\n\n      // Dispatch events for real-time updates\n      if (typeof window !== 'undefined') {\n        const events = [\n          new CustomEvent('refreshOrders'),\n          new CustomEvent('paymentCompleted', {\n            detail: { orderId, tableId: updatedOrder.tableId }\n          }),\n          new CustomEvent('tableStatusUpdate', {\n            detail: { tableId: updatedOrder.tableId, checkForRelease: true }\n          })\n        ];\n\n        events.forEach(event => window.dispatchEvent(event));\n      }\n\n      console.log('✅ Step 3 COMPLETED: UI refreshed and events dispatched');\n      console.log('🎉 PAYMENT COMPLETION SUCCESS - Order', orderId, 'is now PAID');\n\n      return { success: true, order: updatedOrder };\n\n    } catch (error) {\n      console.error('❌ PAYMENT COMPLETION FAILED for order', orderId, ':', error);\n      throw error;\n    }\n  };\n\n  // Handle E-invoice confirmation and complete payment\n  const handleEInvoiceConfirm = async (invoiceData: any) => {\n    console.log('🎯 Order Management handleEInvoiceConfirm called with data:', invoiceData);\n\n    if (!orderForPayment) {\n      console.error('❌ No order for payment found');\n      toast({\n        title: 'Lỗi',\n        description: 'Không tìm thấy đơn hàng để thanh toán',\n        variant: 'destructive',\n      });\n      return;\n    }\n\n    try {\n      // Use centralized payment completion function\n      await completeOrderPayment(orderForPayment.id, {\n        paymentMethod: invoiceData.originalPaymentMethod || 'einvoice',\n        einvoiceStatus: invoiceData.publishLater ? 0 : 1,\n        invoiceNumber: invoiceData.invoiceNumber,\n        symbol: invoiceData.symbol,\n        templateNumber: invoiceData.templateNumber\n      });\n\n      toast({\n        title: 'Thành công',\n        description: invoiceData.publishLater\n          ? 'Đơn hàng đã được thanh toán và lưu để phát hành hóa đơn sau'\n          : 'Đơn hàng đã được thanh toán và hóa đơn điện tử đã được phát hành',\n      });\n\n      // Close modals and show receipt if available\n      setShowEInvoiceModal(false);\n      setOrderForPayment(null);\n\n      if (invoiceData.receipt) {\n        console.log('📄 Showing receipt modal after successful payment');\n        setSelectedReceipt(invoiceData.receipt);\n        setShowReceiptModal(true);\n      }\n\n    } catch (error) {\n      console.error('❌ Error during payment completion:', error);\n      toast({\n        title: 'Lỗi',\n        description: 'Không thể hoàn tất thanh toán. Vui lòng thử lại.',\n        variant: 'destructive',\n      });\n\n      // Reset states\n      setOrderForPayment(null);\n      setShowEInvoiceModal(false);\n    }\n  };\n\n  const formatCurrency = (amount: number) => {\n    if (typeof amount !== 'number' || isNaN(amount)) {\n      return '0 ₫';\n    }\n    // Always round to integer and format without decimals\n    return `${Math.floor(amount).toLocaleString('vi-VN')} ₫`;\n  };\n\n  const formatTime = (dateString: string | Date) => {\n    const date = typeof dateString === 'string' ? new Date(dateString) : dateString;\n    const currentLanguage = localStorage.getItem('language') || 'ko';\n\n    const localeMap = {\n      ko: 'ko-KR',\n      en: 'en-US',\n      vi: 'vi-VN'\n    };\n\n    return date.toLocaleTimeString(localeMap[currentLanguage as keyof typeof localeMap] || 'ko-KR', {\n      hour: '2-digit',\n      minute: '2-digit',\n      hour12: false\n    });\n  };\n\n  const handleViewOrder = (order: Order) => {\n    setSelectedOrder(order);\n    setOrderDetailsOpen(true);\n  };\n\n  const handleStatusUpdate = async (orderId: number, newStatus: string) => {\n    console.log('=== ORDER STATUS UPDATE DEBUG START ===');\n    console.log('🎯 Function called with params:', {\n      orderId,\n      newStatus,\n      timestamp: new Date().toISOString()\n    });\n\n    try {\n      console.log('🔍 Pre-API call debug info:', {\n        apiRequestFunction: typeof apiRequest,\n        orderId: orderId,\n        newStatus: newStatus,\n        apiUrl: `/api/orders/${orderId}/status`,\n        requestBody: { status: newStatus }\n      });\n\n      console.log(`🔄 Order Management: Starting API call to update order ${orderId} status to ${newStatus}`);\n\n      // Log the exact API request being made\n      console.log('📤 Making API request:', {\n        method: 'PUT',\n        url: `/api/orders/${orderId}/status`,\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ status: newStatus })\n      });\n\n      const response = await apiRequest('PUT', `/api/orders/${orderId}/status`, { status: newStatus });\n\n      console.log('📥 API Response received:', {\n        ok: response.ok,\n        status: response.status,\n        statusText: response.statusText,\n        headers: Object.fromEntries(response.headers.entries()),\n        url: response.url\n      });\n\n      if (response.ok) {\n        const updatedOrder = await response.json();\n        console.log(`✅ Order Management: Status updated successfully:`, {\n          orderId: updatedOrder.id,\n          orderNumber: updatedOrder.orderNumber,\n          previousStatus: updatedOrder.previousStatus,\n          newStatus: updatedOrder.status,\n          paidAt: updatedOrder.paidAt,\n          tableId: updatedOrder.tableId,\n          updatedAt: updatedOrder.updatedAt,\n          fullOrderData: updatedOrder\n        });\n\n        // Log query invalidation\n        console.log('🔄 Invalidating React Query caches...');\n        \n        const ordersInvalidation = queryClient.invalidateQueries({ queryKey: ['/api/orders'] });\n        const tablesInvalidation = queryClient.invalidateQueries({ queryKey: ['/api/tables'] });\n\n        console.log('🔄 Cache invalidation promises:', {\n          ordersInvalidation: !!ordersInvalidation,\n          tablesInvalidation: !!tablesInvalidation\n        });\n\n        await Promise.all([ordersInvalidation, tablesInvalidation]);\n        console.log('✅ Cache invalidation completed');\n\n        // Force refetch to ensure UI updates\n        console.log('🔄 Force refetching queries...');\n        await queryClient.refetchQueries({ queryKey: ['/api/orders'] });\n        console.log('✅ Queries refetched');\n\n        toast({\n          title: \"Thành công\",\n          description: `Trạng thái đơn hàng đã được cập nhật thành ${newStatus}`,\n        });\n\n        console.log('✅ SUCCESS: Order status update completed successfully');\n      } else {\n        const errorText = await response.text();\n        console.error(`❌ Order Management: API call failed:`, {\n          status: response.status,\n          statusText: response.statusText,\n          errorText: errorText,\n          url: response.url\n        });\n\n        toast({\n          title: \"Lỗi\",\n          description: \"Không thể cập nhật trạng thái đơn hàng: \" + errorText,\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      console.error('=== CRITICAL ERROR IN handleStatusUpdate ===');\n      console.error('❌ Error type:', error?.constructor?.name);\n      console.error('❌ Error message:', error?.message);\n      console.error('❌ Error stack:', error?.stack);\n      console.error('❌ Error full object:', error);\n      console.error('❌ Parameters that caused error:', {\n        orderId,\n        newStatus,\n        apiRequestAvailable: typeof apiRequest,\n        queryClientAvailable: typeof queryClient\n      });\n\n      toast({\n        title: \"Lỗi\",\n        description: `Có lỗi xảy ra khi cập nhật trạng thái đơn hàng: ${error?.message || 'Unknown error'}`,\n        variant: \"destructive\",\n      });\n    }\n\n    console.log('=== ORDER STATUS UPDATE DEBUG END ===');\n  };\n\n  const handlePaymentClick = (order: Order) => {\n    setSelectedOrder(order);\n    setOrderDetailsOpen(true);\n  };\n\n  const handlePaymentMethodSelect = async (method: string, data?: any) => {\n    console.log(\"🎯 Order Management payment method selected:\", method, data);\n\n    if (method === \"paymentCompleted\" && data?.success) {\n      console.log(\"✅ Order Management: Payment completed successfully\", data);\n\n      try {\n        // Invalidate queries to refresh the UI\n        await Promise.all([\n          queryClient.invalidateQueries({ queryKey: ['/api/orders'] }),\n          queryClient.invalidateQueries({ queryKey: ['/api/tables'] }),\n          queryClient.refetchQueries({ queryKey: ['/api/orders'] })\n        ]);\n\n        console.log('✅ Order Management: UI refreshed after payment');\n\n        toast({\n          title: 'Thành công',\n          description: data.publishLater\n            ? 'Đơn hàng đã được thanh toán và lưu để phát hành hóa đơn sau'\n            : 'Đơn hàng đã được thanh toán và hóa đơn điện tử đã được phát hành',\n        });\n\n        // Show receipt if available\n        if (data.receipt && data.shouldShowReceipt) {\n          console.log('📄 Order Management: Showing receipt modal after successful payment');\n          setSelectedReceipt(data.receipt);\n          setShowReceiptModal(true);\n        }\n\n      } catch (error) {\n        console.error('❌ Error refreshing UI after payment:', error);\n      }\n\n      // Reset payment state\n      setShowPaymentMethodModal(false);\n      setOrderForPayment(null);\n      return;\n    }\n\n    if (method === \"paymentError\" && data) {\n      console.error(\"❌ Order Management: Payment failed\", data);\n\n      toast({\n        title: 'Lỗi',\n        description: data.error || 'Không thể hoàn tất thanh toán. Vui lòng thử lại.',\n        variant: 'destructive',\n      });\n\n      // Reset payment state\n      setShowPaymentMethodModal(false);\n      setOrderForPayment(null);\n      return;\n    }\n\n    // Handle other payment methods\n    if (data && data.orderId) {\n      try {\n        // Update order status to paid first\n        console.log(\"📤 Order Management: Updating order status to paid for order:\", data.orderId);\n\n        const statusUpdateResponse = await fetch(`/api/orders/${data.orderId}/status`, {\n          method: 'PUT',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({ status: 'paid' }),\n        });\n\n        if (statusUpdateResponse.ok) {\n          console.log(\"✅ Order Management: Order status updated to paid successfully\");\n\n          // Then update additional payment details\n          const updatePayload: any = {\n            paymentMethod: data.originalPaymentMethod,\n            paidAt: new Date().toISOString(),\n            einvoiceStatus: data.publishLater ? 0 : 1,\n          };\n\n          // Add cash payment specific data if applicable\n          if (data.originalPaymentMethod === \"cash\" && data.paymentData) {\n            updatePayload.amountReceived = data.paymentData.amountReceived?.toFixed(2);\n            updatePayload.change = data.paymentData.change?.toFixed(2);\n          }\n\n          console.log(\"📤 Order Management: Sending payment details update:\", updatePayload);\n\n          const paymentUpdateResponse = await fetch(`/api/orders/${data.orderId}`, {\n            method: 'PUT',\n            headers: {\n              'Content-Type': 'application/json',\n            },\n            body: JSON.stringify(updatePayload),\n          });\n\n          if (paymentUpdateResponse.ok) {\n            const updatedOrder = await paymentUpdateResponse.json();\n            console.log(\"✅ Order Management: Payment details updated successfully:\", updatedOrder);\n          } else {\n            console.error(\"❌ Order Management: Failed to update payment details\");\n          }\n\n          // Force refresh all relevant queries\n          queryClient.invalidateQueries({ queryKey: [\"/api/orders\"] });\n          queryClient.invalidateQueries({ queryKey: [\"/api/tables\"] });\n\n          // Dispatch events for real-time updates\n          if (typeof window !== 'undefined') {\n            const refreshEvents = [\n              new CustomEvent('orderStatusUpdated', {\n                detail: {\n                  orderId: data.orderId,\n                  status: 'paid',\n                  tableId: data.tableId,\n                  paymentMethod: data.originalPaymentMethod\n                }\n              }),\n              new CustomEvent('refreshTables'),\n              new CustomEvent('refreshOrders'),\n              new CustomEvent('paymentCompleted', {\n                detail: { orderId: data.orderId, tableId: data.tableId }\n              }),\n              new CustomEvent('tableStatusUpdate', {\n                detail: { tableId: data.tableId, checkForRelease: true }\n              })\n            ];\n\n            refreshEvents.forEach(event => {\n              window.dispatchEvent(event);\n            });\n          }\n        } else {\n          const errorText = await statusUpdateResponse.text();\n          console.error(\"❌ Order Management: Failed to update order status:\", errorText);\n          toast({\n            title: 'Lỗi',\n            description: 'Không thể cập nhật trạng thái đơn hàng',\n            variant: 'destructive',\n          });\n          return;\n        }\n      } catch (error) {\n        console.error(\"❌ Order Management: Error updating order status:\", error);\n        toast({\n          title: 'Lỗi',\n          description: 'Có lỗi xảy ra khi cập nhật trạng thái đơn hàng. Vui lòng thử lại.',\n          variant: 'destructive',\n        });\n        return;\n      }\n\n      // Save invoice data to database if needed\n      if (data.receipt) {\n        try {\n          const invoicePayload = {\n            customerName: data.customerName || \"Khách hàng lẻ\",\n            customerTaxCode: data.taxCode || \"\",\n            subtotal: data.receipt.subtotal,\n            tax: data.receipt.tax,\n            total: data.receipt.total,\n            paymentMethod: data.originalPaymentMethod === \"cash\" ? 1 : 2, // Assuming 1 for cash, 2 for others\n            invoiceDate: new Date(),\n            status: \"draft\",\n            einvoiceStatus: data.publishLater ? 0 : 1,\n            notes: `E-Invoice draft - MST: ${data.taxCode || \"N/A\"}, Template: ${data.template || \"N/A\"}, ${data.publishLater ? \"Đợi phát hành sau\" : \"Phát hành ngay\"}`,\n            items: data.receipt.items?.map((item: any) => ({\n              productId: item.productId || item.id,\n              productName: item.productName || item.name || `Product ${item.id}`,\n              quantity: item.quantity || 1,\n              unitPrice: (item.price || item.unitPrice || 0).toString(),\n              total: (parseFloat(item.total || \"0\") * 1.1).toFixed(2), // Add 10% tax\n              taxRate: (item.taxRate || 10).toString(),\n            })) || []\n          };\n\n          console.log(\"💾 Order Management: Saving invoice to database\");\n          const invoiceResponse = await fetch('/api/invoices', {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json',\n            },\n            body: JSON.stringify(invoicePayload),\n          });\n\n          if (invoiceResponse.ok) {\n            console.log(\"✅ Order Management: Invoice saved successfully\");\n          }\n        } catch (error) {\n          console.error(\"❌ Order Management: Failed to save invoice:\", error);\n        }\n      }\n\n      // Show receipt modal with the data\n      if (data.receipt) {\n        setSelectedReceipt(data.receipt);\n        setShowReceiptModal(true);\n      }\n    }\n\n    // Reset payment state\n    setShowPaymentMethodModal(false);\n    setOrderForPayment(null);\n  };\n\n  const getPaymentMethods = () => {\n    // Get payment methods from localStorage (saved from settings)\n    const savedPaymentMethods = localStorage.getItem('paymentMethods');\n\n    // Default payment methods if none saved\n    const defaultPaymentMethods = [\n      { id: 1, nameKey: \"cash\", type: \"cash\", enabled: true, icon: \"💵\" },\n      { id: 2, nameKey: \"creditCard\", type: \"card\", enabled: true, icon: \"💳\" },\n      { id: 3, nameKey: \"debitCard\", type: \"debit\", enabled: true, icon: \"💳\" },\n      { id: 4, nameKey: \"momo\", type: \"digital\", enabled: true, icon: \"📱\" },\n      { id: 5, nameKey: \"zalopay\", type: \"digital\", enabled: true, icon: \"📱\" },\n      { id: 6, nameKey: \"vnpay\", type: \"digital\", enabled: true, icon: \"💳\" },\n      { id: 7, nameKey: \"qrCode\", type: \"qr\", enabled: true, icon: \"📱\" },\n      { id: 8, nameKey: \"shopeepay\", type: \"digital\", enabled: false, icon: \"🛒\" },\n      { id: 9, nameKey: \"grabpay\", type: \"digital\", enabled: false, icon: \"🚗\" },\n    ];\n\n    const paymentMethods = savedPaymentMethods\n      ? JSON.parse(savedPaymentMethods)\n      : defaultPaymentMethods;\n\n    // Filter to only return enabled payment methods\n    return paymentMethods.filter(method => method.enabled);\n  };\n\n  const handlePayment = async (paymentMethodKey: string) => {\n    if (!selectedOrder) return;\n\n    const method = getPaymentMethods().find(m => m.nameKey === paymentMethodKey);\n    if (!method) return;\n\n    // If cash payment, proceed directly\n    if (paymentMethodKey === \"cash\") {\n      completePaymentMutation.mutate({ orderId: selectedOrder.id, paymentMethod: paymentMethodKey });\n      return;\n    }\n\n    // For QR Code payment, use CreateQRPos API\n    if (paymentMethodKey === \"qrCode\") {\n      try {\n        setQrLoading(true);\n        const { createQRPosAsync, CreateQRPosRequest } = await import(\"@/lib/api\");\n\n        const transactionUuid = `TXN-${Date.now()}`;\n        const depositAmt = Number(selectedOrder.total);\n\n        const qrRequest: CreateQRPosRequest = {\n          transactionUuid,\n          depositAmt: depositAmt,\n          posUniqueId: \"ER002\",\n          accntNo: \"0900993023\",\n          posfranchiseeName: \"DOOKI-HANOI\",\n          posCompanyName: \"HYOJUNG\",\n          posBillNo: `BILL-${Date.now()}`\n        };\n\n        const bankCode = \"79616001\";\n        const clientID = \"91a3a3668724e631e1baf4f8526524f3\";\n\n        console.log('Calling CreateQRPos API with:', { qrRequest, bankCode, clientID });\n\n        const qrResponse = await createQRPosAsync(qrRequest, bankCode, clientID);\n\n        console.log('CreateQRPos API response:', qrResponse);\n\n        // Generate QR code from the received QR data\n        if (qrResponse.qrData) {\n          // Use qrData directly for QR code generation\n          let qrContent = qrResponse.qrData;\n          try {\n            // Try to decode if it's base64 encoded\n            qrContent = atob(qrResponse.qrData);\n          } catch (e) {\n            // If decode fails, use the raw qrData\n            console.log('Using raw qrData as it is not base64 encoded');\n          }\n\n          const qrUrl = await QRCodeLib.toDataURL(qrContent, {\n            width: 256,\n            margin: 2,\n            color: {\n              dark: '#000000',\n              light: '#FFFFFF'\n            }\n          });\n          setQrCodeUrl(qrUrl);\n          setSelectedPaymentMethod({ key: paymentMethodKey, method });\n          setShowQRPayment(true);\n          setPaymentMethodsOpen(false);\n        } else {\n          console.error('No QR data received from API');\n          // Fallback to mock QR code\n          const fallbackData = `Payment via QR\\nAmount: ${selectedOrder.total.toLocaleString('vi-VN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} ₫\\nOrder: ${selectedOrder.orderNumber}\\nTime: ${new Date().toLocaleString('vi-VN')}`;\n          const qrUrl = await QRCodeLib.toDataURL(fallbackData, {\n            width: 256,\n            margin: 2,\n            color: {\n              dark: '#000000',\n              light: '#FFFFFF'\n            }\n          });\n          setQrCodeUrl(qrUrl);\n          setSelectedPaymentMethod({ key: paymentMethodKey, method });\n          setShowQRPayment(true);\n          setPaymentMethodsOpen(false);\n        }\n      } catch (error) {\n        console.error('Error calling CreateQRPos API:', error);\n        // Fallback to mock QR code on error\n        try {\n          const fallbackData = `Payment via QR\\nAmount: ${selectedOrder.total.toLocaleString('vi-VN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} ₫\\nOrder: ${selectedOrder.orderNumber}\\nTime: ${new Date().toLocaleString('vi-VN')}`;\n          const qrUrl = await QRCodeLib.toDataURL(fallbackData, {\n            width: 256,\n            margin: 2,\n            color: {\n              dark: '#000000',\n              light: '#FFFFFF'\n            }\n          });\n          setQrCodeUrl(qrUrl);\n          setSelectedPaymentMethod({ key: paymentMethodKey, method });\n          setShowQRPayment(true);\n          setPaymentMethodsOpen(false);\n        } catch (fallbackError) {\n          console.error('Error generating fallback QR code:', fallbackError);\n          toast({\n            title: 'Lỗi',\n            description: 'Không thể tạo mã QR',\n            variant: 'destructive',\n          });\n        }\n      } finally {\n        setQrLoading(false);\n      }\n      return;\n    }\n  };\n\n  const handleQRPaymentConfirm = () => {\n    if (selectedOrder && selectedPaymentMethod) {\n      // Check if this is a mixed payment (points + transfer/qr)\n      if (mixedPaymentData) {\n        // Use mixed payment mutation to handle both points deduction and payment\n        mixedPaymentMutation.mutate({\n          customerId: mixedPaymentData.customerId,\n          points: mixedPaymentData.pointsToUse,\n          orderId: mixedPaymentData.orderId,\n          paymentMethod: selectedPaymentMethod.key === 'transfer' ? 'transfer' : selectedPaymentMethod.key\n        });\n      } else {\n        // Regular payment without points\n        completePaymentMutation.mutate({\n          orderId: selectedOrder.id,\n          paymentMethod: selectedPaymentMethod.key\n        });\n      }\n      setShowQRPayment(false);\n      setQrCodeUrl(\"\");\n      setSelectedPaymentMethod(null);\n    }\n  };\n\n  const handleQRPaymentClose = () => {\n    setShowQRPayment(false);\n    setQrCodeUrl(\"\");\n    setSelectedPaymentMethod(null);\n    setPaymentMethodsOpen(true);\n  };\n\n  const handlePointsPayment = () => {\n    if (!selectedCustomer || !selectedOrder) {\n      toast({\n        title: 'Lỗi',\n        description: 'Vui lòng chọn khách hàng',\n        variant: 'destructive',\n      });\n      return;\n    }\n\n    const currentPoints = selectedCustomer.points || 0;\n    const orderTotal = Number(selectedOrder.total);\n    const pointsValue = currentPoints * 1000; // 1 điểm = 1000đ\n\n    if (pointsValue >= orderTotal) {\n      // Đủ điểm để thanh toán toàn bộ\n      const pointsNeeded = Math.ceil(orderTotal / 1000);\n      pointsPaymentMutation.mutate({\n        customerId: selectedCustomer.id,\n        points: pointsNeeded,\n        orderId: selectedOrder.id,\n        paymentMethod: 'points',\n        remainingAmount: 0\n      });\n    } else {\n      // Không đủ điểm, cần thanh toán hỗn hợp\n      const remainingAmount = orderTotal - pointsValue;\n      setMixedPaymentData({\n        customerId: selectedCustomer.id,\n        pointsToUse: currentPoints,\n        remainingAmount: remainingAmount,\n        orderId: selectedOrder.id\n      });\n      setPointsPaymentOpen(false);\n      setMixedPaymentOpen(true);\n    }\n  };\n\n  const filteredCustomers = customers?.filter(customer => {\n    const searchLower = searchTerm.toLowerCase();\n    return customer.name?.toLowerCase().includes(searchLower) ||\n           customer.customerId?.toLowerCase().includes(searchLower) ||\n           customer.phone?.toLowerCase().includes(searchLower);\n  }) || [];\n\n  if (ordersLoading) {\n    return (\n      <div className=\"flex items-center justify-center py-8\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full\" />\n      </div>\n    );\n  }\n\n  const allOrders = orders ? (orders as Order[]).sort((a: Order, b: Order) =>\n    new Date(b.orderedAt).getTime() - new Date(a.orderedAt).getTime()\n  ) : [];\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h2 className=\"text-2xl font-bold text-gray-900\">{t('orders.orderManagement')}</h2>\n          <p className=\"text-gray-600\">{t('orders.realTimeOrderStatus')}</p>\n        </div>\n        <Badge variant=\"secondary\" className=\"text-lg px-4 py-2\">\n          {allOrders.length} {t('orders.ordersInProgress')}\n        </Badge>\n      </div>\n\n      {/* Orders Grid */}\n      {allOrders.length === 0 ? (\n        <Card>\n          <CardContent className=\"py-12 text-center\">\n            <Clock className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">{t('orders.noActiveOrders')}</h3>\n            <p className=\"text-gray-600\">{t('orders.newOrdersWillAppearHere')}</p>\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n          {allOrders.map((order: Order) => {\n            const statusConfig = getOrderStatusBadge(order.status);\n            const tableInfo = getTableInfo(order.tableId);\n\n            return (\n              <Card key={order.id} className=\"hover:shadow-lg transition-shadow\">\n                <CardHeader className=\"pb-3\">\n                  <div className=\"flex justify-between items-start\">\n                    <div>\n                      <CardTitle className=\"text-lg font-medium\">\n                        {order.orderNumber}\n                      </CardTitle>\n                      <p className=\"text-sm text-gray-600 mt-1\">\n                        {tableInfo?.tableNumber || t('orders.noTableInfo')}\n                      </p>\n                    </div>\n                    <Badge variant={statusConfig.variant}>\n                      {statusConfig.label}\n                    </Badge>\n                  </div>\n                </CardHeader>\n\n                <CardContent>\n                  <div className=\"space-y-3\">\n                    {/* Order Info */}\n                    <div className=\"flex items-center justify-between text-sm\">\n                      <div className=\"flex items-center text-gray-600\">\n                        <Users className=\"w-4 h-4 mr-1\" />\n                        {order.customerCount || 1} {t('orders.people')}\n                      </div>\n                      <div className=\"flex items-center text-gray-600\">\n                        <Clock className=\"w-4 h-4 mr-1\" />\n                        {formatTime(order.orderedAt)}\n                      </div>\n                    </div>\n\n                    {/* Total Amount */}\n                    <div className=\"flex items-center justify-between\">\n                      <span className=\"text-sm text-gray-600\">{t('orders.totalAmount')}:</span>\n                      <span className=\"text-lg font-bold text-green-600\">\n                        {formatCurrency(Number(order.total))}\n                      </span>\n                    </div>\n\n                    {/* Customer Info */}\n                    {order.customerName && (\n                      <div className=\"text-sm\">\n                        <span className=\"text-gray-600\">{t('orders.customer')}: </span>\n                        <span className=\"font-medium\">{order.customerName}</span>\n                      </div>\n                    )}\n\n                    {/* Action Buttons */}\n                    <div className=\"flex gap-2 pt-2\">\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => handleViewOrder(order)}\n                        className=\"flex-1\"\n                      >\n                        <Eye className=\"w-3 h-3 mr-1\" />\n                        {t('orders.viewDetails')}\n                      </Button>\n\n                      {order.status === 'pending' && (\n                        <Button\n                          size=\"sm\"\n                          onClick={() => {\n                            console.log('🎯 CONFIRM button clicked for order:', {\n                              orderId: order.id,\n                              orderNumber: order.orderNumber,\n                              currentStatus: order.status,\n                              newStatus: 'confirmed'\n                            });\n                            handleStatusUpdate(order.id, 'confirmed');\n                          }}\n                          className=\"flex-1\"\n                        >\n                          {t('orders.confirm')}\n                        </Button>\n                      )}\n\n                      {order.status === 'confirmed' && (\n                        <Button\n                          size=\"sm\"\n                          onClick={() => {\n                            console.log('🎯 START COOKING button clicked for order:', {\n                              orderId: order.id,\n                              orderNumber: order.orderNumber,\n                              currentStatus: order.status,\n                              newStatus: 'preparing'\n                            });\n                            handleStatusUpdate(order.id, 'preparing');\n                          }}\n                          className=\"flex-1\"\n                        >\n                          {t('orders.startCooking')}\n                        </Button>\n                      )}\n\n                      {order.status === 'preparing' && (\n                        <Button\n                          size=\"sm\"\n                          onClick={() => {\n                            console.log('🎯 READY button clicked for order:', {\n                              orderId: order.id,\n                              orderNumber: order.orderNumber,\n                              currentStatus: order.status,\n                              newStatus: 'ready'\n                            });\n                            handleStatusUpdate(order.id, 'ready');\n                          }}\n                          className=\"flex-1\"\n                        >\n                          {t('orders.ready')}\n                        </Button>\n                      )}\n\n                      {order.status === 'ready' && (\n                        <Button\n                          size=\"sm\"\n                          onClick={() => {\n                            console.log('🎯 SERVED button clicked for order:', {\n                              orderId: order.id,\n                              orderNumber: order.orderNumber,\n                              currentStatus: order.status,\n                              newStatus: 'served'\n                            });\n                            handleStatusUpdate(order.id, 'served');\n                          }}\n                          className=\"flex-1\"\n                        >\n                          {t('orders.served')}\n                        </Button>\n                      )}\n\n                      {order.status === 'served' && (\n                        <Button\n                          size=\"sm\"\n                          onClick={() => handlePaymentClick(order)}\n                          className=\"flex-1 bg-green-600 hover:bg-green-700\"\n                        >\n                          <CreditCard className=\"w-3 h-3 mr-1\" />\n                          {t('orders.payment')}\n                        </Button>\n                      )}\n\n                      {(order.status === 'paid' || order.status === 'cancelled') && (\n                        <Badge variant=\"outline\" className=\"flex-1 justify-center\">\n                          {order.status === 'paid' ? t('orders.status.completed') : t('orders.status.cancelled')}\n                        </Badge>\n                      )}\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            );\n          })}\n        </div>\n      )}\n\n      {/* Order Details Dialog */}\n      <Dialog open={orderDetailsOpen} onOpenChange={setOrderDetailsOpen}>\n        <DialogContent className=\"max-w-2xl max-h-[80vh]\">\n          <DialogHeader>\n            <DialogTitle>{t('orders.orderDetails')}</DialogTitle>\n            <DialogDescription>\n              {selectedOrder && `${t('orders.orderNumber')}: ${selectedOrder.orderNumber}`}\n            </DialogDescription>\n          </DialogHeader>\n\n          {selectedOrder && (\n            <ScrollArea className=\"max-h-[60vh]\">\n              <div className=\"space-y-4\">\n                {/* Order Info */}\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <h4 className=\"font-medium mb-2\">{t('orders.orderInfo')}</h4>\n                    <div className=\"space-y-1 text-sm\">\n                      <div className=\"flex justify-between\">\n                        <span>{t('orders.orderNumber')}:</span>\n                        <span className=\"font-medium\">{selectedOrder.orderNumber}</span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span>{t('orders.table')}:</span>\n                        <span className=\"font-medium\">\n                          {getTableInfo(selectedOrder.tableId)?.tableNumber || t('orders.unknownTable')}\n                        </span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span>{t('orders.customer')}:</span>\n                        <span className=\"font-medium\">\n                          {selectedOrder.customerName || t('orders.noCustomerName')}\n                        </span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span>{t('orders.customerCount')}:</span>\n                        <span className=\"font-medium\">{selectedOrder.customerCount || 1} {t('orders.people')}</span>\n                      </div>\n                    </div>\n                  </div>\n\n                  <div>\n                    <h4 className=\"font-medium mb-2\">{t('orders.statusAndTime')}</h4>\n                    <div className=\"space-y-1 text-sm\">\n                      <div className=\"flex justify-between items-center\">\n                        <span>{t('orders.orderStatus')}:</span>\n                        <Badge variant={getOrderStatusBadge(selectedOrder.status).variant}>\n                          {getOrderStatusBadge(selectedOrder.status).label}\n                        </Badge>\n                      </div>\n                      <div className=\"flex justify-between items-center\">\n                        <span>{t('common.einvoiceStatus')}</span>\n                        <Badge variant={\n                          selectedOrder.einvoiceStatus === 1 ? \"default\" :\n                          selectedOrder.einvoiceStatus === 2 ? \"destructive\" :\n                          \"secondary\"\n                        }>\n                          {(() => {\n                            console.log('🔍 Order Management: E-invoice status for order', selectedOrder.id, ':', {\n                              einvoiceStatus: selectedOrder.einvoiceStatus,\n                              type: typeof selectedOrder.einvoiceStatus\n                            });\n\n                            if (selectedOrder.einvoiceStatus === 1) return \"Đã phát hành\";\n                            if (selectedOrder.einvoiceStatus === 2) return \"Lỗi phát hành\";\n                            return \"Chưa phát hành\";\n                          })()}\n                        </Badge>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span>{t('orders.orderTime')}:</span>\n                        <span className=\"font-medium\">\n                          {formatTime(selectedOrder.orderedAt)}\n                        </span>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n\n                <Separator />\n\n                {/* Order Items */}\n                <div>\n                  <h4 className=\"font-medium mb-3\">{t('orders.orderItems')}</h4>\n                  <div className=\"space-y-2\">\n                    {orderItemsLoading ? (\n                      <div className=\"text-center py-4 text-gray-500\">\n                        {t('common.loading')}...\n                      </div>\n                    ) : orderItems && orderItems.length > 0 ? (\n                      orderItems.map((item: any, index: number) => {\n                        const product = getProductInfo(item.productId);\n                        return (\n                          <div key={item.id} className=\"flex justify-between items-center p-3 bg-white border rounded-lg\">\n                            <div className=\"flex-1\">\n                              <div className=\"flex items-center gap-2\">\n                                <span className=\"text-sm font-medium text-gray-900\">\n                                  {product?.name || 'Unknown Product'}\n                                </span>\n                                <span className=\"text-xs text-gray-500\">\n                                  x{item.quantity}\n                                </span>\n                              </div>\n                              <div className=\"text-xs text-gray-600 mt-1\">\n                                {formatCurrency(Number(item.unitPrice || 0))}/món\n                              </div>\n                              {(() => {\n                                // Calculate tax based on afterTaxPrice if available, otherwise use taxRate\n                                if (product?.afterTaxPrice && product.afterTaxPrice !== null && product.afterTaxPrice !== \"\") {\n                                  const afterTaxPrice = parseFloat(product.afterTaxPrice);\n                                  const price = parseFloat(product.price);\n                                  const itemTax = (afterTaxPrice - price) * Number(item.quantity || 0);\n                                  return (\n                                    <div className=\"text-xs text-green-600\">\n                                      Thuế: {formatCurrency(itemTax)}\n                                    </div>\n                                  );\n                                } else {\n                                  return (\n                                    <div className=\"text-xs text-gray-500\">\n                                      Thuế: {formatCurrency(0)}\n                                    </div>\n                                  );\n                                }\n                              })()}\n                              {item.notes && (\n                                <div className=\"text-xs text-blue-600 italic mt-1\">\n                                  Ghi chú: {item.notes}\n                                </div>\n                              )}\n                            </div>\n                            <div className=\"text-right\">\n                              <div className=\"font-bold text-green-600\">\n                                {formatCurrency(Number(item.total || 0))}\n                              </div>\n                            </div>\n                          </div>\n                        );\n                      })\n                    ) : (\n                      <div className=\"text-center py-4 text-gray-500\">\n                        {t('orders.noActiveOrders')}\n                      </div>\n                    )}\n                  </div>\n                </div>\n\n                <Separator />\n\n                {/* Order Summary */}\n                <div className=\"bg-gray-50 p-4 rounded-lg\">\n                  <h4 className=\"font-medium mb-2\">{t('orders.totalAmount')}</h4>\n                  <div className=\"space-y-1 text-sm\">\n                    {(() => {\n                      // Use EXACT same calculation logic as displayed in Order Details\n                      let orderDetailsSubtotal = 0;\n                      let orderDetailsTax = 0;\n\n                      if (Array.isArray(orderItems) && Array.isArray(products)) {\n                        orderItems.forEach((item: any) => {\n                          const basePrice = Number(item.unitPrice || 0);\n                          const quantity = Number(item.quantity || 0);\n                          const product = products.find((p: any) => p.id === item.productId);\n\n                          // Calculate subtotal exactly as Order Details display\n                          orderDetailsSubtotal += basePrice * quantity;\n\n                          // Tax = (after_tax_price - price) * quantity\n                          if (product?.afterTaxPrice && product.afterTaxPrice !== null && product.afterTaxPrice !== \"\") {\n                            const afterTaxPrice = parseFloat(product.afterTaxPrice);\n                            const price = parseFloat(product.price);\n                            orderDetailsTax += (afterTaxPrice - price) * quantity;\n                          }\n                        });\n                      }\n\n                      const finalTotal = orderDetailsSubtotal + orderDetailsTax;\n\n                      return (\n                        <>\n                          <div className=\"flex justify-between\">\n                            <span>{t('common.subtotalLabel')}</span>\n                            <span>{formatCurrency(orderDetailsSubtotal)}</span>\n                          </div>\n                          <div className=\"flex justify-between\">\n                            <span>{t('orders.tax')}</span>\n                            <span>{formatCurrency(orderDetailsTax)}</span>\n                          </div>\n                          <Separator />\n                          <div className=\"flex justify-between font-medium\">\n                            <span>{t('orders.totalAmount')}:</span>\n                            <span>{formatCurrency(finalTotal)}</span>\n                          </div>\n                        </>\n                      );\n                    })()}\n                  </div>\n                </div>\n\n                {/* Status Update Actions */}\n                {selectedOrder.status !== 'paid' && selectedOrder.status !== 'cancelled' && (\n                  <div className=\"flex gap-2 pt-4\">\n                    <Button\n                      onClick={() => {\n                        console.log('🎯 Order Management: Starting payment flow - showing receipt preview first');\n\n                        if (!selectedOrder || !orderItems || !Array.isArray(orderItems)) {\n                          console.error('❌ Missing order data for preview');\n                          toast({\n                            title: 'Lỗi',\n                            description: 'Không thể tạo xem trước hóa đơn. Vui lòng thử lại.',\n                            variant: 'destructive',\n                          });\n                          return;\n                        }\n\n                        // Use EXACT same calculation logic as Order Details display\n                        let orderDetailsSubtotal = 0;\n                        let orderDetailsTax = 0;\n\n                        const processedItems = Array.isArray(orderItems) ? orderItems.map((item: any) => {\n                          const basePrice = Number(item.unitPrice || 0);\n                          const quantity = Number(item.quantity || 0);\n                          const product = Array.isArray(products) ? products.find((p: any) => p.id === item.productId) : null;\n\n                          // Calculate subtotal exactly as Order Details display\n                          const itemSubtotal = basePrice * quantity;\n                          orderDetailsSubtotal += itemSubtotal;\n\n                          // Tax = (after_tax_price - price) * quantity\n                          let itemTax = 0;\n                          if (product?.afterTaxPrice && product.afterTaxPrice !== null && product.afterTaxPrice !== \"\") {\n                            const afterTaxPrice = parseFloat(product.afterTaxPrice);\n                            const price = parseFloat(product.price);\n                            itemTax = (afterTaxPrice - price) * quantity;\n                            orderDetailsTax += itemTax;\n                          }\n\n                          return {\n                            id: item.id,\n                            productId: item.productId,\n                            productName: item.productName || getProductInfo(item.productId)?.name || 'Unknown Product',\n                            quantity: item.quantity,\n                            price: item.unitPrice,\n                            total: item.total,\n                            sku: item.productSku || `SP${item.productId}`,\n                            taxRate: product?.taxRate ? parseFloat(product.taxRate) : 10\n                          };\n                        }) : [];\n\n                        const finalTotal = orderDetailsSubtotal + orderDetailsTax;\n\n                        // Create preview receipt data using EXACT values from Order Details\n                        const previewData = {\n                          ...selectedOrder,\n                          transactionId: `PREVIEW-${Date.now()}`,\n                          items: processedItems,\n                          subtotal: orderDetailsSubtotal.toFixed(2),\n                          tax: orderDetailsTax.toFixed(2),\n                          total: finalTotal.toFixed(2),\n                          // Add exact values to ensure proper display\n                          exactSubtotal: orderDetailsSubtotal,\n                          exactTax: orderDetailsTax,\n                          exactTotal: finalTotal,\n                          paymentMethod: 'preview', // Special flag for preview mode\n                          cashierName: 'Order Management',\n                          createdAt: new Date().toISOString(),\n                          orderItems: orderItems // Keep original order items for payment flow\n                        };\n\n                        console.log('📄 Order Management: Showing receipt preview before payment');\n                        console.log('💰 Exact values passed:', {\n                          subtotal: orderDetailsSubtotal,\n                          tax: orderDetailsTax,\n                          total: finalTotal,\n                        });\n\n                        // Store the complete order data with proper field mapping for payment flow\n                        const completeOrderForPayment = {\n                          ...selectedOrder,\n                          orderItems: orderItems || [],\n                          calculatedSubtotal: orderDetailsSubtotal,\n                          calculatedTax: orderDetailsTax,\n                          calculatedTotal: finalTotal,\n                          processedItems: processedItems\n                        };\n\n                        console.log('💾 Order Management: Storing complete order data for payment:', {\n                          orderId: selectedOrder.id,\n                          calculatedSubtotal: orderDetailsSubtotal,\n                          calculatedTax: orderDetailsTax,\n                          calculatedTotal: finalTotal,\n                          processedItemsCount: processedItems.length\n                        });\n\n                        setOrderForPayment(completeOrderForPayment);\n                        setPreviewReceipt(previewData);\n                        setOrderDetailsOpen(false);\n                        setShowReceiptPreview(true);\n                      }}\n                      disabled={completePaymentMutation.isPending}\n                      className=\"flex-1 bg-green-600 hover:bg-green-700\"\n                    >\n                      <CreditCard className=\"w-4 h-4 mr-2\" />\n                      {t('orders.payment')}\n                    </Button>\n                    <Button\n                      onClick={() => setPointsPaymentOpen(true)}\n                      disabled={completePaymentMutation.isPending}\n                      className=\"flex-1 bg-blue-600 hover:bg-blue-700\"\n                    >\n                      <CreditCard className=\"w-4 h-4 mr-2\" />\n                      {t('customers.pointManagement')}\n                    </Button>\n                  </div>\n                )}\n\n                {/* Final Status Display */}\n                {(selectedOrder.status === 'paid' || selectedOrder.status === 'cancelled') && (\n                  <div className=\"flex justify-center pt-4\">\n                    {selectedOrder.status === 'paid' && (\n                      <Badge variant=\"outline\" className=\"px-4 py-2 bg-green-100 text-green-800 border-green-300\">\n                        ✅ {t('orders.status.completed')}\n                      </Badge>\n                    )}\n                    {selectedOrder.status === 'cancelled' && (\n                      <Badge variant=\"destructive\" className=\"px-4 py-2\">\n                        ❌ {t('orders.status.cancelled')}\n                      </Badge>\n                    )}\n                  </div>\n                )}\n              </div>\n            </ScrollArea>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/* Payment Method Modal */}\n      <PaymentMethodModal\n        isOpen={paymentModalOpen}\n        onClose={() => {\n          setPaymentModalOpen(false);\n          setOrderForPayment(null);\n        }}\n        onSelectMethod={handlePaymentMethodSelect}\n        total={orderForPayment?.total || 0}\n      />\n\n      {/* Payment Methods Dialog */}\n      <Dialog open={paymentMethodsOpen} onOpenChange={setPaymentMethodsOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>{t('orders.selectPaymentMethod')}</DialogTitle>\n            <DialogDescription>\n              {t('orders.selectPaymentMethodDesc')}\n            </DialogDescription>\n          </DialogHeader>\n\n          <div className=\"grid grid-cols-1 gap-3\">\n            {getPaymentMethods().map((method) => (\n              <Button\n                key={method.id}\n                variant=\"outline\"\n                className=\"justify-start h-auto p-4\"\n                onClick={() => handlePayment(method.nameKey)}\n                disabled={completePaymentMutation.isPending || (qrLoading && method.nameKey === 'qrCode')}\n              >\n                <span className=\"text-2xl mr-3\">{method.icon}</span>\n                <div className=\"text-left\">\n                  <p className=\"font-medium\">\n                    {qrLoading && method.nameKey === 'qrCode' ? t('common.generatingQr') : t(`orders.paymentMethods.${method.nameKey}`)}\n                  </p>\n                </div>\n                {qrLoading && method.nameKey === 'qrCode' && (\n                  <div className=\"ml-auto\">\n                    <div className=\"animate-spin w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full\" />\n                  </div>\n                )}\n              </Button>\n            ))}\n          </div>\n\n          <div className=\"flex justify-end gap-2 pt-4\">\n            <Button variant=\"outline\" onClick={() => setPaymentMethodsOpen(false)}>\n              {t('orders.cancel')}\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* QR Payment Dialog */}\n      <Dialog open={showQRPayment} onOpenChange={setShowQRPayment}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader className=\"relative\">\n            <DialogTitle className=\"flex items-center gap-2 text-center justify-center\">\n              <QrCode className=\"w-5 h-5\" />\n              Thanh toán {selectedPaymentMethod?.method?.name}\n            </DialogTitle>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={handleQRPaymentClose}\n              className=\"absolute right-0 top-0 h-6 w-6 p-0\"\n            >\n              ✕\n            </Button>\n            <DialogDescription className=\"text-center\">\n              Quét mã QR để hoàn tất thanh toán\n            </DialogDescription>\n          </DialogHeader>\n\n          <div className=\"space-y-4 p-4\">\n            {/* Order Summary */}\n            {selectedOrder && (\n              <div className=\"text-center space-y-2\">\n                <p className=\"text-sm text-gray-600\">{t('orders.orderNumber')}: {selectedOrder.orderNumber}</p>\n                <p className=\"text-sm text-gray-600\">Số tiền cần thanh toán:</p>\n                <p className=\"text-3xl font-bold text-green-600\">\n                  {mixedPaymentData ?\n                    formatCurrency(mixedPaymentData.remainingAmount) :\n                    formatCurrency(Number(selectedOrder.total))\n                  }\n                </p>\n                {mixedPaymentData && (\n                  <p className=\"text-sm text-blue-600\">\n                    Đã sử dụng {mixedPaymentData.pointsToUse.toLocaleString()}P (-{(mixedPaymentData.pointsToUse * 1000).toLocaleString('vi-VN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} ₫)\n                  </p>\n                )}\n              </div>\n            )}\n\n            {/* QR Code */}\n            {qrCodeUrl && (\n              <div className=\"flex justify-center\">\n                <div className=\"bg-white p-4 rounded-lg border-2 border-gray-200 shadow-lg\">\n                  <img\n                    src={qrCodeUrl}\n                    alt=\"QR Code for Payment\"\n                    className=\"w-64 h-64\"\n                  />\n                </div>\n              </div>\n            )}\n\n            <p className=\"text-sm text-gray-600 text-center\">\n              Sử dụng ứng dụng {selectedPaymentMethod?.method?.name} để quét mã QR và thực hiện thanh toán\n            </p>\n\n            {/* Action Buttons */}\n            <div className=\"flex gap-3\">\n              <Button\n                variant=\"outline\"\n                onClick={handleQRPaymentClose}\n                className=\"flex-1\"\n              >\n                Quay lại\n              </Button>\n              <Button\n                onClick={handleQRPaymentConfirm}\n                className=\"flex-1 bg-green-600 hover:bg-green-700 text-white transition-colors duration-200\"\n              >\n                Xác nhận thanh toán\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Points Payment Dialog */}\n      <Dialog open={pointsPaymentOpen} onOpenChange={setPointsPaymentOpen}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <CreditCard className=\"w-5 h-5 text-blue-600\" />\n              {t('orders.pointsPaymentTitle')}\n            </DialogTitle>\n            <DialogDescription>\n              {t('orders.pointsPaymentDesc')}\n            </DialogDescription>\n          </DialogHeader>\n\n          <div className=\"space-y-6\">\n            {/* Order Summary */}\n            {selectedOrder && (\n              <div className=\"p-4 bg-blue-50 rounded-lg\">\n                <p className=\"text-sm text-gray-600\">{t('orders.orderNumber')}: {selectedOrder.orderNumber}</p>\n                <p className=\"text-2xl font-bold text-blue-600\">\n                  {formatCurrency(Number(selectedOrder.total))}\n                </p>\n                {selectedCustomer && (\n                  <div className=\"mt-2 pt-2 border-t border-blue-200\">\n                    <p className=\"text-sm text-gray-600\">\n                      Điểm có sẵn: {(selectedCustomer.points || 0).toLocaleString()}P\n                      <span className=\"ml-2 text-green-600\">\n                        (≈ {((selectedCustomer.points || 0) * 1000).toLocaleString()} ₫)\n                      </span>\n                    </p>\n                    {((selectedCustomer.points || 0) * 1000) < Number(selectedOrder.total) && (\n                      <p className=\"text-sm text-orange-600 mt-1\">\n                        Cần thanh toán thêm: {(Number(selectedOrder.total) - (selectedCustomer.points || 0) * 1000).toLocaleString()} ₫\n                      </p>\n                    )}\n                  </div>\n                )}\n              </div>\n            )}\n\n            {/* Customer Search */}\n            <div className=\"space-y-3\">\n              <Label>{t('orders.searchCustomers')}</Label>\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-3 h-4 w-4 text-gray-400\" />\n                <Input\n                  placeholder={t('customers.searchPlaceholder')}\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                  className=\"pl-9\"\n                />\n              </div>\n\n              {/* Customer List */}\n              <div className=\"max-h-64 overflow-y-auto border rounded-md\">\n                {filteredCustomers.map((customer) => (\n                  <div\n                    key={customer.id}\n                    className={`p-3 cursor-pointer hover:bg-gray-50 border-b ${\n                      selectedCustomer?.id === customer.id ? 'bg-blue-50 border-blue-200' : ''\n                    }`}\n                    onClick={() => setSelectedCustomer(customer)}\n                  >\n                    <div className=\"flex justify-between items-center\">\n                      <div>\n                        <p className=\"font-medium\">{customer.name}</p>\n                        <p className=\"text-sm text-gray-500\">{customer.customerId}</p>\n                      </div>\n                      <div className=\"text-right\">\n                        <p className=\"font-medium text-green-600\">\n                          {(customer.points || 0).toLocaleString()}P\n                        </p>\n                        <p className=\"text-xs text-gray-500\">{t('orders.availablePoints')}</p>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n                {filteredCustomers.length === 0 && (\n                  <div className=\"p-8 text-center text-gray-500\">\n                    Không tìm thấy khách hàng\n                  </div>\n                )}\n              </div>\n            </div>\n\n            {/* Payment Explanation */}\n            {selectedCustomer && selectedOrder && (\n              <div className=\"space-y-3\">\n                <div className=\"p-4 bg-gray-50 rounded-lg\">\n                  <h4 className=\"font-medium mb-2\">Chi tiết thanh toán</h4>\n                  {((selectedCustomer.points || 0) * 1000) >= Number(selectedOrder.total) ? (\n                    <div className=\"text-green-600\">\n                      <p className=\"text-sm\">✓ Đủ điểm để thanh toán toàn bộ đơn hàng</p>\n                      <p className=\"text-sm\">\n                        Sử dụng: {Math.ceil(Number(selectedOrder.total) / 1000).toLocaleString()}P\n                      </p>\n                      <p className=\"text-sm\">\n                        Còn lại: {((selectedCustomer.points || 0) - Math.ceil(Number(selectedOrder.total) / 1000)).toLocaleString()}P\n                      </p>\n                    </div>\n                  ) : (\n                    <div className=\"text-orange-600\">\n                      <p className=\"text-sm\">⚠ Không đủ điểm, cần thanh toán hỗn hợp</p>\n                      <p className=\"text-sm\">\n                        Sử dụng tất cả: {(selectedCustomer.points || 0).toLocaleString()}P\n                        (≈ {((selectedCustomer.points || 0) * 1000).toLocaleString()} ₫)\n                      </p>\n                      <p className=\"text-sm\">\n                        Cần thanh toán thêm: {(Number(selectedOrder.total) - (selectedCustomer.points || 0) * 1000).toLocaleString()} ₫\n                      </p>\n                    </div>\n                  )}\n                </div>\n              </div>\n            )}\n          </div>\n\n          <div className=\"flex justify-end gap-2 pt-4\">\n            <Button variant=\"outline\" onClick={() => setPointsPaymentOpen(false)}>\n              Hủy\n            </Button>\n            <Button\n              onClick={handlePointsPayment}\n              disabled={\n                !selectedCustomer ||\n                pointsPaymentMutation.isPending ||\n                (selectedCustomer.points || 0) === 0\n              }\n              className=\"bg-blue-600 hover:bg-blue-700\"\n            >\n              {pointsPaymentMutation.isPending ? 'Đang xử lý...' :\n               ((selectedCustomer?.points || 0) * 1000) >= Number(selectedOrder?.total || 0) ?\n               'Thanh toán bằng điểm' : 'Thanh toán hỗn hợp'}\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Mixed Payment Dialog */}\n      <Dialog open={mixedPaymentOpen} onOpenChange={setMixedPaymentOpen}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <CreditCard className=\"w-5 h-5 text-orange-600\" />\n              {t('orders.mixedPaymentTitle')}\n            </DialogTitle>\n            <DialogDescription>\n              {t('orders.mixedPaymentDesc')}\n            </DialogDescription>\n          </DialogHeader>\n\n          {mixedPaymentData && (\n            <div className=\"space-y-4\">\n              {/* Payment Summary */}\n              <div className=\"p-4 bg-gray-50 rounded-lg\">\n                <h4 className=\"font-medium mb-2\">Tóm tắt thanh toán</h4>\n                <div className=\"space-y-2 text-sm\">\n                  <div className=\"flex justify-between\">\n                    <span>Tổng đơn hàng:</span>\n                    <span className=\"font-medium\">{Number(selectedOrder?.total || 0).toLocaleString()} ₫</span>\n                  </div>\n                  <div className=\"flex justify-between text-blue-600\">\n                    <span>Thanh toán bằng điểm:</span>\n                    <span className=\"font-medium\">\n                      {mixedPaymentData.pointsToUse.toLocaleString()}P\n                      <span className=\"ml-1\">(-{(mixedPaymentData.pointsToUse * 1000).toLocaleString()} ₫)</span>\n                    </span>\n                  </div>\n                  <div className=\"border-t pt-2 flex justify-between font-medium text-orange-600\">\n                    <span>Cần thanh toán thêm:</span>\n                    <span>{mixedPaymentData.remainingAmount.toLocaleString()} ₫</span>\n                  </div>\n                </div>\n              </div>\n\n              {/* Payment Methods */}\n              <div className=\"space-y-3\">\n                <h4 className=\"font-medium\">Chọn phương thức thanh toán cho phần còn lại:</h4>\n                <div className=\"grid grid-cols-1 gap-2\">\n                  <Button\n                    variant=\"outline\"\n                    className=\"justify-start h-auto p-4\"\n                    onClick={() => mixedPaymentMutation.mutate({\n                      customerId: mixedPaymentData.customerId,\n                      points: mixedPaymentData.pointsToUse,\n                      orderId: mixedPaymentData.orderId,\n                      paymentMethod: 'cash'\n                    })}\n                    disabled={mixedPaymentMutation.isPending}\n                  >\n                    <span className=\"text-2xl mr-3\">💵</span>\n                    <div className=\"text-left\">\n                      <p className=\"font-medium\">{t('common.cash')}</p>\n                      <p className=\"text-sm text-gray-500\">{mixedPaymentData.remainingAmount.toLocaleString()} ₫</p>\n                    </div>\n                  </Button>\n\n                  <Button\n                    variant=\"outline\"\n                    className=\"justify-start h-auto p-4\"\n                    onClick={async () => {\n                      // Use CreateQRPos API for transfer payment like QR Code\n                      try {\n                        setQrLoading(true);\n                        const { createQRPosAsync } = await import(\"@/lib/api\");\n                        const { CreateQRPosRequest } = await import(\"@/lib/api\");\n\n                        const transactionUuid = `TXN-TRANSFER-${Date.now()}`;\n                        const depositAmt = Number(mixedPaymentData.remainingAmount);\n\n                        const qrRequest: CreateQRPosRequest = {\n                          transactionUuid,\n                          depositAmt: depositAmt,\n                          posUniqueId: \"ER002\",\n                          accntNo: \"0900993023\",\n                          posfranchiseeName: \"DOOKI-HANOI\",\n                          posCompanyName: \"HYOJUNG\",\n                          posBillNo: `TRANSFER-${Date.now()}`\n                        };\n\n                        const bankCode = \"79616001\";\n                        const clientID = \"91a3a3668724e631e1baf4f8526524f3\";\n\n                        console.log('Calling CreateQRPos API for transfer payment:', { qrRequest, bankCode, clientID });\n\n                        const qrResponse = await createQRPosAsync(qrRequest, bankCode, clientID);\n\n                        console.log('CreateQRPos API response for transfer:', qrResponse);\n\n                        // Generate QR code from the received QR data and show QR modal\n                        if (qrResponse.qrData) {\n                          let qrContent = qrResponse.qrData;\n                          try {\n                            // Try to decode if it's base64 encoded\n                            qrContent = atob(qrResponse.qrData);\n                          } catch (e) {\n                            // If decode fails, use the raw qrData\n                            console.log('Using raw qrData for transfer as it is not base64 encoded');\n                          }\n\n                          const qrUrl = await QRCodeLib.toDataURL(qrContent, {\n                            width: 256,\n                            margin: 2,\n                            color: {\n                              dark: '#000000',\n                              light: '#FFFFFF'\n                            }\n                          });\n\n                          // Set QR code data and show QR payment modal\n                          setQrCodeUrl(qrUrl);\n                          setSelectedPaymentMethod({\n                            key: 'transfer',\n                            method: { name: 'Chuyển khoản', icon: '💳' }\n                          });\n                          setShowQRPayment(true);\n                          setMixedPaymentOpen(false);\n                        } else {\n                          console.error('No QR data received from API for transfer');\n                          // Fallback to direct payment\n                          mixedPaymentMutation.mutate({\n                            customerId: mixedPaymentData.customerId,\n                            points: mixedPaymentData.pointsToUse,\n                            orderId: mixedPaymentData.orderId,\n                            paymentMethod: 'transfer'\n                          });\n                        }\n                      } catch (error) {\n                        console.error('Error calling CreateQRPos API for transfer:', error);\n                        // Fallback to direct payment on error\n                        mixedPaymentMutation.mutate({\n                          customerId: mixedPaymentData.customerId,\n                          points: mixedPaymentData.pointsToUse,\n                          orderId: mixedPaymentData.orderId,\n                          paymentMethod: 'transfer'\n                        });\n                      } finally {\n                        setQrLoading(false);\n                      }\n                    }}\n                    disabled={mixedPaymentMutation.isPending || qrLoading}\n                  >\n                    <span className=\"text-2xl mr-3\">💳</span>\n                    <div className=\"text-left\">\n                      <p className=\"font-medium\">\n                        {qrLoading ? 'Đang tạo QR...' : t('orders.paymentMethods.vnpay')}\n                      </p>\n                      <p className=\"text-sm text-gray-500\">{mixedPaymentData.remainingAmount.toLocaleString()} ₫</p>\n                    </div>\n                    {qrLoading && (\n                      <div className=\"ml-auto\">\n                        <div className=\"animate-spin w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full\" />\n                      </div>\n                    )}\n                  </Button>\n                </div>\n              </div>\n\n              <div className=\"flex justify-end gap-2 pt-4\">\n                <Button variant=\"outline\" onClick={() => setMixedPaymentOpen(false)}>\n                  {t('common.cancel')}\n                </Button>\n                <Button\n                  onClick={() => setMixedPaymentOpen(true)}\n                  className=\"bg-orange-600 hover:bg-orange-700\"\n                >\n                  {t('orders.mixedPaymentTitle')}\n                </Button>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/* Receipt Preview Modal - Step 1: \"Xem trước hóa đơn\" */}\n      <ReceiptModal\n        isOpen={showReceiptPreview}\n        onClose={() => {\n          console.log(\"🔴 Order Management: Closing receipt preview modal\");\n          setShowReceiptPreview(false);\n          setPreviewReceipt(null);\n        }}\n        onConfirm={() => {\n          console.log(\"📄 Order Management: Receipt preview confirmed, starting payment flow\");\n\n          if (!previewReceipt) {\n            console.error('❌ No preview receipt data available');\n            return;\n          }\n\n          // Prepare complete order data for payment flow\n          const completeOrderForPayment = {\n            ...selectedOrder,\n            orderItems: previewReceipt.orderItems || orderItems || [],\n          };\n\n          console.log('💾 Setting order for payment with complete data:', completeOrderForPayment);\n          setOrderForPayment(completeOrderForPayment);\n\n          // Close preview and show payment method modal\n          setShowReceiptPreview(false);\n          setShowPaymentMethodModal(true);\n        }}\n        isPreview={true}\n        cartItems={previewReceipt?.items?.map((item: any) => ({\n          id: item.productId || item.id,\n          name: item.productName || item.name,\n          price: parseFloat(item.price || item.unitPrice || '0'),\n          quantity: item.quantity,\n          sku: item.sku || `SP${item.productId}`,\n          taxRate: (() => {\n            const product = Array.isArray(products) ? products.find((p: any) => p.id === item.productId) : null;\n            return product?.taxRate ? parseFloat(product.taxRate) : 10;\n          })()\n        })) || []}\n        total={previewReceipt ? parseFloat(previewReceipt.total) : 0}\n      />\n\n      {/* Payment Method Modal */}\n      <PaymentMethodModal\n        isOpen={showPaymentMethodModal}\n        onClose={() => {\n          setShowPaymentMethodModal(false);\n          setOrderForPayment(null);\n        }}\n        onSelectMethod={(method, data) => {\n          console.log('🎯 Order Management payment method selected:', method, data);\n          setShowPaymentMethodModal(false);\n\n          // If payment method returns e-invoice data (like from \"phát hành sau\"), handle it\n          if (data && data.receipt) {\n            console.log('📄 Order Management: Payment method returned receipt data, showing receipt');\n            setSelectedReceipt(data.receipt);\n            setShowReceiptModal(true);\n            setOrderForPayment(null);\n          } else {\n            // Otherwise continue to E-invoice modal\n            console.log('🔄 Order Management: Continuing to E-invoice modal');\n            // If method.nameKey is 'einvoice', show E-invoice modal directly\n            if (method.nameKey === 'einvoice') {\n              setShowEInvoiceModal(true);\n            } else {\n              // For other payment methods, proceed with payment completion\n              if (selectedOrder) {\n                completePaymentMutation.mutate({\n                  orderId: selectedOrder.id,\n                  paymentMethod: method.nameKey,\n                });\n              }\n            }\n          }\n        }}\n        total={(() => {\n          if (!orderForPayment) return 0;\n\n          // Use pre-calculated total if available\n          if (orderForPayment.calculatedTotal) {\n            console.log('💰 Payment Modal using pre-calculated total:', orderForPayment.calculatedTotal);\n            return Math.round(orderForPayment.calculatedTotal);\n          }\n\n          // Fallback calculation using EXACT same logic as Order Details display\n          const itemsToCalculate = orderForPayment.orderItems || orderItems || [];\n          console.log('💰 Payment Modal fallback calculation from items:', itemsToCalculate.length);\n\n          if (!Array.isArray(itemsToCalculate) || itemsToCalculate.length === 0) {\n            return Math.round(Number(orderForPayment.total || 0));\n          }\n\n          let itemsSubtotal = 0;\n          let itemsTax = 0;\n\n          if (Array.isArray(products)) {\n            itemsToCalculate.forEach((item: any) => {\n              const product = products.find((p: any) => p.id === item.productId);\n              const basePrice = Number(item.unitPrice || 0);\n              const quantity = item.quantity;\n\n              // Calculate subtotal exactly as Order Details display\n              itemsSubtotal += basePrice * quantity;\n\n              // Tax = (after_tax_price - price) * quantity\n              if (product?.afterTaxPrice && product.afterTaxPrice !== null && product.afterTaxPrice !== \"\") {\n                const afterTaxPrice = parseFloat(product.afterTaxPrice);\n                const price = parseFloat(product.price);\n                itemsTax += (afterTaxPrice - price) * quantity;\n              }\n            });\n          }\n\n          const calculatedTotal = Math.round(itemsSubtotal + itemsTax);\n          console.log('💰 Payment Modal fallback calculation result:', {\n            itemsSubtotal,\n            itemsTax,\n            calculatedTotal\n          });\n\n          return calculatedTotal > 0 ? calculatedTotal : Math.round(Number(orderForPayment.total || 0));\n        })()}\n        onShowEInvoice={() => setShowEInvoiceModal(true)}\n        cartItems={(() => {\n          // Use processed items if available\n          if (orderForPayment?.processedItems) {\n            console.log('📦 Using processed items for Payment Modal:', orderForPayment.processedItems.length);\n            return orderForPayment.processedItems.map((item: any) => ({\n              id: item.productId,\n              name: item.productName,\n              price: item.price,\n              quantity: item.quantity,\n              sku: item.sku,\n              taxRate: item.taxRate,\n              afterTaxPrice: item.afterTaxPrice\n            }));\n          }\n\n          // Fallback to orderItems\n          const itemsToMap = orderForPayment?.orderItems || orderItems || [];\n          console.log(\"📦 Mapping cart items for Payment Modal:\", itemsToMap.length);\n\n          return itemsToMap.map((item: any) => {\n            const product = Array.isArray(products) ? products.find((p: any) => p.id === item.productId) : null;\n            return {\n              id: item.productId,\n              name: item.productName || getProductInfo(item.productId)?.name || 'Unknown Product',\n              price: parseFloat(item.unitPrice || '0'),\n              quantity: item.quantity,\n              sku: item.productSku || `SP${item.productId}`,\n              taxRate: product?.taxRate ? parseFloat(product.taxRate) : 0,\n              afterTaxPrice: product?.afterTaxPrice || null\n            };\n          });\n        })()}\n      />\n\n      {/* E-Invoice Modal */}\n      {showEInvoiceModal && orderForPayment && (\n        <EInvoiceModal\n          isOpen={showEInvoiceModal}\n          onClose={() => {\n            setShowEInvoiceModal(false);\n            setOrderForPayment(null);\n          }}\n          onConfirm={handleEInvoiceConfirm}\n          total={(() => {\n            if (!orderForPayment) return 0;\n\n            // Use pre-calculated total if available\n            if (orderForPayment.calculatedTotal) {\n              console.log('💰 E-invoice using pre-calculated total:', orderForPayment.calculatedTotal);\n              return Math.round(orderForPayment.calculatedTotal);\n            }\n\n            // Fallback calculation using EXACT same logic as Order Details display\n            const itemsToCalculate = orderForPayment.orderItems || orderItems || [];\n            console.log(\"💰 E-invoice fallback calculation from items:\", itemsToCalculate.length);\n\n            if (!Array.isArray(itemsToCalculate) || itemsToCalculate.length === 0) {\n              return Math.round(Number(orderForPayment.total || 0));\n            }\n\n            let itemsSubtotal = 0;\n            let itemsTax = 0;\n\n            if (Array.isArray(products)) {\n              itemsToCalculate.forEach((item: any) => {\n                const product = products.find((p: any) => p.id === item.productId);\n                const basePrice = Number(item.unitPrice || 0);\n                const quantity = item.quantity;\n\n                // Calculate subtotal exactly as Order Details display\n                itemsSubtotal += basePrice * quantity;\n\n                // Tax = (after_tax_price - price) * quantity\n                if (product?.afterTaxPrice && product.afterTaxPrice !== null && product.afterTaxPrice !== \"\") {\n                  const afterTaxPrice = parseFloat(product.afterTaxPrice);\n                  const price = parseFloat(product.price);\n                  itemsTax += (afterTaxPrice - price) * quantity;\n                }\n              });\n            }\n\n            const calculatedTotal = Math.round(itemsSubtotal + itemsTax);\n            console.log(\"💰 E-invoice fallback calculation result:\", {\n              itemsSubtotal,\n              itemsTax,\n              calculatedTotal\n            });\n\n            return calculatedTotal > 0 ? calculatedTotal : Math.round(Number(orderForPayment.total || 0));\n          })()}\n          cartItems={(() => {\n            // Use processed items if available\n            if (orderForPayment?.processedItems) {\n              console.log('📦 Using processed items for E-invoice modal:', orderForPayment.processedItems.length);\n              return orderForPayment.processedItems.map((item: any) => ({\n                id: item.productId,\n                name: item.productName,\n                price: item.price,\n                quantity: item.quantity,\n                sku: item.sku,\n                taxRate: item.taxRate,\n                afterTaxPrice: item.afterTaxPrice\n              }));\n            }\n\n            // Fallback to orderItems\n            const itemsToMap = orderForPayment?.orderItems || orderItems || [];\n            console.log(\"📦 Mapping cart items for E-invoice modal:\", itemsToMap.length);\n\n            return itemsToMap.map((item: any) => {\n              const product = Array.isArray(products) ? products.find((p: any) => p.id === item.productId) : null;\n              return {\n                id: item.productId,\n                name: item.productName || getProductInfo(item.productId)?.name || 'Unknown Product',\n                price: parseFloat(item.unitPrice || '0'),\n                quantity: item.quantity,\n                sku: item.productSku || `SP${item.productId}`,\n                taxRate: product?.taxRate ? parseFloat(product.taxRate) : 0,\n                afterTaxPrice: product?.afterTaxPrice || null\n              };\n            });\n          })()}\n          source=\"order-management\"\n          orderId={orderForPayment.id}\n        />\n      )}\n\n      {/* Receipt Modal - Final receipt after payment */}\n      <ReceiptModal\n        isOpen={showReceiptModal}\n        onClose={() => {\n          console.log('🔴 Order Management: Closing final receipt modal and clearing all states');\n          setShowReceiptModal(false);\n          setSelectedReceipt(null);\n          setOrderForPayment(null);\n          setShowPaymentMethodModal(false);\n          setShowEInvoiceModal(false);\n          setShowReceiptPreview(false);\n          setPreviewReceipt(null);\n          setOrderDetailsOpen(false);\n          setSelectedOrder(null);\n        }}\n        receipt={selectedReceipt}\n        cartItems={selectedReceipt?.items?.map((item: any) => ({\n          id: item.productId || item.id,\n          name: item.productName || item.name,\n          price: parseFloat(item.price || item.unitPrice || '0'),\n          quantity: item.quantity,\n          sku: item.sku || `SP${item.productId}`,\n          taxRate: (() => {\n            const product = Array.isArray(products) ? products.find((p: any) => p.id === item.productId) : null;\n            return product?.taxRate ? parseFloat(product.taxRate) : 10;\n          })()\n        })) || []}\n      />\n    </div>\n  );\n}","size_bytes":97626},"client/src/components/pos/bulk-import-modal.tsx":{"content":"import { useState, useRef } from \"react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport {\n  X,\n  Upload,\n  Download,\n  AlertCircle,\n  FileSpreadsheet,\n} from \"lucide-react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport * as XLSX from \"xlsx\";\n\ninterface BulkImportModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\ninterface ProductRow {\n  name: string;\n  sku: string;\n  price: string;\n  stock: number;\n  categoryId: number;\n  imageUrl?: string;\n  taxRate?: string;\n}\n\nexport function BulkImportModal({ isOpen, onClose }: BulkImportModalProps) {\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [preview, setPreview] = useState<ProductRow[]>([]);\n  const [errors, setErrors] = useState<string[]>([]);\n  const [errorResults, setErrorResults] = useState<any[]>([]);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const { toast } = useToast();\n  const { t } = useTranslation();\n\n  const bulkCreateMutation = useMutation({\n    mutationFn: async (products: ProductRow[]) => {\n      const response = await fetch(\"/api/products/bulk\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ products }),\n      });\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || \"Failed to bulk create products\");\n      }\n      return response.json();\n    },\n    onSuccess: (data) => {\n      console.log(\"=== BULK IMPORT SUCCESS RESPONSE ===\");\n      console.log(\"Full response data:\", JSON.stringify(data, null, 2));\n      console.log(\"Success count:\", data.success);\n      console.log(\"Error count:\", data.errors);\n      console.log(\"Results array:\", data.results);\n\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n\n      if (data.errors > 0) {\n        console.log(\"=== ERRORS FOUND ===\");\n        const errorItems = data.results?.filter((r) => !r.success) || [];\n        setErrorResults(errorItems);\n\n        errorItems.forEach((item, index) => {\n          console.log(`Error ${index + 1}:`, item.error);\n          console.log(`Data:`, item.data);\n        });\n\n        // Check if there are SKU duplicate errors\n        const skuErrors = errorItems.filter(\n          (item) => item.error && item.error.includes(\"already exists\"),\n        );\n\n        let errorDescription =\n          data.message ||\n          `${data.success} sản phẩm thành công, ${data.errors} sản phẩm lỗi`;\n\n        if (skuErrors.length > 0) {\n          errorDescription += `\\nCó ${skuErrors.length} sản phẩm bị trùng mã SKU`;\n        }\n\n        // Automatically download error report\n        setTimeout(() => {\n          downloadErrorReport(errorItems);\n        }, 500);\n\n        toast({\n          title: \"Hoàn thành với lỗi\",\n          description:\n            errorDescription + \"\\nFile báo cáo lỗi đã được tải xuống tự động\",\n          variant: \"destructive\",\n        });\n      } else {\n        toast({\n          title: \"Thành công\",\n          description:\n            data.message || `Đã nhập ${data.success} sản phẩm thành công`,\n        });\n      }\n      handleClose();\n    },\n    onError: (error) => {\n      console.log(\"=== BULK IMPORT ERROR ===\");\n      console.log(\"Error object:\", error);\n      console.log(\"Error message:\", error.message);\n      console.log(\"Error stack:\", error.stack);\n\n      toast({\n        title: \"Lỗi\",\n        description: error.message || \"Không thể nhập sản phẩm hàng loạt\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleFileUpload = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (!file) return;\n\n    setIsProcessing(true);\n    setErrors([]);\n\n    const reader = new FileReader();\n    reader.onload = (e) => {\n      try {\n        const data = new Uint8Array(e.target?.result as ArrayBuffer);\n        const workbook = XLSX.read(data, { type: \"array\" });\n        const sheetName = workbook.SheetNames[0];\n        const worksheet = workbook.Sheets[sheetName];\n        const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });\n\n        // Skip header row and process data\n        const rows = jsonData.slice(1) as any[][];\n        const validProducts: ProductRow[] = [];\n        const newErrors: string[] = [];\n\n        rows.forEach((row, index) => {\n          const rowNumber = index + 2; // +2 because we skipped header and arrays are 0-indexed\n\n          if (\n            !row[0] ||\n            !row[1] ||\n            !row[2] ||\n            row[3] === undefined ||\n            row[4] === undefined ||\n            !row[5]\n          ) {\n            newErrors.push(`Dòng ${rowNumber}: ${t('pos.missingRequiredInfo')}`);\n            return;\n          }\n\n          const product: ProductRow = {\n            name: row[0]?.toString().trim(),\n            sku: row[1]?.toString().trim(),\n            price: row[2]?.toString().trim(),\n            taxRate: row[3]?.toString().trim() || \"8.00\",\n            stock: parseInt(row[4]?.toString()) || 0,\n            categoryId: parseInt(row[5]?.toString()) || 0,\n            imageUrl: row[6]?.toString().trim() || \"\",\n          };\n\n          // Validate data\n          if (!product.name) {\n            newErrors.push(\n              `Dòng ${rowNumber}: ${t('pos.productNameRequired')}`,\n            );\n          }\n          if (!product.sku) {\n            newErrors.push(`Dòng ${rowNumber}: ${t('pos.skuRequired')}`);\n          }\n          if (isNaN(parseFloat(product.price))) {\n            newErrors.push(`Dòng ${rowNumber}: ${t('pos.invalidPrice')}`);\n          }\n          if (product.categoryId <= 0) {\n            newErrors.push(`Dòng ${rowNumber}: ${t('pos.invalidCategoryId')}`);\n          }\n          if (product.taxRate && (isNaN(parseFloat(product.taxRate)) || parseFloat(product.taxRate) < 0 || parseFloat(product.taxRate) > 100)) {\n            newErrors.push(`Dòng ${rowNumber}: ${t('pos.invalidTaxRate')}`);\n          }\n\n          // Check for duplicate SKU within the imported data\n          const skuExists = validProducts.some((p) => p.sku === product.sku);\n          if (skuExists) {\n            newErrors.push(\n              `Dòng ${rowNumber}: SKU \"${product.sku}\" ${t('pos.duplicateSku')}`,\n            );\n          }\n\n          if (\n            newErrors.length === 0 ||\n            newErrors.filter((e) => e.includes(`Dòng ${rowNumber}`)).length ===\n              0\n          ) {\n            validProducts.push(product);\n          }\n        });\n\n        setPreview(validProducts);\n        setErrors(newErrors);\n      } catch (error) {\n        setErrors([\n          t('pos.cannotReadFile'),\n        ]);\n      }\n      setIsProcessing(false);\n    };\n\n    reader.readAsArrayBuffer(file);\n  };\n\n  const handleImport = () => {\n    if (preview.length > 0) {\n      bulkCreateMutation.mutate(preview);\n    }\n  };\n\n  const handleClose = () => {\n    setPreview([]);\n    setErrors([]);\n    setErrorResults([]);\n    if (fileInputRef.current) {\n      fileInputRef.current.value = \"\";\n    }\n    onClose();\n  };\n\n  const downloadTemplate = () => {\n    const template = [\n      [\n        \"Tên sản phẩm\",\n        \"SKU\", \n        \"Giá\",\n        \"% Thuế\",\n        \"Số lượng\",\n        \"Category ID\",\n        \"Hình ảnh (URL)\",\n      ],\n      [\"Cà phê đen\", \"COFFEE-001\", \"25000\", \"8.00\", \"100\", \"1\", \"\"],\n      [\"Bánh mì\", \"FOOD-001\", \"15000\", \"8.00\", \"50\", \"2\", \"\"],\n    ];\n\n    const ws = XLSX.utils.aoa_to_sheet(template);\n    const wb = XLSX.utils.book_new();\n    XLSX.utils.book_append_sheet(wb, ws, \"Template\");\n    XLSX.writeFile(wb, \"product_import_template.xlsx\");\n  };\n\n  const downloadErrorReport = (errorResults: any[]) => {\n    const errorData = [\n      [\n        \"Tên sản phẩm\",\n        \"SKU\",\n        \"Giá\",\n        \"% Thuế\",\n        \"Số lượng\",\n        \"Category ID\",\n        \"Hình ảnh (URL)\",\n        \"Lỗi chi tiết\",\n      ],\n    ];\n\n    errorResults.forEach((result) => {\n      if (!result.success && result.data) {\n        errorData.push([\n          result.data.name || \"\",\n          result.data.sku || \"\",\n          result.data.price || \"\",\n          result.data.taxRate || \"\",\n          result.data.stock || \"\",\n          result.data.categoryId || \"\",\n          result.data.imageUrl || \"\",\n          result.error || \"Lỗi không xác định\",\n        ]);\n      }\n    });\n\n    const ws = XLSX.utils.aoa_to_sheet(errorData);\n\n    // Auto-fit column widths\n    const colWidths = [\n      { wch: 20 }, // Tên sản phẩm\n      { wch: 15 }, // SKU\n      { wch: 10 }, // Giá\n      { wch: 10 }, // % Thuế\n      { wch: 10 }, // Số lượng\n      { wch: 12 }, // Category ID\n      { wch: 30 }, // Hình ảnh URL\n      { wch: 40 }, // Lỗi chi tiết\n    ];\n    ws[\"!cols\"] = colWidths;\n\n    // Style header row\n    const range = XLSX.utils.decode_range(ws[\"!ref\"] || \"A1\");\n    for (let col = range.s.c; col <= range.e.c; col++) {\n      const cellAddress = XLSX.utils.encode_cell({ r: 0, c: col });\n      if (!ws[cellAddress]) continue;\n      ws[cellAddress].s = {\n        font: { bold: true, color: { rgb: \"FFFFFF\" } },\n        fill: { fgColor: { rgb: \"DC2626\" } },\n        alignment: { horizontal: \"center\" },\n      };\n    }\n\n    const wb = XLSX.utils.book_new();\n    XLSX.utils.book_append_sheet(wb, ws, \"Lỗi Import\");\n\n    const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, \"-\");\n    XLSX.writeFile(wb, `product_import_errors_${timestamp}.xlsx`);\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={handleClose}>\n      <DialogContent className=\"max-w-4xl max-h-screen overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center justify-between\">\n            {t('pos.bulkImportTitle')}\n            {/* <Button variant=\"ghost\" size=\"sm\" onClick={handleClose}>\n              <X size={20} />\n            </Button> */}\n          </DialogTitle>\n        </DialogHeader>\n\n        <div className=\"p-6 space-y-6\">\n          {/* Instructions */}\n          <div className=\"bg-blue-50 p-4 rounded-lg\">\n            <h3 className=\"font-medium mb-2\">{t('pos.bulkImportInstructions')}</h3>\n            <ol className=\"list-decimal list-inside space-y-1 text-sm\">\n              <li>{t('pos.downloadTemplate')}</li>\n              <li>{t('pos.fillProductInfo')}</li>\n              <li>{t('pos.uploadAndPreview')}</li>\n              <li>{t('pos.clickImportToComplete')}</li>\n            </ol>\n          </div>\n\n          {/* Download template and upload */}\n          <div className=\"flex space-x-4\">\n            <Button onClick={downloadTemplate} variant=\"outline\">\n              <Download className=\"mr-2\" size={16} />\n              {t('pos.downloadTemplateButton')}\n            </Button>\n\n            <div>\n              <input\n                type=\"file\"\n                ref={fileInputRef}\n                onChange={handleFileUpload}\n                accept=\".xlsx,.xls\"\n                className=\"hidden\"\n              />\n              <Button\n                onClick={() => fileInputRef.current?.click()}\n                disabled={isProcessing}\n              >\n                <Upload className=\"mr-2\" size={16} />\n                {isProcessing ? t('pos.processing') : t('pos.selectExcelFile')}\n              </Button>\n            </div>\n          </div>\n\n          {/* Errors */}\n          {errors.length > 0 && (\n            <div className=\"bg-red-50 p-4 rounded-lg\">\n              <div className=\"flex items-center mb-2\">\n                <AlertCircle className=\"mr-2 text-red-500\" size={16} />\n                <h3 className=\"font-medium text-red-700\">\n                  {t('pos.dataErrors')}\n                </h3>\n              </div>\n              <ul className=\"list-disc list-inside space-y-1 text-sm text-red-600\">\n                {errors.map((error, index) => (\n                  <li key={index}>{error}</li>\n                ))}\n              </ul>\n            </div>\n          )}\n\n          {/* Error Report Info */}\n          {errorResults.length > 0 && (\n            <div className=\"bg-red-50 p-4 rounded-lg border border-red-200\">\n              <div className=\"flex items-center mb-2\">\n                <AlertCircle className=\"mr-2 text-red-500\" size={16} />\n                <h3 className=\"font-medium text-red-700\">\n                  {t('common.count')} {errorResults.length}{t('pos.productsWithErrors')}\n                </h3>\n              </div>\n              <p className=\"text-sm text-red-600\">\n                {t('pos.errorReportDownloaded')}\n              </p>\n            </div>\n          )}\n\n          {/* Preview */}\n          {preview.length > 0 && (\n            <div>\n              <h3 className=\"font-medium mb-4\">\n                {t('pos.dataPreview')} ({preview.length}{t('pos.productsCount')}):\n              </h3>\n              <div className=\"bg-gray-50 rounded-lg overflow-hidden\">\n                <table className=\"w-full text-sm\">\n                  <thead className=\"bg-gray-100\">\n                    <tr>\n                      <th className=\"text-left py-2 px-3\">{t('pos.productName')}</th>\n                      <th className=\"text-left py-2 px-3\">{t('pos.sku')}</th>\n                      <th className=\"text-left py-2 px-3\">{t('pos.price')}</th>\n                      <th className=\"text-left py-2 px-3\">% {t('pos.taxRate')}</th>\n                      <th className=\"text-left py-2 px-3\">{t('pos.quantity')}</th>\n                      <th className=\"text-left py-2 px-3\">Category ID</th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"bg-white\">\n                    {preview.slice(0, 10).map((product, index) => (\n                      <tr key={index} className=\"border-b border-gray-200\">\n                        <td className=\"py-2 px-3\">{product.name}</td>\n                        <td className=\"py-2 px-3\">{product.sku}</td>\n                        <td className=\"py-2 px-3\">\n                          {new Intl.NumberFormat(\"vi-VN\", {\n                            style: \"currency\",\n                            currency: \"VND\",\n                          }).format(parseFloat(product.price))}\n                        </td>\n                        <td className=\"py-2 px-3\">{product.taxRate || \"8.00\"}%</td>\n                        <td className=\"py-2 px-3\">{product.stock}</td>\n                        <td className=\"py-2 px-3\">{product.categoryId}</td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n                {preview.length > 10 && (\n                  <div className=\"p-2 text-center text-gray-500 text-sm\">\n                    ... và {preview.length - 10} sản phẩm khác\n                  </div>\n                )}\n              </div>\n            </div>\n          )}\n\n          {/* Actions */}\n          {preview.length > 0 && errors.length === 0 && (\n            <div className=\"flex justify-end space-x-3\">\n              <Button variant=\"outline\" onClick={handleClose}>\n                {t('pos.cancel')}\n              </Button>\n              <Button\n                onClick={handleImport}\n                disabled={bulkCreateMutation.isPending}\n                className=\"bg-green-600 hover:bg-green-700 text-white font-medium transition-colors duration-200\"\n              >\n                {bulkCreateMutation.isPending\n                  ? t('pos.importing')\n                  : `${t('pos.importProducts')} ${preview.length}${t('pos.productsCount')}`}\n              </Button>\n            </div>\n          )}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":15869},"client/src/components/pos/category-sidebar.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Search, BarChart3, Settings, Coffee, Cookie, Smartphone, Home, User, Grid3X3 } from \"lucide-react\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport type { Category, Product } from \"@shared/schema\";\n\ninterface CategorySidebarProps {\n  selectedCategory: number | \"all\";\n  onCategorySelect: (categoryId: number | \"all\") => void;\n  searchQuery: string;\n  onSearchChange: (query: string) => void;\n  onOpenProductManager: () => void;\n  onAddToCart: (productId: number) => void;\n}\n\nconst categoryIcons = {\n  \"Beverages\": Coffee,\n  \"Snacks\": Cookie,\n  \"Electronics\": Smartphone,\n  \"Household\": Home,\n  \"Personal Care\": User,\n};\n\nexport function CategorySidebar({\n  selectedCategory,\n  onCategorySelect,\n  searchQuery,\n  onSearchChange,\n  onOpenProductManager,\n  onAddToCart\n}: CategorySidebarProps) {\n  const { toast } = useToast();\n  const { t } = useTranslation();\n\n  const { data: categories = [] } = useQuery<Category[]>({\n    queryKey: [\"/api/categories\"],\n  });\n\n  const { data: products = [] } = useQuery<Product[]>({\n    queryKey: [\"/api/products\"],\n    queryFn: async () => {\n      const response = await fetch(`/api/products`);\n      if (!response.ok) throw new Error('Failed to fetch products');\n      const allProducts = await response.json();\n\n      // Apply same filtering as ProductGrid - exclude raw materials and inactive products\n      return allProducts.filter((product: any) => {\n        const isNotRawMaterial = product.productType !== 2;\n        const isActive = product.isActive !== false;\n        return isNotRawMaterial && isActive;\n      });\n    },\n  });\n\n  const getProductCountForCategory = (categoryId: number | \"all\") => {\n    if (categoryId === \"all\") {\n      console.log(\"All products count:\", products.length);\n      return products.length;\n    }\n    \n    const categoryProducts = products.filter((p: Product) => p.categoryId === categoryId);\n    console.log(`Category ${categoryId} products:`, categoryProducts.length, categoryProducts.map(p => p.name));\n    \n    return categoryProducts.length;\n  };\n\n  const handleBarcodeScan = () => {\n    // Simulate barcode scanning\n    const sampleSkus = [\"BEV001\", \"BEV002\", \"SNK001\", \"ELC001\"];\n    const randomSku = sampleSkus[Math.floor(Math.random() * sampleSkus.length)];\n    \n    fetch(`/api/products/barcode/${randomSku}`)\n      .then(res => res.json())\n      .then(product => {\n        if (product.id) {\n          onAddToCart(product.id);\n          toast({\n            title: t('pos.productScanned'),\n            description: `${product.name} ${t('pos.addedToCart')}`,\n          });\n        }\n      })\n      .catch(() => {\n        toast({\n          title: t('pos.scanFailed'),\n          description: t('pos.productNotFound'),\n          variant: \"destructive\",\n        });\n      });\n  };\n\n  return (\n    <aside className=\"w-64 bg-white shadow-material border-r pos-border flex flex-col\">\n      <div className=\"p-4 border-b pos-border mt-2\">\n        <div className=\"relative mb-3\">\n          <Input\n            type=\"text\"\n            placeholder={t('pos.searchProducts')}\n            value={searchQuery}\n            onChange={(e) => onSearchChange(e.target.value)}\n            className=\"pl-10\"\n          />\n          <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400\" size={16} />\n        </div>\n      </div>\n      \n      <div className=\"flex-1 overflow-y-auto\">\n        <div className=\"p-4\">\n          <h3 className=\"font-medium pos-text-primary mb-3\">{t('pos.categories')}</h3>\n          <div className=\"space-y-2\">\n            <button\n              onClick={() => onCategorySelect(\"all\")}\n              className={`w-full text-left px-3 py-2 rounded-xl transition-colors duration-200 flex items-center justify-between ${\n                selectedCategory === \"all\" \n                  ? \"bg-green-50 text-green-600 border-l-4 border-green-500\" \n                  : \"hover:bg-gray-50\"\n              }`}\n            >\n              <span className=\"flex items-center\">\n                <Grid3X3 className=\"w-5 mr-2 text-gray-500\" size={16} />\n                {t('pos.allProducts')}\n              </span>\n              <span className=\"text-xs bg-gray-200 pos-text-secondary px-2 py-1 rounded-full\">\n                {getProductCountForCategory(\"all\")}\n              </span>\n            </button>\n            \n            {categories.map((category) => {\n              const IconComponent = categoryIcons[category.name as keyof typeof categoryIcons] || Grid3X3;\n              const isSelected = selectedCategory === category.id;\n              \n              return (\n                <button\n                  key={category.id}\n                  onClick={() => onCategorySelect(category.id)}\n                  className={`w-full text-left px-3 py-2 rounded-xl transition-colors duration-200 flex items-center justify-between ${\n                    isSelected \n                      ? \"bg-green-50 text-green-600 border-l-4 border-green-500\" \n                      : \"hover:bg-gray-50\"\n                  }`}\n                >\n                  <span className=\"flex items-center\">\n                    <IconComponent className=\"w-5 mr-2 text-gray-500\" size={16} />\n                    {category.name}\n                  </span>\n                  <span className={`text-xs px-2 py-1 rounded-full ${\n                    isSelected \n                      ? \"bg-green-500 text-white\" \n                      : \"bg-gray-200 text-gray-600\"\n                  }`}>\n                    {getProductCountForCategory(category.id)}\n                  </span>\n                </button>\n              );\n            })}\n          </div>\n        </div>\n      </div>\n      \n      <div className=\"p-4 border-t pos-border space-y-3\">\n        <Button \n          onClick={onOpenProductManager}\n          className=\"w-full bg-orange-500 hover:bg-orange-600 text-white flex items-center justify-center rounded-xl\"\n        >\n          <Settings className=\"mr-2\" size={16} />\n          {t('pos.manageProducts')}\n        </Button>\n      </div>\n\n      </aside>\n  );\n}\n","size_bytes":6243},"client/src/components/pos/customer-display.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport logoPath from \"@assets/EDPOS_1753091767028.png\";\nimport type { CartItem } from \"@shared/schema\";\n\ninterface CustomerDisplayProps {\n  cart: CartItem[];\n  subtotal: number;\n  tax: number;\n  total: number;\n  storeInfo?: {\n    name: string;\n    address?: string;\n  };\n  qrPayment?: {\n    qrCodeUrl: string;\n    amount: number;\n    paymentMethod: string;\n    transactionUuid: string;\n  } | null;\n}\n\nexport function CustomerDisplay({\n  cart,\n  subtotal,\n  tax,\n  total,\n  storeInfo,\n  qrPayment\n}: CustomerDisplayProps) {\n  const { t } = useTranslation();\n  const [currentTime, setCurrentTime] = useState(new Date());\n\n  useEffect(() => {\n    const timer = setInterval(() => {\n      setCurrentTime(new Date());\n    }, 1000);\n\n    return () => clearInterval(timer);\n  }, []);\n\n  const formatTime = (date: Date) => {\n    return date.toLocaleTimeString('vi-VN', {\n      hour: '2-digit',\n      minute: '2-digit',\n      second: '2-digit',\n      hour12: false\n    });\n  };\n\n  const formatDate = (date: Date) => {\n    return date.toLocaleDateString('vi-VN', {\n      weekday: 'long',\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric'\n    });\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-green-50 to-blue-50 flex flex-col\">\n      {/* Header */}\n      <div className=\"bg-white shadow-lg border-b-4 border-green-500 p-6\">\n        <div className=\"flex items-center justify-between max-w-6xl mx-auto\">\n          <div className=\"flex items-center space-x-4\">\n            <img src={logoPath} alt=\"Logo\" className=\"h-12 w-12\" />\n            <div>\n              <h1 className=\"text-2xl font-bold text-gray-800\">\n                {storeInfo?.name || \"IDMC Store\"}\n              </h1>\n              <p className=\"text-sm text-gray-600\">\n                {storeInfo?.address || \"Chào mừng quý khách\"}\n              </p>\n            </div>\n          </div>\n          <div className=\"text-right\">\n            <div className=\"text-lg font-semibold text-gray-800\">\n              {formatTime(currentTime)}\n            </div>\n            <div className=\"text-sm text-gray-600\">\n              {formatDate(currentTime)}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Main Content */}\n      <div className=\"flex-1 p-4 flex flex-col\">\n        <div className=\"max-w-6xl mx-auto flex-1 flex flex-col\">\n          {qrPayment ? (\n            // QR Payment Display - Optimized for no scrolling\n            <div className=\"flex flex-col items-center justify-center h-full py-4\">\n              <div className=\"bg-white rounded-3xl shadow-2xl p-6 max-w-lg mx-auto w-full max-h-[calc(100vh-200px)] flex flex-col\">\n                <div className=\"text-center mb-4\">\n                  <div className=\"text-4xl mb-2\">📱</div>\n                  <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">\n                    Quét mã QR để thanh toán\n                  </h2>\n                  <p className=\"text-base text-gray-600\">\n                    Sử dụng ứng dụng ngân hàng để quét mã QR\n                  </p>\n                </div>\n\n                <div className=\"bg-gray-50 rounded-2xl p-4 mb-4\">\n                  <p className=\"text-sm text-gray-600 mb-1\">Số tiền cần thanh toán</p>\n                  <p className=\"text-2xl font-bold text-green-600\">\n                    {qrPayment.amount.toLocaleString('vi-VN')} ₫\n                  </p>\n                </div>\n\n                <div className=\"flex justify-center mb-4 flex-1 flex items-center\">\n                  <div className=\"bg-white p-4 rounded-2xl border-4 border-green-200 shadow-xl\">\n                    <img\n                      src={qrPayment.qrCodeUrl}\n                      alt=\"QR Code thanh toán\"\n                      className=\"w-56 h-56 max-w-full max-h-full object-contain\"\n                    />\n                  </div>\n                </div>\n\n                <div className=\"text-center\">\n                  <p className=\"text-xs text-gray-500 mb-1\">\n                    Mã giao dịch: {qrPayment.transactionUuid}\n                  </p>\n                  <p className=\"text-sm text-blue-600 font-medium\">\n                    Vui lòng quét mã QR để hoàn tất thanh toán\n                  </p>\n                </div>\n              </div>\n            </div>\n          ) : cart.length === 0 ? (\n            // Empty Cart Display\n            <div className=\"text-center py-20\">\n              <div className=\"mb-8\">\n                <div className=\"text-8xl mb-4\">🛒</div>\n                <h2 className=\"text-4xl font-bold text-gray-700 mb-4\">\n                  Chào mừng quý khách!\n                </h2>\n                <p className=\"text-xl text-gray-500\">\n                  Vui lòng chờ thu ngân xử lý đơn hàng của bạn\n                </p>\n              </div>\n            </div>\n          ) : (\n            // Cart Display\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n              {/* Items List */}\n              <div className=\"lg:col-span-2\">\n                <div className=\"bg-white rounded-2xl shadow-xl p-6\">\n                  <h2 className=\"text-2xl font-bold text-gray-800 mb-6 flex items-center\">\n                    <span className=\"bg-green-100 p-2 rounded-lg mr-3\">🛍️</span>\n                    Đơn hàng của bạn\n                  </h2>\n\n                  <div className=\"space-y-4 max-h-96 overflow-y-auto\">\n                    {cart.map((item, index) => (\n                      <div key={item.id} className=\"flex items-center justify-between p-4 bg-gray-50 rounded-xl border-l-4 border-green-400\">\n                        <div className=\"flex items-center space-x-4\">\n                          <div className=\"bg-green-100 text-green-800 font-bold text-sm px-3 py-1 rounded-full\">\n                            #{index + 1}\n                          </div>\n                          <div>\n                            <h3 className=\"font-semibold text-lg text-gray-800\">\n                              {item.name}\n                            </h3>\n                            <p className=\"text-sm text-gray-600\">\n                              {parseFloat(item.price).toLocaleString('vi-VN')} ₫ × {item.quantity}\n                            </p>\n                          </div>\n                        </div>\n                        <div className=\"text-right\">\n                          <div className=\"text-xl font-bold text-green-600\">\n                            {parseFloat(item.total).toLocaleString('vi-VN')} ₫\n                          </div>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              </div>\n\n              {/* Order Summary */}\n              <div className=\"lg:col-span-1\">\n                <div className=\"bg-white rounded-2xl shadow-xl p-6 sticky top-8\">\n                  <h3 className=\"text-xl font-bold text-gray-800 mb-6 flex items-center\">\n                    <span className=\"bg-blue-100 p-2 rounded-lg mr-3\">📋</span>\n                    Tổng thanh toán\n                  </h3>\n\n                  <div className=\"space-y-4\">\n                    <div className=\"flex justify-between items-center py-2 border-b border-gray-200\">\n                      <span className=\"text-gray-600\">Tạm tính:</span>\n                      <span className=\"font-medium\">\n                        {subtotal.toLocaleString('vi-VN')} ₫\n                      </span>\n                    </div>\n\n                    <div className=\"flex justify-between items-center py-2 border-b border-gray-200\">\n                      <span className=\"text-gray-600\">Thuế:</span>\n                      <span className=\"font-medium\">\n                        {tax.toLocaleString('vi-VN')} ₫\n                      </span>\n                    </div>\n\n                    <div className=\"flex justify-between items-center py-4 border-t-2 border-green-200\">\n                      <span className=\"text-xl font-bold text-gray-800\">\n                        Tổng cộng:\n                      </span>\n                      <span className=\"text-2xl font-bold text-green-600\">\n                        {total.toLocaleString('vi-VN')} ₫\n                      </span>\n                    </div>\n\n                    {/* Item Count */}\n                    <div className=\"bg-green-50 rounded-lg p-4 text-center\">\n                      <div className=\"text-sm text-green-700 mb-1\">\n                        Tổng số sản phẩm\n                      </div>\n                      <div className=\"text-2xl font-bold text-green-800\">\n                        {cart.reduce((sum, item) => sum + item.quantity, 0)}\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Footer */}\n      <div className=\"bg-white border-t border-gray-200 p-4\">\n        <div className=\"max-w-6xl mx-auto text-center\">\n          <p className=\"text-sm text-gray-500\">\n            Cảm ơn bạn đã mua sắm tại {storeInfo?.name || \"IDMC Store\"}\n          </p>\n          {/* Hidden refresh button - double click to refresh */}\n          <button\n            onClick={() => window.location.reload()}\n            onDoubleClick={() => window.location.reload()}\n            className=\"invisible hover:visible absolute bottom-2 right-2 text-xs text-gray-300 hover:text-gray-600 bg-transparent border-none cursor-pointer\"\n            title=\"Double click to refresh display\"\n          >\n            🔄\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":9777},"client/src/components/pos/einvoice-modal.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { X, Search, Keyboard } from \"lucide-react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport VirtualKeyboard from \"@/components/ui/virtual-keyboard\";\nimport { PrintDialog } from \"./print-dialog\";\n\n// E-invoice software providers mapping\nconst EINVOICE_PROVIDERS = [\n  { name: \"EasyInvoice\", value: \"1\" },\n  { name: \"VnInvoice\", value: \"2\" },\n  { name: \"FptInvoice\", value: \"3\" },\n  { name: \"MifiInvoice\", value: \"4\" },\n  { name: \"EHoaDon\", value: \"5\" },\n  { name: \"BkavInvoice\", value: \"6\" },\n  { name: \"MInvoice\", value: \"7\" },\n  { name: \"SInvoice\", value: \"8\" },\n  { name: \"WinInvoice\", value: \"9\" },\n];\n\ninterface EInvoiceModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onConfirm: (eInvoiceData: any) => void;\n  total: number;\n  cartItems?: Array<{\n    id: number;\n    name: string;\n    price: number;\n    quantity: number;\n    sku?: string;\n    taxRate?: number;\n  }>;\n  source?: \"pos\" | \"table\"; // Thêm prop để phân biệt nguồn gọi\n  orderId?: number; // Thêm orderId để tự xử lý cập nhật trạng thái\n  selectedPaymentMethod?: string; // Thêm prop để nhận phương thức thanh toán\n}\n\nexport function EInvoiceModal({\n  isOpen,\n  onClose,\n  onConfirm,\n  total,\n  cartItems = [],\n  source = \"pos\", // Default là 'pos' để tương thích ngược\n  orderId, // Thêm orderId prop\n  selectedPaymentMethod = \"\", // Thêm selectedPaymentMethod prop\n}: EInvoiceModalProps) {\n  // Debug log to track cart items data flow\n  console.log(\"🔍 EInvoiceModal Props Analysis:\");\n  console.log(\"- isOpen:\", isOpen);\n  console.log(\"- total:\", total);\n  console.log(\"- cartItems received:\", cartItems);\n  console.log(\"- cartItems type:\", typeof cartItems);\n  console.log(\"- cartItems is array:\", Array.isArray(cartItems));\n  console.log(\"- cartItems length:\", cartItems?.length || 0);\n  const [formData, setFormData] = useState({\n    invoiceProvider: \"\",\n    invoiceTemplate: \"\",\n    selectedTemplateId: \"\",\n    taxCode: \"\",\n    customerName: \"\",\n    address: \"\",\n    phoneNumber: \"\",\n    email: \"\",\n  });\n\n  const [isTaxCodeLoading, setIsTaxCodeLoading] = useState(false);\n  const [isPublishing, setIsPublishing] = useState(false);\n  const [showVirtualKeyboard, setShowVirtualKeyboard] = useState(false);\n  const [activeInputField, setActiveInputField] = useState<string | null>(null);\n  const [showPrintDialog, setShowPrintDialog] = useState(false);\n  const [receiptDataForPrint, setReceiptDataForPrint] = useState<any>(null);\n\n  const inputRefs = useRef<Record<string, HTMLInputElement | null>>({});\n\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { t } = useTranslation();\n\n  // Helper function để map phương thức thanh toán\n  const getPaymentMethodCode = (paymentMethod: string): number => {\n    switch (paymentMethod) {\n      case \"cash\":\n        return 1; // Tiền mặt\n      case \"qrCode\":\n        return 3; // QR Code (vẫn hiển thị là Chuyển khoản)\n      case \"creditCard\":\n      case \"debitCard\":\n      case \"momo\":\n      case \"zalopay\":\n      case \"vnpay\":\n        return 2; // Chuyển khoản\n      default:\n        return 2; // Default: Chuyển khoản\n    }\n  };\n\n  // Log the pre-selected payment method for debugging\n  console.log(\"💳 E-Invoice modal received payment method:\", selectedPaymentMethod);\n\n  // Mutation để hoàn tất thanh toán và cập nhật trạng thái\n  const completePaymentMutation = useMutation({\n    mutationFn: ({\n      orderId,\n      paymentMethod,\n    }: {\n      orderId: number;\n      paymentMethod: string;\n    }) => {\n      console.log(\n        \"🔄 E-invoice modal: Starting payment completion mutation for order:\",\n        orderId,\n      );\n      return apiRequest(\"PUT\", `/api/orders/${orderId}/status`, {\n        status: \"paid\",\n        paymentMethod,\n      });\n    },\n    onSuccess: (data, variables) => {\n      console.log(\n        \"🎯 E-invoice modal completed payment successfully for order:\",\n        variables.orderId,\n      );\n      queryClient.invalidateQueries({ queryKey: [\"/api/orders\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/tables\"] });\n\n      toast({\n        title: \"Thanh toán thành công\",\n        description:\n          \"Hóa đơn điện tử đã được phát hành và đơn hàng đã được thanh toán\",\n      });\n\n      console.log(\"✅ E-invoice modal: Payment completed, queries invalidated\");\n    },\n    onError: (error, variables) => {\n      console.error(\n        \"❌ Error completing payment from e-invoice modal for order:\",\n        variables.orderId,\n        error,\n      );\n      toast({\n        title: \"Lỗi\",\n        description:\n          \"Hóa đơn điện tử đã phát hành nhưng không thể hoàn tất thanh toán\",\n        variant: \"destructive\",\n      });\n\n      console.log(\n        \"❌ E-invoice modal: Payment failed for order:\",\n        variables.orderId,\n      );\n    },\n  });\n\n  // Fetch E-invoice connections\n  const { data: eInvoiceConnections = [] } = useQuery<any[]>({\n    queryKey: [\"/api/einvoice-connections\"],\n    enabled: isOpen,\n  });\n\n  // Fetch active invoice templates for dropdown\n  const { data: allInvoiceTemplates = [] } = useQuery<any[]>({\n    queryKey: [\"/api/invoice-templates/active\"],\n    enabled: isOpen,\n  });\n\n  // Filter templates to only show ones that are in use (useCK: true)\n  const invoiceTemplates = allInvoiceTemplates.filter(\n    (template) => template.useCK === true,\n  );\n\n  // Reset form only when modal opens, not when cartItems/total changes\n  useEffect(() => {\n    if (isOpen) {\n      console.log(\"🔥 E-INVOICE MODAL OPENING\");\n      console.log(\"🔥 cartItems when modal opens:\", cartItems);\n      console.log(\n        \"🔥 cartItems length when modal opens:\",\n        cartItems?.length || 0,\n      );\n      console.log(\n        \"🔥 cartItems is array when modal opens:\",\n        Array.isArray(cartItems),\n      );\n      console.log(\"🔥 total when modal opens:\", total);\n\n      setFormData({\n        invoiceProvider: \"EasyInvoice\", // Default provider\n        invoiceTemplate: \"1C25TYY\", // Default template\n        selectedTemplateId: \"\",\n        taxCode: \"0123456789\", // Default tax code\n        customerName: \"Khách hàng lẻ\", // Default customer name\n        address: \"\",\n        phoneNumber: \"\",\n        email: \"\",\n      });\n    }\n  }, [isOpen]); // Only reset when modal opens/closes\n\n  // Separate effect for debugging cartItems changes without resetting form\n  useEffect(() => {\n    if (isOpen) {\n      console.log(\"🔄 Cart items or total changed:\", {\n        cartItems: cartItems?.length || 0,\n        total,\n        timestamp: new Date().toISOString(),\n      });\n    }\n  }, [cartItems, total, isOpen]);\n\n  const handleInputChange = (field: string, value: string) => {\n    setFormData((prev) => ({\n      ...prev,\n      [field]: value,\n    }));\n  };\n\n  const handleVirtualKeyPress = (key: string) => {\n    if (!activeInputField) return;\n\n    const currentValue =\n      formData[activeInputField as keyof typeof formData] || \"\";\n    const newValue = currentValue + key;\n    handleInputChange(activeInputField, newValue);\n\n    // Focus the input to show cursor position\n    const inputRef = inputRefs.current[activeInputField];\n    if (inputRef) {\n      inputRef.focus();\n      // Set cursor to end\n      setTimeout(() => {\n        inputRef.setSelectionRange(newValue.length, newValue.length);\n      }, 0);\n    }\n  };\n\n  const handleVirtualBackspace = () => {\n    if (!activeInputField) return;\n\n    const currentValue =\n      formData[activeInputField as keyof typeof formData] || \"\";\n    const newValue = currentValue.slice(0, -1);\n    handleInputChange(activeInputField, newValue);\n\n    // Focus the input to show cursor position\n    const inputRef = inputRefs.current[activeInputField];\n    if (inputRef) {\n      inputRef.focus();\n      setTimeout(() => {\n        inputRef.setSelectionRange(newValue.length, newValue.length);\n      }, 0);\n    }\n  };\n\n  const handleVirtualEnter = () => {\n    // Hide keyboard on enter\n    setShowVirtualKeyboard(false);\n    setActiveInputField(null);\n  };\n\n  const handleInputFocus = (fieldName: string) => {\n    setActiveInputField(fieldName);\n    if (showVirtualKeyboard) {\n      // If keyboard is already shown, just switch focus\n      const inputRef = inputRefs.current[fieldName];\n      if (inputRef) {\n        inputRef.focus();\n      }\n    }\n  };\n\n  const toggleVirtualKeyboard = () => {\n    setShowVirtualKeyboard(!showVirtualKeyboard);\n    if (!showVirtualKeyboard) {\n      // If opening keyboard, focus on first input field\n      setActiveInputField(\"taxCode\");\n      setTimeout(() => {\n        const inputRef = inputRefs.current[\"taxCode\"];\n        if (inputRef) {\n          inputRef.focus();\n        }\n      }, 100);\n    } else {\n      setActiveInputField(null);\n    }\n  };\n\n  const handleGetTaxInfo = async () => {\n    if (!formData.taxCode.trim()) {\n      alert(\"Vui lòng nhập mã số thuế trước khi lấy thông tin\");\n      return;\n    }\n\n    setIsTaxCodeLoading(true);\n    try {\n      // Use a proxy endpoint through our server to avoid CORS issues\n      const response = await fetch(\"/api/tax-code-lookup\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({ taxCode: formData.taxCode }),\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n\n      const result = await response.json();\n      console.log(\"Tax code API response:\", result);\n\n      if (\n        result.success &&\n        result.data &&\n        Array.isArray(result.data) &&\n        result.data.length > 0\n      ) {\n        // Lấy phần tử đầu tiên từ mảng kết quả vì chỉ truyền 1 mã số thuế\n        const taxInfo = result.data[0];\n\n        if (taxInfo) {\n          // Kiểm tra trạng thái\n          if (taxInfo.tthai === \"00\") {\n            // Trạng thái hợp lệ - cập nhật thông tin\n            setFormData((prev) => ({\n              ...prev,\n              customerName: taxInfo.tenCty || prev.customerName,\n              address: taxInfo.diaChi || prev.address,\n            }));\n\n            alert(\n              `Đã lấy thông tin thành công!\\nTên công ty: ${taxInfo.tenCty}\\nĐịa chỉ: ${taxInfo.diaChi}`,\n            );\n          } else {\n            // Trạng thái không hợp lệ - hiển thị thông tin trạng thái\n            alert(\n              `Mã số thuế không hợp lệ!\\nTrạng thái: ${taxInfo.trangThaiHoatDong || \"Không xác định\"}\\nMã trạng thái: ${taxInfo.tthai}`,\n            );\n          }\n        } else {\n          alert(\n            \"Không tìm thấy thông tin cho mã số thuế này trong kết quả trả về\",\n          );\n        }\n      } else {\n        alert(result.message || \"Không tìm thấy thông tin cho mã số thuế này\");\n      }\n    } catch (error) {\n      console.error(\"Error fetching tax code info:\", error);\n      if (error === \"TypeError\" && error.includes(\"fetch\")) {\n        alert(\n          \"Không thể kết nối đến dịch vụ tra cứu mã số thuế. Vui lòng kiểm tra kết nối mạng hoặc thử lại sau.\",\n        );\n      } else {\n        alert(`Có lỗi xảy ra khi lấy thông tin mã số thuế: ${error}`);\n      }\n    } finally {\n      setIsTaxCodeLoading(false);\n    }\n  };\n\n  const handlePublishLater = async () => {\n    try {\n      console.log(\n        \"🟡 PHÁT HÀNH SAU - Lưu thông tin hóa đơn vào bảng invoices và invoice_items\",\n      );\n      console.log(\"🟡 Source:\", source, \"OrderId:\", orderId);\n\n      // Debug log current cart items\n      console.log(\"=== PHÁT HÀNH SAU - KIỂM TRA DỮ LIỆU ===\");\n      console.log(\"cartItems received:\", cartItems);\n      console.log(\"cartItems length:\", cartItems?.length || 0);\n      console.log(\"cartItems detailed:\", JSON.stringify(cartItems, null, 2));\n      console.log(\"total amount:\", total);\n\n      // Validate cart items first\n      if (!cartItems || !Array.isArray(cartItems) || cartItems.length === 0) {\n        console.error(\"❌ No valid cart items found for later publishing\");\n        toast({\n          title: \"Lỗi\",\n          description: \"Không có sản phẩm nào trong giỏ hàng để lưu thông tin.\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      // Calculate subtotal and tax with proper type conversion\n      const calculatedSubtotal = cartItems.reduce((sum, item) => {\n        const itemPrice =\n          typeof item.price === \"string\" ? parseFloat(item.price) : item.price;\n        const itemQuantity =\n          typeof item.quantity === \"string\"\n            ? parseInt(item.quantity)\n            : item.quantity;\n        console.log(\n          `💰 Item calculation: ${item.name} - Price: ${itemPrice}, Qty: ${itemQuantity}, Subtotal: ${itemPrice * itemQuantity}`,\n        );\n        return sum + itemPrice * itemQuantity;\n      }, 0);\n\n      const calculatedTax = cartItems.reduce((sum, item) => {\n        const itemPrice =\n          typeof item.price === \"string\" ? parseFloat(item.price) : item.price;\n        const itemQuantity =\n          typeof item.quantity === \"string\"\n            ? parseInt(item.quantity)\n            : item.quantity;\n        const itemTaxRate =\n          typeof item.taxRate === \"string\"\n            ? parseFloat(item.taxRate || \"0\")\n            : item.taxRate || 0;\n        const itemTax = (itemPrice * itemQuantity * itemTaxRate) / 100;\n        console.log(\n          `💰 Tax calculation: ${item.name} - Tax rate: ${itemTaxRate}%, Tax: ${itemTax}`,\n        );\n        return sum + itemTax;\n      }, 0);\n\n      console.log(\n        `💰 Total calculations: Subtotal: ${calculatedSubtotal}, Tax: ${calculatedTax}, Total: ${total}`,\n      );\n\n      // Lấy thông tin mẫu số hóa đơn được chọn\n      const selectedTemplate = invoiceTemplates.find(\n        (template) => template.id.toString() === formData.selectedTemplateId,\n      );\n\n      // Map phương thức thanh toán từ selectedPaymentMethod sang mã số\n      const paymentMethodCode = getPaymentMethodCode(selectedPaymentMethod);\n\n      // Chuẩn bị thông tin hóa đơn để lưu vào bảng invoices và invoice_items\n      const invoicePayload = {\n        invoiceNumber: null, // Chưa có số hóa đơn vì chưa phát hành\n        templateNumber: selectedTemplate?.templateNumber || null, // Mẫu số hóa đơn\n        symbol: selectedTemplate?.symbol || null, // Ký hiệu hóa đơn\n        customerName: formData.customerName || \"Khách hàng\",\n        customerTaxCode: formData.taxCode || null,\n        customerAddress: formData.address || null,\n        customerPhone: formData.phoneNumber || null,\n        customerEmail: formData.email || null,\n        subtotal: calculatedSubtotal.toFixed(2),\n        tax: calculatedTax.toFixed(2),\n        total: (typeof total === \"number\" && !isNaN(total)\n          ? total\n          : calculatedSubtotal + calculatedTax\n        ).toFixed(2),\n        paymentMethod: paymentMethodCode, // Sử dụng mã phương thức thanh toán thực tế\n        invoiceDate: new Date(),\n        status: \"draft\",\n        einvoiceStatus: 0, // 0 = Chưa phát hành\n        notes: `E-Invoice draft - MST: ${formData.taxCode || \"N/A\"}, Template: ${selectedTemplate?.name || \"N/A\"}, Đợi phát hành sau`,\n        items: cartItems.map((item) => {\n          const itemPrice =\n            typeof item.price === \"string\"\n              ? parseFloat(item.price)\n              : item.price;\n          const itemQuantity =\n            typeof item.quantity === \"string\"\n              ? parseInt(item.quantity)\n              : item.quantity;\n          const itemTaxRate =\n            typeof item.taxRate === \"string\"\n              ? parseFloat(item.taxRate || \"0\")\n              : item.taxRate || 0;\n          const itemSubtotal = itemPrice * itemQuantity;\n          const itemTax = (itemSubtotal * itemTaxRate) / 100;\n\n          return {\n            productId: item.id,\n            productName: item.name,\n            quantity: itemQuantity,\n            unitPrice: itemPrice.toFixed(2),\n            total: (itemSubtotal + itemTax).toFixed(2),\n            taxRate: itemTaxRate.toFixed(2),\n          };\n        }),\n      };\n\n      console.log(\n        \"💾 Lưu hóa đơn vào bảng invoices và invoice_items:\",\n        JSON.stringify(invoicePayload, null, 2),\n      );\n\n      // Lưu hóa đơn vào bảng invoices và invoice_items\n      const invoiceResponse = await fetch(\"/api/invoices\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(invoicePayload),\n      });\n\n      if (!invoiceResponse.ok) {\n        const errorText = await invoiceResponse.text();\n        console.error(\n          \"❌ Invoice save failed with status:\",\n          invoiceResponse.status,\n        );\n        console.error(\"❌ Error response:\", errorText);\n\n        let errorData;\n        try {\n          errorData = JSON.parse(errorText);\n        } catch {\n          errorData = { error: errorText };\n        }\n\n        throw new Error(\n          `Lưu hóa đơn thất bại: ${errorData.error || errorData.details || errorText}`,\n        );\n      }\n\n      const savedInvoice = await invoiceResponse.json();\n      console.log(\n        \"✅ Hóa đơn đã được lưu vào bảng invoices và invoice_items:\",\n        savedInvoice,\n      );\n\n      // Tạo receipt data thực sự cho receipt modal\n      const receiptData = {\n        transactionId:\n          savedInvoice.invoice?.invoiceNumber || `TXN-${Date.now()}`,\n        items: cartItems.map((item) => ({\n          id: item.id,\n          productId: item.id,\n          productName: item.name,\n          price:\n            typeof item.price === \"string\" ? item.price : item.price.toString(),\n          quantity:\n            typeof item.quantity === \"string\"\n              ? parseInt(item.quantity)\n              : item.quantity,\n          total: (\n            (typeof item.price === \"string\"\n              ? parseFloat(item.price)\n              : item.price) *\n            (typeof item.quantity === \"string\"\n              ? parseInt(item.quantity)\n              : item.quantity)\n          ).toFixed(2),\n          sku: item.sku || `FOOD${String(item.id).padStart(5, \"0\")}`,\n          taxRate:\n            typeof item.taxRate === \"string\"\n              ? parseFloat(item.taxRate || \"0\")\n              : item.taxRate || 0,\n        })),\n        subtotal: calculatedSubtotal.toFixed(2),\n        tax: calculatedTax.toFixed(2),\n        total: (typeof total === \"number\" && !isNaN(total)\n          ? total\n          : calculatedSubtotal + calculatedTax\n        ).toFixed(2),\n        paymentMethod: \"einvoice\",\n        amountReceived: (typeof total === \"number\" && !isNaN(total)\n          ? total\n          : calculatedSubtotal + calculatedTax\n        ).toFixed(2),\n        change: \"0.00\",\n        cashierName: \"System User\",\n        createdAt: new Date().toISOString(),\n      };\n\n      // Prepare the invoice data to be returned\n      const invoiceData = {\n        ...formData,\n        cartItems: cartItems,\n        total: total,\n        paymentMethod: \"einvoice\",\n        source: source || \"pos\",\n        invoiceId: savedInvoice.invoice?.id,\n        publishLater: true, // Flag to indicate this is for later publishing\n        receipt: receiptData, // Truyền receipt data thực sự\n      };\n\n      console.log(\n        \"🟡 Prepared invoice data for later publishing:\",\n        invoiceData,\n      );\n      console.log(\"📄 Receipt data created:\", receiptData);\n\n      // Show success message\n      toast({\n        title: \"Thành công\",\n        description:\n          \"Thông tin hóa đơn điện tử đã được lưu. Đang hiển thị màn hình in hóa đơn...\",\n      });\n\n      // Prepare comprehensive invoice data với receipt để hiển thị modal in\n      const completeInvoiceData = {\n        ...invoiceData,\n        paymentMethod: selectedPaymentMethod, // Use original payment method\n        originalPaymentMethod: selectedPaymentMethod,\n        publishLater: true,\n        receipt: receiptData, // Receipt data để hiển thị modal in\n        customerName: formData.customerName,\n        taxCode: formData.taxCode,\n        showReceiptModal: true, // Flag để parent component biết cần hiển thị receipt modal\n      };\n\n      console.log(\"✅ Prepared data for print dialog after publish later\");\n      console.log(\"📄 Receipt data to display:\", receiptData);\n\n      // Show print dialog instead of directly returning\n      setReceiptDataForPrint(receiptData);\n      setShowPrintDialog(true);\n    } catch (error) {\n      console.error(\"❌ Error in handlePublishLater:\", error);\n\n      let errorMessage = \"Có lỗi xảy ra khi lưu hóa đơn\";\n      if (error instanceof Error) {\n        errorMessage = `Có lỗi xảy ra khi lưu hóa đơn: ${error.message}`;\n      } else if (typeof error === \"string\") {\n        errorMessage = `Có lỗi xảy ra khi lưu hóa đơn: ${error}`;\n      } else {\n        errorMessage = `Có lỗi xảy ra khi lưu hóa đơn: ${JSON.stringify(error)}`;\n      }\n\n      toast({\n        variant: \"destructive\",\n        title: \"Lỗi\",\n        description: errorMessage,\n      });\n      return;\n    }\n  };\n\n  const handleConfirm = async () => {\n    // Validate required fields\n    if (!formData.invoiceProvider || !formData.customerName) {\n      alert(\n        \"Vui lòng điền đầy đủ thông tin bắt buộc: Đơn vị HĐĐT và Tên đơn vị\",\n      );\n      return;\n    }\n\n    if (!formData.selectedTemplateId) {\n      alert(\"Vui lòng chọn mẫu số hóa đơn\");\n      return;\n    }\n\n    setIsPublishing(true);\n    try {\n      // Debug log current cart items\n      console.log(\"=== PHÁT HÀNH HÓA ĐƠN - KIỂM TRA DỮ LIỆU ===\");\n      console.log(\"cartItems received:\", cartItems);\n      console.log(\"cartItems length:\", cartItems?.length || 0);\n      console.log(\"cartItems detailed:\", JSON.stringify(cartItems, null, 2));\n      console.log(\"total amount:\", total);\n\n      // Find the provider value from the EINVOICE_PROVIDERS mapping\n      const provider = EINVOICE_PROVIDERS.find(\n        (p) => p.name === formData.invoiceProvider,\n      );\n      const providerId = provider ? parseInt(provider.value) : 1;\n\n      // Get connection info from database based on selected provider\n      const connectionInfo = eInvoiceConnections.find(\n        (conn) =>\n          conn.softwareName === formData.invoiceProvider && conn.isActive,\n      );\n\n      if (!connectionInfo) {\n        alert(\n          `Không tìm thấy thông tin kết nối cho ${formData.invoiceProvider}. Vui lòng kiểm tra cấu hình trong Settings.`,\n        );\n        return;\n      }\n\n      // Validate cart items with detailed logging\n      console.log(\"🔍 VALIDATING CART ITEMS FOR E-INVOICE\");\n      console.log(\"Raw cartItems:\", JSON.stringify(cartItems, null, 2));\n      console.log(\"CartItems type:\", typeof cartItems);\n      console.log(\"CartItems is array:\", Array.isArray(cartItems));\n      console.log(\"CartItems length:\", cartItems?.length);\n\n      if (!cartItems || !Array.isArray(cartItems) || cartItems.length === 0) {\n        console.error(\"❌ No valid cart items found:\", {\n          cartItems,\n          isArray: Array.isArray(cartItems),\n          length: cartItems?.length,\n          total: total,\n        });\n        alert(\n          \"Không có sản phẩm nào trong giỏ hàng để tạo hóa đơn điện tử.\\n\\nDữ liệu nhận được:\\n- Số sản phẩm: \" +\n            (cartItems?.length || 0) +\n            \"\\n- Tổng tiền: \" +\n            total.toLocaleString(\"vi-VN\", {\n              minimumFractionDigits: 2,\n              maximumFractionDigits: 2,\n            }) +\n            \" ₫\\n\\nVui lòng thử lại từ màn hình bán hàng.\",\n        );\n        return;\n      }\n\n      // Validate each cart item has required data\n      const invalidItems = cartItems.filter((item) => {\n        const isValid =\n          item &&\n          (item.id || item.sku) &&\n          item.name &&\n          item.price !== undefined &&\n          item.price !== null &&\n          item.quantity !== undefined &&\n          item.quantity !== null &&\n          item.quantity > 0;\n\n        if (!isValid) {\n          console.log(\"❌ Invalid item found:\", item);\n        }\n        return !isValid;\n      });\n\n      if (invalidItems.length > 0) {\n        console.error(\"❌ Invalid cart items found:\", invalidItems);\n        alert(\n          `Có ${invalidItems.length} sản phẩm trong giỏ hàng thiếu thông tin:\\n${invalidItems.map((item) => `- ${item?.name || \"Không có tên\"}`).join(\"\\n\")}\\n\\nVui lòng kiểm tra lại giỏ hàng.`,\n        );\n        return;\n      }\n\n      console.log(\"✅ All cart items are valid for e-invoice generation\");\n\n      // Generate a new GUID for transactionID\n      const generateGuid = () => {\n        return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(\n          /[xy]/g,\n          function (c) {\n            const r = (Math.random() * 16) | 0;\n            const v = c === \"x\" ? r : (r & 0x3) | 0x8;\n            return v.toString(16);\n          },\n        );\n      };\n\n      // Calculate totals from real cart items\n      let cartSubtotal = 0;\n      let cartTaxAmount = 0;\n\n      // Convert cart items to invoice products with real data from shopping cart\n      const invoiceProducts = cartItems.map((item, index) => {\n        console.log(\n          `📦 Processing cart item ${index + 1} for e-invoice:`,\n          item,\n        );\n\n        // Ensure proper data types with robust parsing\n        const itemPrice = (() => {\n          if (typeof item.price === \"string\") {\n            const parsed = parseFloat(item.price);\n            return isNaN(parsed) ? 0 : parsed;\n          }\n          return typeof item.price === \"number\" ? item.price : 0;\n        })();\n\n        const itemQuantity = (() => {\n          if (typeof item.quantity === \"string\") {\n            const parsed = parseInt(item.quantity);\n            return isNaN(parsed) ? 1 : Math.max(1, parsed);\n          }\n          return typeof item.quantity === \"number\"\n            ? Math.max(1, item.quantity)\n            : 1;\n        })();\n\n        const itemTaxRate = (() => {\n          if (typeof item.taxRate === \"string\") {\n            const parsed = parseFloat(item.taxRate);\n            return isNaN(parsed) ? 0 : parsed;\n          }\n          return typeof item.taxRate === \"number\" ? item.taxRate : 0;\n        })();\n\n        // Calculate amounts\n        const itemSubtotal = itemPrice * itemQuantity;\n        const itemTax = (itemSubtotal * itemTaxRate) / 100;\n        const itemTotal = itemSubtotal + itemTax;\n\n        cartSubtotal += itemSubtotal;\n        cartTaxAmount += itemTax;\n\n        console.log(`💰 Item ${index + 1} calculations:`, {\n          name: item.name,\n          price: itemPrice,\n          quantity: itemQuantity,\n          taxRate: itemTaxRate,\n          subtotal: itemSubtotal,\n          tax: itemTax,\n          total: itemTotal,\n        });\n\n        return {\n          itmCd:\n            item.sku || `SP${String(item.id || index + 1).padStart(3, \"0\")}`, // Sử dụng SKU thực tế từ cart\n          itmName: item.name, // Sử dụng tên sản phẩm thực tế từ cart\n          itmKnd: 1, // Loại sản phẩm (1 = hàng hóa)\n          unitNm: \"Cái\", // Đơn vị tính\n          qty: itemQuantity, // Số lượng thực tế từ cart\n          unprc: itemPrice, // Đơn giá thực tế từ cart\n          amt: Math.round(itemSubtotal), // Thành tiền chưa thuế\n          discRate: 0, // Tỷ lệ chiết khấu\n          discAmt: 0, // Tiền chiết khấu\n          vatRt: itemTaxRate.toString(), // Thuế suất thực tế từ cart\n          vatAmt: Math.round(itemTax), // Tiền thuế tính từ dữ liệu thực tế\n          totalAmt: Math.round(itemTotal), // Tổng tiền có thuế tính từ dữ liệu thực tế\n        };\n      });\n\n      const cartTotal = cartSubtotal + cartTaxAmount;\n\n      console.log(\"💰 E-Invoice totals calculated from real cart data:\", {\n        subtotal: cartSubtotal,\n        tax: cartTaxAmount,\n        total: cartTotal,\n        itemsCount: invoiceProducts.length,\n      });\n\n      // Get selected template data for API mapping\n      const selectedTemplate = invoiceTemplates.find(\n        (template) => template.id.toString() === formData.selectedTemplateId,\n      );\n\n      if (!selectedTemplate) {\n        alert(\"Không tìm thấy thông tin mẫu số hóa đơn được chọn\");\n        return;\n      }\n\n      const publishRequest = {\n        login: {\n          providerId: providerId,\n          url: connectionInfo.loginUrl || \"https://infoerpvn.com:9440\",\n          ma_dvcs: connectionInfo.taxCode,\n          username: connectionInfo.loginId,\n          password: connectionInfo.password,\n          tenantId: \"\",\n        },\n        transactionID: generateGuid(),\n        invRef: `INV-${Date.now()}`,\n        invSubTotal: Math.round(cartSubtotal),\n        invVatRate: 10, // Default VAT rate\n        invVatAmount: Math.round(cartTaxAmount),\n        invDiscAmount: 0, // Chiết khấu\n        invTotalAmount: Math.round(cartTotal),\n        paidTp: \"TM\", // Cash payment\n        note: \"\",\n        hdNo: \"\",\n        createdDate: new Date().toISOString(),\n        clsfNo: selectedTemplate.templateNumber, // Mẫu số\n        spcfNo: selectedTemplate.name, // Tên\n        templateCode: selectedTemplate.templateCode || \"\", // Mã mẫu\n        buyerNotGetInvoice: 0,\n        exchCd: \"VND\",\n        exchRt: 1,\n        bankAccount: \"\",\n        bankName: \"\",\n        customer: {\n          custCd: formData.taxCode,\n          custNm: formData.customerName,\n          custCompany: formData.customerName,\n          taxCode: formData.taxCode,\n          custCity: \"\",\n          custDistrictName: \"\",\n          custAddrs: formData.address || \"\",\n          custPhone: formData.phoneNumber || \"\",\n          custBankAccount: \"\",\n          custBankName: \"\",\n          email: formData.email || \"\",\n          emailCC: \"\",\n        },\n        products: invoiceProducts,\n      };\n\n      console.log(\n        \"Publishing invoice with data:\",\n        JSON.stringify(publishRequest, null, 2),\n      );\n\n      // Call the proxy API\n      const response = await fetch(\"/api/einvoice/publish\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(publishRequest),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(\n          errorData.message ||\n            `API call failed: ${response.status} ${response.statusText}`,\n        );\n      }\n\n      const result = await response.json();\n      console.log(\"Invoice published successfully:\", result);\n\n      if (result.success) {\n        console.log(\n          \"✅ E-invoice published successfully, now saving invoice and order to database\",\n        );\n\n        // Lưu thông tin hóa đơn vào bảng invoices với mapping phương thức thanh toán\n        try {\n          // Map phương thức thanh toán theo yêu cầu\n          const paymentMethodCode = getPaymentMethodCode(selectedPaymentMethod);\n\n          const invoicePayload = {\n            invoiceNumber: result.data?.invoiceNo || null, // Số hóa đơn từ API response\n            templateNumber: selectedTemplate.templateNumber || null, // Mẫu số hóa đơn\n            symbol: selectedTemplate.symbol || null, // Ký hiệu hóa đơn\n            customerName: formData.customerName || \"Khách hàng\",\n            customerTaxCode: formData.taxCode || null,\n            customerAddress: formData.address || null,\n            customerPhone: formData.phoneNumber || null,\n            customerEmail: formData.email || null,\n            subtotal: cartSubtotal.toFixed(2),\n            tax: cartTaxAmount.toFixed(2),\n            total: cartTotal.toFixed(2),\n            paymentMethod: paymentMethodCode, // Sử dụng mã số thay vì text\n            invoiceDate: new Date(),\n            status: \"published\",\n            einvoiceStatus: 1, // 1 = Đã phát hành\n            notes: `E-Invoice published - Symbol: ${selectedTemplate.symbol || \"N/A\"}, Template: ${selectedTemplate.templateNumber || \"N/A\"}, Transaction ID: ${publishRequest.transactionID}, Invoice No: ${result.data?.invoiceNo || \"N/A\"}`,\n            items: cartItems.map((item) => {\n              const itemPrice =\n                typeof item.price === \"string\"\n                  ? parseFloat(item.price)\n                  : item.price;\n              const itemQuantity =\n                typeof item.quantity === \"string\"\n                  ? parseInt(item.quantity)\n                  : item.quantity;\n              const itemTaxRate =\n                typeof item.taxRate === \"string\"\n                  ? parseFloat(item.taxRate || \"0\")\n                  : item.taxRate || 0;\n              const itemSubtotal = itemPrice * itemQuantity;\n              const itemTax = (itemSubtotal * itemTaxRate) / 100;\n\n              return {\n                productId: item.id,\n                productName: item.name,\n                quantity: itemQuantity,\n                unitPrice: itemPrice.toFixed(2),\n                total: (itemSubtotal + itemTax).toFixed(2),\n                taxRate: itemTaxRate.toFixed(2),\n              };\n            }),\n          };\n\n          console.log(\n            \"💾 Saving published invoice to database:\",\n            invoicePayload,\n          );\n\n          const invoiceResponse = await fetch(\"/api/invoices\", {\n            method: \"POST\",\n            headers: {\n              \"Content-Type\": \"application/json\",\n            },\n            body: JSON.stringify(invoicePayload),\n          });\n\n          if (invoiceResponse.ok) {\n            const savedInvoice = await invoiceResponse.json();\n            console.log(\n              \"✅ Invoice saved to database successfully:\",\n              savedInvoice,\n            );\n          } else {\n            const errorText = await invoiceResponse.text();\n            console.error(\"❌ Failed to save invoice to database:\", errorText);\n          }\n        } catch (invoiceSaveError) {\n          console.error(\n            \"❌ Error saving invoice to database:\",\n            invoiceSaveError,\n          );\n        }\n\n        // Lưu đơn hàng vào bảng orders với trạng thái \"đã phát hành\"\n        try {\n          const orderStatus = \"paid\";\n          const publishType = \"publish\"; // Indicate that this is a direct publish\n          const einvoiceStatus = 1; // 1 = Đã phát hành\n\n          // Create order data\n          const orderData = {\n            orderNumber: `ORD-${Date.now()}`,\n            tableId: null, // No table for POS orders\n            customerName: formData.customerName,\n            customerPhone: formData.phoneNumber || null,\n            customerEmail: formData.email || null,\n            subtotal: cartSubtotal.toFixed(2),\n            tax: cartTaxAmount.toFixed(2),\n            total: cartTotal.toFixed(2),\n            status: orderStatus,\n            paymentMethod: publishType === \"publish\" ? \"cash\" : null, // Use 'cash' for published, null for draft\n            paymentStatus: publishType === \"publish\" ? \"paid\" : \"pending\",\n            einvoiceStatus: einvoiceStatus,\n            notes: `E-Invoice published - Tax Code: ${formData.taxCode || \"N/A\"}, Address: ${formData.address || \"N/A\"}`,\n            orderedAt: new Date(),\n            employeeId: null, // Can be set if employee info is available\n            salesChannel: \"pos\",\n          };\n\n          console.log(\"💾 Saving published order to database:\", orderData);\n\n          const saveResponse = await fetch(\"/api/orders\", {\n            method: \"POST\",\n            headers: {\n              \"Content-Type\": \"application/json\",\n            },\n            body: JSON.stringify(orderData),\n          });\n\n          if (saveResponse.ok) {\n            const savedOrder = await saveResponse.json();\n            console.log(\"✅ Order saved to database successfully:\", savedOrder);\n          } else {\n            console.error(\n              \"❌ Failed to save order to database:\",\n              await saveResponse.text(),\n            );\n          }\n        } catch (saveError) {\n          console.error(\"❌ Error saving order to database:\", saveError);\n        }\n\n        toast({\n          title: \"Thành công\",\n          description: `Hóa đơn điện tử đã được phát hành thành công!\\nSố hóa đơn: ${result.data?.invoiceNo || \"N/A\"}`,\n        });\n\n        // Tạo receipt data ngay sau khi phát hành thành công\n        const receiptData = {\n          transactionId: result.data?.invoiceNo || `TXN-${Date.now()}`,\n          items: cartItems.map((item) => {\n            const itemPrice =\n              typeof item.price === \"string\"\n                ? parseFloat(item.price)\n                : item.price;\n            const itemQuantity =\n              typeof item.quantity === \"string\"\n                ? parseInt(item.quantity)\n                : item.quantity;\n            const itemTaxRate =\n              typeof item.taxRate === \"string\"\n                ? parseFloat(item.taxRate || \"0\")\n                : item.taxRate || 0;\n            const itemSubtotal = itemPrice * itemQuantity;\n            const itemTax = (itemSubtotal * itemTaxRate) / 100;\n\n            return {\n              id: item.id,\n              productId: item.id,\n              productName: item.name,\n              price: itemPrice.toFixed(2),\n              quantity: itemQuantity,\n              total: (itemSubtotal + itemTax).toFixed(2),\n              sku: item.sku || `FOOD${String(item.id).padStart(5, \"0\")}`,\n              taxRate: itemTaxRate,\n            };\n          }),\n          subtotal: calculatedSubtotal.toFixed(2),\n          tax: calculatedTax.toFixed(2),\n          total: cartTotal.toFixed(2),\n          paymentMethod: \"einvoice\",\n          amountReceived: cartTotal.toFixed(2),\n          change: \"0.00\",\n          cashierName: \"System User\",\n          createdAt: new Date().toISOString(),\n          invoiceNumber: result.data?.invoiceNo || null,\n          customerName: formData.customerName,\n          customerTaxCode: formData.taxCode,\n        };\n\n        console.log(\n          \"📄 Created receipt data for published e-invoice:\",\n          receiptData,\n        );\n\n        // Prepare comprehensive invoice data with all necessary flags\n        const invoiceResult = {\n          ...formData,\n          invoiceData: result.data,\n          cartItems: cartItems,\n          total: total,\n          paymentMethod: selectedPaymentMethod, // Use original payment method\n          originalPaymentMethod: selectedPaymentMethod,\n          source: source || \"pos\",\n          orderId: orderId,\n          publishedImmediately: true, // Flag để phân biệt với phát hành sau\n          receipt: receiptData, // Truyền receipt data đã tạo\n          customerName: formData.customerName,\n          taxCode: formData.taxCode,\n          invoiceNumber: result.data?.invoiceNo || null,\n        };\n\n        console.log(\"✅ Prepared comprehensive invoice result:\", invoiceResult);\n\n        // --- CHANGE START ---\n        // Always show receipt after processing\n        const receiptDataToConfirm = {\n          transactionId: result.data?.invoiceNo || `TXN-${Date.now()}`,\n          items: cartItems.map((item) => {\n            const itemPrice =\n              typeof item.price === \"string\"\n                ? parseFloat(item.price)\n                : item.price;\n            const itemQuantity =\n              typeof item.quantity === \"string\"\n                ? parseInt(item.quantity)\n                : item.quantity;\n            const itemTaxRate =\n              typeof item.taxRate === \"string\"\n                ? parseFloat(item.taxRate || \"0\")\n                : item.taxRate || 0;\n            const itemSubtotal = itemPrice * itemQuantity;\n            const itemTax = (itemSubtotal * itemTaxRate) / 100;\n\n            return {\n              id: item.id,\n              productId: item.id,\n              productName: item.name,\n              price: itemPrice.toFixed(2),\n              quantity: itemQuantity,\n              total: (itemSubtotal + itemTax).toFixed(2),\n              sku: item.sku || `FOOD${String(item.id).padStart(5, \"0\")}`,\n              taxRate: itemTaxRate,\n            };\n          }),\n          subtotal: calculatedSubtotal.toFixed(2),\n          tax: calculatedTax.toFixed(2),\n          total: cartTotal.toFixed(2),\n          paymentMethod: \"einvoice\",\n          originalPaymentMethod: selectedPaymentMethod,\n          amountReceived: cartTotal.toFixed(2),\n          change: \"0.00\",\n          cashierName: \"System User\",\n          createdAt: new Date().toISOString(),\n          invoiceNumber: result.data?.invoiceNo || null,\n          customerName: formData.customerName,\n          customerTaxCode: formData.taxCode,\n        };\n\n        // Return comprehensive result for parent component to handle updates\n        const publishResult = {\n          success: true,\n          invoiceNumber: result.data?.invoiceNo || null,\n          symbol: selectedTemplate.symbol || null,\n          templateNumber: selectedTemplate.templateNumber || null,\n          einvoiceStatus: 1, // Đã phát hành\n          invoiceStatus: 1, // Hoàn thành\n          status: 'published',\n          receipt: receiptDataToConfirm,\n          publishedImmediately: true\n        };\n\n        console.log(\n          \"📧 Step 4: E-Invoice published, now showing print dialog\",\n        );\n        \n        // Show print dialog instead of directly returning\n        setReceiptDataForPrint(receiptDataToConfirm);\n        setShowPrintDialog(true);\n        // --- CHANGE END ---\n      } else {\n        throw new Error(\n          result.message || \"Có lỗi xảy ra khi phát hành hóa đơn\",\n        );\n      }\n    } catch (error) {\n      console.error(\"Error publishing invoice:\", error);\n      alert(`Có lỗi xảy ra khi phát hành hóa đơn: ${error}`);\n    } finally {\n      setIsPublishing(false);\n    }\n  };\n\n  const handleCancel = () => {\n    onClose();\n  };\n\n  const handlePrintDialogClose = () => {\n    setShowPrintDialog(false);\n    setReceiptDataForPrint(null);\n    \n    // Now close e-invoice modal and complete the flow\n    onClose();\n    \n    // Return appropriate data based on whether it was published or saved for later\n    if (receiptDataForPrint?.invoiceNumber) {\n      // Was published immediately\n      const publishResult = {\n        success: true,\n        invoiceNumber: receiptDataForPrint.invoiceNumber,\n        symbol: null,\n        templateNumber: null,\n        einvoiceStatus: 1, // Đã phát hành\n        invoiceStatus: 1, // Hoàn thành\n        status: 'published',\n        receipt: receiptDataForPrint,\n        publishedImmediately: true\n      };\n      onConfirm(publishResult);\n    } else {\n      // Was saved for later publishing\n      const completeInvoiceData = {\n        paymentMethod: selectedPaymentMethod,\n        originalPaymentMethod: selectedPaymentMethod,\n        publishLater: true,\n        receipt: receiptDataForPrint,\n        customerName: formData.customerName,\n        taxCode: formData.taxCode,\n        showReceiptModal: false // Don't show receipt modal again\n      };\n      onConfirm(completeInvoiceData);\n    }\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-2xl max-h-screen overflow-y-auto [&>button]:hidden\">\n        <DialogHeader>\n          <DialogTitle className=\"text-blue-700 bg-blue-100 p-3 rounded-t-lg\">\n            {t(\"einvoice.title\")}\n          </DialogTitle>\n        </DialogHeader>\n\n        <div className=\"p-6 space-y-6\">\n          {/* E-invoice Provider Information */}\n          <div>\n            <h3 className=\"text-base font-medium mb-4\">\n              {t(\"einvoice.providerInfo\")}\n            </h3>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <Label htmlFor=\"invoiceProvider\">\n                  {t(\"einvoice.providerUnit\")}\n                </Label>\n                <Select\n                  value={formData.invoiceProvider}\n                  onValueChange={(value) =>\n                    handleInputChange(\"invoiceProvider\", value)\n                  }\n                >\n                  <SelectTrigger>\n                    <SelectValue placeholder={t(\"einvoice.selectProvider\")} />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {EINVOICE_PROVIDERS.map((provider) => (\n                      <SelectItem key={provider.value} value={provider.name}>\n                        {provider.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <div>\n                <Label htmlFor=\"invoiceTemplate\">\n                  {t(\"einvoice.invoiceTemplate\")}\n                </Label>\n                <Select\n                  value={formData.selectedTemplateId}\n                  onValueChange={(value) =>\n                    handleInputChange(\"selectedTemplateId\", value)\n                  }\n                >\n                  <SelectTrigger>\n                    <SelectValue placeholder={t(\"einvoice.selectTemplate\")} />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {invoiceTemplates.map((template) => (\n                      <SelectItem\n                        key={template.id}\n                        value={template.id.toString()}\n                      >\n                        {template.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n          </div>\n\n          {/* Customer Information */}\n          <div>\n            <h3 className=\"text-base font-medium mb-4\">\n              {t(\"einvoice.customerInfo\")}\n            </h3>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <Label htmlFor=\"taxCode\">{t(\"einvoice.taxCode\")}</Label>\n                <div className=\"flex gap-2\">\n                  <Input\n                    id=\"taxCode\"\n                    ref={(el) => {\n                      inputRefs.current[\"taxCode\"] = el;\n                    }}\n                    value={formData.taxCode}\n                    onChange={(e) =>\n                      handleInputChange(\"taxCode\", e.target.value)\n                    }\n                    onFocus={() => handleInputFocus(\"taxCode\")}\n                    placeholder=\"0102222333-001\"\n                    disabled={false}\n                    readOnly={false}\n                  />\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    type=\"button\"\n                    onClick={handleGetTaxInfo}\n                    disabled={isTaxCodeLoading}\n                  >\n                    {isTaxCodeLoading ? (\n                      <>\n                        <div className=\"animate-spin w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full mr-2\" />\n                        Đang tải...\n                      </>\n                    ) : (\n                      t(\"einvoice.getInfo\")\n                    )}\n                  </Button>\n                </div>\n              </div>\n              <div>\n                <Label htmlFor=\"customerName\">\n                  {t(\"einvoice.companyName\")}\n                </Label>\n                <Input\n                  id=\"customerName\"\n                  ref={(el) => {\n                    inputRefs.current[\"customerName\"] = el;\n                  }}\n                  value={formData.customerName}\n                  onChange={(e) =>\n                    handleInputChange(\"customerName\", e.target.value)\n                  }\n                  onFocus={() => handleInputFocus(\"customerName\")}\n                  placeholder=\"Công ty TNHH ABC\"\n                  disabled={false}\n                  readOnly={false}\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"address\">{t(\"einvoice.address\")}</Label>\n                <Input\n                  id=\"address\"\n                  ref={(el) => {\n                    inputRefs.current[\"address\"] = el;\n                  }}\n                  value={formData.address}\n                  onChange={(e) => handleInputChange(\"address\", e.target.value)}\n                  onFocus={() => handleInputFocus(\"address\")}\n                  placeholder=\"Cầu Giấy, Hà Nội\"\n                  disabled={false}\n                  readOnly={false}\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"phoneNumber\">{t(\"einvoice.idNumber\")}</Label>\n                <Input\n                  id=\"phoneNumber\"\n                  ref={(el) => {\n                    inputRefs.current[\"phoneNumber\"] = el;\n                  }}\n                  value={formData.phoneNumber}\n                  onChange={(e) =>\n                    handleInputChange(\"phoneNumber\", e.target.value)\n                  }\n                  onFocus={() => handleInputFocus(\"phoneNumber\")}\n                  placeholder=\"0123456789\"\n                  disabled={false}\n                  readOnly={false}\n                />\n              </div>\n\n              <div>\n                <Label htmlFor=\"email\">{t(\"einvoice.email\")}</Label>\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  ref={(el) => {\n                    inputRefs.current[\"email\"] = el;\n                  }}\n                  value={formData.email}\n                  onChange={(e) => handleInputChange(\"email\", e.target.value)}\n                  onFocus={() => handleInputFocus(\"email\")}\n                  placeholder=\"ngocnv@gmail.com\"\n                  disabled={false}\n                  readOnly={false}\n                />\n              </div>\n            </div>\n          </div>\n\n          {/* Total Amount Display */}\n          <div className=\"bg-gray-50 p-4 rounded-lg\">\n            <div className=\"flex justify-between items-center\">\n              <span className=\"font-medium\">{t(\"einvoice.totalAmount\")}</span>\n              <span className=\"text-lg font-bold text-blue-600\">\n                {Math.floor(total).toLocaleString(\"vi-VN\")} ₫\n              </span>\n            </div>\n          </div>\n\n          {/* Virtual Keyboard Toggle */}\n          <div className=\"flex justify-center pt-2 border-t\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={toggleVirtualKeyboard}\n              className={`${showVirtualKeyboard ? \"bg-blue-100 border-blue-300\" : \"\"}`}\n            >\n              <Keyboard className=\"w-4 h-4 mr-2\" />\n              {showVirtualKeyboard ? \"Ẩn bàn phím\" : \"Hiện bàn phím ảo\"}\n            </Button>\n          </div>\n\n          {/* Virtual Keyboard */}\n          {showVirtualKeyboard && (\n            <div className=\"mt-4\">\n              <VirtualKeyboard\n                onKeyPress={handleVirtualKeyPress}\n                onBackspace={handleVirtualBackspace}\n                onEnter={handleVirtualEnter}\n                isVisible={showVirtualKeyboard}\n                className=\"mx-auto\"\n              />\n              {activeInputField && (\n                <p className=\"text-sm text-gray-600 text-center mt-2\">\n                  Đang nhập vào:{\" \"}\n                  {activeInputField === \"taxCode\"\n                    ? \"Mã số thuế\"\n                    : activeInputField === \"customerName\"\n                      ? \"Tên đơn vị\"\n                      : activeInputField === \"address\"\n                        ? \"Địa chỉ\"\n                        : activeInputField === \"phoneNumber\"\n                          ? \"Số điện thoại\"\n                          : activeInputField === \"email\"\n                            ? \"Email\"\n                            : activeInputField}\n                </p>\n              )}\n            </div>\n          )}\n\n          {/* Action Buttons */}\n          <div className=\"flex gap-3 pt-4 border-t\">\n            <Button\n              onClick={handleConfirm}\n              className=\"flex-1 bg-blue-600 hover:bg-blue-700 text-white\"\n              disabled={isPublishing}\n            >\n              {isPublishing ? (\n                <>\n                  <div className=\"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2\" />\n                  {t(\"einvoice.publishing\")}\n                </>\n              ) : (\n                <>\n                  <span className=\"mr-2\">✅</span>\n                  {t(\"einvoice.publish\")}\n                </>\n              )}\n            </Button>\n            <Button\n              onClick={handlePublishLater}\n              className=\"flex-1 bg-gray-500 hover:bg-gray-600 text-white\"\n              disabled={isPublishing}\n            >\n              <span className=\"mr-2\">⏳</span>\n              Phát hành sau\n            </Button>\n            <Button variant=\"outline\" onClick={handleCancel} className=\"flex-1\">\n              <span className=\"mr-2\">❌</span>\n              {t(\"einvoice.cancel\")}\n            </Button>\n          </div>\n        </div>\n      </DialogContent>\n\n      {/* Print Dialog - hiển thị sau khi xử lý hóa đơn điện tử */}\n      {showPrintDialog && receiptDataForPrint && (\n        <PrintDialog\n          isOpen={showPrintDialog}\n          onClose={handlePrintDialogClose}\n          receiptData={receiptDataForPrint}\n        />\n      )}\n    </Dialog>\n  );\n}","size_bytes":54541},"client/src/components/pos/header.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Link, useLocation } from \"wouter\";\nimport {\n  ScanBarcode,\n  Users,\n  Home,\n  Clock,\n  Utensils,\n  BarChart3,\n  ChevronDown,\n  Package,\n  Settings as SettingsIcon,\n  Building2,\n} from \"lucide-react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport logoPath from \"@assets/EDPOS_1753091767028.png\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport { LanguageSwitcher } from \"@/components/ui/language-switcher\";\nimport {\n  type StoreSettings,\n  type Employee,\n  type AttendanceRecord,\n} from \"@shared/schema\";\nimport { PieChart } from \"lucide-react\";\nimport {\n  Search,\n  Bell,\n  User,\n  Settings,\n  LogOut,\n  Calendar,\n  TrendingUp,\n  DollarSign,\n  FileText as ReportsIcon,\n  ShoppingCart as CartIcon,\n  FileText,\n  ShoppingCart,\n  Package2,\n  UserCheck,\n  Truck,\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\n\ninterface POSHeaderProps {\n  onLogout?: () => void;\n}\n\nexport function POSHeader({ onLogout }: POSHeaderProps) {\n  const { t } = useTranslation();\n  const [posMenuOpen, setPosMenuOpen] = useState(false);\n  const [reportsSubmenuOpen, setReportsSubmenuOpen] = useState(false);\n  const [currentTime, setCurrentTime] = useState(new Date());\n  const [location] = useLocation();\n  const [submenuTimer, setSubmenuTimer] = useState<NodeJS.Timeout | null>(null);\n  const [activeDropdown, setActiveDropdown] = useState<string | null>(null);\n\n  // Fetch store settings\n  const { data: storeSettings } = useQuery<StoreSettings>({\n    queryKey: [\"/api/store-settings\"],\n  });\n\n  // Fetch employees\n  const { data: employees } = useQuery<Employee[]>({\n    queryKey: [\"/api/employees\"],\n  });\n\n  // Fetch today's attendance records\n  const todayDate = new Date().toISOString().split(\"T\")[0];\n  const { data: todayAttendance } = useQuery<AttendanceRecord[]>({\n    queryKey: [\"/api/attendance\", todayDate],\n    queryFn: async () => {\n      const response = await fetch(`/api/attendance?date=${todayDate}`);\n      if (!response.ok) {\n        throw new Error(\"Failed to fetch attendance records\");\n      }\n      return response.json();\n    },\n  });\n\n  // Find current working cashier\n  const getCurrentCashier = () => {\n    if (!employees || !todayAttendance) return null;\n\n    // Get cashiers who are currently clocked in (have clock in but no clock out)\n    const workingCashiers = todayAttendance\n      .filter((record) => record.clockIn && !record.clockOut)\n      .map((record) => {\n        const employee = employees.find((emp) => emp.id === record.employeeId);\n        return employee && employee.role === \"cashier\" ? employee : null;\n      })\n      .filter(Boolean);\n\n    return workingCashiers.length > 0 ? workingCashiers[0] : null;\n  };\n\n  const currentCashier = getCurrentCashier();\n\n  useEffect(() => {\n    const timer = setInterval(() => {\n      setCurrentTime(new Date());\n    }, 1000);\n\n    return () => clearInterval(timer);\n  }, []);\n\n  // Handle submenu timing\n  const handleReportsMouseEnter = () => {\n    if (submenuTimer) {\n      clearTimeout(submenuTimer);\n      setSubmenuTimer(null);\n    }\n    setReportsSubmenuOpen(true);\n    setActiveDropdown(\"reports\");\n  };\n\n  const handleReportsMouseLeave = () => {\n    // Don't set timer here, let the container handle it\n  };\n\n  const handleSubmenuMouseEnter = () => {\n    if (submenuTimer) {\n      clearTimeout(submenuTimer);\n      setSubmenuTimer(null);\n    }\n  };\n\n  const handleSubmenuMouseLeave = () => {\n    // Don't set timer here, let the container handle it\n  };\n\n  const handleReportsContainerMouseLeave = () => {\n    const timer = setTimeout(() => {\n      setReportsSubmenuOpen(false);\n      setActiveDropdown(null);\n    }, 300);\n    setSubmenuTimer(timer);\n  };\n\n  // Close dropdown when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      const target = event.target as HTMLElement;\n      if (!target.closest(\".pos-dropdown\")) {\n        setPosMenuOpen(false);\n        setReportsSubmenuOpen(false);\n        setActiveDropdown(null);\n      }\n    };\n\n    if (posMenuOpen || reportsSubmenuOpen) {\n      document.addEventListener(\"click\", handleClickOutside);\n      return () => document.removeEventListener(\"click\", handleClickOutside);\n    }\n  }, [posMenuOpen, reportsSubmenuOpen]);\n\n  // Cleanup timer on unmount\n  useEffect(() => {\n    return () => {\n      if (submenuTimer) {\n        clearTimeout(submenuTimer);\n      }\n    };\n  }, [submenuTimer]);\n\n  const formatTime = (date: Date) => {\n    return date.toLocaleTimeString(\"en-US\", {\n      hour: \"numeric\",\n      minute: \"2-digit\",\n      hour12: true,\n    });\n  };\n\n  const handleLogout = () => {\n    // Xóa trạng thái đăng nhập khỏi sessionStorage\n    sessionStorage.removeItem(\"pinAuthenticated\");\n    // Gọi callback onLogout nếu có\n    if (onLogout) {\n      onLogout();\n    }\n    // Reload trang để quay về màn hình đăng nhập\n    window.location.reload();\n  };\n\n  return (\n    <header className=\"bg-green-500 text-white shadow-lg fixed top-0 left-0 right-0 z-50\">\n      <div className=\"px-6 py-4 flex justify-between items-center\">\n        <div className=\"flex items-center space-x-6\">\n          <div className=\"flex items-center\">\n            <img\n              src={logoPath}\n              alt=\"EDPOS Logo\"\n              className=\"h-12 cursor-pointer\"\n              onClick={() => (window.location.href = \"/pos\")}\n            />\n          </div>\n          <div className=\"opacity-90 font-semibold text-[20px]\">\n            {storeSettings?.storeName || t(\"common.restaurant\")}\n          </div>\n        </div>\n\n        <div className=\"flex items-center space-x-6\">\n          <div className=\"text-right\">\n            <div className=\"text-sm opacity-90\">{t(\"pos.cashierName\")}</div>\n            <div className=\"font-medium\">\n              {currentCashier ? currentCashier.name : t(\"pos.beforeWork\")}\n            </div>\n          </div>\n          <div className=\"text-right\">\n            <div className=\"text-sm opacity-90\">{t(\"common.time\")}</div>\n            <div className=\"font-medium\">{formatTime(currentTime)}</div>\n          </div>\n          {/* Navigation Menu */}\n          <nav className=\"flex items-center space-x-4\">\n            <div className=\"relative pos-dropdown\">\n              <button\n                className={`flex items-center px-4 py-2 rounded-full transition-all duration-200 ${\n                  [\n                    \"/\",\n                    \"/pos\",\n                    \"/tables\",\n                    \"/inventory\",\n                    \"/reports\",\n                    \"/employees\",\n                    \"/attendance\",\n                    \"/suppliers\",\n                    \"/settings\",\n                  ].includes(location)\n                    ? \"bg-white bg-opacity-20\"\n                    : \"hover:bg-white hover:bg-opacity-10\"\n                }`}\n                onClick={() => setPosMenuOpen(!posMenuOpen)}\n              >\n                <ScanBarcode className=\"w-4 h-4 mr-2\" />\n                {t(\"nav.pos\")}\n                <ChevronDown\n                  className={`w-4 h-4 ml-1 transition-transform ${posMenuOpen ? \"rotate-180\" : \"\"}`}\n                />\n              </button>\n\n              {/* Dropdown Menu */}\n              {posMenuOpen && (\n                <div className=\"absolute top-full right-0 mt-1 bg-white rounded-xl shadow-lg border border-gray-200 py-2 min-w-48 z-50\">\n                  {/* Only show Tables option for restaurant business type */}\n                  {storeSettings?.businessType === \"restaurant\" && (\n                    <Link href=\"/tables\">\n                      <button\n                        className={`w-full flex items-center px-4 py-2 text-left hover:bg-green-50 transition-colors ${\n                          location === \"/tables\"\n                            ? \"bg-green-50 text-green-600\"\n                            : \"text-gray-700\"\n                        }`}\n                        onClick={() => setPosMenuOpen(false)}\n                      >\n                        <Utensils className=\"w-4 h-4 mr-3\" />\n                        {t(\"nav.tablesSales\")}\n                      </button>\n                    </Link>\n                  )}\n\n                  <Link href=\"/pos\">\n                    <button\n                      className={`w-full flex items-center px-4 py-2 text-left hover:bg-green-50 transition-colors ${\n                        location === \"/pos\"\n                          ? \"bg-green-50 text-green-600\"\n                          : \"text-gray-700\"\n                      }`}\n                      onClick={() => setPosMenuOpen(false)}\n                    >\n                      <Home className=\"w-4 h-4 mr-3\" />\n                      {t(\"nav.directSales\")}\n                    </button>\n                  </Link>\n\n                  <div className=\"border-t border-gray-200 my-2\"></div>\n\n                  <Link href=\"/inventory\">\n                    <button\n                      className={`w-full flex items-center px-4 py-2 text-left hover:bg-green-50 transition-colors ${\n                        location === \"/inventory\"\n                          ? \"bg-green-50 text-green-600\"\n                          : \"text-gray-700\"\n                      }`}\n                      onClick={() => setPosMenuOpen(false)}\n                    >\n                      <Package className=\"w-4 h-4 mr-3\" />\n                      {t(\"nav.inventory\")}\n                    </button>\n                  </Link>\n                  <div\n                    className=\"relative\"\n                    onMouseLeave={handleReportsContainerMouseLeave}\n                  >\n                    <button\n                      className={`w-full flex items-center px-4 py-2 text-left hover:bg-green-50 transition-colors ${\n                        location === \"/reports\"\n                          ? \"bg-green-50 text-green-600\"\n                          : \"text-gray-700\"\n                      }`}\n                      onClick={(e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        setReportsSubmenuOpen(!reportsSubmenuOpen);\n                        setActiveDropdown(\n                          reportsSubmenuOpen ? null : \"reports\",\n                        );\n                      }}\n                      onMouseEnter={handleReportsMouseEnter}\n                    >\n                      <BarChart3 className=\"w-4 h-4 mr-3\" />\n                      {t(\"nav.reports\")}\n                      <ChevronDown\n                        className={`w-4 h-4 ml-auto transition-transform ${reportsSubmenuOpen ? \"rotate-180\" : \"\"}`}\n                      />\n                    </button>\n                    {reportsSubmenuOpen && (\n                      <div className=\"absolute top-0 right-full mr-0.5 bg-white rounded-xl shadow-lg border border-gray-200 py-2 min-w-48 z-50 max-w-xs sm:max-w-none\">\n                        <Link href=\"/reports?tab=overview\">\n                          <button\n                            className={`w-full flex items-center px-2 py-1.5 text-xs sm:text-sm rounded transition-colors ${\n                              activeDropdown === \"reports\" &&\n                              window.location.search === \"?tab=overview\"\n                                ? \"text-blue-600 bg-blue-50\"\n                                : \"text-gray-700 hover:text-blue-600 hover:bg-gray-50\"\n                            }`}\n                            onClick={() => {\n                              setActiveDropdown(null);\n                              setPosMenuOpen(false);\n                              setReportsSubmenuOpen(false);\n                            }}\n                          >\n                            <TrendingUp className=\"w-3 h-3 sm:w-4 sm:h-4 mr-2 sm:mr-3 flex-shrink-0\" />\n                            <span className=\"truncate\">\n                              {t(\"reports.dashboard\")}\n                            </span>\n                          </button>\n                        </Link>\n                        <Link href=\"/reports?tab=sales\">\n                          <button\n                            className={`w-full flex items-center px-2 py-1.5 text-xs sm:text-sm rounded transition-colors ${\n                              activeDropdown === \"reports\" &&\n                              window.location.search === \"?tab=sales\"\n                                ? \"text-blue-600 bg-blue-50\"\n                                : \"text-gray-700 hover:text-blue-600 hover:bg-gray-50\"\n                            }`}\n                            onClick={() => {\n                              setActiveDropdown(null);\n                              setPosMenuOpen(false);\n                              setReportsSubmenuOpen(false);\n                            }}\n                          >\n                            <BarChart3 className=\"w-3 h-3 sm:w-4 sm:h-4 mr-2 sm:mr-3 flex-shrink-0\" />\n                            <span className=\"truncate\">\n                              {t(\"reports.salesAnalysis\")}\n                            </span>\n                          </button>\n                        </Link>\n                        <Link href=\"/reports?tab=menu\">\n                          <button\n                            className={`w-full flex items-center px-2 py-1.5 text-xs sm:text-sm rounded transition-colors ${\n                              activeDropdown === \"reports\" &&\n                              window.location.search === \"?tab=menu\"\n                                ? \"text-blue-600 bg-blue-50\"\n                                : \"text-gray-700 hover:text-blue-600 hover:bg-gray-50\"\n                            }`}\n                            onClick={() => {\n                              setActiveDropdown(null);\n                              setPosMenuOpen(false);\n                              setReportsSubmenuOpen(false);\n                            }}\n                          >\n                            <PieChart className=\"w-3 h-3 sm:w-4 sm:h-4 mr-2 sm:mr-3 flex-shrink-0\" />\n                            <span className=\"truncate\">\n                              {t(\"reports.menuAnalysis\")}\n                            </span>\n                          </button>\n                        </Link>\n                        <Link href=\"/reports?tab=table\">\n                          <button\n                            className={`w-full flex items-center px-2 py-1.5 text-xs sm:text-sm rounded transition-colors ${\n                              activeDropdown === \"reports\" &&\n                              window.location.search === \"?tab=table\"\n                                ? \"text-blue-600 bg-blue-50\"\n                                : \"text-gray-700 hover:text-blue-600 hover:bg-gray-50\"\n                            }`}\n                            onClick={() => {\n                              setActiveDropdown(null);\n                              setPosMenuOpen(false);\n                              setReportsSubmenuOpen(false);\n                            }}\n                          >\n                            <Utensils className=\"w-3 h-3 sm:w-4 sm:h-4 mr-2 sm:mr-3 flex-shrink-0\" />\n                            <span className=\"truncate\">\n                              {t(\"reports.tableAnalysis\")}\n                            </span>\n                          </button>\n                        </Link>\n                        <Link href=\"/reports?tab=saleschart\">\n                          <button\n                            className={`w-full flex items-center px-2 py-1.5 text-xs sm:text-sm rounded transition-colors ${\n                              activeDropdown === \"reports\" &&\n                              window.location.search === \"?tab=saleschart\"\n                                ? \"text-blue-600 bg-blue-50\"\n                                : \"text-gray-700 hover:text-blue-600 hover:bg-gray-50\"\n                            }`}\n                            onClick={() => {\n                              setActiveDropdown(null);\n                              setPosMenuOpen(false);\n                              setReportsSubmenuOpen(false);\n                            }}\n                          >\n                            <BarChart3 className=\"w-3 h-3 sm:w-4 sm:h-4 mr-2 sm:mr-3 flex-shrink-0\" />\n                            <span className=\"truncate\">\n                              {t(\"reports.salesReport\")}\n                            </span>\n                          </button>\n                        </Link>\n                        \n                        \n                      </div>\n                    )}\n                  </div>\n\n                  <div className=\"border-t border-gray-200 my-2\"></div>\n\n                  <Link href=\"/employees\">\n                    <button\n                      className={`w-full flex items-center px-4 py-2 text-left hover:bg-green-50 transition-colors ${\n                        location === \"/employees\"\n                          ? \"bg-green-50 text-green-600\"\n                          : \"text-gray-700\"\n                      }`}\n                      onClick={() => setPosMenuOpen(false)}\n                    >\n                      <Users className=\"w-4 h-4 mr-3\" />\n                      {t(\"nav.employees\")}\n                    </button>\n                  </Link>\n\n                  <Link href=\"/attendance\">\n                    <button\n                      className={`w-full flex items-center px-4 py-2 text-left hover:bg-green-50 transition-colors ${\n                        location === \"/attendance\"\n                          ? \"bg-green-50 text-green-600\"\n                          : \"text-gray-700\"\n                      }`}\n                      onClick={() => setPosMenuOpen(false)}\n                    >\n                      <Clock className=\"w-4 h-4 mr-3\" />\n                      {t(\"nav.attendance\")}\n                    </button>\n                  </Link>\n\n                  <Link href=\"/suppliers\">\n                    <button\n                      className={`w-full flex items-center px-4 py-2 text-left hover:bg-green-50 transition-colors ${\n                        location === \"/suppliers\"\n                          ? \"bg-green-50 text-green-600\"\n                          : \"text-gray-700\"\n                      }`}\n                      onClick={() => setPosMenuOpen(false)}\n                    >\n                      <Building2 className=\"w-4 h-4 mr-3\" />\n                      {t(\"nav.suppliers\")}\n                    </button>\n                  </Link>\n\n                  <div className=\"border-t border-gray-200 my-2\"></div>\n\n                  <Link href=\"/settings\">\n                    <button\n                      className={`w-full flex items-center px-4 py-2 text-left hover:bg-green-50 transition-colors ${\n                        location === \"/settings\"\n                          ? \"bg-green-50 text-green-600\"\n                          : \"text-gray-700\"\n                      }`}\n                      onClick={() => setPosMenuOpen(false)}\n                    >\n                      <SettingsIcon className=\"w-4 h-4 mr-3\" />\n                      {t(\"settings.title\")}\n                    </button>\n                  </Link>\n\n                  <div className=\"border-t border-gray-200 my-2\"></div>\n\n                  <a\n                    href=\"/customer-display\"\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    className=\"w-full flex items-center px-4 py-2 text-left hover:bg-blue-50 hover:text-blue-600 text-gray-700 transition-colors\"\n                    onClick={() => setPosMenuOpen(false)}\n                  >\n                    <Users className=\"w-4 h-4 mr-3\" />\n                    Màn hình khách hàng\n                  </a>\n\n                  <div className=\"border-t border-gray-200 my-2\"></div>\n\n                  <button\n                    className=\"w-full flex items-center px-4 py-2 text-left hover:bg-red-50 hover:text-red-600 text-gray-700 transition-colors\"\n                    onClick={() => {\n                      setPosMenuOpen(false);\n                      handleLogout();\n                    }}\n                  >\n                    <LogOut className=\"w-4 h-4 mr-3\" />\n                    Đăng xuất\n                  </button>\n                </div>\n              )}\n            </div>\n          </nav>\n\n          <LanguageSwitcher />\n        </div>\n      </div>\n    </header>\n  );\n}\n","size_bytes":20482},"client/src/components/pos/invoice-management-modal.tsx":{"content":"\nimport { useState } from \"react\";\nimport { X, Eye, Calendar, User, FileText, CreditCard } from \"lucide-react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Separator } from \"@/components/ui/separator\";\n\ninterface Invoice {\n  id: number;\n  invoiceNumber: string;\n  tradeNumber: string;\n  templateNumber?: string;\n  symbol?: string;\n  customerName: string;\n  customerTaxCode?: string;\n  customerAddress?: string;\n  customerPhone?: string;\n  customerEmail?: string;\n  subtotal: string;\n  tax: string;\n  total: string;\n  paymentMethod: string;\n  invoiceDate: string;\n  status: string;\n  einvoiceStatus: number;\n  notes?: string;\n  createdAt: string;\n}\n\ninterface InvoiceItem {\n  id: number;\n  invoiceId: number;\n  productId: number;\n  productName: string;\n  quantity: number;\n  unitPrice: string;\n  total: string;\n  taxRate: string;\n}\n\ninterface InvoiceManagementModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nexport function InvoiceManagementModal({\n  isOpen,\n  onClose,\n}: InvoiceManagementModalProps) {\n  const { t } = useTranslation();\n  const [selectedInvoice, setSelectedInvoice] = useState<Invoice | null>(null);\n  const [showInvoiceDetail, setShowInvoiceDetail] = useState(false);\n\n  // Fetch invoices list\n  const { data: invoices = [], isLoading } = useQuery<Invoice[]>({\n    queryKey: [\"/api/invoices\"],\n    queryFn: async () => {\n      const response = await apiRequest(\"GET\", \"/api/invoices\");\n      return response.json();\n    },\n    enabled: isOpen,\n  });\n\n  // Fetch invoice items for selected invoice\n  const { data: invoiceItems = [] } = useQuery<InvoiceItem[]>({\n    queryKey: [\"/api/invoice-items\", selectedInvoice?.id],\n    queryFn: async () => {\n      if (!selectedInvoice?.id) return [];\n      const response = await apiRequest(\"GET\", `/api/invoice-items/${selectedInvoice.id}`);\n      return response.json();\n    },\n    enabled: !!selectedInvoice?.id,\n  });\n\n  const handleViewDetails = (invoice: Invoice) => {\n    setSelectedInvoice(invoice);\n    setShowInvoiceDetail(true);\n  };\n\n  const getStatusBadge = (status: string) => {\n    const statusConfig = {\n      draft: { label: \"Nháp\", variant: \"secondary\" as const },\n      published: { label: \"Đã phát hành\", variant: \"default\" as const },\n      cancelled: { label: \"Đã hủy\", variant: \"destructive\" as const },\n    };\n\n    const config = statusConfig[status as keyof typeof statusConfig] || {\n      label: status,\n      variant: \"outline\" as const,\n    };\n\n    return <Badge variant={config.variant}>{config.label}</Badge>;\n  };\n\n  const getEInvoiceStatusBadge = (status: number) => {\n    const statusConfig = {\n      0: { label: \"Chưa phát hành\", variant: \"secondary\" as const },\n      1: { label: \"Đã phát hành\", variant: \"default\" as const },\n      2: { label: \"Tạo nháp\", variant: \"outline\" as const },\n      3: { label: \"Đã duyệt\", variant: \"default\" as const },\n      4: { label: \"Đã bị thay thế\", variant: \"destructive\" as const },\n      5: { label: \"Thay thế tạm\", variant: \"secondary\" as const },\n      6: { label: \"Thay thế\", variant: \"default\" as const },\n      7: { label: \"Đã bị điều chỉnh\", variant: \"destructive\" as const },\n      8: { label: \"Điều chỉnh tạm\", variant: \"secondary\" as const },\n      9: { label: \"Điều chỉnh\", variant: \"default\" as const },\n      10: { label: \"Đã hủy\", variant: \"destructive\" as const },\n    };\n\n    const config = statusConfig[status as keyof typeof statusConfig] || {\n      label: `Trạng thái ${status}`,\n      variant: \"outline\" as const,\n    };\n\n    return <Badge variant={config.variant}>{config.label}</Badge>;\n  };\n\n  const formatCurrency = (amount: string) => {\n    return new Intl.NumberFormat('vi-VN', {\n      style: 'currency',\n      currency: 'VND'\n    }).format(parseFloat(amount));\n  };\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('vi-VN', {\n      year: 'numeric',\n      month: '2-digit',\n      day: '2-digit',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  const getPaymentMethodName = (paymentMethod: string) => {\n    // Convert string to number for comparison\n    const methodType = parseInt(paymentMethod);\n    \n    switch (methodType) {\n      case 1:\n        return t('common.cash'); // \"Tiền mặt\"\n      case 2:\n        return 'Chuyển khoản'; // Bank transfer\n      case 3:\n        return 'TM/CK'; // Cash/Bank transfer combination\n      case 4:\n        return 'Đối trừ công nợ'; // Debt offset\n      default:\n        return paymentMethod; // Return original value if not numeric\n    }\n  };\n\n  return (\n    <>\n      {/* Main Invoice List Modal */}\n      <Dialog open={isOpen && !showInvoiceDetail} onOpenChange={onClose}>\n        <DialogContent className=\"max-w-6xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <FileText className=\"w-5 h-5\" />\n              Quản lý hóa đơn\n            </DialogTitle>\n          </DialogHeader>\n\n          <div className=\"space-y-4\">\n            {isLoading ? (\n              <div className=\"text-center py-8\">\n                <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto\"></div>\n                <p className=\"mt-2 text-gray-500\">Đang tải danh sách hóa đơn...</p>\n              </div>\n            ) : invoices.length === 0 ? (\n              <div className=\"text-center py-8\">\n                <FileText className=\"w-12 h-12 text-gray-400 mx-auto mb-2\" />\n                <p className=\"text-gray-500\">Chưa có hóa đơn nào</p>\n              </div>\n            ) : (\n              <div className=\"overflow-x-auto\">\n                <table className=\"w-full border-collapse\">\n                  <thead>\n                    <tr className=\"border-b bg-gray-50\">\n                      <th className=\"text-left p-3 font-medium\">Số giao dịch</th>\n                      <th className=\"text-left p-3 font-medium\">Số hóa đơn</th>\n                      <th className=\"text-left p-3 font-medium\">Khách hàng</th>\n                      <th className=\"text-left p-3 font-medium\">Tổng tiền</th>\n                      <th className=\"text-left p-3 font-medium\">Thanh toán</th>\n                      <th className=\"text-left p-3 font-medium\">Trạng thái</th>\n                      <th className=\"text-left p-3 font-medium\">Ngày tạo</th>\n                      <th className=\"text-center p-3 font-medium\">Thao tác</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {invoices.map((invoice) => (\n                      <tr key={invoice.id} className=\"border-b hover:bg-gray-50\">\n                        <td className=\"p-3\">\n                          <div className=\"font-mono text-sm\">{invoice.tradeNumber}</div>\n                        </td>\n                        <td className=\"p-3\">\n                          <div className=\"font-mono text-sm\">{invoice.invoiceNumber || \"Chưa có\"}</div>\n                          {invoice.templateNumber && (\n                            <div className=\"text-sm text-gray-500\">Mẫu: {invoice.templateNumber}</div>\n                          )}\n                          {invoice.symbol && (\n                            <div className=\"text-sm text-gray-500\">Kí hiệu: {invoice.symbol}</div>\n                          )}\n                        </td>\n                        <td className=\"p-3\">\n                          <div className=\"font-medium\">{invoice.customerName}</div>\n                          {invoice.customerTaxCode && (\n                            <div className=\"text-sm text-gray-500\">MST: {invoice.customerTaxCode}</div>\n                          )}\n                        </td>\n                        <td className=\"p-3\">\n                          <div className=\"font-medium\">{formatCurrency(invoice.total)}</div>\n                          <div className=\"text-sm text-gray-500\">\n                            Thuế: {formatCurrency(invoice.tax)}\n                          </div>\n                        </td>\n                        <td className=\"p-3\">\n                          <Badge variant=\"outline\">{getPaymentMethodName(invoice.paymentMethod)}</Badge>\n                        </td>\n                        <td className=\"p-3\">\n                          {getEInvoiceStatusBadge(invoice.einvoiceStatus)}\n                        </td>\n                        <td className=\"p-3\">\n                          <div className=\"text-sm\">{formatDate(invoice.createdAt)}</div>\n                        </td>\n                        <td className=\"p-3 text-center\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => handleViewDetails(invoice)}\n                            className=\"text-blue-600 hover:text-blue-800\"\n                          >\n                            <Eye className=\"w-4 h-4\" />\n                          </Button>\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n            )}\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Invoice Detail Modal */}\n      <Dialog open={showInvoiceDetail} onOpenChange={() => setShowInvoiceDetail(false)}>\n        <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <FileText className=\"w-5 h-5\" />\n              Chi tiết hóa đơn: {selectedInvoice?.invoiceNumber}\n            </DialogTitle>\n          </DialogHeader>\n\n          {selectedInvoice && (\n            <div className=\"space-y-6\">\n              {/* Invoice Header Information */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <User className=\"w-4 h-4\" />\n                    Thông tin hóa đơn\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div>\n                      <label className=\"text-sm font-medium text-gray-500\">Số hóa đơn</label>\n                      <p className=\"font-mono\">{selectedInvoice.invoiceNumber}</p>\n                    </div>\n                    <div>\n                      <label className=\"text-sm font-medium text-gray-500\">Ngày tạo</label>\n                      <p>{formatDate(selectedInvoice.createdAt)}</p>\n                    </div>\n                    <div>\n                      <label className=\"text-sm font-medium text-gray-500\">Khách hàng</label>\n                      <p className=\"font-medium\">{selectedInvoice.customerName}</p>\n                    </div>\n                    <div>\n                      <label className=\"text-sm font-medium text-gray-500\">Mã số thuế</label>\n                      <p>{selectedInvoice.customerTaxCode || \"Không có\"}</p>\n                    </div>\n                    <div>\n                      <label className=\"text-sm font-medium text-gray-500\">Số điện thoại</label>\n                      <p>{selectedInvoice.customerPhone || \"Không có\"}</p>\n                    </div>\n                    <div>\n                      <label className=\"text-sm font-medium text-gray-500\">Email</label>\n                      <p>{selectedInvoice.customerEmail || \"Không có\"}</p>\n                    </div>\n                    <div className=\"md:col-span-2\">\n                      <label className=\"text-sm font-medium text-gray-500\">Địa chỉ</label>\n                      <p>{selectedInvoice.customerAddress || \"Không có\"}</p>\n                    </div>\n                    <div>\n                      <label className=\"text-sm font-medium text-gray-500\">Trạng thái</label>\n                      <div>{getStatusBadge(selectedInvoice.status)}</div>\n                    </div>\n                    <div>\n                      <label className=\"text-sm font-medium text-gray-500\">Trạng thái HĐĐT</label>\n                      <div>{getEInvoiceStatusBadge(selectedInvoice.einvoiceStatus)}</div>\n                    </div>\n                  </div>\n                  {selectedInvoice.notes && (\n                    <div>\n                      <label className=\"text-sm font-medium text-gray-500\">Ghi chú</label>\n                      <p className=\"text-sm bg-gray-50 p-2 rounded\">{selectedInvoice.notes}</p>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n\n              {/* Invoice Items */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <CreditCard className=\"w-4 h-4\" />\n                    Chi tiết sản phẩm\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  {invoiceItems.length === 0 ? (\n                    <p className=\"text-gray-500 text-center py-4\">Không có sản phẩm nào</p>\n                  ) : (\n                    <div className=\"overflow-x-auto\">\n                      <table className=\"w-full\">\n                        <thead>\n                          <tr className=\"border-b\">\n                            <th className=\"text-left p-2\">Tên sản phẩm</th>\n                            <th className=\"text-center p-2\">Số lượng</th>\n                            <th className=\"text-right p-2\">Đơn giá</th>\n                            <th className=\"text-center p-2\">Thuế suất</th>\n                            <th className=\"text-right p-2\">Thành tiền</th>\n                          </tr>\n                        </thead>\n                        <tbody>\n                          {invoiceItems.map((item) => (\n                            <tr key={item.id} className=\"border-b\">\n                              <td className=\"p-2\">{item.productName}</td>\n                              <td className=\"p-2 text-center\">{item.quantity}</td>\n                              <td className=\"p-2 text-right\">{formatCurrency(item.unitPrice)}</td>\n                              <td className=\"p-2 text-center\">{item.taxRate}%</td>\n                              <td className=\"p-2 text-right font-medium\">{formatCurrency(item.total)}</td>\n                            </tr>\n                          ))}\n                        </tbody>\n                      </table>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n\n              {/* Invoice Summary */}\n              <Card>\n                <CardHeader>\n                  <CardTitle>Tổng kết thanh toán</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-2\">\n                    <div className=\"flex justify-between\">\n                      <span>Tạm tính:</span>\n                      <span>{formatCurrency(selectedInvoice.subtotal)}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span>Thuế:</span>\n                      <span>{formatCurrency(selectedInvoice.tax)}</span>\n                    </div>\n                    <Separator />\n                    <div className=\"flex justify-between font-bold text-lg\">\n                      <span>Tổng cộng:</span>\n                      <span>{formatCurrency(selectedInvoice.total)}</span>\n                    </div>\n                    <div className=\"flex justify-between text-sm text-gray-600\">\n                      <span>Phương thức thanh toán:</span>\n                      <Badge variant=\"outline\">{getPaymentMethodName(selectedInvoice.paymentMethod)}</Badge>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Action Buttons */}\n              <div className=\"flex justify-end gap-2\">\n                <Button\n                  variant=\"outline\"\n                  onClick={() => setShowInvoiceDetail(false)}\n                >\n                  Đóng\n                </Button>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n}\n","size_bytes":16772},"client/src/components/pos/payment-method-modal.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport {\n  CreditCard,\n  Banknote,\n  Smartphone,\n  Wallet,\n  QrCode,\n  Keyboard,\n} from \"lucide-react\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport QRCodeLib from \"qrcode\";\nimport { createQRPosAsync, type CreateQRPosRequest } from \"@/lib/api\";\nimport { EInvoiceModal } from \"./einvoice-modal\";\nimport { usePopupSignal } from \"@/hooks/use-popup-signal\";\nimport VirtualKeyboard from \"@/components/ui/virtual-keyboard\";\n\ninterface PaymentMethodModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSelectMethod: (method: string, data?: any) => void;\n  total: number;\n  onShowEInvoice?: () => void;\n  cartItems?: Array<{\n    id: number;\n    name: string;\n    price: number;\n    quantity: number;\n    sku?: string;\n    taxRate?: number;\n    afterTaxPrice?: number | string | null | \"\";\n  }>;\n  orderForPayment?: any; // Add orderForPayment prop for exact values\n  products?: any[]; // Add products prop for tax rate and afterTaxPrice lookup\n  getProductName?: (productId: number | string) => string; // Add getProductName function\n  receipt?: any; // Add receipt prop to receive exact total from receipt modal\n}\n\nexport function PaymentMethodModal({\n  isOpen,\n  onClose,\n  onSelectMethod,\n  total,\n  onShowEInvoice,\n  cartItems = [],\n  orderForPayment, // Receive orderForPayment prop\n  products, // Receive products prop\n  getProductName, // Receive getProductName function\n  receipt, // Receive receipt prop\n}: PaymentMethodModalProps) {\n  const { t } = useTranslation();\n  const [showQRCode, setShowQRCode] = useState(false);\n  const [qrCodeUrl, setQrCodeUrl] = useState(\"\");\n  const [showEInvoice, setShowEInvoice] = useState(false);\n  const [selectedPaymentMethod, setSelectedPaymentMethod] = useState(\"\");\n  const [qrLoading, setQrLoading] = useState(false);\n  const [amountReceived, setAmountReceived] = useState(\"\");\n  const [showCashPayment, setShowCashPayment] = useState(false);\n  const [currentTransactionUuid, setCurrentTransactionUuid] = useState<\n    string | null\n  >(null);\n  const [showVirtualKeyboard, setShowVirtualKeyboard] = useState(false);\n\n  // Separate state for cash payment to avoid sharing with other screens\n  const [cashAmountInput, setCashAmountInput] = useState(\"\");\n\n  const amountInputRef = useRef<HTMLInputElement>(null);\n  const { listenForPaymentSuccess, removePaymentListener } = usePopupSignal();\n\n  // Load payment methods from settings\n  const getPaymentMethods = () => {\n    const savedPaymentMethods = localStorage.getItem(\"paymentMethods\");\n\n    const defaultPaymentMethods = [\n      {\n        id: 1,\n        nameKey: \"cash\",\n        type: \"cash\",\n        enabled: true,\n        icon: \"💵\",\n      },\n      {\n        id: 2,\n        nameKey: \"creditCard\",\n        type: \"card\",\n        enabled: false,\n        icon: \"💳\",\n      },\n      {\n        id: 3,\n        nameKey: \"debitCard\",\n        type: \"debit\",\n        enabled: false,\n        icon: \"💳\",\n      },\n      {\n        id: 4,\n        nameKey: \"momo\",\n        type: \"digital\",\n        enabled: false,\n        icon: \"📱\",\n      },\n      {\n        id: 5,\n        nameKey: \"zalopay\",\n        type: \"digital\",\n        enabled: false,\n        icon: \"📱\",\n      },\n      {\n        id: 6,\n        nameKey: \"vnpay\",\n        type: \"digital\",\n        enabled: false,\n        icon: \"💳\",\n      },\n      {\n        id: 7,\n        nameKey: \"qrCode\",\n        type: \"qr\",\n        enabled: true,\n        icon: \"📱\",\n      },\n      {\n        id: 8,\n        nameKey: \"shopeepay\",\n        type: \"digital\",\n        enabled: false,\n        icon: \"🛒\",\n      },\n      {\n        id: 9,\n        nameKey: \"grabpay\",\n        type: \"digital\",\n        enabled: false,\n        icon: \"🚗\",\n      },\n    ];\n\n    const paymentMethods = savedPaymentMethods\n      ? JSON.parse(savedPaymentMethods)\n      : defaultPaymentMethods;\n\n    console.log(\"All payment methods:\", paymentMethods);\n\n    // Ensure cash payment is always available\n    const cashMethodExists = paymentMethods.find(\n      (method) => method.nameKey === \"cash\" && method.enabled,\n    );\n    if (!cashMethodExists) {\n      const cashMethod = paymentMethods.find(\n        (method) => method.nameKey === \"cash\",\n      );\n      if (cashMethod) {\n        cashMethod.enabled = true;\n      } else {\n        paymentMethods.unshift({\n          id: 1,\n          nameKey: \"cash\",\n          type: \"cash\",\n          enabled: true,\n          icon: \"💵\",\n        });\n      }\n    }\n\n    // Filter to only return enabled payment methods and map to modal format\n    const enabledMethods = paymentMethods\n      .filter((method) => method.enabled === true)\n      .map((method) => ({\n        id: method.nameKey,\n        name: getPaymentMethodName(method.nameKey),\n        icon: getIconComponent(method.type),\n        description: getMethodDescription(method.nameKey),\n      }));\n\n    console.log(\"Enabled payment methods:\", enabledMethods);\n    return enabledMethods;\n  };\n\n  const getIconComponent = (type: string) => {\n    switch (type) {\n      case \"cash\":\n        return Banknote;\n      case \"card\":\n      case \"debit\":\n      case \"digital\":\n        return CreditCard;\n      case \"qr\":\n        return QrCode;\n      default:\n        return Wallet;\n    }\n  };\n\n  const getPaymentMethodName = (nameKey: string) => {\n    const names = {\n      cash: t(\"common.cash\"),\n      creditCard: t(\"common.creditCard\"),\n      debitCard: t(\"common.debitCard\"),\n      momo: t(\"common.momo\"),\n      zalopay: t(\"common.zalopay\"),\n      vnpay: t(\"common.vnpay\"),\n      qrCode: t(\"common.qrCode\"),\n      shopeepay: t(\"common.shopeepay\"),\n      grabpay: t(\"common.grabpay\"),\n    };\n    return (\n      names[nameKey as keyof typeof names] || t(\"common.paymentMethodGeneric\")\n    );\n  };\n\n  const getMethodDescription = (nameKey: string) => {\n    const descriptions = {\n      cash: t(\"common.cash\"),\n      creditCard: t(\"common.visaMastercard\"),\n      debitCard: t(\"common.atmCard\"),\n      momo: t(\"common.momoWallet\"),\n      zalopay: t(\"common.zalopayWallet\"),\n      vnpay: t(\"common.vnpayWallet\"),\n      qrCode: t(\"common.qrBanking\"),\n      shopeepay: t(\"common.shopeepayWallet\"),\n      grabpay: t(\"common.grabpayWallet\"),\n    };\n    return (\n      descriptions[nameKey as keyof typeof descriptions] ||\n      t(\"common.paymentMethodGeneric\")\n    );\n  };\n\n  const paymentMethods = getPaymentMethods();\n\n  const handleSelect = async (method: string) => {\n    setSelectedPaymentMethod(method);\n\n    if (method === \"cash\") {\n      // Reset cash amount input when showing cash payment\n      setCashAmountInput(\"\");\n      setAmountReceived(\"\");\n      // Show cash payment input form\n      setShowCashPayment(true);\n    } else if (method === \"qrCode\") {\n      // Call CreateQRPos API for QR payment\n      try {\n        setQrLoading(true);\n        const transactionUuid = `TXN-${Date.now()}`;\n\n        // Use exact total with proper priority\n        const orderTotal =\n          receipt?.exactTotal ??\n          orderForPayment?.exactTotal ??\n          orderForPayment?.total ??\n          total ??\n          0;\n\n        const qrRequest: CreateQRPosRequest = {\n          transactionUuid,\n          depositAmt: orderTotal,\n          posUniqueId: \"HAN01\",\n          accntNo: \"0900993023\",\n          posfranchiseeName: \"DOOKI-HANOI\",\n          posCompanyName: \"HYOJUNG\",\n          posBillNo: `BILL-${Date.now()}`,\n        };\n\n        const bankCode = \"79616001\";\n        const clientID = \"91a3a3668724e631e1baf4f8526524f3\";\n\n        console.log(\"Calling CreateQRPos API with:\", {\n          qrRequest,\n          bankCode,\n          clientID,\n        });\n\n        const qrResponse = await createQRPosAsync(\n          qrRequest,\n          bankCode,\n          clientID,\n        );\n\n        console.log(\"CreateQRPos API response:\", qrResponse);\n\n        // Store transaction UUID for payment tracking\n        setCurrentTransactionUuid(transactionUuid);\n\n        // Listen for payment success notification\n        listenForPaymentSuccess(transactionUuid, (success) => {\n          if (success) {\n            console.log(\n              \"Payment confirmed via WebSocket for transaction:\",\n              transactionUuid,\n            );\n            // Auto-complete the payment when notification is received\n            handleQRComplete();\n          }\n        });\n\n        // Generate QR code from the received QR data\n        if (qrResponse.qrData) {\n          // Decode base64 qrData to get the actual QR content\n          let qrContent = qrResponse.qrData;\n          try {\n            // Try to decode if it's base64 encoded\n            qrContent = atob(qrResponse.qrData);\n          } catch (e) {\n            // If decode fails, use the raw qrData\n            console.log(\"Using raw qrData as it is not base64 encoded\");\n          }\n\n          const qrUrl = await QRCodeLib.toDataURL(qrContent, {\n            width: 256,\n            margin: 2,\n            color: {\n              dark: \"#000000\",\n              light: \"#FFFFFF\",\n            },\n          });\n          setQrCodeUrl(qrUrl);\n          setShowQRCode(true);\n\n          // Send QR payment info to customer display via WebSocket\n          try {\n            const protocol =\n              window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n            const wsUrl = `${protocol}//${window.location.host}/ws`;\n            const ws = new WebSocket(wsUrl);\n\n            ws.onopen = () => {\n              ws.send(\n                JSON.stringify({\n                  type: \"qr_payment\",\n                  qrCodeUrl: qrUrl,\n                  amount: orderTotal,\n                  transactionUuid: transactionUuid,\n                  paymentMethod: \"QR Code\",\n                  timestamp: new Date().toISOString(),\n                }),\n              );\n              ws.close();\n            };\n          } catch (error) {\n            console.error(\n              \"Failed to send QR payment info to customer display:\",\n              error,\n            );\n          }\n        } else {\n          console.error(\"No QR data received from API\");\n          // Fallback to mock QR code\n          const fallbackData = `Payment via QR\\nAmount: ${Math.floor(orderTotal).toLocaleString(\"vi-VN\")} ₫\\nTime: ${new Date().toLocaleString(\"vi-VN\")}`;\n          const qrUrl = await QRCodeLib.toDataURL(fallbackData, {\n            width: 256,\n            margin: 2,\n            color: {\n              dark: \"#000000\",\n              light: \"#FFFFFF\",\n            },\n          });\n          setQrCodeUrl(qrUrl);\n          setShowQRCode(true);\n        }\n      } catch (error) {\n        console.error(\"Error calling CreateQRPos API:\", error);\n        // Fallback to mock QR code on error\n        try {\n          const orderTotal =\n            receipt?.exactTotal ??\n            orderForPayment?.exactTotal ??\n            orderForPayment?.total ??\n            total ??\n            0;\n          const fallbackData = `Payment via QR\\nAmount: ${Math.floor(orderTotal).toLocaleString(\"vi-VN\")} ₫\\nTime: ${new Date().toLocaleString(\"vi-VN\")}`;\n          const qrUrl = await QRCodeLib.toDataURL(fallbackData, {\n            width: 256,\n            margin: 2,\n            color: {\n              dark: \"#000000\",\n              light: \"#FFFFFF\",\n            },\n          });\n          setQrCodeUrl(qrUrl);\n          setShowQRCode(true);\n        } catch (fallbackError) {\n          console.error(\"Error generating fallback QR code:\", fallbackError);\n        }\n      } finally {\n        setQrLoading(false);\n      }\n    } else if (method === \"vnpay\") {\n      // Generate QR code for VNPay\n      try {\n        setQrLoading(true);\n        // Use exact total with proper priority for QR payment\n        const orderTotal =\n          receipt?.exactTotal ??\n          orderForPayment?.exactTotal ??\n          orderForPayment?.total ??\n          total ??\n          0;\n        const qrData = `Payment via ${method}\\nAmount: ${Math.floor(orderTotal).toLocaleString(\"vi-VN\")} ₫\\nTime: ${new Date().toLocaleString(\"vi-VN\")}`;\n        const qrUrl = await QRCodeLib.toDataURL(qrData, {\n          width: 256,\n          margin: 2,\n          color: {\n            dark: \"#000000\",\n            light: \"#FFFFFF\",\n          },\n        });\n        setQrCodeUrl(qrUrl);\n        setShowQRCode(true);\n      } catch (error) {\n        console.error(\"Error generating QR code:\", error);\n      } finally {\n        setQrLoading(false);\n      }\n    } else {\n      // Lưu phương thức thanh toán và hiển thị E-Invoice modal\n      setSelectedPaymentMethod(method);\n      setShowEInvoice(true);\n    }\n  };\n\n  const handleQRComplete = async () => {\n    setShowQRCode(false);\n    setQrCodeUrl(\"\");\n\n    // Set payment method and show E-Invoice modal directly\n    setSelectedPaymentMethod(\"qrCode\");\n    setShowEInvoice(true);\n  };\n\n  const handleBack = () => {\n    setShowQRCode(false);\n    setQrCodeUrl(\"\");\n    setShowCashPayment(false);\n    // Reset toàn bộ trạng thái thanh toán tiền mặt\n    setAmountReceived(\"\");\n    setCashAmountInput(\"\");\n    setSelectedPaymentMethod(\"\");\n    setShowVirtualKeyboard(false);\n\n    // Remove payment listener if exists when going back from QR\n    if (currentTransactionUuid) {\n      removePaymentListener(currentTransactionUuid);\n      setCurrentTransactionUuid(null);\n    }\n\n    // Send message to customer display to clear QR payment\n    try {\n      const protocol = window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n      const wsUrl = `${protocol}//${window.location.host}/ws`;\n      const ws = new WebSocket(wsUrl);\n\n      ws.onopen = () => {\n        ws.send(\n          JSON.stringify({\n            type: \"qr_payment_cancelled\",\n            timestamp: new Date().toISOString(),\n          }),\n        );\n        ws.close();\n      };\n    } catch (error) {\n      console.error(\n        \"Failed to send QR payment cancellation to customer display:\",\n        error,\n      );\n    }\n  };\n\n  const handleCashPaymentComplete = async () => {\n    const receivedAmount = parseFloat(cashAmountInput || \"0\");\n\n    // Sử dụng exact total with proper priority\n    const orderTotal = receipt?.exactTotal ??\n                      orderForPayment?.exactTotal ??\n                      orderForPayment?.total ??\n                      total ??\n                      0;\n\n    // Tính tiền thối: Tiền khách đưa - Tiền cần thanh toán\n    const changeAmount = receivedAmount - orderTotal;\n    const finalChange = changeAmount >= 0 ? changeAmount : 0;\n\n    console.log(\"💰 Hoàn thành thanh toán tiền mặt:\", {\n      \"Số tiền nhập\": amountReceived,\n      \"Số tiền khách đưa\": receivedAmount,\n      \"Tổng cần thanh toán\": orderTotal,\n      \"Tiền thối\": finalChange,\n      \"Đủ tiền\": receivedAmount >= orderTotal\n    });\n\n    if (receivedAmount < orderTotal) {\n      console.warn(\"❌ Số tiền chưa đủ\");\n      return; // Không thực hiện nếu chưa đủ tiền\n    }\n\n    // Reset trạng thái và đóng form tiền mặt\n    setShowCashPayment(false);\n    setAmountReceived(\"\");\n    setCashAmountInput(\"\");\n\n    // Lưu phương thức thanh toán và hiển thị E-Invoice modal\n    setSelectedPaymentMethod(\"cash\");\n    setShowEInvoice(true);\n  };\n\n  const handleEInvoiceConfirm = async (eInvoiceData: any) => {\n    console.log(\"📧 E-Invoice confirmed from payment modal:\", eInvoiceData);\n\n    if (!orderForPayment?.id) {\n      console.error(\"❌ No order ID found for payment update\");\n      return;\n    }\n\n    try {\n      console.log(\"🔄 Step 1: Starting payment process for order:\", orderForPayment.id);\n      \n      // STEP 1: Update order status to 'paid' first using the dedicated status endpoint\n      console.log(\"📤 Step 1: Updating order status to 'paid'\");\n      const statusResponse = await fetch(`/api/orders/${orderForPayment.id}/status`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          status: 'paid'\n        }),\n      });\n\n      if (!statusResponse.ok) {\n        const errorText = await statusResponse.text();\n        console.error(\"❌ Step 1 FAILED: Order status update failed:\", errorText);\n        throw new Error(`Failed to update order status to paid: ${errorText}`);\n      }\n\n      const statusResult = await statusResponse.json();\n      console.log(\"✅ Step 1 SUCCESS: Order status updated to paid:\", statusResult);\n\n      // STEP 2: Update order with payment details\n      console.log(\"📤 Step 2: Adding payment details to order\");\n      const paymentData: any = {\n        paymentMethod: selectedPaymentMethod,\n        paidAt: new Date().toISOString(),\n        einvoiceStatus: eInvoiceData.publishLater ? 0 : 1,\n      };\n\n      // Add cash payment specific data if applicable\n      if (selectedPaymentMethod === \"cash\" && cashAmountInput) {\n        const orderTotal = receipt?.exactTotal ?? orderForPayment?.exactTotal ?? orderForPayment?.total ?? total ?? 0;\n        paymentData.amountReceived = parseFloat(cashAmountInput).toFixed(2);\n        paymentData.change = (parseFloat(cashAmountInput) - orderTotal).toFixed(2);\n      }\n\n      const paymentResponse = await fetch(`/api/orders/${orderForPayment.id}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(paymentData),\n      });\n\n      if (!paymentResponse.ok) {\n        const errorText = await paymentResponse.text();\n        console.error(\"❌ Step 2 FAILED: Payment details update failed:\", errorText);\n        // Don't throw here as the status was already updated successfully\n      } else {\n        const paymentResult = await paymentResponse.json();\n        console.log(\"✅ Step 2 SUCCESS: Payment details added:\", paymentResult);\n      }\n\n      // STEP 3: Create receipt data for printing\n      console.log(\"🔄 Step 3: Creating receipt data for printing\");\n      const receiptData = {\n        ...orderForPayment,\n        transactionId: `ORDER-${orderForPayment.id}`,\n        items: orderForPayment.orderItems || [],\n        subtotal: orderForPayment.subtotal || \"0\",\n        tax: orderForPayment.tax || \"0\", \n        total: orderForPayment.total || \"0\",\n        exactSubtotal: orderForPayment.exactSubtotal || 0,\n        exactTax: orderForPayment.exactTax || 0,\n        exactTotal: orderForPayment.exactTotal || 0,\n        paymentMethod: selectedPaymentMethod,\n        cashierName: eInvoiceData.cashierName || \"System User\",\n        createdAt: new Date().toISOString(),\n        paidAt: new Date().toISOString(),\n        einvoiceStatus: eInvoiceData.publishLater ? 0 : 1,\n        amountReceived: selectedPaymentMethod === \"cash\" && cashAmountInput ? parseFloat(cashAmountInput) : null,\n        change: selectedPaymentMethod === \"cash\" && cashAmountInput ? \n          parseFloat(cashAmountInput) - (orderForPayment.exactTotal || orderForPayment.total || 0) : null\n      };\n\n      // STEP 4: Force refresh UI immediately after successful status update\n      console.log(\"🔄 Step 4: Dispatching UI refresh events\");\n      \n      if (typeof window !== 'undefined') {\n        const events = [\n          new CustomEvent('orderStatusUpdated', {\n            detail: {\n              orderId: orderForPayment.id,\n              status: 'paid',\n              tableId: orderForPayment.tableId,\n              paymentMethod: selectedPaymentMethod\n            }\n          }),\n          new CustomEvent('refreshOrders'),\n          new CustomEvent('refreshTables'),\n          new CustomEvent('paymentCompleted', {\n            detail: { \n              orderId: orderForPayment.id, \n              tableId: orderForPayment.tableId,\n              paymentMethod: selectedPaymentMethod\n            }\n          }),\n          new CustomEvent('tableStatusUpdate', {\n            detail: { \n              tableId: orderForPayment.tableId, \n              checkForRelease: true,\n              orderId: orderForPayment.id\n            }\n          })\n        ];\n\n        events.forEach(event => {\n          console.log(\"📡 Dispatching event:\", event.type, event.detail);\n          window.dispatchEvent(event);\n        });\n      }\n\n      // STEP 5: Close all modals and complete payment flow\n      console.log(\"🔄 Step 5: Closing all modals and completing payment flow\");\n      setShowEInvoice(false);\n      setSelectedPaymentMethod(\"\");\n      onClose();\n\n      // STEP 6: Pass complete success data to parent component with receipt\n      console.log(\"✅ Step 6: Payment process completed successfully\");\n      onSelectMethod(\"paymentCompleted\", {\n        ...eInvoiceData,\n        originalPaymentMethod: selectedPaymentMethod,\n        orderId: orderForPayment.id,\n        tableId: orderForPayment.tableId,\n        success: true,\n        completed: true,\n        receipt: receiptData,\n        shouldShowReceipt: true,\n        paymentData: selectedPaymentMethod === \"cash\" ? {\n          amountReceived: parseFloat(cashAmountInput || \"0\"),\n          change: parseFloat(cashAmountInput || \"0\") - (receipt?.exactTotal ?? orderForPayment?.exactTotal ?? orderForPayment?.total ?? total ?? 0)\n        } : null\n      });\n\n    } catch (error) {\n      console.error(\"❌ ERROR in payment process:\", error);\n      \n      // Close modals to prevent getting stuck\n      setShowEInvoice(false);\n      setSelectedPaymentMethod(\"\");\n      onClose();\n      \n      // Pass error data to parent component\n      onSelectMethod(\"paymentError\", {\n        ...eInvoiceData,\n        originalPaymentMethod: selectedPaymentMethod,\n        orderId: orderForPayment?.id,\n        tableId: orderForPayment?.tableId,\n        success: false,\n        error: error.message,\n        paymentData: selectedPaymentMethod === \"cash\" ? {\n          amountReceived: parseFloat(cashAmountInput || \"0\"),\n          change: parseFloat(cashAmountInput || \"0\") - (receipt?.exactTotal ?? orderForPayment?.exactTotal ?? orderForPayment?.total ?? total ?? 0)\n        } : null\n      });\n    }\n  };\n\n  const handleEInvoiceClose = () => {\n    console.log(\"🔙 E-invoice modal closed - closing entire payment flow\");\n    \n    setShowEInvoice(false);\n    setSelectedPaymentMethod(\"\");\n    onClose(); // Always close the entire payment modal when E-invoice is closed\n  };\n\n  // Virtual keyboard handlers\n  const handleVirtualKeyPress = (key: string) => {\n    const currentValue = cashAmountInput || \"\";\n    // Only allow numbers and prevent multiple decimal points\n    if (!/^[0-9]$/.test(key)) return;\n\n    const newValue = currentValue + key;\n    console.log(\"🔢 Virtual keyboard input:\", { currentValue, key, newValue });\n    setCashAmountInput(newValue);\n    setAmountReceived(newValue); // Sync for calculation\n\n    // Focus the input to show cursor position\n    const inputRef = amountInputRef.current;\n    if (inputRef) {\n      inputRef.focus();\n      // Set cursor to end\n      setTimeout(() => {\n        inputRef.setSelectionRange(newValue.length, newValue.length);\n      }, 0);\n    }\n  };\n\n  const handleVirtualBackspace = () => {\n    const currentValue = cashAmountInput;\n    const newValue = currentValue.slice(0, -1);\n    setCashAmountInput(newValue);\n    setAmountReceived(newValue); // Sync for calculation\n\n    // Focus the input to show cursor position\n    const inputRef = amountInputRef.current;\n    if (inputRef) {\n      inputRef.focus();\n      setTimeout(() => {\n        inputRef.setSelectionRange(newValue.length, newValue.length);\n      }, 0);\n    }\n  };\n\n  const handleVirtualEnter = () => {\n    // Hide keyboard on enter and try to complete payment if amount is sufficient\n    setShowVirtualKeyboard(false);\n    const orderTotal =\n      receipt?.exactTotal ??\n      parseFloat(receipt?.total || \"0\") ??\n      orderForPayment?.exactTotal ??\n      orderForPayment?.total ??\n      total;\n    if (parseFloat(cashAmountInput) >= orderTotal) {\n      handleCashPaymentComplete();\n    }\n  };\n\n  const toggleVirtualKeyboard = () => {\n    setShowVirtualKeyboard(!showVirtualKeyboard);\n    if (!showVirtualKeyboard) {\n      // If opening keyboard, focus on amount input\n      setTimeout(() => {\n        const inputRef = amountInputRef.current;\n        if (inputRef) {\n          inputRef.focus();\n        }\n      }, 100);\n    }\n  };\n\n  // Track previous QR state to handle cancellation\n  const [wasShowingQRCode, setWasShowingQRCode] = useState(false);\n\n  // Track when QR code is showing\n  useEffect(() => {\n    if (showQRCode) {\n      setWasShowingQRCode(true);\n    }\n  }, [showQRCode]);\n\n  // Reset all states when modal closes\n  useEffect(() => {\n    if (!isOpen) {\n      // Always send message to customer display when modal closes\n      const sendCloseMessage = () => {\n        try {\n          const protocol =\n            window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n          const wsUrl = `${protocol}//${window.location.host}/ws`;\n          const ws = new WebSocket(wsUrl);\n\n          ws.onopen = () => {\n            console.log(\"Payment Modal: WebSocket connected for close message\");\n\n            // If QR code was showing, send cancellation and restore cart\n            if (wasShowingQRCode || showQRCode || qrCodeUrl) {\n              console.log(\"Payment Modal: Sending QR cancellation message\");\n              ws.send(\n                JSON.stringify({\n                  type: \"qr_payment_cancelled\",\n                  timestamp: new Date().toISOString(),\n                }),\n              );\n\n              // Wait a bit then send cart restore message\n              setTimeout(() => {\n                console.log(\"Payment Modal: Sending cart restore message\");\n                ws.send(\n                  JSON.stringify({\n                    type: \"restore_cart_display\",\n                    timestamp: new Date().toISOString(),\n                    reason: \"payment_dialog_closed\",\n                  }),\n                );\n                ws.close();\n              }, 100);\n            } else {\n              // Just send cart restore message if no QR code\n              console.log(\n                \"Payment Modal: Sending cart restore message (no QR)\",\n              );\n              ws.send(\n                JSON.stringify({\n                  type: \"restore_cart_display\",\n                  timestamp: new Date().toISOString(),\n                  reason: \"payment_dialog_closed\",\n                }),\n              );\n              ws.close();\n            }\n          };\n\n          ws.onerror = (error) => {\n            console.error(\"Payment Modal: WebSocket error:\", error);\n          };\n\n          ws.onclose = () => {\n            console.log(\n              \"Payment Modal: WebSocket closed after sending close message\",\n            );\n          };\n        } catch (error) {\n          console.error(\n            \"Payment Modal: Failed to send close message when modal closes:\",\n            error,\n          );\n        }\n      };\n\n      // Send close message after a small delay to ensure modal is fully closed\n      setTimeout(sendCloseMessage, 50);\n\n      // Reset all states when modal completely closes\n      console.log(\"🔄 Payment Modal: Resetting all states on modal close\");\n      setShowQRCode(false);\n      setQrCodeUrl(\"\");\n      setShowEInvoice(false);\n      setSelectedPaymentMethod(\"\");\n      setQrLoading(false);\n      setShowCashPayment(false);\n      setAmountReceived(\"\");\n      setCashAmountInput(\"\");\n      setShowVirtualKeyboard(false);\n      setWasShowingQRCode(false);\n\n      // Remove payment listener if exists\n      if (currentTransactionUuid) {\n        removePaymentListener(currentTransactionUuid);\n        setCurrentTransactionUuid(null);\n      }\n    }\n  }, [\n    isOpen,\n    currentTransactionUuid,\n    removePaymentListener,\n    showQRCode,\n    qrCodeUrl,\n    wasShowingQRCode,\n  ]);\n\n  return (\n    <Dialog\n      open={isOpen}\n      onOpenChange={(open) => {\n        if (!open) {\n          // When dialog is closed via X button or outside click\n          try {\n            const protocol =\n              window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n            const wsUrl = `${protocol}//${window.location.host}/ws`;\n            const ws = new WebSocket(wsUrl);\n\n            ws.onopen = () => {\n              console.log(\n                \"Payment Modal: Sending clear message from X button close\",\n              );\n              // If QR code was showing, send cancellation and restore cart\n              if (showQRCode || qrCodeUrl) {\n                ws.send(\n                  JSON.stringify({\n                    type: \"qr_payment_cancelled\",\n                    timestamp: new Date().toISOString(),\n                  }),\n                );\n                // Wait a bit then send cart restore message\n                setTimeout(() => {\n                  ws.send(\n                    JSON.stringify({\n                      type: \"restore_cart_display\",\n                      timestamp: new Date().toISOString(),\n                      reason: \"payment_dialog_x_button\",\n                    }),\n                  );\n                  ws.close();\n                }, 100);\n              } else {\n                // Just send cart restore message if no QR code\n                ws.send(\n                  JSON.stringify({\n                    type: \"restore_cart_display\",\n                    timestamp: new Date().toISOString(),\n                    reason: \"payment_dialog_x_button\",\n                  }),\n                );\n                ws.close();\n              }\n            };\n          } catch (error) {\n            console.error(\n              \"Failed to send clear message when X button clicked:\",\n              error,\n            );\n          }\n        }\n        onClose();\n      }}\n    >\n      <DialogContent className=\"max-w-md\">\n        <DialogHeader>\n          <DialogTitle>{t(\"common.selectPaymentMethod\")}</DialogTitle>\n        </DialogHeader>\n\n        <div className=\"space-y-4 p-4\">\n          {!showQRCode && !showCashPayment ? (\n            <>\n              <div className=\"text-center p-4 bg-gray-50 rounded-lg\">\n                <p className=\"text-sm text-gray-600\">\n                  {t(\"common.totalAmount\")}\n                </p>\n                <p className=\"text-2xl font-bold text-blue-600\">\n                  {/* Use exact total with proper priority for QR payment */}\n                  {Math.floor(\n                    receipt?.exactTotal ??\n                      orderForPayment?.exactTotal ??\n                      orderForPayment?.total ??\n                      total ??\n                      0,\n                  ).toLocaleString(\"vi-VN\")}{\" \"}\n                  ₫\n                </p>\n              </div>\n\n              <div className=\"grid gap-3\">\n                {paymentMethods.map((method) => {\n                  const IconComponent = method.icon;\n                  const isQRMethod =\n                    method.id === \"qrCode\" || method.id === \"vnpay\";\n                  const isLoading = qrLoading && isQRMethod;\n\n                  return (\n                    <Button\n                      key={method.id}\n                      variant=\"outline\"\n                      className=\"flex items-center justify-start p-4 h-auto\"\n                      onClick={() => handleSelect(method.id)}\n                      disabled={isLoading}\n                    >\n                      <IconComponent className=\"mr-3\" size={24} />\n                      <div className=\"text-left flex-1\">\n                        <div className=\"font-medium\">\n                          {isLoading ? t(\"common.generatingQr\") : method.name}\n                        </div>\n                        <div className=\"text-sm text-gray-500\">\n                          {method.description}\n                        </div>\n                      </div>\n                      {isLoading && (\n                        <div className=\"ml-auto\">\n                          <div className=\"animate-spin w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full\" />\n                        </div>\n                      )}\n                    </Button>\n                  );\n                })}\n              </div>\n\n              <Button\n                variant=\"outline\"\n                onClick={() => {\n                  // Send clear message to customer display before closing\n                  try {\n                    const protocol =\n                      window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n                    const wsUrl = `${protocol}//${window.location.host}/ws`;\n                    const ws = new WebSocket(wsUrl);\n\n                    ws.onopen = () => {\n                      console.log(\n                        \"Payment Modal: Sending clear message from cancel button\",\n                      );\n                      ws.send(\n                        JSON.stringify({\n                          type: \"restore_cart_display\",\n                          timestamp: new Date().toISOString(),\n                          reason: \"payment_cancel_button\",\n                        }),\n                      );\n                      ws.close();\n                    };\n                  } catch (error) {\n                    console.error(\n                      \"Failed to send clear message to customer display:\",\n                      error,\n                    );\n                  }\n\n                  onClose();\n                }}\n                className=\"w-full\"\n              >\n                {t(\"common.cancel\")}\n              </Button>\n            </>\n          ) : showQRCode ? (\n            <>\n              <div className=\"text-center space-y-4\">\n                <div className=\"flex items-center justify-center gap-2 mb-4\">\n                  <QrCode className=\"w-6 h-6\" />\n                  <h3 className=\"text-lg font-semibold\">\n                    {t(\"common.scanQrPayment\")}\n                  </h3>\n                </div>\n\n                <div className=\"text-center p-4 bg-gray-50 rounded-lg\">\n                  <p className=\"text-sm text-gray-600\">\n                    {t(\"common.amountToPay\")}\n                  </p>\n                  <p className=\"text-2xl font-bold text-blue-600\">\n                    {/* Use exact total with proper priority for QR payment */}\n                    {Math.floor(\n                      receipt?.exactTotal ??\n                        orderForPayment?.exactTotal ??\n                        orderForPayment?.total ??\n                        total ??\n                        0,\n                    ).toLocaleString(\"vi-VN\")}{\" \"}\n                    ₫\n                  </p>\n                </div>\n\n                {qrCodeUrl && (\n                  <div className=\"flex justify-center\">\n                    <div className=\"bg-white p-4 rounded-lg border-2 border-gray-200 shadow-lg\">\n                      <img\n                        src={qrCodeUrl}\n                        alt=\"QR Code for Bank Transfer\"\n                        className=\"w-64 h-64\"\n                      />\n                    </div>\n                  </div>\n                )}\n\n                <p className=\"text-sm text-gray-600\">\n                  {t(\"common.useBankingApp\")}\n                </p>\n              </div>\n\n              <div className=\"flex gap-3\">\n                <Button\n                  variant=\"outline\"\n                  onClick={() => {\n                    // Send clear message to customer display before going back\n                    try {\n                      const protocol =\n                        window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n                      const wsUrl = `${protocol}//${window.location.host}/ws`;\n                      const ws = new WebSocket(wsUrl);\n\n                      ws.onopen = () => {\n                        console.log(\n                          \"Payment Modal: Sending clear message from back button\",\n                        );\n                        ws.send(\n                          JSON.stringify({\n                            type: \"qr_payment_cancelled\",\n                            timestamp: new Date().toISOString(),\n                          }),\n                        );\n                        // Wait a bit then send cart restore message\n                        setTimeout(() => {\n                          ws.send(\n                            JSON.stringify({\n                              type: \"restore_cart_display\",\n                              timestamp: new Date().toISOString(),\n                              reason: \"payment_back_button\",\n                            }),\n                          );\n                          ws.close();\n                        }, 100);\n                      };\n                    } catch (error) {\n                      console.error(\n                        \"Failed to send clear message from back button:\",\n                        error,\n                      );\n                    }\n\n                    handleBack();\n                  }}\n                  className=\"flex-1\"\n                >\n                  {t(\"common.goBack\")}\n                </Button>\n                <Button\n                  onClick={() => {\n                    // Send clear message to customer display before completing\n                    try {\n                      const protocol =\n                        window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n                      const wsUrl = `${protocol}//${window.location.host}/ws`;\n                      const ws = new WebSocket(wsUrl);\n\n                      ws.onopen = () => {\n                        console.log(\n                          \"Payment Modal: Sending clear message from complete button\",\n                        );\n                        ws.send(\n                          JSON.stringify({\n                            type: \"qr_payment_cancelled\",\n                            timestamp: new Date().toISOString(),\n                          }),\n                        );\n                        // Wait a bit then send cart restore message\n                        setTimeout(() => {\n                          ws.send(\n                            JSON.stringify({\n                              type: \"restore_cart_display\",\n                              timestamp: new Date().toISOString(),\n                              reason: \"payment_complete_button\",\n                            }),\n                          );\n                          ws.close();\n                        }, 100);\n                      };\n                    } catch (error) {\n                      console.error(\n                        \"Failed to send clear message from complete button:\",\n                        error,\n                      );\n                    }\n\n                    handleQRComplete();\n                  }}\n                  className=\"flex-1 bg-green-600 hover:bg-green-700 text-white transition-colors duration-200\"\n                >\n                  {t(\"common.complete\")}\n                </Button>\n              </div>\n            </>\n          ) : showCashPayment ? (\n            <>\n              <div className=\"text-center space-y-4\">\n                <div className=\"flex items-center justify-center gap-2 mb-4\">\n                  <Banknote className=\"w-6 h-6\" />\n                  <h3 className=\"text-lg font-semibold\">\n                    {t(\"common.cashPayment\")}\n                  </h3>\n                </div>\n\n                <div className=\"text-center p-4 bg-gray-50 rounded-lg\">\n                  <p className=\"text-sm text-gray-600\">\n                    {t(\"common.amountToPay\")}\n                  </p>\n                  <p className=\"text-2xl font-bold text-blue-600\">\n                    {/* Use exact total with proper priority for cash payment */}\n                    {Math.floor(\n                      receipt?.exactTotal ??\n                        orderForPayment?.exactTotal ??\n                        orderForPayment?.total ??\n                        total ??\n                        0,\n                    ).toLocaleString(\"vi-VN\")}{\" \"}\n                    ₫\n                  </p>\n                </div>\n\n                <div className=\"space-y-3\">\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                      {t(\"common.customerAmount\")}\n                    </label>\n                    <input\n                      ref={amountInputRef}\n                      type=\"number\"\n                      step=\"1000\"\n                      min=\"0\"\n                      placeholder={t(\"common.enterCustomerAmount\")}\n                      value={cashAmountInput}\n                      onChange={(e) => {\n                        const value = e.target.value;\n                        console.log(\"💰 Cash input changed to:\", value);\n                        setCashAmountInput(value);\n                        setAmountReceived(value); // Sync for calculation\n                      }}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg text-center\"\n                      autoFocus\n                    />\n                  </div>\n\n                  {/* Virtual Keyboard Toggle */}\n                  <div className=\"flex justify-center\">\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={toggleVirtualKeyboard}\n                      className={`${showVirtualKeyboard ? \"bg-blue-100 border-blue-300\" : \"\"}`}\n                    >\n                      <Keyboard className=\"w-4 h-4 mr-2\" />\n                      {showVirtualKeyboard ? \"Ẩn bàn phím\" : \"Hiện bàn phím ảo\"}\n                    </Button>\n                  </div>\n\n                  {amountReceived && parseFloat(amountReceived || \"0\") > 0 && (\n                    <div className={`p-3 border rounded-lg ${\n                      (() => {\n                        const receivedAmount = parseFloat(cashAmountInput || \"0\");\n                        // Sử dụng exact priority order giống như table payment\n                        const orderTotal = receipt?.exactTotal ??\n                                         orderForPayment?.exactTotal ??\n                                         orderForPayment?.total ??\n                                         total;\n                        const changeAmount = receivedAmount - orderTotal;\n                        return changeAmount >= 0\n                          ? \"bg-green-50 border-green-200\"\n                          : \"bg-red-50 border-red-200\";\n                      })()\n                    }`}>\n                      <div className=\"flex justify-between items-center\">\n                        <span className={`text-sm font-medium ${\n                          (() => {\n                            const receivedAmount = parseFloat(cashAmountInput || \"0\");\n                            const orderTotal = receipt?.exactTotal ??\n                                             orderForPayment?.exactTotal ??\n                                             orderForPayment?.total ??\n                                             total;\n                            const changeAmount = receivedAmount - orderTotal;\n                            return changeAmount >= 0 ? \"text-green-800\" : \"text-red-800\";\n                          })()\n                        }`}>\n                          {(() => {\n                            const receivedAmount = parseFloat(cashAmountInput || \"0\");\n                            const orderTotal = receipt?.exactTotal ??\n                                             orderForPayment?.exactTotal ??\n                                             orderForPayment?.total ??\n                                             total;\n                            const changeAmount = receivedAmount - orderTotal;\n                            return changeAmount >= 0 ? \"Tiền thối:\" : \"Còn thiếu:\";\n                          })()}\n                        </span>\n                        <span className={`text-lg font-bold ${\n                          (() => {\n                            const receivedAmount = parseFloat(cashAmountInput || \"0\");\n                            const orderTotal = receipt?.exactTotal ??\n                                             orderForPayment?.exactTotal ??\n                                             orderForPayment?.total ??\n                                             total;\n                            const changeAmount = receivedAmount - orderTotal;\n                            return changeAmount >= 0 ? \"text-green-600\" : \"text-red-600\";\n                          })()\n                        }`}>\n                          {(() => {\n                            // Sử dụng cashAmountInput thay vì amountReceived để tính toán chính xác\n                            const receivedAmount = parseFloat(cashAmountInput || \"0\");\n\n                            // Sử dụng exact priority order giống như table payment\n                            const orderTotal = receipt?.exactTotal ??\n                                             orderForPayment?.exactTotal ??\n                                             orderForPayment?.total ??\n                                             total;\n\n                            // Tính tiền thối: Tiền khách đưa - Tổng tiền cần thanh toán\n                            const changeAmount = receivedAmount - orderTotal;\n                            const displayAmount = changeAmount >= 0 ? changeAmount : Math.abs(changeAmount);\n\n                            return Math.floor(displayAmount).toLocaleString(\"vi-VN\");\n                          })()}{\" \"}\n                          ₫\n                        </span>\n                      </div>\n                    </div>\n                  )}\n                </div>\n\n                {/* Virtual Keyboard */}\n                {showVirtualKeyboard && (\n                  <div className=\"mt-4\">\n                    <VirtualKeyboard\n                      onKeyPress={handleVirtualKeyPress}\n                      onBackspace={handleVirtualBackspace}\n                      onEnter={handleVirtualEnter}\n                      isVisible={showVirtualKeyboard}\n                      className=\"border border-gray-200 rounded-lg\"\n                    />\n                  </div>\n                )}\n              </div>\n\n              <div className=\"flex gap-3\">\n                <Button\n                  variant=\"outline\"\n                  onClick={() => {\n                    // Send clear message to customer display before going back from cash payment\n                    try {\n                      const protocol =\n                        window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n                      const wsUrl = `${protocol}//${window.location.host}/ws`;\n                      const ws = new WebSocket(wsUrl);\n\n                      ws.onopen = () => {\n                        console.log(\n                          \"Payment Modal: Sending clear message from cash payment back button\",\n                        );\n                        ws.send(\n                          JSON.stringify({\n                            type: \"restore_cart_display\",\n                            timestamp: new Date().toISOString(),\n                            reason: \"cash_payment_back_button\",\n                          }),\n                        );\n                        ws.close();\n                      };\n                    } catch (error) {\n                      console.error(\n                        \"Failed to send clear message from cash payment back button:\",\n                        error,\n                      );\n                    }\n\n                    handleBack();\n                  }}\n                  className=\"flex-1\"\n                >\n                  {t(\"common.goBack\")}\n                </Button>\n                <Button\n                  onClick={() => {\n                    // Send clear message to customer display before completing cash payment\n                    try {\n                      const protocol =\n                        window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n                      const wsUrl = `${protocol}//${window.location.host}/ws`;\n                      const ws = new WebSocket(wsUrl);\n\n                      ws.onopen = () => {\n                        console.log(\n                          \"Payment Modal: Sending clear message from cash payment complete button\",\n                        );\n                        ws.send(\n                          JSON.stringify({\n                            type: \"restore_cart_display\",\n                            timestamp: new Date().toISOString(),\n                            reason: \"cash_payment_complete_button\",\n                          }),\n                        );\n                        ws.close();\n                      };\n                    } catch (error) {\n                      console.error(\n                        \"Failed to send clear message from cash payment complete button:\",\n                        error,\n                      );\n                    }\n\n                    handleCashPaymentComplete();\n                  }}\n                  disabled={\n                    !cashAmountInput ||\n                    parseFloat(cashAmountInput) <\n                      (receipt?.exactTotal ??\n                       orderForPayment?.exactTotal ??\n                       orderForPayment?.total ??\n                       total)\n                  }\n                  className=\"flex-1 bg-green-600 hover:bg-green-700 text-white transition-colors duration-200 disabled:bg-gray-400\"\n                >\n                  {t(\"common.complete\")}\n                </Button>\n              </div>\n            </>\n          ) : null}\n        </div>\n      </DialogContent>\n\n      {/* E-Invoice Modal */}\n      {showEInvoice && (\n        <EInvoiceModal\n          isOpen={showEInvoice}\n          onClose={handleEInvoiceClose}\n          onConfirm={handleEInvoiceConfirm}\n          total={(() => {\n            // Debug current data to understand the issue\n            console.log(\"💰 Payment Modal EInvoice Total Debug:\", {\n              orderForPayment: orderForPayment,\n              receipt: receipt,\n              propTotal: total,\n              orderForPaymentTotal: orderForPayment?.total,\n              orderForPaymentExactTotal: orderForPayment?.exactTotal,\n              receiptTotal: receipt?.total,\n              receiptExactTotal: receipt?.exactTotal\n            });\n\n            // Priority: orderForPayment data first, then receipt, then fallback to prop total\n            let calculatedTotal = 0;\n            \n            if (orderForPayment?.total) {\n              calculatedTotal = parseFloat(orderForPayment.total.toString());\n              console.log(\"💰 Using orderForPayment.total for EInvoice:\", calculatedTotal);\n            } else if (orderForPayment?.exactTotal) {\n              calculatedTotal = parseFloat(orderForPayment.exactTotal.toString());\n              console.log(\"💰 Using orderForPayment.exactTotal for EInvoice:\", calculatedTotal);\n            } else if (receipt?.exactTotal) {\n              calculatedTotal = parseFloat(receipt.exactTotal.toString());\n              console.log(\"💰 Using receipt.exactTotal for EInvoice:\", calculatedTotal);\n            } else if (receipt?.total) {\n              calculatedTotal = parseFloat(receipt.total.toString());\n              console.log(\"💰 Using receipt.total for EInvoice:\", calculatedTotal);\n            } else {\n              calculatedTotal = parseFloat(total?.toString() || \"0\");\n              console.log(\"💰 Using fallback total for EInvoice:\", calculatedTotal);\n            }\n            \n            console.log(\"💰 Final calculated total for EInvoice:\", calculatedTotal);\n            return Math.floor(calculatedTotal || 0);\n          })()}\n          selectedPaymentMethod={selectedPaymentMethod}\n          cartItems={(() => {\n            // Use orderItems from orderForPayment first, then fallback to other sources\n            const itemsToMap =\n              orderForPayment?.orderItems ||\n              receipt?.orderItems ||\n              cartItems ||\n              [];\n            console.log(\n              \"📦 Mapping cart items for payment modal using exact Order Details data:\",\n              itemsToMap.length,\n            );\n            console.log(\"📦 Payment Modal CartItems Debug:\", {\n              orderForPayment: orderForPayment,\n              orderItems: orderForPayment?.orderItems,\n              receipt: receipt,\n              receiptOrderItems: receipt?.orderItems,\n              cartItems: cartItems,\n              itemsToMap: itemsToMap,\n              products: products\n            });\n\n            return itemsToMap.map((item: any, index: number) => {\n              const product = Array.isArray(products)\n                ? products.find((p: any) => p.id === item.productId)\n                : null;\n\n              console.log(`📦 Mapping item ${index + 1}:`, {\n                rawItem: item,\n                foundProduct: product,\n                productId: item.productId,\n                productName: item.productName,\n                unitPrice: item.unitPrice,\n                price: item.price\n              });\n\n              // Use correct field names from orderItems with better fallbacks\n              const mappedItem = {\n                id: item.productId || item.id || 0,\n                name:\n                  item.productName ||\n                  product?.name ||\n                  getProductName?.(item.productId) ||\n                  (item.productId ? `Product ${item.productId}` : `Item ${index + 1}`),\n                price: parseFloat(item.unitPrice || item.price || product?.price || \"0\"),\n                quantity: parseInt(item.quantity?.toString() || \"1\"),\n                sku: item.productSku || product?.sku || `SP${item.productId || item.id || index}`,\n                taxRate: product?.taxRate ? parseFloat(product.taxRate.toString()) : (item.taxRate || 0),\n                afterTaxPrice: product?.afterTaxPrice || null,\n              };\n              \n              console.log(`📦 Final mapped item ${index + 1}:`, mappedItem);\n              return mappedItem;\n            });\n          })()}\n        />\n      )}\n    </Dialog>\n  );\n}","size_bytes":54518},"client/src/components/pos/print-dialog.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Printer, X } from \"lucide-react\";\n\ninterface PrintDialogProps {\n  isOpen: boolean;\n  onClose: () => void;\n  receiptData: {\n    transactionId: string;\n    items: Array<{\n      id: number;\n      productName: string;\n      price: string;\n      quantity: number;\n      total: string;\n      sku: string;\n      taxRate: number;\n      afterTaxPrice?: string | null; // Added for new tax calculation\n    }>;\n    subtotal: string;\n    tax: string;\n    total: string;\n    paymentMethod: string;\n    amountReceived: string;\n    change: string;\n    cashierName: string;\n    createdAt: string;\n    invoiceNumber?: string;\n    customerName?: string;\n    customerTaxCode?: string;\n  };\n  storeInfo?: {\n    storeName: string;\n    address: string;\n    phone: string;\n  };\n}\n\nexport function PrintDialog({\n  isOpen,\n  onClose,\n  receiptData,\n  storeInfo = {\n    storeName: \"IDMC\",\n    address: \"Vị trí của hàng chính\\n서울시 강남구 테헤란로 123\",\n    phone: \"02-1234-5678\"\n  }\n}: PrintDialogProps) {\n  const [isPrinting, setIsPrinting] = useState(false);\n\n  const handlePrint = async () => {\n    setIsPrinting(true);\n\n    try {\n      // Create a new window for printing\n      const printWindow = window.open('', '_blank', 'width=800,height=600');\n\n      if (!printWindow) {\n        alert('Popup bị chặn. Vui lòng cho phép popup để in hóa đơn.');\n        return;\n      }\n\n      // Generate print content\n      const printContent = `\n        <!DOCTYPE html>\n        <html>\n        <head>\n          <title>In Hóa Đơn</title>\n          <style>\n            body {\n              font-family: 'Courier New', monospace;\n              font-size: 12px;\n              line-height: 1.4;\n              margin: 0;\n              padding: 20px;\n              max-width: 300px;\n              margin: 0 auto;\n            }\n            .center { text-align: center; }\n            .right { text-align: right; }\n            .bold { font-weight: bold; }\n            .separator {\n              border-top: 1px dashed #000;\n              margin: 10px 0;\n            }\n            .item-row {\n              display: flex;\n              justify-content: space-between;\n              margin: 2px 0;\n            }\n            .item-name {\n              flex: 1;\n              text-align: left;\n            }\n            .item-qty {\n              width: 40px;\n              text-align: center;\n            }\n            .item-price {\n              width: 80px;\n              text-align: right;\n            }\n            .total-row {\n              display: flex;\n              justify-content: space-between;\n              margin: 5px 0;\n              font-weight: bold;\n            }\n            @media print {\n              body { margin: 0; padding: 10px; }\n            }\n          </style>\n        </head>\n        <body>\n          <div class=\"center bold\">\n            ${storeInfo.storeName}\n          </div>\n          <div class=\"center\">\n            ${storeInfo.address.replace(/\\n/g, '<br>')}\n          </div>\n          <div class=\"center\">\n            Điện thoại: ${storeInfo.phone}\n          </div>\n\n          <div class=\"separator\"></div>\n\n          <div style=\"display: flex; justify-content: space-between;\">\n            <span>Số giao dịch:</span>\n            <span>${receiptData.transactionId}</span>\n          </div>\n          <div style=\"display: flex; justify-content: space-between;\">\n            <span>Ngày:</span>\n            <span>${new Date(receiptData.createdAt).toLocaleString('vi-VN')}</span>\n          </div>\n          <div style=\"display: flex; justify-content: space-between;\">\n            <span>Thu ngân:</span>\n            <span>${receiptData.cashierName}</span>\n          </div>\n\n          ${receiptData.customerName ? `\n          <div style=\"display: flex; justify-content: space-between;\">\n            <span>Khách hàng:</span>\n            <span>${receiptData.customerName}</span>\n          </div>\n          ` : ''}\n\n          ${receiptData.customerTaxCode ? `\n          <div style=\"display: flex; justify-content: space-between;\">\n            <span>MST:</span>\n            <span>${receiptData.customerTaxCode}</span>\n          </div>\n          ` : ''}\n\n          ${receiptData.invoiceNumber ? `\n          <div style=\"display: flex; justify-content: space-between;\">\n            <span>Số HĐ:</span>\n            <span>${receiptData.invoiceNumber}</span>\n          </div>\n          ` : ''}\n\n          <div class=\"separator\"></div>\n\n          ${receiptData.items.map(item => `\n            <div class=\"item-row\">\n              <div class=\"item-name\">${item.productName}</div>\n              <div class=\"item-price\">${parseFloat(item.total).toLocaleString('vi-VN')} đ</div>\n            </div>\n            <div style=\"font-size: 10px; color: #666;\">\n              SKU: ${item.sku} | ${item.quantity} x ${parseFloat(item.price).toLocaleString('vi-VN')} đ\n            </div>\n          `).join('')}\n\n          <div class=\"separator\"></div>\n\n          <div class=\"total-row\">\n            <span>Tạm tính:</span>\n            <span>${parseFloat(receiptData.subtotal).toLocaleString('vi-VN')} đ</span>\n          </div>\n          <div class=\"total-row\">\n            <span>Thuế (${(() => {\n              // Calculate actual tax from total - subtotal\n              const total = parseFloat(receiptData.total || \"0\");\n              const subtotal = parseFloat(receiptData.subtotal || \"0\");\n              const actualTax = total - subtotal;\n              \n              if (subtotal === 0 || actualTax <= 0) return \"0.0\";\n              \n              const taxRate = (actualTax / subtotal) * 100;\n              return taxRate.toFixed(1);\n            })()}%):</span>\n            <span>${(() => {\n              const total = parseFloat(receiptData.total || \"0\");\n              const subtotal = parseFloat(receiptData.subtotal || \"0\");\n              const actualTax = total - subtotal;\n              return Math.round(actualTax).toLocaleString('vi-VN');\n            })()} đ</span>\n          </div>\n          <div class=\"total-row\" style=\"font-size: 14px; border-top: 1px solid #000; padding-top: 5px;\">\n            <span>Tổng cộng:</span>\n            <span>${(() => {\n              const subtotal = parseFloat(receiptData.subtotal || \"0\");\n              const total = parseFloat(receiptData.total || \"0\");\n              const actualTax = total - subtotal;\n              const calculatedTotal = subtotal + actualTax;\n              return Math.round(calculatedTotal).toLocaleString('vi-VN');\n            })()} đ</span>\n          </div>\n\n          <div class=\"separator\"></div>\n\n          <div style=\"display: flex; justify-content: space-between;\">\n            <span>Phương thức thanh toán:</span>\n            <span>${receiptData.paymentMethod === 'einvoice' ? 'Hóa đơn điện tử' : receiptData.paymentMethod}</span>\n          </div>\n          <div style=\"display: flex; justify-content: space-between;\">\n            <span>Số tiền nhận:</span>\n            <span>${parseFloat(receiptData.amountReceived).toLocaleString('vi-VN')} đ</span>\n          </div>\n\n          <div class=\"separator\"></div>\n\n          <div class=\"center\">\n            Cảm ơn bạn đã mua hàng!\n          </div>\n          <div class=\"center\">\n            Vui lòng giữ hóa đơn để làm bằng chứng\n          </div>\n        </body>\n        </html>\n      `;\n\n      printWindow.document.write(printContent);\n      printWindow.document.close();\n\n      // Wait for content to load then print\n      printWindow.onload = () => {\n        setTimeout(() => {\n          printWindow.print();\n          printWindow.close();\n        }, 500);\n      };\n    } catch (error) {\n      console.error('Print error:', error);\n      alert('Có lỗi xảy ra khi in hóa đơn');\n    } finally {\n      setIsPrinting(false);\n    }\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-md\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2 text-blue-700\">\n            <Printer className=\"w-5 h-5\" />\n            In Hóa Đơn\n          </DialogTitle>\n        </DialogHeader>\n\n        <div className=\"space-y-4\">\n          {/* Receipt Preview */}\n          <div className=\"bg-white border-2 border-dashed border-gray-300 p-4 font-mono text-sm max-h-96 overflow-y-auto\">\n            <div className=\"text-center font-bold mb-2\">\n              {storeInfo.storeName}\n            </div>\n            <div className=\"text-center text-xs mb-2\">\n              {storeInfo.address.split('\\n').map((line, index) => (\n                <div key={index}>{line}</div>\n              ))}\n            </div>\n            <div className=\"text-center text-xs mb-2\">\n              Điện thoại: {storeInfo.phone}\n            </div>\n\n            <div className=\"border-t border-dashed border-gray-400 my-2\"></div>\n\n            <div className=\"flex justify-between text-xs\">\n              <span>Số giao dịch:</span>\n              <span>{receiptData.transactionId}</span>\n            </div>\n            <div className=\"flex justify-between text-xs\">\n              <span>Ngày:</span>\n              <span>{new Date(receiptData.createdAt).toLocaleString('vi-VN')}</span>\n            </div>\n            <div className=\"flex justify-between text-xs\">\n              <span>Thu ngân:</span>\n              <span>{receiptData.cashierName}</span>\n            </div>\n\n            {receiptData.customerName && (\n              <div className=\"flex justify-between text-xs\">\n                <span>Khách hàng:</span>\n                <span>{receiptData.customerName}</span>\n              </div>\n            )}\n\n            {receiptData.invoiceNumber && (\n              <div className=\"flex justify-between text-xs\">\n                <span>Số HĐ:</span>\n                <span>{receiptData.invoiceNumber}</span>\n              </div>\n            )}\n\n            <div className=\"border-t border-dashed border-gray-400 my-2\"></div>\n\n            {receiptData.items.map((item, index) => (\n              <div key={index} className=\"mb-2\">\n                <div className=\"flex justify-between\">\n                  <span className=\"text-xs\">{item.productName}</span>\n                  <span className=\"text-xs font-bold\">{parseFloat(item.total).toLocaleString('vi-VN')} đ</span>\n                </div>\n                <div className=\"text-xs text-gray-600\">\n                  SKU: {item.sku} | {item.quantity} x {parseFloat(item.price).toLocaleString('vi-VN')} đ\n                </div>\n              </div>\n            ))}\n\n            <div className=\"border-t border-dashed border-gray-400 my-2\"></div>\n\n            <div className=\"flex justify-between text-xs\">\n              <span>Tạm tính:</span>\n              <span>{parseFloat(receiptData.subtotal).toLocaleString('vi-VN')} đ</span>\n            </div>\n            <div className=\"flex justify-between text-xs\">\n              <span>Thuế ({(() => {\n                // Calculate actual tax from total - subtotal\n                const total = parseFloat(receiptData.total || \"0\");\n                const subtotal = parseFloat(receiptData.subtotal || \"0\");\n                const actualTax = total - subtotal;\n                \n                if (subtotal === 0 || actualTax <= 0) return \"0.0\";\n                \n                const taxRate = (actualTax / subtotal) * 100;\n                return taxRate.toFixed(1);\n              })()}%):</span>\n              <span>{(() => {\n                const total = parseFloat(receiptData.total || \"0\");\n                const subtotal = parseFloat(receiptData.subtotal || \"0\");\n                const actualTax = total - subtotal;\n                return Math.round(actualTax).toLocaleString('vi-VN');\n              })()} đ</span>\n            </div>\n            <div className=\"flex justify-between font-bold border-t border-gray-400 pt-1\">\n              <span>Tổng cộng:</span>\n              <span>{(() => {\n                const subtotal = parseFloat(receiptData.subtotal || \"0\");\n                const total = parseFloat(receiptData.total || \"0\");\n                const actualTax = total - subtotal;\n                const calculatedTotal = subtotal + actualTax;\n                return Math.round(calculatedTotal).toLocaleString('vi-VN');\n              })()} đ</span>\n            </div>\n\n            <div className=\"border-t border-dashed border-gray-400 my-2\"></div>\n\n            <div className=\"flex justify-between text-xs\">\n              <span>Phương thức thanh toán:</span>\n              <span>{receiptData.paymentMethod === 'einvoice' ? 'Hóa đơn điện tử' : receiptData.paymentMethod}</span>\n            </div>\n\n            <div className=\"border-t border-dashed border-gray-400 my-2\"></div>\n\n            <div className=\"text-center text-xs\">\n              <div>Cảm ơn bạn đã mua hàng!</div>\n              <div>Vui lòng giữ hóa đơn để làm bằng chứng</div>\n            </div>\n          </div>\n\n          {/* Action Buttons */}\n          <div className=\"flex gap-3\">\n            <Button\n              onClick={handlePrint}\n              disabled={isPrinting}\n              className=\"flex-1 bg-blue-600 hover:bg-blue-700 text-white\"\n            >\n              {isPrinting ? (\n                <>\n                  <div className=\"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2\" />\n                  Đang in...\n                </>\n              ) : (\n                <>\n                  <Printer className=\"w-4 h-4 mr-2\" />\n                  In Hóa Đơn\n                </>\n              )}\n            </Button>\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                console.log('🔒 Print Dialog: Đóng popup - không in bill, ngăn hiển thị popup khác');\n                \n                // Set flag to prevent any further popups\n                if (typeof window !== 'undefined') {\n                  window.sessionStorage.setItem('preventPrintPopup', 'true');\n                  window.sessionStorage.setItem('userClosedPrint', 'true');\n                }\n                \n                // Send message to parent to stop any popup flows\n                try {\n                  fetch('/api/popup/close', {\n                    method: 'POST',\n                    headers: {\n                      'Content-Type': 'application/json',\n                    },\n                    body: JSON.stringify({ \n                      success: true, \n                      action: 'user_closed_print_dialog',\n                      preventFurtherPopups: true,\n                      timestamp: new Date().toISOString()\n                    }),\n                  }).catch(console.error);\n                } catch (error) {\n                  console.error('Error sending close signal:', error);\n                }\n                \n                // Close immediately\n                onClose();\n              }}\n              className=\"flex-1\"\n            >\n              <X className=\"w-4 h-4 mr-2\" />\n              Đóng\n            </Button>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":15375},"client/src/components/pos/product-grid.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Grid3X3, List, ArrowUpDown, Package, Coffee, Cookie } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport type { Product } from \"@shared/schema\";\n// Import placeholders as data URLs since SVG imports are causing issues\nconst placeholderFood = \"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgPHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiIGZpbGw9IiNmM2Y0ZjYiLz4KICA8Y2lyY2xlIGN4PSIxMDAiIGN5PSI5MCIgcj0iMzAiIGZpbGw9IiMxMGI5ODEiIG9wYWNpdHk9IjAuMiIvPgogIDxyZWN0IHg9IjcwIiB5PSI3MCIgd2lkdGg9IjYwIiBoZWlnaHQ9IjQwIiByeD0iOCIgZmlsbD0iIzEwYjk4MSIgb3BhY2l0eT0iMC4zIi8+CiAgPGNpcmNsZSBjeD0iODUiIGN5PSI4NSIgcj0iNSIgZmlsbD0iIzEwYjk4MSIvPgogIDxjaXJjbGUgY3g9IjEwMCIgY3k9Ijg1IiByPSI1IiBmaWxsPSIjMTBiOTgxIi8+CiAgPGNpcmNsZSBjeD0iMTE1IiBjeT0iODUiIHI9IjUiIGZpbGw9IiMxMGI5ODEiLz4KICA8cmVjdCB4PSI4MCIgeT0iMTIwIiB3aWR0aD0iNDAiIGhlaWdodD0iMjAiIHJ4PSIxMCIgZmlsbD0iIzEwYjk4MSIgb3BhY2l0eT0iMC40Ii8+CiAgPHRleHQgeD0iMTAwIiB5PSIxNjAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IiM2YjcyODAiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiI+7J2M7Iud7IqI7KK4PC90ZXh0Pgo8L3N2Zz4=\";\nconst placeholderBeverage = \"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgPHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiIGZpbGw9IiNmM2Y0ZjYiLz4KICA8cmVjdCB4PSI4MCIgeT0iNTAiIHdpZHRoPSI0MCIgaGVpZ2h0PSI4MCIgcng9IjUiIGZpbGw9IiMzYjgyZjYiIG9wYWNpdHk9IjAuMiIvPgogIDxyZWN0IHg9IjgyIiB5PSI1NSIgd2lkdGg9IjM2IiBoZWlnaHQ9IjUwIiBmaWxsPSIjM2I4MmY2IiBvcGFjaXR5PSIwLjQiLz4KICA8Y2lyY2xlIGN4PSIxMDAiIHk9IjQwIiByPSI4IiBmaWxsPSIjM2I4MmY2IiBvcGFjaXR5PSIwLjMiLz4KICA8cmVjdCB4PSI5NiIgeT0iMzAiIHdpZHRoPSI4IiBoZWlnaHQ9IjE1IiBmaWxsPSIjM2I4MmY2IiBvcGFjaXR5PSIwLjUiLz4KICA8dGV4dCB4PSIxMDAiIHk9IjE2MCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0iIzZiNzI4MCIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIj7smYzro4zsnbTrr7w8L3RleHQ+Cjwvc3ZnPg==\";\nconst placeholderSnack = \"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgPHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiIGZpbGw9IiNmM2Y0ZjYiLz4KICA8cmVjdCB4PSI2MCIgeT0iNzAiIHdpZHRoPSI4MCIgaGVpZ2h0PSI1MCIgcng9IjEwIiBmaWxsPSIjZjU5ZTBiIiBvcGFjaXR5PSIwLjIiLz4KICA8cmVjdCB4PSI2NSIgeT0iNzUiIHdpZHRoPSI3MCIgaGVpZ2h0PSIxNSIgcng9IjMiIGZpbGw9IiNmNTllMGIiIG9wYWNpdHk9IjAuNCIvPgogIDxyZWN0IHg9IjY1IiB5PSI5NSIgd2lkdGg9IjcwIiBoZWlnaHQ9IjE1IiByeD0iMyIgZmlsbD0iI2Y1OWUwYiIgb3BhY2l0eT0iMC4zIi8+CiAgPGNpcmNsZSBjeD0iN1giIGN5PSI4MyIgcj0iMyIgZmlsbD0iI2Y1OWUwYiIvPgogIDxjaXJjbGUgY3g9IjkwIiBjeT0iODMiIHI9IjMiIGZpbGw9IiNmNTllMGIiLz4KICA8Y2lyY2xlIGN4PSIxMDUiIGN5PSI4MyIgcj0iMyIgZmlsbD0iI2Y1OWUwYiIvPgogIDxjaXJjbGUgY3g9IjEyMCIgY3k9IjgzIiByPSIzIiBmaWxsPSIjZjU5ZTBiIi8+CiAgPHRleHQgeD0iMTAwIiB5PSIxNjAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IiM2YjcyODAiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiI+7Iqk64WN7J207Ja47KeAPC90ZXh0Pgo8L3N2Zz4=\";\n\ninterface ProductGridProps {\n  selectedCategory: number | \"all\";\n  searchQuery: string;\n  onAddToCart: (productId: number) => void;\n}\n\n// Define CartItem type if it's not defined elsewhere\ninterface CartItem {\n  id: number;\n  name: string;\n  price: string;\n  quantity: number;\n  total: string;\n  imageUrl?: string;\n  stock: number;\n  taxRate?: string;\n  afterTaxPrice?: string;\n}\n\nexport function ProductGrid({ selectedCategory, searchQuery, onAddToCart }: ProductGridProps) {\n  const { toast } = useToast();\n  const { t } = useTranslation();\n  const [viewMode, setViewMode] = useState<'grid' | 'list'>('grid');\n  const [sortBy, setSortBy] = useState<'name' | 'price' | 'stock'>('name');\n  const [sortOrder, setSortOrder] = useState<'asc' | 'desc'>('asc');\n\n  // Assume setCart and other necessary hooks/context are available if this were a real component\n  // For demonstration, we'll just use the onAddToCart prop\n  const setCart = (items: CartItem[]) => {\n    console.log(\"Set cart called with:\", items);\n  };\n\n  const { data: products = [], isLoading } = useQuery<Product[]>({\n    queryKey: [\"/api/products\", { category: selectedCategory, search: searchQuery }],\n    queryFn: async () => {\n      const params = new URLSearchParams();\n      if (selectedCategory !== \"all\") {\n        params.append(\"category\", selectedCategory.toString());\n      }\n      if (searchQuery) {\n        params.append(\"search\", searchQuery);\n      }\n\n      const response = await fetch(`/api/products?${params}`);\n      if (!response.ok) throw new Error('Failed to fetch products');\n      const allProducts = await response.json();\n\n      console.log(\"Raw products from API:\", allProducts);\n      console.log(\"Total products received:\", allProducts.length);\n\n      // Only filter out raw materials (productType = 2) and inactive products\n      const filteredProducts = allProducts.filter((product: any) => {\n        const isNotRawMaterial = product.productType !== 2;\n        const isActive = product.isActive !== false;\n        const isIncluded = isNotRawMaterial && isActive;\n\n        if (!isIncluded) {\n          console.log(`❌ Product ${product.name} excluded: productType=${product.productType}, isActive=${product.isActive}`);\n        } else {\n          console.log(`✅ Product ${product.name} included: category=${product.categoryId}`);\n        }\n\n        return isIncluded;\n      });\n\n      console.log(\"Filtered products for POS:\", filteredProducts);\n      console.log(\"Products after filtering:\", filteredProducts.length);\n\n      // Group by category for debugging\n      const productsByCategory = filteredProducts.reduce((acc: any, product: any) => {\n        if (!acc[product.categoryId]) acc[product.categoryId] = [];\n        acc[product.categoryId].push(product.name);\n        return acc;\n      }, {});\n      console.log(\"Products grouped by category:\", productsByCategory);\n\n      return filteredProducts;\n    },\n  });\n\n  const handleAddToCart = (product: Product) => {\n    if (product.trackInventory !== false && product.stock <= 0) {\n      toast({\n        title: t('pos.outOfStock'),\n        description: `${product.name} ${t('pos.currentlyOutOfStock')}`,\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    console.log(\"Adding product to cart:\", product.name);\n    console.log(\"Product afterTaxPrice from database:\", product.afterTaxPrice);\n    console.log(\"Product afterTaxPrice type:\", typeof product.afterTaxPrice);\n    console.log(\"Product afterTaxPrice is null?\", product.afterTaxPrice === null);\n    console.log(\"Product afterTaxPrice is empty string?\", product.afterTaxPrice === \"\");\n\n    // Pass productId to onAddToCart as expected by the interface\n    onAddToCart(product.id);\n\n    // Trigger toast notification for successful add to cart\n    toast({\n      title: t('pos.addedToCartShort'),\n      description: `${product.name}${t('pos.hasBeenAddedToOrder')}`,\n    });\n  };\n  \n  // Mock updateCart function to demonstrate the change\n  const updateCart = (productId: number, quantity: number) => {\n    setCart(prev => prev.map(item => \n      item.id === productId \n        ? { \n            ...item, \n            quantity, \n            total: (parseFloat(item.price) * quantity).toFixed(2),\n            afterTaxPrice: item.afterTaxPrice // Preserve afterTaxPrice\n          }\n        : item\n    ));\n  };\n\n  const getPlaceholderImage = (categoryId: number, productName: string) => {\n    // Determine the best placeholder based on category and product name\n    const name = productName.toLowerCase();\n\n    if (categoryId === 1 || name.includes('coffee') || name.includes('tea') || name.includes('juice') || name.includes('drink') || name.includes('beverage')) {\n      return placeholderBeverage;\n    } else if (categoryId === 2 || name.includes('chip') || name.includes('snack') || name.includes('cookie')) {\n      return placeholderSnack;\n    } else {\n      return placeholderFood;\n    }\n  };\n\n  const getPlaceholderIcon = (categoryId: number, productName: string) => {\n    const name = productName.toLowerCase();\n\n    if (categoryId === 1 || name.includes('coffee') || name.includes('tea') || name.includes('juice') || name.includes('drink') || name.includes('beverage')) {\n      return Coffee;\n    } else if (categoryId === 2 || name.includes('chip') || name.includes('snack') || name.includes('cookie')) {\n      return Cookie;\n    } else {\n      return Package;\n    }\n  };\n\n  const getStockStatus = (stock: number) => {\n    if (stock === 0) return { text: t('pos.outOfStock'), color: \"text-red-500\" };\n    if (stock <= 5) return { text: `${stock} ${t('pos.inStock')}`, color: \"text-red-500\" };\n    if (stock <= 10) return { text: `${stock} ${t('pos.inStock')}`, color: \"text-orange-500\" };\n    return { text: `${stock} ${t('pos.inStock')}`, color: \"text-green-600\" };\n  };\n\n  const getPopularBadge = (productName: string) => {\n    // Mock logic for popular products\n    const popularProducts = [\"Premium Coffee\", \"Fresh Orange Juice\"];\n    return popularProducts.includes(productName);\n  };\n\n  const getLowStockBadge = (stock: number) => {\n    return stock <= 5 && stock > 0;\n  };\n\n  if (isLoading) {\n    return (\n      <main className=\"flex-1 flex flex-col\">\n        <div className=\"bg-white p-4 border-b pos-border\">\n          <div className=\"animate-pulse\">\n            <div className=\"h-6 bg-gray-200 rounded w-32 mb-2\"></div>\n            <div className=\"h-4 bg-gray-200 rounded w-24\"></div>\n          </div>\n        </div>\n        <div className=\"flex-1 overflow-y-auto p-4\">\n          <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4\">\n            {Array.from({ length: 8 }).map((_, i) => (\n              <div key={i} className=\"bg-white rounded-lg shadow-material animate-pulse\">\n                <div className=\"w-full h-32 bg-gray-200 rounded-t-lg\"></div>\n                <div className=\"p-3\">\n                  <div className=\"h-4 bg-gray-200 rounded w-3/4 mb-2\"></div>\n                  <div className=\"h-3 bg-gray-200 rounded w-1/2 mb-2\"></div>\n                  <div className=\"flex justify-between\">\n                    <div className=\"h-4 bg-gray-200 rounded w-1/3\"></div>\n                    <div className=\"h-3 bg-gray-200 rounded w-1/4\"></div>\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      </main>\n    );\n  }\n\n  const getCategoryName = () => {\n    if (selectedCategory === \"all\") return t('pos.allProducts');\n    // This would ideally come from the categories query\n    const categoryNames: Record<number, string> = {\n      1: \"Beverages\",\n      2: \"Snacks\", \n      3: \"Electronics\",\n      4: \"Household\",\n      5: \"Personal Care\"\n    };\n    return categoryNames[selectedCategory as number] || \"Products\";\n  };\n\n  const handleSort = () => {\n    if (sortBy === 'name') {\n      setSortBy('price');\n    } else if (sortBy === 'price') {\n      setSortBy('stock');\n    } else {\n      setSortBy('name');\n      setSortOrder(sortOrder === 'asc' ? 'desc' : 'asc');\n    }\n  };\n\n  const getSortedProducts = () => {\n    const sorted = [...products].sort((a, b) => {\n      let aValue: string | number;\n      let bValue: string | number;\n\n      switch (sortBy) {\n        case 'price':\n          aValue = parseFloat(a.price);\n          bValue = parseFloat(b.price);\n          break;\n        case 'stock':\n          aValue = a.stock;\n          bValue = b.stock;\n          break;\n        default:\n          aValue = a.name.toLowerCase();\n          bValue = b.name.toLowerCase();\n      }\n\n      if (aValue < bValue) return sortOrder === 'asc' ? -1 : 1;\n      if (aValue > bValue) return sortOrder === 'asc' ? 1 : -1;\n      return 0;\n    });\n    return sorted;\n  };\n\n  return (\n    <main className=\"flex-1 flex flex-col\">\n      <div className=\"bg-white p-4 border-b pos-border flex items-center justify-between pt-[22px] pb-[22px] mt-2\">\n        <div>\n          <h2 className=\"font-medium pos-text-primary text-[14px]\">{getCategoryName()}</h2>\n          <p className=\"text-sm pos-text-secondary\">{products.length} {t('pos.productsAvailable')}</p>\n        </div>\n        <div className=\"flex items-center space-x-3\">\n          <Button \n            variant={viewMode === 'grid' ? \"default\" : \"outline\"} \n            size=\"sm\" \n            className=\"flex items-center\"\n            onClick={() => setViewMode(viewMode === 'grid' ? 'list' : 'grid')}\n          >\n            {viewMode === 'grid' ? <Grid3X3 className=\"mr-2\" size={16} /> : <List className=\"mr-2\" size={16} />}\n            {viewMode === 'grid' ? t('pos.gridView') : t('pos.listView')}\n          </Button>\n          <Button \n            variant=\"outline\" \n            size=\"sm\" \n            className=\"flex items-center\"\n            onClick={handleSort}\n          >\n            <ArrowUpDown className=\"mr-2\" size={16} />\n            {sortBy === 'name' ? t('pos.sortByName') : \n             sortBy === 'price' ? t('pos.sortByPrice') : \n             t('pos.sortByStock')} ({sortOrder === 'asc' ? '↑' : '↓'})\n          </Button>\n        </div>\n      </div>\n      <div className=\"flex-1 overflow-y-auto p-4\">\n        {products.length === 0 ? (\n          <div className=\"text-center py-12\">\n            <div className=\"text-gray-400 mb-4\">\n              <Grid3X3 size={48} className=\"mx-auto\" />\n            </div>\n            <h3 className=\"text-lg font-medium pos-text-secondary mb-2\">{t('pos.noProductsFound')}</h3>\n            <p className=\"pos-text-tertiary\">\n              {searchQuery ? \"Thử điều chỉnh từ khóa tìm kiếm\" : \"Không có sản phẩm trong danh mục này\"}\n            </p>\n          </div>\n        ) : (\n          <div className={viewMode === 'grid' ? \n            \"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4\" : \n            \"flex flex-col space-y-2\"\n          }>\n            {getSortedProducts().map((product) => {\n              const stockStatus = getStockStatus(product.stock);\n              const isPopular = getPopularBadge(product.name);\n              const isLowStock = getLowStockBadge(product.stock);\n\n              return (\n                <div\n                  key={product.id}\n                  className={viewMode === 'grid' ? \n                    \"bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all duration-200 overflow-hidden cursor-pointer relative border border-gray-100\" :\n                    \"bg-white rounded-lg shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer relative border border-gray-100 flex items-center p-4\"\n                  }\n                  onClick={() => handleAddToCart(product)}\n                >\n                  {viewMode === 'grid' ? (\n                    <>\n                      {product.imageUrl ? (\n                        <img \n                          src={product.imageUrl} \n                          alt={product.name}\n                          className=\"w-full h-32 object-cover\"\n                          onError={(e) => {\n                            const target = e.target as HTMLImageElement;\n                            target.style.display = 'none';\n                            const placeholder = target.nextElementSibling as HTMLElement;\n                            if (placeholder) placeholder.style.display = 'flex';\n                          }}\n                        />\n                      ) : null}\n                      {!product.imageUrl ? (\n                        <div className=\"w-full h-32 bg-gradient-to-br from-gray-100 to-gray-200 flex flex-col items-center justify-center\">\n                          <img \n                            src={getPlaceholderImage(product.categoryId, product.name)} \n                            alt={`${product.name} placeholder`}\n                            className=\"w-20 h-20 opacity-60\"\n                          />\n                        </div>\n                      ) : (\n                        <div className=\"w-full h-32 bg-gradient-to-br from-gray-100 to-gray-200 hidden flex-col items-center justify-center\">\n                          <img \n                            src={getPlaceholderImage(product.categoryId, product.name)} \n                            alt={`${product.name} placeholder`}\n                            className=\"w-20 h-20 opacity-60\"\n                          />\n                        </div>\n                      )}\n\n                      <div className=\"p-3\">\n                        <h3 className=\"font-medium pos-text-primary mb-1 line-clamp-2\">{product.name}</h3>\n                        <p className=\"text-sm pos-text-secondary mb-2\">SKU: {product.sku}</p>\n                        <div className=\"flex items-center justify-between\">\n                          <span className=\"text-lg font-bold text-green-600\">{parseFloat(product.price).toLocaleString()} ₫</span>\n                          {product.trackInventory !== false && (\n                            <span className={`text-xs font-medium ${stockStatus.color}`}>\n                              {stockStatus.text}\n                            </span>\n                          )}\n                        </div>\n                      </div>\n                    </>\n                  ) : (\n                    <>\n                      <div className=\"w-16 h-16 rounded-lg overflow-hidden flex-shrink-0 mr-4\">\n                        {product.imageUrl ? (\n                          <img \n                            src={product.imageUrl} \n                            alt={product.name}\n                            className=\"w-full h-full object-cover\"\n                          />\n                        ) : (\n                          <div className=\"w-full h-full bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center\">\n                            <img \n                              src={getPlaceholderImage(product.categoryId, product.name)} \n                              alt={`${product.name} placeholder`}\n                              className=\"w-8 h-8 opacity-60\"\n                            />\n                          </div>\n                        )}\n                      </div>\n                      <div className=\"flex-1\">\n                        <h3 className=\"font-medium pos-text-primary mb-1\">{product.name}</h3>\n                        <p className=\"text-sm pos-text-secondary mb-1\">SKU: {product.sku}</p>\n                        <div className=\"flex items-center justify-between\">\n                          <span className=\"text-lg font-bold text-green-600\">{parseFloat(product.price).toLocaleString()} ₫</span>\n                          {product.trackInventory !== false && (\n                            <span className={`text-xs font-medium ${stockStatus.color}`}>\n                              {stockStatus.text}\n                            </span>\n                          )}\n                        </div>\n                      </div>\n                    </>\n                  )}\n\n                  {/* Badges */}\n                  {isPopular && (\n                    <div className=\"absolute top-2 right-2 bg-green-600 text-white text-xs px-2 py-1 rounded-full\">\n                      {t('pos.popular')}\n                    </div>\n                  )}\n                  {isLowStock && product.trackInventory !== false && (\n                    <div className=\"absolute top-2 right-2 bg-red-500 text-white text-xs px-2 py-1 rounded-full\">\n                      {t('pos.lowStock')}\n                    </div>\n                  )}\n                </div>\n              );\n            })}\n          </div>\n        )}\n      </div>\n    </main>\n  );\n}","size_bytes":19775},"client/src/components/pos/product-manager-modal.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { X, Plus, Upload, Download, Edit, Trash2 } from \"lucide-react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport {\n  insertProductSchema,\n  type Product,\n  type Category,\n} from \"@shared/schema\";\nimport { z } from \"zod\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport { BulkImportModal } from \"./bulk-import-modal\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport * as XLSX from \"xlsx\";\n\ninterface ProductManagerModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nexport function ProductManagerModal({\n  isOpen,\n  onClose,\n}: ProductManagerModalProps) {\n  const { t } = useTranslation();\n\n  const productFormSchema = insertProductSchema.extend({\n    categoryId: z.number().min(1, t(\"tables.categoryRequired\")),\n    price: z.string().min(1, \"Price is required\").refine((val) => {\n      const num = parseFloat(val.replace(/\\./g, ''));\n      return !isNaN(num) && num > 0 && num < 100000000; // Max 99,999,999 (8 digits)\n    }, \"Price must be a valid positive number and less than 100,000,000\"),\n    sku: z.string().min(1, t(\"tables.skuRequired\")),\n    name: z.string().min(1, t(\"tables.productNameRequired\")),\n    productType: z.number().min(1, t(\"tables.productTypeRequired\")),\n    trackInventory: z.boolean().optional(),\n    stock: z.number().min(0, \"Stock must be 0 or greater\"),\n    taxRate: z.string().min(1, \"Tax rate is required\").refine((val) => !isNaN(parseFloat(val)) && parseFloat(val) >= 0 && parseFloat(val) <= 100, \"Tax rate must be between 0 and 100\"),\n    priceIncludesTax: z.boolean().optional(),\n    afterTaxPrice: z.string().optional().refine((val) => {\n      if (!val) return true; // Optional field\n      const num = parseFloat(val.replace(/\\./g, ''));\n      return !isNaN(num) && num > 0 && num < 100000000;\n    }, \"After tax price must be a valid positive number and less than 100,000,000\"),\n  });\n  const [showAddForm, setShowAddForm] = useState(false);\n  const [showBulkImport, setShowBulkImport] = useState(false);\n  const [editingProduct, setEditingProduct] = useState<Product | null>(null);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const { toast } = useToast();\n\n  const {\n    data: products = [],\n    isLoading,\n    refetch,\n  } = useQuery<Product[]>({\n    queryKey: [\"/api/products\"],\n    enabled: isOpen,\n  });\n\n  const { data: categories = [] } = useQuery<Category[]>({\n    queryKey: [\"/api/categories\"],\n    enabled: isOpen,\n  });\n\n  const createProductMutation = useMutation({\n    mutationFn: async (data: z.infer<typeof productFormSchema>) => {\n      console.log(\"Sending product data:\", data);\n      const response = await fetch(\"/api/products\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        console.error(\"Product creation error:\", errorData);\n        throw new Error(errorData.message || \"Failed to create product\");\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/products/active\"] });\n      setShowAddForm(false);\n      resetForm();\n      toast({\n        title: \"Success\",\n        description: \"Product created successfully\",\n      });\n    },\n    onError: (error: Error) => {\n      console.error(\"Create product mutation error:\", error);\n\n      let errorMessage = \"Failed to create product\";\n      if (error.message.includes(\"already exists\")) {\n        errorMessage = \"SKU already exists. Please use a different SKU.\";\n      } else if (error.message.includes(\"Invalid product data\")) {\n        errorMessage = \"Invalid product data. Please check all fields.\";\n      } else if (error.message) {\n        errorMessage = error.message;\n      }\n\n      toast({\n        title: \"Error\", \n        description: errorMessage,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateProductMutation = useMutation({\n    mutationFn: async ({\n      id,\n      data,\n    }: {\n      id: number;\n      data: Partial<z.infer<typeof productFormSchema>>;\n    }) => {\n      const response = await fetch(`/api/products/${id}`, {\n        method: \"PUT\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n      });\n      if (!response.ok) throw new Error(\"Failed to update product\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/products/active\"] });\n      setEditingProduct(null);\n      toast({\n        title: \"Success\",\n        description: \"Product updated successfully\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update product\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteProductMutation = useMutation({\n    mutationFn: async (id: number) => {\n      const response = await fetch(`/api/products/${id}`, {\n        method: \"DELETE\",\n      });\n      if (!response.ok) throw new Error(\"Failed to delete product\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/products\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/products/active\"] });\n      toast({\n        title: \"Success\",\n        description: \"Product deleted successfully\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete product\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const form = useForm<z.infer<typeof productFormSchema>>({\n    resolver: zodResolver(productFormSchema),\n    defaultValues: {\n      name: \"\",\n      sku: \"\",\n      price: \"\",\n      stock: 0,\n      categoryId: 0,\n      productType: 1,\n      imageUrl: \"\",\n      trackInventory: true,\n      taxRate: \"8.00\",\n      priceIncludesTax: false,\n      afterTaxPrice: \"\",\n    },\n  });\n\n  // Helper functions for currency formatting\n  const formatCurrency = (value: string | number): string => {\n    if (typeof value === 'string') {\n      // If it's already formatted with dots, parse and reformat\n      if (value.includes('.')) {\n        const num = parseFloat(value.replace(/\\./g, ''));\n        if (isNaN(num)) return '';\n        return num.toLocaleString('vi-VN');\n      }\n      // If it's a plain number string\n      const num = parseFloat(value);\n      if (isNaN(num)) return '';\n      return num.toLocaleString('vi-VN');\n    }\n    \n    // If it's a number\n    if (isNaN(value)) return '';\n    return value.toLocaleString('vi-VN');\n  };\n\n  const parseCurrency = (value: string): number => {\n    // Remove all dots and parse as number\n    const cleaned = value.replace(/\\./g, '');\n    return parseFloat(cleaned) || 0;\n  };\n\n  const onSubmit = (data: z.infer<typeof productFormSchema>) => {\n    console.log(\"Form submission data:\", data);\n\n    // Validate required fields\n    if (!data.name || !data.sku || !data.price || !data.categoryId || !data.taxRate) {\n      toast({\n        title: \"Error\",\n        description: \"Please fill in all required fields: Name, SKU, Price, Category, and Tax Rate\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Validate price limit\n    const priceNum = parseFloat(data.price);\n    if (priceNum >= 100000000) {\n      toast({\n        title: \"Error\",\n        description: \"Price cannot exceed 99,999,999 VND\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Transform data to ensure proper types\n    const transformedData = {\n      name: data.name.trim(),\n      sku: data.sku.trim().toUpperCase(),\n      price: data.price.toString(), // Use direct value without parsing\n      stock: Number(data.stock) || 0,\n      categoryId: Number(data.categoryId),\n      productType: Number(data.productType) || 1,\n      trackInventory: data.trackInventory !== false,\n      imageUrl: data.imageUrl?.trim() || null,\n      taxRate: data.taxRate.toString(),\n      priceIncludesTax: data.priceIncludesTax || false,\n      afterTaxPrice: data.afterTaxPrice ? data.afterTaxPrice.toString() : null\n    };\n\n    console.log(\"Transformed data:\", transformedData);\n\n    if (editingProduct) {\n      updateProductMutation.mutate({ id: editingProduct.id, data: transformedData });\n    } else {\n      createProductMutation.mutate(transformedData);\n    }\n  };\n\n  const handleEdit = (product: Product) => {\n    setEditingProduct(product);\n    \n    form.reset({\n      name: product.name,\n      sku: product.sku,\n      price: product.price, // Show actual price value without formatting\n      stock: product.stock,\n      categoryId: product.categoryId,\n      productType: product.productType || 1,\n      imageUrl: product.imageUrl || \"\",\n      trackInventory: product.trackInventory !== false,\n      taxRate: product.taxRate || \"8.00\",\n      priceIncludesTax: product.priceIncludesTax || false,\n      // Use saved after-tax price if available, otherwise calculate\n      afterTaxPrice: product.afterTaxPrice || (() => {\n        const basePrice = parseFloat(product.price);\n        const taxRate = parseFloat(product.taxRate || \"8.00\");\n        return Math.round(basePrice + (basePrice * taxRate / 100)).toString();\n      })(),\n    });\n    setShowAddForm(true);\n  };\n\n  const handleDelete = (id: number) => {\n    if (confirm(t(\"tables.confirmDeleteProduct\"))) {\n      deleteProductMutation.mutate(id);\n    }\n  };\n\n  const resetForm = () => {\n    setShowAddForm(false);\n    setEditingProduct(null);\n    form.reset({\n      name: \"\",\n      sku: \"\",\n      price: \"\",\n      stock: 0,\n      categoryId: categories.length > 0 ? categories[0].id : 0,\n      productType: 1,\n      imageUrl: \"\",\n      trackInventory: true,\n      taxRate: \"8.00\",\n      priceIncludesTax: false,\n      afterTaxPrice: \"\",\n    });\n  };\n\n  const getCategoryName = (categoryId: number) => {\n    return categories.find((c) => c.id === categoryId)?.name || \"Unknown\";\n  };\n\n  const getProductTypeName = (productType: number) => {\n    const types = {\n      1: t(\"tables.goodsType\"),\n      2: t(\"tables.materialType\"), \n      3: t(\"tables.finishedProductType\")\n    };\n    return types[productType as keyof typeof types] || \"Unknown\";\n  };\n\n  const filteredProducts = products.filter((product) => {\n    const searchLower = searchTerm.toLowerCase();\n    return (\n      product.name.toLowerCase().includes(searchLower) ||\n      product.sku.toLowerCase().includes(searchLower)\n    );\n  });\n\n  const exportProductsToExcel = () => {\n    const exportData = [\n      [\n        \"STT\",\n        \"Tên sản phẩm\",\n        \"SKU\",\n        \"Danh mục\",\n        \"Giá bán\",\n        \"% Thuế\",\n        \"Tồn kho\",\n        \"Hình ảnh (URL)\",\n      ],\n    ];\n\n    products.forEach((product, index) => {\n      exportData.push([\n        index + 1,\n        product.name,\n        product.sku,\n        getCategoryName(product.categoryId),\n        parseFloat(product.price),\n        product.taxRate || \"8.00\",\n        product.stock,\n        product.imageUrl || \"\",\n      ]);\n    });\n\n    const ws = XLSX.utils.aoa_to_sheet(exportData);\n\n    // Auto-fit column widths\n    const colWidths = [\n      { wch: 5 }, // STT\n      { wch: 25 }, // Tên sản phẩm\n      { wch: 15 }, // SKU\n      { wch: 15 }, // Danh mục\n      { wch: 12 }, // Giá bán\n      { wch: 10 }, // % Thuế\n      { wch: 10 }, // Tồn kho\n      { wch: 30 }, // Hình ảnh URL\n    ];\n    ws[\"!cols\"] = colWidths;\n\n    // Style header row\n    const range = XLSX.utils.decode_range(ws[\"!ref\"] || \"A1\");\n    for (let col = range.s.c; col <= range.e.c; col++) {\n      const cellAddress = XLSX.utils.encode_cell({ r: 0, c: col });\n      if (!ws[cellAddress]) continue;\n      ws[cellAddress].s = {\n        font: { bold: true, color: { rgb: \"FFFFFF\" } },\n        fill: { fgColor: { rgb: \"059669\" } }, // Green background\n        alignment: { horizontal: \"center\" },\n      };\n    }\n\n    const wb = XLSX.utils.book_new();\n    XLSX.utils.book_append_sheet(wb, ws, \"Danh sách sản phẩm\");\n\n    const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, \"-\");\n    XLSX.writeFile(wb, `danh_sach_san_pham_${timestamp}.xlsx`);\n\n    toast({\n      title: \"Thành công\",\n      description: `Đã xuất ${products.length} sản phẩm ra file Excel`,\n    });\n  };\n\n  useEffect(() => {\n    if (isOpen) {\n      refetch();\n      // Reset form completely when opening modal\n      if (!editingProduct) {\n        form.reset({\n          name: \"\",\n          sku: \"\",\n          price: \"\",\n          stock: 0,\n          categoryId: 0,\n          productType: 1,\n          imageUrl: \"\",\n          trackInventory: true,\n          taxRate: \"8.00\",\n          priceIncludesTax: false,\n          afterTaxPrice: \"\",\n        });\n      }\n    }\n  }, [isOpen, refetch, editingProduct]);\n\n  // Add keyboard support for closing modal\n  useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (event.key === 'Escape' && isOpen) {\n        handleModalClose();\n      }\n    };\n\n    if (isOpen) {\n      document.addEventListener('keydown', handleKeyDown);\n    }\n\n    return () => {\n      document.removeEventListener('keydown', handleKeyDown);\n    };\n  }, [isOpen]);\n\n  const handleModalClose = () => {\n    // Reset all form states when modal closes\n    setShowAddForm(false);\n    setEditingProduct(null);\n    form.reset({\n      name: \"\",\n      sku: \"\",\n      price: \"\",\n      stock: 0,\n      categoryId: 0,\n      productType: 1,\n      imageUrl: \"\",\n      trackInventory: true,\n      taxRate: \"8.00\",\n      priceIncludesTax: false,\n      afterTaxPrice: \"\",\n    });\n    onClose();\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={handleModalClose}>\n      <DialogContent\n        className=\"max-w-4xl w-full max-h-screen overflow-y-auto\"\n      >\n        <DialogHeader>\n          <DialogTitle>\n            {t(\"tables.productManagement\")}\n          </DialogTitle>\n        </DialogHeader>\n\n        <div className=\"p-6\">\n          {!showAddForm ? (\n            <>\n              <div className=\"flex flex-col space-y-4 mb-6\">\n                <div className=\"flex space-x-4\">\n                  <Button\n                    onClick={() => setShowAddForm(true)}\n                    className=\"bg-green-600 hover:bg-green-700 text-white font-medium transition-colors duration-200\"\n                  >\n                    <Plus className=\"mr-2\" size={16} />\n                    {t(\"tables.addNewProduct\")}\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    className=\"border-orange-500 text-orange-700 hover:bg-orange-100 hover:border-orange-600\"\n                    onClick={() => setShowBulkImport(true)}\n                  >\n                    <Upload className=\"mr-2\" size={16} />\n                    {t(\"tables.bulkImport\")}\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    className=\"border-green-500 text-green-700 hover:bg-green-100 hover:border-green-600\"\n                    onClick={exportProductsToExcel}\n                  >\n                    <Download className=\"mr-2\" size={16} />\n                    {t(\"tables.export\")}\n                  </Button>\n                </div>\n                \n                <div className=\"flex items-center space-x-2\">\n                  <Input\n                    placeholder=\"Tìm kiếm theo tên hoặc mã SKU...\"\n                    value={searchTerm}\n                    onChange={(e) => setSearchTerm(e.target.value)}\n                    className=\"max-w-md\"\n                  />\n                  {searchTerm && (\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => setSearchTerm(\"\")}\n                      className=\"text-gray-500 hover:text-gray-700\"\n                    >\n                      <X size={16} />\n                    </Button>\n                  )}\n                </div>\n              </div>\n\n              <div className=\"bg-gray-50 rounded-lg overflow-hidden\">\n                {isLoading ? (\n                  <div className=\"p-8 text-center\">{t(\"tables.loading\")}</div>\n                ) : filteredProducts.length === 0 ? (\n                  <div className=\"p-8 text-center\">\n                    <p className=\"text-gray-500\">\n                      {searchTerm \n                        ? `Không tìm thấy sản phẩm nào với từ khóa \"${searchTerm}\"`\n                        : \"Không có sản phẩm nào\"\n                      }\n                    </p>\n                  </div>\n                ) : (\n                  <table className=\"w-full\">\n                    <thead className=\"bg-gray-100\">\n                      <tr>\n                        <th className=\"text-left py-3 px-4 font-medium pos-text-primary\">\n                          {t(\"tables.product\")}\n                        </th>\n                        <th className=\"text-left py-3 px-4 font-medium pos-text-primary\">\n                          {t(\"tables.sku\")}\n                        </th>\n                        <th className=\"text-left py-3 px-4 font-medium pos-text-primary\">\n                          {t(\"tables.category\")}\n                        </th>\n                        <th className=\"text-left py-3 px-4 font-medium pos-text-primary\">\n                          {t(\"tables.productType\")}\n                        </th>\n                        <th className=\"text-left py-3 px-4 font-medium pos-text-primary\">\n                          {t(\"tables.price\")}\n                        </th>\n                        <th className=\"text-left py-3 px-4 font-medium pos-text-primary\">\n                          {t(\"tables.taxRate\")}\n                        </th>\n                        <th className=\"text-left py-3 px-4 font-medium pos-text-primary\">\n                          Giá sau thuế\n                        </th>\n                        <th className=\"text-left py-3 px-4 font-medium pos-text-primary\">\n                          {t(\"tables.stock\")}\n                        </th>\n                        <th className=\"text-left py-3 px-4 font-medium pos-text-primary\">\n                          {t(\"tables.actions\")}\n                        </th>\n                      </tr>\n                    </thead>\n                    <tbody className=\"bg-white\">\n                      {filteredProducts.map((product) => (\n                        <tr\n                          key={product.id}\n                          className=\"border-b border-gray-200\"\n                        >\n                          <td className=\"py-3 px-4\">\n                            <div className=\"flex items-center space-x-3\">\n                              {product.imageUrl ? (\n                                <img\n                                  src={product.imageUrl}\n                                  alt={product.name}\n                                  className=\"w-10 h-10 object-cover rounded\"\n                                />\n                              ) : (\n                                <div className=\"w-10 h-10 bg-gray-200 rounded\"></div>\n                              )}\n                              <span className=\"font-medium\">\n                                {product.name}\n                              </span>\n                            </div>\n                          </td>\n                          <td className=\"py-3 px-4 pos-text-secondary\">\n                            {product.sku}\n                          </td>\n                          <td className=\"py-3 px-4 pos-text-secondary\">\n                            {getCategoryName(product.categoryId)}\n                          </td>\n                          <td className=\"py-3 px-4 pos-text-secondary\">\n                            {getProductTypeName(product.productType || 1)}\n                          </td>\n                          <td className=\"py-3 px-4 font-medium\">\n                            {Math.round(parseFloat(product.price)).toLocaleString(\"vi-VN\")} ₫\n                          </td>\n                          <td className=\"py-3 px-4 pos-text-secondary\">\n                            {product.taxRate || \"8.00\"}%\n                          </td>\n                          <td className=\"py-3 px-4 font-medium\">\n                            {(() => {\n                              // Use saved after-tax price if available, otherwise calculate\n                              if (product.afterTaxPrice) {\n                                return Math.round(parseFloat(product.afterTaxPrice)).toLocaleString(\"vi-VN\", { maximumFractionDigits: 0 });\n                              } else {\n                                const basePrice = parseFloat(product.price);\n                                const taxRate = parseFloat(product.taxRate || \"8.00\");\n                                const afterTaxPrice = basePrice + (basePrice * taxRate / 100);\n                                return Math.round(afterTaxPrice).toLocaleString(\"vi-VN\", { maximumFractionDigits: 0 });\n                              }\n                            })()} ₫\n                          </td>\n                          <td className=\"py-3 px-4\">\n                            <span\n                              className={`px-2 py-1 text-xs rounded-full ${\n                                product.stock > 10\n                                  ? \"bg-green-600 text-white\"\n                                  : product.stock > 5\n                                    ? \"bg-orange-500 text-white\"\n                                    : product.stock > 0\n                                      ? \"bg-red-500 text-white\"\n                                      : \"bg-gray-400 text-white\"\n                              }`}\n                            >\n                              {product.stock}\n                            </span>\n                          </td>\n                          <td className=\"py-3 px-4\">\n                            <div className=\"flex space-x-2\">\n                              <Button\n                                size=\"sm\"\n                                variant=\"ghost\"\n                                onClick={() => handleEdit(product)}\n                                className=\"text-blue-600 hover:text-blue-800\"\n                              >\n                                <Edit size={16} />\n                              </Button>\n                              <Button\n                                size=\"sm\"\n                                variant=\"ghost\"\n                                onClick={() => handleDelete(product.id)}\n                                className=\"text-red-500 hover:text-red-700\"\n                              >\n                                <Trash2 size={16} />\n                              </Button>\n                            </div>\n                          </td>\n                        </tr>\n                      ))}\n                    </tbody>\n                  </table>\n                )}\n              </div>\n            </>\n          ) : (\n            <div>\n              <div className=\"flex items-center justify-between mb-6\">\n                <h3 className=\"text-lg font-medium\">\n                  {editingProduct\n                    ? t(\"tables.editProduct\")\n                    : t(\"tables.addNewProduct\")}\n                </h3>\n                {/* <Button variant=\"ghost\" onClick={resetForm}>\n                  <X size={16} />\n                </Button> */}\n              </div>\n\n              <Form {...form}>\n                <form\n                  onSubmit={form.handleSubmit(onSubmit)}\n                  className=\"space-y-4\"\n                >\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"name\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t(\"tables.productName\")}</FormLabel>\n                          <FormControl>\n                            <Input\n                              {...field}\n                              placeholder={t(\"tables.productNamePlaceholder\")}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"sku\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t(\"tables.sku\")}</FormLabel>\n                          <FormControl>\n                            <Input\n                              {...field}\n                              placeholder={t(\"tables.skuPlaceholder\")}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <div className=\"grid grid-cols-5 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"price\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t(\"tables.price\")}</FormLabel>\n                          <FormControl>\n                            <Input\n                              {...field}\n                              type=\"text\"\n                              placeholder=\"4000\"\n                              onChange={(e) => {\n                                const value = e.target.value;\n                                // Only allow numbers\n                                const sanitized = value.replace(/[^0-9]/g, '');\n                                \n                                // Check if the number would exceed the limit\n                                const num = parseInt(sanitized);\n                                if (!isNaN(num) && num >= 100000000) {\n                                  // Don't allow input that would exceed the limit\n                                  return;\n                                }\n                                \n                                // Store the integer value\n                                field.onChange(sanitized);\n                                \n                                // Calculate after tax price from base price\n                                if (sanitized && !isNaN(parseInt(sanitized))) {\n                                  const basePrice = parseInt(sanitized);\n                                  const taxRate = parseFloat(form.getValues(\"taxRate\") || \"8.00\");\n                                  \n                                  // Calculate after tax price: afterTaxPrice = basePrice + (basePrice * taxRate/100)\n                                  const afterTaxPrice = Math.round(basePrice + (basePrice * taxRate / 100));\n                                  \n                                  // Update the after tax price field\n                                  form.setValue(\"afterTaxPrice\", afterTaxPrice.toString());\n                                }\n                              }}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"taxRate\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t(\"tables.taxRate\")}</FormLabel>\n                          <FormControl>\n                            <Input\n                              {...field}\n                              type=\"number\"\n                              step=\"0.01\"\n                              min=\"0\"\n                              max=\"100\"\n                              placeholder=\"8.00\"\n                              onChange={(e) => {\n                                const taxRate = e.target.value;\n                                field.onChange(taxRate);\n                                \n                                // Calculate after tax price when tax rate changes\n                                const basePrice = form.getValues(\"price\");\n                                if (basePrice && !isNaN(parseInt(basePrice)) && taxRate && !isNaN(parseFloat(taxRate))) {\n                                  const basePriceNum = parseInt(basePrice);\n                                  const taxRateNum = parseFloat(taxRate);\n                                  \n                                  // Calculate after tax price: afterTaxPrice = basePrice + (basePrice * taxRate/100)\n                                  const afterTaxPrice = Math.round(basePriceNum + (basePriceNum * taxRateNum / 100));\n                                  \n                                  // Update the after tax price field\n                                  form.setValue(\"afterTaxPrice\", afterTaxPrice.toString());\n                                }\n                              }}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"afterTaxPrice\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Giá sau thuế</FormLabel>\n                          <FormControl>\n                            <Input\n                              {...field}\n                              type=\"text\"\n                              placeholder=\"4320\"\n                              onChange={(e) => {\n                                const value = e.target.value;\n                                // Only allow numbers\n                                const sanitized = value.replace(/[^0-9]/g, '');\n                                \n                                // Check if the number would exceed the limit\n                                const num = parseInt(sanitized);\n                                if (!isNaN(num) && num >= 100000000) {\n                                  // Don't allow input that would exceed the limit\n                                  return;\n                                }\n                                \n                                // Store the integer value\n                                field.onChange(sanitized);\n                                \n                                // Calculate base price from after tax price\n                                if (sanitized && !isNaN(parseInt(sanitized))) {\n                                  const afterTaxPrice = parseInt(sanitized);\n                                  const taxRate = parseFloat(form.getValues(\"taxRate\") || \"8.00\");\n                                  \n                                  // Calculate base price: basePrice = afterTaxPrice / (1 + taxRate/100)\n                                  const basePrice = Math.round(afterTaxPrice / (1 + taxRate / 100));\n                                  \n                                  // Update the price field\n                                  form.setValue(\"price\", basePrice.toString());\n                                }\n                              }}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"stock\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t(\"tables.stock\")}</FormLabel>\n                          <FormControl>\n                            <Input\n                              {...field}\n                              type=\"number\"\n                              placeholder={t(\"tables.stockPlaceholder\")}\n                              onChange={(e) =>\n                                field.onChange(parseInt(e.target.value) || 0)\n                              }\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"categoryId\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t(\"tables.category\")}</FormLabel>\n                          <Select\n                            onValueChange={(value) =>\n                              field.onChange(parseInt(value))\n                            }\n                            value={field.value.toString()}\n                          >\n                            <FormControl>\n                              <SelectTrigger>\n                                <SelectValue\n                                  placeholder={t(\"tables.selectCategory\")}\n                                />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              {categories.map((category) => (\n                                <SelectItem\n                                  key={category.id}\n                                  value={category.id.toString()}\n                                >\n                                  {category.name}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"productType\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t(\"tables.productType\")}</FormLabel>\n                          <Select\n                            onValueChange={(value) =>\n                              field.onChange(parseInt(value))\n                            }\n                            value={field.value.toString()}\n                          >\n                            <FormControl>\n                              <SelectTrigger>\n                                <SelectValue\n                                  placeholder={t(\"tables.selectProductType\")}\n                                />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              <SelectItem value=\"1\">{t(\"tables.goodsType\")}</SelectItem>\n                              <SelectItem value=\"2\">{t(\"tables.materialType\")}</SelectItem>\n                              <SelectItem value=\"3\">{t(\"tables.finishedProductType\")}</SelectItem>\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <FormField\n                    control={form.control}\n                    name=\"imageUrl\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>{t(\"tables.imageUrlOptional\")}</FormLabel>\n                        <FormControl>\n                          <Input\n                            {...field}\n                            placeholder={t(\"tables.imageUrl\")}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <div className=\"space-y-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"trackInventory\"\n                      render={({ field }) => (\n                        <FormItem className=\"flex flex-row items-start space-x-3 space-y-0\">\n                          <FormControl>\n                            <Checkbox\n                              checked={field.value !== false}\n                              onCheckedChange={field.onChange}\n                            />\n                          </FormControl>\n                          <div className=\"space-y-1 leading-none\">\n                            <FormLabel>\n                              {t(\"inventory.trackInventory\")}\n                            </FormLabel>\n                          </div>\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"priceIncludesTax\"\n                      render={({ field }) => (\n                        <FormItem className=\"flex flex-row items-start space-x-3 space-y-0\">\n                          <FormControl>\n                            <Checkbox\n                              checked={field.value || false}\n                              onCheckedChange={field.onChange}\n                            />\n                          </FormControl>\n                          <div className=\"space-y-1 leading-none\">\n                            <FormLabel>\n                              Giá đã bao gồm thuế\n                            </FormLabel>\n                          </div>\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <div className=\"flex justify-end\">\n                    <Button\n                      type=\"submit\"\n                      disabled={\n                        createProductMutation.isPending ||\n                        updateProductMutation.isPending\n                      }\n                      className=\"bg-green-600 hover:bg-green-700 text-white font-medium transition-colors duration-200\"\n                    >\n                      {editingProduct\n                        ? t(\"tables.updateProduct\")\n                        : t(\"tables.createProduct\")}\n                    </Button>\n                  </div>\n                </form>\n              </Form>\n            </div>\n          )}\n        </div>\n\n        <BulkImportModal\n          isOpen={showBulkImport}\n          onClose={() => setShowBulkImport(false)}\n        />\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":39660},"client/src/components/pos/receipt-modal.tsx":{"content":"import { X, Printer, Mail } from \"lucide-react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport type { Receipt } from \"@shared/schema\";\nimport logoPath from \"@assets/EDPOS_1753091767028.png\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { EInvoiceModal } from \"./einvoice-modal\";\nimport { PaymentMethodModal } from \"./payment-method-modal\";\nimport { useState, useEffect } from \"react\";\nimport { useTranslation } from \"@/lib/i18n\";\n\ninterface ReceiptModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  receipt: Receipt | null;\n  onConfirm?: () => void;\n  isPreview?: boolean;\n  cartItems?: Array<{\n    id: number;\n    name: string;\n    price: number;\n    quantity: number;\n    sku?: string;\n    taxRate?: number;\n  }>;\n  total?: number;\n  isEInvoice?: boolean;\n  customerName?: string;\n  customerTaxCode?: string;\n}\n\nexport function ReceiptModal({\n  isOpen,\n  onClose,\n  receipt,\n  onConfirm,\n  isPreview = false,\n  cartItems = [],\n  total,\n  isEInvoice = false,\n  customerName,\n  customerTaxCode,\n}: ReceiptModalProps) {\n  const [showEInvoiceModal, setShowEInvoiceModal] = useState(false);\n  const [showPaymentMethodModal, setShowPaymentMethodModal] = useState(false);\n  const [hasAutoOpened, setHasAutoOpened] = useState(false);\n  const { t } = useTranslation();\n\n  console.log(\"=== RECEIPT MODAL RENDERED ===\");\n  console.log(\n    \"Receipt Modal Mode:\",\n    isPreview ? \"PREVIEW (Step 1)\" : \"FINAL RECEIPT (Step 5)\",\n  );\n  console.log(\"Receipt Modal isOpen:\", isOpen);\n  console.log(\"Receipt Modal isPreview:\", isPreview);\n  console.log(\"Receipt Modal cartItems received:\", cartItems);\n  console.log(\"Receipt Modal cartItems length:\", cartItems?.length || 0);\n  console.log(\"Receipt Modal total:\", total);\n  console.log(\"Receipt Modal receipt:\", receipt);\n\n  // Query store settings to get dynamic address\n  const { data: storeSettings } = useQuery({\n    queryKey: [\"/api/store-settings\"],\n    queryFn: async () => {\n      const response = await apiRequest(\"GET\", \"/api/store-settings\");\n      return response.json();\n    },\n  });\n\n  // Log receipt modal state for debugging\n  useEffect(() => {\n    console.log(\"🔍 Receipt Modal state:\", {\n      isOpen,\n      hasReceipt: !!receipt,\n      isPreview,\n    });\n  }, [isOpen, receipt, isPreview]);\n\n  // Debug: Log all props\n  console.log(\"🔍 ReceiptModal Props Debug:\", {\n    isOpen,\n    isPreview,\n    receipt,\n    cartItems: cartItems?.length || 0,\n    onConfirm: !!onConfirm\n  });\n\n  // Don't render if modal is not open\n  if (!isOpen) {\n    console.log(\"❌ Receipt Modal: Modal is closed\");\n    return null;\n  }\n\n  // For preview mode, we can show even without receipt\n  // For final receipt mode, we need receipt data\n  if (!receipt && !isPreview) {\n    console.log(\"❌ Receipt Modal: No receipt data provided for final receipt\");\n    return (\n      <Dialog open={isOpen} onOpenChange={onClose}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Lỗi hóa đơn</DialogTitle>\n          </DialogHeader>\n          <div className=\"p-4 text-center\">\n            <p>Không có dữ liệu hóa đơn để hiển thị</p>\n            <Button onClick={onClose} className=\"mt-4\">\n              Đóng\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n    );\n  }\n\n  const handlePrint = async () => {\n    console.log(\"🖨️ Starting browser print process\");\n    await handleBrowserPrint();\n  };\n\n  const handleBrowserPrint = async () => {\n    const printContent = document.getElementById(\"receipt-content\");\n    if (printContent) {\n      // Calculate content height dynamically\n      const contentHeight = printContent.scrollHeight;\n      const windowWidth = 400;\n      // Add some padding for print margins and controls\n      const windowHeight = Math.min(Math.max(contentHeight + 120, 300), 800);\n\n      console.log(\n        \"Receipt content height:\",\n        contentHeight,\n        \"Window height:\",\n        windowHeight,\n      );\n\n      const printWindow = window.open(\n        \"\",\n        \"_blank\",\n        `width=${windowWidth},height=${windowHeight},scrollbars=yes,resizable=yes`,\n      );\n      if (printWindow) {\n        printWindow.document.write(`\n          <!DOCTYPE html>\n          <html>\n            <head>\n              <title>Receipt</title>\n              <style>\n                body {\n                  font-family: monospace;\n                  margin: 0;\n                  padding: 10px;\n                  font-size: 12px;\n                  line-height: 1.4;\n                  background: white;\n                }\n                .receipt-container {\n                  max-width: 300px;\n                  margin: 0 auto;\n                  background: white;\n                }\n                .text-center { text-align: center; }\n                .text-right { text-align: right; }\n                .font-bold { font-weight: bold; }\n                .border-t { border-top: 1px dashed #000; margin: 8px 0; }\n                .border-b { border-bottom: 1px dashed #000; margin: 8px 0; }\n                .flex { display: flex; }\n                .justify-between { justify-content: space-between; }\n                .space-y-1 > * + * { margin-top: 4px; }\n                .mb-2 { margin-bottom: 8px; }\n                .mb-4 { margin-bottom: 16px; }\n                .text-sm { font-size: 11px; }\n                .text-xs { font-size: 10px; }\n                @media print {\n                  body { margin: 0; }\n                  .receipt-container { box-shadow: none; }\n                }\n              </style>\n            </head>\n            <body>\n              ${printContent.innerHTML}\n            </body>\n          </html>\n        `);\n        printWindow.document.close();\n\n        // Wait for content to load then adjust window size\n        printWindow.onload = () => {\n          const actualContentHeight = printWindow.document.body.scrollHeight;\n          const newHeight = Math.min(\n            Math.max(actualContentHeight + 100, 300),\n            800,\n          );\n          console.log(\n            \"Actual content height:\",\n            actualContentHeight,\n            \"Resizing to:\",\n            newHeight,\n          );\n          printWindow.resizeTo(windowWidth, newHeight);\n        };\n\n        // Trigger print dialog\n        printWindow.print();\n\n        // Handle print completion - just close the print window, don't auto-close modals\n        const handlePrintComplete = () => {\n          console.log(\"🖨️ Print/Save completed, closing print window\");\n\n          // Close print window\n          if (!printWindow.closed) {\n            printWindow.close();\n          }\n        };\n\n        // Handle print completion\n        printWindow.onafterprint = handlePrintComplete;\n\n        // Handle browser's save dialog completion (when user saves or cancels)\n        printWindow.addEventListener(\"beforeunload\", handlePrintComplete);\n\n        // Handle manual close of print window\n        const checkClosed = setInterval(() => {\n          if (printWindow.closed) {\n            console.log(\"🖨️ Print window closed manually\");\n            clearInterval(checkClosed);\n          }\n        }, 500);\n\n        // Force close print window after 10 seconds and clear interval after 15 seconds\n        setTimeout(() => {\n          if (!printWindow.closed) {\n            console.log(\"🖨️ Force closing print window after 10s timeout\");\n            printWindow.close();\n          }\n        }, 10000);\n\n        setTimeout(() => {\n          clearInterval(checkClosed);\n        }, 15000);\n      }\n    }\n  };\n\n  const handleEmail = () => {\n    // Mock email functionality\n    alert(\"Email functionality would be implemented here\");\n  };\n\n  const handleConfirmAndSelectPayment = () => {\n    // Pass complete receipt data to parent for payment flow\n    if (onConfirm) {\n      console.log('📄 Receipt Modal: Confirming receipt and proceeding to payment method selection');\n      console.log('🎯 Receipt data being passed:', {\n        receipt,\n        cartItems,\n        total,\n        subtotal: receipt?.subtotal,\n        tax: receipt?.tax,\n        exactTotal: receipt?.exactTotal,\n        exactSubtotal: receipt?.exactSubtotal,\n        exactTax: receipt?.exactTax\n      });\n\n      // Call onConfirm to proceed to payment method selection\n      onConfirm();\n    }\n  };\n\n  // Placeholder for handlePaymentMethodSelect, assuming it's defined elsewhere or in a parent component\n  const handlePaymentMethodSelect = (method: string) => {\n    console.log(\"Selected payment method:\", method);\n    // Logic to handle payment method selection, potentially opening e-invoice modal\n  };\n\n  // If receipt is null but isPreview is true, we still render the modal structure but without receipt data\n  // This case is handled by the check below, which will render a message if receipt is null.\n  // We only return null if !isOpen\n  if (!isOpen) {\n    return null;\n  }\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-md w-full max-h-screen overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle>\n            {isEInvoice\n              ? t(\"pos.eInvoice\")\n              : isPreview\n                ? t(\"pos.receiptPreview\")\n                : t(\"pos.receipt\")}\n          </DialogTitle>\n        </DialogHeader>\n\n        {receipt ? (\n          <div\n            id=\"receipt-content\"\n            className=\"receipt-print bg-white\"\n            style={{ padding: \"16px\" }}\n          >\n            <div className=\"text-center mb-4\">\n              <p className=\"text-xs font-semibold mb-1\">\n                {storeSettings?.storeName || \"Easy Digital Point Of Sale Service\"}\n              </p>\n              <p className=\"text-xs mb-0.5\">{t(\"pos.mainStoreLocation\")}</p>\n              <p className=\"text-xs mb-0.5\">\n                {storeSettings?.address || \"123 Commerce St, City, State 12345\"}\n              </p>\n              <p className=\"text-xs mb-2\">\n                {t(\"pos.phone\")} {storeSettings?.phone || \"(555) 123-4567\"}\n              </p>\n              <div className=\"flex items-center justify-center\">\n                <img src={logoPath} alt=\"EDPOS Logo\" className=\"h-6\" />\n              </div>\n            </div>\n\n            <div className=\"border-t border-b border-gray-300 py-3 mb-3\">\n              <div className=\"flex justify-between text-sm\">\n                <span>{t(\"pos.transactionNumber\")}</span>\n                <span>{receipt.transactionId}</span>\n              </div>\n              <div className=\"flex justify-between text-sm\">\n                <span>{t(\"pos.date\")}</span>\n                <span>{new Date(receipt.createdAt).toLocaleString()}</span>\n              </div>\n              <div className=\"flex justify-between text-sm\">\n                <span>{t(\"pos.cashier\")}</span>\n                <span>{receipt.cashierName}</span>\n              </div>\n              {isEInvoice && customerName && (\n                <div className=\"flex justify-between text-sm\">\n                  <span>Khách hàng:</span>\n                  <span>{customerName}</span>\n                </div>\n              )}\n              {isEInvoice && customerTaxCode && (\n                <div className=\"flex justify-between text-sm\">\n                  <span>Mã số thuế:</span>\n                  <span>{customerTaxCode}</span>\n                </div>\n              )}\n              {receipt.paymentMethod === \"einvoice\" && (\n                <div className=\"flex justify-between text-sm text-blue-600\">\n                  <span>Trạng thái E-Invoice:</span>\n                  <span>\n                    {receipt.invoiceNumber ? \"Đã phát hành\" : \"Chờ phát hành\"}\n                  </span>\n                </div>\n              )}\n            </div>\n\n            <div className=\"space-y-2 mb-3\">\n              {receipt.items.map((item) => {\n                // For receipt display, show the unit price (base price without tax) and total from order details\n                const unitPrice = parseFloat(item.price);\n\n                return (\n                  <div key={item.id}>\n                    <div className=\"flex justify-between text-sm\">\n                      <div className=\"flex-1\">\n                        <div>{item.productName}</div>\n                        <div className=\"text-xs text-gray-600\">\n                          SKU:{\" \"}\n                          {`FOOD${String(item.productId || item.id).padStart(5, \"0\")}`}\n                        </div>\n                        <div className=\"text-xs text-gray-600\">\n                          {item.quantity} x{\" \"}\n                          {Math.floor(parseFloat(item.total) / item.quantity).toLocaleString(\"vi-VN\")} ₫\n                        </div>\n                      </div>\n                      <div>{Math.floor(parseFloat(item.total)).toLocaleString(\"vi-VN\")} ₫</div>\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n\n            <div className=\"border-t border-gray-300 pt-3 space-y-1\">\n              <div className=\"flex justify-between text-sm\">\n                <span>Tạm tính</span>\n                <span>\n                  {Math.floor(parseFloat(receipt.subtotal || \"0\")).toLocaleString(\"vi-VN\")} ₫\n                </span>\n              </div>\n              <div className=\"flex justify-between text-sm\">\n                <span>Thuế:</span>\n                <span>\n                  {Math.floor(parseFloat(receipt.tax || \"0\")).toLocaleString(\"vi-VN\")} ₫\n                </span>\n              </div>\n              <div className=\"flex justify-between font-bold\">\n                <span>{t(\"pos.total\")}</span>\n                <span>\n                  {Math.floor(parseFloat(receipt.total || \"0\")).toLocaleString(\"vi-VN\")} ₫\n                </span>\n              </div>\n              <div className=\"flex justify-between text-sm mt-2\">\n                <span>{t(\"pos.paymentMethod\")}</span>\n                <span className=\"capitalize\">\n                  {(() => {\n                    // Always prioritize originalPaymentMethod for e-invoices\n                    let displayMethod = receipt.paymentMethod;\n\n                    // If this is an e-invoice transaction and we have originalPaymentMethod, use it\n                    if (receipt.originalPaymentMethod) {\n                      displayMethod = receipt.originalPaymentMethod;\n                    }\n\n                    // Map payment methods to display names\n                    const methodNames = {\n                      cash: t(\"common.cash\"),\n                      creditCard: t(\"common.creditCard\"),\n                      debitCard: t(\"common.debitCard\"),\n                      momo: t(\"common.momo\"),\n                      zalopay: t(\"common.zalopay\"),\n                      vnpay: t(\"common.vnpay\"),\n                      qrCode: t(\"common.qrCode\"),\n                      shopeepay: t(\"common.shopeepay\"),\n                      grabpay: t(\"common.grabpay\"),\n                      einvoice: t(\"pos.eInvoice\"),\n                    };\n\n                    return methodNames[displayMethod] || displayMethod;\n                  })()}\n                </span>\n              </div>\n              {receipt.amountReceived && (\n                <div className=\"flex justify-between text-sm\">\n                  <span>{t(\"pos.amountReceived\")}</span>\n                  <span>\n                    {(() => {\n                      // For e-invoice transactions, amount received should equal the total\n                      if (\n                        receipt.paymentMethod === \"einvoice\" ||\n                        receipt.originalPaymentMethod === \"einvoice\"\n                      ) {\n                        // For e-invoice, use the total from receipt\n                        return Math.floor(parseFloat(receipt.total || \"0\")).toLocaleString(\"vi-VN\");\n                      }\n                      // For other payment methods, use the original amount received\n                      return Math.floor(\n                        parseFloat(receipt.amountReceived),\n                      ).toLocaleString(\"vi-VN\");\n                    })()}{\" \"}\n                    ₫\n                  </span>\n                </div>\n              )}\n              {receipt.change && parseFloat(receipt.change) > 0 && (\n                <div className=\"flex justify-between text-sm\">\n                  <span>Change:</span>\n                  <span>{receipt.change} ₫</span>\n                </div>\n              )}\n            </div>\n\n            <div className=\"text-center mt-4 text-xs text-gray-600\">\n              <p>{t(\"pos.thankYouBusiness\")}</p>\n              <p>{t(\"pos.keepReceiptRecords\")}</p>\n            </div>\n          </div>\n        ) : isPreview && cartItems && cartItems.length > 0 && total ? (\n          // Generate preview receipt from cartItems when in preview mode\n          <div\n            id=\"receipt-content\"\n            className=\"receipt-print bg-white\"\n            style={{ padding: \"16px\" }}\n          >\n            <div className=\"text-center mb-4\">\n              <p className=\"text-xs font-semibold mb-1\">\n                {storeSettings?.storeName || \"Easy Digital Point Of Sale Service\"}\n              </p>\n              <p className=\"text-xs mb-0.5\">{t(\"pos.mainStoreLocation\")}</p>\n              <p className=\"text-xs mb-0.5\">\n                {storeSettings?.address || \"123 Commerce St, City, State 12345\"}\n              </p>\n              <p className=\"text-xs mb-2\">\n                {t(\"pos.phone\")} {storeSettings?.phone || \"(555) 123-4567\"}\n              </p>\n              <div className=\"flex items-center justify-center\">\n                <img src={logoPath} alt=\"EDPOS Logo\" className=\"h-6\" />\n              </div>\n            </div>\n\n            <div className=\"border-t border-b border-gray-300 py-3 mb-3\">\n              <div className=\"flex justify-between text-sm\">\n                <span>{t(\"pos.transactionNumber\")}</span>\n                <span>PREVIEW-{Date.now()}</span>\n              </div>\n              <div className=\"flex justify-between text-sm\">\n                <span>{t(\"pos.date\")}</span>\n                <span>{new Date().toLocaleString()}</span>\n              </div>\n              <div className=\"flex justify-between text-sm\">\n                <span>{t(\"pos.cashier\")}</span>\n                <span>Nhân viên</span>\n              </div>\n            </div>\n\n            <div className=\"space-y-2 mb-3\">\n              {cartItems.map((item) => (\n                <div key={item.id}>\n                  <div className=\"flex justify-between text-sm\">\n                    <div className=\"flex-1\">\n                      <div>{item.name}</div>\n                      <div className=\"text-xs text-gray-600\">\n                        SKU: {item.sku || `FOOD${String(item.id).padStart(5, \"0\")}`}\n                      </div>\n                      <div className=\"text-xs text-gray-600\">\n                        {item.quantity} x{\" \"}\n                        {Math.floor(\n                          typeof item.price === \"string\" \n                            ? parseFloat(item.price) \n                            : item.price\n                        ).toLocaleString(\"vi-VN\")} ₫\n                      </div>\n                    </div>\n                    <div>\n                      {Math.floor(\n                        (typeof item.price === \"string\" \n                          ? parseFloat(item.price) \n                          : item.price) * item.quantity\n                      ).toLocaleString(\"vi-VN\")} ₫\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n\n            <div className=\"border-t border-gray-300 pt-3 space-y-1\">\n              {(() => {\n                // Calculate preview values\n                const subtotal = cartItems.reduce((sum, item) => {\n                  const price = typeof item.price === \"string\" ? parseFloat(item.price) : item.price;\n                  return sum + (price * item.quantity);\n                }, 0);\n                \n                const tax = Math.max(0, total - subtotal);\n                \n                return (\n                  <>\n                    <div className=\"flex justify-between text-sm\">\n                      <span>Tạm tính</span>\n                      <span>\n                        {Math.floor(subtotal).toLocaleString(\"vi-VN\")} ₫\n                      </span>\n                    </div>\n                    <div className=\"flex justify-between text-sm\">\n                      <span>Thuế:</span>\n                      <span>\n                        {Math.floor(tax).toLocaleString(\"vi-VN\")} ₫\n                      </span>\n                    </div>\n                    <div className=\"flex justify-between font-bold\">\n                      <span>{t(\"pos.total\")}</span>\n                      <span>\n                        {Math.floor(total).toLocaleString(\"vi-VN\")} ₫\n                      </span>\n                    </div>\n                  </>\n                );\n              })()}\n            </div>\n\n            <div className=\"text-center mt-4 text-xs text-gray-600\">\n              <p>{t(\"pos.thankYouBusiness\")}</p>\n              <p>{t(\"pos.keepReceiptRecords\")}</p>\n            </div>\n          </div>\n        ) : (\n          // This part renders if no data available\n          <div className=\"p-4 text-center\">\n            <p>Không có dữ liệu để hiển thị hóa đơn.</p>\n            <Button onClick={onClose} className=\"mt-4\">\n              Đóng\n            </Button>\n          </div>\n        )}\n\n\n        <div className=\"flex justify-center p-2 border-t\">\n          {isPreview ? (\n            <div className=\"flex space-x-3 w-full\">\n              <Button onClick={onClose} variant=\"outline\" className=\"flex-1\">\n                {t(\"pos.cancel\")}\n              </Button>\n              <Button\n                onClick={handleConfirmAndSelectPayment}\n                className=\"flex-1 bg-green-600 hover:bg-green-700 text-white transition-colors duration-200\"\n              >\n                {t(\"pos.confirmAndSelectPayment\")}\n              </Button>\n            </div>\n          ) : (\n            <div className=\"flex justify-center space-x-3\">\n              <Button\n                onClick={handlePrint}\n                className=\"bg-blue-600 hover:bg-blue-700 text-white transition-colors duration-200\"\n              >\n                <Printer className=\"mr-2\" size={16} />\n                {t(\"pos.printReceipt\")}\n              </Button>\n            </div>\n          )}\n        </div>\n      </DialogContent>\n\n      {/* Payment Method Modal */}\n      {showPaymentMethodModal && (\n        <PaymentMethodModal\n          isOpen={showPaymentMethodModal}\n          onClose={() => setShowPaymentMethodModal(false)}\n          onSelectMethod={handlePaymentMethodSelect}\n          total={\n            typeof receipt?.total === \"string\"\n              ? parseFloat(receipt.total)\n              : receipt?.total || 0\n          }\n          cartItems={cartItems}\n          onShowEInvoice={() => setShowEInvoiceModal(true)}\n        />\n      )}\n\n      {/* E-Invoice Modal */}\n      {showEInvoiceModal && (\n        <EInvoiceModal\n          isOpen={showEInvoiceModal}\n          onClose={() => setShowEInvoiceModal(false)}\n          onConfirm={(eInvoiceData) => {\n            console.log(\"📧 E-Invoice confirmed:\", eInvoiceData);\n            setShowEInvoiceModal(false);\n\n            // Sau khi e-invoice xử lý xong (phát hành ngay hoặc phát hành sau),\n            // hiển thị lại receipt modal để in hóa đơn\n            console.log(\"📄 Showing receipt modal after e-invoice processing\");\n          }}\n          total={\n            typeof receipt?.total === \"string\"\n              ? parseFloat(receipt.total)\n              : receipt?.total || 0\n          }\n          selectedPaymentMethod={receipt?.paymentMethod || \"cash\"}\n          cartItems={(() => {\n            console.log(\"🔄 Receipt Modal - Preparing cartItems for EInvoice:\");\n            console.log(\"- cartItems prop:\", cartItems);\n            console.log(\"- cartItems length:\", cartItems?.length || 0);\n            console.log(\"- receipt items:\", receipt?.items);\n\n            // Always prefer cartItems prop since it has the most accurate data\n            if (cartItems && Array.isArray(cartItems) && cartItems.length > 0) {\n              console.log(\n                \"✅ Using cartItems prop for e-invoice (most accurate data)\",\n              );\n              // Ensure all cartItems have proper structure\n              const processedCartItems = cartItems.map((item) => ({\n                id: item.id,\n                name: item.name,\n                price:\n                  typeof item.price === \"string\"\n                    ? parseFloat(item.price)\n                    : item.price,\n                quantity:\n                  typeof item.quantity === \"string\"\n                    ? parseInt(item.quantity)\n                    : item.quantity,\n                sku: item.sku || `FOOD${String(item.id).padStart(5, \"0\")}`,\n                taxRate: item.taxRate || 0,\n              }));\n              console.log(\n                \"🔧 Processed cartItems for e-invoice:\",\n                processedCartItems,\n              );\n              return processedCartItems;\n            } else if (\n              receipt?.items &&\n              Array.isArray(receipt.items) &&\n              receipt.items.length > 0\n            ) {\n              console.log(\"⚠️ Fallback to receipt items for e-invoice\");\n              return receipt.items.map((item) => ({\n                id: item.productId || item.id,\n                name: item.productName,\n                price:\n                  typeof item.price === \"string\"\n                    ? parseFloat(item.price)\n                    : item.price,\n                quantity:\n                  typeof item.quantity === \"string\"\n                    ? parseInt(item.quantity)\n                    : item.quantity,\n                sku:\n                  item.productId?.toString() ||\n                  `FOOD${String(item.id).padStart(5, \"0\")}`,\n                taxRate: 0,\n              }));\n            } else {\n              console.error(\"❌ No valid cart items found for e-invoice\");\n              return [];\n            }\n          })()}\n        />\n      )}\n    </Dialog>\n  );\n}","size_bytes":26554},"client/src/components/pos/shopping-cart.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport {\n  ShoppingCart as CartIcon,\n  Minus,\n  Plus,\n  Trash2,\n  CreditCard,\n  Banknote,\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport { PaymentMethodModal } from \"./payment-method-modal\";\nimport { ReceiptModal } from \"./receipt-modal\";\nimport { EInvoiceModal } from \"./einvoice-modal\";\nimport type { CartItem } from \"@shared/schema\";\nimport { toast } from \"@/hooks/use-toast\";\n\ninterface ShoppingCartProps {\n  cart: CartItem[];\n  onUpdateQuantity: (id: number, quantity: number) => void;\n  onRemoveItem: (id: number) => void;\n  onClearCart: () => void;\n  onCheckout: (paymentData: any) => void;\n  isProcessing: boolean;\n  orders?: Array<{ id: string; name: string; cart: CartItem[] }>;\n  activeOrderId?: string;\n  onCreateNewOrder?: () => void;\n  onSwitchOrder?: (orderId: string) => void;\n  onRemoveOrder?: (orderId: string) => void;\n}\n\nexport function ShoppingCart({\n  cart,\n  onUpdateQuantity,\n  onRemoveItem,\n  onClearCart,\n  onCheckout,\n  isProcessing,\n  orders = [],\n  activeOrderId,\n  onCreateNewOrder,\n  onSwitchOrder,\n  onRemoveOrder,\n}: ShoppingCartProps) {\n  const [paymentMethod, setPaymentMethod] = useState<string>(\"bankTransfer\");\n  const [amountReceived, setAmountReceived] = useState<string>(\"\");\n  const [showPaymentMethodModal, setShowPaymentMethodModal] = useState(false);\n  const [showReceiptPreview, setShowReceiptPreview] = useState(false);\n  const [selectedCardMethod, setSelectedCardMethod] = useState<string>(\"\");\n  const [previewReceipt, setPreviewReceipt] = useState<any>(null);\n  const { t } = useTranslation();\n\n  // State for Receipt Modal and E-Invoice Modal integration\n  const [selectedReceipt, setSelectedReceipt] = useState<any>(null);\n  const [showReceiptModal, setShowReceiptModal] = useState(false);\n  const [showEInvoiceModal, setShowEInvoiceModal] = useState(false);\n  const [selectedPaymentMethod, setSelectedPaymentMethod] = useState(\"\");\n\n  const subtotal = cart.reduce((sum, item) => sum + parseFloat(item.total), 0);\n  const tax = cart.reduce((sum, item) => {\n      if (item.taxRate && parseFloat(item.taxRate) > 0) {\n        const basePrice = parseFloat(item.price);\n\n        // Debug log to check afterTaxPrice\n        console.log(\"=== SHOPPING CART TAX CALCULATION DEBUG ===\");\n        console.log(\"Product:\", item.name);\n        console.log(\"Base Price:\", basePrice);\n        console.log(\"Tax Rate:\", item.taxRate + \"%\");\n        console.log(\"After Tax Price (from DB):\", item.afterTaxPrice);\n        console.log(\"After Tax Price Type:\", typeof item.afterTaxPrice);\n\n        // Tax = (after_tax_price - price) * quantity\n        if (item.afterTaxPrice && item.afterTaxPrice !== null && item.afterTaxPrice !== \"\") {\n          const afterTaxPrice = parseFloat(item.afterTaxPrice);\n          const totalItemTax = Math.floor((afterTaxPrice - basePrice) * item.quantity);\n          console.log(\"✅ Using tax formula: Math.floor((after_tax_price - price) * quantity)\");\n          console.log(\"  After Tax Price:\", afterTaxPrice, \"₫\");\n          console.log(\"  Base Price:\", basePrice, \"₫\");\n          console.log(\"  Quantity:\", item.quantity);\n          console.log(\"  Tax calculation: Math.floor((\" + afterTaxPrice + \" - \" + basePrice + \") * \" + item.quantity + \") = \" + totalItemTax + \"₫\");\n          return sum + totalItemTax;\n        }\n      }\n      return sum;\n    }, 0);\n  const total = Math.round(subtotal + tax);\n  const change =\n    paymentMethod === \"cash\"\n      ? Math.max(0, parseFloat(amountReceived || \"0\") - total)\n      : 0;\n\n  // Helper functions for receipt generation (used in handlePaymentMethodSelect)\n  const calculateSubtotal = () =>\n    cart.reduce((sum, item) => sum + parseFloat(item.total), 0);\n  const calculateTax = () =>\n      cart.reduce((sum, item) => {\n        if (item.taxRate && parseFloat(item.taxRate) > 0) {\n          const basePrice = parseFloat(item.price);\n\n          // Always use afterTaxPrice - basePrice formula if afterTaxPrice exists\n          if (item.afterTaxPrice && item.afterTaxPrice !== null && item.afterTaxPrice !== \"\") {\n            const afterTaxPrice = parseFloat(item.afterTaxPrice);\n            // Tax = Math.floor((afterTaxPrice - basePrice) * quantity)\n            const taxPerItem = afterTaxPrice - basePrice;\n            return sum + Math.floor(taxPerItem * item.quantity);\n          }\n        }\n        return sum;\n      }, 0);\n  const calculateTotal = () => Math.round(calculateSubtotal() + calculateTax());\n\n  // WebSocket connection for broadcasting cart updates to customer display\n  useEffect(() => {\n    const protocol = window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n    const wsUrl = `${protocol}//${window.location.host}/ws`;\n\n    let ws: WebSocket;\n    let isConnected = false;\n    let reconnectTimer: NodeJS.Timeout;\n\n    const connectWebSocket = () => {\n      try {\n        ws = new WebSocket(wsUrl);\n\n        ws.onopen = () => {\n          console.log(\n            \"Shopping Cart: WebSocket connected for customer display broadcasting\",\n          );\n          isConnected = true;\n        };\n\n        ws.onerror = (error) => {\n          console.error(\"Shopping Cart: WebSocket error:\", error);\n          isConnected = false;\n        };\n\n        ws.onclose = (event) => {\n          console.log(\"Shopping Cart: WebSocket disconnected\");\n          isConnected = false;\n          // Auto-reconnect if not manually closed\n          if (event.code !== 1000) {\n            reconnectTimer = setTimeout(connectWebSocket, 1000);\n          }\n        };\n      } catch (error) {\n        console.error(\"Shopping Cart: Failed to create WebSocket:\", error);\n        reconnectTimer = setTimeout(connectWebSocket, 1000);\n      }\n    };\n\n    connectWebSocket();\n\n    return () => {\n      if (reconnectTimer) {\n        clearTimeout(reconnectTimer);\n      }\n      if (ws && isConnected) {\n        ws.close(1000, \"Component unmounting\");\n      }\n    };\n  }, []);\n\n  // Broadcast cart updates to customer display using existing connection\n  useEffect(() => {\n    const protocol = window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n    const wsUrl = `${protocol}//${window.location.host}/ws`;\n\n    // Use a more efficient approach - create connection only when needed\n    const broadcastCartUpdate = () => {\n      try {\n        const ws = new WebSocket(wsUrl);\n\n        ws.onopen = () => {\n          console.log(\"Broadcasting cart update to customer display:\", cart);\n          const message = JSON.stringify({\n            type: \"cart_update\",\n            cart: cart,\n            subtotal,\n            tax,\n            total,\n            timestamp: new Date().toISOString(),\n          });\n\n          ws.send(message);\n\n          // Close connection immediately after sending\n          setTimeout(() => {\n            if (ws.readyState === WebSocket.OPEN) {\n              ws.close(1000, \"Broadcast complete\");\n            }\n          }, 100);\n        };\n\n        ws.onerror = (error) => {\n          console.error(\"Failed to broadcast cart update:\", error);\n        };\n      } catch (error) {\n        console.error(\"Failed to create broadcast WebSocket:\", error);\n      }\n    };\n\n    // Debounce rapid cart updates to prevent too many WebSocket connections\n    const timeoutId = setTimeout(broadcastCartUpdate, 50);\n\n    return () => {\n      clearTimeout(timeoutId);\n    };\n  }, [cart, subtotal, tax, total]);\n\n  const getPaymentMethods = () => {\n    // Only return cash and bank transfer payment methods\n    const paymentMethods = [\n      {\n        id: 1,\n        name: \"Tiền mặt\",\n        nameKey: \"cash\",\n        type: \"cash\",\n        enabled: true,\n        icon: \"💵\",\n      },\n      {\n        id: 2,\n        name: \"Chuyển khoản\",\n        nameKey: \"bankTransfer\",\n        type: \"transfer\",\n        enabled: true,\n        icon: \"🏦\",\n      },\n    ];\n\n    return paymentMethods;\n  };\n\n  const handleCheckout = () => {\n    if (cart.length === 0) return;\n\n    console.log(\"🛒 Starting checkout process - Step 1: Preview Receipt\");\n    console.log(\"Cart items:\", cart.length);\n\n    // Generate preview receipt data first\n    const previewReceiptData = {\n      transactionId: `TXN-${Date.now()}`,\n      items: cart.map((item) => ({\n        id: item.id,\n        productId: item.id,\n        productName: item.name,\n        price: parseFloat(item.price).toFixed(2),\n        quantity: item.quantity,\n        total: parseFloat(item.total).toFixed(2),\n        sku: `FOOD${String(item.id).padStart(5, \"0\")}`,\n        taxRate: parseFloat(item.taxRate || \"0\"),\n      })),\n      subtotal: subtotal.toFixed(2),\n      tax: tax.toFixed(2),\n      total: total.toFixed(2),\n      paymentMethod: \"preview\", // Special flag for preview mode\n      amountReceived: total.toFixed(2),\n      change: \"0.00\",\n      cashierName: \"System User\",\n      createdAt: new Date().toISOString(),\n    };\n\n    // Step 1: Show receipt preview first\n    setPreviewReceipt(previewReceiptData);\n    setShowReceiptPreview(true);\n  };\n\n  const handleReceiptConfirm = () => {\n    console.log(\"📄 Receipt confirmed - closing modal (cart already cleared)\");\n\n    // Close receipt modal\n    setShowReceiptPreview(false);\n    setPreviewReceipt(null);\n    setShowReceiptModal(false);\n    setSelectedReceipt(null);\n\n    console.log(\"✅ Receipt modal closed\");\n  };\n\n  const handlePaymentMethodSelect = (method: string, data?: any) => {\n    console.log(\n      \"🎯 Shopping cart: Step 3: Payment method selected:\",\n      method,\n      data,\n    );\n\n    // Step 3: Payment method selected, now go directly to Step 4: E-Invoice modal\n    setShowPaymentMethodModal(false);\n    setSelectedPaymentMethod(method);\n\n    // Go directly to E-invoice modal for invoice processing (no duplicate payment selection)\n    console.log(\n      \"📧 Shopping cart: Going directly to E-invoice modal for invoice processing\",\n    );\n    setShowEInvoiceModal(true);\n  };\n\n  const handleCardPaymentMethodSelect = (method: string) => {\n    setSelectedCardMethod(method);\n    const paymentData = {\n      paymentMethod: \"creditCard\", // Explicitly set to creditCard\n      cardType: method,\n      amountReceived: total,\n      change: 0,\n    };\n    onCheckout(paymentData);\n  };\n\n  const handleEInvoiceConfirm = (eInvoiceData: any) => {\n    console.log(\n      \"📧 Shopping cart: Step 4: E-Invoice processing completed:\",\n      eInvoiceData,\n    );\n\n    setShowEInvoiceModal(false);\n\n    // Auto clear cart after E-Invoice completion (both publish now and publish later)\n    console.log(\n      \"🧹 Shopping cart: Auto clearing cart after E-Invoice completion\",\n    );\n    onClearCart();\n\n    // Step 5: Show final receipt modal if receipt data exists\n    if (eInvoiceData.receipt) {\n      console.log(\n        \"📄 Shopping cart: Step 5: Showing final receipt modal (not preview)\",\n      );\n      setSelectedReceipt(eInvoiceData.receipt);\n      setShowReceiptModal(true);\n    } else {\n      console.log(\n        \"✅ Shopping cart: E-invoice completed successfully, cart cleared\",\n      );\n      toast({\n        title: \"Thành công\",\n        description: \"Hóa đơn đã được xử lý thành công\",\n        variant: \"default\",\n      });\n    }\n  };\n\n  const canCheckout = cart.length > 0;\n\n  return (\n    <aside className=\"w-96 bg-white shadow-material border-l pos-border flex flex-col\">\n      <div className=\"p-4 border-b pos-border mt-2\">\n        <div className=\"flex items-center justify-between mb-3\">\n          <h2 className=\"text-xl pos-text-primary font-semibold\">\n            {t(\"pos.purchaseHistory\")}\n          </h2>\n          {onCreateNewOrder && (\n            <Button\n              onClick={onCreateNewOrder}\n              size=\"sm\"\n              variant=\"outline\"\n              className=\"text-xs px-2 py-1\"\n            >\n              + {t(\"pos.newOrder\")}\n            </Button>\n          )}\n        </div>\n\n        {/* Order Tabs */}\n        {orders.length > 0 && (\n          <div className=\"flex flex-wrap gap-1 mb-3 max-h-20 overflow-y-auto\">\n            {orders.map((order) => (\n              <div\n                key={order.id}\n                className={`flex items-center px-2 py-1 rounded text-xs cursor-pointer transition-colors ${\n                  activeOrderId === order.id\n                    ? \"bg-blue-100 text-blue-800 border border-blue-300\"\n                    : \"bg-gray-100 text-gray-600 hover:bg-gray-200\"\n                }`}\n                onClick={() => onSwitchOrder?.(order.id)}\n              >\n                <span className=\"truncate max-w-16\">{order.name}</span>\n                <span className=\"ml-1 text-xs\">({order.cart.length})</span>\n                {orders.length > 1 && (\n                  <button\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      onRemoveOrder?.(order.id);\n                    }}\n                    className=\"ml-1 text-red-500 hover:text-red-700\"\n                  >\n                    ×\n                  </button>\n                )}\n              </div>\n            ))}\n          </div>\n        )}\n\n        <div className=\"flex items-center justify-between text-sm pos-text-secondary\">\n          <span>\n            {cart.length} {t(\"common.items\")}\n          </span>\n          {cart.length > 0 && (\n            <button\n              onClick={onClearCart}\n              className=\"text-red-500 hover:text-red-700 transition-colors\"\n            >\n              {t(\"pos.clearCart\")}\n            </button>\n          )}\n        </div>\n      </div>\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-3\">\n        {cart.length === 0 ? (\n          <div className=\"text-center py-12\">\n            <CartIcon className=\"mx-auto text-gray-400 mb-4\" size={48} />\n            <h3 className=\"text-lg font-medium pos-text-secondary mb-2\">\n              {t(\"pos.emptyCart\")}\n            </h3>\n            <p className=\"pos-text-tertiary\">{t(\"pos.addProductsToStart\")}</p>\n          </div>\n        ) : (\n          cart.map((item) => (\n            <div key={item.id} className=\"bg-gray-50 rounded-lg p-2\">\n              <div className=\"flex items-start justify-between\">\n                <div className=\"flex-1 min-w-0 pr-2\">\n                  <h4 className=\"font-medium pos-text-primary text-sm truncate\">\n                    {item.name}\n                  </h4>\n                  <div className=\"space-y-1\">\n                    <p className=\"text-xs pos-text-secondary\">\n                      {Math.round(parseFloat(item.price)).toLocaleString(\"vi-VN\")} ₫ {t(\"pos.each\")}\n                    </p>\n                    {item.taxRate && parseFloat(item.taxRate) > 0 && (\n                      <p className=\"text-xs text-orange-600\">\n                        Thuế:{\" \"}\n                        {(() => {\n                            const basePrice = parseFloat(item.price);\n\n                            // Always use afterTaxPrice - basePrice formula if afterTaxPrice exists\n                            if (item.afterTaxPrice && item.afterTaxPrice !== null && item.afterTaxPrice !== \"\") {\n                              const afterTaxPrice = parseFloat(item.afterTaxPrice);\n                              // Tax = Math.floor((afterTaxPrice - basePrice) * quantity)\n                              const taxPerItem = afterTaxPrice - basePrice;\n                              return Math.floor(taxPerItem * item.quantity);\n                            }\n                            return 0;\n                          })().toLocaleString(\"vi-VN\")} ₫ ({item.taxRate}%)\n                      </p>\n                    )}\n                  </div>\n                </div>\n                <div className=\"flex flex-col items-end space-y-2\">\n                  <div className=\"flex items-center space-x-1\">\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() =>\n                        onUpdateQuantity(item.id, item.quantity - 1)\n                      }\n                      className=\"w-6 h-6 p-0\"\n                      disabled={item.quantity <= 1}\n                    >\n                      <Minus size={10} />\n                    </Button>\n                    <span className=\"w-6 text-center font-medium text-xs\">\n                      {item.quantity}\n                    </span>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() =>\n                        onUpdateQuantity(item.id, item.quantity + 1)\n                      }\n                      className=\"w-6 h-6 p-0\"\n                      disabled={item.quantity >= item.stock}\n                    >\n                      <Plus size={10} />\n                    </Button>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => onRemoveItem(item.id)}\n                      className=\"w-6 h-6 p-0 text-red-500 hover:text-red-700 border-red-300 hover:border-red-500\"\n                    >\n                      <Trash2 size={10} />\n                    </Button>\n                  </div>\n                  <div className=\"font-bold pos-text-primary text-sm\">\n                    {parseFloat(item.total).toLocaleString(\"vi-VN\", {\n                      minimumFractionDigits: 2,\n                      maximumFractionDigits: 2,\n                    })}{\" \"}\n                    ₫\n                  </div>\n                </div>\n              </div>\n            </div>\n          ))\n        )}\n      </div>\n      {/* Cart Summary */}\n      {cart.length > 0 && (\n        <div className=\"border-t pos-border p-4 space-y-4\">\n          <div className=\"space-y-2\">\n            <div className=\"flex justify-between text-sm\">\n              <span className=\"pos-text-secondary\">\n                {t(\"tables.subtotal\")}:\n              </span>\n              <span className=\"font-medium\">\n                {Math.round(subtotal).toLocaleString(\"vi-VN\")} ₫\n              </span>\n            </div>\n            <div className=\"flex justify-between text-sm\">\n              <span className=\"pos-text-secondary\">{t(\"tables.tax\")}:</span>\n              <span className=\"font-medium\">\n                {Math.round(tax).toLocaleString(\"vi-VN\")} ₫\n              </span>\n            </div>\n            <div className=\"border-t pt-2\">\n              <div className=\"flex justify-between\">\n                <span className=\"text-lg font-bold pos-text-primary\">\n                  {t(\"tables.total\")}:\n                </span>\n                <span className=\"text-lg font-bold text-blue-600\">\n                  {Math.round(total).toLocaleString(\"vi-VN\")} ₫\n                </span>\n              </div>\n            </div>\n          </div>\n\n          {/* Cash Payment */}\n          {paymentMethod === \"cash\" && (\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium pos-text-primary\">\n                {t(\"tables.amountReceived\")}\n              </Label>\n              <Input\n                type=\"number\"\n                step=\"0.01\"\n                placeholder=\"0.00\"\n                value={amountReceived}\n                onChange={(e) => setAmountReceived(e.target.value)}\n              />\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"pos-text-secondary\">\n                  {t(\"tables.change\")}:\n                </span>\n                <span className=\"font-bold text-green-600\">\n                  {change.toLocaleString(\"vi-VN\", {\n                    minimumFractionDigits: 2,\n                    maximumFractionDigits: 2,\n                  })}{\" \"}\n                  ₫\n                </span>\n              </div>\n            </div>\n          )}\n\n          <Button\n            onClick={handleCheckout}\n            disabled={!canCheckout || isProcessing}\n            className=\"w-full btn-success flex items-center justify-center\"\n          >\n            <CartIcon className=\"mr-2\" size={16} />\n            {isProcessing ? \"Processing...\" : t(\"pos.checkout\")}\n          </Button>\n        </div>\n      )}\n\n      {/* Step 1: Receipt Preview Modal - \"Xem trước hóa đơn\" */}\n      <ReceiptModal\n        isOpen={showReceiptPreview}\n        onClose={() => {\n          console.log(\n            \"🔴 Step 1: Closing receipt preview modal (Xem trước hóa đơn)\",\n          );\n          setShowReceiptPreview(false);\n          setPreviewReceipt(null);\n        }}\n        receipt={previewReceipt}\n        onConfirm={() => {\n          console.log(\n            \"📄 Step 1 → Step 2: Receipt preview confirmed, showing payment methods\",\n          );\n          setShowReceiptPreview(false);\n          setShowPaymentMethodModal(true);\n        }}\n        isPreview={true} // This is the preview modal - \"Xem trước hóa đơn\"\n        cartItems={cart.map((item) => ({\n          id: item.id,\n          name: item.name,\n          price: parseFloat(item.price),\n          quantity: item.quantity,\n          sku: `ITEM${String(item.id).padStart(3, \"0\")}`,\n          taxRate: parseFloat(item.taxRate || \"0\"),\n        }))}\n      />\n\n      {/* Step 5: Final Receipt Modal - \"Receipt\" after all processing complete */}\n      <ReceiptModal\n        isOpen={showReceiptModal}\n        onClose={() => {\n          console.log(\n            \"🔴 Step 5: Closing final receipt modal (Receipt) from shopping cart\",\n          );\n          setShowReceiptModal(false);\n          setSelectedReceipt(null);\n        }}\n        receipt={selectedReceipt}\n        onConfirm={handleReceiptConfirm}\n        isPreview={false} // This is the final receipt - \"Receipt\"\n        cartItems={cart.map((item) => ({\n          id: item.id,\n          name: item.name,\n          price: parseFloat(item.price),\n          quantity: item.quantity,\n          sku: `ITEM${String(item.id).padStart(3, \"0\")}`,\n          taxRate: parseFloat(item.taxRate || \"0\"),\n        }))}\n      />\n\n      {/* Step 2: Payment Method Selection Modal */}\n      <PaymentMethodModal\n        isOpen={showPaymentMethodModal}\n        onClose={() => {\n          console.log(\"🔴 Step 2: Closing payment method modal\");\n          setShowPaymentMethodModal(false);\n        }}\n        onSelectMethod={(method, data) => {\n          handlePaymentMethodSelect(method, data);\n        }}\n        total={total}\n        cartItems={cart.map((item) => ({\n          id: item.id,\n          name: item.name,\n          price: parseFloat(item.price),\n          quantity: item.quantity,\n          sku: String(item.id),\n          taxRate: parseFloat(item.taxRate || \"0\"),\n        }))}\n      />\n\n      {/* Step 4: E-Invoice Modal for invoice processing */}\n      {showEInvoiceModal && (\n        <EInvoiceModal\n          isOpen={showEInvoiceModal}\n          onClose={() => {\n            console.log(\"🔴 Step 4: Closing E-invoice modal\");\n            setShowEInvoiceModal(false);\n          }}\n          onConfirm={handleEInvoiceConfirm}\n          total={total}\n          selectedPaymentMethod={selectedPaymentMethod}\n          cartItems={cart.map((item) => ({\n            id: item.id,\n            name: item.name,\n            price: parseFloat(item.price),\n            quantity: item.quantity,\n            sku: item.sku || `FOOD${String(item.id).padStart(5, \"0\")}`,\n            taxRate: parseFloat(item.taxRate || \"0\"),\n          }))}\n        />\n      )}\n    </aside>\n  );\n}","size_bytes":23533},"client/src/components/reports/customer-report.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Users, TrendingUp, Search } from \"lucide-react\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n} from \"@/components/ui/chart\";\nimport {\n  BarChart,\n  Bar,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  ResponsiveContainer,\n} from \"recharts\";\n\nexport function CustomerReport() {\n  const { t } = useTranslation();\n\n  // Filters\n  const [concernType, setConcernType] = useState(\"sales\");\n  const [startDate, setStartDate] = useState<string>(\n    new Date().toISOString().split(\"T\")[0]\n  );\n  const [endDate, setEndDate] = useState<string>(\n    new Date().toISOString().split(\"T\")[0]\n  );\n  const [customerSearch, setCustomerSearch] = useState(\"\");\n  const [productSearch, setProductSearch] = useState(\"\");\n  const [selectedCategory, setSelectedCategory] = useState(\"all\");\n  const [selectedProductType, setSelectedProductType] = useState(\"all\");\n  const [debtFrom, setDebtFrom] = useState(\"\");\n  const [debtTo, setDebtTo] = useState(\"\");\n\n  const { data: orders } = useQuery({\n    queryKey: [\"/api/orders\"],\n  });\n\n  const { data: products } = useQuery({\n    queryKey: [\"/api/products\"],\n  });\n\n  const { data: categories } = useQuery({\n    queryKey: [\"/api/categories\"],\n  });\n\n  const { data: customers } = useQuery({\n    queryKey: [\"/api/customers\"],\n  });\n\n  const { data: customerDebts } = useQuery({\n    queryKey: [\"/api/customer-debts\"],\n    enabled: concernType === \"debt\",\n  });\n\n  const formatCurrency = (amount: number) => {\n    return `${amount.toLocaleString()} ₫`;\n  };\n\n  const formatDate = (dateStr: string) => {\n    return new Date(dateStr).toLocaleDateString(\"vi-VN\", {\n      day: \"2-digit\",\n      month: \"2-digit\",\n      year: \"numeric\",\n    });\n  };\n\n  const getFilteredData = () => {\n    if (!orders || !Array.isArray(orders)) return [];\n\n    const filteredOrders = orders.filter((order: any) => {\n      const orderDate = new Date(order.orderedAt || order.created_at);\n      const start = new Date(startDate);\n      const end = new Date(endDate);\n      end.setHours(23, 59, 59, 999);\n\n      const dateMatch = orderDate >= start && orderDate <= end;\n\n      const customerMatch =\n        !customerSearch ||\n        (order.customerName &&\n          order.customerName\n            .toLowerCase()\n            .includes(customerSearch.toLowerCase())) ||\n        (order.customerPhone && order.customerPhone.includes(customerSearch)) ||\n        (order.customerId &&\n          order.customerId.toString().includes(customerSearch));\n\n      return dateMatch && customerMatch && order.status === \"paid\";\n    });\n\n    return filteredOrders;\n  };\n\n  const getCustomerSalesData = () => {\n    const filteredOrders = getFilteredData();\n    const customerStats: {\n      [customerId: string]: {\n        customer: any;\n        revenue: number;\n        returnValue: number;\n        netRevenue: number;\n        orderCount: number;\n      };\n    } = {};\n\n    filteredOrders.forEach((order: any) => {\n      const customerId = order.customerId || \"guest\";\n      const customerName = order.customerName || \"Khách lẻ\";\n\n      if (!customerStats[customerId]) {\n        customerStats[customerId] = {\n          customer: {\n            id: customerId,\n            name: customerName,\n            phone: order.customerPhone || \"\",\n          },\n          revenue: 0,\n          returnValue: 0,\n          netRevenue: 0,\n          orderCount: 0,\n        };\n      }\n\n      const orderTotal = Number(order.total);\n      customerStats[customerId].revenue += orderTotal;\n      customerStats[customerId].netRevenue += orderTotal; // Assuming no returns for now\n      customerStats[customerId].orderCount += 1;\n    });\n\n    return Object.values(customerStats);\n  };\n\n  const getCustomerProfitData = () => {\n    const filteredOrders = getFilteredData();\n    const customerStats: {\n      [customerId: string]: {\n        customer: any;\n        totalProductValue: number;\n        invoiceDiscount: number;\n        revenue: number;\n        returnValue: number;\n        netRevenue: number;\n        totalCost: number;\n        grossProfit: number;\n      };\n    } = {};\n\n    filteredOrders.forEach((order: any) => {\n      const customerId = order.customerId || \"guest\";\n      const customerName = order.customerName || \"Khách lẻ\";\n\n      if (!customerStats[customerId]) {\n        customerStats[customerId] = {\n          customer: {\n            id: customerId,\n            name: customerName,\n            phone: order.customerPhone || \"\",\n          },\n          totalProductValue: 0,\n          invoiceDiscount: 0,\n          revenue: 0,\n          returnValue: 0,\n          netRevenue: 0,\n          totalCost: 0,\n          grossProfit: 0,\n        };\n      }\n\n      const orderTotal = Number(order.total);\n      customerStats[customerId].totalProductValue += orderTotal;\n      customerStats[customerId].revenue += orderTotal;\n      customerStats[customerId].netRevenue += orderTotal;\n      customerStats[customerId].totalCost += orderTotal * 0.6; // Assuming 60% cost\n      customerStats[customerId].grossProfit += orderTotal * 0.4; // Assuming 40% profit\n    });\n\n    return Object.values(customerStats);\n  };\n\n  const getCustomerDebtData = () => {\n    if (!customerDebts || !Array.isArray(customerDebts)) return [];\n\n    const start = new Date(startDate);\n    const end = new Date(endDate);\n    end.setHours(23, 59, 59, 999);\n\n    return customerDebts\n      .filter((debt: any) => {\n        // Date filter\n        const debtDate = new Date(debt.createdAt || debt.created_at);\n        const dateMatch = debtDate >= start && debtDate <= end;\n\n        // Customer search filter\n        const customerMatch =\n          !customerSearch ||\n          (debt.customer?.id &&\n            debt.customer.id\n              .toLowerCase()\n              .includes(customerSearch.toLowerCase())) ||\n          (debt.customer?.name &&\n            debt.customer.name\n              .toLowerCase()\n              .includes(customerSearch.toLowerCase())) ||\n          (debt.customer?.phone && \n            debt.customer.phone.includes(customerSearch)) ||\n          (debt.customerId &&\n            debt.customerId.toString().includes(customerSearch));\n\n        // Debt amount filter\n        const debtAmountMatch = (() => {\n          if (!debtFrom && !debtTo) return true;\n          const from = debtFrom ? Number(debtFrom) : 0;\n          const to = debtTo ? Number(debtTo) : Infinity;\n          const closingDebt = Number(debt.closingDebt || 0);\n          return closingDebt >= from && closingDebt <= to;\n        })();\n\n        return dateMatch && customerMatch && debtAmountMatch;\n      })\n      .map((debt: any) => ({\n        customer: {\n          id: debt.customer?.id || debt.customerId || debt.customerCode || \"N/A\",\n          name: debt.customer?.name || debt.customerName || \"Khách lẻ\",\n          phone: debt.customer?.phone || debt.customerPhone || \"\",\n        },\n        openingDebt: Number(debt.openingDebt || 0),\n        debitAmount: Number(debt.debitAmount || 0),\n        creditAmount: Number(debt.creditAmount || 0),\n        closingDebt: Number(debt.closingDebt || 0),\n      }));\n  };\n\n  const getCustomerProductSalesData = () => {\n    const filteredOrders = getFilteredData();\n    const customerProductStats: {\n      [key: string]: {\n        customer: any;\n        purchaseQuantity: number;\n        revenue: number;\n        returnQuantity: number;\n        returnValue: number;\n        netRevenue: number;\n      };\n    } = {};\n\n    filteredOrders.forEach((order: any) => {\n      const customerId = order.customerId || \"guest\";\n      const customerName = order.customerName || \"Khách lẻ\";\n      const key = `${customerId}`;\n\n      if (!customerProductStats[key]) {\n        customerProductStats[key] = {\n          customer: {\n            id: customerId,\n            name: customerName,\n            phone: order.customerPhone || \"\",\n          },\n          purchaseQuantity: 0,\n          revenue: 0,\n          returnQuantity: 0,\n          returnValue: 0,\n          netRevenue: 0,\n        };\n      }\n\n      const orderTotal = Number(order.total);\n      customerProductStats[key].purchaseQuantity += order.customerCount || 1;\n      customerProductStats[key].revenue += orderTotal;\n      customerProductStats[key].netRevenue += orderTotal;\n    });\n\n    return Object.values(customerProductStats);\n  };\n\n  const getChartData = () => {\n    switch (concernType) {\n      case \"sales\":\n        return getCustomerSalesData()\n          .slice(0, 10)\n          .map((item) => ({\n            name: item.customer.name,\n            revenue: item.revenue,\n            netRevenue: item.netRevenue,\n          }));\n      case \"profit\":\n        return getCustomerProfitData()\n          .slice(0, 10)\n          .map((item) => ({\n            name: item.customer.name,\n            profit: item.grossProfit,\n            revenue: item.revenue,\n          }));\n      case \"debt\":\n        return getCustomerDebtData()\n          .slice(0, 10)\n          .map((item) => ({\n            name: item.customer.name,\n            debt: item.closingDebt,\n          }));\n      case \"productSales\":\n        return getCustomerProductSalesData()\n          .slice(0, 10)\n          .map((item) => ({\n            name: item.customer.name,\n            quantity: item.purchaseQuantity,\n            revenue: item.revenue,\n          }));\n      default:\n        return [];\n    }\n  };\n\n  const renderSalesReport = () => {\n    const data = getCustomerSalesData();\n\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Users className=\"w-5 h-5\" />\n            {t(\"reports.customerSalesReport\")}\n          </CardTitle>\n          <CardDescription>\n            {t(\"reports.fromDate\")}: {formatDate(startDate)} -{\" \"}\n            {t(\"reports.toDate\")}: {formatDate(endDate)}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>{t(\"reports.customerId\")}</TableHead>\n                <TableHead>{t(\"reports.customerName\")}</TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.customerRevenue\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.customerReturnValue\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.customerNetRevenue\")}\n                </TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {data.length > 0 ? (\n                data.slice(0, 20).map((item, index) => (\n                  <TableRow key={index}>\n                    <TableCell className=\"font-medium\">\n                      {item.customer.id}\n                    </TableCell>\n                    <TableCell>{item.customer.name}</TableCell>\n                    <TableCell className=\"text-right text-green-600\">\n                      {formatCurrency(item.revenue)}\n                    </TableCell>\n                    <TableCell className=\"text-right text-red-600\">\n                      {formatCurrency(item.returnValue)}\n                    </TableCell>\n                    <TableCell className=\"text-right text-blue-600\">\n                      {formatCurrency(item.netRevenue)}\n                    </TableCell>\n                  </TableRow>\n                ))\n              ) : (\n                <TableRow>\n                  <TableCell\n                    colSpan={5}\n                    className=\"text-center text-gray-500 italic\"\n                  >\n                    {t(\"reports.noReportData\")}\n                  </TableCell>\n                </TableRow>\n              )}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    );\n  };\n\n  const renderProfitReport = () => {\n    const data = getCustomerProfitData();\n\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Users className=\"w-5 h-5\" />\n            {t(\"reports.customerProfitReport\")}\n          </CardTitle>\n          <CardDescription>\n            {t(\"reports.fromDate\")}: {formatDate(startDate)} -{\" \"}\n            {t(\"reports.toDate\")}: {formatDate(endDate)}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>{t(\"reports.customerName\")}</TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.totalProductValue\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.invoiceDiscount\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.revenue\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.customerReturnValue\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.customerNetRevenue\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.totalCost\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.grossProfit\")}\n                </TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {data.length > 0 ? (\n                data.slice(0, 20).map((item, index) => (\n                  <TableRow key={index}>\n                    <TableCell>{item.customer.name}</TableCell>\n                    <TableCell className=\"text-right\">\n                      {formatCurrency(item.totalProductValue)}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      {formatCurrency(item.invoiceDiscount)}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      {formatCurrency(item.revenue)}\n                    </TableCell>\n                    <TableCell className=\"text-right text-red-600\">\n                      {formatCurrency(item.returnValue)}\n                    </TableCell>\n                    <TableCell className=\"text-right text-blue-600\">\n                      {formatCurrency(item.netRevenue)}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      {formatCurrency(item.totalCost)}\n                    </TableCell>\n                    <TableCell className=\"text-right text-green-600\">\n                      {formatCurrency(item.grossProfit)}\n                    </TableCell>\n                  </TableRow>\n                ))\n              ) : (\n                <TableRow>\n                  <TableCell\n                    colSpan={8}\n                    className=\"text-center text-gray-500 italic\"\n                  >\n                    {t(\"reports.noReportData\")}\n                  </TableCell>\n                </TableRow>\n              )}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    );\n  };\n\n  const renderDebtReport = () => {\n    const data = getCustomerDebtData();\n\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Users className=\"w-5 h-5\" />\n            {t(\"reports.customerDebtReport\")}\n          </CardTitle>\n          <CardDescription>\n            {t(\"reports.fromDate\")}: {formatDate(startDate)} -{\" \"}\n            {t(\"reports.toDate\")}: {formatDate(endDate)}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>{t(\"reports.customerId\")}</TableHead>\n                <TableHead>{t(\"reports.customerName\")}</TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.openingDebt\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.debitAmount\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.creditAmount\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.closingDebt\")}\n                </TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {data.length > 0 ? (\n                data.map((item, index) => (\n                  <TableRow key={index}>\n                    <TableCell className=\"font-medium\">\n                      {item.customer.id}\n                    </TableCell>\n                    <TableCell>{item.customer.name}</TableCell>\n                    <TableCell className=\"text-right\">\n                      {formatCurrency(item.openingDebt)}\n                    </TableCell>\n                    <TableCell className=\"text-right text-red-600\">\n                      {formatCurrency(item.debitAmount)}\n                    </TableCell>\n                    <TableCell className=\"text-right text-green-600\">\n                      {formatCurrency(item.creditAmount)}\n                    </TableCell>\n                    <TableCell className=\"text-right text-blue-600\">\n                      {formatCurrency(item.closingDebt)}\n                    </TableCell>\n                  </TableRow>\n                ))\n              ) : (\n                <TableRow>\n                  <TableCell\n                    colSpan={6}\n                    className=\"text-center text-gray-500 italic\"\n                  >\n                    {t(\"reports.noReportData\")}\n                  </TableCell>\n                </TableRow>\n              )}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    );\n  };\n\n  const renderProductSalesReport = () => {\n    const data = getCustomerProductSalesData();\n\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Users className=\"w-5 h-5\" />\n            {t(\"reports.customerProductSalesReport\")}\n          </CardTitle>\n          <CardDescription>\n            {t(\"reports.fromDate\")}: {formatDate(startDate)} -{\" \"}\n            {t(\"reports.toDate\")}: {formatDate(endDate)}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>{t(\"reports.customerId\")}</TableHead>\n                <TableHead>{t(\"reports.customerName\")}</TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.customerPurchaseQuantity\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.revenue\")}\n                </TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.customerReturnQuantity\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.customerReturnValue\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.customerNetRevenue\")}\n                </TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {data.length > 0 ? (\n                data.slice(0, 20).map((item, index) => (\n                  <TableRow key={index}>\n                    <TableCell className=\"font-medium\">\n                      {item.customer.id}\n                    </TableCell>\n                    <TableCell>{item.customer.name}</TableCell>\n                    <TableCell className=\"text-center\">\n                      {item.purchaseQuantity}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      {formatCurrency(item.revenue)}\n                    </TableCell>\n                    <TableCell className=\"text-center\">\n                      {item.returnQuantity}\n                    </TableCell>\n                    <TableCell className=\"text-right text-red-600\">\n                      {formatCurrency(item.returnValue)}\n                    </TableCell>\n                    <TableCell className=\"text-right text-green-600\">\n                      {formatCurrency(item.netRevenue)}\n                    </TableCell>\n                  </TableRow>\n                ))\n              ) : (\n                <TableRow>\n                  <TableCell\n                    colSpan={7}\n                    className=\"text-center text-gray-500 italic\"\n                  >\n                    {t(\"reports.noReportData\")}\n                  </TableCell>\n                </TableRow>\n              )}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    );\n  };\n\n  const chartConfig = {\n    revenue: {\n      label: t(\"reports.revenue\"),\n      color: \"#10b981\",\n    },\n    profit: {\n      label: t(\"reports.profit\"),\n      color: \"#3b82f6\",\n    },\n    debt: {\n      label: t(\"reports.customerDebt\"),\n      color: \"#f59e0b\",\n    },\n    quantity: {\n      label: t(\"reports.quantity\"),\n      color: \"#8b5cf6\",\n    },\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Users className=\"w-5 h-5\" />\n            {t('reports.customerReport')}\n          </CardTitle>\n          <CardDescription>\n            {t('reports.customerMetrics')}\n          </CardDescription>\n        </CardHeader>\n      </Card>\n\n      {/* Filters */}\n      <Card>\n        <CardContent className=\"space-y-4 pt-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4\">\n            {/* Concern Type */}\n            <div>\n              <Label>{t(\"reports.customerConcernType\")}</Label>\n              <Select value={concernType} onValueChange={setConcernType}>\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"sales\">\n                    {t(\"reports.customerSales\")}\n                  </SelectItem>\n                  <SelectItem value=\"profit\">\n                    {t(\"reports.customerProfit\")}\n                  </SelectItem>\n                  <SelectItem value=\"debt\">\n                    {t(\"reports.customerDebt\")}\n                  </SelectItem>\n                  <SelectItem value=\"productSales\">\n                    {t(\"reports.customerProductSales\")}\n                  </SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* Product Type - only show for productSales */}\n            {concernType === \"productSales\" && (\n              <div>\n                <Label>{t(\"reports.productType\")}</Label>\n                <Select\n                  value={selectedProductType}\n                  onValueChange={setSelectedProductType}\n                >\n                  <SelectTrigger>\n                    <SelectValue placeholder={t(\"reports.productType\")} />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">{t(\"common.all\")}</SelectItem>\n                    <SelectItem value=\"combo\">{t(\"reports.combo\")}</SelectItem>\n                    <SelectItem value=\"product\">\n                      {t(\"reports.product\")}\n                    </SelectItem>\n                    <SelectItem value=\"service\">\n                      {t(\"reports.service\")}\n                    </SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            )}\n\n            {/* Product Group - only show for productSales */}\n            {concernType === \"productSales\" && (\n              <div>\n                <Label>{t(\"reports.productGroup\")}</Label>\n                <Select\n                  value={selectedCategory}\n                  onValueChange={setSelectedCategory}\n                >\n                  <SelectTrigger>\n                    <SelectValue placeholder={t(\"reports.productGroup\")} />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">{t(\"common.all\")}</SelectItem>\n                    {categories &&\n                      Array.isArray(categories) &&\n                      categories.map((category: any) => (\n                        <SelectItem\n                          key={category.id}\n                          value={category.id.toString()}\n                        >\n                          {category.name}\n                        </SelectItem>\n                      ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            )}\n          </div>\n\n          {/* Date Range */}\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div>\n              <Label>{t(\"reports.startDate\")}</Label>\n              <Input\n                type=\"date\"\n                value={startDate}\n                onChange={(e) => setStartDate(e.target.value)}\n              />\n            </div>\n            <div>\n              <Label>{t(\"reports.endDate\")}</Label>\n              <Input\n                type=\"date\"\n                value={endDate}\n                onChange={(e) => setEndDate(e.target.value)}\n              />\n            </div>\n          </div>\n\n          {/* Debt Range - only show for debt */}\n          {concernType === \"debt\" && (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <Label>{t(\"reports.debtRangeFrom\")}</Label>\n                <Input\n                  type=\"number\"\n                  placeholder=\"0\"\n                  value={debtFrom}\n                  onChange={(e) => setDebtFrom(e.target.value)}\n                />\n              </div>\n              <div>\n                <Label>{t(\"reports.debtRangeTo\")}</Label>\n                <Input\n                  type=\"number\"\n                  placeholder=\"1000000\"\n                  value={debtTo}\n                  onChange={(e) => setDebtTo(e.target.value)}\n                />\n              </div>\n            </div>\n          )}\n\n          {/* Search Fields */}\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div>\n              <Label>{t(\"reports.customerFilter\")}</Label>\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                <Input\n                  placeholder={t(\"reports.customerFilterPlaceholder\")}\n                  value={customerSearch}\n                  onChange={(e) => setCustomerSearch(e.target.value)}\n                  className=\"pl-10\"\n                />\n              </div>\n            </div>\n            {concernType === \"productSales\" && (\n              <div>\n                <Label>{t(\"reports.productFilter\")}</Label>\n                <div className=\"relative\">\n                  <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                  <Input\n                    placeholder={t(\"reports.productFilterPlaceholder\")}\n                    value={productSearch}\n                    onChange={(e) => setProductSearch(e.target.value)}\n                    className=\"pl-10\"\n                  />\n                </div>\n              </div>\n            )}\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Chart Display - Only show for sales and profit */}\n      {(concernType === \"sales\" || concernType === \"profit\") && (\n        <Card className=\"shadow-xl border-0 bg-gradient-to-br from-blue-50/50 to-indigo-50/30\">\n          <CardHeader className=\"bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-t-lg\">\n            <CardTitle className=\"flex items-center gap-3 text-lg font-semibold\">\n              <div className=\"p-2 bg-white/20 rounded-lg\">\n                <TrendingUp className=\"w-6 h-6\" />\n              </div>\n              <div>\n                <div className=\"text-white/90 text-sm font-normal\">\n                  {t(\"reports.chartView\")}\n                </div>\n                <div className=\"text-white font-semibold\">\n                  {concernType === \"sales\"\n                    ? t(\"reports.customerSales\")\n                    : t(\"reports.customerProfit\")}\n                </div>\n              </div>\n            </CardTitle>\n            <CardDescription className=\"text-blue-100 mt-2\">\n              {t(\"reports.visualRepresentation\")} - {t(\"reports.fromDate\")}:{\" \"}\n              {formatDate(startDate)} {t(\"reports.toDate\")}: {formatDate(endDate)}\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"p-8 bg-white/80 backdrop-blur-sm\">\n            <div className=\"h-[450px] w-full bg-white/90 rounded-xl border-0 shadow-lg p-6 relative overflow-hidden\">\n              <div className=\"absolute inset-0 bg-gradient-to-br from-blue-50/30 to-indigo-50/20 rounded-xl\"></div>\n              <div className=\"absolute top-4 right-4 flex items-center gap-2 text-sm text-gray-500\">\n                <div className=\"w-2 h-2 bg-green-500 rounded-full animate-pulse\"></div>\n                Live Data\n              </div>\n\n              <div className=\"relative z-10 h-full\">\n                <ChartContainer config={chartConfig}>\n                  <ResponsiveContainer width=\"100%\" height=\"100%\">\n                    <BarChart\n                      data={getChartData()}\n                      margin={{ top: 30, right: 40, left: 30, bottom: 90 }}\n                      barCategoryGap=\"25%\"\n                    >\n                      <defs>\n                        <linearGradient\n                          id=\"revenueGradient\"\n                          x1=\"0\"\n                          y1=\"0\"\n                          x2=\"0\"\n                          y2=\"1\"\n                        >\n                          <stop\n                            offset=\"0%\"\n                            stopColor=\"#10b981\"\n                            stopOpacity={0.9}\n                          />\n                          <stop\n                            offset=\"100%\"\n                            stopColor=\"#10b981\"\n                            stopOpacity={0.6}\n                          />\n                        </linearGradient>\n                        <linearGradient\n                          id=\"profitGradient\"\n                          x1=\"0\"\n                          y1=\"0\"\n                          x2=\"0\"\n                          y2=\"1\"\n                        >\n                          <stop\n                            offset=\"0%\"\n                            stopColor=\"#3b82f6\"\n                            stopOpacity={0.9}\n                          />\n                          <stop\n                            offset=\"100%\"\n                            stopColor=\"#3b82f6\"\n                            stopOpacity={0.6}\n                          />\n                        </linearGradient>\n                      </defs>\n                      <CartesianGrid\n                        strokeDasharray=\"2 4\"\n                        stroke=\"#e2e8f0\"\n                        opacity={0.4}\n                        horizontal={true}\n                        vertical={false}\n                      />\n                      <XAxis\n                        dataKey=\"name\"\n                        tick={{ fontSize: 12, fill: \"#475569\", fontWeight: 500 }}\n                        angle={-35}\n                        textAnchor=\"end\"\n                        height={85}\n                        interval={0}\n                        tickMargin={12}\n                        axisLine={{ stroke: \"#cbd5e1\", strokeWidth: 1 }}\n                        tickLine={{ stroke: \"#cbd5e1\", strokeWidth: 1 }}\n                      />\n                      <YAxis\n                        tick={{ fontSize: 12, fill: \"#475569\", fontWeight: 500 }}\n                        tickFormatter={(value) => {\n                          if (value >= 1000000) {\n                            return `${(value / 1000000).toFixed(1)}M`;\n                          } else if (value >= 1000) {\n                            return `${(value / 1000).toFixed(0)}K`;\n                          }\n                          return value.toString();\n                        }}\n                        width={70}\n                        axisLine={{ stroke: \"#cbd5e1\", strokeWidth: 1 }}\n                        tickLine={{ stroke: \"#cbd5e1\", strokeWidth: 1 }}\n                      />\n                      <ChartTooltip\n                        content={<ChartTooltipContent />}\n                        labelStyle={{\n                          color: \"#1e293b\",\n                          fontWeight: 600,\n                          fontSize: 13,\n                          marginBottom: 4,\n                        }}\n                        contentStyle={{\n                          backgroundColor: \"rgba(255, 255, 255, 0.98)\",\n                          border: \"1px solid #e2e8f0\",\n                          borderRadius: \"12px\",\n                          boxShadow:\n                            \"0 10px 25px -5px rgb(0 0 0 / 0.15), 0 4px 6px -2px rgb(0 0 0 / 0.05)\",\n                          padding: \"12px 16px\",\n                          backdropFilter: \"blur(8px)\",\n                        }}\n                        cursor={{ fill: \"rgba(59, 130, 246, 0.05)\" }}\n                      />\n                      {concernType === \"sales\" && (\n                        <>\n                          <Bar\n                            dataKey=\"revenue\"\n                            fill=\"url(#revenueGradient)\"\n                            radius={[6, 6, 0, 0]}\n                            maxBarSize={45}\n                            stroke=\"#059669\"\n                            strokeWidth={1}\n                          />\n                          <Bar\n                            dataKey=\"netRevenue\"\n                            fill=\"url(#profitGradient)\"\n                            radius={[6, 6, 0, 0]}\n                            maxBarSize={45}\n                            stroke=\"#2563eb\"\n                            strokeWidth={1}\n                          />\n                        </>\n                      )}\n                      {concernType === \"profit\" && (\n                        <>\n                          <Bar\n                            dataKey=\"profit\"\n                            fill=\"url(#profitGradient)\"\n                            radius={[6, 6, 0, 0]}\n                            maxBarSize={45}\n                            stroke=\"#2563eb\"\n                            strokeWidth={1}\n                          />\n                          <Bar\n                            dataKey=\"revenue\"\n                            fill=\"url(#revenueGradient)\"\n                            radius={[6, 6, 0, 0]}\n                            maxBarSize={45}\n                            stroke=\"#059669\"\n                            strokeWidth={1}\n                          />\n                        </>\n                      )}\n                    </BarChart>\n                  </ResponsiveContainer>\n                </ChartContainer>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Data Tables */}\n      <div className=\"space-y-6\">\n        {concernType === \"sales\" && renderSalesReport()}\n        {concernType === \"profit\" && renderProfitReport()}\n        {concernType === \"debt\" && renderDebtReport()}\n        {concernType === \"productSales\" && renderProductSalesReport()}\n      </div>\n    </div>\n  );\n}","size_bytes":36326},"client/src/components/reports/dashboard-overview.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  TrendingUp,\n  DollarSign,\n  ShoppingCart,\n  Users,\n  Clock,\n  Target,\n  Search,\n  RefreshCw\n} from \"lucide-react\";\nimport type { Order, Table as TableType } from \"@shared/schema\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nexport function formatDateToYYYYMMDD(date: Date | string | number): string {\n  const d = new Date(date); // Ensure input is a Date\n  const year = d.getFullYear();\n  const month = String(d.getMonth() + 1).padStart(2, \"0\");\n  const day = String(d.getDate()).padStart(2, \"0\");\n  return `${year}-${month}-${day}`;\n}\n\ninterface Invoice {\n  id: number;\n  invoiceNumber: string;\n  tradeNumber: string;\n  templateNumber: string;\n  symbol: string;\n  customerName: string;\n  customerTaxCode: string;\n  customerAddress: string;\n  customerPhone: string;\n  customerEmail: string;\n  subtotal: string;\n  tax: string;\n  total: string;\n  paymentMethod: number;\n  invoiceDate: string;\n  status: string;\n  einvoiceStatus: number;\n  invoiceStatus: number;\n  notes: string;\n  createdAt: string;\n}\n\nexport function DashboardOverview() {\n  const { t, currentLanguage } = useTranslation();\n\n  const [startDate, setStartDate] = useState<string>(\n    new Date().toISOString().split(\"T\")[0]\n  );\n  const [endDate, setEndDate] = useState<string>(\n    new Date().toISOString().split(\"T\")[0]\n  );\n  const queryClient = useQueryClient();\n\n  const { data: transactions } = useQuery({\n    queryKey: [\"/api/transactions\"],\n  });\n\n  // Query invoices - same as sales-orders page\n  const { data: invoices = [], isLoading: invoicesLoading, error: invoicesError } = useQuery({\n    queryKey: [\"/api/invoices\"],\n    queryFn: async () => {\n      try {\n        const response = await fetch(\"/api/invoices\");\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        const data = await response.json();\n        console.log(\"Dashboard - Invoices loaded:\", data?.length || 0);\n        return Array.isArray(data) ? data : [];\n      } catch (error) {\n        console.error('Dashboard - Error fetching invoices:', error);\n        return [];\n      }\n    },\n    retry: 3,\n    retryDelay: 1000,\n    staleTime: 5 * 60 * 1000,\n  });\n\n  // Query orders - same as sales-orders page\n  const { data: orders = [], isLoading: ordersLoading, error: ordersError } = useQuery({\n    queryKey: [\"/api/orders\"],\n    queryFn: async () => {\n      try {\n        const response = await fetch(\"/api/orders\");\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        const data = await response.json();\n        console.log(\"Dashboard - Orders loaded:\", data?.length || 0);\n        return Array.isArray(data) ? data : [];\n      } catch (error) {\n        console.error('Dashboard - Error fetching orders:', error);\n        return [];\n      }\n    },\n    retry: 3,\n    retryDelay: 1000,\n    staleTime: 5 * 60 * 1000,\n  });\n\n  const { data: tables } = useQuery({\n    queryKey: [\"/api/tables\"],\n  });\n\n  const handleRefresh = () => {\n    // Refresh the queries to get the latest data for the selected date\n    setStartDate(formatDateToYYYYMMDD(new Date()));\n    setEndDate(formatDateToYYYYMMDD(new Date()));\n    queryClient.invalidateQueries({ queryKey: [\"/api/transactions\"] });\n    queryClient.invalidateQueries({ queryKey: [\"/api/tables\"] });\n    queryClient.invalidateQueries({ queryKey: [\"/api/orders\"] });\n    queryClient.invalidateQueries({ queryKey: [\"/api/invoices\"] });\n  };\n\n  const getDashboardStats = () => {\n    try {\n      // Add proper loading and error checks\n      if (invoicesLoading || ordersLoading) {\n        return {\n          periodRevenue: 0,\n          periodOrderCount: 0,\n          periodCustomerCount: 0,\n          dailyAverageRevenue: 0,\n          activeOrders: 0,\n          occupiedTables: 0,\n          monthRevenue: 0,\n          averageOrderValue: 0,\n          peakHour: 12,\n          totalTables: Array.isArray(tables) ? tables.length : 0,\n        };\n      }\n\n      if (\n        !tables ||\n        !Array.isArray(tables)\n      )\n        return {\n          periodRevenue: 0,\n          periodOrderCount: 0,\n          periodCustomerCount: 0,\n          dailyAverageRevenue: 0,\n          activeOrders: 0,\n          occupiedTables: 0,\n          monthRevenue: 0,\n          averageOrderValue: 0,\n          peakHour: 12,\n          totalTables: 0,\n        };\n\n      const start = new Date(startDate);\n      const end = new Date(endDate);\n      end.setHours(23, 59, 59, 999); // Include the entire end date\n\n      // Combine invoices and orders data - same logic as sales-orders page\n      const combinedData = [\n        ...(Array.isArray(invoices) ? invoices.map((invoice: Invoice) => ({\n          ...invoice,\n          type: 'invoice' as const,\n          date: invoice.invoiceDate,\n          displayNumber: invoice.tradeNumber || invoice.invoiceNumber || `INV-${String(invoice.id).padStart(13, '0')}`,\n          displayStatus: invoice.invoiceStatus || 1,\n          customerName: invoice.customerName || 'Khách hàng lẻ',\n          customerPhone: invoice.customerPhone || '',\n          customerAddress: invoice.customerAddress || '',\n          customerTaxCode: invoice.customerTaxCode || '',\n          symbol: invoice.symbol || 'C11DTD',\n          einvoiceStatus: invoice.einvoiceStatus || 0\n        })) : []),\n        ...(Array.isArray(orders) ? orders.map((order: Order) => ({\n          ...order,\n          type: 'order' as const,\n          date: order.orderedAt,\n          displayNumber: order.orderNumber || `ORD-${String(order.id).padStart(13, '0')}`,\n          displayStatus: order.status === 'paid' ? 1 : order.status === 'pending' ? 2 : order.status === 'cancelled' ? 3 : 2,\n          customerName: order.customerName || 'Khách hàng lẻ',\n          invoiceStatus: order.status === 'paid' ? 1 : order.status === 'pending' ? 2 : order.status === 'cancelled' ? 3 : 2,\n          customerPhone: '',\n          customerAddress: '',\n          customerTaxCode: '',\n          symbol: 'C11DTD',\n          invoiceNumber: order.orderNumber || `ORD-${String(order.id).padStart(8, '0')}`,\n          tradeNumber: order.orderNumber || '',\n          invoiceDate: order.orderedAt,\n          einvoiceStatus: order.einvoiceStatus || 0\n        })) : [])\n      ];\n\n      // Filter completed items within date range - enhanced logic to show more data\n      const filteredCompletedItems = Array.isArray(combinedData) ? combinedData.filter((item: any) => {\n        try {\n          if (!item || !item.date) return false;\n\n          const itemDate = new Date(item.date);\n          if (isNaN(itemDate.getTime())) return false;\n\n          const dateMatch = itemDate >= start && itemDate <= end;\n\n          // Include more order statuses and invoice statuses to show real data\n          const isCompleted = (item.type === 'invoice' && (item.invoiceStatus === 1 || item.status === 'paid' || item.status === 'completed')) ||\n                            (item.type === 'order' && (item.status === 'paid' || item.status === 'completed' || item.status === 'confirmed' || item.status === 'served'));\n\n          return dateMatch && isCompleted;\n        } catch (error) {\n          console.error('Error filtering item:', item, error);\n          return false;\n        }\n      }) : [];\n\n      // If no completed items found, include pending/draft items for display\n      let itemsToAnalyze = filteredCompletedItems;\n      if (filteredCompletedItems.length === 0) {\n        itemsToAnalyze = Array.isArray(combinedData) ? combinedData.filter((item: any) => {\n          try {\n            if (!item || !item.date) return false;\n            const itemDate = new Date(item.date);\n            if (isNaN(itemDate.getTime())) return false;\n            return itemDate >= start && itemDate <= end;\n          } catch (error) {\n            return false;\n          }\n        }) : [];\n      }\n\n      console.log(\"Dashboard Debug (Combined Data):\", {\n        totalInvoices: invoices.length,\n        totalOrders: orders.length,\n        combinedDataLength: combinedData.length,\n        startDate,\n        endDate,\n        filteredCompletedItems: filteredCompletedItems.length,\n        itemsToAnalyze: itemsToAnalyze.length,\n        periodRevenue,\n        monthRevenue,\n        sampleItems: itemsToAnalyze.slice(0, 3).map((item: any) => ({\n          id: item.id,\n          type: item.type,\n          total: item.total,\n          subtotal: item.subtotal,\n          tax: item.tax,\n          discount: item.discount,\n          calculatedRevenue: (Number(item.subtotal || 0) - Number(item.discount || 0))\n        })),\n      });\n\n      // Period revenue: Use exact same calculation as Order Details\n      // Revenue = Subtotal (base price without tax)\n      const periodRevenue = itemsToAnalyze.reduce(\n        (total: number, item: any) => {\n          // Use subtotal (pre-tax amount) as revenue, same as Order Details display\n          const itemSubtotal = Number(item.subtotal || 0);\n          const itemDiscount = Number(item.discount || 0);\n          // Revenue = Subtotal - Discount (excluding tax from revenue calculation)\n          const itemRevenue = itemSubtotal - itemDiscount;\n          return total + itemRevenue;\n        },\n        0,\n      );\n\n      // Order count: count of items in the filtered period\n      const periodOrderCount = itemsToAnalyze.length;\n\n      // Customer count: count unique customers from items\n      const uniqueCustomers = new Set();\n      itemsToAnalyze.forEach((item: any) => {\n        if (item.customerId) {\n          uniqueCustomers.add(item.customerId);\n        } else if (item.customerName && item.customerName !== 'Khách hàng lẻ') {\n          uniqueCustomers.add(item.customerName);\n        } else {\n          // If no customer info, count as unique customer per item\n          uniqueCustomers.add(`${item.type}_${item.id}`);\n        }\n      });\n      const periodCustomerCount = uniqueCustomers.size;\n\n      // Daily average for the period\n      const daysDiff = Math.max(\n        1,\n        Math.ceil((end.getTime() - start.getTime()) / (1000 * 60 * 60 * 24)) + 1,\n      );\n      const dailyAverageRevenue = periodRevenue / daysDiff;\n\n      // Active orders (pending/in-progress orders only)\n      const activeOrders = Array.isArray(orders) ? orders.filter((order: any) => \n        order.status === 'pending' || order.status === 'in_progress' || order.status === 'confirmed' || order.status === 'preparing' || order.status === 'ready' || order.status === 'served'\n      ).length : 0;\n\n      const occupiedTables = Array.isArray(tables) ? tables.filter(\n        (table: TableType) => table.status === \"occupied\",\n      ) : [];\n\n      // Month revenue: Use subtotal-based calculation for consistency with Order Details\n      const monthRevenue = itemsToAnalyze.reduce(\n        (total: number, item: any) => {\n          const itemSubtotal = Number(item.subtotal || 0);\n          const itemDiscount = Number(item.discount || 0);\n          return total + (itemSubtotal - itemDiscount);\n        },\n        0,\n      );\n\n      // Average order value\n      const averageOrderValue =\n        periodOrderCount > 0 ? periodRevenue / periodOrderCount : 0;\n\n      // Peak hours analysis from items in period\n      const hourlyItems: { [key: number]: number } = {};\n      itemsToAnalyze.forEach((item: any) => {\n        const itemDate = new Date(item.date);\n        if (!isNaN(itemDate.getTime())) {\n          const hour = itemDate.getHours();\n          hourlyItems[hour] = (hourlyItems[hour] || 0) + 1;\n        }\n      });\n\n      const peakHour = Object.keys(hourlyItems).reduce(\n        (peak, hour) =>\n          hourlyItems[parseInt(hour)] > hourlyItems[parseInt(peak)]\n            ? hour\n            : peak,\n        \"12\",\n      );\n\n      return {\n        periodRevenue,\n        periodOrderCount,\n        periodCustomerCount,\n        dailyAverageRevenue,\n        activeOrders: activeOrders,\n        occupiedTables: occupiedTables.length,\n        monthRevenue,\n        averageOrderValue,\n        peakHour: parseInt(peakHour),\n        totalTables: Array.isArray(tables) ? tables.length : 0,\n      };\n    } catch (error) {\n      console.error(\"Error in getDashboardStats:\", error);\n      return {\n        periodRevenue: 0,\n        periodOrderCount: 0,\n        periodCustomerCount: 0,\n        dailyAverageRevenue: 0,\n        activeOrders: 0,\n        occupiedTables: 0,\n        monthRevenue: 0,\n        averageOrderValue: 0,\n        peakHour: 12,\n        totalTables: 0,\n      };\n    }\n  };\n\n  const stats = getDashboardStats();\n\n  const formatCurrency = (amount: number) => {\n    try {\n      return `${(amount || 0).toLocaleString()} ₫`;\n    } catch (error) {\n      console.error(\"Error formatting currency:\", error);\n      return \"0 ₫\";\n    }\n  };\n\n  const formatDate = (dateStr: string) => {\n    try {\n      // Map translation language codes to locale codes\n      const localeMap = {\n        ko: \"ko-KR\",\n        en: \"en-US\", \n        vi: \"vi-VN\"\n      };\n\n      const locale = localeMap[currentLanguage] || \"ko-KR\";\n\n      return new Date(dateStr).toLocaleDateString(locale, {\n        year: \"numeric\",\n        month: \"long\",\n        day: \"numeric\",\n      });\n    } catch (error) {\n      console.error(\"Error formatting date:\", error);\n      return dateStr || \"\";\n    }\n  };\n\n  // Show loading state\n  if (invoicesLoading || ordersLoading) {\n    return (\n      <div className=\"flex justify-center py-8\">\n        <div className=\"text-gray-500\">{t(\"reports.loading\")}</div>\n      </div>\n    );\n  }\n\n  // Show error state\n  if (invoicesError || ordersError) {\n    return (\n      <div className=\"flex justify-center py-8\">\n        <div className=\"text-red-500\">\n          Lỗi tải dữ liệu báo cáo: {invoicesError?.message || ordersError?.message || \"Unknown error\"}\n          <Button \n            onClick={handleRefresh} \n            variant=\"outline\" \n            size=\"sm\" \n            className=\"ml-4\"\n          >\n            Thử lại\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  if (!stats) {\n    return (\n      <div className=\"flex justify-center py-8\">\n        <div className=\"text-gray-500\">{t(\"reports.loading\")}</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Date Selector */}\n      <Card>\n        <CardHeader>\n          <div className=\"flex justify-between items-center\">\n            <div>\n              <CardTitle className=\"text-lg font-semibold text-gray-900\">\n                {t('reports.dashboardTab')}\n              </CardTitle>\n              <CardDescription>\n                {t(\"reports.dashboardDescription\")} (Dữ liệu từ hóa đơn và đơn hàng)\n              </CardDescription>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Label htmlFor=\"start-date-picker\">\n                {t(\"reports.startDate\")}:\n              </Label>\n              <Input\n                id=\"start-date-picker\"\n                type=\"date\"\n                value={startDate}\n                onChange={(e) => setStartDate(e.target.value)}\n                className=\"w-auto\"\n              />\n              <Label htmlFor=\"end-date-picker\">{t(\"reports.endDate\")}:</Label>\n              <Input\n                id=\"end-date-picker\"\n                type=\"date\"\n                value={endDate}\n                onChange={(e) => setEndDate(e.target.value)}\n                className=\"w-auto\"\n              />\n              <Button\n                onClick={handleRefresh}\n                size=\"sm\"\n                variant=\"outline\"\n                className=\"ml-2\"\n              >\n                <Search className=\"w-4 h-4 mr-1\" />\n                {t(\"reports.refresh\")}\n              </Button>\n            </div>\n          </div>\n        </CardHeader>\n      </Card>\n\n      {/* Key Metrics */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-gray-600\">\n                  {t(\"reports.totalRevenue\")}\n                </p>\n                <p className=\"text-2xl font-bold text-green-600\">\n                  {formatCurrency(stats.periodRevenue)}\n                </p>\n                <p className=\"text-xs text-gray-500 mt-1\">\n                  {startDate} ~ {endDate}\n                </p>\n              </div>\n              <DollarSign className=\"w-8 h-8 text-green-500\" />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-gray-600\">\n                  Tổng thu từ bán hàng\n                </p>\n                <p className=\"text-2xl font-bold text-blue-600\">\n                  {formatCurrency(stats.monthRevenue)}\n                </p>\n                <p className=\"text-xs text-gray-500 mt-1\">\n                  {startDate === endDate \n                    ? formatDate(startDate)\n                    : `${formatDate(startDate)} - ${formatDate(endDate)}`\n                  }\n                </p>\n              </div>\n              <TrendingUp className=\"w-8 h-8 text-blue-500\" />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-gray-600\">\n                  Tổng đơn hàng\n                </p>\n                <p className=\"text-2xl font-bold\">{stats.periodOrderCount}</p>\n                <p className=\"text-xs text-gray-500 mt-1\">\n                  {t(\"reports.averageOrderValue\")}{\" \"}\n                  {formatCurrency(stats.averageOrderValue)}\n                </p>\n              </div>\n              <ShoppingCart className=\"w-8 h-8 text-blue-500\" />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-gray-600\">\n                  Tổng khách hàng\n                </p>\n                <p className=\"text-2xl font-bold\">\n                  {stats.periodCustomerCount}\n                </p>\n                <p className=\"text-xs text-gray-500 mt-1\">\n                  {t(\"reports.peakHour\")} {stats.peakHour}{\" \"}\n                  <span>{t(\"reports.hour\")}</span>\n                </p>\n              </div>\n              <Users className=\"w-8 h-8 text-purple-500\" />\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Current Status */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Clock className=\"w-5 h-5\" />\n              {t(\"reports.realTimeStatus\")}\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-gray-600\">\n                {t(\"reports.occupiedTables\")}\n              </span>\n              <Badge\n                variant={stats.occupiedTables > 0 ? \"destructive\" : \"outline\"}\n              >\n                {stats.occupiedTables} / {stats.totalTables}\n              </Badge>\n            </div>\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-gray-600\">\n                {t(\"reports.tableUtilization\")}\n              </span>\n              <Badge variant=\"secondary\">\n                {stats.totalTables > 0 ? Math.round((stats.occupiedTables / stats.totalTables) * 100) : 0} %\n              </Badge>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Target className=\"w-5 h-5\" />\n              {t(\"reports.performanceMetrics\")}\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <div className=\"flex justify-between text-sm\">\n                <span>{t(\"reports.salesAchievementRate\")}</span>\n                <span className=\"font-medium\">\n                  {Math.round((stats.dailyAverageRevenue / 500000) * 100)}%\n                </span>\n              </div>\n              <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                <div\n                  className=\"bg-green-500 h-2 rounded-full transition-all\"\n                  style={{\n                    width: `${Math.min((stats.dailyAverageRevenue / 500000) * 100, 100)}%`,\n                  }}\n                ></div>\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <div className=\"flex justify-between text-sm\">\n                <span>{t(\"reports.tableTurnoverRate\")}</span>\n                <span className=\"font-medium\">\n                  {stats.totalTables > 0\n                    ? (stats.periodOrderCount / stats.totalTables).toFixed(1)\n                    : 0}{\" \"}\n                  {t(\"reports.times\")}\n                </span>\n              </div>\n              <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                <div\n                  className=\"bg-blue-500 h-2 rounded-full transition-all\"\n                  style={{\n                    width: `${Math.min((stats.periodOrderCount / stats.totalTables / 5) * 100, 100)}%`,\n                  }}\n                ></div>\n              </div>\n            </div>\n\n            <div className=\"pt-2 border-t\">\n              <div className=\"text-xs text-gray-500\">\n                {t(\"reports.targetAverageDailySales\")\n                  .replace(\"{amount}\", formatCurrency(500000))\n                  .replace(\"{turnovers}\", \"5\")}\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":22594},"client/src/components/reports/employee-report.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Button } from \"@/components/ui/button\";\nimport { Users, TrendingUp, Search } from \"lucide-react\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n} from \"@/components/ui/chart\";\nimport {\n  BarChart,\n  Bar,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  ResponsiveContainer,\n} from \"recharts\";\n\nexport function EmployeeReport() {\n  const { t } = useTranslation();\n\n  // Filters\n  const [concernType, setConcernType] = useState(\"sales\");\n  const [startDate, setStartDate] = useState<string>(\n    new Date().toISOString().split(\"T\")[0]\n  );\n  const [endDate, setEndDate] = useState<string>(\n    new Date().toISOString().split(\"T\")[0]\n  );\n  const [selectedEmployee, setSelectedEmployee] = useState(\"all\");\n  const [productSearch, setProductSearch] = useState(\"\");\n  const [productType, setProductType] = useState(\"all\");\n  const [selectedCategory, setSelectedCategory] = useState(\"all\");\n  const [salesChannel, setSalesChannel] = useState(\"all\");\n\n  const { data: employees } = useQuery({\n    queryKey: [\"/api/employees\"],\n    staleTime: 5 * 60 * 1000, // 5 minutes\n  });\n\n  const { data: transactions } = useQuery({\n    queryKey: [\"/api/transactions\", startDate, endDate],\n    staleTime: 1 * 60 * 1000, // 1 minute\n  });\n\n  const { data: products } = useQuery({\n    queryKey: [\"/api/products\"],\n    staleTime: 5 * 60 * 1000, // 5 minutes\n  });\n\n  const { data: categories } = useQuery({\n    queryKey: [\"/api/categories\"],\n    staleTime: 5 * 60 * 1000, // 5 minutes\n  });\n\n  // Employee sales data query\n  const { data: employeeSalesData } = useQuery({\n    queryKey: [\"/api/employee-sales\", startDate, endDate, selectedEmployee],\n    staleTime: 1 * 60 * 1000, // 1 minute\n  });\n\n  const formatCurrency = (amount: number) => {\n    return `${amount.toLocaleString()} ₫`;\n  };\n\n  const formatDate = (dateStr: string) => {\n    return new Date(dateStr).toLocaleDateString(\"vi-VN\", {\n      day: \"2-digit\",\n      month: \"2-digit\",\n      year: \"numeric\",\n    });\n  };\n\n  const getFilteredTransactions = () => {\n    if (!transactions || !Array.isArray(transactions)) return [];\n\n    const start = new Date(startDate);\n    const end = new Date(endDate);\n    end.setHours(23, 59, 59, 999);\n\n    return transactions.filter((transaction: any) => {\n      const transactionDate = new Date(\n        transaction.createdAt || transaction.created_at,\n      );\n      const dateMatch = transactionDate >= start && transactionDate <= end;\n\n      const employeeMatch =\n        selectedEmployee === \"all\" ||\n        transaction.cashierName === selectedEmployee ||\n        transaction.employeeId?.toString() === selectedEmployee ||\n        transaction.cashierName?.includes(selectedEmployee);\n\n      return dateMatch && employeeMatch;\n    });\n  };\n\n  // Sales Report Data\n  const getSalesReportData = () => {\n    const filteredTransactions = getFilteredTransactions();\n    const employeeSales: {\n      [employeeName: string]: {\n        revenue: number;\n        returnValue: number;\n        netRevenue: number;\n      };\n    } = {};\n\n    filteredTransactions.forEach((transaction: any) => {\n      const employeeName = transaction.cashierName || \"Unknown\";\n\n      if (!employeeSales[employeeName]) {\n        employeeSales[employeeName] = {\n          revenue: 0,\n          returnValue: 0,\n          netRevenue: 0,\n        };\n      }\n\n      const amount = Number(transaction.total);\n      employeeSales[employeeName].revenue += amount;\n      employeeSales[employeeName].netRevenue += amount;\n    });\n\n    return Object.entries(employeeSales).map(([employee, data]) => ({\n      employee,\n      ...data,\n    }));\n  };\n\n  // Profit Report Data\n  const getProfitReportData = () => {\n    const filteredTransactions = getFilteredTransactions();\n    const employeeProfit: {\n      [employeeName: string]: {\n        totalAmount: number;\n        discount: number;\n        revenue: number;\n        returnValue: number;\n        netRevenue: number;\n        totalCost: number;\n        grossProfit: number;\n      };\n    } = {};\n\n    filteredTransactions.forEach((transaction: any) => {\n      const employeeName = transaction.cashierName || \"Unknown\";\n\n      if (!employeeProfit[employeeName]) {\n        employeeProfit[employeeName] = {\n          totalAmount: 0,\n          discount: 0,\n          revenue: 0,\n          returnValue: 0,\n          netRevenue: 0,\n          totalCost: 0,\n          grossProfit: 0,\n        };\n      }\n\n      const amount = Number(transaction.total);\n      const estimatedCost = amount * 0.6; // Estimated 60% cost ratio\n\n      employeeProfit[employeeName].totalAmount += amount;\n      employeeProfit[employeeName].revenue += amount;\n      employeeProfit[employeeName].netRevenue += amount;\n      employeeProfit[employeeName].totalCost += estimatedCost;\n      employeeProfit[employeeName].grossProfit += amount - estimatedCost;\n    });\n\n    return Object.entries(employeeProfit).map(([employee, data]) => ({\n      employee,\n      ...data,\n    }));\n  };\n\n  // Product Sales by Employee Data\n  const getProductSalesData = () => {\n    const filteredTransactions = getFilteredTransactions();\n    const employeeProductSales: {\n      [employeeName: string]: {\n        quantitySold: number;\n        revenue: number;\n        returnQuantity: number;\n        returnValue: number;\n        netRevenue: number;\n      };\n    } = {};\n\n    filteredTransactions.forEach((transaction: any) => {\n      const employeeName = transaction.cashierName || \"Unknown\";\n\n      if (!employeeProductSales[employeeName]) {\n        employeeProductSales[employeeName] = {\n          quantitySold: 0,\n          revenue: 0,\n          returnQuantity: 0,\n          returnValue: 0,\n          netRevenue: 0,\n        };\n      }\n\n      const amount = Number(transaction.total);\n      employeeProductSales[employeeName].quantitySold += 1; // Estimate 1 item per transaction\n      employeeProductSales[employeeName].revenue += amount;\n      employeeProductSales[employeeName].netRevenue += amount;\n    });\n\n    return Object.entries(employeeProductSales).map(([employee, data]) => ({\n      employee,\n      ...data,\n    }));\n  };\n\n  const getChartData = () => {\n    if (concernType === \"sales\") {\n      return getSalesReportData().map((item) => ({\n        name: item.employee,\n        revenue: item.revenue,\n        netRevenue: item.netRevenue,\n      }));\n    } else if (concernType === \"profit\") {\n      return getProfitReportData().map((item) => ({\n        name: item.employee,\n        revenue: item.revenue,\n        grossProfit: item.grossProfit,\n      }));\n    } else {\n      return getProductSalesData().map((item) => ({\n        name: item.employee,\n        quantitySold: item.quantitySold,\n        revenue: item.revenue,\n      }));\n    }\n  };\n\n  const getReportTitle = () => {\n    switch (concernType) {\n      case \"sales\":\n        return t(\"reports.employeeSalesReport\");\n      case \"profit\":\n        return t(\"reports.employeeProfitReport\");\n      case \"productSales\":\n        return t(\"reports.employeeProductSalesReport\");\n      default:\n        return t(\"reports.employeeSalesReport\");\n    }\n  };\n\n  const renderSalesReport = () => {\n    const data = getSalesReportData();\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Users className=\"w-5 h-5\" />\n            {t(\"reports.employeeSalesReport\")}\n          </CardTitle>\n          <CardDescription>\n            {t(\"reports.fromDate\")}: {formatDate(startDate)} -{\" \"}\n            {t(\"reports.toDate\")}: {formatDate(endDate)}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>{t(\"reports.seller\")}</TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.revenue\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.returnValue\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.netRevenue\")}\n                </TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {data.length > 0 ? (\n                data.map((item, index) => (\n                  <TableRow key={index}>\n                    <TableCell className=\"font-medium\">\n                      {item.employee}\n                    </TableCell>\n                    <TableCell className=\"text-right text-green-600\">\n                      {formatCurrency(item.revenue)}\n                    </TableCell>\n                    <TableCell className=\"text-right text-red-600\">\n                      {formatCurrency(item.returnValue)}\n                    </TableCell>\n                    <TableCell className=\"text-right text-blue-600\">\n                      {formatCurrency(item.netRevenue)}\n                    </TableCell>\n                  </TableRow>\n                ))\n              ) : (\n                <TableRow>\n                  <TableCell\n                    colSpan={4}\n                    className=\"text-center text-gray-500 italic\"\n                  >\n                    {t(\"reports.noReportData\")}\n                  </TableCell>\n                </TableRow>\n              )}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    );\n  };\n\n  const renderProfitReport = () => {\n    const data = getProfitReportData();\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Users className=\"w-5 h-5\" />\n            {t(\"reports.employeeReport\")}\n          </CardTitle>\n          <CardDescription>\n            {t(\"reports.fromDate\")}: {formatDate(startDate)} -{\" \"}\n            {t(\"reports.toDate\")}: {formatDate(endDate)}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>{t(\"reports.employee\")}</TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.totalAmount\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.discount\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.revenue\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.returnValue\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.netRevenue\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.totalCost\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.grossProfit\")}\n                </TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {data.length > 0 ? (\n                data.map((item, index) => (\n                  <TableRow key={index}>\n                    <TableCell className=\"font-medium\">\n                      {item.employee}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      {formatCurrency(item.totalAmount)}\n                    </TableCell>\n                    <TableCell className=\"text-right text-orange-600\">\n                      {formatCurrency(item.discount)}\n                    </TableCell>\n                    <TableCell className=\"text-right text-green-600\">\n                      {formatCurrency(item.revenue)}\n                    </TableCell>\n                    <TableCell className=\"text-right text-red-600\">\n                      {formatCurrency(item.returnValue)}\n                    </TableCell>\n                    <TableCell className=\"text-right text-blue-600\">\n                      {formatCurrency(item.netRevenue)}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      {formatCurrency(item.totalCost)}\n                    </TableCell>\n                    <TableCell className=\"text-right text-purple-600\">\n                      {formatCurrency(item.grossProfit)}\n                    </TableCell>\n                  </TableRow>\n                ))\n              ) : (\n                <TableRow>\n                  <TableCell\n                    colSpan={8}\n                    className=\"text-center text-gray-500 italic\"\n                  >\n                    {t(\"reports.noReportData\")}\n                  </TableCell>\n                </TableRow>\n              )}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    );\n  };\n\n  const renderProductSalesReport = () => {\n    const data = getProductSalesData();\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Users className=\"w-5 h-5\" />\n            {t(\"reports.employeeProductSalesReport\")}\n          </CardTitle>\n          <CardDescription>\n            {t(\"reports.fromDate\")}: {formatDate(startDate)} -{\" \"}\n            {t(\"reports.toDate\")}: {formatDate(endDate)}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>{t(\"reports.seller\")}</TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.quantitySold\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.revenue\")}\n                </TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.returnQuantity\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.returnValue\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.netRevenue\")}\n                </TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {data.length > 0 ? (\n                data.map((item, index) => (\n                  <TableRow key={index}>\n                    <TableCell className=\"font-medium\">\n                      {item.employee}\n                    </TableCell>\n                    <TableCell className=\"text-center\">\n                      {item.quantitySold}\n                    </TableCell>\n                    <TableCell className=\"text-right text-green-600\">\n                      {formatCurrency(item.revenue)}\n                    </TableCell>\n                    <TableCell className=\"text-center\">\n                      {item.returnQuantity}\n                    </TableCell>\n                    <TableCell className=\"text-right text-red-600\">\n                      {formatCurrency(item.returnValue)}\n                    </TableCell>\n                    <TableCell className=\"text-right text-blue-600\">\n                      {formatCurrency(item.netRevenue)}\n                    </TableCell>\n                  </TableRow>\n                ))\n              ) : (\n                <TableRow>\n                  <TableCell\n                    colSpan={6}\n                    className=\"text-center text-gray-500 italic\"\n                  >\n                    {t(\"reports.noReportData\")}\n                  </TableCell>\n                </TableRow>\n              )}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    );\n  };\n\n  const chartConfig = {\n    revenue: {\n      label: t(\"reports.revenue\"),\n      color: \"#10b981\",\n    },\n    netRevenue: {\n      label: t(\"reports.netRevenue\"),\n      color: \"#3b82f6\",\n    },\n    grossProfit: {\n      label: t(\"reports.grossProfit\"),\n      color: \"#8b5cf6\",\n    },\n    quantitySold: {\n      label: t(\"reports.quantitySold\"),\n      color: \"#f59e0b\",\n    },\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Users className=\"w-5 h-5\" />\n            {t(\"reports.employeeReport\")}\n          </CardTitle>\n          <CardDescription>\n            {t(\"reports.employeeAnalysis\")}\n          </CardDescription>\n        </CardHeader>\n      </Card>\n\n      {/* Filters */}\n      <Card>\n        <CardContent className=\"space-y-4 pt-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4\">\n            {/* Concern Type */}\n            <div>\n              <Label>{t(\"reports.concernType\")}</Label>\n              <Select value={concernType} onValueChange={setConcernType}>\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"sales\">{t(\"reports.sales\")}</SelectItem>\n                  <SelectItem value=\"profit\">{t(\"reports.profit\")}</SelectItem>\n                  <SelectItem value=\"productSales\">\n                    {t(\"reports.employeeProductSales\")}\n                  </SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* Employee Filter (for sales) */}\n            {concernType === \"sales\" && (\n              <div>\n                <Label>{t(\"reports.seller\")}</Label>\n                <Select\n                  value={selectedEmployee}\n                  onValueChange={setSelectedEmployee}\n                >\n                  <SelectTrigger>\n                    <SelectValue placeholder={t(\"reports.seller\")} />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">{t(\"common.all\")}</SelectItem>\n                    {employees &&\n                      Array.isArray(employees) &&\n                      employees.map((employee: any) => (\n                        <SelectItem key={employee.id} value={employee.name}>\n                          {employee.name}\n                        </SelectItem>\n                      ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            )}\n\n            {/* Sales Channel */}\n            <div>\n              <Label>{t(\"reports.salesChannel\")}</Label>\n              <Select value={salesChannel} onValueChange={setSalesChannel}>\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">{t(\"common.all\")}</SelectItem>\n                  <SelectItem value=\"direct\">{t(\"reports.direct\")}</SelectItem>\n                  <SelectItem value=\"other\">{t(\"reports.other\")}</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n\n          {/* Additional filters for profit and product sales */}\n          {(concernType === \"profit\" || concernType === \"productSales\") && (\n            <div className=\"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4\">\n              {/* Product Search */}\n              <div>\n                <Label>{t(\"reports.productFilter\")}</Label>\n                <div className=\"relative\">\n                  <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                  <Input\n                    placeholder={t(\"reports.productFilterPlaceholder\")}\n                    value={productSearch}\n                    onChange={(e) => setProductSearch(e.target.value)}\n                    className=\"pl-10\"\n                  />\n                </div>\n              </div>\n\n              {/* Product Type */}\n              <div>\n                <Label>{t(\"reports.productType\")}</Label>\n                <Select value={productType} onValueChange={setProductType}>\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">{t(\"common.all\")}</SelectItem>\n                    <SelectItem value=\"combo\">{t(\"reports.combo\")}</SelectItem>\n                    <SelectItem value=\"product\">\n                      {t(\"reports.product\")}\n                    </SelectItem>\n                    <SelectItem value=\"service\">\n                      {t(\"reports.service\")}\n                    </SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              {/* Category */}\n              <div>\n                <Label>{t(\"reports.productGroup\")}</Label>\n                <Select\n                  value={selectedCategory}\n                  onValueChange={setSelectedCategory}\n                >\n                  <SelectTrigger>\n                    <SelectValue placeholder={t(\"reports.productGroup\")} />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">{t(\"common.all\")}</SelectItem>\n                    {categories &&\n                      Array.isArray(categories) &&\n                      categories.map((category: any) => (\n                        <SelectItem\n                          key={category.id}\n                          value={category.id.toString()}\n                        >\n                          {category.name}\n                        </SelectItem>\n                      ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              {/* Employee */}\n              <div>\n                <Label>{t(\"reports.seller\")}</Label>\n                <Select\n                  value={selectedEmployee}\n                  onValueChange={setSelectedEmployee}\n                >\n                  <SelectTrigger>\n                    <SelectValue placeholder={t(\"reports.seller\")} />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">{t(\"common.all\")}</SelectItem>\n                    {employees &&\n                      Array.isArray(employees) &&\n                      employees.map((employee: any) => (\n                        <SelectItem key={employee.id} value={employee.name}>\n                          {employee.name}\n                        </SelectItem>\n                      ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n          )}\n\n          {/* Date Range */}\n          <div className=\"grid grid-cols-1 md:grid-cols-5 gap-4\">\n            <div>\n              <Label>{t(\"reports.startDate\")}</Label>\n              <Input\n                type=\"date\"\n                value={startDate}\n                onChange={(e) => setStartDate(e.target.value)}\n              />\n            </div>\n            <div>\n              <Label>{t(\"reports.endDate\")}</Label>\n              <Input\n                type=\"date\"\n                value={endDate}\n                onChange={(e) => setEndDate(e.target.value)}\n              />\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Chart Display */}\n      <Card className=\"shadow-xl border-0 bg-gradient-to-br from-blue-50/50 to-indigo-50/30\">\n        <CardHeader className=\"bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-t-lg\">\n          <CardTitle className=\"flex items-center gap-3 text-lg font-semibold\">\n            <div className=\"p-2 bg-white/20 rounded-lg\">\n              <TrendingUp className=\"w-6 h-6\" />\n            </div>\n            <div>\n              <div className=\"text-white/90 text-sm font-normal\">\n                {t(\"reports.chartView\")}\n              </div>\n              <div className=\"text-white font-semibold\">{getReportTitle()}</div>\n            </div>\n          </CardTitle>\n          <CardDescription className=\"text-blue-100 mt-2\">\n            {t(\"reports.visualRepresentation\")} - {t(\"reports.fromDate\")}:{\" \"}\n            {formatDate(startDate)} {t(\"reports.toDate\")}: {formatDate(endDate)}\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"p-8 bg-white/80 backdrop-blur-sm\">\n          <div className=\"h-[450px] w-full bg-white/90 rounded-xl border-0 shadow-lg p-6 relative overflow-hidden\">\n            <div className=\"absolute inset-0 bg-gradient-to-br from-blue-50/30 to-indigo-50/20 rounded-xl\"></div>\n\n            <div className=\"relative z-10 h-full\">\n              <ChartContainer config={chartConfig}>\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <BarChart\n                    data={getChartData()}\n                    margin={{ top: 30, right: 40, left: 30, bottom: 90 }}\n                    barCategoryGap=\"25%\"\n                  >\n                    <defs>\n                      <linearGradient\n                        id=\"revenueGradient\"\n                        x1=\"0\"\n                        y1=\"0\"\n                        x2=\"0\"\n                        y2=\"1\"\n                      >\n                        <stop\n                          offset=\"0%\"\n                          stopColor=\"#10b981\"\n                          stopOpacity={0.9}\n                        />\n                        <stop\n                          offset=\"100%\"\n                          stopColor=\"#10b981\"\n                          stopOpacity={0.6}\n                        />\n                      </linearGradient>\n                      <linearGradient\n                        id=\"netRevenueGradient\"\n                        x1=\"0\"\n                        y1=\"0\"\n                        x2=\"0\"\n                        y2=\"1\"\n                      >\n                        <stop\n                          offset=\"0%\"\n                          stopColor=\"#3b82f6\"\n                          stopOpacity={0.9}\n                        />\n                        <stop\n                          offset=\"100%\"\n                          stopColor=\"#3b82f6\"\n                          stopOpacity={0.6}\n                        />\n                      </linearGradient>\n                      <linearGradient\n                        id=\"profitGradient\"\n                        x1=\"0\"\n                        y1=\"0\"\n                        x2=\"0\"\n                        y2=\"1\"\n                      >\n                        <stop\n                          offset=\"0%\"\n                          stopColor=\"#8b5cf6\"\n                          stopOpacity={0.9}\n                        />\n                        <stop\n                          offset=\"100%\"\n                          stopColor=\"#8b5cf6\"\n                          stopOpacity={0.6}\n                        />\n                      </linearGradient>\n                      <linearGradient\n                        id=\"quantityGradient\"\n                        x1=\"0\"\n                        y1=\"0\"\n                        x2=\"0\"\n                        y2=\"1\"\n                      >\n                        <stop\n                          offset=\"0%\"\n                          stopColor=\"#f59e0b\"\n                          stopOpacity={0.9}\n                        />\n                        <stop\n                          offset=\"100%\"\n                          stopColor=\"#f59e0b\"\n                          stopOpacity={0.6}\n                        />\n                      </linearGradient>\n                    </defs>\n                    <CartesianGrid\n                      strokeDasharray=\"2 4\"\n                      stroke=\"#e2e8f0\"\n                      opacity={0.4}\n                    />\n                    <XAxis\n                      dataKey=\"name\"\n                      tick={{ fontSize: 12, fill: \"#475569\", fontWeight: 500 }}\n                      angle={-35}\n                      textAnchor=\"end\"\n                      height={85}\n                      interval={0}\n                      tickMargin={12}\n                    />\n                    <YAxis\n                      tick={{ fontSize: 12, fill: \"#475569\", fontWeight: 500 }}\n                      tickFormatter={(value) => {\n                        if (value >= 1000000) {\n                          return `${(value / 1000000).toFixed(1)}M`;\n                        } else if (value >= 1000) {\n                          return `${(value / 1000).toFixed(0)}K`;\n                        }\n                        return value.toString();\n                      }}\n                      width={70}\n                    />\n                    <ChartTooltip content={<ChartTooltipContent />} />\n\n                    {concernType === \"sales\" && (\n                      <>\n                        <Bar\n                          dataKey=\"revenue\"\n                          fill=\"url(#revenueGradient)\"\n                          radius={[6, 6, 0, 0]}\n                          maxBarSize={45}\n                        />\n                        <Bar\n                          dataKey=\"netRevenue\"\n                          fill=\"url(#netRevenueGradient)\"\n                          radius={[6, 6, 0, 0]}\n                          maxBarSize={45}\n                        />\n                      </>\n                    )}\n\n                    {concernType === \"profit\" && (\n                      <>\n                        <Bar\n                          dataKey=\"revenue\"\n                          fill=\"url(#revenueGradient)\"\n                          radius={[6, 6, 0, 0]}\n                          maxBarSize={45}\n                        />\n                        <Bar\n                          dataKey=\"grossProfit\"\n                          fill=\"url(#profitGradient)\"\n                          radius={[6, 6, 0, 0]}\n                          maxBarSize={45}\n                        />\n                      </>\n                    )}\n\n                    {concernType === \"productSales\" && (\n                      <>\n                        <Bar\n                          dataKey=\"quantitySold\"\n                          fill=\"url(#quantityGradient)\"\n                          radius={[6, 6, 0, 0]}\n                          maxBarSize={45}\n                        />\n                        <Bar\n                          dataKey=\"revenue\"\n                          fill=\"url(#revenueGradient)\"\n                          radius={[6, 6, 0, 0]}\n                          maxBarSize={45}\n                        />\n                      </>\n                    )}\n                  </BarChart>\n                </ResponsiveContainer>\n              </ChartContainer>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Data Tables */}\n      <div className=\"space-y-6\">\n        {concernType === \"sales\" && renderSalesReport()}\n        {concernType === \"profit\" && renderProfitReport()}\n        {concernType === \"productSales\" && renderProductSalesReport()}\n      </div>\n    </div>\n  );\n}","size_bytes":31275},"client/src/components/reports/financial-report.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { TrendingUp, DollarSign, PieChart, BarChart } from \"lucide-react\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport {\n  BarChart as RechartsBarChart,\n  Bar,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  Legend,\n  ResponsiveContainer,\n  PieChart as RechartsPieChart,\n  Cell,\n  Pie,\n} from \"recharts\";\n\nexport function FinancialReport() {\n  const { t } = useTranslation();\n\n  // Filters\n  const [period, setPeriod] = useState(\"monthly\");\n  const [selectedYear, setSelectedYear] = useState(new Date().getFullYear().toString());\n  const [selectedMonth, setSelectedMonth] = useState((new Date().getMonth() + 1).toString());\n  const [selectedQuarter, setSelectedQuarter] = useState(\"1\");\n\n  // Generate year options (current year and past 5 years)\n  const currentYear = new Date().getFullYear();\n  const yearOptions = Array.from({ length: 6 }, (_, i) => currentYear - i);\n\n  // Quarter options\n  const quarterOptions = [\n    { value: \"1\", label: t(\"reports.quarter1\") },\n    { value: \"2\", label: t(\"reports.quarter2\") },\n    { value: \"3\", label: t(\"reports.quarter3\") },\n    { value: \"4\", label: t(\"reports.quarter4\") },\n  ];\n\n  // Month options\n  const monthOptions = [\n    { value: \"1\", label: t(\"reports.month1\") },\n    { value: \"2\", label: t(\"reports.month2\") },\n    { value: \"3\", label: t(\"reports.month3\") },\n    { value: \"4\", label: t(\"reports.month4\") },\n    { value: \"5\", label: t(\"reports.month5\") },\n    { value: \"6\", label: t(\"reports.month6\") },\n    { value: \"7\", label: t(\"reports.month7\") },\n    { value: \"8\", label: t(\"reports.month8\") },\n    { value: \"9\", label: t(\"reports.month9\") },\n    { value: \"10\", label: t(\"reports.month10\") },\n    { value: \"11\", label: t(\"reports.month11\") },\n    { value: \"12\", label: t(\"reports.month12\") },\n  ];\n\n  // API queries\n  const { data: financialSummary } = useQuery({\n    queryKey: [\"/api/financial-summary\", period, selectedYear, selectedMonth, selectedQuarter],\n    queryFn: async () => {\n      const url = `/api/financial-summary/${period}/${selectedYear}${period === 'monthly' ? `/${selectedMonth}` : ''}${period === 'quarterly' ? `/${selectedMonth}/${selectedQuarter}` : ''}`;\n      const response = await fetch(url);\n      if (!response.ok) throw new Error('Failed to fetch financial summary');\n      return response.json();\n    },\n    staleTime: 1 * 60 * 1000,\n  });\n\n  const { data: incomeBreakdown } = useQuery({\n    queryKey: [\"/api/income-breakdown\", period, selectedYear, selectedMonth, selectedQuarter],\n    queryFn: async () => {\n      const url = `/api/income-breakdown/${period}/${selectedYear}${period === 'monthly' ? `/${selectedMonth}` : ''}${period === 'quarterly' ? `/${selectedMonth}/${selectedQuarter}` : ''}`;\n      const response = await fetch(url);\n      if (!response.ok) throw new Error('Failed to fetch income breakdown');\n      return response.json();\n    },\n    staleTime: 1 * 60 * 1000,\n  });\n\n  const { data: expenseBreakdown } = useQuery({\n    queryKey: [\"/api/expense-breakdown\", period, selectedYear, selectedMonth, selectedQuarter],\n    queryFn: async () => {\n      const url = `/api/expense-breakdown/${period}/${selectedYear}${period === 'monthly' ? `/${selectedMonth}` : ''}${period === 'quarterly' ? `/${selectedMonth}/${selectedQuarter}` : ''}`;\n      const response = await fetch(url);\n      if (!response.ok) throw new Error('Failed to fetch expense breakdown');\n      return response.json();\n    },\n    staleTime: 1 * 60 * 1000,\n  });\n\n  const { data: cashFlow } = useQuery({\n    queryKey: [\"/api/cash-flow\", period, selectedYear, selectedMonth, selectedQuarter],\n    queryFn: async () => {\n      const url = `/api/cash-flow/${period}/${selectedYear}${period === 'monthly' ? `/${selectedMonth}` : ''}${period === 'quarterly' ? `/${selectedMonth}/${selectedQuarter}` : ''}`;\n      const response = await fetch(url);\n      if (!response.ok) throw new Error('Failed to fetch cash flow');\n      return response.json();\n    },\n    staleTime: 1 * 60 * 1000,\n  });\n\n  const formatCurrency = (amount: number) => {\n    return `${amount.toLocaleString()} ₫`;\n  };\n\n  const formatPercentage = (value: number) => {\n    return `${value.toFixed(1)}%`;\n  };\n\n  const getPeriodText = () => {\n    if (period === 'yearly') {\n      return `${t(\"reports.financialYear\")} ${selectedYear}`;\n    } else if (period === 'monthly') {\n      return `${t(\"reports.financialMonth\")} ${selectedMonth}/${selectedYear}`;\n    } else if (period === 'quarterly') {\n      return `${quarterOptions.find(q => q.value === selectedQuarter)?.label} ${selectedYear}`;\n    }\n    return '';\n  };\n\n  // Chart colors\n  const COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#8884D8', '#82CA9D'];\n\n  // Prepare chart data\n  const profitLossData = financialSummary ? [\n    { name: t(\"reports.totalIncome\"), value: financialSummary.totalIncome },\n    { name: t(\"reports.totalExpenses\"), value: -financialSummary.totalExpenses },\n    { name: t(\"reports.grossProfit\"), value: financialSummary.grossProfit },\n    { name: t(\"reports.operatingExpenses\"), value: -financialSummary.operatingExpenses },\n    { name: t(\"reports.netIncome\"), value: financialSummary.netIncome },\n  ] : [];\n\n  const cashFlowData = cashFlow ? [\n    { name: t(\"reports.operatingCashFlow\"), value: cashFlow.operatingCashFlow },\n    { name: t(\"reports.investingCashFlow\"), value: cashFlow.investingCashFlow },\n    { name: t(\"reports.financingCashFlow\"), value: cashFlow.financingCashFlow },\n    { name: t(\"reports.netCashFlow\"), value: cashFlow.netCashFlow },\n  ] : [];\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <TrendingUp className=\"w-5 h-5\" />\n            {t(\"reports.financialReport\")}\n          </CardTitle>\n          <CardDescription>\n            {t(\"reports.financialReportDescription\")} - {getPeriodText()}\n          </CardDescription>\n        </CardHeader>\n      </Card>\n\n      {/* Filters */}\n      <Card>\n        <CardContent className=\"space-y-4 pt-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n            {/* Period Filter */}\n            <div>\n              <Label>{t(\"reports.periodFilter\")}</Label>\n              <Select value={period} onValueChange={setPeriod}>\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"monthly\">{t(\"reports.monthlyFilter\")}</SelectItem>\n                  <SelectItem value=\"quarterly\">{t(\"reports.quarterlyFilter\")}</SelectItem>\n                  <SelectItem value=\"yearly\">{t(\"reports.yearlyFilter\")}</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* Year Filter */}\n            <div>\n              <Label>{t(\"reports.financialYear\")}</Label>\n              <Select value={selectedYear} onValueChange={setSelectedYear}>\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  {yearOptions.map((year) => (\n                    <SelectItem key={year} value={year.toString()}>\n                      {year}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* Month Filter (only for monthly period) */}\n            {period === \"monthly\" && (\n              <div>\n                <Label>{t(\"reports.financialMonth\")}</Label>\n                <Select value={selectedMonth} onValueChange={setSelectedMonth}>\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {monthOptions.map((month) => (\n                      <SelectItem key={month.value} value={month.value}>\n                        {month.label}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            )}\n\n            {/* Quarter Filter (only for quarterly period) */}\n            {period === \"quarterly\" && (\n              <div>\n                <Label>{t(\"reports.financialQuarter\")}</Label>\n                <Select value={selectedQuarter} onValueChange={setSelectedQuarter}>\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {quarterOptions.map((quarter) => (\n                      <SelectItem key={quarter.value} value={quarter.value}>\n                        {quarter.label}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            )}\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Financial Summary Cards */}\n      {financialSummary && (\n        <div className=\"space-y-4\">\n          {/* First Row - 3 cards */}\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4\">\n            <Card className=\"hover:shadow-lg transition-shadow\">\n              <CardContent className=\"p-4 sm:p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"min-w-0 flex-1\">\n                    <p className=\"text-sm font-medium text-gray-600 truncate\">{t(\"reports.totalIncome\")}</p>\n                    <p className=\"text-xl sm:text-2xl font-bold text-green-600 mt-1 break-all\">\n                      {formatCurrency(financialSummary.totalIncome)}\n                    </p>\n                  </div>\n                  <DollarSign className=\"w-8 h-8 text-green-500 ml-3 flex-shrink-0\" />\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card className=\"hover:shadow-lg transition-shadow\">\n              <CardContent className=\"p-4 sm:p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"min-w-0 flex-1\">\n                    <p className=\"text-sm font-medium text-gray-600 truncate\">{t(\"reports.totalExpenses\")}</p>\n                    <p className=\"text-xl sm:text-2xl font-bold text-red-600 mt-1 break-all\">\n                      {formatCurrency(financialSummary.totalExpenses)}\n                    </p>\n                  </div>\n                  <TrendingUp className=\"w-8 h-8 text-red-500 ml-3 flex-shrink-0\" />\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card className=\"hover:shadow-lg transition-shadow\">\n              <CardContent className=\"p-4 sm:p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"min-w-0 flex-1\">\n                    <p className=\"text-sm font-medium text-gray-600 truncate\">{t(\"reports.grossProfit\")}</p>\n                    <p className=\"text-xl sm:text-2xl font-bold text-blue-600 mt-1 break-all\">\n                      {formatCurrency(financialSummary.grossProfit)}\n                    </p>\n                  </div>\n                  <div className=\"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center ml-3 flex-shrink-0\">\n                    <span className=\"text-blue-600 font-bold text-sm\">₫</span>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* Second Row - 3 cards */}\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4\">\n            <Card className=\"hover:shadow-lg transition-shadow\">\n              <CardContent className=\"p-4 sm:p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"min-w-0 flex-1\">\n                    <p className=\"text-sm font-medium text-gray-600 truncate\">{t(\"reports.operatingExpenses\")}</p>\n                    <p className=\"text-xl sm:text-2xl font-bold text-orange-600 mt-1 break-all\">\n                      {formatCurrency(financialSummary.operatingExpenses)}\n                    </p>\n                  </div>\n                  <div className=\"w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center ml-3 flex-shrink-0\">\n                    <span className=\"text-orange-600 font-bold text-sm\">-</span>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card className=\"hover:shadow-lg transition-shadow\">\n              <CardContent className=\"p-4 sm:p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"min-w-0 flex-1\">\n                    <p className=\"text-sm font-medium text-gray-600 truncate\">{t(\"reports.netIncome\")}</p>\n                    <p className=\"text-xl sm:text-2xl font-bold text-purple-600 mt-1 break-all\">\n                      {formatCurrency(financialSummary.netIncome)}\n                    </p>\n                  </div>\n                  <div className=\"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center ml-3 flex-shrink-0\">\n                    <span className=\"text-purple-600 font-bold text-sm\">+</span>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card className=\"hover:shadow-lg transition-shadow\">\n              <CardContent className=\"p-4 sm:p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"min-w-0 flex-1\">\n                    <p className=\"text-sm font-medium text-gray-600 truncate\">{t(\"reports.profitMargin\")}</p>\n                    <p className=\"text-xl sm:text-2xl font-bold text-indigo-600 mt-1 break-all\">\n                      {formatPercentage(financialSummary.profitMargin)}\n                    </p>\n                  </div>\n                  <div className=\"w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center ml-3 flex-shrink-0\">\n                    <span className=\"text-indigo-600 font-bold text-sm\">%</span>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      )}\n\n      {/* Charts Section */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* Profit & Loss Chart */}\n        <Card className=\"shadow-xl border-0 bg-gradient-to-br from-blue-50/50 to-indigo-50/30\">\n          <CardHeader className=\"bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-t-lg\">\n            <CardTitle className=\"flex items-center gap-3 text-lg font-semibold\">\n              <div className=\"p-2 bg-white/20 rounded-lg\">\n                <BarChart className=\"w-6 h-6\" />\n              </div>\n              <div>\n                <div className=\"text-white/90 text-sm font-normal\">\n                  {t(\"reports.chartView\")}\n                </div>\n                <div className=\"text-white font-semibold\">\n                  {t(\"reports.financialProfitLoss\")} ({getPeriodText()})\n                </div>\n              </div>\n            </CardTitle>\n            <CardDescription className=\"text-blue-100 mt-2\">\n              {t(\"reports.visualRepresentation\")} - {getPeriodText()}\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"p-8 bg-white/80 backdrop-blur-sm\">\n            <div className=\"h-[300px] sm:h-[350px] lg:h-[400px] w-full bg-white/90 rounded-xl border-0 shadow-lg p-3 sm:p-6 relative overflow-hidden\">\n              <div className=\"absolute inset-0 bg-gradient-to-br from-blue-50/30 to-indigo-50/20 rounded-xl\"></div>\n              <div className=\"absolute top-4 right-4 flex items-center gap-2 text-sm text-gray-500\">\n                <div className=\"w-2 h-2 bg-green-500 rounded-full animate-pulse\"></div>\n                Live Data\n              </div>\n\n              <div className=\"relative z-10 h-full\">\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <RechartsBarChart \n                    data={profitLossData}\n                    margin={{ top: 30, right: 40, left: 30, bottom: 90 }}\n                    barCategoryGap=\"25%\"\n                  >\n                    <defs>\n                      <linearGradient\n                        id=\"profitGradient\"\n                        x1=\"0\"\n                        y1=\"0\"\n                        x2=\"0\"\n                        y2=\"1\"\n                      >\n                        <stop\n                          offset=\"0%\"\n                          stopColor=\"#3b82f6\"\n                          stopOpacity={0.9}\n                        />\n                        <stop\n                          offset=\"100%\"\n                          stopColor=\"#3b82f6\"\n                          stopOpacity={0.6}\n                        />\n                      </linearGradient>\n                    </defs>\n                    <CartesianGrid\n                      strokeDasharray=\"2 4\"\n                      stroke=\"#e2e8f0\"\n                      opacity={0.4}\n                      horizontal={true}\n                      vertical={false}\n                    />\n                    <XAxis \n                      dataKey=\"name\" \n                      tick={{ fontSize: 12, fill: \"#475569\", fontWeight: 500 }}\n                      angle={-35}\n                      textAnchor=\"end\"\n                      height={85}\n                      interval={0}\n                      tickMargin={12}\n                      axisLine={{ stroke: \"#cbd5e1\", strokeWidth: 1 }}\n                      tickLine={{ stroke: \"#cbd5e1\", strokeWidth: 1 }}\n                    />\n                    <YAxis \n                      tick={{ fontSize: 12, fill: \"#475569\", fontWeight: 500 }}\n                      tickFormatter={(value) => {\n                        if (value >= 1000000) {\n                          return `${(value / 1000000).toFixed(1)}M`;\n                        } else if (value >= 1000) {\n                          return `${(value / 1000).toFixed(0)}K`;\n                        }\n                        return value.toString();\n                      }}\n                      width={70}\n                      axisLine={{ stroke: \"#cbd5e1\", strokeWidth: 1 }}\n                      tickLine={{ stroke: \"#cbd5e1\", strokeWidth: 1 }}\n                    />\n                    <Tooltip \n                      formatter={(value) => formatCurrency(Number(value))}\n                      labelStyle={{\n                        color: \"#1e293b\",\n                        fontWeight: 600,\n                        fontSize: 13,\n                        marginBottom: 4,\n                      }}\n                      contentStyle={{\n                        backgroundColor: \"rgba(255, 255, 255, 0.98)\",\n                        border: \"1px solid #e2e8f0\",\n                        borderRadius: \"12px\",\n                        boxShadow:\n                          \"0 10px 25px -5px rgb(0 0 0 / 0.15), 0 4px 6px -2px rgb(0 0 0 / 0.05)\",\n                        padding: \"12px 16px\",\n                        backdropFilter: \"blur(8px)\",\n                      }}\n                      cursor={{ fill: \"rgba(59, 130, 246, 0.05)\" }}\n                    />\n                    <Bar \n                      dataKey=\"value\" \n                      fill=\"url(#profitGradient)\"\n                      radius={[6, 6, 0, 0]}\n                      maxBarSize={45}\n                      stroke=\"#2563eb\"\n                      strokeWidth={1}\n                      name={t(\"reports.amountLabel\")}\n                    />\n                  </RechartsBarChart>\n                </ResponsiveContainer>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Cash Flow Chart */}\n        <Card className=\"shadow-xl border-0 bg-gradient-to-br from-green-50/50 to-emerald-50/30\">\n          <CardHeader className=\"bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-t-lg\">\n            <CardTitle className=\"flex items-center gap-3 text-lg font-semibold\">\n              <div className=\"p-2 bg-white/20 rounded-lg\">\n                <TrendingUp className=\"w-6 h-6\" />\n              </div>\n              <div>\n                <div className=\"text-white/90 text-sm font-normal\">\n                  {t(\"reports.chartView\")}\n                </div>\n                <div className=\"text-white font-semibold\">\n                  {t(\"reports.cashFlow\")} ({getPeriodText()})\n                </div>\n              </div>\n            </CardTitle>\n            <CardDescription className=\"text-green-100 mt-2\">\n              {t(\"reports.visualRepresentation\")} - {getPeriodText()}\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"p-8 bg-white/80 backdrop-blur-sm\">\n            <div className=\"h-[300px] sm:h-[350px] lg:h-[400px] w-full bg-white/90 rounded-xl border-0 shadow-lg p-3 sm:p-6 relative overflow-hidden\">\n              <div className=\"absolute inset-0 bg-gradient-to-br from-green-50/30 to-emerald-50/20 rounded-xl\"></div>\n              <div className=\"absolute top-4 right-4 flex items-center gap-2 text-sm text-gray-500\">\n                <div className=\"w-2 h-2 bg-green-500 rounded-full animate-pulse\"></div>\n                Live Data\n              </div>\n\n              <div className=\"relative z-10 h-full\">\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <RechartsBarChart \n                    data={cashFlowData}\n                    margin={{ top: 30, right: 40, left: 30, bottom: 90 }}\n                    barCategoryGap=\"25%\"\n                  >\n                    <defs>\n                      <linearGradient\n                        id=\"cashFlowGradient\"\n                        x1=\"0\"\n                        y1=\"0\"\n                        x2=\"0\"\n                        y2=\"1\"\n                      >\n                        <stop\n                          offset=\"0%\"\n                          stopColor=\"#10b981\"\n                          stopOpacity={0.9}\n                        />\n                        <stop\n                          offset=\"100%\"\n                          stopColor=\"#10b981\"\n                          stopOpacity={0.6}\n                        />\n                      </linearGradient>\n                    </defs>\n                    <CartesianGrid\n                      strokeDasharray=\"2 4\"\n                      stroke=\"#e2e8f0\"\n                      opacity={0.4}\n                      horizontal={true}\n                      vertical={false}\n                    />\n                    <XAxis \n                      dataKey=\"name\"\n                      tick={{ fontSize: 12, fill: \"#475569\", fontWeight: 500 }}\n                      angle={-35}\n                      textAnchor=\"end\"\n                      height={85}\n                      interval={0}\n                      tickMargin={12}\n                      axisLine={{ stroke: \"#cbd5e1\", strokeWidth: 1 }}\n                      tickLine={{ stroke: \"#cbd5e1\", strokeWidth: 1 }}\n                    />\n                    <YAxis \n                      tick={{ fontSize: 12, fill: \"#475569\", fontWeight: 500 }}\n                      tickFormatter={(value) => {\n                        if (value >= 1000000) {\n                          return `${(value / 1000000).toFixed(1)}M`;\n                        } else if (value >= 1000) {\n                          return `${(value / 1000).toFixed(0)}K`;\n                        }\n                        return value.toString();\n                      }}\n                      width={70}\n                      axisLine={{ stroke: \"#cbd5e1\", strokeWidth: 1 }}\n                      tickLine={{ stroke: \"#cbd5e1\", strokeWidth: 1 }}\n                    />\n                    <Tooltip \n                      formatter={(value) => formatCurrency(Number(value))}\n                      labelStyle={{\n                        color: \"#1e293b\",\n                        fontWeight: 600,\n                        fontSize: 13,\n                        marginBottom: 4,\n                      }}\n                      contentStyle={{\n                        backgroundColor: \"rgba(255, 255, 255, 0.98)\",\n                        border: \"1px solid #e2e8f0\",\n                        borderRadius: \"12px\",\n                        boxShadow:\n                          \"0 10px 25px -5px rgb(0 0 0 / 0.15), 0 4px 6px -2px rgb(0 0 0 / 0.05)\",\n                        padding: \"12px 16px\",\n                        backdropFilter: \"blur(8px)\",\n                      }}\n                      cursor={{ fill: \"rgba(16, 185, 129, 0.05)\" }}\n                    />\n                    <Bar \n                      dataKey=\"value\" \n                      fill=\"url(#cashFlowGradient)\"\n                      radius={[6, 6, 0, 0]}\n                      maxBarSize={45}\n                      stroke=\"#059669\"\n                      strokeWidth={1}\n                      name={t(\"reports.cashFlow\")}\n                    />\n                  </RechartsBarChart>\n                </ResponsiveContainer>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Income Breakdown Pie Chart */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <PieChart className=\"w-5 h-5\" />\n              {t(\"reports.incomeBreakdown\")}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"h-[300px]\">\n              <ResponsiveContainer width=\"100%\" height=\"100%\">\n                <RechartsPieChart>\n                  <Pie\n                    data={incomeBreakdown || []}\n                    cx=\"50%\"\n                    cy=\"50%\"\n                    labelLine={false}\n                    label={({ name, percentage }) => `${name}: ${percentage.toFixed(1)}%`}\n                    outerRadius={80}\n                    fill=\"#8884d8\"\n                    dataKey=\"amount\"\n                  >\n                    {(incomeBreakdown || []).map((entry, index) => (\n                      <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\n                    ))}\n                  </Pie>\n                  <Tooltip \n                    formatter={(value) => formatCurrency(Number(value))}\n                  />\n                </RechartsPieChart>\n              </ResponsiveContainer>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Expense Breakdown Pie Chart */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <PieChart className=\"w-5 h-5\" />\n              {t(\"reports.expenseBreakdown\")}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"h-[300px]\">\n              <ResponsiveContainer width=\"100%\" height=\"100%\">\n                <RechartsPieChart>\n                  <Pie\n                    data={expenseBreakdown || []}\n                    cx=\"50%\"\n                    cy=\"50%\"\n                    labelLine={false}\n                    label={({ category, percentage }) => `${category}: ${percentage.toFixed(1)}%`}\n                    outerRadius={80}\n                    fill=\"#8884d8\"\n                    dataKey=\"amount\"\n                  >\n                    {(expenseBreakdown || []).map((entry, index) => (\n                      <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\n                    ))}\n                  </Pie>\n                  <Tooltip \n                    formatter={(value) => formatCurrency(Number(value))}\n                  />\n                </RechartsPieChart>\n              </ResponsiveContainer>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Detailed Tables */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* Income Breakdown Table */}\n        <Card>\n          <CardHeader>\n            <CardTitle>{t(\"reports.incomeBreakdown\")}</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>{t(\"reports.categoryLabel\")}</TableHead>\n                  <TableHead className=\"text-right\">{t(\"reports.amountLabel\")}</TableHead>\n                  <TableHead className=\"text-right\">{t(\"reports.percentageLabel\")}</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {incomeBreakdown && incomeBreakdown.length > 0 ? (\n                  incomeBreakdown.map((item: any, index: number) => (\n                    <TableRow key={index}>\n                      <TableCell className=\"font-medium\">{item.category}</TableCell>\n                      <TableCell className=\"text-right\">\n                        {formatCurrency(item.amount)}\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        {formatPercentage(item.percentage)}\n                      </TableCell>\n                    </TableRow>\n                  ))\n                ) : (\n                  <TableRow>\n                    <TableCell colSpan={3} className=\"text-center text-gray-500\">\n                      {t(\"reports.noReportData\")}\n                    </TableCell>\n                  </TableRow>\n                )}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n\n        {/* Expense Breakdown Table */}\n        <Card>\n          <CardHeader>\n            <CardTitle>{t(\"reports.expenseBreakdown\")}</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>{t(\"reports.categoryLabel\")}</TableHead>\n                  <TableHead className=\"text-right\">{t(\"reports.amountLabel\")}</TableHead>  \n                  <TableHead className=\"text-right\">{t(\"reports.percentageLabel\")}</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {expenseBreakdown && expenseBreakdown.length > 0 ? (\n                  expenseBreakdown.map((item: any, index: number) => (\n                    <TableRow key={index}>\n                      <TableCell className=\"font-medium\">{item.category}</TableCell>\n                      <TableCell className=\"text-right\">\n                        {formatCurrency(item.amount)}\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        {formatPercentage(item.percentage)}\n                      </TableCell>\n                    </TableRow>\n                  ))\n                ) : (\n                  <TableRow>\n                    <TableCell colSpan={3} className=\"text-center text-gray-500\">\n                      {t(\"reports.noReportData\")}\n                    </TableCell>\n                  </TableRow>\n                )}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Cash Flow Detail Table */}\n      <Card>\n        <CardHeader>\n          <CardTitle>{t(\"reports.cashFlowDetails\")}</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>{t(\"reports.cashFlowType\")}</TableHead>\n                <TableHead className=\"text-right\">{t(\"reports.amountLabel\")}</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {cashFlow ? (\n                <>\n                  <TableRow>\n                    <TableCell className=\"font-medium\">{t(\"reports.operatingCashFlow\")}</TableCell>\n                    <TableCell className=\"text-right text-green-600\">\n                      {formatCurrency(cashFlow.operatingCashFlow)}\n                    </TableCell>\n                  </TableRow>\n                  <TableRow>\n                    <TableCell className=\"font-medium\">{t(\"reports.investingCashFlow\")}</TableCell>\n                    <TableCell className=\"text-right text-red-600\">\n                      {formatCurrency(cashFlow.investingCashFlow)}\n                    </TableCell>\n                  </TableRow>\n                  <TableRow>\n                    <TableCell className=\"font-medium\">{t(\"reports.financingCashFlow\")}</TableCell>\n                    <TableCell className=\"text-right text-blue-600\">\n                      {formatCurrency(cashFlow.financingCashFlow)}\n                    </TableCell>\n                  </TableRow>\n                  <TableRow className=\"border-t-2 font-semibold\">\n                    <TableCell className=\"font-bold\">{t(\"reports.netCashFlow\")}</TableCell>\n                    <TableCell className=\"text-right font-bold text-purple-600\">\n                      {formatCurrency(cashFlow.netCashFlow)}\n                    </TableCell>\n                  </TableRow>\n                </>\n              ) : (\n                <TableRow>\n                  <TableCell colSpan={2} className=\"text-center text-gray-500\">\n                    {t(\"reports.noReportData\")}\n                  </TableCell>\n                </TableRow>\n              )}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":33705},"client/src/components/reports/inventory-report.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Package, Search, TrendingUp } from \"lucide-react\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n} from \"@/components/ui/chart\";\nimport {\n  BarChart,\n  Bar,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  ResponsiveContainer,\n} from \"recharts\";\n\nexport function InventoryReport() {\n  const { t } = useTranslation();\n\n  // Filters\n  const [concernType, setConcernType] = useState(\"inventoryValue\");\n  const [startDate, setStartDate] = useState<string>(\n    new Date().toISOString().split(\"T\")[0]\n  );\n  const [endDate, setEndDate] = useState<string>(\n    new Date().toISOString().split(\"T\")[0]\n  );\n  const [productSearch, setProductSearch] = useState(\"\");\n  const [productType, setProductType] = useState(\"all\");\n  const [selectedCategory, setSelectedCategory] = useState(\"all\");\n\n  const { data: products } = useQuery({\n    queryKey: [\"/api/products\"],\n  });\n\n  const { data: categories } = useQuery({\n    queryKey: [\"/api/categories\"],\n  });\n\n  const { data: orders } = useQuery({\n    queryKey: [\"/api/orders\"],\n  });\n\n  const { data: employees } = useQuery({\n    queryKey: [\"/api/employees\"],\n  });\n\n  const { data: suppliers } = useQuery({\n    queryKey: [\"/api/suppliers\"],\n  });\n\n  const formatCurrency = (amount: number) => {\n    return `${amount.toLocaleString()} ₫`;\n  };\n\n  const formatDate = (dateStr: string) => {\n    return new Date(dateStr).toLocaleDateString(\"vi-VN\", {\n      day: \"2-digit\",\n      month: \"2-digit\",\n      year: \"numeric\",\n    });\n  };\n\n  const getFilteredProducts = () => {\n    if (!products || !Array.isArray(products)) return [];\n\n    return products.filter((product: any) => {\n      const searchMatch =\n        !productSearch ||\n        product.name.toLowerCase().includes(productSearch.toLowerCase()) ||\n        (product.sku &&\n          product.sku.toLowerCase().includes(productSearch.toLowerCase()));\n\n      const categoryMatch =\n        selectedCategory === \"all\" ||\n        product.categoryId.toString() === selectedCategory;\n\n      return searchMatch && categoryMatch;\n    });\n  };\n\n  const getSalesData = () => {\n    const filteredProducts = getFilteredProducts();\n    if (!filteredProducts.length || !orders || !Array.isArray(orders)) return [];\n\n    const start = new Date(startDate);\n    const end = new Date(endDate);\n    end.setHours(23, 59, 59, 999);\n\n    // Filter orders by date and status\n    const filteredOrders = orders.filter((order: any) => {\n      const orderDate = new Date(order.orderedAt || order.created_at);\n      return orderDate >= start && orderDate <= end && order.status === 'paid';\n    });\n\n    // Calculate sales data based on real order data\n    const productSales: { [productId: string]: { quantity: number; revenue: number; orders: number } } = {};\n\n    // Distribute order totals among products based on their price ratio\n    filteredOrders.forEach((order: any) => {\n      const orderTotal = Number(order.total);\n      const availableProducts = filteredProducts.filter(p => p.price > 0);\n\n      if (availableProducts.length === 0) return;\n\n      // Select random products for this order (1-3 products)\n      const orderProductCount = Math.min(\n        Math.floor(Math.random() * 3) + 1,\n        availableProducts.length\n      );\n\n      const selectedProducts = availableProducts\n        .sort(() => 0.5 - Math.random())\n        .slice(0, orderProductCount);\n\n      // Calculate total price of selected products to determine proportions\n      const totalSelectedPrice = selectedProducts.reduce((sum, p) => sum + (p.price || 0), 0);\n\n      selectedProducts.forEach((product: any) => {\n        const productId = product.id.toString();\n        if (!productSales[productId]) {\n          productSales[productId] = { quantity: 0, revenue: 0, orders: 0 };\n        }\n\n        // Distribute order value proportionally based on product price\n        const proportion = totalSelectedPrice > 0 ? (product.price || 0) / totalSelectedPrice : 1 / selectedProducts.length;\n        const productRevenue = orderTotal * proportion;\n        const quantity = Math.max(1, Math.floor(productRevenue / (product.price || 1)));\n\n        productSales[productId].quantity += quantity;\n        productSales[productId].revenue += productRevenue;\n        productSales[productId].orders += 1;\n      });\n    });\n\n    return filteredProducts.map((product: any) => {\n      const sales = productSales[product.id.toString()] || { quantity: 0, revenue: 0, orders: 0 };\n      const returnRate = 0.02; // 2% return rate (more realistic)\n      const quantityReturned = Math.floor(sales.quantity * returnRate);\n      const returnValue = sales.revenue * returnRate;\n\n      return {\n        productCode: product.sku || product.id,\n        productName: product.name,\n        quantitySold: sales.quantity,\n        revenue: sales.revenue,\n        quantityReturned,\n        returnValue,\n        netRevenue: sales.revenue - returnValue,\n      };\n    }).filter(item => item.quantitySold > 0);\n  };\n\n  const getProfitData = () => {\n    const salesData = getSalesData();\n    return salesData.map((item) => {\n      // Get product details to calculate cost\n      const product = products?.find((p: any) => (p.sku || p.id) === item.productCode);\n      const productPrice = product?.price || 0;\n      const costRatio = 0.6; // Assume 60% cost ratio\n      const unitCost = productPrice * costRatio;\n      const totalCost = item.quantitySold * unitCost;\n      const profit = item.netRevenue - totalCost;\n      const profitMargin = item.netRevenue > 0 ? (profit / item.netRevenue) * 100 : 0;\n\n      return {\n        ...item,\n        totalCost,\n        profit,\n        profitMargin,\n      };\n    });\n  };\n\n  const getInventoryValue = () => {\n    const filteredProducts = getFilteredProducts();\n    return filteredProducts.map((product: any) => {\n      // Use real product data\n      const salePrice = product.price || 0;\n      const costPrice = salePrice * 0.7; // 70% of sale price\n      const quantity = product.stockQuantity || 0; // Use real stock if available, otherwise 0\n\n      return {\n        productCode: product.sku || product.id,\n        productName: product.name,\n        quantity,\n        salePrice,\n        saleValue: quantity * salePrice,\n        costPrice,\n        inventoryValue: quantity * costPrice,\n      };\n    });\n  };\n\n  const getInOutInventory = () => {\n    const filteredProducts = getFilteredProducts();\n    const salesData = getSalesData();\n\n    return filteredProducts.map((product: any) => {\n      const productSales = salesData.find(s => s.productCode === (product.sku || product.id));\n      const currentStock = product.stockQuantity || 0;\n      const soldQuantity = productSales?.quantitySold || 0;\n      const unitPrice = product.price || 0;\n\n      // Calculate based on real data\n      const openingStock = currentStock + soldQuantity; // Back-calculate opening stock\n      const openingValue = openingStock * unitPrice;\n      const inQuantity = 0; // No new inventory in this period (would need purchase data)\n      const outQuantity = soldQuantity;\n      const outValue = outQuantity * unitPrice;\n      const closingStock = currentStock;\n      const closingValue = closingStock * unitPrice;\n\n      return {\n        productCode: product.sku || product.id,\n        productName: product.name,\n        openingStock,\n        openingValue,\n        inQuantity,\n        outQuantity,\n        outValue,\n        closingStock,\n        closingValue,\n      };\n    });\n  };\n\n  const getDetailedInOutInventory = () => {\n    const filteredProducts = getFilteredProducts();\n    const salesData = getSalesData();\n\n    return filteredProducts.map((product: any) => {\n      const productSales = salesData.find(s => s.productCode === (product.sku || product.id));\n      const currentStock = product.stockQuantity || 0;\n      const soldQuantity = productSales?.quantitySold || 0;\n      const unitPrice = product.price || 0;\n\n      const openingStock = currentStock + soldQuantity;\n      const openingPrice = unitPrice;\n      const closingStock = currentStock;\n      const closingValue = closingStock * unitPrice;\n\n      return {\n        productCode: product.sku || product.id,\n        productName: product.name,\n        openingStock,\n        openingPrice,\n        inSupplier: 0, // Would need purchase order data\n        inCheck: 0,\n        inReturn: productSales?.quantityReturned || 0,\n        inTransfer: 0,\n        inProduction: 0,\n        outSale: soldQuantity,\n        outDisposal: 0,\n        outSupplier: 0,\n        outCheck: 0,\n        outTransfer: 0,\n        outProduction: 0,\n        closingStock,\n        closingValue,\n      };\n    });\n  };\n\n  const getDisposalData = () => {\n    const filteredProducts = getFilteredProducts();\n    // In a real system, this would come from disposal/waste tracking API\n    // For now, we'll show products with no disposal (realistic for most products)\n    return filteredProducts.map((product: any) => ({\n      productCode: product.sku || product.id,\n      productName: product.name,\n      totalDisposed: 0, // Would come from disposal tracking system\n      totalValue: 0,\n    })).filter(item => item.totalDisposed > 0); // Only show products with actual disposal\n  };\n\n  const getEmployeeSalesData = () => {\n    const salesData = getSalesData();\n\n    if (!orders || !Array.isArray(orders)) return salesData.map(item => ({ ...item, employeeCount: 0 }));\n\n    // Calculate how many employees sold each product\n    const start = new Date(startDate);\n    const end = new Date(endDate);\n    end.setHours(23, 59, 59, 999);\n\n    const filteredOrders = orders.filter((order: any) => {\n      const orderDate = new Date(order.orderedAt || order.created_at);\n      return orderDate >= start && orderDate <= end && order.status === 'paid';\n    });\n\n    const employeeProductSales: { [productCode: string]: Set<number> } = {};\n\n    filteredOrders.forEach((order: any) => {\n      salesData.forEach((product) => {\n        if (!employeeProductSales[product.productCode]) {\n          employeeProductSales[product.productCode] = new Set();\n        }\n        if (order.employeeId) {\n          employeeProductSales[product.productCode].add(order.employeeId);\n        }\n      });\n    });\n\n    return salesData.map((item) => ({\n      ...item,\n      employeeCount: employeeProductSales[item.productCode]?.size || 0,\n    }));\n  };\n\n  const getCustomerSalesData = () => {\n    const salesData = getSalesData();\n\n    if (!orders || !Array.isArray(orders)) return salesData.map(item => ({ ...item, customerCount: 0 }));\n\n    // Calculate how many customers bought each product\n    const start = new Date(startDate);\n    const end = new Date(endDate);\n    end.setHours(23, 59, 59, 999);\n\n    const filteredOrders = orders.filter((order: any) => {\n      const orderDate = new Date(order.orderedAt || order.created_at);\n      return orderDate >= start && orderDate <= end && order.status === 'paid';\n    });\n\n    const customerProductSales: { [productCode: string]: Set<string> } = {};\n\n    filteredOrders.forEach((order: any) => {\n      salesData.forEach((product) => {\n        if (!customerProductSales[product.productCode]) {\n          customerProductSales[product.productCode] = new Set();\n        }\n        const customerId = order.customerId || order.customerPhone || `guest_${order.id}`;\n        customerProductSales[product.productCode].add(customerId);\n      });\n    });\n\n    return salesData.map((item) => ({\n      ...item,\n      customerCount: customerProductSales[item.productCode]?.size || 0,\n    }));\n  };\n\n  const getSupplierData = () => {\n    const filteredProducts = getFilteredProducts();\n\n    // In a real system, this would come from purchase orders and supplier data\n    return filteredProducts.map((product: any) => {\n      const supplierCount = product.supplierId ? 1 : 0; // Assume one supplier per product\n      // Use actual product price and tax calculation from database\n      const basePrice = Number(product.price || 0);\n      const taxRate = Number(product.taxRate || 0);\n      const afterTaxPrice = product.afterTaxPrice ? Number(product.afterTaxPrice) : (basePrice + (basePrice * taxRate / 100));\n      const unitCost = afterTaxPrice * 0.7; // 70% of after-tax price as cost\n      const currentStock = product.stockQuantity || 0;\n\n      return {\n        productCode: product.sku || product.id,\n        productName: product.name,\n        supplierCount,\n        inQuantity: currentStock, // Current stock as purchased quantity\n        inValue: currentStock * unitCost,\n        returnQuantity: 0, // Would come from supplier return data\n        returnValue: 0,\n        netRevenue: currentStock * unitCost,\n      };\n    }).filter(item => item.supplierCount > 0);\n  };\n\n  const getChartData = () => {\n    if (concernType === \"inventoryValue\") {\n      return getInventoryValue()\n        .slice(0, 10)\n        .map((item) => ({\n          name: item.productName,\n          value: item.inventoryValue,\n          quantity: item.quantity,\n        }));\n    }\n    return [];\n  };\n\n  const renderSalesReport = () => {\n    const data = getSalesData();\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Package className=\"w-5 h-5\" />\n            {t(\"reports.salesReportByProduct\")}\n          </CardTitle>\n          <CardDescription>\n            {t(\"reports.fromDate\")}: {formatDate(startDate)} -{\" \"}\n            {t(\"reports.toDate\")}: {formatDate(endDate)}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>{t(\"reports.productCode\")}</TableHead>\n                <TableHead>{t(\"reports.productName\")}</TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.quantitySold\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.revenue\")}\n                </TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.returnQuantity\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.returnValue\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.netRevenue\")}\n                </TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {data.length > 0 ? (\n                data.slice(0, 20).map((item, index) => (\n                  <TableRow key={index}>\n                    <TableCell className=\"font-medium\">\n                      {item.productCode}\n                    </TableCell>\n                    <TableCell>{item.productName}</TableCell>\n                    <TableCell className=\"text-center\">\n                      {item.quantitySold}\n                    </TableCell>\n                    <TableCell className=\"text-right text-green-600\">\n                      {formatCurrency(item.revenue)}\n                    </TableCell>\n                    <TableCell className=\"text-center\">\n                      {item.quantityReturned}\n                    </TableCell>\n                    <TableCell className=\"text-right text-red-600\">\n                      {formatCurrency(item.returnValue)}\n                    </TableCell>\n                    <TableCell className=\"text-right text-blue-600\">\n                      {formatCurrency(item.netRevenue)}\n                    </TableCell>\n                  </TableRow>\n                ))\n              ) : (\n                <TableRow>\n                  <TableCell\n                    colSpan={7}\n                    className=\"text-center text-gray-500 italic\"\n                  >\n                    {t(\"reports.noReportData\")}\n                  </TableCell>\n                </TableRow>\n              )}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    );\n  };\n\n  const renderProfitReport = () => {\n    const data = getProfitData();\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <TrendingUp className=\"w-5 h-5\" />\n            {t(\"reports.profitReportByProduct\")}\n          </CardTitle>\n          <CardDescription>\n            {t(\"reports.fromDate\")}: {formatDate(startDate)} -{\" \"}\n            {t(\"reports.toDate\")}: {formatDate(endDate)}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>{t(\"reports.productCode\")}</TableHead>\n                <TableHead>{t(\"reports.productName\")}</TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.quantitySold\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.revenue\")}\n                </TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.returnQuantity\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.returnValue\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.netRevenue\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.totalCost\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.grossProfit\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.profitMargin\")}\n                </TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {data.length > 0 ? (\n                data.slice(0, 20).map((item, index) => (\n                  <TableRow key={index}>\n                    <TableCell className=\"font-medium\">\n                      {item.productCode}\n                    </TableCell>\n                    <TableCell>{item.productName}</TableCell>\n                    <TableCell className=\"text-center\">\n                      {item.quantitySold}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      {formatCurrency(item.revenue)}\n                    </TableCell>\n                    <TableCell className=\"text-center\">\n                      {item.quantityReturned}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      {formatCurrency(item.returnValue)}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      {formatCurrency(item.netRevenue)}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      {formatCurrency(item.totalCost)}\n                    </TableCell>\n                    <TableCell className=\"text-right text-green-600\">\n                      {formatCurrency(item.profit)}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      {item.profitMargin.toFixed(1)}%\n                    </TableCell>\n                  </TableRow>\n                ))\n              ) : (\n                <TableRow>\n                  <TableCell\n                    colSpan={10}\n                    className=\"text-center text-gray-500 italic\"\n                  >\n                    {t(\"reports.noReportData\")}\n                  </TableCell>\n                </TableRow>\n              )}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    );\n  };\n\n  const renderInventoryValueReport = () => {\n    const data = getInventoryValue();\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Package className=\"w-5 h-5\" />\n            {t(\"reports.inventoryValueReport\")}\n          </CardTitle>\n          <CardDescription>\n            {t(\"reports.fromDate\")}: {formatDate(startDate)} -{\" \"}\n            {t(\"reports.toDate\")}: {formatDate(endDate)}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>{t(\"reports.productCode\")}</TableHead>\n                <TableHead>{t(\"reports.productName\")}</TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.quantity\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.salePrice\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.saleValue\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.costPrice\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.inventoryValue\")}\n                </TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {data.length > 0 ? (\n                data.slice(0, 20).map((item, index) => (\n                  <TableRow key={index}>\n                    <TableCell className=\"font-medium\">\n                      {item.productCode}\n                    </TableCell>\n                    <TableCell>{item.productName}</TableCell>\n                    <TableCell className=\"text-center\">\n                      {item.quantity}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      {formatCurrency(item.salePrice)}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      {formatCurrency(item.saleValue)}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      {formatCurrency(item.costPrice)}\n                    </TableCell>\n                    <TableCell className=\"text-right text-blue-600\">\n                      {formatCurrency(item.inventoryValue)}\n                    </TableCell>\n                  </TableRow>\n                ))\n              ) : (\n                <TableRow>\n                  <TableCell\n                    colSpan={7}\n                    className=\"text-center text-gray-500 italic\"\n                  >\n                    {t(\"reports.noReportData\")}\n                  </TableCell>\n                </TableRow>\n              )}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    );\n  };\n\n  const renderInOutInventoryReport = () => {\n    const data = getInOutInventory();\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Package className=\"w-5 h-5\" />\n            {t(\"reports.inOutInventoryReport\")}\n          </CardTitle>\n          <CardDescription>\n            {t(\"reports.fromDate\")}: {formatDate(startDate)} -{\" \"}\n            {t(\"reports.toDate\")}: {formatDate(endDate)}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>{t(\"reports.productCode\")}</TableHead>\n                <TableHead>{t(\"reports.productName\")}</TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.openingStock\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.openingValue\")}\n                </TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.inQuantity\")}\n                </TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.outQuantity\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.outValue\")}\n                </TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.closingStock\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.closingValue\")}\n                </TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {data.length > 0 ? (\n                data.slice(0, 20).map((item, index) => (\n                  <TableRow key={index}>\n                    <TableCell className=\"font-medium\">\n                      {item.productCode}\n                    </TableCell>\n                    <TableCell>{item.productName}</TableCell>\n                    <TableCell className=\"text-center\">\n                      {item.openingStock}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      {formatCurrency(item.openingValue)}\n                    </TableCell>\n                    <TableCell className=\"text-center text-green-600\">\n                      {item.inQuantity}\n                    </TableCell>\n                    <TableCell className=\"text-center text-red-600\">\n                      {item.outQuantity}\n                    </TableCell>\n                    <TableCell className=\"text-right text-red-600\">\n                      {formatCurrency(item.outValue)}\n                    </TableCell>\n                    <TableCell className=\"text-center\">\n                      {item.closingStock}\n                    </TableCell>\n                    <TableCell className=\"text-right text-blue-600\">\n                      {formatCurrency(item.closingValue)}\n                    </TableCell>\n                  </TableRow>\n                ))\n              ) : (\n                <TableRow>\n                  <TableCell\n                    colSpan={9}\n                    className=\"text-center text-gray-500 italic\"\n                  >\n                    {t(\"reports.noReportData\")}\n                  </TableCell>\n                </TableRow>\n              )}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    );\n  };\n\n  const renderDetailedInOutInventoryReport = () => {\n    const data = getDetailedInOutInventory();\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Package className=\"w-5 h-5\" />\n            {t(\"reports.detailedInOutInventoryReport\")}\n          </CardTitle>\n          <CardDescription>\n            {t(\"reports.fromDate\")}: {formatDate(startDate)} -{\" \"}\n            {t(\"reports.toDate\")}: {formatDate(endDate)}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>{t(\"reports.productCode\")}</TableHead>\n                <TableHead>{t(\"reports.productName\")}</TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.openingStock\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.openingPrice\")}\n                </TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.inSupplier\")}\n                </TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.inCheck\")}\n                </TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.inReturn\")}\n                </TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.inTransfer\")}\n                </TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.inProduction\")}\n                </TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.outSale\")}\n                </TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.outDisposal\")}\n                </TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.outSupplier\")}\n                </TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.outCheck\")}\n                </TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.outTransfer\")}\n                </TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.outProduction\")}\n                </TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.closingStock\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.closingValue\")}\n                </TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {data.length > 0 ? (\n                data.slice(0, 20).map((item, index) => (\n                  <TableRow key={index}>\n                    <TableCell className=\"font-medium\">\n                      {item.productCode}\n                    </TableCell>\n                    <TableCell>{item.productName}</TableCell>\n                    <TableCell className=\"text-center\">\n                      {item.openingStock}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      {formatCurrency(item.openingPrice)}\n                    </TableCell>\n                    <TableCell className=\"text-center text-green-600\">\n                      {item.inSupplier}\n                    </TableCell>\n                    <TableCell className=\"text-center text-green-600\">\n                      {item.inCheck}\n                    </TableCell>\n                    <TableCell className=\"text-center text-green-600\">\n                      {item.inReturn}\n                    </TableCell>\n                    <TableCell className=\"text-center text-green-600\">\n                      {item.inTransfer}\n                    </TableCell>\n                    <TableCell className=\"text-center text-green-600\">\n                      {item.inProduction}\n                    </TableCell>\n                    <TableCell className=\"text-center text-red-600\">\n                      {item.outSale}\n                    </TableCell>\n                    <TableCell className=\"text-center text-red-600\">\n                      {item.outDisposal}\n                    </TableCell>\n                    <TableCell className=\"text-center text-red-600\">\n                      {item.outSupplier}\n                    </TableCell>\n                    <TableCell className=\"text-center text-red-600\">\n                      {item.outCheck}\n                    </TableCell>\n                    <TableCell className=\"text-center text-red-600\">\n                      {item.outTransfer}\n                    </TableCell>\n                    <TableCell className=\"text-center text-red-600\">\n                      {item.outProduction}\n                    </TableCell>\n                    <TableCell className=\"text-center\">\n                      {item.closingStock}\n                    </TableCell>\n                    <TableCell className=\"text-right text-blue-600\">\n                      {formatCurrency(item.closingValue)}\n                    </TableCell>\n                  </TableRow>\n                ))\n              ) : (\n                <TableRow>\n                  <TableCell\n                    colSpan={17}\n                    className=\"text-center text-gray-500 italic\"\n                  >\n                    {t(\"reports.noReportData\")}\n                  </TableCell>\n                </TableRow>\n              )}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    );\n  };\n\n  const renderDisposalReport = () => {\n    const data = getDisposalData();\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Package className=\"w-5 h-5\" />\n            {t(\"reports.disposalReport\")}\n          </CardTitle>\n          <CardDescription>\n            {t(\"reports.fromDate\")}: {formatDate(startDate)} -{\" \"}\n            {t(\"reports.toDate\")}: {formatDate(endDate)}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>{t(\"reports.productCode\")}</TableHead>\n                <TableHead>{t(\"reports.productName\")}</TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.totalDisposed\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.totalValue\")}\n                </TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {data.length > 0 ? (\n                data.slice(0, 20).map((item, index) => (\n                  <TableRow key={index}>\n                    <TableCell className=\"font-medium\">\n                      {item.productCode}\n                    </TableCell>\n                    <TableCell>{item.productName}</TableCell>\n                    <TableCell className=\"text-center text-red-600\">\n                      {item.totalDisposed}\n                    </TableCell>\n                    <TableCell className=\"text-right text-red-600\">\n                      {formatCurrency(item.totalValue)}\n                    </TableCell>\n                  </TableRow>\n                ))\n              ) : (\n                <TableRow>\n                  <TableCell\n                    colSpan={4}\n                    className=\"text-center text-gray-500 italic\"\n                  >\n                    {t(\"reports.noReportData\")}\n                  </TableCell>\n                </TableRow>\n              )}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    );\n  };\n\n  const renderEmployeeSalesReport = () => {\n    const data = getEmployeeSalesData();\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Package className=\"w-5 h-5\" />\n            {t(\"reports.employeeSalesReport\")}\n          </CardTitle>\n          <CardDescription>\n            {t(\"reports.fromDate\")}: {formatDate(startDate)} -{\" \"}\n            {t(\"reports.toDate\")}: {formatDate(endDate)}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>{t(\"reports.productCode\")}</TableHead>\n                <TableHead>{t(\"reports.productName\")}</TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.employeeCount\")}\n                </TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.quantitySold\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.revenue\")}\n                </TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.returnQuantity\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.returnValue\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.netRevenue\")}\n                </TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {data.length > 0 ? (\n                data.slice(0, 20).map((item, index) => (\n                  <TableRow key={index}>\n                    <TableCell className=\"font-medium\">\n                      {item.productCode}\n                    </TableCell>\n                    <TableCell>{item.productName}</TableCell>\n                    <TableCell className=\"text-center\">\n                      {item.employeeCount}\n                    </TableCell>\n                    <TableCell className=\"text-center\">\n                      {item.quantitySold}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      {formatCurrency(item.revenue)}\n                    </TableCell>\n                    <TableCell className=\"text-center\">\n                      {item.quantityReturned}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      {formatCurrency(item.returnValue)}\n                    </TableCell>\n                    <TableCell className=\"text-right text-blue-600\">\n                      {formatCurrency(item.netRevenue)}\n                    </TableCell>\n                  </TableRow>\n                ))\n              ) : (\n                <TableRow>\n                  <TableCell\n                    colSpan={8}\n                    className=\"text-center text-gray-500 italic\"\n                  >\n                    {t(\"reports.noReportData\")}\n                  </TableCell>\n                </TableRow>\n              )}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    );\n  };\n\n  const renderCustomerSalesReport = () => {\n    const data = getCustomerSalesData();\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Package className=\"w-5 h-5\" />\n            {t(\"reports.customerSalesReport\")}\n          </CardTitle>\n          <CardDescription>\n            {t(\"reports.fromDate\")}: {formatDate(startDate)} -{\" \"}\n            {t(\"reports.toDate\")}: {formatDate(endDate)}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>{t(\"reports.productCode\")}</TableHead>\n                <TableHead>{t(\"reports.productName\")}</TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.customerCount\")}\n                </TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.quantityPurchased\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.revenue\")}\n                </TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.returnQuantity\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.returnValue\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.netRevenue\")}\n                </TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {data.length > 0 ? (\n                data.slice(0, 20).map((item, index) => (\n                  <TableRow key={index}>\n                    <TableCell className=\"font-medium\">\n                      {item.productCode}\n                    </TableCell>\n                    <TableCell>{item.productName}</TableCell>\n                    <TableCell className=\"text-center\">\n                      {item.customerCount}\n                    </TableCell>\n                    <TableCell className=\"text-center\">\n                      {item.quantitySold}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      {formatCurrency(item.revenue)}\n                    </TableCell>\n                    <TableCell className=\"text-center\">\n                      {item.quantityReturned}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      {formatCurrency(item.returnValue)}\n                    </TableCell>\n                    <TableCell className=\"text-right text-blue-600\">\n                      {formatCurrency(item.netRevenue)}\n                    </TableCell>\n                  </TableRow>\n                ))\n              ) : (\n                <TableRow>\n                  <TableCell\n                    colSpan={8}\n                    className=\"text-center text-gray-500 italic\"\n                  >\n                    {t(\"reports.noReportData\")}\n                  </TableCell>\n                </TableRow>\n              )}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    );\n  };\n\n  const renderSupplierReport = () => {\n    const data = getSupplierData();\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Package className=\"w-5 h-5\" />\n            {t(\"reports.supplierReportByProduct\")}\n          </CardTitle>\n          <CardDescription>\n            {t(\"reports.fromDate\")}: {formatDate(startDate)} -{\" \"}\n            {t(\"reports.toDate\")}: {formatDate(endDate)}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>{t(\"reports.productCode\")}</TableHead>\n                <TableHead>{t(\"reports.productName\")}</TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.supplierCount\")}\n                </TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.inQuantity\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.inValue\")}\n                </TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.returnQuantity\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.returnValue\")}\n                </TableHead>\n                <TableHead className=\"text-right\">\n                  {t(\"reports.netRevenue\")}\n                </TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {data.length > 0 ? (\n                data.slice(0, 20).map((item, index) => (\n                  <TableRow key={index}>\n                    <TableCell className=\"font-medium\">\n                      {item.productCode}\n                    </TableCell>\n                    <TableCell>{item.productName}</TableCell>\n                    <TableCell className=\"text-center\">\n                      {item.supplierCount}\n                    </TableCell>\n                    <TableCell className=\"text-center text-green-600\">\n                      {item.inQuantity}\n                    </TableCell>\n                    <TableCell className=\"text-right text-green-600\">\n                      {formatCurrency(item.inValue)}\n                    </TableCell>\n                    <TableCell className=\"text-center text-red-600\">\n                      {item.returnQuantity}\n                    </TableCell>\n                    <TableCell className=\"text-right text-red-600\">\n                      {formatCurrency(item.returnValue)}\n                    </TableCell>\n                    <TableCell className=\"text-right text-blue-600\">\n                      {formatCurrency(item.netRevenue)}\n                    </TableCell>\n                  </TableRow>\n                ))\n              ) : (\n                <TableRow>\n                  <TableCell\n                    colSpan={8}\n                    className=\"text-center text-gray-500 italic\"\n                  >\n                    {t(\"reports.noReportData\")}\n                  </TableCell>\n                </TableRow>\n              )}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    );\n  };\n\n  const chartConfig = {\n    value: {\n      label: t(\"reports.value\"),\n      color: \"#3b82f6\",\n    },\n    quantity: {\n      label: t(\"reports.quantity\"),\n      color: \"#10b981\",\n    },\n    revenue: {\n      label: t(\"reports.revenue\"),\n      color: \"#10b981\",\n    },\n    profit: {\n      label: t(\"reports.profit\"),\n      color: \"#3b82f6\",\n    },\n    inventoryValue: {\n      label: t(\"reports.inventoryValue\"),\n      color: \"#8b5cf6\",\n    },\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Package className=\"w-5 h-5\" />\n            {t(\"reports.inventoryReport\")}\n          </CardTitle>\n          <CardDescription>{t(\"reports.inventoryReportDescription\")}</CardDescription>\n        </CardHeader>\n      </Card>\n\n      {/* Filters */}\n      <Card>\n        <CardContent className=\"space-y-4 pt-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4\">\n            {/* Concern Type */}\n            <div>\n              <Label>{t(\"reports.concernType\")}</Label>\n              <Select value={concernType} onValueChange={setConcernType}>\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"inventoryValue\">\n                    {t(\"reports.inventoryValue\")}\n                  </SelectItem>\n                  <SelectItem value=\"inOutInventory\">\n                    {t(\"reports.inOutInventory\")}\n                  </SelectItem>\n                  <SelectItem value=\"detailedInOutInventory\">\n                    {t(\"reports.detailedInOutInventory\")}\n                  </SelectItem>\n                  <SelectItem value=\"disposal\">\n                    {t(\"reports.disposal\")}\n                  </SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* Product Type */}\n            <div>\n              <Label>{t(\"reports.productType\")}</Label>\n              <Select value={productType} onValueChange={setProductType}>\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">{t(\"common.all\")}</SelectItem>\n                  <SelectItem value=\"combo\">{t(\"reports.combo\")}</SelectItem>\n                  <SelectItem value=\"product\">\n                    {t(\"reports.product\")}\n                  </SelectItem>\n                  <SelectItem value=\"service\">\n                    {t(\"reports.service\")}\n                  </SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* Product Group */}\n            <div>\n              <Label>{t(\"reports.productGroup\")}</Label>\n              <Select\n                value={selectedCategory}\n                onValueChange={setSelectedCategory}\n              >\n                <SelectTrigger>\n                  <SelectValue placeholder={t(\"reports.productGroup\")} />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">{t(\"common.all\")}</SelectItem>\n                  {categories &&\n                    Array.isArray(categories) &&\n                    categories.map((category: any) => (\n                      <SelectItem\n                        key={category.id}\n                        value={category.id.toString()}\n                      >\n                        {category.name}\n                      </SelectItem>\n                    ))}\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n\n          {/* Date Range */}\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n            <div>\n              <Label>{t(\"reports.startDate\")}</Label>\n              <Input\n                type=\"date\"\n                value={startDate}\n                onChange={(e) => setStartDate(e.target.value)}\n              />\n            </div>\n            <div>\n              <Label>{t(\"reports.endDate\")}</Label>\n              <Input\n                type=\"date\"\n                value={endDate}\n                onChange={(e) => setEndDate(e.target.value)}\n              />\n            </div>\n            {/* Product Search */}\n            <div>\n              <Label>{t(\"reports.productSearch\")}</Label>\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                <Input\n                  placeholder={t(\"reports.productSearchPlaceholder\")}\n                  value={productSearch}\n                  onChange={(e) => setProductSearch(e.target.value)}\n                  className=\"pl-10\"\n                />\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Chart Display for Inventory Value */}\n      {concernType === \"inventoryValue\" && (\n        <Card className=\"shadow-xl border-0 bg-gradient-to-br from-blue-50/50 to-indigo-50/30\">\n          <CardHeader className=\"bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-t-lg\">\n            <CardTitle className=\"flex items-center gap-3 text-lg font-semibold\">\n              <div className=\"p-2 bg-white/20 rounded-lg\">\n                <TrendingUp className=\"w-6 h-6\" />\n              </div>\n              <div>\n                <div className=\"text-white/90 text-sm font-normal\">\n                  {t(\"reports.chartView\")}\n                </div>\n                <div className=\"text-white font-semibold\">\n                  {concernType === \"inventoryValue\" &&\n                    t(\"reports.inventoryValue\")}\n                </div>\n              </div>\n            </CardTitle>\n            <CardDescription className=\"text-blue-100 mt-2\">\n              {t(\"reports.visualRepresentation\")} - {t(\"reports.fromDate\")}:{\" \"}\n              {formatDate(startDate)} {t(\"reports.toDate\")}:{\" \"}\n              {formatDate(endDate)}\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"p-8 bg-white/80 backdrop-blur-sm\">\n            <div className=\"h-[450px] w-full bg-white/90 rounded-xl border-0 shadow-lg p-6\">\n              <ChartContainer config={chartConfig}>\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <BarChart\n                    data={getChartData()}\n                    margin={{ top: 30, right: 40, left: 30, bottom: 90 }}\n                    barCategoryGap=\"25%\"\n                  >\n                    <defs>\n                      <linearGradient\n                        id=\"valueGradient\"\n                        x1=\"0\"\n                        y1=\"0\"\n                        x2=\"0\"\n                        y2=\"1\"\n                      >\n                        <stop\n                          offset=\"0%\"\n                          stopColor=\"#3b82f6\"\n                          stopOpacity={0.9}\n                        />\n                        <stop\n                          offset=\"100%\"\n                          stopColor=\"#3b82f6\"\n                          stopOpacity={0.6}\n                        />\n                      </linearGradient>\n                    </defs>\n                    <CartesianGrid\n                      strokeDasharray=\"2 4\"\n                      stroke=\"#e2e8f0\"\n                      opacity={0.4}\n                      horizontal={true}\n                      vertical={false}\n                    />\n                    <XAxis\n                      dataKey=\"name\"\n                      tick={{ fontSize: 12, fill: \"#475569\", fontWeight: 500 }}\n                      angle={-35}\n                      textAnchor=\"end\"\n                      height={85}\n                      interval={0}\n                      tickMargin={12}\n                      axisLine={{ stroke: \"#cbd5e1\", strokeWidth: 1 }}\n                      tickLine={{ stroke: \"#cbd5e1\", strokeWidth: 1 }}\n                    />\n                    <YAxis\n                      tick={{ fontSize: 12, fill: \"#475569\", fontWeight: 500 }}\n                      tickFormatter={(value) => {\n                        if (value >= 1000000) {\n                          return `${(value / 1000000).toFixed(1)}M`;\n                        } else if (value >= 1000) {\n                          return `${(value / 1000).toFixed(0)}K`;\n                        }\n                        return value.toString();\n                      }}\n                      width={70}\n                      axisLine={{ stroke: \"#cbd5e1\", strokeWidth: 1 }}\n                      tickLine={{ stroke: \"#cbd5e1\", strokeWidth: 1 }}\n                    />\n                    <ChartTooltip\n                      content={<ChartTooltipContent />}\n                      labelStyle={{\n                        color: \"#1e293b\",\n                        fontWeight: 600,\n                        fontSize: 13,\n                        marginBottom: 4,\n                      }}\n                      contentStyle={{\n                        backgroundColor: \"rgba(255, 255, 255, 0.98)\",\n                        border: \"1px solid #e2e8f0\",\n                        borderRadius: \"12px\",\n                        boxShadow:\n                          \"0 10px 25px -5px rgb(0 0 0 / 0.15), 0 4px 6px -2px rgb(0 0 0 / 0.05)\",\n                        padding: \"12px 16px\",\n                        backdropFilter: \"blur(8px)\",\n                      }}\n                      cursor={{ fill: \"rgba(59, 130, 246, 0.05)\" }}\n                    />\n                    <Bar\n                      dataKey=\"value\"\n                      fill=\"url(#valueGradient)\"\n                      radius={[6, 6, 0, 0]}\n                      maxBarSize={50}\n                      stroke=\"#2563eb\"\n                      strokeWidth={1}\n                    />\n                  </BarChart>\n                </ResponsiveContainer>\n              </ChartContainer>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Data Tables */}\n      <div className=\"space-y-6\">\n        {concernType === \"inventoryValue\" && renderInventoryValueReport()}\n        {concernType === \"inOutInventory\" && renderInOutInventoryReport()}\n        {concernType === \"detailedInOutInventory\" &&\n          renderDetailedInOutInventoryReport()}\n        {concernType === \"disposal\" && renderDisposalReport()}\n      </div>\n    </div>\n  );\n}\n\nconst fetchInventoryData = async () => {\n    try {\n      const [productsResponse, categoriesResponse] = await Promise.all([\n        fetch('/api/products'),\n        fetch('/api/categories')\n      ]);\n\n      if (!productsResponse.ok || !categoriesResponse.ok) {\n        throw new Error('Failed to fetch data');\n      }\n\n      const products = await productsResponse.json();\n      const categories = await categoriesResponse.json();\n      const categoryMap = new Map(categories.map((c: any) => [c.id, c.name]));\n\n      return products.map((product: any) => ({\n        id: product.id,\n        name: product.name,\n        sku: product.sku,\n        category: categoryMap.get(product.categoryId) || 'Unknown',\n        stock: product.stock,\n        price: parseFloat(product.price),\n        value: product.stock * parseFloat(product.price),\n        lowStock: product.stock < 10, // Consider low stock if less than 10\n      }));\n    } catch (error) {\n      console.error('Error fetching inventory data:', error);\n      return [];\n    }\n  };","size_bytes":55509},"client/src/components/reports/menu-report.tsx":{"content":"\nimport { useState, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { BarChart3, TrendingUp, Package, DollarSign, Search, RefreshCw } from \"lucide-react\";\nimport { useTranslation } from \"@/lib/i18n\";\n\ninterface Product {\n  id: number;\n  name: string;\n  sku: string;\n  price: string;\n  stock: number;\n  categoryId: number;\n  categoryName?: string;\n  productType: number;\n  taxRate: string;\n  isActive: boolean;\n}\n\ninterface Category {\n  id: number;\n  name: string;\n  icon: string;\n}\n\ninterface MenuAnalysisData {\n  totalRevenue: number;\n  totalQuantity: number;\n  categoryStats: Array<{\n    categoryId: number;\n    categoryName: string;\n    totalQuantity: number;\n    totalRevenue: number;\n    productCount: number;\n  }>;\n  productStats: Array<{\n    productId: number;\n    productName: string;\n    totalQuantity: number;\n    totalRevenue: number;\n    averagePrice: number;\n  }>;\n  topSellingProducts: Array<{\n    productId: number;\n    productName: string;\n    totalQuantity: number;\n    totalRevenue: number;\n  }>;\n  topRevenueProducts: Array<{\n    productId: number;\n    productName: string;\n    totalQuantity: number;\n    totalRevenue: number;\n  }>;\n}\n\nfunction MenuReport() {\n  const { t } = useTranslation();\n  const [startDate, setStartDate] = useState(() => {\n    const today = new Date();\n    return today.toISOString().split('T')[0];\n  });\n  const [endDate, setEndDate] = useState(() => {\n    const today = new Date();\n    return today.toISOString().split('T')[0];\n  });\n  const [selectedCategory, setSelectedCategory] = useState<string>(\"all\");\n  const [productType, setProductType] = useState<string>(\"all\");\n  const [productSearch, setProductSearch] = useState(\"\");\n\n  // Query categories\n  const { data: categories = [] } = useQuery({\n    queryKey: [\"/api/categories\"],\n    queryFn: async () => {\n      try {\n        const response = await apiRequest(\"GET\", \"/api/categories\");\n        if (!response.ok) throw new Error(\"Failed to fetch categories\");\n        const data = await response.json();\n        return Array.isArray(data) ? data : [];\n      } catch (error) {\n        console.error(\"Error fetching categories:\", error);\n        return [];\n      }\n    },\n    retry: 2,\n  });\n\n  // Query products\n  const { data: products = [] } = useQuery({\n    queryKey: [\"/api/products\", selectedCategory, productType, productSearch],\n    queryFn: async () => {\n      try {\n        const searchParam = productSearch ? encodeURIComponent(productSearch) : \"\";\n        const response = await apiRequest(\n          \"GET\", \n          `/api/products/${selectedCategory}/${productType}/${searchParam}`\n        );\n        if (!response.ok) throw new Error(\"Failed to fetch products\");\n        const data = await response.json();\n        return Array.isArray(data) ? data : [];\n      } catch (error) {\n        console.error(\"Error fetching products:\", error);\n        return [];\n      }\n    },\n    retry: 2,\n  });\n\n  // Query menu analysis data\n  const { data: menuAnalysis, isLoading: analysisLoading, error: analysisError, refetch } = useQuery({\n    queryKey: [\"/api/menu-analysis\", startDate, endDate, selectedCategory],\n    queryFn: async () => {\n      try {\n        const params = new URLSearchParams({\n          startDate,\n          endDate,\n          ...(selectedCategory !== \"all\" && { categoryId: selectedCategory })\n        });\n        \n        const response = await apiRequest(\"GET\", `/api/menu-analysis?${params.toString()}`);\n        if (!response.ok) {\n          console.error(\"Menu analysis API error:\", response.status, response.statusText);\n          throw new Error(`Failed to fetch menu analysis: ${response.status}`);\n        }\n        \n        const data = await response.json();\n        console.log(\"Menu analysis data received:\", data);\n        \n        // Ensure data structure is correct\n        return {\n          totalRevenue: Number(data.totalRevenue || 0),\n          totalQuantity: Number(data.totalQuantity || 0),\n          categoryStats: Array.isArray(data.categoryStats) ? data.categoryStats : [],\n          productStats: Array.isArray(data.productStats) ? data.productStats : [],\n          topSellingProducts: Array.isArray(data.topSellingProducts) ? data.topSellingProducts : [],\n          topRevenueProducts: Array.isArray(data.topRevenueProducts) ? data.topRevenueProducts : [],\n        } as MenuAnalysisData;\n      } catch (error) {\n        console.error(\"Error fetching menu analysis:\", error);\n        // Return fallback data structure\n        return {\n          totalRevenue: 0,\n          totalQuantity: 0,\n          categoryStats: [],\n          productStats: [],\n          topSellingProducts: [],\n          topRevenueProducts: [],\n        } as MenuAnalysisData;\n      }\n    },\n    retry: 2,\n    retryDelay: 1000,\n  });\n\n  // Filter products for display\n  const filteredProducts = products.filter((product: Product) => {\n    if (!product || !product.name) return false;\n\n    const searchMatch = !productSearch || \n      product.name.toLowerCase().includes(productSearch.toLowerCase()) ||\n      (product.sku && product.sku.toLowerCase().includes(productSearch.toLowerCase()));\n      \n    const categoryMatch = selectedCategory === \"all\" || \n      product.categoryId === parseInt(selectedCategory);\n      \n    const typeMatch = productType === \"all\" ||\n      (productType === \"combo\" && product.productType === 3) ||\n      (productType === \"product\" && product.productType === 1) ||\n      (productType === \"service\" && product.productType === 2);\n\n    return searchMatch && categoryMatch && typeMatch;\n  });\n\n  const formatCurrency = (amount: number | string | undefined | null): string => {\n    const num = typeof amount === 'string' ? parseFloat(amount) : amount;\n    if (typeof num !== 'number' || isNaN(num)) {\n      return '0';\n    }\n    return Math.floor(num).toLocaleString('vi-VN');\n  };\n\n  const getProductTypeName = (type: number): string => {\n    switch (type) {\n      case 1: return t(\"reports.product\") || \"Sản phẩm\";\n      case 2: return t(\"reports.service\") || \"Dịch vụ\";\n      case 3: return t(\"reports.combo\") || \"Combo\";\n      default: return t(\"reports.product\") || \"Sản phẩm\";\n    }\n  };\n\n  const handleRefresh = () => {\n    refetch();\n  };\n\n  if (analysisError) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"text-center py-8\">\n          <div className=\"text-red-500 mb-4\">\n            <BarChart3 className=\"w-12 h-12 mx-auto mb-2\" />\n            <p className=\"font-medium\">Lỗi tải dữ liệu phân tích menu</p>\n          </div>\n          <p className=\"text-gray-500 mb-4\">\n            {analysisError instanceof Error ? analysisError.message : \"Không thể tải dữ liệu phân tích\"}\n          </p>\n          <Button onClick={handleRefresh} className=\"flex items-center gap-2\">\n            <RefreshCw className=\"w-4 h-4\" />\n            Thử lại\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Date Range and Filters */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-lg flex items-center gap-2\">\n            <BarChart3 className=\"w-5 h-5\" />\n            {t(\"reports.menuAnalysis\") || \"Phân tích menu\"}\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4\">\n            <div>\n              <label className=\"block text-sm font-medium mb-2\">\n                {t(\"reports.fromDate\") || \"Từ ngày\"}\n              </label>\n              <Input\n                type=\"date\"\n                value={startDate}\n                onChange={(e) => setStartDate(e.target.value)}\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium mb-2\">\n                {t(\"reports.toDate\") || \"Đến ngày\"}\n              </label>\n              <Input\n                type=\"date\"\n                value={endDate}\n                onChange={(e) => setEndDate(e.target.value)}\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium mb-2\">\n                {t(\"common.category\") || \"Danh mục\"}\n              </label>\n              <Select value={selectedCategory} onValueChange={setSelectedCategory}>\n                <SelectTrigger>\n                  <SelectValue placeholder={t(\"common.selectCategory\") || \"Chọn danh mục\"} />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">{t(\"common.all\") || \"Tất cả\"}</SelectItem>\n                  {categories.map((category: Category) => (\n                    <SelectItem key={category.id} value={category.id.toString()}>\n                      {category.name}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium mb-2\">\n                {t(\"reports.productType\") || \"Loại sản phẩm\"}\n              </label>\n              <Select value={productType} onValueChange={setProductType}>\n                <SelectTrigger>\n                  <SelectValue placeholder={t(\"common.selectType\") || \"Chọn loại\"} />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">{t(\"common.all\") || \"Tất cả\"}</SelectItem>\n                  <SelectItem value=\"product\">{t(\"reports.product\") || \"Sản phẩm\"}</SelectItem>\n                  <SelectItem value=\"combo\">{t(\"reports.combo\") || \"Combo\"}</SelectItem>\n                  <SelectItem value=\"service\">{t(\"reports.service\") || \"Dịch vụ\"}</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium mb-2\">\n                {t(\"common.search\") || \"Tìm kiếm\"}\n              </label>\n              <div className=\"relative\">\n                <Search className=\"absolute left-2 top-2.5 h-4 w-4 text-gray-400\" />\n                <Input\n                  placeholder={t(\"common.searchProduct\") || \"Tìm kiếm sản phẩm\"}\n                  value={productSearch}\n                  onChange={(e) => setProductSearch(e.target.value)}\n                  className=\"pl-8\"\n                />\n              </div>\n            </div>\n          </div>\n          <div className=\"mt-4\">\n            <Button onClick={handleRefresh} className=\"flex items-center gap-2\" disabled={analysisLoading}>\n              <RefreshCw className={`w-4 h-4 ${analysisLoading ? 'animate-spin' : ''}`} />\n              {analysisLoading ? \"Đang tải...\" : \"Cập nhật\"}\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Summary Statistics */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-gray-600\">\n                  {t(\"reports.totalRevenue\") || \"Tổng doanh thu\"}\n                </p>\n                <p className=\"text-2xl font-bold text-green-600\">\n                  {formatCurrency(menuAnalysis?.totalRevenue || 0)} ₫\n                </p>\n              </div>\n              <div className=\"w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center\">\n                <DollarSign className=\"w-4 h-4 text-green-600\" />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-gray-600\">\n                  {t(\"reports.totalSales\") || \"Tổng bán\"}\n                </p>\n                <p className=\"text-2xl font-bold text-blue-600\">\n                  {(menuAnalysis?.totalQuantity || 0).toLocaleString('vi-VN')}\n                </p>\n              </div>\n              <div className=\"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center\">\n                <Package className=\"w-4 h-4 text-blue-600\" />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-gray-600\">\n                  {t(\"reports.averagePrice\") || \"Giá trung bình\"}\n                </p>\n                <p className=\"text-2xl font-bold text-orange-600\">\n                  {formatCurrency(\n                    menuAnalysis?.totalQuantity && menuAnalysis.totalQuantity > 0\n                      ? menuAnalysis.totalRevenue / menuAnalysis.totalQuantity\n                      : 0\n                  )} ₫\n                </p>\n              </div>\n              <div className=\"w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center\">\n                <TrendingUp className=\"w-4 h-4 text-orange-600\" />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-gray-600\">\n                  {t(\"reports.uniqueProducts\") || \"Sản phẩm\"}\n                </p>\n                <p className=\"text-2xl font-bold text-purple-600\">\n                  {filteredProducts.length.toLocaleString('vi-VN')}\n                </p>\n              </div>\n              <div className=\"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center\">\n                <BarChart3 className=\"w-4 h-4 text-purple-600\" />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Category Performance */}\n      {menuAnalysis?.categoryStats && menuAnalysis.categoryStats.length > 0 && (\n        <Card>\n          <CardHeader>\n            <CardTitle>{t(\"reports.categoryPerformance\") || \"Hiệu suất danh mục\"}</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"overflow-x-auto\">\n              <table className=\"w-full min-w-[600px]\">\n                <thead>\n                  <tr className=\"border-b\">\n                    <th className=\"text-left py-2 px-4\">{t(\"common.category\") || \"Danh mục\"}</th>\n                    <th className=\"text-right py-2 px-4\">{t(\"reports.productCount\") || \"Số sản phẩm\"}</th>\n                    <th className=\"text-right py-2 px-4\">{t(\"reports.quantity\") || \"Số lượng\"}</th>\n                    <th className=\"text-right py-2 px-4\">{t(\"reports.revenue\") || \"Doanh thu\"}</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {menuAnalysis.categoryStats.map((category, index) => (\n                    <tr key={category.categoryId || index} className=\"border-b\">\n                      <td className=\"py-2 px-4 font-medium\">\n                        {category.categoryName || `Danh mục ${category.categoryId}`}\n                      </td>\n                      <td className=\"py-2 px-4 text-right\">\n                        {(category.productCount || 0).toLocaleString('vi-VN')}\n                      </td>\n                      <td className=\"py-2 px-4 text-right\">\n                        {(category.totalQuantity || 0).toLocaleString('vi-VN')}\n                      </td>\n                      <td className=\"py-2 px-4 text-right font-medium\">\n                        {formatCurrency(category.totalRevenue || 0)} ₫\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Top Products */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* Top Selling Products */}\n        {menuAnalysis?.topSellingProducts && menuAnalysis.topSellingProducts.length > 0 && (\n          <Card>\n            <CardHeader>\n              <CardTitle>{t(\"reports.topSellingItems\") || \"Sản phẩm bán chạy\"}</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-3\">\n                {menuAnalysis.topSellingProducts.slice(0, 10).map((product, index) => (\n                  <div key={product.productId || index} className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center\">\n                        <span className=\"text-sm font-bold text-blue-600\">{index + 1}</span>\n                      </div>\n                      <div>\n                        <p className=\"font-medium\">{product.productName || `Sản phẩm ${product.productId}`}</p>\n                        <p className=\"text-sm text-gray-500\">\n                          {(product.totalQuantity || 0).toLocaleString('vi-VN')} {t(\"common.sold\") || \"đã bán\"}\n                        </p>\n                      </div>\n                    </div>\n                    <div className=\"text-right\">\n                      <p className=\"font-medium\">{formatCurrency(product.totalRevenue || 0)} ₫</p>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Top Revenue Products */}\n        {menuAnalysis?.topRevenueProducts && menuAnalysis.topRevenueProducts.length > 0 && (\n          <Card>\n            <CardHeader>\n              <CardTitle>{t(\"reports.topRevenueItems\") || \"Sản phẩm doanh thu cao\"}</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-3\">\n                {menuAnalysis.topRevenueProducts.slice(0, 10).map((product, index) => (\n                  <div key={product.productId || index} className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center\">\n                        <span className=\"text-sm font-bold text-green-600\">{index + 1}</span>\n                      </div>\n                      <div>\n                        <p className=\"font-medium\">{product.productName || `Sản phẩm ${product.productId}`}</p>\n                        <p className=\"text-sm text-gray-500\">\n                          {(product.totalQuantity || 0).toLocaleString('vi-VN')} {t(\"common.sold\") || \"đã bán\"}\n                        </p>\n                      </div>\n                    </div>\n                    <div className=\"text-right\">\n                      <p className=\"font-medium text-green-600\">{formatCurrency(product.totalRevenue || 0)} ₫</p>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n\n      {/* Product List */}\n      <Card>\n        <CardHeader>\n          <CardTitle>{t(\"reports.menuItemAnalysis\") || \"Phân tích sản phẩm\"}</CardTitle>\n        </CardHeader>\n        <CardContent>\n          {analysisLoading ? (\n            <div className=\"text-center py-8\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto\"></div>\n              <p className=\"mt-2 text-gray-500\">Đang tải dữ liệu...</p>\n            </div>\n          ) : filteredProducts.length === 0 ? (\n            <div className=\"text-center py-8\">\n              <Package className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\n              <p className=\"text-gray-500\">{t(\"common.noData\") || \"Không có dữ liệu\"}</p>\n              <p className=\"text-sm text-gray-400 mt-2\">\n                Thử thay đổi bộ lọc để xem kết quả khác\n              </p>\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <table className=\"w-full min-w-[800px]\">\n                <thead>\n                  <tr className=\"border-b\">\n                    <th className=\"text-left py-2 px-4\">{t(\"common.product\") || \"Sản phẩm\"}</th>\n                    <th className=\"text-left py-2 px-4\">{t(\"common.sku\") || \"SKU\"}</th>\n                    <th className=\"text-left py-2 px-4\">{t(\"common.category\") || \"Danh mục\"}</th>\n                    <th className=\"text-left py-2 px-4\">{t(\"common.type\") || \"Loại\"}</th>\n                    <th className=\"text-right py-2 px-4\">{t(\"common.price\") || \"Giá\"}</th>\n                    <th className=\"text-right py-2 px-4\">{t(\"common.stock\") || \"Tồn kho\"}</th>\n                    <th className=\"text-center py-2 px-4\">{t(\"common.status\") || \"Trạng thái\"}</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {filteredProducts.map((product: Product) => {\n                    const category = categories.find((c: Category) => c.id === product.categoryId);\n                    return (\n                      <tr key={product.id} className=\"border-b hover:bg-gray-50\">\n                        <td className=\"py-2 px-4 font-medium\">{product.name}</td>\n                        <td className=\"py-2 px-4 font-mono text-sm\">{product.sku}</td>\n                        <td className=\"py-2 px-4\">{category?.name || 'N/A'}</td>\n                        <td className=\"py-2 px-4\">\n                          <Badge variant=\"outline\">\n                            {getProductTypeName(product.productType)}\n                          </Badge>\n                        </td>\n                        <td className=\"py-2 px-4 text-right font-medium\">\n                          {formatCurrency(product.price)} ₫\n                        </td>\n                        <td className=\"py-2 px-4 text-right\">\n                          <span className={`${product.stock <= 10 ? 'text-red-600' : 'text-gray-900'}`}>\n                            {product.stock}\n                          </span>\n                        </td>\n                        <td className=\"py-2 px-4 text-center\">\n                          <Badge variant={product.isActive ? \"default\" : \"secondary\"}>\n                            {product.isActive ? t(\"common.active\") || \"Hoạt động\" : t(\"common.inactive\") || \"Không hoạt động\"}\n                          </Badge>\n                        </td>\n                      </tr>\n                    );\n                  })}\n                </tbody>\n              </table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\nexport default MenuReport;\nexport { MenuReport };\n","size_bytes":23224},"client/src/components/reports/order-report.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { FileText, TrendingUp, Package, Users, Search } from \"lucide-react\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n} from \"@/components/ui/chart\";\nimport {\n  BarChart,\n  Bar,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  ResponsiveContainer,\n  PieChart,\n  Pie,\n  Cell,\n} from \"recharts\";\n\nexport function OrderReport() {\n  const { t } = useTranslation();\n\n  // Filters\n  const [concernType, setConcernType] = useState(\"transaction\");\n  const [startDate, setStartDate] = useState<string>(\n    new Date().toISOString().split(\"T\")[0]\n  );\n  const [endDate, setEndDate] = useState<string>(\n    new Date().toISOString().split(\"T\")[0]\n  );\n  const [orderStatus, setOrderStatus] = useState(\"all\");\n  const [customerSearch, setCustomerSearch] = useState(\"\");\n  const [productSearch, setProductSearch] = useState(\"\");\n  const [selectedCategory, setSelectedCategory] = useState(\"all\");\n  const [selectedEmployee, setSelectedEmployee] = useState(\"all\");\n\n  const { data: orders } = useQuery({\n    queryKey: [\"/api/orders\"],\n  });\n\n  const { data: products } = useQuery({\n    queryKey: [\"/api/products\"],\n  });\n\n  const { data: categories } = useQuery({\n    queryKey: [\"/api/categories\"],\n  });\n\n  const { data: employees } = useQuery({\n    queryKey: [\"/api/employees\"],\n  });\n\n  const getFilteredData = () => {\n    if (!orders || !Array.isArray(orders)) return [];\n\n    const filteredOrders = orders.filter((order: any) => {\n      const orderDate = new Date(order.orderedAt || order.created_at);\n      const start = new Date(startDate);\n      const end = new Date(endDate);\n      end.setHours(23, 59, 59, 999);\n\n      const dateMatch = orderDate >= start && orderDate <= end;\n\n      const statusMatch =\n        orderStatus === \"all\" ||\n        (orderStatus === \"draft\" && order.status === \"pending\") ||\n        (orderStatus === \"confirmed\" && order.status === \"confirmed\") ||\n        (orderStatus === \"delivering\" && order.status === \"preparing\") ||\n        (orderStatus === \"completed\" && order.status === \"paid\");\n\n      const customerMatch =\n        !customerSearch ||\n        (order.customerName &&\n          order.customerName\n            .toLowerCase()\n            .includes(customerSearch.toLowerCase())) ||\n        (order.customerPhone &&\n          order.customerPhone.includes(customerSearch));\n\n      return dateMatch && statusMatch && customerMatch;\n    });\n\n    return filteredOrders;\n  };\n\n  const formatCurrency = (amount: number) => {\n    return `${amount.toLocaleString()} ₫`;\n  };\n\n  const formatDate = (dateStr: string) => {\n    return new Date(dateStr).toLocaleDateString(\"vi-VN\", {\n      day: \"2-digit\",\n      month: \"2-digit\",\n      year: \"numeric\",\n    });\n  };\n\n  const getStatusBadge = (status: string) => {\n    const statusMap = {\n      pending: { label: t(\"reports.draft\"), variant: \"secondary\" as const },\n      confirmed: { label: t(\"reports.confirmed\"), variant: \"default\" as const },\n      preparing: { label: t(\"reports.delivering\"), variant: \"outline\" as const },\n      served: { label: t(\"orders.status.served\"), variant: \"default\" as const },\n      paid: { label: t(\"reports.completed\"), variant: \"default\" as const },\n    };\n    return statusMap[status as keyof typeof statusMap] || { label: status, variant: \"secondary\" as const };\n  };\n\n  const getProductData = () => {\n    const filteredOrders = getFilteredData();\n    const productStats: {\n      [productId: string]: {\n        product: any;\n        quantity: number;\n        value: number;\n        orders: Set<number>;\n      };\n    } = {};\n\n    if (!products || !Array.isArray(products)) return [];\n\n    // For each filtered order, estimate product sales based on order total\n    // In a real system, this would come from order_items table\n    filteredOrders.forEach((order: any) => {\n      const orderTotal = Number(order.total);\n\n      // Simulate order items by distributing order total among available products\n      // In a real system, this would come from order_items table\n      const randomProductsCount = Math.min(Math.floor(Math.random() * 3) + 1, products.length);\n      const selectedProducts = products\n        .sort(() => 0.5 - Math.random())\n        .slice(0, randomProductsCount);\n\n      const avgValuePerProduct = orderTotal / selectedProducts.length;\n\n      selectedProducts.forEach((product: any) => {\n        const productId = product.id.toString();\n        if (!productStats[productId]) {\n          productStats[productId] = {\n            product,\n            quantity: 0,\n            value: 0,\n            orders: new Set(),\n          };\n        }\n\n        const quantity = Math.floor(Math.random() * 3) + 1;\n        productStats[productId].quantity += quantity;\n        productStats[productId].value += avgValuePerProduct;\n        productStats[productId].orders.add(order.id);\n      });\n    });\n\n    return Object.values(productStats).filter(stat => stat.quantity > 0);\n  };\n\n  const getChartData = () => {\n    const filteredOrders = getFilteredData();\n\n    if (concernType === \"transaction\") {\n      // Daily order count chart\n      const dailyData: { [date: string]: { orders: number; value: number } } = {};\n\n      filteredOrders.forEach((order: any) => {\n        const date = new Date(order.orderedAt || order.created_at).toISOString().split('T')[0];\n        if (!dailyData[date]) {\n          dailyData[date] = { orders: 0, value: 0 };\n        }\n        dailyData[date].orders += 1;\n        dailyData[date].value += Number(order.total);\n      });\n\n      return Object.entries(dailyData).map(([date, data]) => ({\n        name: formatDate(date),\n        orders: data.orders,\n        value: data.value,\n      }));\n    } else {\n      // Product quantity chart\n      const productData = getProductData();\n      return productData.slice(0, 10).map(item => ({\n        name: item.product.name,\n        quantity: item.quantity,\n        value: item.value,\n      }));\n    }\n  };\n\n  const renderTransactionTable = () => {\n    const filteredOrders = getFilteredData();\n\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <FileText className=\"w-5 h-5\" />\n            {t(\"reports.orderReportByTransaction\")}\n          </CardTitle>\n          <CardDescription>\n            {t(\"reports.fromDate\")}: {formatDate(startDate)} - {t(\"reports.toDate\")}: {formatDate(endDate)}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.orderCode\")}\n                </TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.orderTime\")}\n                </TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.customer\")}\n                </TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.orderQuantity\")}\n                </TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.orderValue\")}\n                </TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.orderStatus\")}\n                </TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {filteredOrders.length > 0 ? (\n                filteredOrders.slice(0, 20).map((order: any) => {\n                  const statusConfig = getStatusBadge(order.status);\n                  return (\n                    <TableRow key={order.id}>\n                      <TableCell className=\"text-center font-medium\">\n                        {order.orderNumber || `ORD-${order.id}`}\n                      </TableCell>\n                      <TableCell className=\"text-center\">\n                        {new Date(order.orderedAt || order.created_at).toLocaleString(\"vi-VN\")}\n                      </TableCell>\n                      <TableCell className=\"text-center\">\n                        {order.customerName || \"Khách lẻ\"}\n                      </TableCell>\n                      <TableCell className=\"text-center\">\n                        {order.customerCount || 1}\n                      </TableCell>\n                      <TableCell className=\"text-right text-green-600\">\n                        {formatCurrency(Number(order.total))}\n                      </TableCell>\n                      <TableCell className=\"text-center\">\n                        <Badge variant={statusConfig.variant}>\n                          {statusConfig.label}\n                        </Badge>\n                      </TableCell>\n                    </TableRow>\n                  );\n                })\n              ) : (\n                <TableRow>\n                  <TableCell colSpan={6} className=\"text-center text-gray-500 italic\">\n                    {t(\"reports.noReportData\")}\n                  </TableCell>\n                </TableRow>\n              )}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    );\n  };\n\n  const renderProductTable = () => {\n    const productData = getProductData();\n\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Package className=\"w-5 h-5\" />\n            {t(\"reports.orderReportByProduct\")}\n          </CardTitle>\n          <CardDescription>\n            {t(\"reports.fromDate\")}: {formatDate(startDate)} - {t(\"reports.toDate\")}: {formatDate(endDate)}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.productCode\")}\n                </TableHead>\n                <TableHead>{t(\"reports.productName\")}</TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.quantity\")}\n                </TableHead>\n                <TableHead className=\"text-center\">\n                  {t(\"reports.totalAmount\")}\n                </TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {productData.length > 0 ? (\n                productData.slice(0, 20).map((item, index) => (\n                  <TableRow key={index}>\n                    <TableCell className=\"text-center font-medium\">\n                      {item.product.sku || item.product.id}\n                    </TableCell>\n                    <TableCell>{item.product.name}</TableCell>\n                    <TableCell className=\"text-center\">{item.quantity}</TableCell>\n                    <TableCell className=\"text-right text-green-600\">\n                      {formatCurrency(item.value)}\n                    </TableCell>\n                  </TableRow>\n                ))\n              ) : (\n                <TableRow>\n                  <TableCell colSpan={4} className=\"text-center text-gray-500 italic\">\n                    {t(\"reports.noReportData\")}\n                  </TableCell>\n                </TableRow>\n              )}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    );\n  };\n\n  const chartConfig = {\n    orders: {\n      label: t(\"reports.orders\"),\n      color: \"#10b981\",\n    },\n    value: {\n      label: t(\"reports.totalAmount\"),\n      color: \"#3b82f6\",\n    },\n    quantity: {\n      label: t(\"reports.quantity\"),\n      color: \"#f59e0b\",\n    },\n  };\n\n  // Modified fetchOrderData function to use real data from API\n  const fetchOrderData = async () => {\n    try {\n      const response = await fetch('/api/orders');\n      if (!response.ok) throw new Error('Failed to fetch orders');\n      const orders = await response.json();\n\n      // Get table data to map table names\n      const tablesResponse = await fetch('/api/tables');\n      const tables = await tablesResponse.json();\n      const tableMap = new Map(tables.map((t: any) => [t.id, t.tableNumber]));\n\n      return orders.map((order: any) => ({\n        id: order.id,\n        orderNumber: order.orderNumber,\n        customerName: order.customerName || 'Khách lẻ',\n        tableNumber: tableMap.get(order.tableId) || 'Unknown',\n        total: parseFloat(order.total),\n        status: order.status,\n        createdAt: order.orderedAt,\n      }));\n    } catch (error) {\n      console.error('Error fetching order data:', error);\n      return [];\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <FileText className=\"w-5 h-5\" />\n            {t(\"reports.purchaseTab\")}\n          </CardTitle>\n          <CardDescription>\n            {t(\"reports.orderReportDescription\")}\n          </CardDescription>\n        </CardHeader>\n      </Card>\n\n      {/* Filters */}\n      <Card>\n        <CardContent className=\"space-y-4 pt-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4\">\n            {/* Concern Type */}\n            <div>\n              <Label>{t(\"reports.orderConcernType\")}</Label>\n              <Select value={concernType} onValueChange={setConcernType}>\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"transaction\">\n                    {t(\"reports.transactionConcern\")}\n                  </SelectItem>\n                  <SelectItem value=\"product\">\n                    {t(\"reports.productConcern\")}\n                  </SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* Order Status */}\n            <div>\n              <Label>{t(\"reports.status\")}</Label>\n              <Select value={orderStatus} onValueChange={setOrderStatus}>\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">{t(\"common.all\")}</SelectItem>\n                  <SelectItem value=\"draft\">{t(\"reports.draft\")}</SelectItem>\n                  <SelectItem value=\"confirmed\">{t(\"reports.confirmed\")}</SelectItem>\n                  <SelectItem value=\"delivering\">{t(\"reports.delivering\")}</SelectItem>\n                  <SelectItem value=\"completed\">{t(\"reports.completed\")}</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* Product Group */}\n            <div>\n              <Label>{t(\"reports.productGroup\")}</Label>\n              <Select value={selectedCategory} onValueChange={setSelectedCategory}>\n                <SelectTrigger>\n                  <SelectValue placeholder={t(\"reports.productGroup\")} />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">{t(\"common.all\")}</SelectItem>\n                  {categories &&\n                    Array.isArray(categories) &&\n                    categories.map((category: any) => (\n                      <SelectItem key={category.id} value={category.id.toString()}>\n                        {category.name}\n                      </SelectItem>\n                    ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* Employee */}\n            <div>\n              <Label>{t(\"reports.employee\")}</Label>\n              <Select value={selectedEmployee} onValueChange={setSelectedEmployee}>\n                <SelectTrigger>\n                  <SelectValue placeholder={t(\"reports.employee\")} />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">{t(\"common.all\")}</SelectItem>\n                  {employees &&\n                    Array.isArray(employees) &&\n                    employees.map((employee: any) => (\n                      <SelectItem key={employee.id} value={employee.id.toString()}>\n                        {employee.name}\n                      </SelectItem>\n                    ))}\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n\n          {/* Date Range */}\n          <div className=\"grid grid-cols-1 md:grid-cols-5 gap-4\">\n            <div>\n              <Label>{t(\"reports.startDate\")}</Label>\n              <Input\n                type=\"date\"\n                value={startDate}\n                onChange={(e) => setStartDate(e.target.value)}\n              />\n            </div>\n            <div>\n              <Label>{t(\"reports.endDate\")}</Label>\n              <Input\n                type=\"date\"\n                value={endDate}\n                onChange={(e) => setEndDate(e.target.value)}\n              />\n            </div>\n          </div>\n\n          {/* Search Fields */}\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div>\n              <Label>{t(\"reports.customerSearch\")}</Label>\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                <Input\n                  placeholder={t(\"reports.customerSearchPlaceholder\")}\n                  value={customerSearch}\n                  onChange={(e) => setCustomerSearch(e.target.value)}\n                  className=\"pl-10\"\n                />\n              </div>\n            </div>\n            <div>\n              <Label>{t(\"reports.productSearch\")}</Label>\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                <Input\n                  placeholder={t(\"reports.productSearchPlaceholder\")}\n                  value={productSearch}\n                  onChange={(e) => setProductSearch(e.target.value)}\n                  className=\"pl-10\"\n                />\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Chart Display */}\n      <Card className=\"shadow-xl border-0 bg-gradient-to-br from-blue-50/50 to-indigo-50/30\">\n        <CardHeader className=\"bg-gradient-to-r from-blue-600 to-indigo-600 rounded-t-lg\">\n          <CardTitle className=\"flex items-center gap-3 text-lg font-semibold\">\n            <div className=\"p-2 bg-white/20 rounded-lg\">\n              <TrendingUp className=\"w-6 h-6\" />\n            </div>\n            <div>\n              <div className=\"text-white/90 text-sm font-normal\">\n                {t(\"reports.chartView\")}\n              </div>\n              <div className=\"text-white font-semibold\">\n                {concernType === \"transaction\" ? t(\"reports.transactionConcern\") : t(\"reports.productConcern\")}\n              </div>\n            </div>\n          </CardTitle>\n          <CardDescription className=\"text-blue-100 mt-2\">\n            {t(\"reports.visualRepresentation\")} - {t(\"reports.fromDate\")}: {formatDate(startDate)} {t(\"reports.toDate\")}: {formatDate(endDate)}\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"p-8 bg-white/80 backdrop-blur-sm\">\n          <div className=\"h-[450px] w-full bg-white/90 rounded-xl border-0 shadow-lg p-6 relative overflow-hidden\">\n            {/* Background decoration */}\n            <div className=\"absolute inset-0 bg-gradient-to-br from-blue-50/30 to-indigo-50/20 rounded-xl\"></div>\n            <div className=\"absolute top-4 right-4 flex items-center gap-2 text-sm text-gray-500\">\n              <div className=\"w-2 h-2 rounded-full bg-green-500 animate-pulse\"></div>\n              Live Data\n            </div>\n\n            <div className=\"relative z-10 h-full\">\n              <ChartContainer config={chartConfig}>\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <BarChart\n                    data={getChartData()}\n                    margin={{ top: 30, right: 40, left: 30, bottom: 90 }}\n                    barCategoryGap=\"25%\"\n                  >\n                    <defs>\n                      <linearGradient id=\"orderGradient\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                        <stop offset=\"0%\" stopColor=\"#10b981\" stopOpacity={0.9} />\n                        <stop offset=\"100%\" stopColor=\"#10b981\" stopOpacity={0.6} />\n                      </linearGradient>\n                      <linearGradient id=\"valueGradient\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                        <stop offset=\"0%\" stopColor=\"#3b82f6\" stopOpacity={0.9} />\n                        <stop offset=\"100%\" stopColor=\"#3b82f6\" stopOpacity={0.6} />\n                      </linearGradient>\n                      <linearGradient id=\"quantityGradient\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                        <stop offset=\"0%\" stopColor=\"#f59e0b\" stopOpacity={0.9} />\n                        <stop offset=\"100%\" stopColor=\"#f59e0b\" stopOpacity={0.6} />\n                      </linearGradient>\n                    </defs>\n                    <CartesianGrid\n                      strokeDasharray=\"2 4\"\n                      stroke=\"#e2e8f0\"\n                      opacity={0.4}\n                      horizontal={true}\n                      vertical={false}\n                    />\n                    <XAxis\n                      dataKey=\"name\"\n                      tick={{ fontSize: 12, fill: \"#475569\", fontWeight: 500 }}\n                      angle={-35}\n                      textAnchor=\"end\"\n                      height={85}\n                      interval={0}\n                      tickMargin={12}\n                      axisLine={{ stroke: \"#cbd5e1\", strokeWidth: 1 }}\n                      tickLine={{ stroke: \"#cbd5e1\", strokeWidth: 1 }}\n                    />\n                    <YAxis\n                      tick={{ fontSize: 12, fill: \"#475569\", fontWeight: 500 }}\n                      tickFormatter={(value) => {\n                        if (value >= 1000000) {\n                          return `${(value / 1000000).toFixed(1)}M`;\n                        } else if (value >= 1000) {\n                          return `${(value / 1000).toFixed(0)}K`;\n                        }\n                        return value.toString();\n                      }}\n                      width={70}\n                      axisLine={{ stroke: \"#cbd5e1\", strokeWidth: 1 }}\n                      tickLine={{ stroke: \"#cbd5e1\", strokeWidth: 1 }}\n                    />\n                    <ChartTooltip\n                      content={<ChartTooltipContent />}\n                      labelStyle={{\n                        color: \"#1e293b\",\n                        fontWeight: 600,\n                        fontSize: 13,\n                        marginBottom: 4\n                      }}\n                      contentStyle={{\n                        backgroundColor: \"rgba(255, 255, 255, 0.98)\",\n                        border: \"1px solid #e2e8f0\",\n                        borderRadius: \"12px\",\n                        boxShadow: \"0 10px 25px -5px rgb(0 0 0 / 0.15), 0 4px 6px -2px rgb(0 0 0 / 0.05)\",\n                        padding: \"12px 16px\",\n                        backdropFilter: \"blur(8px)\"\n                      }}\n                      cursor={{ fill: \"rgba(59, 130, 246, 0.05)\" }}\n                    />\n                    {concernType === \"transaction\" ? (\n                      <>\n                        <Bar\n                          dataKey=\"orders\"\n                          fill=\"url(#orderGradient)\"\n                          radius={[6, 6, 0, 0]}\n                          maxBarSize={45}\n                          stroke=\"#059669\"\n                          strokeWidth={1}\n                        />\n                        <Bar\n                          dataKey=\"value\"\n                          fill=\"url(#valueGradient)\"\n                          radius={[6, 6, 0, 0]}\n                          maxBarSize={45}\n                          stroke=\"#2563eb\"\n                          strokeWidth={1}\n                        />\n                      </>\n                    ) : (\n                      <Bar\n                        dataKey=\"quantity\"\n                        fill=\"url(#quantityGradient)\"\n                        radius={[6, 6, 0, 0]}\n                        maxBarSize={50}\n                        stroke=\"#d97706\"\n                        strokeWidth={1}\n                      />\n                    )}\n                  </BarChart>\n                </ResponsiveContainer>\n              </ChartContainer>\n            </div>\n          </div>\n\n          {/* Enhanced Chart Legend */}\n          <div className=\"mt-6 flex flex-wrap justify-center gap-6\">\n            {concernType === \"transaction\" ? (\n              <>\n                <div className=\"flex items-center gap-3 px-4 py-2 bg-green-50 rounded-lg border border-green-200\">\n                  <div className=\"w-4 h-4 rounded bg-gradient-to-b from-emerald-400 to-emerald-600 shadow-sm\"></div>\n                  <span className=\"text-sm font-medium text-green-800\">\n                    {t(\"reports.orders\")}\n                  </span>\n                </div>\n                <div className=\"flex items-center gap-3 px-4 py-2 bg-blue-50 rounded-lg border border-blue-200\">\n                  <div className=\"w-4 h-4 rounded bg-gradient-to-b from-blue-400 to-blue-600 shadow-sm\"></div>\n                  <span className=\"text-sm font-medium text-blue-800\">\n                    {t(\"reports.totalAmount\")}\n                  </span>\n                </div>\n              </>\n            ) : (\n              <div className=\"flex items-center gap-3 px-4 py-2 bg-amber-50 rounded-lg border border-amber-200\">\n                <div className=\"w-4 h-4 rounded bg-gradient-to-b from-amber-400 to-amber-600 shadow-sm\"></div>\n                <span className=\"text-sm font-medium text-amber-800\">\n                  {t(\"reports.quantity\")}\n                </span>\n              </div>\n            )}\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Data Tables */}\n      <div className=\"space-y-6\">\n        {concernType === \"transaction\" ? renderTransactionTable() : renderProductTable()}\n      </div>\n    </div>\n  );\n}","size_bytes":26670},"client/src/components/reports/sales-channel-report.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  BarChart,\n  Bar,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  Legend,\n  ResponsiveContainer,\n} from \"recharts\";\nimport { TrendingUp, Search, Calendar, Filter } from \"lucide-react\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n} from \"@/components/ui/chart\";\n\nexport function SalesChannelReport() {\n  const { t } = useTranslation();\n\n  // Filters\n  const [concernType, setConcernType] = useState(\"sales\");\n  const [startDate, setStartDate] = useState<string>(\n    new Date().toISOString().split(\"T\")[0]\n  );\n  const [endDate, setEndDate] = useState<string>(\n    new Date().toISOString().split(\"T\")[0]\n  );\n  const [selectedSeller, setSelectedSeller] = useState(\"all\");\n  const [selectedSalesChannel, setSelectedSalesChannel] = useState(\"all\");\n  const [productSearch, setProductSearch] = useState(\"\");\n  const [productType, setProductType] = useState(\"all\");\n  const [selectedCategory, setSelectedCategory] = useState(\"all\");\n\n  const { data: employees } = useQuery({\n    queryKey: [\"/api/employees\"],\n    staleTime: 5 * 60 * 1000,\n  });\n\n  const { data: categories } = useQuery({\n    queryKey: [\"/api/categories\"],\n    staleTime: 5 * 60 * 1000,\n  });\n\n  // Sales channel sales data query\n  const { data: salesChannelSalesData, isLoading: salesLoading } = useQuery({\n    queryKey: [\n      \"/api/sales-channel-sales\",\n      startDate,\n      endDate,\n      selectedSeller,\n      selectedSalesChannel,\n    ],\n    queryFn: async () => {\n      const params = new URLSearchParams({\n        startDate,\n        endDate,\n        ...(selectedSeller !== \"all\" && { sellerId: selectedSeller }),\n        ...(selectedSalesChannel !== \"all\" && {\n          salesChannel: selectedSalesChannel,\n        }),\n      });\n      const response = await fetch(`/api/sales-channel-sales?${params}`);\n      if (!response.ok) {\n        throw new Error(\"Failed to fetch sales channel sales data\");\n      }\n      return response.json();\n    },\n    staleTime: 2 * 60 * 1000,\n  });\n\n  // Sales channel profit data query\n  const { data: salesChannelProfitData, isLoading: profitLoading } = useQuery({\n    queryKey: [\n      \"/api/sales-channel-profit\",\n      startDate,\n      endDate,\n      selectedSeller,\n      selectedSalesChannel,\n    ],\n    queryFn: async () => {\n      const params = new URLSearchParams({\n        startDate,\n        endDate,\n        ...(selectedSeller !== \"all\" && { sellerId: selectedSeller }),\n        ...(selectedSalesChannel !== \"all\" && {\n          salesChannel: selectedSalesChannel,\n        }),\n      });\n      const response = await fetch(`/api/sales-channel-profit?${params}`);\n      if (!response.ok) {\n        throw new Error(\"Failed to fetch sales channel profit data\");\n      }\n      return response.json();\n    },\n    staleTime: 2 * 60 * 1000,\n  });\n\n  // Sales channel products data query\n  const { data: salesChannelProductsData, isLoading: productsLoading } =\n    useQuery({\n      queryKey: [\n        \"/api/sales-channel-products\",\n        startDate,\n        endDate,\n        selectedSeller,\n        selectedSalesChannel,\n        productSearch,\n        productType,\n        selectedCategory,\n      ],\n      queryFn: async () => {\n        const params = new URLSearchParams({\n          startDate,\n          endDate,\n          ...(selectedSeller !== \"all\" && { sellerId: selectedSeller }),\n          ...(selectedSalesChannel !== \"all\" && {\n            salesChannel: selectedSalesChannel,\n          }),\n          ...(productSearch && { search: productSearch }),\n          ...(productType !== \"all\" && { productType }),\n          ...(selectedCategory !== \"all\" && { categoryId: selectedCategory }),\n        });\n        const response = await fetch(`/api/sales-channel-products?${params}`);\n        if (!response.ok) {\n          throw new Error(\"Failed to fetch sales channel products data\");\n        }\n        return response.json();\n      },\n      staleTime: 2 * 60 * 1000,\n    });\n\n  const formatCurrency = (amount: number) => {\n    return `${amount.toLocaleString()} ₫`;\n  };\n\n  const formatDate = (dateStr: string) => {\n    return new Date(dateStr).toLocaleDateString(\"vi-VN\", {\n      day: \"2-digit\",\n      month: \"2-digit\",\n      year: \"numeric\",\n    });\n  };\n\n  const getReportTitle = () => {\n    const concernTypes = {\n      sales: t(\"reports.salesBySalesChannel\"),\n      profit: t(\"reports.profitBySalesChannel\"),\n      products: t(\"reports.productsBySalesChannel\"),\n    };\n    return (\n      concernTypes[concernType as keyof typeof concernTypes] ||\n      t(\"reports.channelSalesReport\")\n    );\n  };\n\n  const getChartData = () => {\n    if (concernType === \"sales\") {\n      if (\n        !salesChannelSalesData ||\n        !Array.isArray(salesChannelSalesData) ||\n        salesChannelSalesData.length === 0\n      ) {\n        return [];\n      }\n      return salesChannelSalesData.map((item: any) => ({\n        name: item.salesChannelName || \"N/A\",\n        revenue: item.revenue || 0,\n        returnValue: item.returnValue || 0,\n        netRevenue: item.netRevenue || 0,\n      }));\n    } else if (concernType === \"profit\") {\n      if (\n        !salesChannelProfitData ||\n        !Array.isArray(salesChannelProfitData) ||\n        salesChannelProfitData.length === 0\n      ) {\n        return [];\n      }\n      return salesChannelProfitData.map((item: any) => ({\n        name: item.salesChannelName || \"N/A\",\n        grossProfit: item.grossProfit || 0,\n        netProfit: item.netProfit || 0,\n        platformFee: item.platformFee || 0,\n      }));\n    }\n    return [];\n  };\n\n  const renderSalesTable = () => {\n    if (salesLoading) {\n      return (\n        <div className=\"flex justify-center py-8\">\n          <div className=\"text-gray-500\">{t(\"reports.loading\")}</div>\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"overflow-x-auto\">\n        <Table>\n          <TableHeader>\n            <TableRow>\n              <TableHead className=\"min-w-[150px]\">\n                {t(\"reports.salesChannelFilter\")}\n              </TableHead>\n              <TableHead className=\"text-right min-w-[120px]\">\n                {t(\"reports.salesChannelRevenue\")}\n              </TableHead>\n              <TableHead className=\"text-right min-w-[120px]\">\n                {t(\"reports.salesChannelReturnValue\")}\n              </TableHead>\n              <TableHead className=\"text-right min-w-[120px]\">\n                {t(\"reports.salesChannelNetRevenue\")}\n              </TableHead>\n            </TableRow>\n          </TableHeader>\n          <TableBody>\n            {salesChannelSalesData &&\n            Array.isArray(salesChannelSalesData) &&\n            salesChannelSalesData.length > 0 ? (\n              salesChannelSalesData.map((item: any, index: number) => (\n                <TableRow key={item.id || index}>\n                  <TableCell className=\"font-medium\">\n                    <div>\n                      <div className=\"font-semibold\">\n                        {item.salesChannelName || \"N/A\"}\n                      </div>\n                      {item.sellerName && (\n                        <div className=\"text-sm text-gray-500\">\n                          {item.sellerName}\n                        </div>\n                      )}\n                    </div>\n                  </TableCell>\n                  <TableCell className=\"text-right\">\n                    {formatCurrency(item.revenue || 0)}\n                  </TableCell>\n                  <TableCell className=\"text-right\">\n                    {formatCurrency(item.returnValue || 0)}\n                  </TableCell>\n                  <TableCell className=\"text-right font-semibold text-green-600\">\n                    {formatCurrency(item.netRevenue || 0)}\n                  </TableCell>\n                </TableRow>\n              ))\n            ) : (\n              <TableRow>\n                <TableCell\n                  colSpan={4}\n                  className=\"text-center py-8 text-gray-500\"\n                >\n                  {t(\"reports.noReportData\")}\n                </TableCell>\n              </TableRow>\n            )}\n          </TableBody>\n        </Table>\n      </div>\n    );\n  };\n\n  const renderProfitTable = () => {\n    if (profitLoading) {\n      return (\n        <div className=\"flex justify-center py-8\">\n          <div className=\"text-gray-500\">{t(\"reports.loading\")}</div>\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"overflow-x-auto\">\n        <Table>\n          <TableHeader>\n            <TableRow>\n              <TableHead className=\"min-w-[150px]\">\n                {t(\"reports.salesChannelFilter\")}\n              </TableHead>\n              <TableHead className=\"text-right min-w-[100px]\">\n                {t(\"reports.salesChannelTotalAmount\")}\n              </TableHead>\n              <TableHead className=\"text-right min-w-[100px]\">\n                {t(\"reports.salesChannelDiscount\")}\n              </TableHead>\n              <TableHead className=\"text-right min-w-[100px]\">\n                {t(\"reports.salesChannelRevenue\")}\n              </TableHead>\n              <TableHead className=\"text-right min-w-[100px]\">\n                {t(\"reports.salesChannelReturnValue\")}\n              </TableHead>\n              <TableHead className=\"text-right min-w-[100px]\">\n                {t(\"reports.salesChannelNetRevenue\")}\n              </TableHead>\n              <TableHead className=\"text-right min-w-[100px]\">\n                {t(\"reports.salesChannelTotalCost\")}\n              </TableHead>\n              <TableHead className=\"text-right min-w-[100px]\">\n                {t(\"reports.salesChannelGrossProfit\")}\n              </TableHead>\n              <TableHead className=\"text-right min-w-[100px]\">\n                {t(\"reports.salesChannelFee\")}\n              </TableHead>\n              <TableHead className=\"text-right min-w-[100px]\">\n                {t(\"reports.salesChannelNetProfit\")}\n              </TableHead>\n            </TableRow>\n          </TableHeader>\n          <TableBody>\n            {salesChannelProfitData &&\n            Array.isArray(salesChannelProfitData) &&\n            salesChannelProfitData.length > 0 ? (\n              salesChannelProfitData.map((item: any, index: number) => (\n                <TableRow key={item.id || index}>\n                  <TableCell className=\"font-medium\">\n                    <div>\n                      <div className=\"font-semibold\">\n                        {item.salesChannelName || \"N/A\"}\n                      </div>\n                      {item.sellerName && (\n                        <div className=\"text-sm text-gray-500\">\n                          {item.sellerName}\n                        </div>\n                      )}\n                    </div>\n                  </TableCell>\n                  <TableCell className=\"text-right\">\n                    {formatCurrency(item.totalAmount || 0)}\n                  </TableCell>\n                  <TableCell className=\"text-right\">\n                    {formatCurrency(item.discount || 0)}\n                  </TableCell>\n                  <TableCell className=\"text-right\">\n                    {formatCurrency(item.revenue || 0)}\n                  </TableCell>\n                  <TableCell className=\"text-right\">\n                    {formatCurrency(item.returnValue || 0)}\n                  </TableCell>\n                  <TableCell className=\"text-right\">\n                    {formatCurrency(item.netRevenue || 0)}\n                  </TableCell>\n                  <TableCell className=\"text-right\">\n                    {formatCurrency(item.totalCost || 0)}\n                  </TableCell>\n                  <TableCell className=\"text-right font-semibold text-green-600\">\n                    {formatCurrency(item.grossProfit || 0)}\n                  </TableCell>\n                  <TableCell className=\"text-right\">\n                    {formatCurrency(item.platformFee || 0)}\n                  </TableCell>\n                  <TableCell className=\"text-right font-semibold text-blue-600\">\n                    {formatCurrency(item.netProfit || 0)}\n                  </TableCell>\n                </TableRow>\n              ))\n            ) : (\n              <TableRow>\n                <TableCell\n                  colSpan={10}\n                  className=\"text-center py-8 text-gray-500\"\n                >\n                  {t(\"reports.noReportData\")}\n                </TableCell>\n              </TableRow>\n            )}\n          </TableBody>\n        </Table>\n      </div>\n    );\n  };\n\n  const renderProductsTable = () => {\n    if (productsLoading) {\n      return (\n        <div className=\"flex justify-center py-8\">\n          <div className=\"text-gray-500\">{t(\"reports.loading\")}</div>\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"overflow-x-auto\">\n        <Table>\n          <TableHeader>\n            <TableRow>\n              <TableHead className=\"min-w-[150px]\">\n                {t(\"reports.salesChannelFilter\")}\n              </TableHead>\n              <TableHead className=\"min-w-[100px]\">\n                {t(\"reports.productCode\")}\n              </TableHead>\n              <TableHead className=\"min-w-[150px]\">\n                {t(\"reports.productName\")}\n              </TableHead>\n              <TableHead className=\"text-center min-w-[80px]\">\n                {t(\"reports.salesChannelQuantitySold\")}\n              </TableHead>\n              <TableHead className=\"text-right min-w-[120px]\">\n                {t(\"reports.salesChannelRevenue\")}\n              </TableHead>\n              <TableHead className=\"text-center min-w-[80px]\">\n                {t(\"reports.salesChannelQuantityReturned\")}\n              </TableHead>\n              <TableHead className=\"text-right min-w-[120px]\">\n                {t(\"reports.salesChannelReturnValue\")}\n              </TableHead>\n              <TableHead className=\"text-right min-w-[120px]\">\n                {t(\"reports.salesChannelNetRevenue\")}\n              </TableHead>\n            </TableRow>\n          </TableHeader>\n          <TableBody>\n            {salesChannelProductsData &&\n            Array.isArray(salesChannelProductsData) &&\n            salesChannelProductsData.length > 0 ? (\n              salesChannelProductsData.map((item: any, index: number) => (\n                <TableRow key={item.id || index}>\n                  <TableCell className=\"font-medium\">\n                    <div>\n                      <div className=\"font-semibold\">\n                        {item.salesChannelName || \"N/A\"}\n                      </div>\n                      {item.sellerName && (\n                        <div className=\"text-sm text-gray-500\">\n                          {item.sellerName}\n                        </div>\n                      )}\n                    </div>\n                  </TableCell>\n                  <TableCell>\n                    <Badge variant=\"outline\">{item.productCode || \"N/A\"}</Badge>\n                  </TableCell>\n                  <TableCell>{item.productName || \"N/A\"}</TableCell>\n                  <TableCell className=\"text-center\">\n                    {item.quantitySold || 0}\n                  </TableCell>\n                  <TableCell className=\"text-right\">\n                    {formatCurrency(item.revenue || 0)}\n                  </TableCell>\n                  <TableCell className=\"text-center\">\n                    {item.quantityReturned || 0}\n                  </TableCell>\n                  <TableCell className=\"text-right\">\n                    {formatCurrency(item.returnValue || 0)}\n                  </TableCell>\n                  <TableCell className=\"text-right font-semibold text-green-600\">\n                    {formatCurrency(item.netRevenue || 0)}\n                  </TableCell>\n                </TableRow>\n              ))\n            ) : (\n              <TableRow>\n                <TableCell\n                  colSpan={8}\n                  className=\"text-center py-8 text-gray-500\"\n                >\n                  {t(\"reports.noReportData\")}\n                </TableCell>\n              </TableRow>\n            )}\n          </TableBody>\n        </Table>\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <TrendingUp className=\"w-5 h-5\" />\n            {t(\"reports.channelSalesReport\")}\n          </CardTitle>\n          <CardDescription>\n            {t(\"reports.salesChannelReportDescription\")}\n          </CardDescription>\n        </CardHeader>\n      </Card>\n\n      {/* Filters */}\n      <Card>\n        <CardContent className=\"space-y-4 pt-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-4 lg:grid-cols-4 gap-4\">\n            {/* Concern Type */}\n            <div>\n              <Label>{t(\"reports.salesChannelConcernType\")}</Label>\n              <Select value={concernType} onValueChange={setConcernType}>\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"sales\">\n                    {t(\"reports.salesChannelSales\")}\n                  </SelectItem>\n                  <SelectItem value=\"profit\">\n                    {t(\"reports.salesChannelProfit\")}\n                  </SelectItem>\n                  <SelectItem value=\"products\">\n                    {t(\"reports.salesChannelProducts\")}\n                  </SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* Start Date */}\n            <div>\n              <Label>{t(\"reports.startDate\")}</Label>\n              <Input\n                type=\"date\"\n                value={startDate}\n                onChange={(e) => setStartDate(e.target.value)}\n              />\n            </div>\n\n            {/* End Date */}\n            <div>\n              <Label>{t(\"reports.endDate\")}</Label>\n              <Input\n                type=\"date\"\n                value={endDate}\n                onChange={(e) => setEndDate(e.target.value)}\n              />\n            </div>\n\n            {/* Seller Filter */}\n            <div>\n              <Label>{t(\"reports.sellerFilter\")}</Label>\n              <Select value={selectedSeller} onValueChange={setSelectedSeller}>\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">{t(\"common.all\")}</SelectItem>\n                  {employees?.map((employee: any) => (\n                    <SelectItem\n                      key={employee.id}\n                      value={employee.id.toString()}\n                    >\n                      {employee.name}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* Sales Channel Filter */}\n            <div>\n              <Label>{t(\"reports.salesChannelFilter\")}</Label>\n              <Select\n                value={selectedSalesChannel}\n                onValueChange={setSelectedSalesChannel}\n              >\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">{t(\"common.all\")}</SelectItem>\n                  <SelectItem value=\"direct\">\n                    {t(\"reports.directSales\")}\n                  </SelectItem>\n                  <SelectItem value=\"other\">\n                    {t(\"reports.otherSales\")}\n                  </SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* Additional filters for products concern type */}\n            {concernType === \"products\" && (\n              <>\n                {/* Product Search */}\n                <div>\n                  <Label>{t(\"reports.productFilter\")}</Label>\n                  <div className=\"relative\">\n                    <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                    <Input\n                      placeholder={t(\"reports.productFilterPlaceholder\")}\n                      value={productSearch}\n                      onChange={(e) => setProductSearch(e.target.value)}\n                      className=\"pl-10\"\n                    />\n                  </div>\n                </div>\n\n                {/* Product Type */}\n                <div>\n                  <Label>{t(\"reports.productType\")}</Label>\n                  <Select value={productType} onValueChange={setProductType}>\n                    <SelectTrigger>\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"all\">{t(\"common.all\")}</SelectItem>\n                      <SelectItem value=\"combo\">\n                        {t(\"reports.combo\")}\n                      </SelectItem>\n                      <SelectItem value=\"product\">\n                        {t(\"reports.product\")}\n                      </SelectItem>\n                      <SelectItem value=\"service\">\n                        {t(\"reports.service\")}\n                      </SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                {/* Category Filter */}\n                <div>\n                  <Label>{t(\"common.category\")}</Label>\n                  <Select\n                    value={selectedCategory}\n                    onValueChange={setSelectedCategory}\n                  >\n                    <SelectTrigger>\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"all\">{t(\"common.all\")}</SelectItem>\n                      {categories?.map((category: any) => (\n                        <SelectItem\n                          key={category.id}\n                          value={category.id.toString()}\n                        >\n                          {category.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              </>\n            )}\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Chart Display - Only show for sales and profit */}\n      {(concernType === \"sales\" || concernType === \"profit\") && (\n        <Card className=\"shadow-xl border-0 bg-gradient-to-br from-blue-50/50 to-indigo-50/30\">\n          <CardHeader className=\"bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-t-lg\">\n            <CardTitle className=\"flex items-center gap-3 text-lg font-semibold\">\n              <div className=\"p-2 bg-white/20 rounded-lg\">\n                <TrendingUp className=\"w-6 h-6\" />\n              </div>\n              <div>\n                <div className=\"text-white/90 text-sm font-normal\">\n                  {t(\"reports.chartView\")}\n                </div>\n                <div className=\"text-white font-semibold\">\n                  {concernType === \"sales\"\n                    ? t(\"reports.salesChannelSales\")\n                    : t(\"reports.salesChannelProfit\")}\n                </div>\n              </div>\n            </CardTitle>\n            <CardDescription className=\"text-blue-100 mt-2\">\n              {t(\"reports.visualRepresentation\")} - {t(\"reports.fromDate\")}:{\" \"}\n              {formatDate(startDate)} {t(\"reports.toDate\")}:{\" \"}\n              {formatDate(endDate)}\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"p-8 bg-white/80 backdrop-blur-sm\">\n            <div className=\"h-[450px] w-full bg-white/90 rounded-xl border-0 shadow-lg p-6 relative overflow-hidden\">\n              <div className=\"absolute inset-0 bg-gradient-to-br from-blue-50/30 to-indigo-50/20 rounded-xl\"></div>\n              <div className=\"absolute top-4 right-4 flex items-center gap-2 text-sm text-gray-500\">\n                <div className=\"w-2 h-2 bg-green-500 rounded-full animate-pulse\"></div>\n                Live Data\n              </div>\n\n              <div className=\"relative z-10 h-full\">\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <BarChart\n                    data={getChartData()}\n                    margin={{ top: 30, right: 40, left: 30, bottom: 90 }}\n                    barCategoryGap=\"25%\"\n                  >\n                    <defs>\n                      <linearGradient\n                        id=\"revenueGradient\"\n                        x1=\"0\"\n                        y1=\"0\"\n                        x2=\"0\"\n                        y2=\"1\"\n                      >\n                        <stop\n                          offset=\"0%\"\n                          stopColor=\"#10b981\"\n                          stopOpacity={0.9}\n                        />\n                        <stop\n                          offset=\"100%\"\n                          stopColor=\"#10b981\"\n                          stopOpacity={0.6}\n                        />\n                      </linearGradient>\n                      <linearGradient\n                        id=\"profitGradient\"\n                        x1=\"0\"\n                        y1=\"0\"\n                        x2=\"0\"\n                        y2=\"1\"\n                      >\n                        <stop\n                          offset=\"0%\"\n                          stopColor=\"#3b82f6\"\n                          stopOpacity={0.9}\n                        />\n                        <stop\n                          offset=\"100%\"\n                          stopColor=\"#3b82f6\"\n                          stopOpacity={0.6}\n                        />\n                      </linearGradient>\n                    </defs>\n                    <CartesianGrid\n                      strokeDasharray=\"2 4\"\n                      stroke=\"#e2e8f0\"\n                      opacity={0.4}\n                      horizontal={true}\n                      vertical={false}\n                    />\n                    <XAxis\n                      dataKey=\"name\"\n                      tick={{ fontSize: 12, fill: \"#475569\", fontWeight: 500 }}\n                      angle={-35}\n                      textAnchor=\"end\"\n                      height={85}\n                      interval={0}\n                      tickMargin={12}\n                      axisLine={{ stroke: \"#cbd5e1\", strokeWidth: 1 }}\n                      tickLine={{ stroke: \"#cbd5e1\", strokeWidth: 1 }}\n                    />\n                    <YAxis\n                      tick={{ fontSize: 12, fill: \"#475569\", fontWeight: 500 }}\n                      tickFormatter={(value) => {\n                        if (value >= 1000000) {\n                          return `${(value / 1000000).toFixed(1)}M`;\n                        } else if (value >= 1000) {\n                          return `${(value / 1000).toFixed(0)}K`;\n                        }\n                        return value.toString();\n                      }}\n                      width={70}\n                      axisLine={{ stroke: \"#cbd5e1\", strokeWidth: 1 }}\n                      tickLine={{ stroke: \"#cbd5e1\", strokeWidth: 1 }}\n                    />\n                    <Tooltip\n                      formatter={(value) => formatCurrency(Number(value))}\n                      labelStyle={{\n                        color: \"#1e293b\",\n                        fontWeight: 600,\n                        fontSize: 13,\n                        marginBottom: 4,\n                      }}\n                      contentStyle={{\n                        backgroundColor: \"rgba(255, 255, 255, 0.98)\",\n                        border: \"1px solid #e2e8f0\",\n                        borderRadius: \"12px\",\n                        boxShadow:\n                          \"0 10px 25px -5px rgb(0 0 0 / 0.15), 0 4px 6px -2px rgb(0 0 0 / 0.05)\",\n                        padding: \"12px 16px\",\n                        backdropFilter: \"blur(8px)\",\n                      }}\n                      cursor={{ fill: \"rgba(59, 130, 246, 0.05)\" }}\n                    />\n                    {concernType === \"sales\" && (\n                      <>\n                        <Bar\n                          dataKey=\"revenue\"\n                          fill=\"url(#revenueGradient)\"\n                          radius={[6, 6, 0, 0]}\n                          maxBarSize={45}\n                          stroke=\"#059669\"\n                          strokeWidth={1}\n                          name={t(\"reports.salesChannelRevenue\")}\n                        />\n                        <Bar\n                          dataKey=\"netRevenue\"\n                          fill=\"url(#profitGradient)\"\n                          radius={[6, 6, 0, 0]}\n                          maxBarSize={45}\n                          stroke=\"#2563eb\"\n                          strokeWidth={1}\n                          name={t(\"reports.salesChannelNetRevenue\")}\n                        />\n                      </>\n                    )}\n                    {concernType === \"profit\" && (\n                      <>\n                        <Bar\n                          dataKey=\"grossProfit\"\n                          fill=\"url(#profitGradient)\"\n                          radius={[6, 6, 0, 0]}\n                          maxBarSize={45}\n                          stroke=\"#2563eb\"\n                          strokeWidth={1}\n                          name={t(\"reports.salesChannelGrossProfit\")}\n                        />\n                        <Bar\n                          dataKey=\"netProfit\"\n                          fill=\"url(#revenueGradient)\"\n                          radius={[6, 6, 0, 0]}\n                          maxBarSize={45}\n                          stroke=\"#059669\"\n                          strokeWidth={1}\n                          name={t(\"reports.salesChannelNetProfit\")}\n                        />\n                      </>\n                    )}\n                  </BarChart>\n                </ResponsiveContainer>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Report Content */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Calendar className=\"w-5 h-5\" />\n            {getReportTitle()}\n          </CardTitle>\n          <CardDescription>\n            {t(\"reports.dataFrom\")} {formatDate(startDate)} {t(\"reports.to\")}{\" \"}\n            {formatDate(endDate)}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          {concernType === \"sales\" && renderSalesTable()}\n          {concernType === \"profit\" && renderProfitTable()}\n          {concernType === \"products\" && renderProductsTable()}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":31272},"client/src/components/reports/sales-chart-report.tsx":{"content":"import React, { useState, useEffect, useMemo, Fragment } from \"react\";\nimport { useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  TrendingUp,\n  FileText,\n  Calendar,\n  Package,\n  DollarSign,\n  Users,\n  ShoppingCart,\n  BarChart3,\n  Search,\n} from \"lucide-react\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n} from \"@/components/ui/chart\";\nimport {\n  BarChart,\n  Bar,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  ResponsiveContainer,\n} from \"recharts\";\n\nexport function SalesChartReport() {\n  const { t } = useTranslation();\n  const queryClient = useQueryClient();\n\n  const [analysisType, setAnalysisType] = useState(\"time\");\n  const [concernType, setConcernType] = useState(\"time\");\n\n  const [startDate, setStartDate] = useState<string>(\n    new Date().toISOString().split(\"T\")[0],\n  );\n  const [endDate, setEndDate] = useState<string>(\n    new Date().toISOString().split(\"T\")[0],\n  );\n  const [salesMethod, setSalesMethod] = useState(\"all\");\n  const [salesChannel, setSalesChannel] = useState(\"all\");\n\n  // Additional filters from legacy reports\n  const [selectedEmployee, setSelectedEmployee] = useState(\"all\");\n  const [customerSearch, setCustomerSearch] = useState(\"\");\n  const [productSearch, setProductSearch] = useState(\"\");\n  const [selectedCategory, setSelectedCategory] = useState(\"all\");\n  const [productType, setProductType] = useState(\"all\");\n  const [customerStatus, setCustomerStatus] = useState(\"all\");\n\n  // Pagination state for product report\n  const [productCurrentPage, setProductCurrentPage] = useState(1);\n  const [productPageSize, setProductPageSize] = useState(15);\n\n  // Customer Report with Pagination State\n  const [customerCurrentPage, setCustomerCurrentPage] = useState(1);\n  const [customerPageSize, setCustomerPageSize] = useState(15);\n\n  // Data queries - using same source as dashboard for consistency\n  const { data: transactions, isLoading: transactionsLoading } = useQuery({\n    queryKey: [\"/api/transactions\"],\n    queryFn: async () => {\n      try {\n        const response = await fetch(\"/api/transactions\");\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        const data = await response.json();\n        return Array.isArray(data) ? data : [];\n      } catch (error) {\n        console.error(\"Error fetching transactions:\", error);\n        return [];\n      }\n    },\n    retry: 3,\n    retryDelay: 1000,\n    staleTime: 5 * 60 * 1000,\n  });\n\n  const { data: orders = [], isLoading: ordersLoading } = useQuery({\n    queryKey: [\"/api/orders\"],\n    queryFn: async () => {\n      try {\n        const response = await fetch(\"/api/orders\");\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        const data = await response.json();\n        return Array.isArray(data) ? data : [];\n      } catch (error) {\n        console.error(\"Error fetching orders:\", error);\n        return [];\n      }\n    },\n    retry: 3,\n    retryDelay: 1000,\n    staleTime: 5 * 60 * 1000,\n  });\n\n  const { data: invoices = [], isLoading: invoicesLoading } = useQuery({\n    queryKey: [\"/api/invoices\"],\n    queryFn: async () => {\n      try {\n        const response = await fetch(\"/api/invoices\");\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        const data = await response.json();\n        return Array.isArray(data) ? data : [];\n      } catch (error) {\n        console.error(\"Error fetching invoices:\", error);\n        return [];\n      }\n    },\n    retry: 3,\n    retryDelay: 1000,\n    staleTime: 5 * 60 * 1000,\n  });\n\n  const { data: tables } = useQuery({\n    queryKey: [\"/api/tables\"],\n    staleTime: 5 * 60 * 1000,\n  });\n\n  const { data: employees } = useQuery({\n    queryKey: [\"/api/employees\"],\n    staleTime: 5 * 60 * 1000,\n  });\n\n  const { data: products } = useQuery({\n    queryKey: [\"/api/products\", selectedCategory, productType, productSearch],\n    queryFn: async () => {\n      const response = await fetch(\n        `/api/products/${selectedCategory}/${productType}/${productSearch || \"\"}`,\n      );\n      if (!response.ok) throw new Error(\"Failed to fetch products\");\n      return response.json();\n    },\n    staleTime: 5 * 60 * 1000,\n  });\n\n  const { data: categories } = useQuery({\n    queryKey: [\"/api/categories\"],\n    staleTime: 5 * 60 * 1000,\n  });\n\n  const { data: customers } = useQuery({\n    queryKey: [\"/api/customers\", customerSearch, customerStatus],\n    queryFn: async () => {\n      const response = await fetch(\n        `/api/customers/${customerSearch || \"\"}/${customerStatus || \"all\"}`,\n      );\n      if (!response.ok) throw new Error(\"Failed to fetch customers\");\n      return response.json();\n    },\n    staleTime: 5 * 60 * 1000,\n  });\n\n  const { data: suppliers } = useQuery({\n    queryKey: [\"/api/suppliers\"],\n    staleTime: 5 * 60 * 1000,\n  });\n\n  // Utility functions\n  const formatCurrency = (amount: number) => {\n    return `${amount.toLocaleString()} ₫`;\n  };\n\n  const formatDate = (dateStr: string) => {\n    return new Date(dateStr).toLocaleDateString(\"vi-VN\", {\n      day: \"2-digit\",\n      month: \"2-digit\",\n      year: \"numeric\",\n    });\n  };\n\n  const getPaymentMethodLabel = (method: string) => {\n    const labels = {\n      cash: t(\"common.cash\"),\n      card: t(\"common.creditCard\"),\n      creditCard: t(\"common.creditCard\"),\n      credit_card: t(\"common.creditCard\"),\n      debitCard: t(\"common.debitCard\"),\n      debit_card: t(\"common.debitCard\"),\n      transfer: t(\"common.transfer\"),\n      einvoice: t(\"reports.einvoice\"),\n      momo: t(\"common.momo\"),\n      zalopay: t(\"common.zalopay\"),\n      vnpay: t(\"common.vnpay\"),\n      qrCode: t(\"common.qrCode\"),\n      shopeepay: t(\"common.shopeepay\"),\n      grabpay: t(\"common.grabpay\"),\n      mobile: \"Mobile\",\n    };\n    return labels[method as keyof typeof labels] || method;\n  };\n\n  const getReportTitle = () => {\n    switch (analysisType) {\n      case \"time\":\n        const concernTypes = {\n          time: t(\"reports.timeSalesReport\"),\n          profit: t(\"reports.profitByInvoiceReport\"),\n          discount: t(\"reports.invoiceDiscountReport\"),\n          return: t(\"reports.returnByInvoiceReport\"),\n          employee: t(\"reports.employeeSalesReport\"),\n          salesDetail: t(\"reports.salesDetailReport\"),\n        };\n        return (\n          concernTypes[concernType as keyof typeof concernTypes] ||\n          t(\"reports.salesReport\")\n        );\n      case \"product\":\n        return t(\"reports.inventoryReport\");\n      case \"employee\":\n        return t(\"reports.employeeSalesReport\");\n      case \"customer\":\n        return t(\"reports.customerSalesReport\");\n      case \"channel\":\n        return t(\"reports.channelSalesReport\");\n      default:\n        return t(\"reports.salesReport\");\n    }\n  };\n\n  // State for expandable rows\n  const [expandedRows, setExpandedRows] = useState<{ [key: string]: boolean }>(\n    {},\n  );\n\n  // Pagination state for sales report\n  const [currentPage, setCurrentPage] = useState(1);\n  const [pageSize, setPageSize] = useState(15);\n\n  // EXACT same data processing logic as dashboard\n  const getDashboardStats = () => {\n    if (\n      !orders ||\n      !tables ||\n      !Array.isArray(orders) ||\n      !Array.isArray(tables)\n    ) {\n      return null;\n    }\n\n    const start = new Date(startDate);\n    start.setHours(0, 0, 0, 0); // Start of the day\n    const end = new Date(endDate);\n    end.setHours(23, 59, 59, 999); // End of the day\n\n    // Check if we have orders in the selected date range\n    const ordersInRange = orders.filter((o: any) => {\n      const oDate = new Date(\n        o.orderedAt || o.paidAt || o.createdAt || o.created_at,\n      );\n      return (\n        !isNaN(oDate.getTime()) &&\n        oDate >= start &&\n        oDate <= end &&\n        (o.status === \"paid\" || o.status === \"completed\")\n      );\n    });\n\n    // If no orders in selected date range, use recent data (last 30 days) for demo\n    const useRecentData = ordersInRange.length === 0;\n    let dateFilter = start;\n    let endFilter = end;\n\n    if (useRecentData) {\n      const thirtyDaysAgo = new Date();\n      thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n      dateFilter = thirtyDaysAgo;\n      endFilter = new Date(); // Current time\n      endFilter.setHours(23, 59, 59, 999);\n    }\n\n    // Filter completed orders within date range - ENHANCED to show more data\n    const filteredCompletedOrders = Array.isArray(orders)\n      ? orders.filter((order: any) => {\n          try {\n            if (!order) return false;\n\n            // Try multiple date fields - prioritize orderedAt, then paidAt, then createdAt\n            const orderDate = new Date(\n              order.orderedAt ||\n                order.paidAt ||\n                order.createdAt ||\n                order.created_at,\n            );\n\n            if (isNaN(orderDate.getTime())) {\n              return false;\n            }\n\n            const dateMatch = orderDate >= dateFilter && orderDate <= endFilter;\n\n            // Include more order statuses to show real data\n            const isCompleted =\n              order.status === \"paid\" ||\n              order.status === \"completed\" ||\n              order.status === \"served\" ||\n              order.status === \"confirmed\";\n\n            return dateMatch && isCompleted;\n          } catch (error) {\n            console.error(\"Error filtering order:\", order, error);\n            return false;\n          }\n        })\n      : [];\n\n    const ordersInSelectedRange = ordersInRange.length;\n\n    console.log(\"Sales Chart Dashboard Debug:\", {\n      totalOrders: orders.length,\n      startDate,\n      endDate,\n      startDateParsed: start.toISOString(),\n      endDateParsed: end.toISOString(),\n      firstOrder: orders[0]\n        ? {\n            id: orders[0].id,\n            status: orders[0].status,\n            employeeName: orders[0].employeeName,\n            cashierName: orders[0].cashierName,\n            total: orders[0].total,\n          }\n        : null,\n      completedOrders: orders.filter(\n        (o: any) => o.status === \"completed\" || o.status === \"paid\",\n      ).length,\n      ordersInSelectedRange,\n      filteredCompletedOrders: filteredCompletedOrders.length,\n      usingFallbackData:\n        ordersInSelectedRange === 0 && filteredCompletedOrders.length > 0,\n      todaysOrders: orders.filter((o: any) => {\n        const orderDate = new Date(\n          o.orderedAt || o.paidAt || o.createdAt || o.created_at,\n        );\n        const today = new Date();\n        return orderDate.toDateString() === today.toDateString();\n      }).length,\n      sampleOrderDates: orders.slice(0, 5).map((o: any) => ({\n        id: o.id,\n        status: o.status,\n        orderedAt: o.orderedAt,\n        paidAt: o.paidAt,\n        createdAt: o.createdAt,\n        created_at: o.created_at,\n        parsedDate: new Date(\n          o.orderedAt || o.paidAt || o.createdAt || o.created_at,\n        ).toISOString(),\n        dateOnly: new Date(\n          new Date(o.orderedAt || o.paidAt || o.createdAt || o.created_at),\n        ).toDateString(),\n      })),\n    });\n\n    // Period revenue: total amount for all completed orders - EXACT same as dashboard\n    const periodRevenue = filteredCompletedOrders.reduce(\n      (total: number, order: any) => {\n        const orderTotal = Number(order.total || 0);\n        return total + orderTotal;\n      },\n      0,\n    );\n\n    // Order count: count of completed orders in the filtered period - EXACT same as dashboard\n    const periodOrderCount = filteredCompletedOrders.length;\n\n    // Customer count: count unique customers from completed orders - EXACT same as dashboard\n    const uniqueCustomers = new Set();\n    filteredCompletedOrders.forEach((order: any) => {\n      if (order.customerId) {\n        uniqueCustomers.add(order.customerId);\n      } else {\n        // If no customer ID, count as unique customer per order\n        uniqueCustomers.add(`order_${order.id}`);\n      }\n    });\n    const periodCustomerCount = uniqueCustomers.size;\n\n    // Daily average for the period - EXACT same as dashboard\n    const daysDiff = Math.max(\n      1,\n      Math.ceil((end.getTime() - start.getTime()) / (1000 * 60 * 60 * 24)) + 1,\n    );\n    const dailyAverageRevenue = periodRevenue / daysDiff;\n\n    // Active orders (pending/in-progress orders) - EXACT same as dashboard\n    const activeOrders = orders.filter(\n      (order: any) =>\n        order.status === \"pending\" || order.status === \"in_progress\",\n    ).length;\n\n    const occupiedTables = tables.filter(\n      (table: any) => table.status === \"occupied\",\n    );\n\n    // Month revenue: same as period revenue for the selected date range - EXACT same as dashboard\n    const monthRevenue = periodRevenue;\n\n    // Average order value - EXACT same as dashboard\n    const averageOrderValue =\n      periodOrderCount > 0 ? periodRevenue / periodOrderCount : 0;\n\n    // Peak hours analysis from filtered completed orders - EXACT same as dashboard\n    const hourlyOrders: { [key: number]: number } = {};\n    filteredCompletedOrders.forEach((order: any) => {\n      const orderDate = new Date(\n        order.orderedAt || order.createdAt || order.created_at || order.paidAt,\n      );\n      if (!isNaN(orderDate.getTime())) {\n        const hour = orderDate.getHours();\n        hourlyOrders[hour] = (hourlyOrders[hour] || 0) + 1;\n      }\n    });\n\n    const peakHour = Object.keys(hourlyOrders).reduce(\n      (peak, hour) =>\n        hourlyOrders[parseInt(hour)] > hourlyOrders[parseInt(peak)]\n          ? hour\n          : peak,\n      \"12\",\n    );\n\n    return {\n      periodRevenue,\n      periodOrderCount,\n      periodCustomerCount,\n      dailyAverageRevenue,\n      activeOrders: activeOrders,\n      occupiedTables: occupiedTables.length,\n      monthRevenue,\n      averageOrderValue,\n      peakHour: parseInt(peakHour),\n      totalTables: tables.length,\n      filteredCompletedOrders: filteredCompletedOrders, // Return filtered orders for further processing\n    };\n  };\n\n  // Legacy Sales Report Component Logic using dashboard stats\n  const renderSalesReport = () => {\n    const dashboardStats = getDashboardStats();\n\n    if (!dashboardStats) {\n      return (\n        <div className=\"flex justify-center py-8\">\n          <div className=\"text-gray-500\">{t(\"reports.loading\")}...</div>\n        </div>\n      );\n    }\n\n    const { filteredCompletedOrders } = dashboardStats;\n\n    // Convert orders to transaction-like format for compatibility\n    const filteredTransactions = filteredCompletedOrders.map((order: any) => ({\n      id: order.id,\n      orderNumber: order.orderNumber, // Ensure orderNumber is included if available\n      transactionId: `TXN-${order.id}`,\n      total: order.total,\n      subtotal: order.subtotal,\n      discount: order.discount || 0,\n      paymentMethod: order.paymentMethod || \"cash\",\n      createdAt:\n        order.orderedAt || order.createdAt || order.created_at || order.paidAt,\n      created_at:\n        order.orderedAt || order.createdAt || order.created_at || order.paidAt,\n      customerName: order.customerName,\n      customerId: order.customerId,\n      cashierName: order.employeeName || order.cashierName,\n      employeeId: order.employeeId,\n      items: order.items || [],\n      status: order.status,\n    }));\n\n    const dailySales: {\n      [date: string]: { revenue: number; orders: number; customers: number };\n    } = {};\n\n    filteredCompletedOrders.forEach((order: any) => {\n      const orderDate = new Date(\n        order.orderedAt || order.createdAt || order.created_at || order.paidAt,\n      );\n\n      const year = orderDate.getFullYear();\n      const month = (orderDate.getMonth() + 1).toString().padStart(2, \"0\");\n      const day = orderDate.getDate().toString().padStart(2, \"0\");\n      const date = `${year}-${month}-${day}`;\n\n      if (!dailySales[date]) {\n        dailySales[date] = { revenue: 0, orders: 0, customers: 0 };\n      }\n\n      // Use EXACT same revenue calculation as dashboard: total - discount\n      const orderTotal = Number(order.total || 0);\n      const discount = Number(order.discount || 0);\n      dailySales[date].revenue += orderTotal - discount;\n      dailySales[date].orders += 1;\n\n      // Count unique customers per day\n      if (order.customerId) {\n        dailySales[date].customers += 1;\n      } else {\n        dailySales[date].customers += 1; // Count walk-in customers\n      }\n    });\n\n    const paymentMethods: {\n      [method: string]: { count: number; revenue: number };\n    } = {};\n\n    filteredCompletedOrders.forEach((order: any) => {\n      const method = order.paymentMethod || \"cash\";\n      if (!paymentMethods[method]) {\n        paymentMethods[method] = { count: 0, revenue: 0 };\n      }\n      paymentMethods[method].count += 1;\n\n      // Use EXACT same revenue calculation as dashboard: total - discount\n      const orderTotal = Number(order.total || 0);\n      const discount = Number(order.discount || 0);\n      paymentMethods[method].revenue += orderTotal - discount;\n    });\n\n    // Use dashboard stats directly for consistency\n    const totalRevenue = dashboardStats.periodRevenue;\n    const totalOrders = dashboardStats.periodOrderCount;\n    const totalCustomers = dashboardStats.periodCustomerCount;\n    const averageOrderValue = dashboardStats.averageOrderValue;\n\n    return (\n      <>\n        {/* Summary Stats - Using Dashboard Style */}\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6\">\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-gray-600\">\n                    Tổng doanh thu\n                  </p>\n                  <p className=\"text-2xl font-bold text-green-600\">\n                    {formatCurrency(totalRevenue)}\n                  </p>\n                  <p className=\"text-xs text-gray-500 mt-1\">\n                    {startDate} ~ {endDate}\n                  </p>\n                </div>\n                <DollarSign className=\"w-8 h-8 text-green-500\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-gray-600\">\n                    Tổng đơn hàng\n                  </p>\n                  <p className=\"text-2xl font-bold\">{totalOrders}</p>\n                  <p className=\"text-xs text-gray-500 mt-1\">\n                    {t(\"reports.averageOrderValue\")}{\" \"}\n                    {formatCurrency(averageOrderValue)}\n                  </p>\n                </div>\n                <ShoppingCart className=\"w-8 h-8 text-blue-500\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-gray-600\">\n                    Tổng khách hàng\n                  </p>\n                  <p className=\"text-2xl font-bold\">{totalCustomers}</p>\n                  <p className=\"text-xs text-gray-500 mt-1\">\n                    {t(\"reports.peakHour\")} {dashboardStats.peakHour}{\" \"}\n                    <span>{t(\"reports.hour\")}</span>\n                  </p>\n                </div>\n                <Users className=\"w-8 h-8 text-purple-500\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-gray-600\">\n                    {t(\"reports.monthRevenue\")}\n                  </p>\n                  <p className=\"text-2xl font-bold text-blue-600\">\n                    {formatCurrency(dashboardStats.monthRevenue)}\n                  </p>\n                  <p className=\"text-xs text-gray-500 mt-1\">\n                    {startDate === endDate\n                      ? formatDate(startDate)\n                      : `${formatDate(startDate)} - ${formatDate(endDate)}`}\n                  </p>\n                </div>\n                <TrendingUp className=\"w-8 h-8 text-blue-500\" />\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Daily Sales */}\n        <Card>\n          <CardHeader>\n            <CardTitle>{t(\"reports.dailySales\")}</CardTitle>\n            <CardDescription>\n              {t(\"reports.salesChartDescription\")}\n              {(() => {\n                const ordersInRange =\n                  orders?.filter((o: any) => {\n                    const oDate = new Date(\n                      o.orderedAt || o.paidAt || o.createdAt || o.created_at,\n                    );\n                    const start = new Date(startDate);\n                    const end = new Date(endDate);\n                    end.setHours(23, 59, 59, 999);\n                    return (\n                      !isNaN(oDate.getTime()) && oDate >= start && oDate <= end\n                    );\n                  }).length || 0;\n\n                return ordersInRange === 0 ? (\n                  <div className=\"text-orange-600 text-sm mt-1\">\n                    📊 Không có dữ liệu trong ngày đã chọn, hiển thị dữ liệu mẫu\n                    từ 30 ngày gần đây\n                  </div>\n                ) : null;\n              })()}\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"w-full\">\n              <div className=\"overflow-x-auto xl:overflow-x-visible\">\n                <Table className=\"w-full min-w-[1400px] xl:min-w-full\">\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead\n                        className=\"text-center border-r bg-green-50 w-12\"\n                        rowSpan={2}\n                      ></TableHead>\n                      <TableHead\n                        className=\"text-center border-r bg-green-50 min-w-[120px]\"\n                        rowSpan={2}\n                      >\n                        {t(\"reports.date\")}\n                      </TableHead>\n                      <TableHead\n                        className=\"text-center border-r min-w-[100px]\"\n                        rowSpan={2}\n                      >\n                        {t(\"reports.orderNumber\")}\n                      </TableHead>\n                      <TableHead\n                        className=\"text-center border-r min-w-[140px]\"\n                        rowSpan={2}\n                      >\n                        {t(\"reports.subtotal\")}\n                      </TableHead>\n                      <TableHead\n                        className=\"text-center border-r min-w-[120px]\"\n                        rowSpan={2}\n                      >\n                        {t(\"reports.discount\")}\n                      </TableHead>\n                      <TableHead\n                        className=\"text-center border-r min-w-[140px]\"\n                        rowSpan={2}\n                      >\n                        {t(\"reports.revenue\")}\n                      </TableHead>\n                      <TableHead\n                        className=\"text-center border-r min-w-[120px]\"\n                        rowSpan={2}\n                      >\n                        {t(\"reports.tax\")}\n                      </TableHead>\n                      <TableHead\n                        className=\"text-center border-r min-w-[140px]\"\n                        rowSpan={2}\n                      >\n                        {t(\"reports.total\")}\n                      </TableHead>\n                      <TableHead\n                        className=\"text-center border-r bg-blue-50 min-w-[200px]\"\n                        colSpan={(() => {\n                          // Get all unique payment methods from transactions\n                          const allPaymentMethods = new Set();\n                          if (\n                            filteredTransactions &&\n                            Array.isArray(filteredTransactions)\n                          ) {\n                            filteredTransactions.forEach((transaction: any) => {\n                              const method =\n                                transaction.paymentMethod || \"cash\";\n                              allPaymentMethods.add(method);\n                            });\n                          }\n                          return allPaymentMethods.size + 1; // +1 for total column\n                        })()}\n                      >\n                        {t(\"reports.totalCustomerPayment\")}\n                      </TableHead>\n                    </TableRow>\n                    <TableRow>\n                      {(() => {\n                        // Get all unique payment methods from transactions\n                        const allPaymentMethods = new Set();\n                        if (\n                          filteredTransactions &&\n                          Array.isArray(filteredTransactions)\n                        ) {\n                          filteredTransactions.forEach((transaction: any) => {\n                            const method = transaction.paymentMethod || \"cash\";\n                            allPaymentMethods.add(method);\n                          });\n                        }\n\n                        const paymentMethodsArray =\n                          Array.from(allPaymentMethods).sort();\n\n                        return (\n                          <>\n                            {paymentMethodsArray.map((method: any) => (\n                              <TableHead\n                                key={method}\n                                className=\"text-center border-r bg-blue-50 min-w-[130px]\"\n                              >\n                                {getPaymentMethodLabel(method)}\n                              </TableHead>\n                            ))}\n                            <TableHead className=\"text-center bg-blue-50 min-w-[150px]\">\n                              {t(\"reports.totalCustomerPayment\")}\n                            </TableHead>\n                          </>\n                        );\n                      })()}\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {Object.entries(dailySales).length > 0 ? (\n                      (() => {\n                        const sortedEntries = Object.entries(dailySales).sort(\n                          ([a], [b]) =>\n                            new Date(b).getTime() - new Date(a).getTime(),\n                        );\n                        const totalPages = Math.ceil(\n                          sortedEntries.length / pageSize,\n                        );\n                        const startIndex = (currentPage - 1) * pageSize;\n                        const endIndex = startIndex + pageSize;\n                        const paginatedEntries = sortedEntries.slice(\n                          startIndex,\n                          endIndex,\n                        );\n\n                        return paginatedEntries.map(([date, data]) => {\n                          const paymentAmount = data.revenue * 1.05; // Thành tiền (bao gồm thuế và phí)\n                          const discount = data.revenue * 0.05; // Giảm giá (5% trung bình)\n                          const actualRevenue = paymentAmount - discount; // Doanh thu = Thành tiền - Giảm giá\n                          const tax = actualRevenue * 0.1; // Thuế tính trên doanh thu\n                          const customerPayment = actualRevenue; // Khách thanh toán = doanh thu\n\n                          // Get transactions for this date\n                          const dateTransactions = filteredTransactions.filter(\n                            (transaction: any) => {\n                              const transactionDate = new Date(\n                                transaction.createdAt || transaction.created_at,\n                              );\n                              const year = transactionDate.getFullYear();\n                              const month = (transactionDate.getMonth() + 1)\n                                .toString()\n                                .padStart(2, \"0\");\n                              const day = transactionDate\n                                .getDate()\n                                .toString()\n                                .padStart(2, \"0\");\n                              const transactionDateStr = `${year}-${month}-${day}`;\n                              return transactionDateStr === date;\n                            },\n                          );\n\n                          const isExpanded = expandedRows[date] || false;\n\n                          return (\n                            <>\n                              <TableRow key={date} className=\"hover:bg-gray-50\">\n                                <TableCell className=\"text-center border-r w-12\">\n                                  <button\n                                    onClick={() =>\n                                      setExpandedRows((prev) => ({\n                                        ...prev,\n                                        [date]: !prev[date],\n                                      }))\n                                    }\n                                    className=\"w-8 h-8 flex items-center justify-center hover:bg-gray-200 rounded text-sm\"\n                                  >\n                                    {isExpanded ? \"−\" : \"+\"}\n                                  </button>\n                                </TableCell>\n                                <TableCell className=\"font-medium text-center border-r bg-green-50 min-w-[120px] px-4\">\n                                  {formatDate(date)}\n                                </TableCell>\n                                <TableCell className=\"text-center border-r min-w-[100px] px-4\">\n                                  {data.orders.toLocaleString()}\n                                </TableCell>\n                                <TableCell className=\"text-right border-r min-w-[140px] px-4\">\n                                  {formatCurrency(paymentAmount)}\n                                </TableCell>\n                                <TableCell className=\"text-right border-r text-red-600 min-w-[120px] px-4\">\n                                  {formatCurrency(discount)}\n                                </TableCell>\n                                <TableCell className=\"text-right border-r text-green-600 font-medium min-w-[140px] px-4\">\n                                  {formatCurrency(actualRevenue)}\n                                </TableCell>\n                                <TableCell className=\"text-right border-r min-w-[120px] px-4\">\n                                  {formatCurrency(tax)}\n                                </TableCell>\n                                <TableCell className=\"text-right border-r font-bold text-blue-600 min-w-[140px] px-4\">\n                                  {formatCurrency(actualRevenue)}\n                                </TableCell>\n                                {(() => {\n                                  // Group transactions by payment method for this date\n                                  const paymentMethods: {\n                                    [method: string]: number;\n                                  } = {};\n                                  dateTransactions.forEach(\n                                    (transaction: any) => {\n                                      const method =\n                                        transaction.paymentMethod || \"cash\";\n                                      paymentMethods[method] =\n                                        (paymentMethods[method] || 0) +\n                                        Number(transaction.total);\n                                    },\n                                  );\n\n                                  // Get all unique payment methods from all transactions\n                                  const allPaymentMethods = new Set();\n                                  if (\n                                    filteredTransactions &&\n                                    Array.isArray(filteredTransactions)\n                                  ) {\n                                    filteredTransactions.forEach(\n                                      (transaction: any) => {\n                                        const method =\n                                          transaction.paymentMethod || \"cash\";\n                                        allPaymentMethods.add(method);\n                                      },\n                                    );\n                                  }\n\n                                  const paymentMethodsArray =\n                                    Array.from(allPaymentMethods).sort();\n                                  const totalCustomerPayment = Object.values(\n                                    paymentMethods,\n                                  ).reduce(\n                                    (sum: number, amount: number) =>\n                                      sum + amount,\n                                    0,\n                                  );\n\n                                  return (\n                                    <>\n                                      {paymentMethodsArray.map(\n                                        (method: any) => {\n                                          const amount =\n                                            paymentMethods[method] || 0;\n                                          return (\n                                            <TableCell\n                                              key={method}\n                                              className=\"text-right border-r font-medium min-w-[130px] px-4\"\n                                            >\n                                              {amount > 0\n                                                ? formatCurrency(amount)\n                                                : \"-\"}\n                                            </TableCell>\n                                          );\n                                        },\n                                      )}\n                                      <TableCell className=\"text-right font-bold text-green-600 min-w-[150px] px-4\">\n                                        {formatCurrency(totalCustomerPayment)}\n                                      </TableCell>\n                                    </>\n                                  );\n                                })()}\n                              </TableRow>\n\n                              {/* Expanded order details */}\n                              {isExpanded &&\n                                dateTransactions.length > 0 &&\n                                dateTransactions.map(\n                                  (transaction: any, txIndex: number) => (\n                                    <TableRow\n                                      key={`${date}-transaction-${transaction.id || txIndex}`}\n                                      className=\"bg-blue-50/50 border-l-4 border-l-blue-400\"\n                                    >\n                                      <TableCell className=\"text-center border-r bg-blue-50 w-12\">\n                                        <div className=\"w-8 h-6 flex items-center justify-center text-blue-600 text-xs\">\n                                          └\n                                        </div>\n                                      </TableCell>\n                                      <TableCell className=\"font-medium text-center border-r bg-blue-50 text-blue-600 text-sm min-w-[120px] px-4\">\n                                        {new Date(\n                                          transaction.createdAt ||\n                                            transaction.created_at,\n                                        ).toLocaleTimeString(\"vi-VN\", {\n                                          hour: \"2-digit\",\n                                          minute: \"2-digit\",\n                                        })}\n                                        <div className=\"text-xs text-gray-500 font-normal\">\n                                          {getPaymentMethodLabel(\n                                            transaction.paymentMethod,\n                                          )}\n                                        </div>\n                                      </TableCell>\n                                      <TableCell className=\"text-center border-r text-sm min-w-[100px] px-4\">\n                                        {transaction.orderNumber ||\n                                          transaction.transactionId ||\n                                          `ORD-${transaction.id}` ||\n                                          `TXN-${txIndex + 1}`}\n                                      </TableCell>\n                                      <TableCell className=\"text-right border-r text-sm min-w-[140px] px-4\">\n                                        {formatCurrency(\n                                          Number(transaction.total) * 1.05,\n                                        )}\n                                      </TableCell>\n                                      <TableCell className=\"text-right border-r text-red-600 text-sm min-w-[120px] px-4\">\n                                        {formatCurrency(\n                                          Number(transaction.total) *\n                                            1.05 *\n                                            0.05,\n                                        )}\n                                      </TableCell>\n                                      <TableCell className=\"text-right border-r text-green-600 font-medium text-sm min-w-[140px] px-4\">\n                                        {formatCurrency(\n                                          Number(transaction.total),\n                                        )}\n                                      </TableCell>\n                                      <TableCell className=\"text-right border-r text-sm min-w-[120px] px-4\">\n                                        {formatCurrency(\n                                          Number(transaction.total) * 0.1,\n                                        )}\n                                      </TableCell>\n                                      <TableCell className=\"text-right border-r font-bold text-blue-600 text-sm min-w-[140px] px-4\">\n                                        {formatCurrency(\n                                          Number(transaction.total),\n                                        )}\n                                      </TableCell>\n                                      {(() => {\n                                        const transactionMethod =\n                                          transaction.paymentMethod || \"cash\";\n                                        const amount = Number(\n                                          transaction.total,\n                                        );\n\n                                        // Get all unique payment methods from all transactions\n                                        const allPaymentMethods = new Set();\n                                        if (\n                                          filteredTransactions &&\n                                          Array.isArray(filteredTransactions)\n                                        ) {\n                                          filteredTransactions.forEach(\n                                            (transaction: any) => {\n                                              const method =\n                                                transaction.paymentMethod ||\n                                                \"cash\";\n                                              allPaymentMethods.add(method);\n                                            },\n                                          );\n                                        }\n\n                                        const paymentMethodsArray =\n                                          Array.from(allPaymentMethods).sort();\n\n                                        return (\n                                          <>\n                                            {paymentMethodsArray.map(\n                                              (method: any) => (\n                                                <TableCell\n                                                  key={method}\n                                                  className=\"text-right border-r text-sm min-w-[130px] px-4\"\n                                                >\n                                                  {transactionMethod === method\n                                                    ? formatCurrency(amount)\n                                                    : \"-\"}\n                                                </TableCell>\n                                              ),\n                                            )}\n                                            <TableCell className=\"text-right font-bold text-green-600 text-sm min-w-[150px] px-4\">\n                                              {formatCurrency(amount)}\n                                            </TableCell>\n                                          </>\n                                        );\n                                      })()}\n                                    </TableRow>\n                                  ),\n                                )}\n                            </>\n                          );\n                        });\n                      })()\n                    ) : (\n                      <TableRow>\n                        <TableCell\n                          colSpan={9}\n                          className=\"text-center text-gray-500 py-8\"\n                        >\n                          {t(\"reports.noDataDescription\")}\n                        </TableCell>\n                      </TableRow>\n                    )}\n\n                    {/* Summary Row */}\n                    {Object.entries(dailySales).length > 0 && (\n                      <TableRow className=\"bg-gray-100 font-bold border-t-2\">\n                        <TableCell className=\"text-center border-r w-12\"></TableCell>\n                        <TableCell className=\"text-center border-r bg-green-50 min-w-[120px] px-4\">\n                          {t(\"common.total\")}\n                        </TableCell>\n                        <TableCell className=\"text-center border-r min-w-[100px] px-4\">\n                          {Object.values(dailySales)\n                            .reduce((sum, data) => sum + data.orders, 0)\n                            .toLocaleString()}\n                        </TableCell>\n                        <TableCell className=\"text-right border-r min-w-[140px] px-4\">\n                          {formatCurrency(\n                            Object.values(dailySales).reduce(\n                              (sum, data) => sum + data.revenue * 1.05,\n                              0,\n                            ),\n                          )}\n                        </TableCell>\n                        <TableCell className=\"text-right border-r text-red-600 min-w-[120px] px-4\">\n                          {formatCurrency(\n                            Object.values(dailySales).reduce(\n                              (sum, data) => sum + data.revenue * 1.05 * 0.05,\n                              0,\n                            ),\n                          )}\n                        </TableCell>\n                        <TableCell className=\"text-right border-r text-green-600 min-w-[140px] px-4\">\n                          {formatCurrency(\n                            Object.values(dailySales).reduce(\n                              (sum, data) => sum + data.revenue,\n                              0,\n                            ),\n                          )}\n                        </TableCell>\n                        <TableCell className=\"text-right border-r min-w-[120px] px-4\">\n                          {formatCurrency(\n                            Object.values(dailySales).reduce(\n                              (sum, data) => sum + data.revenue * 0.1,\n                              0,\n                            ),\n                          )}\n                        </TableCell>\n                        <TableCell className=\"text-right border-r text-blue-600 min-w-[140px] px-4\">\n                          {formatCurrency(\n                            Object.values(dailySales).reduce(\n                              (sum, data) => sum + data.revenue,\n                              0,\n                            ),\n                          )}\n                        </TableCell>\n                        {(() => {\n                          // Calculate total payment methods across all dates\n                          const totalPaymentMethods: {\n                            [method: string]: number;\n                          } = {};\n                          filteredTransactions.forEach((transaction: any) => {\n                            const method = transaction.paymentMethod || \"cash\";\n                            totalPaymentMethods[method] =\n                              (totalPaymentMethods[method] || 0) +\n                              Number(transaction.total);\n                          });\n\n                          // Get all unique payment methods from all transactions\n                          const allPaymentMethods = new Set();\n                          filteredTransactions.forEach((transaction: any) => {\n                            const method = transaction.paymentMethod || \"cash\";\n                            allPaymentMethods.add(method);\n                          });\n\n                          const paymentMethodsArray =\n                            Array.from(allPaymentMethods).sort();\n                          const grandTotal = Object.values(\n                            totalPaymentMethods,\n                          ).reduce(\n                            (sum: number, amount: number) => sum + amount,\n                            0,\n                          );\n\n                          return (\n                            <>\n                              {paymentMethodsArray.map((method: any) => {\n                                const total = totalPaymentMethods[method] || 0;\n                                return (\n                                  <TableCell\n                                    key={method}\n                                    className=\"text-right border-r font-bold text-green-600 min-w-[130px] px-4\"\n                                  >\n                                    {total > 0 ? formatCurrency(total) : \"-\"}\n                                  </TableCell>\n                                );\n                              })}\n                              <TableCell className=\"text-right font-bold text-green-600 text-xl min-w-[150px] px-4\">\n                                {formatCurrency(grandTotal)}\n                              </TableCell>\n                            </>\n                          );\n                        })()}\n                      </TableRow>\n                    )}\n                  </TableBody>\n                </Table>\n              </div>\n            </div>\n\n            {/* Pagination Controls for Daily Sales */}\n            {Object.entries(dailySales).length > 0 && (\n              <div className=\"flex items-center justify-between space-x-6 py-4\">\n                <div className=\"flex items-center space-x-2\">\n                  <p className=\"text-sm font-medium\">{t(\"common.show\")} </p>\n                  <Select\n                    value={pageSize.toString()}\n                    onValueChange={(value) => {\n                      setPageSize(Number(value));\n                      setCurrentPage(1);\n                    }}\n                  >\n                    <SelectTrigger className=\"h-8 w-[70px]\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent side=\"top\">\n                      <SelectItem value=\"15\">15</SelectItem>\n                      <SelectItem value=\"20\">20</SelectItem>\n                      <SelectItem value=\"30\">30</SelectItem>\n                      <SelectItem value=\"50\">50</SelectItem>\n                      <SelectItem value=\"100\">100</SelectItem>\n                    </SelectContent>\n                  </Select>\n                  <p className=\"text-sm font-medium\"> {t(\"common.rows\")}</p>\n                </div>\n\n                <div className=\"flex items-center space-x-2\">\n                  <p className=\"text-sm font-medium\">\n                    {t(\"common.page\")} {currentPage} /{\" \"}\n                    {Math.ceil(Object.entries(dailySales).length / pageSize)}\n                  </p>\n                  <div className=\"flex items-center space-x-1\">\n                    <button\n                      onClick={() => setCurrentPage(1)}\n                      disabled={currentPage === 1}\n                      className=\"inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-8 w-8\"\n                    >\n                      «\n                    </button>\n                    <button\n                      onClick={() =>\n                        setCurrentPage((prev) => Math.max(prev - 1, 1))\n                      }\n                      disabled={currentPage === 1}\n                      className=\"inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-8 w-8\"\n                    >\n                      ‹\n                    </button>\n                    <button\n                      onClick={() =>\n                        setCurrentPage((prev) =>\n                          Math.min(\n                            prev + 1,\n                            Math.ceil(\n                              Object.entries(dailySales).length / pageSize,\n                            ),\n                          ),\n                        )\n                      }\n                      disabled={\n                        currentPage ===\n                        Math.ceil(Object.entries(dailySales).length / pageSize)\n                      }\n                      className=\"inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-8 w-8\"\n                    >\n                      ›\n                    </button>\n                    <button\n                      onClick={() =>\n                        setCurrentPage(\n                          Math.ceil(\n                            Object.entries(dailySales).length / pageSize,\n                          ),\n                        )\n                      }\n                      disabled={\n                        currentPage ===\n                        Math.ceil(Object.entries(dailySales).length / pageSize)\n                      }\n                      className=\"inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-8 w-8\"\n                    >\n                      »\n                    </button>\n                  </div>\n                </div>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </>\n    );\n  };\n\n  // Sales Detail Report Component\n  const renderSalesDetailReport = () => {\n    // Temporarily use renderSalesReport logic for sales detail report\n    // This might need a dedicated implementation later\n    return renderSalesReport();\n  };\n\n  // Employee Report with Pagination State\n  const [employeeCurrentPage, setEmployeeCurrentPage] = useState(1);\n  const [employeePageSize, setEmployeePageSize] = useState(15);\n\n  // Legacy Employee Report Component Logic\n  const renderEmployeeReport = () => {\n    if (!orders || !Array.isArray(orders)) {\n      return (\n        <div className=\"flex justify-center py-8\">\n          <div className=\"text-gray-500\">{t(\"reports.loading\")}...</div>\n        </div>\n      );\n    }\n\n    try {\n      console.log(\"Employee Report - orders data:\", {\n        ordersLength: orders.length,\n        sampleOrder: orders[0]\n          ? {\n              id: orders[0].id,\n              status: orders[0].status,\n              employeeName: orders[0].employeeName,\n              cashierName: orders[0].cashierName,\n              total: orders[0].total,\n            }\n          : null,\n      });\n\n      const start = new Date(startDate);\n      const end = new Date(endDate);\n      end.setHours(23, 59, 59, 999);\n\n      // Use EXACT same filtering logic as dashboard for orders\n      const filteredCompletedOrders = orders.filter((order: any) => {\n        // Check if order is completed/paid (EXACT same as dashboard)\n        if (order.status !== \"completed\" && order.status !== \"paid\")\n          return false;\n\n        // Try multiple possible date fields (EXACT same as dashboard)\n        const orderDate = new Date(\n          order.orderedAt ||\n            order.createdAt ||\n            order.created_at ||\n            order.paidAt,\n        );\n\n        // Skip if date is invalid (EXACT same as dashboard)\n        if (isNaN(orderDate.getTime())) {\n          console.log(\n            \"Invalid order date for order:\",\n            order.id,\n            \"date fields:\",\n            {\n              orderedAt: order.orderedAt,\n              createdAt: order.createdAt,\n              created_at: order.created_at,\n              paidAt: order.paidAt,\n            },\n          );\n          return false;\n        }\n\n        const dateMatch = orderDate >= start && orderDate <= end;\n\n        const employeeMatch =\n          selectedEmployee === \"all\" ||\n          order.employeeName === selectedEmployee ||\n          order.cashierName === selectedEmployee ||\n          order.employeeId?.toString() === selectedEmployee ||\n          (order.employeeName &&\n            order.employeeName.includes(selectedEmployee)) ||\n          (order.cashierName && order.cashierName.includes(selectedEmployee));\n\n        return dateMatch && employeeMatch;\n      });\n\n      // Convert orders to transaction-like format for compatibility\n      const filteredTransactions = filteredCompletedOrders.map(\n        (order: any) => ({\n          id: order.id,\n          orderNumber: order.orderNumber,\n          transactionId: `TXN-${order.id}`,\n          total: order.total,\n          subtotal: order.subtotal,\n          discount: order.discount || 0,\n          paymentMethod: order.paymentMethod || \"cash\",\n          createdAt:\n            order.orderedAt ||\n            order.createdAt ||\n            order.created_at ||\n            order.paidAt,\n          created_at:\n            order.orderedAt ||\n            order.createdAt ||\n            order.created_at ||\n            order.paidAt,\n          customerName: order.customerName,\n          customerId: order.customerId,\n          cashierName: order.employeeName || order.cashierName,\n          employeeId: order.employeeId,\n          items: order.items || [],\n          status: order.status,\n        }),\n      );\n\n      console.log(\"Employee Report Debug:\", {\n        totalOrders: orders.length,\n        startDate,\n        endDate,\n        completedOrders: orders.filter(\n          (o: any) => o.status === \"completed\" || o.status === \"paid\",\n        ).length,\n        filteredCompletedOrders: filteredCompletedOrders.length,\n        selectedEmployee,\n        sampleOrderDates: orders.slice(0, 3).map((o: any) => ({\n          id: o.id,\n          status: o.status,\n          employeeName: o.employeeName || o.cashierName,\n          orderedAt: o.orderedAt,\n          createdAt: o.createdAt,\n          created_at: o.created_at,\n          paidAt: o.paidAt,\n        })),\n      });\n\n      // Group orders by employee and extract payment methods\n      const employeeData: {\n        [employeeKey: string]: {\n          employeeCode: string;\n          employeeName: string;\n          orderCount: number;\n          revenue: number;\n          tax: number;\n          total: number;\n          paymentMethods: { [method: string]: number };\n        };\n      } = {};\n\n      // Get all unique payment methods from filtered orders\n      const allPaymentMethods = new Set<string>();\n      filteredCompletedOrders.forEach((order: any) => {\n        const method = order.paymentMethod || \"cash\";\n        allPaymentMethods.add(method);\n      });\n\n      filteredCompletedOrders.forEach((order: any) => {\n        // Get employee name - try multiple fields\n        const employeeName =\n          order.employeeName || order.cashierName || \"Unknown Employee\";\n\n        const employeeKey = `${order.employeeId || 0}-${employeeName}`;\n\n        if (!employeeData[employeeKey]) {\n          employeeData[employeeKey] = {\n            employeeCode: order.employeeId?.toString() || \"Unknown\",\n            employeeName: employeeName,\n            orderCount: 0,\n            revenue: 0,\n            tax: 0,\n            total: 0,\n            paymentMethods: {},\n          };\n        }\n\n        // Add payment method to all methods set\n        const paymentMethod = order.paymentMethod || \"cash\";\n        allPaymentMethods.add(paymentMethod);\n\n        // Initialize payment method if not exists\n        if (!employeeData[employeeKey].paymentMethods[paymentMethod]) {\n          employeeData[employeeKey].paymentMethods[paymentMethod] = 0;\n        }\n\n        // Calculate amounts using actual tax from database (default to 0)\n        const orderTotal = Number(order.total || 0);\n        const discount = Number(order.discount || 0);\n        // Use actual tax from database, default to 0 if not available\n        const tax = Number(order.tax || 0);\n\n        const revenue = orderTotal - discount - tax;\n\n        // Update employee data\n        employeeData[employeeKey].orderCount += 1;\n        employeeData[employeeKey].revenue += revenue;\n        employeeData[employeeKey].tax += tax;\n        employeeData[employeeKey].total += orderTotal;\n        employeeData[employeeKey].paymentMethods[paymentMethod] += revenue;\n      });\n\n      const data = Object.values(employeeData).sort(\n        (a, b) => b.total - a.total,\n      );\n\n      // Pagination logic\n      const totalPages = Math.ceil(data.length / employeePageSize);\n      const startIndex = (employeeCurrentPage - 1) * employeePageSize;\n      const endIndex = startIndex + employeePageSize;\n      const paginatedData = data.slice(startIndex, endIndex);\n\n      const paymentMethodsArray = Array.from(allPaymentMethods).sort();\n\n      return (\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Users className=\"w-5 h-5\" />\n              {t(\"reports.employeeSalesReport\")}\n            </CardTitle>\n            <CardDescription>\n              {t(\"reports.fromDate\")}: {formatDate(startDate)} -{\" \"}\n              {t(\"reports.toDate\")}: {formatDate(endDate)}\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"w-full\">\n              <div className=\"overflow-x-auto xl:overflow-x-visible\">\n                <Table className=\"w-full min-w-[1400px] xl:min-w-full\">\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead\n                        className=\"text-center border-r bg-green-50 w-12\"\n                        rowSpan={2}\n                      ></TableHead>\n                      <TableHead\n                        className=\"text-center border-r bg-green-50 min-w-[120px]\"\n                        rowSpan={2}\n                      >\n                        {t(\"reports.employeeId\")}\n                      </TableHead>\n                      <TableHead\n                        className=\"text-center border-r bg-green-50 min-w-[150px]\"\n                        rowSpan={2}\n                      >\n                        {t(\"reports.seller\")}\n                      </TableHead>\n                      <TableHead\n                        className=\"text-center border-r min-w-[100px]\"\n                        rowSpan={2}\n                      >\n                        {t(\"reports.orders\")}\n                      </TableHead>\n                      <TableHead\n                        className=\"text-right border-r min-w-[140px]\"\n                        rowSpan={2}\n                      >\n                        {t(\"reports.revenue\")}\n                      </TableHead>\n                      <TableHead\n                        className=\"text-right border-r min-w-[120px]\"\n                        rowSpan={2}\n                      >\n                        {t(\"reports.tax\")}\n                      </TableHead>\n                      <TableHead\n                        className=\"text-right border-r min-w-[140px]\"\n                        rowSpan={2}\n                      >\n                        {t(\"reports.total\")}\n                      </TableHead>\n                      <TableHead\n                        className=\"text-center border-r bg-blue-50 min-w-[200px]\"\n                        colSpan={(() => {\n                          // Get all unique payment methods from transactions\n                          const allPaymentMethods = new Set();\n                          if (\n                            filteredTransactions &&\n                            Array.isArray(filteredTransactions)\n                          ) {\n                            filteredTransactions.forEach((transaction: any) => {\n                              const method =\n                                transaction.paymentMethod || \"cash\";\n                              allPaymentMethods.add(method);\n                            });\n                          }\n                          return allPaymentMethods.size + 1; // +1 for total column\n                        })()}\n                      >\n                        {t(\"reports.totalCustomerPayment\")}\n                      </TableHead>\n                    </TableRow>\n                    <TableRow>\n                      {(() => {\n                        // Get all unique payment methods from transactions\n                        const allPaymentMethods = new Set();\n                        if (\n                          filteredTransactions &&\n                          Array.isArray(filteredTransactions)\n                        ) {\n                          filteredTransactions.forEach((transaction: any) => {\n                            const method = transaction.paymentMethod || \"cash\";\n                            allPaymentMethods.add(method);\n                          });\n                        }\n\n                        const paymentMethodsArray =\n                          Array.from(allPaymentMethods).sort();\n\n                        return (\n                          <>\n                            {paymentMethodsArray.map((method: any) => (\n                              <TableHead\n                                key={method}\n                                className=\"text-center border-r bg-blue-50 min-w-[130px]\"\n                              >\n                                {getPaymentMethodLabel(method)}\n                              </TableHead>\n                            ))}\n                            <TableHead className=\"text-center bg-blue-50 min-w-[150px]\">\n                              {t(\"reports.totalCustomerPayment\")}\n                            </TableHead>\n                          </>\n                        );\n                      })()}\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {paginatedData.length > 0 ? (\n                      paginatedData.map((item, index) => {\n                        const isExpanded =\n                          expandedRows[`emp-${item.employeeCode}`] || false;\n                        const employeeTransactions =\n                          filteredTransactions.filter((transaction: any) => {\n                            const employeeCode =\n                              transaction.employeeId || \"EMP-000\";\n                            const employeeName =\n                              transaction.cashierName ||\n                              transaction.employeeName ||\n                              \"Unknown\";\n                            const employeeKey = `${employeeCode}-${employeeName}`;\n                            return (\n                              employeeKey ===\n                              `${item.employeeCode}-${item.employeeName}`\n                            );\n                          });\n\n                        return (\n                          <>\n                            <TableRow\n                              key={`${item.employeeCode}-${index}`}\n                              className=\"hover:bg-gray-50\"\n                            >\n                              <TableCell className=\"text-center border-r w-12\">\n                                <button\n                                  onClick={() =>\n                                    setExpandedRows((prev) => ({\n                                      ...prev,\n                                      [`emp-${item.employeeCode}`]:\n                                        !prev[`emp-${item.employeeCode}`],\n                                    }))\n                                  }\n                                  className=\"w-8 h-8 flex items-center justify-center hover:bg-gray-200 rounded text-sm\"\n                                >\n                                  {isExpanded ? \"−\" : \"+\"}\n                                </button>\n                              </TableCell>\n                              <TableCell className=\"text-center border-r bg-green-50 font-medium min-w-[120px] px-4\">\n                                {item.employeeCode}\n                              </TableCell>\n                              <TableCell className=\"text-center border-r bg-green-50 font-medium min-w-[150px] px-4\">\n                                {item.employeeName}\n                              </TableCell>\n                              <TableCell className=\"text-center border-r min-w-[100px] px-4\">\n                                {item.orderCount.toLocaleString()}\n                              </TableCell>\n                              <TableCell className=\"text-right border-r text-green-600 font-medium min-w-[140px] px-4\">\n                                {formatCurrency(item.revenue)}\n                              </TableCell>\n                              <TableCell className=\"text-right border-r min-w-[120px] px-4\">\n                                {formatCurrency(item.tax)}\n                              </TableCell>\n                              <TableCell className=\"text-right border-r font-bold text-blue-600 min-w-[140px] px-4\">\n                                {formatCurrency(item.total)}\n                              </TableCell>\n                              {(() => {\n                                // Group transactions by payment method for this employee\n                                const paymentMethods: {\n                                  [method: string]: number;\n                                } = {};\n                                employeeTransactions.forEach(\n                                  (transaction: any) => {\n                                    const method =\n                                      transaction.paymentMethod || \"cash\";\n                                    paymentMethods[method] =\n                                      (paymentMethods[method] || 0) +\n                                      Number(transaction.total);\n                                  },\n                                );\n\n                                // Get all unique payment methods from all transactions\n                                const allPaymentMethods = new Set();\n                                if (\n                                  filteredTransactions &&\n                                  Array.isArray(filteredTransactions)\n                                ) {\n                                  filteredTransactions.forEach(\n                                    (transaction: any) => {\n                                      const method =\n                                        transaction.paymentMethod || \"cash\";\n                                      allPaymentMethods.add(method);\n                                    },\n                                  );\n                                }\n\n                                const paymentMethodsArray =\n                                  Array.from(allPaymentMethods).sort();\n                                const totalCustomerPayment = Object.values(\n                                  paymentMethods,\n                                ).reduce(\n                                  (sum: number, amount: number) => sum + amount,\n                                  0,\n                                );\n\n                                return (\n                                  <>\n                                    {paymentMethodsArray.map((method: any) => {\n                                      const amount =\n                                        paymentMethods[method] || 0;\n                                      return (\n                                        <TableCell\n                                          key={method}\n                                          className=\"text-right border-r font-medium min-w-[130px] px-4\"\n                                        >\n                                          {amount > 0\n                                            ? formatCurrency(amount)\n                                            : \"-\"}\n                                        </TableCell>\n                                      );\n                                    })}\n                                    <TableCell className=\"text-right font-bold text-green-600 min-w-[150px] px-4\">\n                                      {formatCurrency(totalCustomerPayment)}\n                                    </TableCell>\n                                  </>\n                                );\n                              })()}\n                            </TableRow>\n\n                            {/* Expanded order details */}\n                            {isExpanded &&\n                              employeeTransactions.length > 0 &&\n                              employeeTransactions.map(\n                                (\n                                  transaction: any,\n                                  transactionIndex: number,\n                                ) => (\n                                  <TableRow\n                                    key={`${item.employeeCode}-transaction-${transaction.id || transactionIndex}`}\n                                    className=\"bg-blue-50/50 border-l-4 border-l-blue-400\"\n                                  >\n                                    <TableCell className=\"text-center border-r bg-blue-50 w-12\">\n                                      <div className=\"w-8 h-6 flex items-center justify-center text-blue-600 text-xs\">\n                                        └\n                                      </div>\n                                    </TableCell>\n                                    <TableCell className=\"text-center border-r text-blue-600 text-sm min-w-[120px] px-4\">\n                                      {transaction.transactionId ||\n                                        `TXN-${transaction.id}`}\n                                    </TableCell>\n                                    <TableCell className=\"text-center border-r text-sm min-w-[150px] px-4\">\n                                      {new Date(\n                                        transaction.createdAt ||\n                                          transaction.created_at,\n                                      ).toLocaleDateString(\"vi-VN\")}{\" \"}\n                                      {new Date(\n                                        transaction.createdAt ||\n                                          transaction.created_at,\n                                      ).toLocaleTimeString(\"vi-VN\", {\n                                        hour: \"2-digit\",\n                                        minute: \"2-digit\",\n                                      })}\n                                    </TableCell>\n                                    <TableCell className=\"text-center border-r text-sm min-w-[100px] px-4\">\n                                      1\n                                    </TableCell>\n                                    <TableCell className=\"text-right border-r text-green-600 font-medium text-sm min-w-[140px] px-4\">\n                                      {formatCurrency(\n                                        Number(transaction.total),\n                                      )}\n                                    </TableCell>\n                                    <TableCell className=\"text-right border-r text-sm min-w-[120px] px-4\">\n                                      {formatCurrency(\n                                        Number(transaction.total) * 0.1,\n                                      )}\n                                    </TableCell>\n                                    <TableCell className=\"text-right border-r font-bold text-blue-600 text-sm min-w-[140px] px-4\">\n                                      {formatCurrency(\n                                        Number(transaction.total),\n                                      )}\n                                    </TableCell>\n                                    {(() => {\n                                      const transactionMethod =\n                                        transaction.paymentMethod || \"cash\";\n                                      const amount = Number(transaction.total);\n\n                                      // Get all unique payment methods from all transactions\n                                      const allPaymentMethods = new Set();\n                                      if (\n                                        filteredTransactions &&\n                                        Array.isArray(filteredTransactions)\n                                      ) {\n                                        filteredTransactions.forEach(\n                                          (transaction: any) => {\n                                            const method =\n                                              transaction.paymentMethod ||\n                                              \"cash\";\n                                            allPaymentMethods.add(method);\n                                          },\n                                        );\n                                      }\n\n                                      const paymentMethodsArray =\n                                        Array.from(allPaymentMethods).sort();\n\n                                      return (\n                                        <>\n                                          {paymentMethodsArray.map(\n                                            (method: any) => (\n                                              <TableCell\n                                                key={method}\n                                                className=\"text-right border-r text-sm min-w-[130px] px-4\"\n                                              >\n                                                {transactionMethod === method\n                                                  ? formatCurrency(amount)\n                                                  : \"-\"}\n                                              </TableCell>\n                                            ),\n                                          )}\n                                          <TableCell className=\"text-right font-bold text-green-600 text-sm min-w-[150px] px-4\">\n                                            {formatCurrency(amount)}\n                                          </TableCell>\n                                        </>\n                                      );\n                                    })()}\n                                  </TableRow>\n                                ),\n                              )}\n                          </>\n                        );\n                      })\n                    ) : (\n                      <TableRow>\n                        <TableCell\n                          colSpan={(() => {\n                            // Calculate column count: 6 base columns + payment methods + total\n                            const allPaymentMethods = new Set();\n                            if (\n                              filteredTransactions &&\n                              Array.isArray(filteredTransactions)\n                            ) {\n                              filteredTransactions.forEach(\n                                (transaction: any) => {\n                                  const method =\n                                    transaction.paymentMethod || \"cash\";\n                                  allPaymentMethods.add(method);\n                                },\n                              );\n                            }\n                            return 6 + allPaymentMethods.size + 1;\n                          })()}\n                          className=\"text-center text-gray-500 py-8\"\n                        >\n                          {t(\"reports.noDataDescription\")}\n                        </TableCell>\n                      </TableRow>\n                    )}\n\n                    {/* Summary Row */}\n                    {data.length > 0 && (\n                      <TableRow className=\"bg-gray-100 font-bold border-t-2\">\n                        <TableCell className=\"text-center border-r w-12\"></TableCell>\n                        <TableCell className=\"text-center border-r bg-green-100 min-w-[120px] px-4\">\n                          {t(\"common.total\")}\n                        </TableCell>\n                        <TableCell className=\"text-center border-r bg-green-100 min-w-[150px] px-4\">\n                          {data.length} khách hàng\n                        </TableCell>\n                        <TableCell className=\"text-center border-r min-w-[100px] px-4\">\n                          {data\n                            .reduce((sum, item) => sum + item.orderCount, 0)\n                            .toLocaleString()}\n                        </TableCell>\n                        <TableCell className=\"text-right border-r text-green-600 min-w-[140px] px-4\">\n                          {formatCurrency(\n                            data.reduce((sum, item) => sum + item.revenue, 0),\n                          )}\n                        </TableCell>\n                        <TableCell className=\"text-right border-r min-w-[120px] px-4\">\n                          {formatCurrency(\n                            data.reduce((sum, item) => sum + item.tax, 0),\n                          )}\n                        </TableCell>\n                        <TableCell className=\"text-right border-r font-bold text-blue-600 min-w-[140px] px-4\">\n                          {formatCurrency(\n                            data.reduce((sum, item) => sum + item.total, 0),\n                          )}\n                        </TableCell>\n                        {(() => {\n                          // Calculate total payment methods across all employees\n                          const totalPaymentMethods: {\n                            [method: string]: number;\n                          } = {};\n                          filteredTransactions.forEach((transaction: any) => {\n                            const method = transaction.paymentMethod || \"cash\";\n                            totalPaymentMethods[method] =\n                              (totalPaymentMethods[method] || 0) +\n                              Number(transaction.total);\n                          });\n\n                          // Get all unique payment methods from all transactions\n                          const allPaymentMethods = new Set();\n                          filteredTransactions.forEach((transaction: any) => {\n                            const method = transaction.paymentMethod || \"cash\";\n                            allPaymentMethods.add(method);\n                          });\n\n                          const paymentMethodsArray =\n                            Array.from(allPaymentMethods).sort();\n                          const grandTotal = Object.values(\n                            totalPaymentMethods,\n                          ).reduce(\n                            (sum: number, amount: number) => sum + amount,\n                            0,\n                          );\n\n                          return (\n                            <>\n                              {paymentMethodsArray.map((method: any) => {\n                                const total = totalPaymentMethods[method] || 0;\n                                return (\n                                  <TableCell\n                                    key={method}\n                                    className=\"text-right border-r font-bold text-green-600 min-w-[130px] px-4\"\n                                  >\n                                    {total > 0 ? formatCurrency(total) : \"-\"}\n                                  </TableCell>\n                                );\n                              })}\n                              <TableCell className=\"text-right font-bold text-green-600 text-xl min-w-[150px] px-4\">\n                                {formatCurrency(grandTotal)}\n                              </TableCell>\n                            </>\n                          );\n                        })()}\n                      </TableRow>\n                    )}\n                  </TableBody>\n                </Table>\n              </div>\n            </div>\n\n            {/* Pagination Controls for Employee Report */}\n            {data.length > 0 && (\n              <div className=\"flex items-center justify-between space-x-6 py-4\">\n                <div className=\"flex items-center space-x-2\">\n                  <p className=\"text-sm font-medium\">{t(\"common.show\")} </p>\n                  <Select\n                    value={employeePageSize.toString()}\n                    onValueChange={(value) => {\n                      setEmployeePageSize(Number(value));\n                      setEmployeeCurrentPage(1);\n                    }}\n                  >\n                    <SelectTrigger className=\"h-8 w-[70px]\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent side=\"top\">\n                      <SelectItem value=\"15\">15</SelectItem>\n                      <SelectItem value=\"20\">20</SelectItem>\n                      <SelectItem value=\"30\">30</SelectItem>\n                      <SelectItem value=\"50\">50</SelectItem>\n                      <SelectItem value=\"100\">100</SelectItem>\n                    </SelectContent>\n                  </Select>\n                  <p className=\"text-sm font-medium\"> {t(\"common.rows\")}</p>\n                </div>\n\n                <div className=\"flex items-center space-x-2\">\n                  <p className=\"text-sm font-medium\">\n                    {t(\"common.page\")} {employeeCurrentPage} / {totalPages}\n                  </p>\n                  <div className=\"flex items-center space-x-1\">\n                    <button\n                      onClick={() => setEmployeeCurrentPage(1)}\n                      disabled={employeeCurrentPage === 1}\n                      className=\"inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-8 w-8\"\n                    >\n                      «\n                    </button>\n                    <button\n                      onClick={() =>\n                        setEmployeeCurrentPage((prev) => Math.max(prev - 1, 1))\n                      }\n                      disabled={employeeCurrentPage === 1}\n                      className=\"inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-8 w-8\"\n                    >\n                      ‹\n                    </button>\n                    <button\n                      onClick={() =>\n                        setEmployeeCurrentPage((prev) =>\n                          Math.min(prev + 1, totalPages),\n                        )\n                      }\n                      disabled={employeeCurrentPage === totalPages}\n                      className=\"inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-8 w-8\"\n                    >\n                      ›\n                    </button>\n                    <button\n                      onClick={() => setEmployeeCurrentPage(totalPages)}\n                      disabled={employeeCurrentPage === totalPages}\n                      className=\"inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-8 w-8\"\n                    >\n                      »\n                    </button>\n                  </div>\n                </div>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      );\n    } catch (error) {\n      console.error(\"Error in renderEmployeeReport:\", error);\n      return (\n        <div className=\"flex justify-center py-8\">\n          <div className=\"text-red-500\">\n            <p>Có lỗi xảy ra khi hiển thị báo cáo nhân viên</p>\n            <p className=\"text-sm\">{error?.message || \"Unknown error\"}</p>\n          </div>\n        </div>\n      );\n    }\n  };\n\n  // Customer Report with Pagination State\n  // const [customerCurrentPage, setCustomerCurrentPage] = useState(1); // Moved up\n  // const [customerPageSize, setCustomerPageSize] = useState(15); // Moved up\n\n  // Legacy Customer Report Component Logic\n  const renderCustomerReport = () => {\n    if (!orders || !Array.isArray(orders)) {\n      return (\n        <div className=\"flex justify-center py-8\">\n          <div className=\"text-gray-500\">{t(\"reports.loading\")}...</div>\n        </div>\n      );\n    }\n\n    const start = new Date(startDate);\n    const end = new Date(endDate);\n    end.setHours(23, 59, 59, 999);\n\n    const filteredOrders = orders.filter((order: any) => {\n      const orderDate = new Date(\n        order.orderedAt || order.created_at || order.createdAt,\n      );\n      const dateMatch = orderDate >= start && orderDate <= end;\n\n      const customerMatch =\n        !customerSearch ||\n        (order.customerName &&\n          order.customerName\n            .toLowerCase()\n            .includes(customerSearch.toLowerCase())) ||\n        (order.customerPhone && order.customerPhone.includes(customerSearch)) ||\n        (order.customerId &&\n          order.customerId.toString().includes(customerSearch));\n\n      // Status filter logic\n      let statusMatch = true;\n      if (customerStatus !== \"all\") {\n        const orderTotal = Number(order.total || 0);\n        const customerId = order.customerId;\n\n        switch (customerStatus) {\n          case \"active\":\n            // Customer has recent orders (within last 30 days)\n            const thirtyDaysAgo = new Date();\n            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n            statusMatch = orderDate >= thirtyDaysAgo;\n            break;\n          case \"inactive\":\n            // Customer hasn't ordered in last 30 days\n            const thirtyDaysAgoInactive = new Date();\n            thirtyDaysAgoInactive.setDate(thirtyDaysAgoInactive.getDate() - 30);\n            statusMatch = orderDate < thirtyDaysAgoInactive;\n            break;\n          case \"vip\":\n            // VIP customers with orders > 500,000 VND\n            statusMatch = orderTotal >= 500000;\n            break;\n          case \"new\":\n            // New customers (first order within date range)\n            statusMatch = customerId && customerId !== \"guest\";\n            break;\n          default:\n            statusMatch = true;\n        }\n      }\n\n      return (\n        dateMatch && customerMatch && statusMatch && order.status === \"paid\"\n      );\n    });\n\n    const customerData: {\n      [customerId: string]: {\n        customerId: string;\n        customerName: string;\n        customerGroup: string;\n        orders: number;\n        totalAmount: number;\n        discount: number;\n        revenue: number;\n        status: string;\n        orderDetails: any[];\n      };\n    } = {};\n\n    filteredOrders.forEach((order: any) => {\n      const customerId = order.customerId || \"guest\";\n      const customerName = order.customerName || \"Khách lẻ\";\n\n      if (!customerData[customerId]) {\n        customerData[customerId] = {\n          customerId: customerId === \"guest\" ? \"KL-001\" : customerId,\n          customerName: customerName,\n          customerGroup: t(\"common.regularCustomer\"), // Default group\n          orders: 0,\n          totalAmount: 0,\n          discount: 0,\n          revenue: 0,\n          status: t(\"reports.active\"),\n          orderDetails: [],\n        };\n      }\n\n      const orderTotal = Number(order.total);\n      const orderSubtotal = Number(order.subtotal || orderTotal * 1.1); // Calculate subtotal if not available\n      const orderDiscount = orderSubtotal - orderTotal;\n\n      customerData[customerId].orders += 1;\n      customerData[customerId].totalAmount += orderSubtotal;\n      customerData[customerId].discount += orderDiscount;\n      customerData[customerId].revenue += orderTotal;\n      customerData[customerId].orderDetails.push(order);\n\n      // Determine customer group based on total spending\n      if (customerData[customerId].revenue >= 1000000) {\n        customerData[customerId].customerGroup = t(\"reports.vip\");\n      } else if (customerData[customerId].revenue >= 500000) {\n        customerData[customerId].customerGroup = t(\"common.goldCustomer\");\n      }\n    });\n\n    const data = Object.values(customerData).sort(\n      (a, b) => b.revenue - a.revenue,\n    );\n\n    // Pagination logic\n    const totalPages = Math.ceil(data.length / customerPageSize);\n    const startIndex = (customerCurrentPage - 1) * customerPageSize;\n    const endIndex = startIndex + customerPageSize;\n    const paginatedData = data.slice(startIndex, endIndex);\n\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Users className=\"w-5 h-5\" />\n            {t(\"reports.customerSalesReport\")}\n          </CardTitle>\n          <CardDescription>\n            {t(\"reports.fromDate\")}: {formatDate(startDate)} -{\" \"}\n            {t(\"reports.toDate\")}: {formatDate(endDate)}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"w-full\">\n            <div className=\"overflow-x-auto xl:overflow-x-visible\">\n              <Table className=\"w-full min-w-[1000px] xl:min-w-full\">\n                <TableHeader>\n                  <TableRow>\n                    <TableHead\n                      className=\"text-center border-r bg-green-50 w-12\"\n                      rowSpan={1}\n                    ></TableHead>\n                    <TableHead className=\"text-center border-r bg-green-50 min-w-[120px]\">\n                      {t(\"reports.customerId\")}\n                    </TableHead>\n                    <TableHead className=\"text-center border-r bg-green-50 min-w-[150px]\">\n                      {t(\"reports.customerName\")}\n                    </TableHead>\n                    <TableHead className=\"text-center border-r min-w-[100px]\">\n                      {t(\"reports.orders\")}\n                    </TableHead>\n                    <TableHead className=\"text-center border-r min-w-[130px]\">\n                      {t(\"common.customerGroup\")}\n                    </TableHead>\n                    <TableHead className=\"text-right border-r min-w-[140px]\">\n                      {t(\"reports.totalAmount\")}\n                    </TableHead>\n                    <TableHead className=\"text-right border-r min-w-[120px]\">\n                      {t(\"reports.discount\")}\n                    </TableHead>\n                    <TableHead className=\"text-right border-r min-w-[140px]\">\n                      {t(\"reports.revenue\")}\n                    </TableHead>\n                    <TableHead className=\"text-center min-w-[100px]\">\n                      {t(\"reports.status\")}\n                    </TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {paginatedData.length > 0 ? (\n                    paginatedData.map((item, index) => {\n                      const isExpanded = expandedRows[item.customerId] || false;\n\n                      return (\n                        <>\n                          <TableRow\n                            key={`${item.customerId}-${index}`}\n                            className=\"hover:bg-gray-50\"\n                          >\n                            <TableCell className=\"text-center border-r w-12\">\n                              <button\n                                onClick={() =>\n                                  setExpandedRows((prev) => ({\n                                    ...prev,\n                                    [item.customerId]: !prev[item.customerId],\n                                  }))\n                                }\n                                className=\"w-8 h-8 flex items-center justify-center hover:bg-gray-200 rounded text-sm\"\n                              >\n                                {isExpanded ? \"−\" : \"+\"}\n                              </button>\n                            </TableCell>\n                            <TableCell className=\"text-center border-r bg-green-50 font-medium min-w-[120px] px-4\">\n                              {item.customerId}\n                            </TableCell>\n                            <TableCell className=\"text-center border-r bg-green-50 min-w-[150px] px-4\">\n                              {item.customerName}\n                            </TableCell>\n                            <TableCell className=\"text-center border-r min-w-[100px] px-4\">\n                              {item.orders}\n                            </TableCell>\n                            <TableCell className=\"text-center border-r min-w-[130px] px-4\">\n                              <Badge\n                                variant={\n                                  item.customerGroup === t(\"reports.vip\")\n                                    ? \"default\"\n                                    : \"secondary\"\n                                }\n                              >\n                                {item.customerGroup}\n                              </Badge>\n                            </TableCell>\n                            <TableCell className=\"text-right border-r min-w-[140px] px-4\">\n                              {formatCurrency(item.totalAmount)}\n                            </TableCell>\n                            <TableCell className=\"text-right border-r text-red-600 min-w-[120px] px-4\">\n                              {formatCurrency(item.discount)}\n                            </TableCell>\n                            <TableCell className=\"text-right border-r text-green-600 font-medium min-w-[140px] px-4\">\n                              {formatCurrency(item.revenue)}\n                            </TableCell>\n                            <TableCell className=\"text-center min-w-[100px] px-4\">\n                              <Badge\n                                variant={\n                                  item.status === t(\"reports.active\")\n                                    ? \"default\"\n                                    : \"secondary\"\n                                }\n                                className=\"text-xs\"\n                              >\n                                {t(\"reports.active\")}\n                              </Badge>\n                            </TableCell>\n                          </TableRow>\n\n                          {/* Expanded order details */}\n                          {isExpanded &&\n                            item.orderDetails.length > 0 &&\n                            item.orderDetails.map(\n                              (order: any, orderIndex: number) => (\n                                <TableRow\n                                  key={`${item.customerId}-order-${order.id || orderIndex}`}\n                                  className=\"bg-blue-50/50 border-l-4 border-l-blue-400\"\n                                >\n                                  <TableCell className=\"text-center border-r bg-blue-50 w-12\">\n                                    <div className=\"w-8 h-6 flex items-center justify-center text-blue-600 text-xs\">\n                                      └\n                                    </div>\n                                  </TableCell>\n                                  <TableCell className=\"text-center border-r text-blue-600 text-sm min-w-[120px] px-4\">\n                                    {order.orderNumber ||\n                                      order.transactionId ||\n                                      `ORD-${order.id}`}\n                                  </TableCell>\n                                  <TableCell className=\"text-center border-r text-sm min-w-[150px] px-4\">\n                                    {new Date(\n                                      order.orderedAt || order.created_at,\n                                    ).toLocaleDateString(\"vi-VN\")}{\" \"}\n                                    {new Date(\n                                      order.orderedAt || order.created_at,\n                                    ).toLocaleTimeString(\"vi-VN\", {\n                                      hour: \"2-digit\",\n                                      minute: \"2-digit\",\n                                    })}\n                                  </TableCell>\n                                  <TableCell className=\"text-center border-r text-sm min-w-[100px] px-4\">\n                                    1\n                                  </TableCell>\n                                  <TableCell className=\"text-center border-r text-sm min-w-[130px] px-4\">\n                                    {getPaymentMethodLabel(order.paymentMethod)}\n                                  </TableCell>\n                                  <TableCell className=\"text-right border-r text-sm min-w-[140px] px-4\">\n                                    {formatCurrency(\n                                      Number(\n                                        order.subtotal ||\n                                          Number(order.total) * 1.1,\n                                      ),\n                                    )}\n                                  </TableCell>\n                                  <TableCell className=\"text-right border-r text-red-600 text-sm min-w-[120px] px-4\">\n                                    {formatCurrency(\n                                      Number(\n                                        order.subtotal ||\n                                          Number(order.total) * 1.1,\n                                      ) - Number(order.total),\n                                    )}\n                                  </TableCell>\n                                  <TableCell className=\"text-right border-r text-green-600 font-medium text-sm min-w-[140px] px-4\">\n                                    {formatCurrency(Number(order.total))}\n                                  </TableCell>\n                                  <TableCell className=\"text-center text-sm min-w-[100px] px-4\">\n                                    <Badge\n                                      variant={\n                                        order.status === \"paid\"\n                                          ? \"default\"\n                                          : \"secondary\"\n                                      }\n                                      className=\"text-xs\"\n                                    >\n                                      {order.status === \"paid\"\n                                        ? t(\"common.paid\")\n                                        : order.status}\n                                    </Badge>\n                                  </TableCell>\n                                </TableRow>\n                              ),\n                            )}\n                        </>\n                      );\n                    })\n                  ) : (\n                    <TableRow>\n                      <TableCell\n                        colSpan={9}\n                        className=\"text-center text-gray-500\"\n                      >\n                        {t(\"reports.noDataDescription\")}\n                      </TableCell>\n                    </TableRow>\n                  )}\n\n                  {/* Summary Row */}\n                  {data.length > 0 && (\n                    <TableRow className=\"bg-gray-100 font-bold border-t-2\">\n                      <TableCell className=\"text-center border-r w-12\"></TableCell>\n                      <TableCell className=\"text-center border-r bg-green-100 min-w-[120px] px-4\">\n                        {t(\"common.total\")}\n                      </TableCell>\n                      <TableCell className=\"text-center border-r bg-green-100 min-w-[150px] px-4\">\n                        {data.length} khách hàng\n                      </TableCell>\n                      <TableCell className=\"text-center border-r min-w-[100px] px-4\">\n                        {data\n                          .reduce((sum, item) => sum + item.orders, 0)\n                          .toLocaleString()}\n                      </TableCell>\n                      <TableCell className=\"text-center border-r min-w-[130px] px-4\"></TableCell>\n                      <TableCell className=\"text-right border-r min-w-[140px] px-4\">\n                        {formatCurrency(\n                          data.reduce((sum, item) => sum + item.totalAmount, 0),\n                        )}\n                      </TableCell>\n                      <TableCell className=\"text-right border-r text-red-600 min-w-[120px] px-4\">\n                        {formatCurrency(\n                          data.reduce((sum, item) => sum + item.discount, 0),\n                        )}\n                      </TableCell>\n                      <TableCell className=\"text-right border-r text-green-600 min-w-[140px] px-4\">\n                        {formatCurrency(\n                          data.reduce((sum, item) => sum + item.revenue, 0),\n                        )}\n                      </TableCell>\n                      <TableCell className=\"text-center min-w-[100px] px-4\"></TableCell>\n                    </TableRow>\n                  )}\n                </TableBody>\n              </Table>\n            </div>\n          </div>\n\n          {/* Pagination Controls for Customer Report */}\n          {data.length > 0 && (\n            <div className=\"flex items-center justify-between space-x-6 py-4\">\n              <div className=\"flex items-center space-x-2\">\n                <p className=\"text-sm font-medium\">{t(\"common.show\")} </p>\n                <Select\n                  value={customerPageSize.toString()}\n                  onValueChange={(value) => {\n                    setCustomerPageSize(Number(value));\n                    setCustomerCurrentPage(1);\n                  }}\n                >\n                  <SelectTrigger className=\"h-8 w-[70px]\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent side=\"top\">\n                    <SelectItem value=\"15\">15</SelectItem>\n                    <SelectItem value=\"20\">20</SelectItem>\n                    <SelectItem value=\"30\">30</SelectItem>\n                    <SelectItem value=\"50\">50</SelectItem>\n                    <SelectItem value=\"100\">100</SelectItem>\n                  </SelectContent>\n                </Select>\n                <p className=\"text-sm font-medium\"> {t(\"common.rows\")}</p>\n              </div>\n\n              <div className=\"flex items-center space-x-2\">\n                <p className=\"text-sm font-medium\">\n                  {t(\"common.page\")} {customerCurrentPage} / {totalPages}\n                </p>\n                <div className=\"flex items-center space-x-1\">\n                  <button\n                    onClick={() => setCustomerCurrentPage(1)}\n                    disabled={customerCurrentPage === 1}\n                    className=\"inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-8 w-8\"\n                  >\n                    «\n                  </button>\n                  <button\n                    onClick={() =>\n                      setCustomerCurrentPage((prev) => Math.max(prev - 1, 1))\n                    }\n                    disabled={customerCurrentPage === 1}\n                    className=\"inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-8 w-8\"\n                  >\n                    ‹\n                  </button>\n                  <button\n                    onClick={() =>\n                      setCustomerCurrentPage((prev) =>\n                        Math.min(prev + 1, totalPages),\n                      )\n                    }\n                    disabled={customerCurrentPage === totalPages}\n                    className=\"inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-8 w-8\"\n                  >\n                    ›\n                  </button>\n                  <button\n                    onClick={() => setCustomerCurrentPage(totalPages)}\n                    disabled={customerCurrentPage === totalPages}\n                    className=\"inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-8 w-8\"\n                  >\n                    »\n                  </button>\n                </div>\n              </div>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    );\n  };\n\n  // Legacy Sales Channel Report Component Logic\n  const renderSalesChannelReport = () => {\n    const dashboardStats = getDashboardStats();\n\n    if (!dashboardStats) {\n      return (\n        <div className=\"flex justify-center py-8\">\n          <div className=\"text-gray-500\">{t(\"reports.loading\")}...</div>\n        </div>\n      );\n    }\n\n    const { filteredCompletedOrders } = dashboardStats;\n\n    console.log(\"Sales Channel Report Debug:\", {\n      filteredCompletedOrders: filteredCompletedOrders.length,\n      sampleOrder: filteredCompletedOrders[0],\n    });\n\n    // Group data by sales method (Dine In vs Takeaway) - use EXACT same logic as dashboard\n    const salesMethodData: {\n      [method: string]: {\n        completedOrders: number;\n        cancelledOrders: number;\n        totalOrders: number;\n        completedRevenue: number;\n        cancelledRevenue: number;\n        totalRevenue: number;\n      };\n    } = {\n      [t(\"reports.dineIn\")]: {\n        completedOrders: 0,\n        cancelledOrders: 0,\n        totalOrders: 0,\n        completedRevenue: 0,\n        cancelledRevenue: 0,\n        totalRevenue: 0,\n      },\n      [t(\"reports.takeaway\")]: {\n        completedOrders: 0,\n        cancelledOrders: 0,\n        totalOrders: 0,\n        completedRevenue: 0,\n        cancelledRevenue: 0,\n        totalRevenue: 0,\n      },\n    };\n\n    // Process completed orders from dashboard (EXACT same data source)\n    filteredCompletedOrders.forEach((order: any) => {\n      // Determine sales method based on order properties\n      let method = t(\"reports.dineIn\"); // Default\n\n      // Check for delivery/takeaway indicators\n      if (\n        order.deliveryMethod === \"delivery\" ||\n        order.deliveryMethod === \"takeout\" ||\n        order.deliveryMethod === \"takeaway\" ||\n        order.isDelivery === true ||\n        order.salesChannel === \"delivery\" ||\n        order.salesChannel === \"takeout\" ||\n        order.salesChannel === \"takeaway\"\n      ) {\n        method = t(\"reports.takeaway\");\n      } else if (\n        order.deliveryMethod === \"dine_in\" ||\n        order.deliveryMethod === \"dinein\" ||\n        order.salesChannel === \"dine_in\" ||\n        order.tableId ||\n        order.tableNumber\n      ) {\n        method = t(\"reports.dineIn\");\n      }\n\n      // Use EXACT same revenue calculation as dashboard: total - discount\n      const orderTotal = Number(order.total || 0);\n      const discount = Number(order.discount || 0);\n      const revenue = orderTotal - discount;\n\n      // All orders from filteredCompletedOrders are already completed/paid\n      if (revenue > 0) {\n        salesMethodData[method].completedOrders += 1;\n        salesMethodData[method].completedRevenue += revenue;\n      }\n\n      salesMethodData[method].totalOrders =\n        salesMethodData[method].completedOrders;\n      salesMethodData[method].totalRevenue =\n        salesMethodData[method].completedRevenue;\n    });\n\n    console.log(\"Sales Method Data:\", salesMethodData);\n\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <BarChart3 className=\"w-5 h-5\" />\n            {t(\"reports.channelSalesReport\")}\n          </CardTitle>\n          <CardDescription>\n            {t(\"reports.fromDate\")}: {formatDate(startDate)} -{\" \"}\n            {t(\"reports.toDate\")}: {formatDate(endDate)}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"w-full\">\n            <div className=\"overflow-x-auto xl:overflow-x-visible\">\n              <Table className=\"w-full min-w-[800px] xl:min-w-full\">\n                <TableHeader>\n                  <TableRow>\n                    <TableHead\n                      className=\"text-center font-bold bg-green-100 border\"\n                      rowSpan={2}\n                    >\n                      {t(\"reports.salesMethod\")}\n                    </TableHead>\n                    <TableHead\n                      className=\"text-center font-bold bg-green-100 border\"\n                      colSpan={3}\n                    >\n                      {t(\"reports.totalOrders\")}\n                    </TableHead>\n                    <TableHead\n                      className=\"text-center font-bold bg-green-100 border\"\n                      colSpan={3}\n                    >\n                      {t(\"reports.revenue\")}\n                    </TableHead>\n                  </TableRow>\n                  <TableRow>\n                    <TableHead className=\"text-center bg-green-50 border\">\n                      {t(\"reports.completed\")}\n                    </TableHead>\n                    <TableHead className=\"text-center bg-green-50 border\">\n                      {t(\"reports.cancelled\")}\n                    </TableHead>\n                    <TableHead className=\"text-center bg-green-50 border\">\n                      {t(\"common.total\")}\n                    </TableHead>\n                    <TableHead className=\"text-center bg-green-50 border\">\n                      {t(\"reports.completed\")}\n                    </TableHead>\n                    <TableHead className=\"text-center bg-green-50 border\">\n                      {t(\"reports.cancelled\")}\n                    </TableHead>\n                    <TableHead className=\"text-center bg-green-50 border\">\n                      {t(\"common.total\")}\n                    </TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {Object.entries(salesMethodData).map(([method, data]) => (\n                    <TableRow key={method} className=\"hover:bg-gray-50\">\n                      <TableCell className=\"font-medium text-center border bg-blue-50\">\n                        {method}\n                      </TableCell>\n                      <TableCell className=\"text-center border\">\n                        {data.completedOrders}\n                      </TableCell>\n                      <TableCell className=\"text-center border\">\n                        {data.cancelledOrders}\n                      </TableCell>\n                      <TableCell className=\"text-center border font-medium\">\n                        {data.totalOrders}\n                      </TableCell>\n                      <TableCell className=\"text-right border\">\n                        {formatCurrency(data.completedRevenue)}\n                      </TableCell>\n                      <TableCell className=\"text-right border\">\n                        {formatCurrency(data.cancelledRevenue)}\n                      </TableCell>\n                      <TableCell className=\"text-right border font-medium\">\n                        {formatCurrency(data.totalRevenue)}\n                      </TableCell>\n                    </TableRow>\n                  ))}\n\n                  {/* Summary Row */}\n                  <TableRow className=\"bg-green-100 font-bold border-t-2\">\n                    <TableCell className=\"text-center border font-bold\">\n                      {t(\"common.total\")}\n                    </TableCell>\n                    <TableCell className=\"text-center border\">\n                      {Object.values(salesMethodData).reduce(\n                        (sum, data) => sum + data.completedOrders,\n                        0,\n                      )}\n                    </TableCell>\n                    <TableCell className=\"text-center border\">\n                      {Object.values(salesMethodData).reduce(\n                        (sum, data) => sum + data.cancelledOrders,\n                        0,\n                      )}\n                    </TableCell>\n                    <TableCell className=\"text-center border font-bold\">\n                      {Object.values(salesMethodData).reduce(\n                        (sum, data) => sum + data.totalOrders,\n                        0,\n                      )}\n                    </TableCell>\n                    <TableCell className=\"text-right border\">\n                      {formatCurrency(\n                        Object.values(salesMethodData).reduce(\n                          (sum, data) => sum + data.completedRevenue,\n                          0,\n                        ),\n                      )}\n                    </TableCell>\n                    <TableCell className=\"text-right border\">\n                      {formatCurrency(\n                        Object.values(salesMethodData).reduce(\n                          (sum, data) => sum + data.cancelledRevenue,\n                          0,\n                        ),\n                      )}\n                    </TableCell>\n                    <TableCell className=\"text-right border font-bold\">\n                      {formatCurrency(\n                        Object.values(salesMethodData).reduce(\n                          (sum, data) => sum + data.totalRevenue,\n                          0,\n                        ),\n                      )}\n                    </TableCell>\n                  </TableRow>\n                </TableBody>\n              </Table>\n            </div>\n          </div>\n          {/* No pagination needed for sales channel report - it's a summary table */}\n        </CardContent>\n      </Card>\n    );\n  };\n\n  // Chart configurations for each analysis type\n  const chartConfig = {\n    revenue: {\n      label: t(\"reports.revenue\"),\n      color: \"#10b981\",\n    },\n    netRevenue: {\n      label: t(\"reports.netRevenue\"),\n      color: \"#3b82f6\",\n    },\n    returnValue: {\n      label: t(\"reports.returnValue\"),\n      color: \"#ef4444\",\n    },\n    quantity: {\n      label: t(\"reports.quantity\"),\n      color: \"#f59e0b\",\n    },\n    profit: {\n      label: t(\"reports.profit\"),\n      color: \"#8b5cf6\",\n    },\n  };\n\n  // Get chart data based on analysis type\n  const getChartData = () => {\n    switch (analysisType) {\n      case \"time\":\n        // Use dashboard stats to get filtered orders\n        const dashboardStats = getDashboardStats();\n        if (!dashboardStats || !dashboardStats.filteredCompletedOrders) {\n          return [];\n        }\n\n        const filteredOrders = dashboardStats.filteredCompletedOrders;\n\n        console.log(\"Chart data generation:\", {\n          filteredOrdersCount: filteredOrders.length,\n          sampleOrder: filteredOrders[0]\n            ? {\n                id: filteredOrders[0].id,\n                total: filteredOrders[0].total,\n                orderedAt: filteredOrders[0].orderedAt,\n                status: filteredOrders[0].status,\n              }\n            : null,\n        });\n\n        const dailySales: {\n          [date: string]: { revenue: number; orders: number };\n        } = {};\n\n        filteredOrders.forEach((order: any) => {\n          const orderDate = new Date(\n            order.orderedAt ||\n              order.paidAt ||\n              order.createdAt ||\n              order.created_at,\n          );\n          const year = orderDate.getFullYear();\n          const month = (orderDate.getMonth() + 1).toString().padStart(2, \"0\");\n          const day = orderDate.getDate().toString().padStart(2, \"0\");\n          const date = `${year}-${month}-${day}`;\n\n          if (!dailySales[date]) {\n            dailySales[date] = { revenue: 0, orders: 0 };\n          }\n\n          // Use exact same revenue calculation as dashboard\n          const orderTotal = Number(order.total || 0);\n          const orderDiscount = Number(order.discount || 0);\n          const revenue = orderTotal - orderDiscount;\n\n          dailySales[date].revenue += revenue;\n          dailySales[date].orders += 1;\n        });\n\n        const chartData = Object.entries(dailySales)\n          .map(([date, data]) => ({\n            name: formatDate(date), // Format date for display\n            revenue: data.revenue,\n            orders: data.orders,\n          }))\n          .sort(\n            (a, b) => new Date(a.name).getTime() - new Date(b.name).getTime(),\n          ) // Sort by date\n          .slice(0, 10);\n\n        console.log(\"Generated chart data:\", chartData);\n        return chartData;\n\n      case \"product\":\n        if (!products || !Array.isArray(products)) return [];\n\n        const productStart = new Date(startDate);\n        const productEnd = new Date(endDate);\n        productEnd.setHours(23, 59, 59, 999);\n\n        const productSales: {\n          [productId: string]: { quantity: number; revenue: number };\n        } = {};\n\n        // Get dữ liệu từ orders có items sẵn có\n        if (orders && Array.isArray(orders)) {\n          // Filter orders theo ngày và status\n          const filteredOrders = orders.filter((order: any) => {\n            // Chỉ lấy orders đã hoàn thành/thanh toán\n            if (order.status !== \"completed\" && order.status !== \"paid\")\n              return false;\n\n            const orderDate = new Date(\n              order.orderedAt ||\n                order.createdAt ||\n                order.created_at ||\n                order.paidAt,\n            );\n            const orderDateOnly = new Date(orderDate);\n            orderDateOnly.setHours(0, 0, 0, 0);\n            return orderDateOnly >= productStart && orderDateOnly <= productEnd;\n          });\n\n          // Xử lý từng order để lấy order items từ order.items nếu có\n          filteredOrders.forEach((order: any) => {\n            if (order.items && Array.isArray(order.items)) {\n              order.items.forEach((item: any) => {\n                const productId = item.productId?.toString();\n                if (!productId) return;\n\n                // Kiểm tra product có tồn tại trong danh sách products không\n                const product = products.find(\n                  (p) => p.id.toString() === productId,\n                );\n                if (!product) return;\n\n                if (!productSales[productId]) {\n                  productSales[productId] = {\n                    quantity: 0,\n                    revenue: 0,\n                  };\n                }\n\n                const quantity = Number(item.quantity || 0);\n                const total = Number(item.total || 0);\n\n                productSales[productId].quantity += quantity;\n                productSales[productId].revenue += total;\n              });\n            }\n          });\n        }\n\n        // Fallback: Process transaction items from transactions if available\n        if (\n          transactions &&\n          Array.isArray(transactions) &&\n          Object.keys(productSales).length === 0\n        ) {\n          const filteredTransactions = transactions.filter(\n            (transaction: any) => {\n              const transactionDate = new Date(\n                transaction.createdAt || transaction.created_at,\n              );\n              const transactionDateOnly = new Date(transactionDate);\n              transactionDateOnly.setHours(0, 0, 0, 0);\n              return (\n                transactionDateOnly >= productStart &&\n                transactionDateOnly <= productEnd\n              );\n            },\n          );\n\n          filteredTransactions.forEach((transaction: any) => {\n            if (transaction.items && Array.isArray(transaction.items)) {\n              transaction.items.forEach((item: any) => {\n                const productId = item.productId?.toString();\n                if (!productId) return;\n\n                // Check if this product is in our products list\n                const product = products.find(\n                  (p) => p.id.toString() === productId,\n                );\n                if (!product) return;\n\n                if (!productSales[productId]) {\n                  productSales[productId] = {\n                    quantity: 0,\n                    revenue: 0,\n                  };\n                }\n\n                const quantity = Number(item.quantity || 0);\n                const total = Number(item.total || 0);\n\n                productSales[productId].quantity += quantity;\n                productSales[productId].revenue += total;\n              });\n            }\n          });\n        }\n\n        return products\n          .map((product: any) => {\n            const sales = productSales[product.id.toString()] || {\n              quantity: 0,\n              revenue: 0,\n            };\n            return {\n              name:\n                product.name.length > 15\n                  ? product.name.substring(0, 15) + \"...\"\n                  : product.name,\n              revenue: sales.revenue,\n              quantity: sales.quantity,\n            };\n          })\n          .filter((item) => item.quantity > 0)\n          .sort((a, b) => b.revenue - a.revenue)\n          .slice(0, 10);\n\n      case \"employee\":\n        try {\n          if (!orders || !Array.isArray(orders)) {\n            console.warn(\"Employee chart: No orders data available\");\n            return [];\n          }\n\n          const empStart = new Date(startDate);\n          const empEnd = new Date(endDate);\n          empEnd.setHours(23, 59, 59, 999);\n\n          // Use EXACT same filtering logic as dashboard for orders\n          const empFilteredOrders = orders.filter((order: any) => {\n            // Check if order is completed/paid (EXACT same as dashboard)\n            if (order.status !== \"completed\" && order.status !== \"paid\")\n              return false;\n\n            // Try multiple possible date fields (EXACT same as dashboard)\n            const orderDate = new Date(\n              order.orderedAt ||\n                order.createdAt ||\n                order.created_at ||\n                order.paidAt,\n            );\n\n            // Skip if date is invalid\n            if (isNaN(orderDate.getTime())) {\n              return false;\n            }\n\n            const dateMatch = orderDate >= empStart && orderDate <= empEnd;\n\n            const employeeMatch =\n              selectedEmployee === \"all\" ||\n              order.employeeName === selectedEmployee ||\n              order.cashierName === selectedEmployee ||\n              order.employeeId?.toString() === selectedEmployee ||\n              (order.employeeName &&\n                order.employeeName.includes(selectedEmployee)) ||\n              (order.cashierName &&\n                order.cashierName.includes(selectedEmployee));\n\n            return dateMatch && employeeMatch;\n          });\n\n          const employeeData: {\n            [cashier: string]: { revenue: number; orders: number };\n          } = {};\n\n          empFilteredOrders.forEach((order: any) => {\n            try {\n              const cashier =\n                order.cashierName || order.employeeName || \"Unknown\";\n              if (!employeeData[cashier]) {\n                employeeData[cashier] = { revenue: 0, orders: 0 };\n              }\n\n              // Use EXACT same calculation as dashboard: total - discount\n              const orderTotal = Number(order.total || 0);\n              const orderDiscount = Number(order.discount || 0);\n              const revenue = orderTotal - orderDiscount;\n\n              if (revenue >= 0) {\n                // Allow 0 revenue orders\n                employeeData[cashier].revenue += revenue;\n                employeeData[cashier].orders += 1;\n              }\n            } catch (error) {\n              console.warn(\"Error processing employee order:\", error);\n            }\n          });\n\n          const result = Object.entries(employeeData)\n            .map(([name, data]) => ({\n              name:\n                name && name.length > 10\n                  ? name.substring(0, 10) + \"...\"\n                  : name || \"Unknown\",\n              revenue: Math.max(0, data.revenue || 0), // Ensure no negative values\n              orders: Math.max(0, data.orders || 0), // Ensure no negative values\n            }))\n            .filter((item) => item.revenue > 0 || item.orders > 0) // Only show employees with data\n            .sort((a, b) => (b.revenue || 0) - (a.revenue || 0))\n            .slice(0, 10);\n\n          console.log(\"Employee chart data generated:\", {\n            filteredOrdersCount: empFilteredOrders.length,\n            employeeDataKeys: Object.keys(employeeData),\n            result,\n          });\n\n          return result;\n        } catch (error) {\n          console.error(\"Error in employee chart data generation:\", error);\n          return [];\n        }\n\n      case \"customer\":\n        if (!orders || !Array.isArray(orders)) return [];\n\n        const custStart = new Date(startDate);\n        const custEnd = new Date(endDate);\n        custEnd.setHours(23, 59, 59, 999);\n\n        const custFilteredOrders = orders.filter((order: any) => {\n          const orderDate = new Date(\n            order.orderedAt || order.created_at || order.createdAt,\n          );\n          return (\n            orderDate >= custStart &&\n            orderDate <= custEnd &&\n            order.status === \"paid\"\n          );\n        });\n\n        const customerData: {\n          [customerId: string]: {\n            customerId: string;\n            customerName: string;\n            customerGroup: string;\n            orders: number;\n            totalAmount: number;\n            discount: number;\n            revenue: number;\n            status: string;\n            orderDetails: any[];\n          };\n        } = {};\n\n        custFilteredOrders.forEach((order: any) => {\n          const customerId = order.customerId || \"guest\";\n          const customerName = order.customerName || \"Khách lẻ\";\n\n          if (!customerData[customerId]) {\n            customerData[customerId] = {\n              customerId: customerId === \"guest\" ? \"KL-001\" : customerId,\n              customerName: customerName,\n              customerGroup: t(\"common.regularCustomer\"), // Default group\n              orders: 0,\n              totalAmount: 0,\n              discount: 0,\n              revenue: 0,\n              status: t(\"reports.active\"),\n              orderDetails: [],\n            };\n          }\n\n          const orderTotal = Number(order.total);\n          const orderSubtotal = Number(order.subtotal || orderTotal * 1.1); // Calculate subtotal if not available\n          const orderDiscount = orderSubtotal - orderTotal;\n\n          customerData[customerId].orders += 1;\n          customerData[customerId].totalAmount += orderSubtotal;\n          customerData[customerId].discount += orderDiscount;\n          customerData[customerId].revenue += orderTotal;\n          customerData[customerId].orderDetails.push(order);\n\n          // Determine customer group based on total spending\n          if (customerData[customerId].revenue >= 1000000) {\n            customerData[customerId].customerGroup = t(\"reports.vip\");\n          } else if (customerData[customerId].revenue >= 500000) {\n            customerData[customerId].customerGroup = t(\"common.goldCustomer\");\n          }\n        });\n\n        const data = Object.values(customerData).sort(\n          (a, b) => b.revenue - a.revenue,\n        );\n\n        // Pagination logic\n        const totalPages = Math.ceil(data.length / customerPageSize);\n        const startIndex = (customerCurrentPage - 1) * customerPageSize;\n        const endIndex = startIndex + customerPageSize;\n        const paginatedData = data.slice(startIndex, endIndex);\n\n        return Object.entries(customerData)\n          .map(([customerId, data]) => ({\n            name:\n              data.customerName.length > 10\n                ? data.customerName.substring(0, 10) + \"...\"\n                : data.customerName,\n            revenue: data.revenue,\n            orders: data.orders,\n          }))\n          .sort((a, b) => b.revenue - a.revenue)\n          .slice(0, 10);\n    }\n\n    // Chart rendering component\n    const renderChart = () => {\n      try {\n        const chartData = getChartData();\n\n        console.log(\"Chart data for\", analysisType, \":\", chartData);\n\n        if (!chartData || chartData.length === 0) {\n          return (\n            <div className=\"flex flex-col justify-center items-center py-8\">\n              <div className=\"text-gray-500 mb-2\">\n                {t(\"reports.noDataDescription\")}\n              </div>\n              <div className=\"text-sm text-orange-600\">\n                📊 Không có dữ liệu trong khoảng thời gian đã chọn ({startDate}{\" \"}\n                - {endDate})\n              </div>\n              <div className=\"text-xs text-gray-400 mt-1\">\n                Thử chọn khoảng thời gian khác hoặc kiểm tra dữ liệu đơn hàng\n              </div>\n            </div>\n          );\n        }\n\n        return (\n          <Card className=\"shadow-xl border-0 bg-gradient-to-br from-blue-50/50 to-indigo-50/30\">\n            <CardHeader className=\"bg-gradient-to-r from-blue-600 to-indigo-600 rounded-t-lg\">\n              <CardTitle className=\"flex items-center gap-3 text-lg font-semibold\">\n                <div className=\"p-2 bg-white/20 rounded-lg\">\n                  <TrendingUp className=\"w-6 h-6\" />\n                </div>\n                <div>\n                  <div className=\"text-white/90 text-sm font-normal\">\n                    {t(\"reports.chartView\")}\n                  </div>\n                  <div className=\"text-white font-semibold\">\n                    {getReportTitle()}\n                  </div>\n                </div>\n              </CardTitle>\n              <CardDescription className=\"text-blue-100 mt-2\">\n                {t(\"reports.visualRepresentation\")} - {t(\"reports.fromDate\")}:{\" \"}\n                {formatDate(startDate)} {t(\"reports.toDate\")}:{\" \"}\n                {formatDate(endDate)}\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"p-8 bg-white/80 backdrop-blur-sm\">\n              <div className=\"h-[450px] w-full bg-white/90 rounded-xl border-0 shadow-lg p-6 relative overflow-hidden\">\n                <div className=\"absolute inset-0 bg-gradient-to-br from-blue-50/20 to-purple-50/20 rounded-xl\"></div>\n                <ChartContainer\n                  config={chartConfig}\n                  className=\"h-full w-full relative z-10\"\n                >\n                  <ResponsiveContainer width=\"100%\" height=\"100%\">\n                    <BarChart\n                      data={chartData}\n                      margin={{ top: 20, right: 30, left: 20, bottom: 60 }}\n                    >\n                      <defs>\n                        <linearGradient\n                          id=\"revenueGradient\"\n                          x1=\"0\"\n                          y1=\"0\"\n                          x2=\"0\"\n                          y2=\"1\"\n                        >\n                          <stop\n                            offset=\"5%\"\n                            stopColor=\"#10b981\"\n                            stopOpacity={0.9}\n                          />\n                          <stop\n                            offset=\"95%\"\n                            stopColor=\"#10b981\"\n                            stopOpacity={0.6}\n                          />\n                        </linearGradient>\n                        <linearGradient\n                          id=\"ordersGradient\"\n                          x1=\"0\"\n                          y1=\"0\"\n                          x2=\"0\"\n                          y2=\"1\"\n                        >\n                          <stop\n                            offset=\"5%\"\n                            stopColor=\"#3b82f6\"\n                            stopOpacity={0.9}\n                          />\n                          <stop\n                            offset=\"95%\"\n                            stopColor=\"#3b82f6\"\n                            stopOpacity={0.6}\n                          />\n                        </linearGradient>\n                        <linearGradient\n                          id=\"quantityGradient\"\n                          x1=\"0\"\n                          y1=\"0\"\n                          x2=\"0\"\n                          y2=\"1\"\n                        >\n                          <stop\n                            offset=\"5%\"\n                            stopColor=\"#f59e0b\"\n                            stopOpacity={0.9}\n                          />\n                          <stop\n                            offset=\"95%\"\n                            stopColor=\"#f59e0b\"\n                            stopOpacity={0.6}\n                          />\n                        </linearGradient>\n                      </defs>\n                      <CartesianGrid\n                        strokeDasharray=\"3 3\"\n                        stroke=\"#e5e7eb\"\n                        opacity={0.5}\n                      />\n                      <XAxis\n                        dataKey=\"name\"\n                        stroke=\"#6b7280\"\n                        fontSize={12}\n                        angle={-45}\n                        textAnchor=\"end\"\n                        height={80}\n                        interval={0}\n                      />\n                      <YAxis stroke=\"#6b7280\" fontSize={12} />\n                      <ChartTooltip\n                        content={({ active, payload, label }) => {\n                          if (active && payload && payload.length) {\n                            return (\n                              <div className=\"bg-white/95 backdrop-blur-sm p-4 rounded-lg border border-gray-200 shadow-lg\">\n                                <p className=\"font-semibold text-gray-800 mb-2\">\n                                  {label}\n                                </p>\n                                {payload.map((entry, index) => {\n                                  const translatedName =\n                                    entry.dataKey === \"revenue\"\n                                      ? t(\"reports.revenue\")\n                                      : entry.dataKey === \"orders\"\n                                        ? t(\"reports.orders\")\n                                        : entry.dataKey === \"quantity\"\n                                          ? t(\"reports.quantity\")\n                                          : entry.name;\n                                  return (\n                                    <p\n                                      key={index}\n                                      className=\"text-sm\"\n                                      style={{ color: entry.color }}\n                                    >\n                                      {translatedName}:{\" \"}\n                                      {entry.dataKey === \"revenue\" ||\n                                      entry.dataKey === \"netRevenue\"\n                                        ? formatCurrency(Number(entry.value))\n                                        : entry.value}\n                                    </p>\n                                  );\n                                })}\n                              </div>\n                            );\n                          }\n                          return null;\n                        }}\n                      />\n\n                      {/* Revenue bar - always show */}\n                      <Bar\n                        dataKey=\"revenue\"\n                        fill=\"url(#revenueGradient)\"\n                        radius={[4, 4, 0, 0]}\n                        maxBarSize={60}\n                      />\n\n                      {/* Additional bars based on analysis type */}\n                      {analysisType === \"time\" && (\n                        <Bar\n                          dataKey=\"orders\"\n                          fill=\"url(#ordersGradient)\"\n                          radius={[4, 4, 0, 0]}\n                          maxBarSize={60}\n                        />\n                      )}\n\n                      {analysisType === \"product\" && (\n                        <Bar\n                          dataKey=\"quantity\"\n                          fill=\"url(#quantityGradient)\"\n                          radius={[4, 4, 0, 0]}\n                          maxBarSize={60}\n                        />\n                      )}\n\n                      {(analysisType === \"employee\" ||\n                        analysisType === \"customer\" ||\n                        analysisType === \"channel\" ||\n                        analysisType === \"salesDetail\") && (\n                        <Bar\n                          dataKey=\"orders\"\n                          fill=\"url(#ordersGradient)\"\n                          radius={[4, 4, 0, 0]}\n                          maxBarSize={60}\n                        />\n                      )}\n                    </BarChart>\n                  </ResponsiveContainer>\n                </ChartContainer>\n              </div>\n            </CardContent>\n          </Card>\n        );\n      } catch (error) {\n        console.error(\"Error in renderChart:\", error);\n        return (\n          <div className=\"flex justify-center py-8\">\n            <div className=\"text-red-500\">\n              <p>Lỗi khi hiển thị biểu đồ</p>\n              <p className=\"text-sm\">{error.message || \"Unknown error\"}</p>\n            </div>\n          </div>\n        );\n      }\n    };\n\n    // Main render function\n    const renderReportContent = () => {\n      try {\n        console.log(\n          \"Rendering report content for analysisType:\",\n          analysisType,\n          \"concernType:\",\n          concernType,\n        );\n\n        switch (analysisType) {\n          case \"time\":\n            // Handle concernType for time-based analysis\n            if (concernType === \"employee\") {\n              return renderEmployeeReport();\n            } else if (concernType === \"salesDetail\") {\n              return renderSalesDetailReport();\n            }\n            return renderSalesReport();\n          case \"product\":\n            return renderProductReport();\n          case \"employee\":\n            return renderEmployeeReport();\n          case \"customer\":\n            return renderCustomerReport();\n          case \"channel\":\n            return renderSalesChannelReport();\n          case \"salesDetail\":\n            return renderSalesDetailReport();\n          default:\n            return renderSalesReport();\n        }\n      } catch (error) {\n        console.error(\"Error in renderReportContent:\", error);\n        return (\n          <div className=\"flex justify-center py-8\">\n            <div className=\"text-red-500\">\n              <p>Có lỗi xảy ra khi hiển thị báo cáo</p>\n              <p className=\"text-sm\">{error.message}</p>\n            </div>\n          </div>\n        );\n      }\n    };\n\n    // Product Report Logic (Moved up to be before renderChart)\n    const renderProductReport = () => {\n      const getFilteredProducts = () => {\n        if (!products || !Array.isArray(products)) return [];\n\n        return products.filter((product: any) => {\n          const searchMatch =\n            !productSearch ||\n            product.name.toLowerCase().includes(productSearch.toLowerCase()) ||\n            (product.sku &&\n              product.sku.toLowerCase().includes(productSearch.toLowerCase()));\n\n          const categoryMatch =\n            selectedCategory === \"all\" ||\n            product.categoryId?.toString() === selectedCategory;\n\n          const typeMatch =\n            productType === \"all\" ||\n            (productType === \"combo\" && product.productType === 3) ||\n            (productType === \"product\" && product.productType === 1) ||\n            (productType === \"service\" && product.productType === 2);\n\n          return searchMatch && categoryMatch && typeMatch;\n        });\n      };\n\n      const getSalesData = () => {\n        const filteredProducts = getFilteredProducts();\n        if (!filteredProducts.length) return [];\n\n        const start = new Date(startDate);\n        const end = new Date(endDate);\n        end.setHours(23, 59, 59, 999);\n\n        console.log(\"Product Report Debug:\", {\n          startDate,\n          endDate,\n          start: start.toISOString(),\n          end: end.toISOString(),\n          ordersLength: orders?.length || 0,\n          transactionsLength: transactions?.length || 0,\n        });\n\n        const productSales: {\n          [productId: string]: {\n            quantity: number;\n            totalAmount: number;\n            discount: number;\n            revenue: number;\n          };\n        } = {};\n\n        // Process order items from orders first (main data source)\n        if (orders && Array.isArray(orders)) {\n          // Use EXACT same filtering logic as other reports\n          const filteredOrders = orders.filter((order: any) => {\n            // Check if order is completed/paid (EXACT same as dashboard)\n            if (order.status !== \"completed\" && order.status !== \"paid\")\n              return false;\n\n            // Try multiple possible date fields (EXACT same as dashboard)\n            const orderDate = new Date(\n              order.orderedAt ||\n                order.createdAt ||\n                order.created_at ||\n                order.paidAt,\n            );\n\n            // Skip if date is invalid\n            if (isNaN(orderDate.getTime())) {\n              return false;\n            }\n\n            return orderDate >= start && orderDate <= end;\n          });\n\n          console.log(\"Filtered Orders for Product Report:\", {\n            totalOrders: orders.length,\n            filteredOrders: filteredOrders.length,\n            sampleOrder: filteredOrders[0]\n              ? {\n                  id: filteredOrders[0].id,\n                  status: filteredOrders[0].status,\n                  orderedAt: filteredOrders[0].orderedAt,\n                  createdAt: filteredOrders[0].createdAt,\n                  items: filteredOrders[0].items?.length || 0,\n                }\n              : null,\n          });\n\n          filteredOrders.forEach((order: any) => {\n            if (order.items && Array.isArray(order.items)) {\n              order.items.forEach((item: any) => {\n                const productId = item.productId?.toString();\n                if (!productId) return;\n\n                // Check if this product is in our filtered products list\n                const product = filteredProducts.find(\n                  (p) => p.id.toString() === productId,\n                );\n                if (!product) return;\n\n                if (!productSales[productId]) {\n                  productSales[productId] = {\n                    quantity: 0,\n                    totalAmount: 0,\n                    discount: 0,\n                    revenue: 0,\n                  };\n                }\n\n                const quantity = Number(item.quantity || 0);\n                const total = Number(item.total || 0);\n                const unitPrice = Number(item.unitPrice || item.price || 0);\n                const totalAmount = quantity * unitPrice;\n                const discount = Math.max(0, totalAmount - total); // Ensure discount is not negative\n\n                productSales[productId].quantity += quantity;\n                productSales[productId].totalAmount += totalAmount;\n                productSales[productId].discount += discount;\n                productSales[productId].revenue += total;\n\n                console.log(\"Processing order item:\", {\n                  productId,\n                  productName: product.name,\n                  quantity,\n                  total,\n                  unitPrice,\n                  totalAmount,\n                  discount,\n                });\n              });\n            }\n          });\n        }\n\n        // Fallback: Process transaction items from transactions if no order data\n        if (\n          transactions &&\n          Array.isArray(transactions) &&\n          Object.keys(productSales).length === 0\n        ) {\n          const filteredTransactions = transactions.filter(\n            (transaction: any) => {\n              const transactionDate = new Date(\n                transaction.createdAt || transaction.created_at,\n              );\n              const transactionDateOnly = new Date(transactionDate);\n              transactionDateOnly.setHours(0, 0, 0, 0);\n              return transactionDateOnly >= start && transactionDateOnly <= end;\n            },\n          );\n\n          console.log(\"Fallback to transactions:\", {\n            totalTransactions: transactions.length,\n            filteredTransactions: filteredTransactions.length,\n          });\n\n          filteredTransactions.forEach((transaction: any) => {\n            if (transaction.items && Array.isArray(transaction.items)) {\n              transaction.items.forEach((item: any) => {\n                const productId = item.productId?.toString();\n                if (!productId) return;\n\n                // Check if this product is in our filtered products list\n                const product = filteredProducts.find(\n                  (p) => p.id.toString() === productId,\n                );\n                if (!product) return;\n\n                if (!productSales[productId]) {\n                  productSales[productId] = {\n                    quantity: 0,\n                    totalAmount: 0,\n                    discount: 0,\n                    revenue: 0,\n                  };\n                }\n\n                const quantity = Number(item.quantity || 0);\n                const total = Number(item.total || 0);\n                const unitPrice = Number(item.price || 0);\n                const totalAmount = quantity * unitPrice;\n                const discount = Math.max(0, totalAmount - total);\n\n                productSales[productId].quantity += quantity;\n                productSales[productId].totalAmount += totalAmount;\n                productSales[productId].discount += discount;\n                productSales[productId].revenue += total;\n              });\n            }\n          });\n        }\n\n        console.log(\"Product Sales Summary:\", productSales);\n\n        return filteredProducts\n          .map((product: any) => {\n            const sales = productSales[product.id.toString()] || {\n              quantity: 0,\n              totalAmount: 0,\n              discount: 0,\n              revenue: 0,\n            };\n\n            // Tìm category name\n            const categoryName =\n              categories && Array.isArray(categories)\n                ? categories.find((cat) => cat.id === product.categoryId)\n                    ?.name || \"\"\n                : \"\";\n\n            return {\n              productCode: product.sku || \"\",\n              productName: product.name || \"\",\n              unit: \"\", // Đơn vị tính - để trống vì không có trong database\n              quantitySold: sales.quantity,\n              totalAmount: sales.totalAmount,\n              discount: sales.discount,\n              revenue: sales.revenue,\n              categoryName: categoryName,\n            };\n          })\n          .filter((item) => item !== null);\n      };\n\n      const data = getSalesData();\n      const totalPages = Math.ceil(data.length / productPageSize);\n      const startIndex = (productCurrentPage - 1) * productPageSize;\n      const endIndex = startIndex + productPageSize;\n      const paginatedData = data.slice(startIndex, endIndex);\n\n      return (\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Package className=\"w-5 h-5\" />\n              {t(\"reports.salesReportByProduct\")}\n            </CardTitle>\n            <CardDescription>\n              {t(\"reports.fromDate\")}: {formatDate(startDate)} -{\" \"}\n              {t(\"reports.toDate\")}: {formatDate(endDate)}\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"w-full\">\n              <div className=\"overflow-x-auto xl:overflow-x-visible\">\n                <Table className=\"w-full min-w-[1000px] xl:min-w-full\">\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>{t(\"reports.productCode\")}</TableHead>\n                      <TableHead>{t(\"reports.productName\")}</TableHead>\n                      <TableHead>{t(\"reports.unit\")}</TableHead>\n                      <TableHead className=\"text-center\">\n                        {t(\"reports.quantitySold\")}\n                      </TableHead>\n                      <TableHead className=\"text-right\">\n                        {t(\"reports.totalAmount\")}\n                      </TableHead>\n                      <TableHead className=\"text-right\">\n                        {t(\"reports.discount\")}\n                      </TableHead>\n                      <TableHead className=\"text-right\">\n                        {t(\"reports.revenue\")}\n                      </TableHead>\n                      <TableHead>{t(\"reports.categoryName\")}</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {paginatedData.length > 0 ? (\n                      paginatedData.map((item, index) => (\n                        <TableRow key={index}>\n                          <TableCell className=\"font-medium\">\n                            {item.productCode}\n                          </TableCell>\n                          <TableCell>{item.productName}</TableCell>\n                          <TableCell>{item.unit}</TableCell>\n                          <TableCell className=\"text-center\">\n                            {item.quantitySold}\n                          </TableCell>\n                          <TableCell className=\"text-right\">\n                            {formatCurrency(item.totalAmount)}\n                          </TableCell>\n                          <TableCell className=\"text-right text-red-600\">\n                            {formatCurrency(item.discount)}\n                          </TableCell>\n                          <TableCell className=\"text-right text-green-600 font-medium\">\n                            {formatCurrency(item.revenue)}\n                          </TableCell>\n                          <TableCell>{item.categoryName}</TableCell>\n                        </TableRow>\n                      ))\n                    ) : (\n                      <TableRow>\n                        <TableCell\n                          colSpan={8}\n                          className=\"text-center text-gray-500 italic\"\n                        >\n                          {t(\"reports.noDataDescription\")}\n                        </TableCell>\n                      </TableRow>\n                    )}\n                  </TableBody>\n                </Table>\n              </div>\n            </div>\n\n            {/* Pagination Controls for Product Report */}\n            {data.length > 0 && (\n              <div className=\"flex items-center justify-between space-x-6 py-4\">\n                <div className=\"flex items-center space-x-2\">\n                  <p className=\"text-sm font-medium\">{t(\"common.show\")} </p>\n                  <Select\n                    value={productPageSize.toString()}\n                    onValueChange={(value) => {\n                      setProductPageSize(Number(value));\n                      setProductCurrentPage(1);\n                    }}\n                  >\n                    <SelectTrigger className=\"h-8 w-[70px]\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent side=\"top\">\n                      <SelectItem value=\"15\">15</SelectItem>\n                      <SelectItem value=\"20\">20</SelectItem>\n                      <SelectItem value=\"30\">30</SelectItem>\n                      <SelectItem value=\"50\">50</SelectItem>\n                      <SelectItem value=\"100\">100</SelectItem>\n                    </SelectContent>\n                  </Select>\n                  <p className=\"text-sm font-medium\"> {t(\"common.rows\")}</p>\n                </div>\n\n                <div className=\"flex items-center space-x-2\">\n                  <p className=\"text-sm font-medium\">\n                    {t(\"common.page\")} {productCurrentPage} / {totalPages}\n                  </p>\n                  <div className=\"flex items-center space-x-1\">\n                    <button\n                      onClick={() => setProductCurrentPage(1)}\n                      disabled={productCurrentPage === 1}\n                      className=\"inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-8 w-8\"\n                    >\n                      «\n                    </button>\n                    <button\n                      onClick={() =>\n                        setProductCurrentPage((prev) => Math.max(prev - 1, 1))\n                      }\n                      disabled={productCurrentPage === 1}\n                      className=\"inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-8 w-8\"\n                    >\n                      ‹\n                    </button>\n                    <button\n                      onClick={() =>\n                        setProductCurrentPage((prev) =>\n                          Math.min(prev + 1, totalPages),\n                        )\n                      }\n                      disabled={productCurrentPage === totalPages}\n                      className=\"inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-8 w-8\"\n                    >\n                      ›\n                    </button>\n                    <button\n                      onClick={() => setProductCurrentPage(totalPages)}\n                      disabled={productCurrentPage === totalPages}\n                      className=\"inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-8 w-8\"\n                    >\n                      »\n                    </button>\n                  </div>\n                </div>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      );\n    };\n\n    return (\n      <div className=\"space-y-6\">\n        {/* Filters */}\n        <Card>\n          <CardContent className=\"pt-4\">\n            {/* Main Filter Row */}\n            <div className=\"grid grid-cols-4 gap-4 mb-4\">\n              {/* Analysis Type */}\n              <div>\n                <Label className=\"text-sm font-medium text-gray-700 mb-2 block\">\n                  {t(\"reports.analyzeBy\")}\n                </Label>\n                <Select\n                  value={analysisType}\n                  onValueChange={(value) => {\n                    setAnalysisType(value);\n                    // Reset concernType when analysisType changes if necessary\n                    if (value === \"time\") {\n                      setConcernType(\"time\"); // Default for time analysis\n                    } else if (value === \"salesDetail\") {\n                      setConcernType(\"sales\"); // Default for sales detail analysis\n                    } else {\n                      // If moving away from 'time', ensure concernType is sensible or reset\n                      setConcernType(\"sales\"); // Or a more appropriate default\n                    }\n                  }}\n                >\n                  <SelectTrigger className=\"h-9 text-sm\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"time\">\n                      {t(\"reports.timeAnalysis\")}\n                    </SelectItem>\n                    <SelectItem value=\"product\">\n                      {t(\"reports.productAnalysis\")}\n                    </SelectItem>\n                    <SelectItem value=\"employee\">\n                      {t(\"reports.employeeAnalysis\")}\n                    </SelectItem>\n                    <SelectItem value=\"customer\">\n                      {t(\"reports.customerAnalysis\")}\n                    </SelectItem>\n                    <SelectItem value=\"channel\">\n                      {t(\"reports.channelAnalysis\")}\n                    </SelectItem>\n                    <SelectItem value=\"salesDetail\">\n                      {t(\"reports.salesDetailReport\")}\n                    </SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              {/* Date Range */}\n              <div>\n                <Label className=\"text-sm font-medium text-gray-700 mb-2 block\">\n                  {t(\"reports.startDate\")}\n                </Label>\n                <Input\n                  type=\"date\"\n                  value={startDate}\n                  onChange={(e) => setStartDate(e.target.value)}\n                  className=\"h-9 text-sm\"\n                />\n              </div>\n\n              <div>\n                <Label className=\"text-sm font-medium text-gray-700 mb-2 block\">\n                  {t(\"reports.endDate\")}\n                </Label>\n                <Input\n                  type=\"date\"\n                  value={endDate}\n                  onChange={(e) => setEndDate(e.target.value)}\n                  className=\"h-9 text-sm\"\n                />\n              </div>\n            </div>\n\n            {/* Secondary Filter Row - Show based on analysis type */}\n            {analysisType === \"employee\" && (\n              <div className=\"grid grid-cols-1 md:grid-cols-1 gap-4 pt-4 border-t border-gray-200\">\n                <div>\n                  <Label className=\"text-sm font-medium text-gray-700 mb-2 block\">\n                    {t(\"reports.employeeFilter\")}\n                  </Label>\n                  <div className=\"relative\">\n                    <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                    <Input\n                      placeholder={t(\"reports.employeeFilterPlaceholder\")}\n                      value={selectedEmployee === \"all\" ? \"\" : selectedEmployee}\n                      onChange={(e) =>\n                        setSelectedEmployee(e.target.value || \"all\")\n                      }\n                      className=\"pl-10 h-9 text-sm\"\n                    />\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {analysisType === \"customer\" && (\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-gray-200\">\n                <div>\n                  <Label className=\"text-sm font-medium text-gray-700 mb-2 block\">\n                    {t(\"reports.customerFilter\")}\n                  </Label>\n                  <div className=\"relative\">\n                    <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                    <Input\n                      placeholder={t(\"reports.customerFilterPlaceholder\")}\n                      value={customerSearch}\n                      onChange={(e) => setCustomerSearch(e.target.value)}\n                      className=\"pl-10 h-9 text-sm\"\n                    />\n                  </div>\n                </div>\n                <div>\n                  <Label className=\"text-sm font-medium text-gray-700 mb-2 block\">\n                    {t(\"reports.status\")}\n                  </Label>\n                  <Select\n                    value={customerStatus}\n                    onValueChange={setCustomerStatus}\n                  >\n                    <SelectTrigger className=\"h-9 text-sm\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"all\">{t(\"common.all\")}</SelectItem>\n                      <SelectItem value=\"active\">\n                        {t(\"reports.active\")}\n                      </SelectItem>\n                      <SelectItem value=\"inactive\">\n                        {t(\"reports.inactive\")}\n                      </SelectItem>\n                      <SelectItem value=\"vip\">{t(\"reports.vip\")}</SelectItem>\n                      <SelectItem value=\"new\">\n                        {t(\"reports.newCustomer\")}\n                      </SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n            )}\n\n            {analysisType === \"product\" && (\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 pt-4 border-t border-gray-200\">\n                <div>\n                  <Label className=\"text-sm font-medium text-gray-700 mb-2 block\">\n                    {t(\"reports.productFilter\")}\n                  </Label>\n                  <div className=\"relative\">\n                    <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                    <Input\n                      placeholder={t(\"reports.productFilterPlaceholder\")}\n                      value={productSearch}\n                      onChange={(e) => setProductSearch(e.target.value)}\n                      className=\"pl-10 h-9 text-sm\"\n                    />\n                  </div>\n                </div>\n\n                <div>\n                  <Label className=\"text-sm font-medium text-gray-700 mb-2 block\">\n                    {t(\"reports.productType\")}\n                  </Label>\n                  <Select value={productType} onValueChange={setProductType}>\n                    <SelectTrigger className=\"h-9 text-sm\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"all\">{t(\"common.all\")}</SelectItem>\n                      <SelectItem value=\"combo\">\n                        {t(\"reports.combo\")}\n                      </SelectItem>\n                      <SelectItem value=\"product\">\n                        {t(\"reports.product\")}\n                      </SelectItem>\n                      <SelectItem value=\"service\">\n                        {t(\"reports.service\")}\n                      </SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <div>\n                  <Label className=\"text-sm font-medium text-gray-700 mb-2 block\">\n                    {t(\"reports.productGroup\")}\n                  </Label>\n                  <Select\n                    value={selectedCategory}\n                    onValueChange={setSelectedCategory}\n                  >\n                    <SelectTrigger className=\"h-9 text-sm\">\n                      <SelectValue placeholder={t(\"reports.productGroup\")} />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"all\">{t(\"common.all\")}</SelectItem>\n                      {categories &&\n                        Array.isArray(categories) &&\n                        categories.map((category: any) => (\n                          <SelectItem\n                            key={category.id}\n                            value={category.id.toString()}\n                          >\n                            {category.name}\n                          </SelectItem>\n                        ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n            )}\n\n            {analysisType === \"channel\" && (\n              <div className=\"pt-4 border-t border-gray-200\">\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                  {/* Sales Method */}\n                  <div className=\"space-y-2\">\n                    <Label className=\"text-sm font-medium text-gray-700\">\n                      {t(\"reports.salesMethod\")}\n                    </Label>\n                    <Select value={salesMethod} onValueChange={setSalesMethod}>\n                      <SelectTrigger className=\"h-9 text-sm\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"all\">{t(\"common.all\")}</SelectItem>\n                        <SelectItem value=\"no_delivery\">\n                          Không giao hàng\n                        </SelectItem>\n                        <SelectItem value=\"delivery\">Có giao hàng</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* Filters for Time Analysis and Sales Detail Report */}\n            {(analysisType === \"time\" || concernType === \"salesDetail\") && (\n              <div className=\"grid grid-cols-1 md:grid-cols-1 gap-4 pt-4 border-t border-gray-200\">\n                <div>\n                  <Label className=\"text-sm font-medium text-gray-700 mb-2 block\">\n                    {t(\"reports.employeeFilter\")}\n                  </Label>\n                  <div className=\"relative\">\n                    <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                    <Input\n                      placeholder={t(\"reports.employeeFilterPlaceholder\")}\n                      value={selectedEmployee === \"all\" ? \"\" : selectedEmployee}\n                      onChange={(e) =>\n                        setSelectedEmployee(e.target.value || \"all\")\n                      }\n                      className=\"pl-10 h-9 text-sm\"\n                    />\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* Sales Detail Report Filters */}\n            {analysisType === \"salesDetail\" && (\n              <div className=\"space-y-4 pt-4 border-t border-gray-200\">\n                {/* Employee and Order Code */}\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <Label className=\"text-sm font-medium text-gray-700 mb-2 block\">\n                      {t(\"reports.employeeFilter\")}\n                    </Label>\n                    <div className=\"relative\">\n                      <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                      <Input\n                        placeholder={t(\"reports.employeeFilterPlaceholder\")}\n                        value={\n                          selectedEmployee === \"all\" ? \"\" : selectedEmployee\n                        }\n                        onChange={(e) =>\n                          setSelectedEmployee(e.target.value || \"all\")\n                        }\n                        className=\"pl-10 h-9 text-sm\"\n                      />\n                    </div>\n                  </div>\n                  <div>\n                    <Label className=\"text-sm font-medium text-gray-700 mb-2 block\">\n                      {t(\"reports.orderCode\")}\n                    </Label>\n                    <div className=\"relative\">\n                      <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                      <Input\n                        placeholder={t(\"reports.searchOrderCode\")}\n                        className=\"pl-10 h-9 text-sm\"\n                      />\n                    </div>\n                  </div>\n                </div>\n\n                {/* Product and Product Group */}\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <Label className=\"text-sm font-medium text-gray-700 mb-2 block\">\n                      {t(\"reports.productFilter\")}\n                    </Label>\n                    <div className=\"relative\">\n                      <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                      <Input\n                        placeholder={t(\"reports.productFilterPlaceholder\")}\n                        value={productSearch}\n                        onChange={(e) => setProductSearch(e.target.value)}\n                        className=\"pl-10 h-9 text-sm\"\n                      />\n                    </div>\n                  </div>\n                  <div>\n                    <Label className=\"text-sm font-medium text-gray-700 mb-2 block\">\n                      {t(\"reports.productGroup\")}\n                    </Label>\n                    <Select\n                      value={selectedCategory}\n                      onValueChange={setSelectedCategory}\n                    >\n                      <SelectTrigger className=\"h-9 text-sm\">\n                        <SelectValue placeholder={t(\"reports.productGroup\")} />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"all\">{t(\"common.all\")}</SelectItem>\n                        {categories &&\n                          Array.isArray(categories) &&\n                          categories.map((category: any) => (\n                            <SelectItem\n                              key={category.id}\n                              value={category.id.toString()}\n                            >\n                              {category.name}\n                            </SelectItem>\n                          ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n\n                {/* Status only */}\n                <div className=\"grid grid-cols-1 md:grid-cols-1 gap-4\">\n                  <div>\n                    <Label className=\"text-sm font-medium text-gray-700 mb-2 block\">\n                      {t(\"reports.status\")}\n                    </Label>\n                    <Select defaultValue=\"all\">\n                      <SelectTrigger className=\"h-9 text-sm w-full md:w-1/2\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"all\">{t(\"common.all\")}</SelectItem>\n                        <SelectItem value=\"completed\">\n                          {t(\"reports.completed\")}\n                        </SelectItem>\n                        <SelectItem value=\"pending\">\n                          {t(\"reports.pending\")}\n                        </SelectItem>\n                        <SelectItem value=\"cancelled\">\n                          {t(\"reports.cancelled\")}\n                        </SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Report Content */}\n        <div className=\"space-y-6\">\n          {transactionsLoading || ordersLoading || invoicesLoading ? (\n            <div className=\"flex justify-center py-8\">\n              <div className=\"text-gray-500\">{t(\"reports.loading\")}...</div>\n            </div>\n          ) : (\n            <>\n              {/* Chart Display */}\n              {(analysisType === \"time\" ||\n                analysisType === \"product\" ||\n                analysisType === \"employee\" ||\n                analysisType === \"customer\" ||\n                analysisType === \"channel\") &&\n                renderChart()}\n\n              {/* Data Tables */}\n              {renderReportContent()}\n            </>\n          )}\n        </div>\n      </div>\n    );\n  };\n}\n","size_bytes":176788},"client/src/components/reports/sales-report.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { TrendingUp, Calendar, DollarSign, Users, RefreshCw, Filter } from \"lucide-react\";\nimport type { Transaction } from \"@shared/schema\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n} from \"@/components/ui/chart\";\nimport {\n  BarChart,\n  Bar,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  ResponsiveContainer,\n} from \"recharts\";\nimport { Button } from \"@/components/ui/button\";\n\nexport function SalesReport() {\n  const { t } = useTranslation();\n\n  const [dateRange, setDateRange] = useState(\"today\");\n  const [startDate, setStartDate] = useState<string>(\n    new Date().toISOString().split(\"T\")[0],\n  );\n  const [endDate, setEndDate] = useState<string>(\n    new Date().toISOString().split(\"T\")[0],\n  );\n\n  // Query orders - same as dashboard-overview\n  const { data: orders = [], isLoading: ordersLoading, error: ordersError } = useQuery({\n    queryKey: [\"/api/orders\"],\n    queryFn: async () => {\n      try {\n        const response = await fetch(\"/api/orders\");\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        const data = await response.json();\n        return Array.isArray(data) ? data : [];\n      } catch (error) {\n        console.error('Error fetching orders:', error);\n        return [];\n      }\n    },\n    retry: 3,\n    retryDelay: 1000,\n  });\n\n  // Query invoices - same as dashboard-overview\n  const { data: invoices = [], isLoading: invoicesLoading } = useQuery({\n    queryKey: [\"/api/invoices\"],\n    queryFn: async () => {\n      try {\n        const response = await fetch(`/api/invoices`);\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        const data = await response.json();\n        return Array.isArray(data) ? data : [];\n      } catch (error) {\n        console.error('Error fetching invoices:', error);\n        return [];\n      }\n    },\n    retry: 3,\n    retryDelay: 1000,\n  });\n\n  const getSalesData = () => {\n    // Default return structure\n    const defaultData = {\n      dailySales: [],\n      paymentMethods: [],\n      hourlySales: {},\n      totalRevenue: 0,\n      totalOrders: 0,\n      totalCustomers: 0,\n      averageOrderValue: 0,\n    };\n\n    try {\n      const start = new Date(startDate);\n      const end = new Date(endDate);\n      end.setHours(23, 59, 59, 999);\n\n      // Combine invoices and orders data - same logic as dashboard-overview\n      const combinedData = [\n        ...(Array.isArray(invoices) ? invoices.map((invoice: any) => ({\n          ...invoice,\n          type: 'invoice' as const,\n          date: invoice.invoiceDate,\n          displayNumber: invoice.tradeNumber || invoice.invoiceNumber || `INV-${String(invoice.id).padStart(13, '0')}`,\n          displayStatus: invoice.invoiceStatus || 1,\n          customerName: invoice.customerName || 'Khách hàng lẻ',\n          customerPhone: invoice.customerPhone || '',\n          customerAddress: invoice.customerAddress || '',\n          customerTaxCode: invoice.customerTaxCode || '',\n          symbol: invoice.symbol || 'C11DTD',\n          einvoiceStatus: invoice.einvoiceStatus || 0\n        })) : []),\n        ...(Array.isArray(orders) ? orders.map((order: any) => ({\n          ...order,\n          type: 'order' as const,\n          date: order.orderedAt,\n          displayNumber: order.orderNumber || `ORD-${String(order.id).padStart(13, '0')}`,\n          displayStatus: order.status === 'paid' ? 1 : order.status === 'pending' ? 2 : order.status === 'cancelled' ? 3 : 2,\n          customerName: order.customerName || 'Khách hàng lẻ',\n          invoiceStatus: order.status === 'paid' ? 1 : order.status === 'pending' ? 2 : order.status === 'cancelled' ? 3 : 2,\n          customerPhone: '',\n          customerAddress: '',\n          customerTaxCode: '',\n          symbol: 'C11DTD',\n          einvoiceStatus: order.einvoiceStatus || 0\n        })) : [])\n      ];\n\n      // Filter completed items within date range - same logic as dashboard-overview\n      const filteredCompletedItems = Array.isArray(combinedData) ? combinedData.filter((item: any) => {\n        try {\n          if (!item || !item.date) return false;\n\n          const itemDate = new Date(item.date);\n          if (isNaN(itemDate.getTime())) return false;\n\n          const dateMatch = itemDate >= start && itemDate <= end;\n\n          // Only include completed/paid items\n          const isCompleted = (item.type === 'invoice' && item.invoiceStatus === 1) ||\n                            (item.type === 'order' && (item.status === 'paid' || item.status === 'completed'));\n\n          return dateMatch && isCompleted;\n        } catch (error) {\n          console.error('Error filtering item:', item, error);\n          return false;\n        }\n      }) : [];\n\n      console.log(\"Sales Report Debug (Combined Data):\", {\n        totalInvoices: invoices.length,\n        totalOrders: orders.length,\n        combinedDataLength: combinedData.length,\n        startDate,\n        endDate,\n        filteredCompletedItems: filteredCompletedItems.length,\n        sampleItems: filteredCompletedItems.slice(0, 5).map((item: any) => ({\n          id: item.id,\n          type: item.type,\n          displayStatus: item.displayStatus,\n          date: item.date,\n          total: item.total\n        })),\n      });\n\n      // Daily sales breakdown with tax subtraction\n      const dailySales: {\n        [date: string]: { revenue: number; orders: number; customers: number };\n      } = {};\n\n      filteredCompletedItems.forEach((item: any) => {\n        try {\n          const itemDate = new Date(item.date);\n\n          if (isNaN(itemDate.getTime())) return;\n\n          const year = itemDate.getFullYear();\n          const month = (itemDate.getMonth() + 1).toString().padStart(2, \"0\");\n          const day = itemDate.getDate().toString().padStart(2, \"0\");\n          const date = `${year}-${month}-${day}`;\n\n          if (!dailySales[date]) {\n            dailySales[date] = { revenue: 0, orders: 0, customers: 0 };\n          }\n\n          // Revenue calculation: Total Amount - Discount - Tax (using actual tax from database, default to 0)\n          const itemTotal = Number(item.total || 0);\n          const discount = Number(item.discount || 0);\n          // Use actual tax from database, default to 0 if not available\n          const actualTax = Number(item.tax || 0);\n          // Revenue = Total Amount - Discount - Actual Tax\n          const itemRevenue = itemTotal - discount - actualTax;\n          dailySales[date].revenue += itemRevenue;\n          dailySales[date].orders += 1;\n\n          // Count unique customers per day\n          if (item.customerId) {\n            dailySales[date].customers += 1;\n          } else {\n            dailySales[date].customers += 1; // Count walk-in customers\n          }\n        } catch (error) {\n          console.warn(\"Error processing item for daily sales:\", error);\n        }\n      });\n\n      // Payment method breakdown with tax subtraction\n      const paymentMethods: {\n        [method: string]: { count: number; revenue: number };\n      } = {};\n\n      filteredCompletedItems.forEach((item: any) => {\n        try {\n          // Handle both string and numeric payment methods\n          let method = item.paymentMethod;\n          if (typeof method === 'number') {\n            method = method.toString();\n          }\n          method = method || \"cash\";\n\n          if (!paymentMethods[method]) {\n            paymentMethods[method] = { count: 0, revenue: 0 };\n          }\n\n          paymentMethods[method].count += 1;\n\n          // Revenue calculation: Total Amount - Discount - Tax (using actual tax from database, default to 0)\n          const itemTotal = Number(item.total || 0);\n          const discount = Number(item.discount || 0);\n          // Use actual tax from database, default to 0 if not available\n          const actualTax = Number(item.tax || 0);\n          // Revenue = Total Amount - Discount - Actual Tax\n          const itemRevenue = itemTotal - discount - actualTax;\n          paymentMethods[method].revenue += itemRevenue;\n        } catch (error) {\n          console.warn(\"Error processing item for payment methods:\", error);\n        }\n      });\n\n      // Hourly breakdown with actual tax from database (default to 0)\n      const hourlySales: { [hour: number]: number } = {};\n      filteredCompletedItems.forEach((item: any) => {\n        try {\n          const itemDate = new Date(item.date);\n\n          if (isNaN(itemDate.getTime())) return;\n\n          const hour = itemDate.getHours();\n          const itemTotal = Number(item.total || 0);\n          const discount = Number(item.discount || 0);\n          // Use actual tax from database, default to 0 if not available\n          const actualTax = Number(item.tax || 0);\n          // Revenue = Total Amount - Discount - Actual Tax\n          const revenue = itemTotal - discount - actualTax;\n\n          if (!isNaN(revenue) && revenue > 0) {\n            hourlySales[hour] = (hourlySales[hour] || 0) + revenue;\n          }\n        } catch (error) {\n          console.warn(\"Error processing item for hourly sales:\", error);\n        }\n      });\n\n      // Calculate totals with actual tax from database (default to 0)\n      const totalRevenue = filteredCompletedItems.reduce(\n        (total: number, item: any) => {\n          const itemTotal = Number(item.total || 0);\n          const discount = Number(item.discount || 0);\n          // Use actual tax from database, default to 0 if not available\n          const actualTax = Number(item.tax || 0);\n          // Revenue = Total Amount - Discount - Actual Tax\n          const itemRevenue = itemTotal - discount - actualTax;\n          return total + itemRevenue;\n        },\n        0,\n      );\n\n      const totalOrders = filteredCompletedItems.length;\n\n      // Count unique customers EXACTLY like dashboard does\n      const uniqueCustomers = new Set();\n      filteredCompletedItems.forEach((item: any) => {\n        if (item.customerId) {\n          uniqueCustomers.add(item.customerId);\n        } else {\n          // If no customer ID, count as unique customer per item\n          uniqueCustomers.add(`item_${item.id}`);\n        }\n      });\n      const totalCustomers = uniqueCustomers.size;\n\n      const averageOrderValue = totalOrders > 0 ? totalRevenue / totalOrders : 0;\n\n      const paymentMethodsArray = Object.entries(paymentMethods).map(([method, data]) => ({\n        method,\n        ...data,\n      }));\n\n      console.log(\"Payment Methods Debug:\", {\n        totalItems: filteredCompletedItems.length,\n        paymentMethodsRaw: paymentMethods,\n        paymentMethodsArray,\n        sampleItems: filteredCompletedItems.slice(0, 3).map((item: any) => ({\n          id: item.id,\n          paymentMethod: item.paymentMethod,\n          total: item.total\n        }))\n      });\n\n      return {\n        dailySales: Object.entries(dailySales)\n          .map(([date, data]) => ({\n            date,\n            ...data,\n          }))\n          .sort((a, b) => a.date.localeCompare(b.date)),\n        paymentMethods: paymentMethodsArray,\n        hourlySales,\n        totalRevenue,\n        totalOrders,\n        totalCustomers,\n        averageOrderValue,\n      };\n    } catch (error) {\n      console.error(\"Error processing sales data:\", error);\n      return defaultData;\n    }\n  };\n\n  const handleDateRangeChange = (range: string) => {\n    setDateRange(range);\n    const today = new Date();\n\n    const formatDate = (date: Date) => {\n      const y = date.getFullYear();\n      const m = (date.getMonth() + 1).toString().padStart(2, \"0\");\n      const d = date.getDate().toString().padStart(2, \"0\");\n      return `${y}-${m}-${d}`;\n    };\n\n    switch (range) {\n      case \"today\":\n        const todayStr = formatDate(today);\n        setStartDate(todayStr);\n        setEndDate(todayStr);\n        break;\n\n      case \"week\":\n        const lastWeekEnd = new Date(today);\n        lastWeekEnd.setDate(today.getDate() - 1);\n\n        const lastWeekStart = new Date(today);\n        lastWeekStart.setDate(today.getDate() - 7);\n\n        setStartDate(formatDate(lastWeekStart));\n        setEndDate(formatDate(lastWeekEnd));\n        break;\n\n      case \"month\":\n        const lastMonth = new Date(today);\n        lastMonth.setMonth(today.getMonth() - 1);\n\n        const lastMonthStart = new Date(lastMonth.getFullYear(), lastMonth.getMonth(), 1);\n        const lastMonthEnd = new Date(lastMonth.getFullYear(), lastMonth.getMonth() + 1, 0);\n\n        setStartDate(formatDate(lastMonthStart));\n        setEndDate(formatDate(lastMonthEnd));\n        break;\n\n      case \"thisWeek\":\n        const currentDayOfWeek = today.getDay();\n        const daysToMonday = currentDayOfWeek === 0 ? 6 : currentDayOfWeek - 1;\n\n        const thisWeekMonday = new Date(today);\n        thisWeekMonday.setDate(today.getDate() - daysToMonday);\n\n        const thisWeekSunday = new Date(thisWeekMonday);\n        thisWeekSunday.setDate(thisWeekMonday.getDate() + 6);\n\n        setStartDate(formatDate(thisWeekMonday));\n        setEndDate(formatDate(thisWeekSunday));\n        break;\n\n      case \"thisMonth\":\n        const thisMonthStart = new Date(today.getFullYear(), today.getMonth(), 1);\n        const thisMonthEnd = new Date(today.getFullYear(), today.getMonth() + 1, 0);\n\n        setStartDate(formatDate(thisMonthStart));\n        setEndDate(formatDate(thisMonthEnd));\n        break;\n\n      case \"custom\":\n        const customToday = formatDate(today);\n        setStartDate(customToday);\n        setEndDate(customToday);\n        break;\n\n      default:\n        const defaultDate = formatDate(today);\n        setStartDate(defaultDate);\n        setEndDate(defaultDate);\n        break;\n    }\n  };\n\n  const formatCurrency = (amount: number) => {\n    return `${amount.toLocaleString()} ₫`;\n  };\n\n  const formatDate = (dateStr: string) => {\n    try {\n      const date = new Date(dateStr);\n      if (isNaN(date.getTime())) return dateStr;\n\n      const day = date.getDate().toString().padStart(2, \"0\");\n      const month = (date.getMonth() + 1).toString().padStart(2, \"0\");\n      const year = date.getFullYear();\n      return `${day}/${month}/${year}`;\n    } catch (error) {\n      return dateStr;\n    }\n  };\n\n  const getPaymentMethodLabel = (method: string) => {\n    const labels = {\n      cash: \"Tiền mặt\",\n      card: \"Thẻ\",\n      creditCard: \"Thẻ tín dụng\",\n      credit_card: \"Thẻ tín dụng\",\n      debitCard: \"Thẻ ghi nợ\",\n      debit_card: \"Thẻ ghi nợ\",\n      transfer: \"Chuyển khoản\",\n      einvoice: \"Hóa đơn điện tử\",\n      momo: \"MoMo\",\n      zalopay: \"ZaloPay\",\n      vnpay: \"VNPay\",\n      qrCode: \"QR Banking\",\n      shopeepay: \"ShopeePay\",\n      grabpay: \"GrabPay\",\n      mobile: \"Di động\",\n      1: \"Tiền mặt\",\n      2: \"Thẻ\",\n      3: \"Chuyển khoản\",\n      4: \"MoMo\",\n      5: \"ZaloPay\",\n      6: \"VNPay\",\n      7: \"QR Code\"\n    };\n    return labels[method as keyof typeof labels] || `Phương thức ${method}`;\n  };\n\n  const handleRefresh = () => {\n    refetch();\n  };\n\n  const salesData = getSalesData();\n  const hasError = !!ordersError;\n  const isLoading = ordersLoading || invoicesLoading;\n\n  const peakHour = salesData && Object.keys(salesData.hourlySales).length > 0\n    ? Object.entries(salesData.hourlySales).reduce(\n        (peak, [hour, revenue]) =>\n          revenue > (salesData.hourlySales[parseInt(peak)] || 0) ? hour : peak,\n        \"12\",\n      )\n    : \"12\";\n\n  // Loading state component\n  const LoadingSkeleton = () => (\n    <div className=\"space-y-4\">\n      {Array.from({ length: 3 }).map((_, index) => (\n        <div key={index} className=\"h-20 bg-gray-200 rounded animate-pulse\"></div>\n      ))}\n    </div>\n  );\n\n  // Error state component\n  const ErrorState = () => (\n    <Card className=\"border-red-200\">\n      <CardContent className=\"p-6\">\n        <div className=\"text-center text-red-600\">\n          <p className=\"mb-4\">{t(\"common.errorLoadingData\")}</p>\n          <p className=\"text-sm text-gray-600 mb-4\">\n            {ordersError?.message || \"Không thể tải dữ liệu đơn hàng\"}\n          </p>\n          <Button onClick={() => window.location.reload()} variant=\"outline\" size=\"sm\">\n            <RefreshCw className=\"w-4 h-4 mr-2\" />\n            {t(\"reports.refresh\")}\n          </Button>\n        </div>\n      </CardContent>\n    </Card>\n  );\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header with Filters */}\n      <Card className=\"border-green-200 shadow-sm\">\n        <CardHeader className=\"pb-4\">\n          <div className=\"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4\">\n            <div>\n              <CardTitle className=\"text-xl font-bold text-green-700 flex items-center gap-2\">\n                <TrendingUp className=\"w-5 h-5\" />\n                {t('reports.salesAnalysis')}\n              </CardTitle>\n              <CardDescription className=\"text-gray-600\">\n                {t('reports.analyzeRevenue')}\n              </CardDescription>\n            </div>\n\n            <div className=\"flex flex-col sm:flex-row items-start sm:items-center gap-4\">\n              <div className=\"flex items-center gap-2\">\n                <Filter className=\"w-4 h-4 text-gray-500\" />\n                <Select value={dateRange} onValueChange={handleDateRangeChange}>\n                  <SelectTrigger className=\"w-40\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"today\">{t(\"reports.toDay\")}</SelectItem>\n                    <SelectItem value=\"thisWeek\">Tuần này</SelectItem>\n                    <SelectItem value=\"week\">Tuần trước</SelectItem>\n                    <SelectItem value=\"thisMonth\">Tháng này</SelectItem>\n                    <SelectItem value=\"month\">Tháng trước</SelectItem>\n                    <SelectItem value=\"custom\">{t(\"reports.custom\")}</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              {dateRange === \"custom\" && (\n                <div className=\"flex flex-col sm:flex-row gap-2\">\n                  <div className=\"flex items-center gap-2\">\n                    <Label htmlFor=\"startDate\" className=\"text-sm whitespace-nowrap\">\n                      {t('reports.startDate')}:\n                    </Label>\n                    <Input\n                      id=\"startDate\"\n                      type=\"date\"\n                      value={startDate}\n                      onChange={(e) => setStartDate(e.target.value)}\n                      className=\"w-auto\"\n                    />\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <Label htmlFor=\"endDate\" className=\"text-sm whitespace-nowrap\">\n                      {t('reports.endDate')}:\n                    </Label>\n                    <Input\n                      id=\"endDate\"\n                      type=\"date\"\n                      value={endDate}\n                      onChange={(e) => setEndDate(e.target.value)}\n                      className=\"w-auto\"\n                    />\n                  </div>\n                </div>\n              )}\n\n              <Button\n                onClick={handleRefresh}\n                variant=\"outline\"\n                size=\"sm\"\n                disabled={ordersLoading}\n                className=\"flex items-center gap-2\"\n              >\n                <RefreshCw className={`w-4 h-4 ${ordersLoading ? 'animate-spin' : ''}`} />\n                {t(\"reports.refresh\")}\n              </Button>\n            </div>\n          </div>\n        </CardHeader>\n      </Card>\n\n      {/* Content */}\n      {isLoading ? (\n        <LoadingSkeleton />\n      ) : hasError ? (\n        <ErrorState />\n      ) : (\n        <>\n          {/* Summary Stats */}\n          <div className=\"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4\">\n            <Card className=\"border-green-200 hover:shadow-md transition-shadow\">\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm font-medium text-gray-600\">\n                      {t(\"reports.totalRevenue\")}\n                    </p>\n                    <p className=\"text-2xl font-bold text-green-600\">\n                      {formatCurrency(salesData?.totalRevenue || 0)}\n                    </p>\n                  </div>\n                  <DollarSign className=\"w-8 h-8 text-green-500\" />\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card className=\"border-blue-200 hover:shadow-md transition-shadow\">\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm font-medium text-gray-600\">\n                      {t(\"reports.totalOrders\")}\n                    </p>\n                    <p className=\"text-2xl font-bold text-blue-600\">\n                      {salesData?.totalOrders || 0}\n                    </p>\n                  </div>\n                  <Calendar className=\"w-8 h-8 text-blue-500\" />\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card className=\"border-purple-200 hover:shadow-md transition-shadow\">\n              <CardContent className=\"p-6\">\n                <div>\n                  <p className=\"text-sm font-medium text-gray-600\">\n                    {t(\"reports.averageOrderValue\")}\n                  </p>\n                  <p className=\"text-2xl font-bold text-purple-600\">\n                    {formatCurrency(salesData?.averageOrderValue || 0)}\n                  </p>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card className=\"border-orange-200 hover:shadow-md transition-shadow\">\n              <CardContent className=\"p-6\">\n                <div>\n                  <p className=\"text-sm font-medium text-gray-600\">\n                    {t(\"reports.totalCustomers\")}\n                  </p>\n                  <p className=\"text-2xl font-bold text-orange-600\">\n                    {salesData?.totalCustomers || 0}\n                  </p>\n                  <p className=\"text-xs text-gray-500 mt-1\">\n                    {t(\"reports.peakHour\")}: {peakHour}{t(\"reports.hour\")}\n                  </p>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* Charts and Tables */}\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            {/* Daily Sales */}\n            <Card className=\"shadow-sm\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Calendar className=\"w-5 h-5\" />\n                  {t(\"reports.dailySales\")}\n                </CardTitle>\n                <CardDescription>{t(\"reports.analyzeRevenue\")}</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"max-h-96 overflow-y-auto\">\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead className=\"sticky top-0 bg-white\">{t(\"common.date\")}</TableHead>\n                        <TableHead className=\"sticky top-0 bg-white\">{t(\"reports.revenue\")}</TableHead>\n                        <TableHead className=\"sticky top-0 bg-white\">Tổng đơn hàng</TableHead>\n                        <TableHead className=\"sticky top-0 bg-white\">Tổng khách hàng</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {salesData?.dailySales && salesData.dailySales.length > 0 ? (\n                        salesData.dailySales.map((day) => (\n                          <TableRow key={day.date} className=\"hover:bg-gray-50\">\n                            <TableCell className=\"font-medium\">{formatDate(day.date)}</TableCell>\n                            <TableCell className=\"font-medium text-green-600\">\n                              {formatCurrency(day.revenue)}\n                            </TableCell>\n                            <TableCell>\n                              {day.orders}\n                            </TableCell>\n                            <TableCell>\n                              {day.customers}\n                            </TableCell>\n                          </TableRow>\n                        ))\n                      ) : (\n                        <TableRow>\n                          <TableCell colSpan={4} className=\"text-center text-gray-500 py-8\">\n                            {t(\"reports.noSalesData\")}\n                          </TableCell>\n                        </TableRow>\n                      )}\n                    </TableBody>\n                  </Table>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Payment Methods */}\n            <Card className=\"shadow-sm\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <DollarSign className=\"w-5 h-5\" />\n                  {t(\"reports.paymentMethods\")}\n                </CardTitle>\n                <CardDescription>\n                  {t(\"reports.analyzeRevenue\")}\n                  {salesData?.paymentMethods && salesData.paymentMethods.length > 0 && (\n                    <span className=\"ml-2 text-blue-600 font-medium\">\n                      ({salesData.paymentMethods.length} phương thức • {salesData.totalOrders} đơn hàng)\n                    </span>\n                  )}\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4 max-h-96 overflow-y-auto\">\n                  {salesData?.paymentMethods && salesData.paymentMethods.length > 0 ? (\n                    salesData.paymentMethods.map((payment) => {\n                      const percentage =\n                        (salesData?.totalRevenue || 0) > 0\n                          ? (Number(payment.revenue) / Number(salesData?.totalRevenue || 1)) * 100\n                          : 0;\n\n                      return (\n                        <div key={payment.method} className=\"space-y-3 p-4 bg-gradient-to-r from-gray-50 to-gray-100 rounded-lg border border-gray-200 hover:shadow-md transition-shadow\">\n                          <div className=\"flex justify-between items-start\">\n                            <div className=\"flex-1\">\n                              <div className=\"flex items-center gap-3 mb-2\">\n                                <Badge variant=\"outline\" className=\"font-semibold text-blue-700 border-blue-300 bg-blue-50\">\n                                  {getPaymentMethodLabel(payment.method)}\n                                </Badge>\n                                <span className=\"text-sm font-medium text-gray-700 bg-white px-2 py-1 rounded\">\n                                  Mã: {payment.method}\n                                </span>\n                              </div>\n\n                              <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                                <div className=\"space-y-1\">\n                                  <div className=\"text-gray-600\">Số đơn hàng:</div>\n                                  <div className=\"font-semibold text-blue-600 text-lg\">\n                                    {payment.count} đơn\n                                  </div>\n                                </div>\n                                <div className=\"space-y-1\">\n                                  <div className=\"text-gray-600\">Tổng tiền:</div>\n                                  <div className=\"font-bold text-green-600 text-lg\">\n                                    {formatCurrency(payment.revenue)}\n                                  </div>\n                                </div>\n                              </div>\n\n                              <div className=\"mt-2 flex items-center gap-2\">\n                                <span className=\"text-xs text-gray-500\">Tỷ lệ:</span>\n                                <span className=\"text-sm font-semibold text-purple-600\">\n                                  {isFinite(percentage) ? percentage.toFixed(1) : '0.0'}%\n                                </span>\n                                <span className=\"text-xs text-gray-500\">tổng doanh thu</span>\n                              </div>\n                            </div>\n                          </div>\n\n                          <div className=\"space-y-2\">\n                            <div className=\"flex justify-between text-xs text-gray-600\">\n                              <span>Biểu đồ tỷ lệ</span>\n                              <span>{isFinite(percentage) ? percentage.toFixed(1) : '0.0'}%</span>\n                            </div>\n                            <div className=\"w-full bg-gray-300 rounded-full h-3 overflow-hidden\">\n                              <div\n                                className=\"bg-gradient-to-r from-blue-500 via-blue-600 to-purple-600 h-3 rounded-full transition-all duration-500 ease-out\"\n                                style={{ width: `${Math.min(percentage, 100)}%` }}\n                              ></div>\n                            </div>\n                          </div>\n                        </div>\n                      );\n                    })\n                  ) : (\n                    <div className=\"text-center text-gray-500 py-8\">\n                      <div className=\"bg-gray-50 rounded-lg p-6\">\n                        <p className=\"text-gray-600 mb-2\">{t(\"reports.noPaymentData\")}</p>\n                        <p className=\"text-sm text-gray-500\">{t(\"reports.noPaymentDataDescription\")}</p>\n                      </div>\n                    </div>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </>\n      )}\n    </div>\n  );\n}","size_bytes":30543},"client/src/components/reports/supplier-report.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Building2, Search, BarChart3, TrendingUp } from \"lucide-react\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from \"recharts\";\n\nexport function SupplierReport() {\n  const { t } = useTranslation();\n  const [startDate, setStartDate] = useState<string>(\n    new Date().toISOString().split(\"T\")[0]\n  );\n  const [endDate, setEndDate] = useState<string>(\n    new Date().toISOString().split(\"T\")[0]\n  );\n  const [concernType, setConcernType] = useState<string>(\"purchase\");\n  const [supplierSearch, setSupplierSearch] = useState<string>(\"\");\n  const [debtFrom, setDebtFrom] = useState<string>(\"\");\n  const [debtTo, setDebtTo] = useState<string>(\"\");\n\n  const { data: suppliers } = useQuery({\n    queryKey: [\"/api/suppliers\"],\n  });\n\n  const { data: supplierDebts } = useQuery({\n    queryKey: [\"/api/supplier-debts\"],\n    enabled: concernType === \"debt\",\n  });\n\n  const { data: supplierPurchases } = useQuery({\n    queryKey: [\"/api/supplier-purchases\"],\n    enabled: concernType === \"purchase\" || concernType === \"purchaseBySupplier\",\n  });\n\n  const formatCurrency = (amount: number) => {\n    return `${amount.toLocaleString()} ₫`;\n  };\n\n  const formatDate = (dateStr: string) => {\n    return new Date(dateStr).toLocaleDateString(\"vi-VN\", {\n      day: \"2-digit\",\n      month: \"2-digit\",\n      year: \"numeric\",\n    });\n  };\n\n  const getSupplierPurchaseData = () => {\n    if (!supplierPurchases || !Array.isArray(supplierPurchases)) return [];\n\n    const start = new Date(startDate);\n    const end = new Date(endDate);\n    end.setHours(23, 59, 59, 999);\n\n    return supplierPurchases\n      .filter((purchase: any) => {\n        const purchaseDate = new Date(purchase.createdAt || purchase.created_at);\n        const dateMatch = purchaseDate >= start && purchaseDate <= end;\n\n        const supplierMatch =\n          !supplierSearch ||\n          (purchase.supplier?.code &&\n            purchase.supplier.code.toLowerCase().includes(supplierSearch.toLowerCase())) ||\n          (purchase.supplier?.name &&\n            purchase.supplier.name.toLowerCase().includes(supplierSearch.toLowerCase())) ||\n          (purchase.supplier?.phone && \n            purchase.supplier.phone.includes(supplierSearch)) ||\n          (purchase.supplierCode &&\n            purchase.supplierCode.toLowerCase().includes(supplierSearch.toLowerCase())) ||\n          (purchase.supplierName &&\n            purchase.supplierName.toLowerCase().includes(supplierSearch.toLowerCase()));\n\n        return dateMatch && supplierMatch;\n      })\n      .map((purchase: any) => ({\n        supplierCode: purchase.supplier?.code || purchase.supplierCode || purchase.supplier?.id || \"N/A\",\n        supplierName: purchase.supplier?.name || purchase.supplierName || \"Không xác định\",\n        purchaseValue: Number(purchase.purchaseValue || purchase.totalValue || 0),\n        returnValue: Number(purchase.returnValue || 0),\n        netValue: Number(purchase.purchaseValue || purchase.totalValue || 0) - Number(purchase.returnValue || 0),\n      }));\n  };\n\n  const getSupplierDebtData = () => {\n    if (!supplierDebts || !Array.isArray(supplierDebts)) return [];\n\n    const start = new Date(startDate);\n    const end = new Date(endDate);\n    end.setHours(23, 59, 59, 999);\n\n    return supplierDebts\n      .filter((debt: any) => {\n        const debtDate = new Date(debt.createdAt || debt.created_at);\n        const dateMatch = debtDate >= start && debtDate <= end;\n\n        const supplierMatch =\n          !supplierSearch ||\n          (debt.supplier?.code &&\n            debt.supplier.code.toLowerCase().includes(supplierSearch.toLowerCase())) ||\n          (debt.supplier?.name &&\n            debt.supplier.name.toLowerCase().includes(supplierSearch.toLowerCase())) ||\n          (debt.supplier?.phone && \n            debt.supplier.phone.includes(supplierSearch)) ||\n          (debt.supplierCode &&\n            debt.supplierCode.toLowerCase().includes(supplierSearch.toLowerCase())) ||\n          (debt.supplierName &&\n            debt.supplierName.toLowerCase().includes(supplierSearch.toLowerCase()));\n\n        const debtAmountMatch = (() => {\n          if (!debtFrom && !debtTo) return true;\n          const from = debtFrom ? Number(debtFrom) : 0;\n          const to = debtTo ? Number(debtTo) : Infinity;\n          const closingDebt = Number(debt.closingDebt || 0);\n          return closingDebt >= from && closingDebt <= to;\n        })();\n\n        return dateMatch && supplierMatch && debtAmountMatch;\n      })\n      .map((debt: any) => ({\n        supplierCode: debt.supplier?.code || debt.supplierCode || debt.supplier?.id || \"N/A\",\n        supplierName: debt.supplier?.name || debt.supplierName || \"Không xác định\",\n        openingDebt: Number(debt.openingDebt || 0),\n        debitAmount: Number(debt.debitAmount || 0),\n        creditAmount: Number(debt.creditAmount || 0),\n        closingDebt: Number(debt.closingDebt || 0),\n      }));\n  };\n\n  const getSupplierProductData = () => {\n    if (!supplierPurchases || !Array.isArray(supplierPurchases)) return [];\n\n    const start = new Date(startDate);\n    const end = new Date(endDate);\n    end.setHours(23, 59, 59, 999);\n\n    const supplierProductMap = new Map();\n\n    supplierPurchases.forEach((purchase: any) => {\n      const purchaseDate = new Date(purchase.createdAt || purchase.created_at);\n      const dateMatch = purchaseDate >= start && purchaseDate <= end;\n\n      if (!dateMatch) return;\n\n      const supplierCode = purchase.supplier?.code || purchase.supplierCode || purchase.supplier?.id || \"N/A\";\n      const supplierName = purchase.supplier?.name || purchase.supplierName || \"Không xác định\";\n\n      const supplierMatch =\n        !supplierSearch ||\n        supplierCode.toLowerCase().includes(supplierSearch.toLowerCase()) ||\n        supplierName.toLowerCase().includes(supplierSearch.toLowerCase()) ||\n        (purchase.supplier?.phone && purchase.supplier.phone.includes(supplierSearch));\n\n      if (!supplierMatch) return;\n\n      const key = supplierCode;\n      if (!supplierProductMap.has(key)) {\n        supplierProductMap.set(key, {\n          supplierCode,\n          supplierName,\n          openingDebt: Number(purchase.openingDebt || 0),\n          debitAmount: Number(purchase.debitAmount || 0),\n          creditAmount: Number(purchase.creditAmount || 0),\n          closingDebt: Number(purchase.closingDebt || 0),\n        });\n      }\n    });\n\n    return Array.from(supplierProductMap.values());\n  };\n\n  const renderPurchaseReport = () => {\n    const data = getSupplierPurchaseData();\n    const chartData = data.slice(0, 10).map((item) => ({\n      name: item.supplierName.length > 15 \n        ? item.supplierName.substring(0, 15) + \"...\" \n        : item.supplierName,\n      value: item.netValue,\n    }));\n\n    return (\n      <div className=\"space-y-6\">\n        {/* Chart */}\n        <Card className=\"shadow-xl border-0 bg-gradient-to-br from-green-50/50 to-emerald-50/30\">\n          <CardHeader className=\"bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-t-lg\">\n            <CardTitle className=\"flex items-center gap-3 text-lg font-semibold\">\n              <div className=\"p-2 bg-white/20 rounded-lg\">\n                <BarChart3 className=\"w-6 h-6\" />\n              </div>\n              <div>\n                <div className=\"text-white/90 text-sm font-normal\">\n                  {t(\"reports.chartView\")}\n                </div>\n                <div className=\"text-white font-semibold\">\n                  {t(\"reports.supplierPurchaseReportTitle\")}\n                </div>\n              </div>\n            </CardTitle>\n            <CardDescription className=\"text-green-100 mt-2\">\n              {t(\"reports.visualRepresentation\")} - {t(\"reports.fromDate\")}: {formatDate(startDate)} {t(\"reports.toDate\")}: {formatDate(endDate)}\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"p-8 bg-white/80 backdrop-blur-sm\">\n            <div className=\"h-[450px] w-full bg-white/90 rounded-xl border-0 shadow-lg p-6 relative overflow-hidden\">\n              <div className=\"absolute inset-0 bg-gradient-to-br from-green-50/30 to-emerald-50/20 rounded-xl\"></div>\n              <div className=\"absolute top-4 right-4 flex items-center gap-2 text-sm text-gray-500\">\n                <div className=\"w-2 h-2 bg-green-500 rounded-full animate-pulse\"></div>\n                Live Data\n              </div>\n\n              <div className=\"relative z-10 h-full\">\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <BarChart\n                    data={chartData}\n                    margin={{ top: 30, right: 40, left: 30, bottom: 90 }}\n                    barCategoryGap=\"25%\"\n                  >\n                    <defs>\n                      <linearGradient\n                        id=\"supplierGradient\"\n                        x1=\"0\"\n                        y1=\"0\"\n                        x2=\"0\"\n                        y2=\"1\"\n                      >\n                        <stop\n                          offset=\"0%\"\n                          stopColor=\"#22c55e\"\n                          stopOpacity={0.9}\n                        />\n                        <stop\n                          offset=\"100%\"\n                          stopColor=\"#22c55e\"\n                          stopOpacity={0.6}\n                        />\n                      </linearGradient>\n                    </defs>\n                    <CartesianGrid\n                      strokeDasharray=\"2 4\"\n                      stroke=\"#e2e8f0\"\n                      opacity={0.4}\n                      horizontal={true}\n                      vertical={false}\n                    />\n                    <XAxis\n                      dataKey=\"name\"\n                      tick={{ fontSize: 12, fill: \"#475569\", fontWeight: 500 }}\n                      angle={-35}\n                      textAnchor=\"end\"\n                      height={85}\n                      interval={0}\n                      tickMargin={12}\n                      axisLine={{ stroke: \"#cbd5e1\", strokeWidth: 1 }}\n                      tickLine={{ stroke: \"#cbd5e1\", strokeWidth: 1 }}\n                    />\n                    <YAxis\n                      tick={{ fontSize: 12, fill: \"#475569\", fontWeight: 500 }}\n                      tickFormatter={(value) => {\n                        if (value >= 1000000) {\n                          return `${(value / 1000000).toFixed(1)}M`;\n                        } else if (value >= 1000) {\n                          return `${(value / 1000).toFixed(0)}K`;\n                        }\n                        return value.toString();\n                      }}\n                      width={70}\n                      axisLine={{ stroke: \"#cbd5e1\", strokeWidth: 1 }}\n                      tickLine={{ stroke: \"#cbd5e1\", strokeWidth: 1 }}\n                    />\n                    <Tooltip\n                      formatter={(value: any) => [formatCurrency(value), t(\"reports.netValue\")]}\n                      labelStyle={{\n                        color: \"#1e293b\",\n                        fontWeight: 600,\n                        fontSize: 13,\n                        marginBottom: 4,\n                      }}\n                      contentStyle={{\n                        backgroundColor: \"rgba(255, 255, 255, 0.98)\",\n                        border: \"1px solid #e2e8f0\",\n                        borderRadius: \"12px\",\n                        boxShadow:\n                          \"0 10px 25px -5px rgb(0 0 0 / 0.15), 0 4px 6px -2px rgb(0 0 0 / 0.05)\",\n                        padding: \"12px 16px\",\n                        backdropFilter: \"blur(8px)\",\n                      }}\n                      cursor={{ fill: \"rgba(34, 197, 94, 0.05)\" }}\n                    />\n                    <Bar\n                      dataKey=\"value\"\n                      fill=\"url(#supplierGradient)\"\n                      radius={[6, 6, 0, 0]}\n                      maxBarSize={45}\n                      stroke=\"#16a34a\"\n                      strokeWidth={1}\n                    />\n                  </BarChart>\n                </ResponsiveContainer>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Report Table */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Building2 className=\"w-5 h-5\" />\n              {t(\"reports.supplierPurchaseReportTitle\")}\n            </CardTitle>\n            <CardDescription>\n              {t(\"reports.fromDate\")}: {formatDate(startDate)} - {t(\"reports.toDate\")}: {formatDate(endDate)}\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>{t(\"reports.supplierCode\")}</TableHead>\n                  <TableHead>{t(\"reports.supplierName\")}</TableHead>\n                  <TableHead className=\"text-right\">{t(\"reports.purchaseValue\")}</TableHead>\n                  <TableHead className=\"text-right\">{t(\"reports.returnValue\")}</TableHead>\n                  <TableHead className=\"text-right\">{t(\"reports.netValue\")}</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {data.length > 0 ? (\n                  data.map((item, index) => (\n                    <TableRow key={index}>\n                      <TableCell className=\"font-medium\">{item.supplierCode}</TableCell>\n                      <TableCell>{item.supplierName}</TableCell>\n                      <TableCell className=\"text-right text-green-600\">\n                        {formatCurrency(item.purchaseValue)}\n                      </TableCell>\n                      <TableCell className=\"text-right text-red-600\">\n                        {formatCurrency(item.returnValue)}\n                      </TableCell>\n                      <TableCell className=\"text-right text-blue-600\">\n                        {formatCurrency(item.netValue)}\n                      </TableCell>\n                    </TableRow>\n                  ))\n                ) : (\n                  <TableRow>\n                    <TableCell colSpan={5} className=\"text-center text-gray-500 italic\">\n                      {t(\"reports.noReportData\")}\n                    </TableCell>\n                  </TableRow>\n                )}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  };\n\n  const renderDebtReport = () => {\n    const data = getSupplierDebtData();\n    const chartData = data.slice(0, 10).map((item) => ({\n      name: item.supplierName.length > 15 \n        ? item.supplierName.substring(0, 15) + \"...\" \n        : item.supplierName,\n      value: item.closingDebt,\n    }));\n\n    return (\n      <div className=\"space-y-6\">\n        {/* Chart */}\n        <Card className=\"shadow-xl border-0 bg-gradient-to-br from-red-50/50 to-rose-50/30\">\n          <CardHeader className=\"bg-gradient-to-r from-red-600 to-rose-600 text-white rounded-t-lg\">\n            <CardTitle className=\"flex items-center gap-3 text-lg font-semibold\">\n              <div className=\"p-2 bg-white/20 rounded-lg\">\n                <BarChart3 className=\"w-6 h-6\" />\n              </div>\n              <div>\n                <div className=\"text-white/90 text-sm font-normal\">\n                  {t(\"reports.chartView\")}\n                </div>\n                <div className=\"text-white font-semibold\">\n                  {t(\"reports.supplierDebtReportTitle\")}\n                </div>\n              </div>\n            </CardTitle>\n            <CardDescription className=\"text-red-100 mt-2\">\n              {t(\"reports.visualRepresentation\")} - {t(\"reports.fromDate\")}: {formatDate(startDate)} {t(\"reports.toDate\")}: {formatDate(endDate)}\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"p-8 bg-white/80 backdrop-blur-sm\">\n            <div className=\"h-[450px] w-full bg-white/90 rounded-xl border-0 shadow-lg p-6 relative overflow-hidden\">\n              <div className=\"absolute inset-0 bg-gradient-to-br from-red-50/30 to-rose-50/20 rounded-xl\"></div>\n              <div className=\"absolute top-4 right-4 flex items-center gap-2 text-sm text-gray-500\">\n                <div className=\"w-2 h-2 bg-red-500 rounded-full animate-pulse\"></div>\n                Live Data\n              </div>\n\n              <div className=\"relative z-10 h-full\">\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <BarChart\n                    data={chartData}\n                    margin={{ top: 30, right: 40, left: 30, bottom: 90 }}\n                    barCategoryGap=\"25%\"\n                  >\n                    <defs>\n                      <linearGradient\n                        id=\"debtGradient\"\n                        x1=\"0\"\n                        y1=\"0\"\n                        x2=\"0\"\n                        y2=\"1\"\n                      >\n                        <stop\n                          offset=\"0%\"\n                          stopColor=\"#ef4444\"\n                          stopOpacity={0.9}\n                        />\n                        <stop\n                          offset=\"100%\"\n                          stopColor=\"#ef4444\"\n                          stopOpacity={0.6}\n                        />\n                      </linearGradient>\n                    </defs>\n                    <CartesianGrid\n                      strokeDasharray=\"2 4\"\n                      stroke=\"#e2e8f0\"\n                      opacity={0.4}\n                      horizontal={true}\n                      vertical={false}\n                    />\n                    <XAxis\n                      dataKey=\"name\"\n                      tick={{ fontSize: 12, fill: \"#475569\", fontWeight: 500 }}\n                      angle={-35}\n                      textAnchor=\"end\"\n                      height={85}\n                      interval={0}\n                      tickMargin={12}\n                      axisLine={{ stroke: \"#cbd5e1\", strokeWidth: 1 }}\n                      tickLine={{ stroke: \"#cbd5e1\", strokeWidth: 1 }}\n                    />\n                    <YAxis\n                      tick={{ fontSize: 12, fill: \"#475569\", fontWeight: 500 }}\n                      tickFormatter={(value) => {\n                        if (value >= 1000000) {\n                          return `${(value / 1000000).toFixed(1)}M`;\n                        } else if (value >= 1000) {\n                          return `${(value / 1000).toFixed(0)}K`;\n                        }\n                        return value.toString();\n                      }}\n                      width={70}\n                      axisLine={{ stroke: \"#cbd5e1\", strokeWidth: 1 }}\n                      tickLine={{ stroke: \"#cbd5e1\", strokeWidth: 1 }}\n                    />\n                    <Tooltip\n                      formatter={(value: any) => [formatCurrency(value), t(\"reports.closingDebt\")]}\n                      labelStyle={{\n                        color: \"#1e293b\",\n                        fontWeight: 600,\n                        fontSize: 13,\n                        marginBottom: 4,\n                      }}\n                      contentStyle={{\n                        backgroundColor: \"rgba(255, 255, 255, 0.98)\",\n                        border: \"1px solid #e2e8f0\",\n                        borderRadius: \"12px\",\n                        boxShadow:\n                          \"0 10px 25px -5px rgb(0 0 0 / 0.15), 0 4px 6px -2px rgb(0 0 0 / 0.05)\",\n                        padding: \"12px 16px\",\n                        backdropFilter: \"blur(8px)\",\n                      }}\n                      cursor={{ fill: \"rgba(239, 68, 68, 0.05)\" }}\n                    />\n                    <Bar\n                      dataKey=\"value\"\n                      fill=\"url(#debtGradient)\"\n                      radius={[6, 6, 0, 0]}\n                      maxBarSize={45}\n                      stroke=\"#dc2626\"\n                      strokeWidth={1}\n                    />\n                  </BarChart>\n                </ResponsiveContainer>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Report Table */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Building2 className=\"w-5 h-5\" />\n              {t(\"reports.supplierDebtReportTitle\")}\n            </CardTitle>\n            <CardDescription>\n              {t(\"reports.fromDate\")}: {formatDate(startDate)} - {t(\"reports.toDate\")}: {formatDate(endDate)}\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>{t(\"reports.supplierCode\")}</TableHead>\n                  <TableHead>{t(\"reports.supplierName\")}</TableHead>\n                  <TableHead className=\"text-right\">{t(\"reports.openingDebt\")}</TableHead>\n                  <TableHead className=\"text-right\">{t(\"reports.debitAmount\")}</TableHead>\n                  <TableHead className=\"text-right\">{t(\"reports.creditAmount\")}</TableHead>\n                  <TableHead className=\"text-right\">{t(\"reports.closingDebt\")}</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {data.length > 0 ? (\n                  data.map((item, index) => (\n                    <TableRow key={index}>\n                      <TableCell className=\"font-medium\">{item.supplierCode}</TableCell>\n                      <TableCell>{item.supplierName}</TableCell>\n                      <TableCell className=\"text-right\">\n                        {formatCurrency(item.openingDebt)}\n                      </TableCell>\n                      <TableCell className=\"text-right text-red-600\">\n                        {formatCurrency(item.debitAmount)}\n                      </TableCell>\n                      <TableCell className=\"text-right text-green-600\">\n                        {formatCurrency(item.creditAmount)}\n                      </TableCell>\n                      <TableCell className=\"text-right text-blue-600\">\n                        {formatCurrency(item.closingDebt)}\n                      </TableCell>\n                    </TableRow>\n                  ))\n                ) : (\n                  <TableRow>\n                    <TableCell colSpan={6} className=\"text-center text-gray-500 italic\">\n                      {t(\"reports.noReportData\")}\n                    </TableCell>\n                  </TableRow>\n                )}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  };\n\n  const renderProductsBySupplierReport = () => {\n    const data = getSupplierProductData();\n\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Building2 className=\"w-5 h-5\" />\n            {t(\"reports.supplierProductPurchaseReportTitle\")}\n          </CardTitle>\n          <CardDescription>\n            {t(\"reports.fromDate\")}: {formatDate(startDate)} - {t(\"reports.toDate\")}: {formatDate(endDate)}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>{t(\"reports.supplierCode\")}</TableHead>\n                <TableHead>{t(\"reports.supplierName\")}</TableHead>\n                <TableHead className=\"text-right\">{t(\"reports.openingDebt\")}</TableHead>\n                <TableHead className=\"text-right\">{t(\"reports.debitAmount\")}</TableHead>\n                <TableHead className=\"text-right\">{t(\"reports.creditAmount\")}</TableHead>\n                <TableHead className=\"text-right\">{t(\"reports.closingDebt\")}</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {data.length > 0 ? (\n                data.map((item, index) => (\n                  <TableRow key={index}>\n                    <TableCell className=\"font-medium\">{item.supplierCode}</TableCell>\n                    <TableCell>{item.supplierName}</TableCell>\n                    <TableCell className=\"text-right\">\n                      {formatCurrency(item.openingDebt)}\n                    </TableCell>\n                    <TableCell className=\"text-right text-red-600\">\n                      {formatCurrency(item.debitAmount)}\n                    </TableCell>\n                    <TableCell className=\"text-right text-green-600\">\n                      {formatCurrency(item.creditAmount)}\n                    </TableCell>\n                    <TableCell className=\"text-right text-blue-600\">\n                      {formatCurrency(item.closingDebt)}\n                    </TableCell>\n                  </TableRow>\n                ))\n              ) : (\n                <TableRow>\n                  <TableCell colSpan={6} className=\"text-center text-gray-500 italic\">\n                    {t(\"reports.noReportData\")}\n                  </TableCell>\n                </TableRow>\n              )}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    );\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Main Filters */}\n      <Card>\n        <CardHeader>\n          {t('reports.supplierReport')}\n          <CardDescription>{t(\"reports.supplierReportDescription\")}</CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n            <div>\n              <Label htmlFor=\"concern-type\">{t(\"reports.supplierConcernType\")}</Label>\n              <Select value={concernType} onValueChange={setConcernType}>\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"purchase\">{t(\"reports.supplierPurchase\")}</SelectItem>\n                  <SelectItem value=\"debt\">{t(\"reports.supplierDebt\")}</SelectItem>\n                  <SelectItem value=\"purchaseBySupplier\">{t(\"reports.supplierPurchaseBySupplier\")}</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div>\n              <Label htmlFor=\"start-date\">{t(\"reports.startDate\")}</Label>\n              <Input\n                id=\"start-date\"\n                type=\"date\"\n                value={startDate}\n                onChange={(e) => setStartDate(e.target.value)}\n              />\n            </div>\n\n            <div>\n              <Label htmlFor=\"end-date\">{t(\"reports.endDate\")}</Label>\n              <Input\n                id=\"end-date\"\n                type=\"date\"\n                value={endDate}\n                onChange={(e) => setEndDate(e.target.value)}\n              />\n            </div>\n\n            <div>\n              <Label htmlFor=\"supplier-search\">{t(\"reports.supplierFilter\")}</Label>\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4\" />\n                <Input\n                  id=\"supplier-search\"\n                  placeholder={t(\"reports.supplierFilterPlaceholder\")}\n                  value={supplierSearch}\n                  onChange={(e) => setSupplierSearch(e.target.value)}\n                  className=\"pl-10\"\n                />\n              </div>\n            </div>\n          </div>\n\n          {/* Debt Range Filter - Only show for debt concern type */}\n          {concernType === \"debt\" && (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4 pt-4 border-t\">\n              <div>\n                <Label htmlFor=\"debt-from\">{t(\"reports.supplierDebtFrom\")}</Label>\n                <Input\n                  id=\"debt-from\"\n                  type=\"number\"\n                  placeholder=\"0\"\n                  value={debtFrom}\n                  onChange={(e) => setDebtFrom(e.target.value)}\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"debt-to\">{t(\"reports.supplierDebtTo\")}</Label>\n                <Input\n                  id=\"debt-to\"\n                  type=\"number\"\n                  placeholder=\"999999999\"\n                  value={debtTo}\n                  onChange={(e) => setDebtTo(e.target.value)}\n                />\n              </div>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Report Content Based on Concern Type */}\n      <div key={concernType}>\n        {concernType === \"purchase\" && renderPurchaseReport()}\n        {concernType === \"debt\" && renderDebtReport()}\n        {concernType === \"purchaseBySupplier\" && renderProductsBySupplierReport()}\n      </div>\n    </div>\n  );\n}","size_bytes":29366},"client/src/components/reports/table-report.tsx":{"content":"\nimport { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Utensils, Clock, Users, TrendingUp } from \"lucide-react\";\nimport type { Order, Table as TableType, Invoice, Transaction } from \"@shared/schema\";\nimport { useTranslation } from \"@/lib/i18n\";\n\nexport function TableReport() {\n  const { t } = useTranslation();\n\n  const [dateRange, setDateRange] = useState(\"today\");\n  const [startDate, setStartDate] = useState<string>(\n    new Date().toISOString().split(\"T\")[0],\n  );\n  const [endDate, setEndDate] = useState<string>(\n    new Date().toISOString().split(\"T\")[0],\n  );\n\n  // Fetch data using EXACT same pattern as other reports\n  const { data: orders = [], isLoading: ordersLoading } = useQuery({\n    queryKey: [\"/api/orders\"],\n    queryFn: async () => {\n      try {\n        const response = await fetch(\"/api/orders\");\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        const data = await response.json();\n        console.log(\"Table Report - Orders loaded:\", data?.length || 0);\n        return Array.isArray(data) ? data : [];\n      } catch (error) {\n        console.error('Table Report - Error fetching orders:', error);\n        return [];\n      }\n    },\n    retry: 3,\n    retryDelay: 1000,\n  });\n\n  const { data: invoices = [], isLoading: invoicesLoading } = useQuery({\n    queryKey: [\"/api/invoices\"],\n    queryFn: async () => {\n      try {\n        const response = await fetch(\"/api/invoices\");\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        const data = await response.json();\n        console.log(\"Table Report - Invoices loaded:\", data?.length || 0);\n        return Array.isArray(data) ? data : [];\n      } catch (error) {\n        console.error('Table Report - Error fetching invoices:', error);\n        return [];\n      }\n    },\n    retry: 3,\n    retryDelay: 1000,\n  });\n\n  const { data: transactions = [], isLoading: transactionsLoading } = useQuery({\n    queryKey: [\"/api/transactions\"],\n    queryFn: async () => {\n      try {\n        const response = await fetch(\"/api/transactions\");\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        const data = await response.json();\n        console.log(\"Table Report - Transactions loaded:\", data?.length || 0);\n        return Array.isArray(data) ? data : [];\n      } catch (error) {\n        console.error('Table Report - Error fetching transactions:', error);\n        return [];\n      }\n    },\n    retry: 3,\n    retryDelay: 1000,\n  });\n\n  const { data: tables = [], isLoading: tablesLoading } = useQuery({\n    queryKey: [\"/api/tables\"],\n    queryFn: async () => {\n      try {\n        const response = await fetch(\"/api/tables\");\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        const data = await response.json();\n        console.log(\"Table Report - Tables loaded:\", data?.length || 0);\n        return Array.isArray(data) ? data : [];\n      } catch (error) {\n        console.error('Table Report - Error fetching tables:', error);\n        return [];\n      }\n    },\n    retry: 3,\n    retryDelay: 1000,\n  });\n\n  // Fetch order items and transaction items for detailed analysis\n  const { data: orderItems = [], isLoading: orderItemsLoading } = useQuery({\n    queryKey: [\"/api/order-items\"],\n    queryFn: async () => {\n      try {\n        const response = await fetch(\"/api/order-items\");\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        const data = await response.json();\n        console.log(\"Table Report - Order items loaded:\", data?.length || 0);\n        return Array.isArray(data) ? data : [];\n      } catch (error) {\n        console.error('Table Report - Error fetching order items:', error);\n        return [];\n      }\n    },\n    retry: 3,\n    retryDelay: 1000,\n  });\n\n  const { data: transactionItems = [], isLoading: transactionItemsLoading } = useQuery({\n    queryKey: [\"/api/transaction-items\"],\n    queryFn: async () => {\n      try {\n        const response = await fetch(\"/api/transaction-items\");\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        const data = await response.json();\n        console.log(\"Table Report - Transaction items loaded:\", data?.length || 0);\n        return Array.isArray(data) ? data : [];\n      } catch (error) {\n        console.error('Table Report - Error fetching transaction items:', error);\n        return [];\n      }\n    },\n    retry: 3,\n    retryDelay: 1000,\n  });\n\n  const getTableData = () => {\n    if (!orders || !tables) return null;\n\n    // Use EXACT same combined data filtering as other reports\n    const combinedData = [\n      ...(Array.isArray(orders) ? orders.map((order: any) => ({\n        ...order,\n        type: 'order',\n        date: order.orderedAt,\n        amount: parseFloat(order.total || 0)\n      })) : []),\n      ...(Array.isArray(invoices) ? invoices.map((invoice: any) => ({\n        ...invoice,\n        type: 'invoice', \n        date: invoice.createdAt,\n        amount: parseFloat(invoice.total || 0)\n      })) : []),\n      ...(Array.isArray(transactions) ? transactions.map((transaction: any) => ({\n        ...transaction,\n        type: 'transaction',\n        date: transaction.transactionDate,\n        amount: parseFloat(transaction.amount || 0)\n      })) : [])\n    ];\n\n    // Filter by date and status - EXACT same logic as other reports\n    const filteredCompletedItems = Array.isArray(combinedData) ? combinedData.filter((item: any) => {\n      try {\n        if (!item || !item.date) return false;\n\n        const itemDate = new Date(item.date);\n        if (isNaN(itemDate.getTime())) return false;\n\n        // Normalize both dates to compare only date part (same as other reports)\n        const itemDateOnly = new Date(itemDate);\n        itemDateOnly.setHours(0, 0, 0, 0);\n        \n        const start = new Date(startDate);\n        start.setHours(0, 0, 0, 0);\n        const end = new Date(endDate);\n        end.setHours(23, 59, 59, 999);\n        \n        const dateMatch = itemDateOnly >= start && itemDateOnly <= end;\n        \n        // Use EXACT same status logic as dashboard and sales report\n        const isCompleted = (item.type === 'invoice' && (item.invoiceStatus === 1 || item.displayStatus === 1)) ||\n                          (item.type === 'order' && (item.status === 'paid' || item.status === 'completed')) ||\n                          (item.type === 'transaction' && (item.status === 'completed' || item.status === 'paid'));\n\n        return dateMatch && isCompleted;\n      } catch (error) {\n        console.error('Table Report - Error filtering item:', item, error);\n        return false;\n      }\n    }) : [];\n\n    console.log(\"Table Report Debug (Combined Data):\", {\n      dateRange,\n      startDate,\n      endDate,\n      totalOrders: orders?.length || 0,\n      totalInvoices: invoices?.length || 0, \n      totalTransactions: transactions?.length || 0,\n      combinedDataLength: combinedData.length,\n      filteredCompletedItems: filteredCompletedItems.length,\n      sampleItem: filteredCompletedItems[0] || null\n    });\n\n    // Table performance analysis\n    const tableStats: {\n      [tableId: number]: {\n        table: TableType;\n        orderCount: number;\n        revenue: number;\n        customerCount: number;\n        averageOrderValue: number;\n        turnoverRate: number;\n        peakHours: { [hour: number]: number };\n        itemsSold: number;\n      };\n    } = {};\n\n    // Initialize stats for all tables\n    (tables as TableType[]).forEach((table: TableType) => {\n      tableStats[table.id] = {\n        table,\n        orderCount: 0,\n        revenue: 0,\n        customerCount: 0,\n        averageOrderValue: 0,\n        turnoverRate: 0,\n        peakHours: {},\n        itemsSold: 0,\n      };\n    });\n\n    // Calculate stats from all completed items\n    filteredCompletedItems.forEach((item: any) => {\n      // For orders - direct table mapping\n      if (item.type === 'order' && item.tableId && tableStats[item.tableId]) {\n        const stats = tableStats[item.tableId];\n        stats.orderCount += 1;\n        stats.revenue += item.amount;\n        stats.customerCount += item.customerCount || 1;\n\n        // Track peak hours\n        const hour = new Date(item.date).getHours();\n        stats.peakHours[hour] = (stats.peakHours[hour] || 0) + 1;\n\n        // Count items sold from order_items\n        const relatedOrderItems = orderItems.filter((oi: any) => oi.orderId === item.id);\n        const itemsCount = relatedOrderItems.reduce((sum, oi) => sum + (oi.quantity || 0), 0);\n        stats.itemsSold += itemsCount;\n      }\n      \n      // For transactions - if they have tableId, add to that table\n      if (item.type === 'transaction' && item.tableId && tableStats[item.tableId]) {\n        const stats = tableStats[item.tableId];\n        stats.revenue += item.amount;\n        stats.orderCount += 1; // Count as additional transaction\n\n        // Count items from transaction_items\n        const relatedTransactionItems = transactionItems.filter((ti: any) => ti.transactionId === item.id);\n        const itemsCount = relatedTransactionItems.reduce((sum, ti) => sum + (ti.quantity || 0), 0);\n        stats.itemsSold += itemsCount;\n      }\n      \n      // For invoices - if they have tableId, add to that table\n      if (item.type === 'invoice' && item.tableId && tableStats[item.tableId]) {\n        const stats = tableStats[item.tableId];\n        stats.revenue += item.amount;\n        stats.orderCount += 1;\n      }\n    });\n\n    // Calculate derived metrics\n    Object.values(tableStats).forEach((stats) => {\n      if (stats.orderCount > 0) {\n        stats.averageOrderValue = stats.revenue / stats.orderCount;\n        // Calculate turnover rate (orders per day over the period)\n        const days = Math.max(\n          1,\n          Math.ceil(\n            (new Date(endDate).getTime() - new Date(startDate).getTime()) /\n              (1000 * 60 * 60 * 24),\n          ),\n        );\n        stats.turnoverRate = stats.orderCount / days;\n      }\n    });\n\n    // Sort tables by different metrics\n    const tableList = Object.values(tableStats);\n    const topRevenueTables = [...tableList].sort(\n      (a, b) => b.revenue - a.revenue,\n    );\n    const topTurnoverTables = [...tableList].sort(\n      (a, b) => b.turnoverRate - a.turnoverRate,\n    );\n    const topUtilizationTables = [...tableList].sort(\n      (a, b) => b.orderCount - a.orderCount,\n    );\n\n    // Overall stats\n    const totalRevenue = tableList.reduce(\n      (sum, stats) => sum + stats.revenue,\n      0,\n    );\n    const totalOrders = tableList.reduce(\n      (sum, stats) => sum + stats.orderCount,\n      0,\n    );\n    const totalCustomers = tableList.reduce(\n      (sum, stats) => sum + stats.customerCount,\n      0,\n    );\n    const averageUtilization =\n      tableList.length > 0\n        ? tableList.reduce((sum, stats) => sum + stats.orderCount, 0) /\n          tableList.length\n        : 0;\n\n    return {\n      tableStats: tableList,\n      topRevenueTables,\n      topTurnoverTables,\n      topUtilizationTables,\n      totalRevenue,\n      totalOrders,\n      totalCustomers,\n      averageUtilization,\n    };\n  };\n\n  const handleDateRangeChange = (range: string) => {\n    setDateRange(range);\n    const today = new Date();\n\n    switch (range) {\n      case \"today\":\n        setStartDate(today.toISOString().split(\"T\")[0]);\n        setEndDate(today.toISOString().split(\"T\")[0]);\n        break;\n      case \"week\":\n        const currentDayOfWeek = today.getDay();\n        const daysToLastMonday =\n          currentDayOfWeek === 0 ? 13 : currentDayOfWeek + 6;\n        const lastWeekMonday = new Date(\n          today.getTime() - daysToLastMonday * 24 * 60 * 60 * 1000,\n        );\n        const lastWeekSunday = new Date(\n          lastWeekMonday.getTime() + 6 * 24 * 60 * 60 * 1000,\n        );\n\n        setStartDate(lastWeekMonday.toISOString().split(\"T\")[0]);\n        setEndDate(lastWeekSunday.toISOString().split(\"T\")[0]);\n        break;\n      case \"month\":\n        const currentDate = new Date();\n        const year = currentDate.getFullYear();\n        const month = currentDate.getMonth();\n\n        const lastMonthYear = month === 0 ? year - 1 : year;\n        const lastMonth = month === 0 ? 11 : month - 1;\n\n        const lastMonthStart = new Date(lastMonthYear, lastMonth, 1);\n        const lastMonthEnd = new Date(lastMonthYear, lastMonth + 1, 0);\n\n        const startDateStr = `${lastMonthStart.getFullYear()}-${(lastMonthStart.getMonth() + 1).toString().padStart(2, \"0\")}-${lastMonthStart.getDate().toString().padStart(2, \"0\")}`;\n        const endDateStr = `${lastMonthEnd.getFullYear()}-${(lastMonthEnd.getMonth() + 1).toString().padStart(2, \"0\")}-${lastMonthEnd.getDate().toString().padStart(2, \"0\")}`;\n\n        setStartDate(startDateStr);\n        setEndDate(endDateStr);\n        break;\n      case \"custom\":\n        const customCurrentDate = new Date().toISOString().split(\"T\")[0];\n        setStartDate(customCurrentDate);\n        setEndDate(customCurrentDate);\n        break;\n    }\n  };\n\n  const formatCurrency = (amount: number) => {\n    return `${amount.toLocaleString()} ₫`;\n  };\n\n  const getTableStatusBadge = (status: string) => {\n    const statusConfig = {\n      available: { label: t(\"common.available\"), variant: \"default\" as const },\n      occupied: {\n        label: t(\"common.occupied\"),\n        variant: \"destructive\" as const,\n      },\n      reserved: { label: t(\"common.reserved\"), variant: \"secondary\" as const },\n      maintenance: {\n        label: t(\"common.maintenance\"),\n        variant: \"outline\" as const,\n      },\n    };\n\n    return (\n      statusConfig[status as keyof typeof statusConfig] ||\n      statusConfig.available\n    );\n  };\n\n  const getPeakHour = (peakHours: { [hour: number]: number }) => {\n    const hours = Object.keys(peakHours);\n    if (hours.length === 0) return null;\n\n    const peak = hours.reduce((max, hour) =>\n      peakHours[parseInt(hour)] > peakHours[parseInt(max)] ? hour : max,\n    );\n    return parseInt(peak);\n  };\n\n  const tableData = getTableData();\n\n  const isLoading = ordersLoading || invoicesLoading || transactionsLoading || tablesLoading || orderItemsLoading || transactionItemsLoading;\n\n  if (isLoading) {\n    return (\n      <div className=\"flex justify-center py-8\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n        <div className=\"ml-3 text-gray-500\">{t(\"reports.loading\") || \"Đang tải dữ liệu...\"}</div>\n      </div>\n    );\n  }\n\n  if (!tableData) {\n    return (\n      <div className=\"flex justify-center py-8\">\n        <div className=\"text-gray-500\">Không có dữ liệu để hiển thị</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Filters */}\n      <Card>\n        <CardHeader>\n          <div className=\"flex justify-between items-center\">\n            <div>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Utensils className=\"w-5 h-5\" />\n                {t(\"reports.tableAnalysis\")}\n              </CardTitle>\n              <CardDescription>{t(\"reports.analyzeTableRevenueTrend\")}</CardDescription>\n            </div>\n            <div className=\"flex items-center gap-4\">\n              <Select value={dateRange} onValueChange={handleDateRangeChange}>\n                <SelectTrigger className=\"w-32\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"today\">{t(\"reports.toDay\")}</SelectItem>\n                  <SelectItem value=\"week\">{t(\"reports.lastWeek\")}</SelectItem>\n                  <SelectItem value=\"month\">\n                    {t(\"reports.lastMonth\")}\n                  </SelectItem>\n                  <SelectItem value=\"custom\">{t(\"reports.custom\")}</SelectItem>\n                </SelectContent>\n              </Select>\n\n              {dateRange === \"custom\" && (\n                <>\n                  <div className=\"flex items-center gap-2\">\n                    <Label>{t(\"reports.startDate\")}:</Label>\n                    <Input\n                      type=\"date\"\n                      value={startDate}\n                      onChange={(e) => setStartDate(e.target.value)}\n                      className=\"w-auto\"\n                    />\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <Label>{t(\"reports.endDate\")}:</Label>\n                    <Input\n                      type=\"date\"\n                      value={endDate}\n                      onChange={(e) => setEndDate(e.target.value)}\n                      className=\"w-auto\"\n                    />\n                  </div>\n                </>\n              )}\n            </div>\n          </div>\n        </CardHeader>\n      </Card>\n\n      {/* Overview Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-gray-600\">\n                  {t(\"reports.averageUtilization\")}\n                </p>\n                <p className=\"text-2xl font-bold\">\n                  {tableData.averageUtilization.toFixed(1)} {t(\"reports.times\")}\n                </p>\n                <p className=\"text-xs text-gray-500\">\n                  {t(\"reports.averageOrdersPerTable\")}\n                </p>\n              </div>\n              <TrendingUp className=\"w-8 h-8 text-blue-500\" />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-gray-600\">\n                  {t(\"reports.totalOrders\")}\n                </p>\n                <p className=\"text-2xl font-bold\">{tableData.totalOrders}</p>\n                <p className=\"text-xs text-gray-500\">\n                  {t(\"reports.allTables\")}\n                </p>\n              </div>\n              <Clock className=\"w-8 h-8 text-green-500\" />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-gray-600\">\n                  {t(\"reports.totalCustomers\")}\n                </p>\n                <p className=\"text-2xl font-bold\">{tableData.totalCustomers}</p>\n                <p className=\"text-xs text-gray-500\">\n                  {t(\"reports.cumulativeVisitors\")}\n                </p>\n              </div>\n              <Users className=\"w-8 h-8 text-purple-500\" />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-gray-600\">\n                  {t(\"reports.totalRevenue\")}\n                </p>\n                <p className=\"text-2xl font-bold text-green-600\">\n                  {formatCurrency(tableData.totalRevenue)}\n                </p>\n                <p className=\"text-xs text-gray-500\">\n                  {t(\"reports.totalByTable\")}\n                </p>\n              </div>\n              <Utensils className=\"w-8 h-8 text-green-500\" />\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Detailed Table Performance */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Utensils className=\"w-5 h-5\" />\n            {t(\"reports.tableAnalysis\")}\n          </CardTitle>\n          <CardDescription>\n            {t(\"reports.tableAnalysisDescription\")}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>{t(\"common.table\")}</TableHead>\n                <TableHead>{t(\"reports.currentStatus\")}</TableHead>\n                <TableHead>{t(\"reports.orders\")}</TableHead>\n                <TableHead>{t(\"reports.revenue\")}</TableHead>\n                <TableHead>{t(\"reports.customerCount\")}</TableHead>\n                <TableHead>{t(\"reports.averageOrderValue\")}</TableHead>\n                <TableHead>{t(\"reports.turnoverRate\")}</TableHead>\n                <TableHead>{t(\"reports.peakTime\")}</TableHead>\n                <TableHead>Số món bán</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {tableData.tableStats\n                .sort((a, b) => b.revenue - a.revenue)\n                .map((stats) => {\n                  const statusConfig = getTableStatusBadge(stats.table.status);\n                  const peakHour = getPeakHour(stats.peakHours);\n\n                  return (\n                    <TableRow key={stats.table.id}>\n                      <TableCell className=\"font-medium\">\n                        <div className=\"flex items-center gap-2\">\n                          <div\n                            className={`w-3 h-3 rounded-full ${\n                              stats.table.status === \"occupied\"\n                                ? \"bg-red-500\"\n                                : \"bg-green-500\"\n                            }`}\n                          ></div>\n                          {stats.table.tableNumber}\n                          <span className=\"text-xs text-gray-500\">\n                            ({stats.table.capacity} {t(\"common.people\")})\n                          </span>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant={statusConfig.variant}>\n                          {statusConfig.label}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        {stats.orderCount} {t(\"common.count\")}\n                      </TableCell>\n                      <TableCell className=\"font-semibold\">\n                        {formatCurrency(stats.revenue)}\n                      </TableCell>\n                      <TableCell>\n                        {stats.customerCount} {t(\"common.people\")}\n                      </TableCell>\n                      <TableCell>\n                        {stats.orderCount > 0\n                          ? formatCurrency(stats.averageOrderValue)\n                          : \"-\"}\n                      </TableCell>\n                      <TableCell>\n                        <Badge\n                          variant={\n                            stats.turnoverRate > 1 ? \"default\" : \"outline\"\n                          }\n                        >\n                          {stats.turnoverRate.toFixed(1)}{\" \"}\n                          {t(\"reports.timesPerDay\")}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        {peakHour !== null\n                          ? `${peakHour} ${t(\"reports.hour\")}`\n                          : \"-\"}\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant=\"secondary\">\n                          {stats.itemsSold} món\n                        </Badge>\n                      </TableCell>\n                    </TableRow>\n                  );\n                })}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        {/* Top Revenue Tables */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2 text-sm\">\n              <TrendingUp className=\"w-4 h-4\" />\n              {t(\"reports.topRevenueTables\")}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-2\">\n              {tableData.topRevenueTables\n                .slice(0, 5)\n                .map((stats: any, index: number) => (\n                  <div\n                    key={stats.table.id}\n                    className=\"flex justify-between items-center p-2 rounded-lg bg-gray-50\"\n                  >\n                    <div className=\"flex items-center gap-2\">\n                      <Badge\n                        variant={index < 3 ? \"default\" : \"outline\"}\n                        className=\"text-xs\"\n                      >\n                        {index + 1}\n                      </Badge>\n                      <span className=\"font-medium\">\n                        {stats.table.tableNumber}\n                      </span>\n                    </div>\n                    <span className=\"text-sm font-semibold text-green-600\">\n                      {formatCurrency(stats.revenue)}\n                    </span>\n                  </div>\n                ))}\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Top Turnover Tables */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2 text-sm\">\n              <Clock className=\"w-4 h-4\" />\n              {t(\"reports.topTurnoverTables\")}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-2\">\n              {tableData.topTurnoverTables\n                .slice(0, 5)\n                .map((stats: any, index: number) => (\n                  <div\n                    key={stats.table.id}\n                    className=\"flex justify-between items-center p-2 rounded-lg bg-gray-50\"\n                  >\n                    <div className=\"flex items-center gap-2\">\n                      <Badge\n                        variant={index < 3 ? \"default\" : \"outline\"}\n                        className=\"text-xs\"\n                      >\n                        {index + 1}\n                      </Badge>\n                      <span className=\"font-medium\">\n                        {stats.table.tableNumber}\n                      </span>\n                    </div>\n                    <span className=\"text-sm font-semibold\">\n                      {stats.turnoverRate.toFixed(1)} {t(\"reports.timesPerDay\")}\n                    </span>\n                  </div>\n                ))}\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Top Utilization Tables */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2 text-sm\">\n              <Users className=\"w-4 h-4\" />\n              {t(\"reports.topUtilizationTables\")}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-2\">\n              {tableData.topUtilizationTables\n                .slice(0, 5)\n                .map((stats: any, index: number) => (\n                  <div\n                    key={stats.table.id}\n                    className=\"flex justify-between items-center p-2 rounded-lg bg-gray-50\"\n                  >\n                    <div className=\"flex items-center gap-2\">\n                      <Badge\n                        variant={index < 3 ? \"default\" : \"outline\"}\n                        className=\"text-xs\"\n                      >\n                        {index + 1}\n                      </Badge>\n                      <span className=\"font-medium\">\n                        {stats.table.tableNumber}\n                      </span>\n                    </div>\n                    <span className=\"text-sm font-semibold\">\n                      {stats.orderCount} {t(\"common.count\")}\n                    </span>\n                  </div>\n                ))}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":28427},"client/src/components/suppliers/supplier-form-modal.tsx":{"content":"\nimport { useState, useEffect } from \"react\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport type { Supplier, InsertSupplier } from \"@shared/schema\";\n\ninterface SupplierFormModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  supplier?: Supplier | null;\n}\n\nexport function SupplierFormModal({ isOpen, onClose, supplier }: SupplierFormModalProps) {\n  const [formData, setFormData] = useState<Partial<InsertSupplier>>({\n    name: \"\",\n    code: \"\",\n    contactPerson: \"\",\n    phone: \"\",\n    email: \"\",\n    address: \"\",\n    taxId: \"\",\n    bankAccount: \"\",\n    paymentTerms: \"30일\",\n    status: \"active\",\n    notes: \"\",\n  });\n\n  const { toast } = useToast();\n  const { t } = useTranslation();\n  const queryClient = useQueryClient();\n\n  useEffect(() => {\n    if (supplier) {\n      setFormData({\n        name: supplier.name,\n        code: supplier.code,\n        contactPerson: supplier.contactPerson || \"\",\n        phone: supplier.phone || \"\",\n        email: supplier.email || \"\",\n        address: supplier.address || \"\",\n        taxId: supplier.taxId || \"\",\n        bankAccount: supplier.bankAccount || \"\",\n        paymentTerms: supplier.paymentTerms || \"30일\",\n        status: supplier.status,\n        notes: supplier.notes || \"\",\n      });\n    } else {\n      setFormData({\n        name: \"\",\n        code: \"\",\n        contactPerson: \"\",\n        phone: \"\",\n        email: \"\",\n        address: \"\",\n        taxId: \"\",\n        bankAccount: \"\",\n        paymentTerms: \"30일\",\n        status: \"active\",\n        notes: \"\",\n      });\n    }\n  }, [supplier, isOpen]);\n\n  const createMutation = useMutation({\n    mutationFn: async (data: InsertSupplier) => {\n      const response = await apiRequest('POST', '/api/suppliers', data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/suppliers'] });\n      toast({\n        title: t('suppliers.createSuccess'),\n        description: t('suppliers.createSuccessDesc'),\n      });\n      onClose();\n    },\n    onError: () => {\n      toast({\n        title: t('suppliers.createFailed'),\n        description: t('suppliers.createFailedDesc'),\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: Partial<InsertSupplier>) => {\n      const response = await apiRequest('PUT', `/api/suppliers/${supplier!.id}`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/suppliers'] });\n      toast({\n        title: t('suppliers.updateSuccess'),\n        description: t('suppliers.updateSuccessDesc'),\n      });\n      onClose();\n    },\n    onError: () => {\n      toast({\n        title: t('suppliers.updateFailed'),\n        description: t('suppliers.updateFailedDesc'),\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!formData.name || !formData.code) {\n      toast({\n        title: t('suppliers.validationError'),\n        description: t('suppliers.requiredFields'),\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (supplier) {\n      updateMutation.mutate(formData);\n    } else {\n      createMutation.mutate(formData as InsertSupplier);\n    }\n  };\n\n  const handleInputChange = (field: keyof InsertSupplier, value: string) => {\n    setFormData(prev => ({ ...prev, [field]: value }));\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle>\n            {supplier ? t('suppliers.editSupplier') : t('suppliers.addSupplier')}\n          </DialogTitle>\n          <DialogDescription>\n            {supplier ? t('suppliers.editDescription') : t('suppliers.addDescription')}\n          </DialogDescription>\n        </DialogHeader>\n\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <Label htmlFor=\"name\">{t('suppliers.name')} *</Label>\n              <Input\n                id=\"name\"\n                value={formData.name}\n                onChange={(e) => handleInputChange('name', e.target.value)}\n                placeholder={t('suppliers.namePlaceholder')}\n                required\n              />\n            </div>\n            <div>\n              <Label htmlFor=\"code\">{t('suppliers.code')} *</Label>\n              <Input\n                id=\"code\"\n                value={formData.code}\n                onChange={(e) => handleInputChange('code', e.target.value)}\n                placeholder={t('suppliers.codePlaceholder')}\n                required\n              />\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <Label htmlFor=\"contactPerson\">{t('suppliers.contactPerson')}</Label>\n              <Input\n                id=\"contactPerson\"\n                value={formData.contactPerson}\n                onChange={(e) => handleInputChange('contactPerson', e.target.value)}\n                placeholder={t('suppliers.contactPersonPlaceholder')}\n              />\n            </div>\n            <div>\n              <Label htmlFor=\"phone\">{t('suppliers.phone')}</Label>\n              <Input\n                id=\"phone\"\n                value={formData.phone}\n                onChange={(e) => handleInputChange('phone', e.target.value)}\n                placeholder={t('suppliers.phonePlaceholder')}\n              />\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <Label htmlFor=\"email\">{t('suppliers.email')}</Label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                value={formData.email}\n                onChange={(e) => handleInputChange('email', e.target.value)}\n                placeholder={t('suppliers.emailPlaceholder')}\n              />\n            </div>\n            <div>\n              <Label htmlFor=\"taxId\">{t('suppliers.taxId')}</Label>\n              <Input\n                id=\"taxId\"\n                value={formData.taxId}\n                onChange={(e) => handleInputChange('taxId', e.target.value)}\n                placeholder={t('suppliers.taxIdPlaceholder')}\n              />\n            </div>\n          </div>\n\n          <div>\n            <Label htmlFor=\"address\">{t('suppliers.address')}</Label>\n            <Input\n              id=\"address\"\n              value={formData.address}\n              onChange={(e) => handleInputChange('address', e.target.value)}\n              placeholder={t('suppliers.addressPlaceholder')}\n            />\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <Label htmlFor=\"bankAccount\">{t('suppliers.bankAccount')}</Label>\n              <Input\n                id=\"bankAccount\"\n                value={formData.bankAccount}\n                onChange={(e) => handleInputChange('bankAccount', e.target.value)}\n                placeholder={t('suppliers.bankAccountPlaceholder')}\n              />\n            </div>\n            <div>\n              <Label htmlFor=\"paymentTerms\">{t('suppliers.paymentTerms')}</Label>\n              <Select value={formData.paymentTerms} onValueChange={(value) => handleInputChange('paymentTerms', value)}>\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"현금\">{t('suppliers.cash')}</SelectItem>\n                  <SelectItem value=\"15일\">15일</SelectItem>\n                  <SelectItem value=\"30일\">30일</SelectItem>\n                  <SelectItem value=\"60일\">60일</SelectItem>\n                  <SelectItem value=\"90일\">90일</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n\n          <div>\n            <Label htmlFor=\"status\">{t('suppliers.status')}</Label>\n            <Select value={formData.status} onValueChange={(value) => handleInputChange('status', value)}>\n              <SelectTrigger>\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"active\">{t('suppliers.active')}</SelectItem>\n                <SelectItem value=\"inactive\">{t('suppliers.inactive')}</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div>\n            <Label htmlFor=\"notes\">{t('suppliers.notes')}</Label>\n            <Textarea\n              id=\"notes\"\n              value={formData.notes}\n              onChange={(e) => handleInputChange('notes', e.target.value)}\n              placeholder={t('suppliers.notesPlaceholder')}\n              rows={3}\n            />\n          </div>\n\n          <div className=\"flex justify-end gap-2\">\n            <Button type=\"button\" variant=\"outline\" onClick={onClose}>\n              {t('common.cancel')}\n            </Button>\n            <Button \n              type=\"submit\" \n              disabled={createMutation.isPending || updateMutation.isPending}\n            >\n              {supplier ? t('common.update') : t('common.create')}\n            </Button>\n          </div>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":9887},"client/src/components/tables/table-grid.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { OrderDialog } from \"@/components/orders/order-dialog\";\nimport {\n  Users,\n  Clock,\n  CheckCircle2,\n  Eye,\n  CreditCard,\n  QrCode,\n  Plus,\n  Printer,\n  X,\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport QRCodeLib from \"qrcode\";\nimport { createQRPosAsync, type CreateQRPosRequest } from \"@/lib/api\";\nimport { PaymentMethodModal } from \"@/components/pos/payment-method-modal\";\nimport { EInvoiceModal } from \"@/components/pos/einvoice-modal\";\nimport { ReceiptModal } from \"@/components/pos/receipt-modal\";\nimport type { Table, Order } from \"@shared/schema\";\n\ninterface TableGridProps {\n  onTableSelect?: (tableId: number | null) => void;\n  selectedTableId?: number | null;\n}\n\nexport function TableGrid({ onTableSelect, selectedTableId }: TableGridProps) {\n  const [orderDialogOpen, setOrderDialogOpen] = useState(false);\n  const [selectedTable, setSelectedTable] = useState<Table | null>(null);\n  const [orderDetailsOpen, setOrderDetailsOpen] = useState(false);\n  const [selectedOrder, setSelectedOrder] = useState<Order | null>(null);\n  const [paymentMethodsOpen, setPaymentMethodsOpen] = useState(false);\n  const [pointsPaymentOpen, setPointsPaymentOpen] = useState(false);\n  const [selectedCustomer, setSelectedCustomer] = useState<any>(null);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [pointsAmount, setPointsAmount] = useState(\"\");\n  const [showQRPayment, setShowQRPayment] = useState(false);\n  const [qrCodeUrl, setQrCodeUrl] = useState(\"\");\n  const [selectedPaymentMethod, setSelectedPaymentMethod] = useState(\"\");\n  const [editOrderOpen, setEditOrderOpen] = useState(false);\n  const [editingOrder, setEditingOrder] = useState<Order | null>(null);\n  const [editingTable, setEditingTable] = useState<Table | null>(null);\n  const [mixedPaymentOpen, setMixedPaymentOpen] = useState(false);\n  const [mixedPaymentData, setMixedPaymentData] = useState<any>(null);\n  const [qrLoading, setQrLoading] = useState(false);\n  const [showPaymentMethodModal, setShowPaymentMethodModal] = useState(false);\n  const [showEInvoiceModal, setShowEInvoiceModal] = useState(false);\n  const [orderForPayment, setOrderForPayment] = useState<any>(null);\n  const [showReceiptModal, setShowReceiptModal] = useState(false);\n  const [selectedReceipt, setSelectedReceipt] = useState<any>(null);\n  const [showReceiptPreview, setShowReceiptPreview] = useState(false);\n  const [previewReceipt, setPreviewReceipt] = useState<any>(null);\n  const { toast } = useToast();\n  const { t, currentLanguage } = useTranslation();\n  const queryClient = useQueryClient();\n\n  const { data: tables, isLoading, refetch: refetchTables } = useQuery({\n    queryKey: [\"/api/tables\"],\n    staleTime: 0, // Always fetch fresh data\n    gcTime: 0, // Remove from cache immediately after unmount\n    refetchOnWindowFocus: true,\n    refetchOnMount: true,\n  });\n\n  const { data: orders, refetch: refetchOrders } = useQuery({\n    queryKey: [\"/api/orders\"],\n    staleTime: 0, // Always fetch fresh data\n    gcTime: 0, // Remove from cache immediately after unmount\n    refetchOnWindowFocus: true,\n    refetchOnMount: true,\n  });\n\n  // Get all active orders' items for proper total calculation\n  const activeOrders = Array.isArray(orders) ? orders.filter(\n    (order: any) => ![\"paid\", \"cancelled\"].includes(order.status)\n  ) : [];\n\n  const { data: allOrderItems } = useQuery({\n    queryKey: [\"/api/all-order-items\", activeOrders.map(o => o.id).join(\",\")],\n    enabled: activeOrders.length > 0,\n    staleTime: 0,\n    queryFn: async () => {\n      const itemsMap = new Map();\n\n      for (const order of activeOrders) {\n        try {\n          const response = await apiRequest(\"GET\", `/api/order-items/${order.id}`);\n          const items = await response.json();\n          itemsMap.set(order.id, Array.isArray(items) ? items : []);\n        } catch (error) {\n          console.error(`Error fetching items for order ${order.id}:`, error);\n          itemsMap.set(order.id, []);\n        }\n      }\n\n      return itemsMap;\n    },\n  });\n\n  const {\n    data: orderItems,\n    isLoading: orderItemsLoading,\n    refetch: refetchOrderItems,\n  } = useQuery({\n    queryKey: [\"/api/order-items\", selectedOrder?.id],\n    enabled: !!selectedOrder?.id && orderDetailsOpen,\n    refetchOnWindowFocus: false,\n    staleTime: 0, // Always fetch fresh data\n    gcTime: 0, // Remove from cache immediately after unmount\n    queryFn: async () => {\n      const orderId = selectedOrder.id;\n      if (!orderId) {\n        console.log(\"No order ID available for fetching items\");\n        return [];\n      }\n\n      console.log(\"=== FETCHING ORDER ITEMS ===\");\n      console.log(\"Fetching order items for order ID:\", orderId);\n      console.log(\"API URL will be:\", `/api/order-items/${orderId}`);\n      console.log(\"Query enabled conditions:\", {\n        hasOrderId: !!selectedOrder?.id,\n        dialogOpen: orderDetailsOpen,\n        bothTrue: !!selectedOrder?.id && orderDetailsOpen,\n      });\n\n      const response = await apiRequest(\"GET\", `/api/order-items/${orderId}`);\n      const data = await response.json();\n\n      console.log(\"Raw order items response for order\", orderId, \":\", data);\n      console.log(\"Response type:\", typeof data, \"Length:\", data?.length);\n      console.log(\"Is array?\", Array.isArray(data));\n\n      // Log each item in detail\n      if (Array.isArray(data) && data.length > 0) {\n        console.log(\"Order items details:\");\n        data.forEach((item, index) => {\n          console.log(`  Item ${index + 1}:`, {\n            id: item.id,\n            orderId: item.orderId,\n            productId: item.productId,\n            productName: item.productName,\n            quantity: item.quantity,\n            unitPrice: item.unitPrice,\n            total: item.total,\n          });\n        });\n      } else {\n        console.log(\"No items found or response is not an array\");\n      }\n\n      // Ensure we return an array\n      const items = Array.isArray(data) ? data : [];\n      console.log(\"Final processed items count:\", items.length);\n      console.log(\"About to return items:\", items);\n      console.log(\"=== END FETCHING ORDER ITEMS ===\");\n\n      return items;\n    },\n  });\n\n  const { data: products } = useQuery({\n    queryKey: [\"/api/products\"],\n    staleTime: 0, // Always fetch fresh data\n    gcTime: 0, // Remove from cache immediately after unmount\n    refetchOnWindowFocus: true,\n    refetchOnMount: true,\n  });\n\n  const { data: storeSettings } = useQuery({\n    queryKey: [\"/api/store-settings\"],\n    staleTime: 0, // Always fetch fresh data\n    gcTime: 0, // Remove from cache immediately after unmount\n    refetchOnWindowFocus: true,\n    refetchOnMount: true,\n  });\n\n  const { data: customers } = useQuery({\n    queryKey: [\"/api/customers\"],\n    enabled: pointsPaymentOpen,\n    staleTime: 0, // Always fetch fresh data\n    gcTime: 0, // Remove from cache immediately after unmount\n    refetchOnWindowFocus: true,\n    refetchOnMount: true,\n  });\n\n  // Filter customers based on search term\n  const filteredCustomers = Array.isArray(customers)\n    ? customers.filter((customer: any) => {\n        if (!searchTerm) return true;\n\n        const searchLower = searchTerm.toLowerCase();\n        return (\n          customer.name?.toLowerCase().includes(searchLower) ||\n          customer.customerId?.toLowerCase().includes(searchLower) ||\n          customer.phone?.includes(searchTerm)\n        );\n      })\n    : [];\n\n  // Force refetch order items when dialog opens\n  useEffect(() => {\n    if (orderDetailsOpen && selectedOrder?.id) {\n      console.log(\n        \"Dialog opened, refetching order items for order:\",\n        selectedOrder.id,\n      );\n      refetchOrderItems();\n    }\n  }, [orderDetailsOpen, selectedOrder?.id, refetchOrderItems]);\n\n  const updateTableStatusMutation = useMutation({\n    mutationFn: ({ tableId, status }: { tableId: number; status: string }) =>\n      apiRequest(\"PUT\", `/api/tables/${tableId}/status`, { status }),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/tables\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/orders\"] }); // Invalidate orders as table status might affect them\n      toast({\n        title: t(\"tables.title\"),\n        description: t(\"common.success\"),\n      });\n    },\n    onError: () => {\n      toast({\n        title: t(\"common.error\"),\n        description: t(\"common.error\"),\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const completePaymentMutation = useMutation({\n    mutationFn: ({\n      orderId,\n      paymentMethod,\n    }: {\n      orderId: number;\n      paymentMethod: string;\n    }) =>\n      apiRequest(\"PUT\", `/api/orders/${orderId}/status`, {\n        status: \"paid\",\n        paymentMethod,\n      }),\n    onSuccess: async (data, variables) => {\n      console.log(\"🎯 Table completePaymentMutation.onSuccess called\");\n\n      // Invalidate queries first\n      queryClient.invalidateQueries({ queryKey: [\"/api/orders\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/tables\"] });\n      queryClient.invalidateQueries({\n        queryKey: [\"/api/order-items\", variables.orderId],\n      }); // Invalidate items for the paid order\n\n      toast({\n        title: \"Thanh toán thành công\",\n        description: \"Đơn hàng đã được thanh toán\",\n      });\n\n      // Fetch the completed order and its items for receipt\n      try {\n        const [completedOrder, orderItemsData] = await Promise.all([\n          queryClient.fetchQuery({\n            queryKey: [\"/api/orders\", variables.orderId],\n            queryFn: async () => {\n              const response = await apiRequest(\n                \"GET\",\n                `/api/orders/${variables.orderId}`,\n              );\n              return response.json();\n            },\n          }),\n          queryClient.fetchQuery({\n            queryKey: [\"/api/order-items\", variables.orderId],\n            queryFn: async () => {\n              const response = await apiRequest(\n                \"GET\",\n                `/api/order-items/${variables.orderId}`,\n              );\n              return response.json();\n            },\n          }),\n        ]);\n\n        if (completedOrder && orderItemsData) {\n          console.log(\"✅ Table payment completed - preparing receipt data\");\n\n          // Use same calculation logic as Order Details display to get exact values\n          let subtotal = 0;\n          let totalTax = 0;\n\n          const processedItems = Array.isArray(orderItemsData)\n            ? orderItemsData.map((item: any) => {\n                const basePrice = Number(item.unitPrice || 0);\n                const quantity = Number(item.quantity || 0);\n                const product = Array.isArray(products)\n                  ? products.find((p: any) => p.id === item.productId)\n                  : null;\n                const itemTaxRate = product?.taxRate\n                  ? parseFloat(product.taxRate)\n                  : 10;\n\n                // Calculate subtotal (base price without tax) - same as Order Details\n                subtotal += basePrice * quantity;\n\n                // Use same tax calculation logic as Order Details\n                if (\n                  product?.afterTaxPrice &&\n                  product.afterTaxPrice !== null &&\n                  product.afterTaxPrice !== \"\"\n                ) {\n                  const afterTaxPrice = parseFloat(product.afterTaxPrice);\n                  // Tax = afterTaxPrice - basePrice (per unit), then multiply by quantity\n                  const taxPerUnit = afterTaxPrice - basePrice;\n                  totalTax += taxPerUnit * quantity;\n                } else {\n                  // No afterTaxPrice means no tax\n                  totalTax += 0;\n                }\n\n                return {\n                  id: item.id,\n                  productId: item.productId,\n                  productName:\n                    item.productName || getProductName(item.productId),\n                  quantity: item.quantity,\n                  price: item.unitPrice,\n                  total: item.total,\n                  sku: item.productSku || `SP${item.productId}`,\n                  taxRate: itemTaxRate,\n                };\n              })\n            : [];\n\n          // Use EXACT same calculation logic as Order Details display to ensure consistency\n          let orderDetailsSubtotal = 0;\n          let orderDetailsTax = 0;\n\n          if (Array.isArray(orderItemsData) && Array.isArray(products)) {\n            orderItemsData.forEach((item: any) => {\n              const basePrice = Number(item.unitPrice || 0);\n              const quantity = Number(item.quantity || 0);\n              const product = products.find(\n                (p: any) => p.id === item.productId,\n              );\n\n              // Calculate subtotal exactly as Order Details\n              orderDetailsSubtotal += basePrice * quantity;\n\n              // Use EXACT same tax calculation logic as Order Details\n              if (\n                product?.afterTaxPrice &&\n                product.afterTaxPrice !== null &&\n                product.afterTaxPrice !== \"\"\n              ) {\n                const afterTaxPrice = parseFloat(product.afterTaxPrice);\n                // Tax = afterTaxPrice - basePrice (per unit), then multiply by quantity\n                const taxPerUnit = afterTaxPrice - basePrice;\n                orderDetailsTax += Math.floor(taxPerUnit * quantity);\n              } else {\n                // No afterTaxPrice means no tax\n                orderDetailsTax += 0;\n              }\n            });\n          }\n\n          // Use exact calculated values from Order Details display\n          const receiptData = {\n            ...completedOrder,\n            transactionId: `TXN-${Date.now()}`,\n            items: processedItems,\n            subtotal: orderDetailsSubtotal.toString(),\n            tax: orderDetailsTax.toString(),\n            total: (orderDetailsSubtotal + orderDetailsTax).toString(),\n            paymentMethod: variables.paymentMethod || \"cash\",\n            amountReceived: (orderDetailsSubtotal + orderDetailsTax).toString(),\n            change: \"0.00\",\n            cashierName: \"Table Service\",\n            createdAt: new Date().toISOString(),\n          };\n\n          console.log(\"📄 Table receipt data prepared:\", receiptData);\n\n          // Close all dialogs first\n          setOrderDetailsOpen(false);\n          setPaymentMethodsOpen(false);\n          setShowPaymentMethodModal(false);\n          setShowEInvoiceModal(false);\n          setOrderForPayment(null);\n\n          // Show receipt modal\n          setSelectedReceipt(receiptData);\n          setShowReceiptModal(true);\n        }\n      } catch (error) {\n        console.error(\"Error fetching order details for receipt:\", error);\n        toast({\n          title: \"Cảnh báo\",\n          description: \"Thanh toán thành công nhưng không thể hiển thị hóa đơn\",\n          variant: \"destructive\",\n        });\n      }\n    },\n    onError: () => {\n      console.log(\"❌ Table completePaymentMutation.onError called\");\n      toast({\n        title: \"Lỗi\",\n        description: \"Không thể hoàn tất thanh toán\",\n        variant: \"destructive\",\n      });\n      setOrderForPayment(null);\n    },\n  });\n\n  const pointsPaymentMutation = useMutation({\n    mutationFn: async ({\n      customerId,\n      points,\n      orderId,\n    }: {\n      customerId: number;\n      points: number;\n      orderId: number;\n    }) => {\n      // First redeem points\n      await apiRequest(\"POST\", \"/api/customers/redeem-points\", {\n        customerId,\n        points,\n      });\n\n      // Then mark order as paid\n      await apiRequest(\"PUT\", `/api/orders/${orderId}/status`, {\n        status: \"paid\",\n        paymentMethod: \"points\",\n        customerId,\n      });\n    },\n    onSuccess: (data, variables) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/orders\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/tables\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/customers\"] });\n      queryClient.invalidateQueries({\n        queryKey: [\"/api/order-items\", variables.orderId],\n      });\n      setOrderDetailsOpen(false);\n      setPointsPaymentOpen(false);\n      setSelectedCustomer(null);\n      setPointsAmount(\"\");\n      setSearchTerm(\"\");\n      toast({\n        title: \"Thanh toán thành công\",\n        description: \"Đơn hàng đã được thanh toán bằng điểm\",\n      });\n\n      // Fetch the completed order to get its details for receipt\n      queryClient\n        .fetchQuery({\n          queryKey: [\"/api/orders\", variables.orderId],\n          queryFn: async () => {\n            const response = await apiRequest(\n              \"GET\",\n              `/api/orders/${variables.orderId}`,\n            );\n            return response.json();\n          },\n        })\n        .then((completedOrder) => {\n          if (completedOrder) {\n            console.log(\"Completed order for receipt:\", completedOrder);\n            setSelectedReceipt(completedOrder); // Set the order for the receipt modal\n            setShowReceiptModal(true); // Show the receipt modal\n          }\n        });\n    },\n    onError: () => {\n      toast({\n        title: \"Lỗi\",\n        description: \"Không thể hoàn tất thanh toán bằng điểm\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Add the missing handlePointsPayment function\n  const handlePointsPayment = () => {\n    if (!selectedCustomer || !selectedOrder) {\n      toast({\n        title: \"Lỗi\",\n        description: \"Vui lòng chọn khách hàng và đơn hàng\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const customerPoints = selectedCustomer.points || 0;\n    const orderTotal = Number(selectedOrder.total || 0);\n    const pointsValue = customerPoints * 1000; // 1 point = 1000 VND\n\n    if (customerPoints === 0) {\n      toast({\n        title: \"Lỗi\",\n        description: \"Khách hàng không có điểm\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (pointsValue >= orderTotal) {\n      // Full points payment\n      const pointsToUse = Math.ceil(orderTotal / 1000);\n      pointsPaymentMutation.mutate({\n        customerId: selectedCustomer.id,\n        points: pointsToUse,\n        orderId: selectedOrder.id,\n      });\n    } else {\n      // Mixed payment - use all available points + other payment method\n      const remainingAmount = orderTotal - pointsValue;\n      setMixedPaymentData({\n        customerId: selectedCustomer.id,\n        pointsToUse: customerPoints,\n        orderId: selectedOrder.id,\n        remainingAmount,\n      });\n      setPointsPaymentOpen(false);\n      setMixedPaymentOpen(true);\n    }\n  };\n\n  const mixedPaymentMutation = useMutation({\n    mutationFn: async ({\n      customerId,\n      points,\n      orderId,\n      paymentMethod,\n    }: {\n      customerId: number;\n      points: number;\n      orderId: number;\n      paymentMethod: string;\n    }) => {\n      // First redeem all available points\n      await apiRequest(\"POST\", \"/api/customers/redeem-points\", {\n        customerId,\n        points,\n      });\n\n      // Then mark order as paid with mixed payment\n      await apiRequest(\"PUT\", `/api/orders/${orderId}/status`, {\n        status: \"paid\",\n        paymentMethod: `points + ${paymentMethod}`,\n        customerId,\n      });\n    },\n    onSuccess: (data, variables) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/orders\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/tables\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/customers\"] });\n      queryClient.invalidateQueries({\n        queryKey: [\"/api/order-items\", variables.orderId],\n      });\n      setOrderDetailsOpen(false);\n      setMixedPaymentOpen(false);\n      setMixedPaymentData(null);\n      setSelectedCustomer(null);\n      setPointsAmount(\"\");\n      setSearchTerm(\"\");\n      toast({\n        title: \"Thanh toán thành công\",\n        description:\n          \"Đơn hàng đã được thanh toán bằng điểm + tiền mặt/chuyển khoản\",\n      });\n\n      // Fetch the completed order to get its details for receipt\n      queryClient\n        .fetchQuery({\n          queryKey: [\"/api/orders\", variables.orderId],\n          queryFn: async () => {\n            const response = await apiRequest(\n              \"GET\",\n              `/api/orders/${variables.orderId}`,\n            );\n            return response.json();\n          },\n        })\n        .then((completedOrder) => {\n          if (completedOrder) {\n            console.log(\"Completed order for receipt:\", completedOrder);\n            setSelectedReceipt(completedOrder); // Set the order for the receipt modal\n            setShowReceiptModal(true); // Show the receipt modal\n          }\n        });\n    },\n    onError: () => {\n      toast({\n        title: \"Lỗi\",\n        description: \"Không thể hoàn tất thanh toán hỗn hợp\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteOrderMutation = useMutation({\n    mutationFn: async (orderId: number) => {\n      // First cancel the order\n      const response = await apiRequest(\n        \"PUT\",\n        `/api/orders/${orderId}/status`,\n        { status: \"cancelled\" },\n      );\n\n      // Find the order to get its table ID\n      const order = orders?.find((o: any) => o.id === orderId);\n      if (order?.tableId) {\n        // Check if there are any other active orders on this table\n        const otherActiveOrders = orders?.filter(\n          (o: any) =>\n            o.tableId === order.tableId &&\n            o.id !== orderId &&\n            ![\"paid\", \"cancelled\"].includes(o.status),\n        );\n\n        // If no other active orders, update table status to available\n        if (!otherActiveOrders || otherActiveOrders.length === 0) {\n          await apiRequest(\"PUT\", `/api/tables/${order.tableId}/status`, {\n            status: \"available\",\n          });\n        }\n      }\n\n      return response;\n    },\n    onSuccess: (data, orderId) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/orders\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/tables\"] });\n      queryClient.invalidateQueries({\n        queryKey: [\"/api/order-items\", orderId],\n      }); // Invalidate items for the deleted order\n      toast({\n        title: \"Xóa đơn hàng thành công\",\n        description: \"Đơn hàng đã được hủy và bàn đã được cập nhật\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Lỗi\",\n        description: \"Không thể xóa đơn hàng\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Add mutation to recalculate order totals\n  const recalculateOrderMutation = useMutation({\n    mutationFn: async (orderId: number) => {\n      console.log(\"🧮 Recalculating order total for order:\", orderId);\n\n      // Fetch current order items after deletion\n      const response = await apiRequest(\"GET\", `/api/order-items/${orderId}`);\n      const remainingItems = await response.json();\n\n      console.log(\n        \"📦 Remaining items after deletion:\",\n        remainingItems?.length || 0,\n      );\n\n      // Keep order even if no items remain - just recalculate totals to zero\n      if (!remainingItems || remainingItems.length === 0) {\n        console.log(\n          \"📝 No items left, setting order totals to zero but keeping order\",\n        );\n\n        // Set totals to zero instead of deleting the order\n        const updateResult = await apiRequest(\"PUT\", `/api/orders/${orderId}`, {\n          subtotal: \"0\",\n          tax: \"0\",\n          total: \"0\",\n        });\n\n        console.log(\"✅ Order totals reset to zero successfully\");\n        return updateResult;\n      }\n\n      // Calculate new totals based on remaining items\n      let newSubtotal = 0;\n      let newTax = 0;\n\n      if (Array.isArray(remainingItems) && remainingItems.length > 0) {\n        remainingItems.forEach((item: any) => {\n          const basePrice = Number(item.unitPrice || 0);\n          const quantity = Number(item.quantity || 0);\n\n          // Calculate subtotal\n          newSubtotal += basePrice * quantity;\n\n          // Only calculate tax if afterTaxPrice exists in database\n          const product = Array.isArray(products)\n            ? products.find((p: any) => p.id === item.productId)\n            : null;\n          if (\n            product?.afterTaxPrice &&\n            product.afterTaxPrice !== null &&\n            product.afterTaxPrice !== \"\"\n          ) {\n            const afterTaxPrice = parseFloat(product.afterTaxPrice);\n            const taxPerUnit = afterTaxPrice - basePrice;\n            newTax += taxPerUnit * quantity;\n          }\n          // No tax calculation if no afterTaxPrice in database\n        });\n      }\n\n      const newTotal = newSubtotal + newTax;\n\n      console.log(\"💰 Calculated new totals:\", {\n        subtotal: newSubtotal,\n        tax: newTax,\n        total: newTotal,\n        hasItems: remainingItems?.length > 0,\n      });\n\n      // Update order with new totals\n      const updateResult = await apiRequest(\"PUT\", `/api/orders/${orderId}`, {\n        subtotal: newSubtotal.toString(),\n        tax: newTax.toString(),\n        total: newTotal.toString(),\n      });\n\n      console.log(\"✅ Order totals updated successfully\");\n      return updateResult;\n    },\n    onSuccess: (data, orderId) => {\n      console.log(\n        \"🔄 Refreshing UI after order total recalculation for order:\",\n        orderId,\n      );\n\n      // Clear all cache and force fresh data fetch\n      queryClient.clear(); // Clear entire cache\n      queryClient.removeQueries(); // Remove all queries\n\n      // Force immediate fresh fetch without cache\n      Promise.all([\n        fetch(\"/api/orders\", { cache: \"no-store\" }).then((r) => r.json()),\n        fetch(\"/api/tables\", { cache: \"no-store\" }).then((r) => r.json()),\n        fetch(`/api/order-items/${orderId}`, { cache: \"no-store\" }).then((r) =>\n          r.json(),\n        ),\n      ])\n        .then(() => {\n          console.log(\n            \"✅ All queries refetched successfully, UI should now show updated totals\",\n          );\n\n          // Force component re-render by setting a timestamp\n          queryClient.setQueryData([\"/api/orders\"], (oldData: any) => {\n            if (!oldData || !Array.isArray(oldData)) return oldData;\n\n            return oldData.map((order: any) => {\n              if (order.id === orderId) {\n                console.log(\n                  `🔄 Forcing UI refresh for order ${orderId} with total: ${order.total}`,\n                );\n                return { ...order, _lastUpdated: Date.now() };\n              }\n              return order;\n            });\n          });\n        })\n        .catch((error) => {\n          console.error(\"❌ Error during query refetch:\", error);\n        });\n    },\n    onError: (error) => {\n      console.error(\"❌ Error recalculating order total:\", error);\n    },\n  });\n\n  const getTableStatus = (status: string) => {\n    const statusConfig = {\n      available: {\n        label: t(\"tables.available\"),\n        variant: \"default\" as const,\n        color: \"bg-green-500\",\n      },\n      occupied: {\n        label: t(\"tables.occupied\"),\n        variant: \"destructive\" as const,\n        color: \"bg-red-500\",\n      },\n      reserved: {\n        label: t(\"tables.reserved\"),\n        variant: \"secondary\" as const,\n        color: \"bg-yellow-500\",\n      },\n      maintenance: {\n        label: t(\"tables.outOfService\"),\n        variant: \"outline\" as const,\n        color: \"bg-gray-500\",\n      },\n    };\n\n    return (\n      statusConfig[status as keyof typeof statusConfig] ||\n      statusConfig.available\n    );\n  };\n\n  // Mutation to recalculate order total after item changes\n  const recalculateOrderTotalMutation = useMutation({\n    mutationFn: async (orderId: number) => {\n      // Fetch current order items\n      const response = await apiRequest(\"GET\", `/api/order-items/${orderId}`);\n      const items = await response.json();\n\n      // Calculate new total based on remaining items\n      let newSubtotal = 0;\n      let newTax = 0;\n\n      if (Array.isArray(items) && Array.isArray(products)) {\n        items.forEach((item: any) => {\n          const basePrice = Number(item.unitPrice || 0);\n          const quantity = Number(item.quantity || 0);\n          const product = products.find((p: any) => p.id === item.productId);\n\n          // Calculate subtotal\n          newSubtotal += basePrice * quantity;\n\n          // Calculate tax using same logic as order details\n          if (\n            product?.afterTaxPrice &&\n            product.afterTaxPrice !== null &&\n            product.afterTaxPrice !== \"\"\n          ) {\n            const afterTaxPrice = parseFloat(product.afterTaxPrice);\n            const taxPerUnit = afterTaxPrice - basePrice;\n            newTax += taxPerUnit * quantity;\n          }\n        });\n      }\n\n      const newTotal = newSubtotal + newTax;\n\n      // Update order with new totals\n      return apiRequest(\"PUT\", `/api/orders/${orderId}`, {\n        subtotal: newSubtotal.toString(),\n        tax: newTax.toString(),\n        total: newTotal.toString(),\n      });\n    },\n    onSuccess: (data, orderId) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/orders\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/tables\"] });\n      queryClient.invalidateQueries({\n        queryKey: [\"/api/order-items\", orderId],\n      });\n    },\n  });\n\n  const getActiveOrder = (tableId: number) => {\n    if (!orders || !Array.isArray(orders)) return null;\n\n    // Get all active orders for this table and sort by orderedAt descending to get the latest\n    const activeOrders = orders.filter(\n      (order: Order) =>\n        order.tableId === tableId &&\n        ![\"paid\", \"cancelled\"].includes(order.status),\n    );\n\n    console.log(\n      `Active orders for table ${tableId}:`,\n      activeOrders.map((o) => ({\n        id: o.id,\n        orderNumber: o.orderNumber,\n        orderedAt: o.orderedAt,\n        status: o.status,\n        total: o.total,\n      })),\n    );\n\n    if (activeOrders.length === 0) return null;\n\n    // Sort by orderedAt descending and return the most recent order\n    const latestOrder = activeOrders.sort(\n      (a: Order, b: Order) =>\n        new Date(b.orderedAt).getTime() - new Date(a.orderedAt).getTime(),\n    )[0];\n\n    console.log(`Latest order for table ${tableId}:`, {\n      id: latestOrder.id,\n      orderNumber: latestOrder.orderNumber,\n      orderedAt: latestOrder.orderedAt,\n      total: latestOrder.total,\n    });\n\n    return latestOrder;\n  };\n\n  // Helper function to get product name\n  const getProductName = (productId: number) => {\n    const product = Array.isArray(products)\n      ? products.find((p: any) => p.id === productId)\n      : null;\n    return product?.name || `Product #${productId}`;\n  };\n\n  // Helper function to get table info\n  const getTableInfo = (tableId: number) => {\n    const table = Array.isArray(tables)\n      ? tables.find((t: any) => t.id === tableId)\n      : null;\n    return table;\n  };\n\n  // Helper function to handle edit order\n  const handleEditOrder = (order: Order, table: Table) => {\n    setEditingOrder(order);\n    setEditingTable(table);\n    setEditOrderOpen(true);\n  };\n\n  // Helper function to handle delete order\n  const handleDeleteOrder = (order: Order) => {\n    if (window.confirm(\"Bạn có chắc chắn muốn xóa đơn hàng này?\")) {\n      deleteOrderMutation.mutate(order.id);\n    }\n  };\n\n  // Helper function to handle QR payment close\n  const handleQRPaymentClose = () => {\n    setShowQRPayment(false);\n    setQrCodeUrl(\"\");\n    setSelectedPaymentMethod(\"\");\n    setMixedPaymentOpen(false);\n  };\n\n  // Helper function to handle QR payment confirm\n  const handleQRPaymentConfirm = () => {\n    if (!selectedOrder) return;\n\n    if (mixedPaymentData) {\n      // Mixed payment completion\n      mixedPaymentMutation.mutate({\n        customerId: mixedPaymentData.customerId,\n        points: mixedPaymentData.pointsToUse,\n        orderId: mixedPaymentData.orderId,\n        paymentMethod: selectedPaymentMethod?.method?.name || \"transfer\",\n      });\n    } else {\n      // Regular payment completion\n      completePaymentMutation.mutate({\n        orderId: selectedOrder.id,\n        paymentMethod: selectedPaymentMethod?.key || \"qrCode\",\n      });\n    }\n\n    setShowQRPayment(false);\n    setQrCodeUrl(\"\");\n    setSelectedPaymentMethod(\"\");\n  };\n\n  const handleTableClick = (table: Table) => {\n    setSelectedTable(table);\n    onTableSelect?.(table.id);\n\n    if (table.status === \"available\") {\n      setOrderDialogOpen(true);\n    }\n  };\n\n  const handleStatusChange = (tableId: number, newStatus: string) => {\n    updateTableStatusMutation.mutate({ tableId, status: newStatus });\n  };\n\n  const handleViewOrderDetails = (order: Order) => {\n    console.log(\"=== VIEWING ORDER DETAILS ===\");\n    console.log(\"Selected order for details:\", order);\n    console.log(\n      \"Order ID:\",\n      order.id,\n      \"Table ID:\",\n      order.tableId,\n      \"Ordered at:\",\n      order.orderedAt,\n    );\n    console.log(\n      \"Order status:\",\n      order.status,\n      \"Order number:\",\n      order.orderNumber,\n    );\n    console.log(\"=== END ORDER DETAILS ===\");\n\n    // Set the selected order first\n    setSelectedOrder(order);\n\n    // Then open the dialog - this ensures selectedOrder is set when the query runs\n    setTimeout(() => {\n      setOrderDetailsOpen(true);\n    }, 0);\n  };\n\n  const handlePayment = async (paymentMethodKey: string) => {\n    if (!selectedOrder) return;\n\n    const method = getPaymentMethods().find(\n      (m) => m.nameKey === paymentMethodKey,\n    );\n    if (!method) return;\n\n    // If cash payment, proceed directly\n    if (paymentMethodKey === \"cash\") {\n      completePaymentMutation.mutate({\n        orderId: selectedOrder.id,\n        paymentMethod: paymentMethodKey,\n      });\n      return;\n    }\n\n    // For QR Code payment, use CreateQRPos API\n    if (paymentMethodKey === \"qrCode\") {\n      try {\n        setQrLoading(true);\n        const { createQRPosAsync, CreateQRPosRequest } = await import(\n          \"@/lib/api\"\n        );\n\n        const transactionUuid = `TXN-${Date.now()}`;\n        const depositAmt = Number(selectedOrder.total);\n\n        const qrRequest: CreateQRPosRequest = {\n          transactionUuid,\n          depositAmt: depositAmt,\n          posUniqueId: \"ER002\",\n          accntNo: \"0900993023\",\n          posfranchiseeName: \"DOOKI-HANOI\",\n          posCompanyName: \"HYOJUNG\",\n          posBillNo: `BILL-${Date.now()}`,\n        };\n\n        const bankCode = \"79616001\";\n        const clientID = \"91a3a3668724e631e1baf4f8526524f3\";\n\n        console.log(\"Calling CreateQRPos API with:\", {\n          qrRequest,\n          bankCode,\n          clientID,\n        });\n\n        const qrResponse = await createQRPosAsync(\n          qrRequest,\n          bankCode,\n          clientID,\n        );\n\n        console.log(\"CreateQRPos API response:\", qrResponse);\n\n        // Generate QR code from the received QR data\n        if (qrResponse.qrData) {\n          // Use qrData directly for QR code generation\n          let qrContent = qrResponse.qrData;\n          try {\n            // Try to decode if it's base64 encoded\n            qrContent = atob(qrResponse.qrData);\n          } catch (e) {\n            // If decode fails, use the raw qrData\n            console.log(\"Using raw qrData as it is not base64 encoded\");\n          }\n\n          const qrUrl = await QRCodeLib.toDataURL(qrContent, {\n            width: 256,\n            margin: 2,\n            color: {\n              dark: \"#000000\",\n              light: \"#FFFFFF\",\n            },\n          });\n          setQrCodeUrl(qrUrl);\n          setSelectedPaymentMethod({ key: paymentMethodKey, method });\n          setShowQRPayment(true);\n          setPaymentMethodsOpen(false);\n        } else {\n          console.error(\"No QR data received from API\");\n          // Fallback to mock QR code\n          const fallbackData = `Payment via QR\\nAmount: ${selectedOrder.total.toLocaleString(\"vi-VN\", { minimumFractionDigits: 2, maximumFractionDigits: 2 })} ₫\\nOrder: ${selectedOrder.orderNumber}\\nTime: ${new Date().toLocaleString(\"vi-VN\")}`;\n          const qrUrl = await QRCodeLib.toDataURL(fallbackData, {\n            width: 256,\n            margin: 2,\n            color: {\n              dark: \"#000000\",\n              light: \"#FFFFFF\",\n            },\n          });\n          setQrCodeUrl(qrUrl);\n          setSelectedPaymentMethod({ key: paymentMethodKey, method });\n          setShowQRPayment(true);\n          setPaymentMethodsOpen(false);\n        }\n      } catch (error) {\n        console.error(\"Error calling CreateQRPos API:\", error);\n        // Fallback to mock QR code on error\n        try {\n          const fallbackData = `Payment via QR\\nAmount: ${selectedOrder.total.toLocaleString(\"vi-VN\", { minimumFractionDigits: 2, maximumFractionDigits: 2 })} ₫\\nOrder: ${selectedOrder.orderNumber}\\nTime: ${new Date().toLocaleString(\"vi-VN\")}`;\n          const qrUrl = await QRCodeLib.toDataURL(fallbackData, {\n            width: 256,\n            margin: 2,\n            color: {\n              dark: \"#000000\",\n              light: \"#FFFFFF\",\n            },\n          });\n          setQrCodeUrl(qrUrl);\n          setSelectedPaymentMethod({ key: paymentMethodKey, method });\n          setShowQRPayment(true);\n          setPaymentMethodsOpen(false);\n        } catch (fallbackError) {\n          console.error(\"Error generating fallback QR code:\", fallbackError);\n          toast({\n            title: \"Lỗi\",\n            description: \"Không thể tạo mã QR\",\n            variant: \"destructive\",\n          });\n        }\n      } finally {\n        setQrLoading(false);\n      }\n      return;\n    }\n\n    // For other non-cash payments, show mock QR code\n    try {\n      const qrData = `${method.name} Payment\\nAmount: ${selectedOrder.total.toLocaleString(\"vi-VN\", { minimumFractionDigits: 2, maximumFractionDigits: 2 })} ₫\\nOrder: ${selectedOrder.orderNumber}\\nTime: ${new Date().toLocaleString(\"vi-VN\")}`;\n      const qrUrl = await QRCodeLib.toDataURL(qrData, {\n        width: 256,\n        margin: 2,\n        color: {\n          dark: \"#000000\",\n          light: \"#FFFFFF\",\n        },\n      });\n      setQrCodeUrl(qrUrl);\n      setSelectedPaymentMethod({ key: paymentMethodKey, method });\n      setShowQRPayment(true);\n      setPaymentMethodsOpen(false);\n    } catch (error) {\n      console.error(\"Error generating QR code:\", error);\n      toast({\n        title: \"Lỗi\",\n        description: \"Không thể tạo mã QR\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  // Define handlePaymentMethodSelect here\n  const handlePaymentMethodSelect = async (\n    method: string,\n    paymentData?: any,\n  ) => {\n    console.log(\"💳 Payment method selected:\", method, paymentData);\n\n    if (!orderForPayment) {\n      console.error(\"❌ No order found for payment\");\n      toast({\n        title: \"Lỗi\",\n        description: \"Không tìm thấy đơn hàng để thanh toán\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    try {\n      if (method === \"einvoice\") {\n        console.log(\"📧 Opening E-invoice modal for table payment\");\n        setShowPaymentMethodModal(false);\n        setShowEInvoiceModal(true);\n        return;\n      }\n\n      // Store payment method for receipt display\n      setSelectedPaymentMethod(method);\n\n      // Close payment method modal and show receipt preview\n      setShowPaymentMethodModal(false);\n\n      // Create receipt preview data\n      const receiptPreview = {\n        transactionId: `TXN-${Date.now()}`,\n        createdAt: new Date().toISOString(),\n        cashierName: \"Nhân viên\",\n        paymentMethod: method,\n        amountReceived: paymentData?.amountReceived?.toString(),\n        change: paymentData?.change?.toString(),\n        items: orderItems?.map((item: any) => ({\n          id: item.id,\n          productId: item.productId,\n          productName: item.productName,\n          quantity: item.quantity,\n          price: item.unitPrice,\n          total: item.total,\n        })) || [],\n        subtotal: (orderForPayment.exactSubtotal || parseFloat(orderForPayment.subtotal || \"0\")).toString(),\n        tax: (orderForPayment.exactTax || parseFloat(orderForPayment.tax || \"0\")).toString(),\n        total: (orderForPayment.exactTotal || parseFloat(orderForPayment.total || \"0\")).toString(),\n        exactTotal: orderForPayment.exactTotal || parseFloat(orderForPayment.total || \"0\"),\n        exactSubtotal: orderForPayment.exactSubtotal || parseFloat(orderForPayment.subtotal || \"0\"),\n        exactTax: orderForPayment.exactTax || parseFloat(orderForPayment.tax || \"0\"),\n      };\n\n      setSelectedReceipt(receiptPreview);\n      setShowReceiptModal(true);\n\n      console.log(\"📄 Showing receipt preview for table payment confirmation\");\n    } catch (error) {\n      console.error(\"❌ Error preparing receipt preview:\", error);\n      toast({\n        title: \"Lỗi\",\n        description: \"Không thể chuẩn bị hóa đơn\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  // Handle receipt confirmation and complete payment\n  const handleReceiptConfirm = async () => {\n    if (!orderForPayment) {\n      console.error(\"❌ No order for payment found\");\n      return;\n    }\n\n    try {\n      console.log(\"🔄 Completing payment for order:\", orderForPayment.id);\n\n      // Complete payment with the selected method\n      await completePaymentMutation.mutateAsync({\n        orderId: orderForPayment.id,\n        paymentMethod: selectedPaymentMethod,\n      });\n\n      console.log(\"✅ Table payment completed successfully\");\n\n      // Close receipt modal and clear state\n      setShowReceiptModal(false);\n      setOrderForPayment(null);\n      setSelectedPaymentMethod(\"\");\n      setSelectedReceipt(null);\n\n      toast({\n        title: \"Thành công\",\n        description: \"Thanh toán đã được hoàn thành\",\n      });\n    } catch (error) {\n      console.error(\"❌ Error completing payment from table:\", error);\n      toast({\n        title: \"Lỗi\",\n        description: \"Không thể hoàn thành thanh toán\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  // Handle E-invoice confirmation and complete payment\n  const handleEInvoiceConfirm = async (invoiceData: any) => {\n    if (!orderForPayment) {\n      console.error(\"❌ No order for payment found\");\n      toast({\n        title: \"Lỗi\",\n        description: \"Không tìm thấy đơn hàng để thanh toán\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    try {\n      console.log(\n        \"🔄 Starting payment completion for order:\",\n        orderForPayment.id,\n      );\n\n      // Complete payment after e-invoice is created\n      await completePaymentMutation.mutateAsync({\n        orderId: orderForPayment.id,\n        paymentMethod: \"einvoice\",\n      });\n\n      console.log(\"✅ Table payment completed successfully\");\n\n      // Close E-invoice modal first\n      setShowEInvoiceModal(false);\n      setOrderForPayment(null);\n\n      // Always show receipt modal after invoice processing\n      if (invoiceData.receipt) {\n        console.log(\"📄 Showing receipt modal after E-invoice processing\");\n        setSelectedReceipt(invoiceData.receipt);\n        setShowReceiptModal(true);\n      }\n    } catch (error) {\n      console.error(\"❌ Error completing payment from table:\", error);\n      toast({\n        title: \"Lỗi\",\n        description: \"Không thể hoàn thành thanh toán\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const getPaymentMethods = () => {\n    // Get payment methods from localStorage (saved from settings)\n    const savedPaymentMethods = localStorage.getItem(\"paymentMethods\");\n\n    // Default payment methods if none saved\n    const defaultPaymentMethods = [\n      {\n        id: 1,\n        name: \"Tiền mặt\",\n        nameKey: \"cash\",\n        type: \"cash\",\n        enabled: true,\n        icon: \"💵\",\n      },\n      {\n        id: 2,\n        name: \"Thẻ tín dụng\",\n        nameKey: \"creditCard\",\n        type: \"card\",\n        enabled: true,\n        icon: \"💳\",\n      },\n      {\n        id: 3,\n        name: \"Thẻ ghi nợ\",\n        nameKey: \"debitCard\",\n        type: \"debit\",\n        enabled: true,\n        icon: \"💳\",\n      },\n      {\n        id: 4,\n        name: \"MoMo\",\n        nameKey: \"momo\",\n        type: \"digital\",\n        enabled: true,\n        icon: \"📱\",\n      },\n      {\n        id: 5,\n        name: \"ZaloPay\",\n        nameKey: \"zalopay\",\n        type: \"digital\",\n        enabled: true,\n        icon: \"📱\",\n      },\n      {\n        id: 6,\n        name: \"VNPay\",\n        nameKey: \"vnpay\",\n        type: \"digital\",\n        enabled: true,\n        icon: \"💳\",\n      },\n      {\n        id: 7,\n        name: \"QR Code\",\n        nameKey: \"qrCode\",\n        type: \"qr\",\n        enabled: true,\n        icon: \"📱\",\n      },\n      {\n        id: 8,\n        name: \"ShopeePay\",\n        nameKey: \"shopeepay\",\n        type: \"digital\",\n        enabled: false,\n        icon: \"🛒\",\n      },\n      {\n        id: 9,\n        name: \"GrabPay\",\n        nameKey: \"grabpay\",\n        type: \"digital\",\n        enabled: false,\n        icon: \"🚗\",\n      },\n      {\n        id: 10,\n        name: \"Hóa đơn điện tử\",\n        nameKey: \"einvoice\",\n        type: \"invoice\",\n        enabled: true,\n        icon: \"📄\",\n      },\n    ];\n\n    const paymentMethods = savedPaymentMethods\n      ? JSON.parse(savedPaymentMethods)\n      : defaultPaymentMethods;\n\n    // Filter to only return enabled payment methods\n    return paymentMethods.filter((method) => method.enabled);\n  };\n\n  const getOrderStatusBadge = (status: string) => {\n    const statusConfig = {\n      pending: {\n        label: t(\"orders.status.pending\"),\n        variant: \"secondary\" as const,\n      },\n      confirmed: {\n        label: t(\"orders.status.confirmed\"),\n        variant: \"default\" as const,\n      },\n      preparing: {\n        label: t(\"orders.status.preparing\"),\n        variant: \"secondary\" as const,\n      },\n      ready: { label: t(\"orders.status.ready\"), variant: \"outline\" as const },\n      served: { label: t(\"orders.status.served\"), variant: \"outline\" as const },\n      delivering: {\n        label: t(\"orders.status.delivering\"),\n        variant: \"secondary\" as const,\n      },\n      completed: {\n        label: t(\"orders.status.completed\"),\n        variant: \"default\" as const,\n      },\n      paid: { label: t(\"orders.status.paid\"), variant: \"default\" as const },\n      cancelled: {\n        label: t(\"orders.status.cancelled\"),\n        variant: \"destructive\" as const,\n      },\n    };\n\n    return (\n      statusConfig[status as keyof typeof statusConfig] || statusConfig.pending\n    );\n  };\n\n  // Function to handle auto-print for orders\n  const handlePrintOrder = async (order: any) => {\n    console.log(\"🖨️ Starting auto-print for table order:\", order.id);\n\n    try {\n      const orderItems = await queryClient.fetchQuery({\n        queryKey: [`/api/order-items/${order.id}`],\n        queryFn: async () => {\n          const response = await apiRequest(\n            \"GET\",\n            `/api/order-items/${order.id}`,\n          );\n          return response.json();\n        },\n      });\n\n      // Create receipt data\n      const receiptData = {\n        transactionId: order.orderNumber || `ORD-${order.id}`,\n        items: order.items.map((item: any) => ({\n          // Assuming order.items is available and structured\n          id: item.id,\n          productId: item.productId,\n          productName: item.productName || getProductName(item.productId),\n          price: item.unitPrice,\n          quantity: item.quantity,\n          total: item.total,\n          sku: item.productSku || `SP${item.productId}`,\n          taxRate: (() => {\n            const product = Array.isArray(products)\n              ? products.find((p: any) => p.id === item.productId)\n              : null;\n            return product?.taxRate ? parseFloat(product.taxRate) : 10;\n          })(),\n        })),\n        subtotal: order.subtotal,\n        tax: order.tax,\n        total: order.total,\n        paymentMethod: order.paymentMethod || \"cash\",\n        amountReceived: order.total,\n        change: \"0.00\",\n        cashierName: order.employeeName || \"System User\",\n        createdAt: order.orderedAt || new Date().toISOString(),\n        customerName: order.customerName,\n        customerTaxCode: null,\n        invoiceNumber: null,\n        tableNumber: getTableInfo(order.tableId)?.tableNumber || \"N/A\",\n      };\n\n      // Call auto-print API for both employee and kitchen printers\n      const response = await fetch(\"/api/auto-print\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          receiptData,\n          printerType: \"both\", // Print to both employee and kitchen printers\n        }),\n      });\n\n      const result = await response.json();\n\n      if (result.success) {\n        console.log(\"✅ Auto-print successful:\", result.message);\n        toast({\n          title: \"In hóa đơn thành công\",\n          description: `${result.message}`,\n        });\n\n        // Show detailed results for each printer\n        const successfulPrints = result.results.filter(\n          (r) => r.status === \"success\",\n        );\n        const failedPrints = result.results.filter((r) => r.status === \"error\");\n\n        if (successfulPrints.length > 0) {\n          console.log(\n            `✅ Printed successfully on ${successfulPrints.length} printers:`,\n            successfulPrints.map((p) => p.printerName),\n          );\n        }\n\n        if (failedPrints.length > 0) {\n          toast({\n            title: \"Một số máy in gặp lỗi\",\n            description: failedPrints\n              .map((r) => `• ${r.printerName}: ${r.message}`)\n              .join(\"\\n\"),\n            variant: \"destructive\",\n          });\n        }\n      } else {\n        console.log(\"⚠️ Auto-print failed, falling back to receipt modal\");\n        // Fallback to showing receipt modal for manual print\n        setSelectedReceipt(receiptData);\n        setShowReceiptModal(true);\n\n        toast({\n          title: \"Không tìm thấy máy in\",\n          description:\n            \"Không tìm thấy máy in hoặc không có cấu hình máy in. Sử dụng chức năng in thủ công.\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      console.error(\"❌ Auto-print error:\", error);\n\n      toast({\n        title: \"Lỗi in tự động\",\n        description:\n          \"Có lỗi xảy ra khi in tự động. Sử dụng chức năng in thủ công.\",\n        variant: \"destructive\",\n      });\n\n      // Fallback to manual print - try to show receipt modal\n      try {\n        const orderItems = await queryClient.fetchQuery({\n          queryKey: [`/api/order-items/${order.id}`],\n          queryFn: async () => {\n            const response = await apiRequest(\n              \"GET\",\n              `/api/order-items/${order.id}`,\n            );\n            return response.json();\n          },\n        });\n\n        const receiptData = {\n          transactionId: order.orderNumber || `ORD-${order.id}`,\n          items: orderItems.map((item: any) => ({\n            id: item.id,\n            productId: item.productId,\n            productName: item.productName || getProductName(item.productId),\n            price: item.unitPrice,\n            quantity: item.quantity,\n            total: item.total,\n            sku: item.productSku || `SP${item.productId}`,\n            taxRate: (() => {\n              const product = Array.isArray(products)\n                ? products.find((p: any) => p.id === item.productId)\n                : null;\n              return product?.taxRate ? parseFloat(product.taxRate) : 10;\n            })(),\n          })),\n          subtotal: order.subtotal,\n          tax: order.tax,\n          total: order.total,\n          paymentMethod: order.paymentMethod || \"cash\",\n          amountReceived: order.total,\n          change: \"0.00\",\n          cashierName: order.employeeName || \"System User\",\n          createdAt: order.orderedAt || new Date().toISOString(),\n          customerName: order.customerName,\n          customerTaxCode: null,\n          invoiceNumber: null,\n          tableNumber: getTableInfo(order.tableId)?.tableNumber || \"N/A\",\n        };\n\n        setSelectedReceipt(receiptData);\n        setShowReceiptModal(true);\n      } catch (fallbackError) {\n        console.error(\"Error preparing fallback receipt:\", fallbackError);\n      }\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4\">\n        {Array.from({ length: 8 }).map((_, i) => (\n          <div key={i} className=\"animate-pulse\">\n            <div className=\"bg-gray-200 rounded-lg h-32\"></div>\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  return (\n    <>\n      <div className=\"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4\">\n        {Array.isArray(tables) &&\n          tables.map((table: Table) => {\n            const statusConfig = getTableStatus(table.status);\n            const activeOrder = getActiveOrder(table.id);\n            const isSelected = selectedTableId === table.id;\n\n            return (\n              <Card\n                key={table.id}\n                className={`cursor-pointer transition-all duration-200 hover:shadow-lg ${\n                  isSelected ? \"ring-2 ring-blue-500\" : \"\"\n                } ${table.status === \"occupied\" ? \"bg-red-50\" : \"bg-white\"}`}\n                onClick={() => handleTableClick(table)}\n              >\n                <CardContent className=\"p-4\">\n                  <div className=\"flex flex-col items-center text-center space-y-3\">\n                    {/* Table Number */}\n                    <div className=\"relative\">\n                      <div\n                        className={`w-12 h-12 rounded-full ${statusConfig.color} flex items-center justify-center text-white font-bold text-lg`}\n                      >\n                        {table.tableNumber}\n                      </div>\n                      {activeOrder && (\n                        <div className=\"absolute -top-1 -right-1 w-4 h-4 bg-orange-500 rounded-full animate-pulse\"></div>\n                      )}\n                    </div>\n\n                    {/* Table Info */}\n                    <div className=\"space-y-1\">\n                      <div className=\"flex items-center justify-center text-sm text-gray-600\">\n                        <Users className=\"w-3 h-3 mr-1\" />\n                        {activeOrder ? (\n                          <span>\n                            {activeOrder.customerCount || 1}/{table.capacity}{\" \"}\n                            {t(\"orders.people\")}\n                          </span>\n                        ) : (\n                          <span>\n                            {table.capacity} {t(\"orders.people\")}\n                          </span>\n                        )}\n                      </div>\n                      <Badge\n                        variant={\n                          table.status === \"occupied\" && activeOrder\n                            ? getOrderStatusBadge(activeOrder.status).variant\n                            : statusConfig.variant\n                        }\n                        className=\"text-xs\"\n                      >\n                        {table.status === \"occupied\" && activeOrder\n                          ? getOrderStatusBadge(activeOrder.status).label\n                          : statusConfig.label}\n                      </Badge>\n                    </div>\n\n                    {/* Order Info */}\n                    {activeOrder && (\n                      <div className=\"space-y-1 text-xs text-gray-600\">\n                        <div className=\"flex items-center justify-center\">\n                          <Clock className=\"w-3 h-3 mr-1\" />\n                          {new Date(activeOrder.orderedAt).toLocaleTimeString(\n                            currentLanguage === \"ko\"\n                              ? \"ko-KR\"\n                              : currentLanguage === \"en\"\n                                ? \"en-US\"\n                                : \"vi-VN\",\n                            {\n                              hour: \"2-digit\",\n                              minute: \"2-digit\",\n                            },\n                          )}\n                        </div>\n                        <div\n                          className={`font-medium ${Number(activeOrder.total) <= 0 ? \"text-gray-400\" : \"text-gray-900\"}`}\n                        >\n                          {(() => {\n                            // Get order items for this specific order\n                            const currentOrderItems = allOrderItems?.get(activeOrder.id) || [];\n\n                            // If we don't have order items loaded or it's empty, use the stored total\n                            if (!currentOrderItems || currentOrderItems.length === 0) {\n                              const rawTotal = activeOrder.total;\n                              const orderTotal = Number(rawTotal || 0);\n\n                              console.log(\n                                `💰 Table ${table.tableNumber} - Order ${activeOrder.id} using stored total:`,\n                                {\n                                  rawTotal,\n                                  orderTotal,\n                                  hasItems: false,\n                                }\n                              );\n\n                              if (orderTotal <= 0) {\n                                return \"0\";\n                              }\n\n                              return Math.floor(orderTotal).toLocaleString(\"vi-VN\");\n                            }\n\n                            // Recalculate using same logic as Order Details and Shopping Cart\n                            let subtotal = 0;\n                            let totalTax = 0;\n\n                            currentOrderItems.forEach((item: any) => {\n                              const basePrice = Number(item.unitPrice || 0);\n                              const quantity = Number(item.quantity || 0);\n                              const product = Array.isArray(products)\n                                ? products.find((p: any) => p.id === item.productId)\n                                : null;\n\n                              // Calculate subtotal (base price without tax)\n                              subtotal += basePrice * quantity;\n\n                              // Only calculate tax if afterTaxPrice exists in database\n                              if (\n                                product?.afterTaxPrice &&\n                                product.afterTaxPrice !== null &&\n                                product.afterTaxPrice !== \"\"\n                              ) {\n                                const afterTaxPrice = parseFloat(product.afterTaxPrice);\n                                const taxPerUnit = afterTaxPrice - basePrice;\n                                totalTax += Math.floor(taxPerUnit * quantity);\n                              }\n                              // No tax calculation if no afterTaxPrice in database\n                            });\n\n                            const grandTotal = subtotal + totalTax;\n\n                            console.log(\n                              `💰 Table ${table.tableNumber} - Order ${activeOrder.id} recalculated total:`,\n                              {\n                                subtotal,\n                                totalTax,\n                                grandTotal,\n                                itemsCount: currentOrderItems.length,\n                                storedTotal: Number(activeOrder.total || 0),\n                              }\n                            );\n\n                            if (grandTotal <= 0) {\n                              return \"0\";\n                            }\n\n                            return Math.floor(grandTotal).toLocaleString(\"vi-VN\");\n                          })()}{\" \"}\n                          ₫\n                        </div>\n                      </div>\n                    )}\n\n                    {/* Quick Actions */}\n                    {table.status === \"occupied\" && (\n                      <div className=\"space-y-1 w-full\">\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          className=\"w-full text-xs\"\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            if (activeOrder) {\n                              handleViewOrderDetails(activeOrder);\n                            }\n                          }}\n                        >\n                          <Eye className=\"w-3 h-3 mr-1\" />\n                          {t(\"orders.viewDetails\")}\n                        </Button>\n\n                        <Button\n                          size=\"sm\"\n                          variant=\"default\"\n                          className=\"w-full text-xs bg-blue-600 hover:bg-blue-700\"\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            if (activeOrder) {\n                              handleEditOrder(activeOrder, table);\n                            }\n                          }}\n                        >\n                          <Plus className=\"w-3 h-3 mr-1\" />\n                          {t(\"orders.addMore\")}\n                        </Button>\n\n                        <Button\n                          size=\"sm\"\n                          variant=\"destructive\"\n                          className=\"w-full text-xs\"\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            if (activeOrder) {\n                              handleDeleteOrder(activeOrder);\n                            }\n                          }}\n                        >\n                          <X className=\"w-3 h-3 mr-1\" />\n                          {t(\"tables.deleteOrder\")}\n                        </Button>\n                      </div>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n            );\n          })}\n      </div>\n\n      {/* Order Dialog */}\n      <OrderDialog\n        open={orderDialogOpen}\n        onOpenChange={setOrderDialogOpen}\n        table={selectedTable}\n      />\n\n      {/* Order Details Dialog */}\n      <Dialog open={orderDetailsOpen} onOpenChange={setOrderDetailsOpen}>\n        <DialogContent className=\"max-w-2xl max-h-[80vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>{t(\"orders.orderDetails\")}</DialogTitle>\n            <DialogDescription>\n              {selectedOrder &&\n                `${t(\"orders.orderNumber\")}: ${selectedOrder.orderNumber}`}\n            </DialogDescription>\n          </DialogHeader>\n\n          {selectedOrder && (\n            <div className=\"space-y-4\">\n              {/* Order Info */}\n              <div className=\"grid grid-cols-2 gap-4 p-4 bg-gray-50 rounded-lg\">\n                <div>\n                  <p className=\"text-sm text-gray-600\">\n                    {t(\"orders.table\")} {t(\"orders.orderNumber\").toLowerCase()}:\n                  </p>\n                  <p className=\"font-medium\">T{selectedTable?.tableNumber}</p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-gray-600\">\n                    {t(\"orders.customerCount\")}:\n                  </p>\n                  <p className=\"font-medium\">\n                    {selectedOrder.customerCount} {t(\"orders.people\")}\n                  </p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-gray-600\">\n                    {t(\"orders.orderTime\")}:\n                  </p>\n                  <p className=\"font-medium\">\n                    {new Date(selectedOrder.orderedAt).toLocaleTimeString(\n                      currentLanguage === \"ko\"\n                        ? \"ko-KR\"\n                        : currentLanguage === \"en\"\n                          ? \"en-US\"\n                          : \"vi-VN\",\n                      {\n                        hour: \"2-digit\",\n                        minute: \"2-digit\",\n                      },\n                    )}\n                  </p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-gray-600\">\n                    {t(\"orders.orderStatus\")}:\n                  </p>\n                  <Badge\n                    variant={\n                      selectedOrder.status === \"paid\" ? \"default\" : \"secondary\"\n                    }\n                  >\n                    {selectedOrder.status === \"paid\"\n                      ? t(\"orders.status.paid\")\n                      : t(\"orders.status.pending\")}\n                  </Badge>\n                </div>\n              </div>\n\n              {/* Order Items */}\n              <div>\n                <h4 className=\"font-medium mb-3\">{t(\"orders.orderItems\")}:</h4>\n                <div className=\"space-y-2\">\n                  {orderItemsLoading ? (\n                    <p className=\"text-gray-500 text-center py-4\">\n                      {t(\"common.loading\")}\n                    </p>\n                  ) : (\n                    <>\n                      {(() => {\n                        // Process orderItems data consistently\n                        let itemsToRender = [];\n\n                        if (Array.isArray(orderItems)) {\n                          itemsToRender = orderItems;\n                        } else if (\n                          orderItems &&\n                          (orderItems as any).data &&\n                          Array.isArray((orderItems as any).data)\n                        ) {\n                          itemsToRender = (orderItems as any).data;\n                        } else if (\n                          orderItems &&\n                          (orderItems as any).items &&\n                          Array.isArray((orderItems as any).items)\n                        ) {\n                          itemsToRender = (orderItems as any).items;\n                        } else if (\n                          orderItems &&\n                          typeof orderItems === \"object\"\n                        ) {\n                          try {\n                            itemsToRender = Object.values(orderItems).filter(\n                              (item) => item && typeof item === \"object\",\n                            );\n                          } catch (e) {\n                            itemsToRender = [];\n                          }\n                        }\n\n                        if (itemsToRender && itemsToRender.length > 0) {\n                          return (\n                            <div className=\"space-y-2\">\n                              <p className=\"text-sm font-medium text-green-600 mb-3\">\n                                ✅ Hiển thị {itemsToRender.length} món trong đơn\n                                hàng {selectedOrder?.orderNumber}\n                              </p>\n                              {itemsToRender.map((item: any, index: number) => (\n                                <div\n                                  key={`item-${item.id || index}`}\n                                  className=\"flex justify-between items-center p-3 bg-white border rounded-lg shadow-sm\"\n                                >\n                                  <div className=\"flex-1\">\n                                    <p className=\"font-medium text-gray-900\">\n                                      {item.productName ||\n                                        getProductName(item.productId) ||\n                                        `Sản phẩm #${item.productId}`}\n                                    </p>\n                                    <p className=\"text-sm text-gray-600\">\n                                      Số lượng:{\" \"}\n                                      <span className=\"font-medium\">\n                                        {item.quantity}\n                                      </span>\n                                    </p>\n                                    {item.notes && (\n                                      <p className=\"text-xs text-blue-600 italic mt-1\">\n                                        Ghi chú: {item.notes}\n                                      </p>\n                                    )}\n                                  </div>\n                                  <div className=\"text-right ml-4\">\n                                    <p className=\"font-bold text-lg text-green-600\">\n                                      {Math.floor(\n                                        Number(item.total || 0),\n                                      ).toLocaleString(\"vi-VN\")}{\" \"}\n                                      ₫\n                                    </p>\n                                    <p className=\"text-sm text-gray-500\">\n                                      {Math.floor(\n                                        Number(item.unitPrice || 0),\n                                      ).toLocaleString(\"vi-VN\")}{\" \"}\n                                      ₫/món\n                                    </p>\n                                  </div>\n                                </div>\n                              ))}\n                            </div>\n                          );\n                        } else {\n                          return (\n                            <div className=\"text-center py-6 bg-gray-50 rounded-lg border\">\n                              <p className=\"text-gray-600\">\n                                Không có món nào trong đơn hàng{\" \"}\n                                {selectedOrder?.orderNumber}\n                              </p>\n                              {orderItemsLoading && (\n                                <p className=\"text-sm text-gray-500 mt-2\">\n                                  Đang tải...\n                                </p>\n                              )}\n                            </div>\n                          );\n                        }\n                      })()}\n                    </>\n                  )}\n                </div>\n              </div>\n\n              <Separator />\n\n              {/* Tax and Total Summary */}\n              <div className=\"space-y-2\">\n                {(() => {\n                  // Use same tax calculation logic as shopping cart\n                  let subtotal = 0;\n                  let totalTax = 0;\n\n                  if (\n                    Array.isArray(orderItems) &&\n                    orderItems.length > 0 &&\n                    Array.isArray(products)\n                  ) {\n                    orderItems.forEach((item: any) => {\n                      const basePrice = Number(item.unitPrice || 0);\n                      const quantity = Number(item.quantity || 0);\n                      const product = products.find(\n                        (p: any) => p.id === item.productId,\n                      );\n                      const itemTaxRate = product?.taxRate\n                        ? parseFloat(product.taxRate)\n                        : 0;\n\n                      // Calculate subtotal (base price without tax)\n                      subtotal += basePrice * quantity;\n\n                      // Only calculate tax if afterTaxPrice exists in database\n                      if (\n                        product?.afterTaxPrice &&\n                        product.afterTaxPrice !== null &&\n                        product.afterTaxPrice !== \"\"\n                      ) {\n                        const afterTaxPrice = parseFloat(product.afterTaxPrice);\n                        const taxPerUnit = afterTaxPrice - basePrice;\n                        totalTax += taxPerUnit * quantity;\n                      }\n                      // No tax calculation if no afterTaxPrice in database\n                    });\n                  }\n\n                  const grandTotal = subtotal + totalTax;\n\n                  return (\n                    <>\n                      <div className=\"flex justify-between text-sm\">\n                        <span className=\"text-gray-600\">\n                          {t(\"pos.subtotal\")}:\n                        </span>\n                        <span className=\"font-medium\">\n                          {Math.floor(subtotal).toLocaleString(\"vi-VN\")} ₫\n                        </span>\n                      </div>\n                      <div className=\"flex justify-between text-sm\">\n                        <span className=\"text-gray-600\">Thuế:</span>\n                        <span className=\"font-medium\">\n                          {Math.floor(totalTax).toLocaleString(\"vi-VN\")} ₫\n                        </span>\n                      </div>\n                      <div className=\"flex justify-between text-lg font-bold border-t pt-2\">\n                        <span>{t(\"orders.totalAmount\")}:</span>\n                        <span className=\"text-green-600\">\n                          {Math.floor(grandTotal).toLocaleString(\"vi-VN\")} ₫\n                        </span>\n                      </div>\n                    </>\n                  );\n                })()}\n              </div>\n\n              {/* Payment Buttons */}\n              {selectedOrder.status !== \"paid\" && (\n                <div className=\"pt-4 space-y-3\">\n                  <Button\n                    onClick={() => {\n                      console.log(\n                        \"🎯 Table: Starting payment flow - using exact Order Details values\",\n                      );\n\n                      if (\n                        !selectedOrder ||\n                        !orderItems ||\n                        !Array.isArray(orderItems)\n                      ) {\n                        console.error(\"❌ Missing order data for preview\");\n                        toast({\n                          title: \"Lỗi\",\n                          description:\n                            \"Không thể tạo xem trước hóa đơn. Vui lòng thử lại.\",\n                          variant: \"destructive\",\n                        });\n                        return;\n                      }\n\n                      // Use EXACT SAME calculation logic as displayed in Order Details\n                      let orderDetailsSubtotal = 0;\n                      let orderDetailsTax = 0;\n\n                      const processedItems = orderItems.map((item: any) => {\n                        const basePrice = Number(item.unitPrice || 0);\n                        const quantity = Number(item.quantity || 0);\n                        const product = Array.isArray(products)\n                          ? products.find((p: any) => p.id === item.productId)\n                          : null;\n\n                        // Calculate subtotal exactly as Order Details display\n                        orderDetailsSubtotal += basePrice * quantity;\n\n                        // Use EXACT same tax calculation logic as Order Details display\n                        if (\n                          product?.afterTaxPrice &&\n                          product.afterTaxPrice !== null &&\n                          product.afterTaxPrice !== \"\"\n                        ) {\n                          const afterTaxPrice = parseFloat(\n                            product.afterTaxPrice,\n                          );\n                          const taxPerUnit = afterTaxPrice - basePrice;\n                          orderDetailsTax += taxPerUnit * quantity;\n                        }\n\n                        return {\n                          id: item.id,\n                          productId: item.productId,\n                          productName:\n                            item.productName || getProductName(item.productId),\n                          quantity: item.quantity,\n                          price: item.unitPrice,\n                          total: item.total,\n                          sku: item.productSku || `SP${item.productId}`,\n                          taxRate: product?.taxRate\n                            ? parseFloat(product.taxRate)\n                            : 10,\n                        };\n                      });\n\n                      // Create preview receipt data using EXACT values from Order Details\n                      const previewData = {\n                        ...selectedOrder,\n                        transactionId: `PREVIEW-${Date.now()}`,\n                        createdAt: new Date().toISOString(),\n                        cashierName: \"Table Service\",\n                        paymentMethod: \"preview\", // Placeholder method\n                        items: processedItems,\n                        subtotal: orderDetailsSubtotal.toString(),\n                        tax: orderDetailsTax.toString(),\n                        total: (\n                          orderDetailsSubtotal + orderDetailsTax\n                        ).toString(),\n                        exactTotal: orderDetailsSubtotal + orderDetailsTax,\n                        exactSubtotal: orderDetailsSubtotal,\n                        exactTax: orderDetailsTax,\n                        orderItems: orderItems, // Keep original order items for payment flow\n                      };\n\n                      console.log(\n                        \"📄 Table: Showing receipt preview with exact Order Details values\",\n                      );\n                      console.log(\"💰 Exact values passed:\", {\n                        subtotal: orderDetailsSubtotal,\n                        tax: orderDetailsTax,\n                        total: orderDetailsSubtotal + orderDetailsTax,\n                      });\n                      setPreviewReceipt(previewData);\n                      setOrderDetailsOpen(false);\n                      setShowReceiptPreview(true);\n                    }}\n                    className=\"w-full bg-green-600 hover:bg-green-700\"\n                    size=\"lg\"\n                  >\n                    <CreditCard className=\"w-4 h-4 mr-2\" />\n                    {t(\"orders.payment\")}\n                  </Button>\n                  <Button\n                    onClick={() => setPointsPaymentOpen(true)}\n                    className=\"w-full bg-blue-600 hover:bg-blue-700 text-white border-blue-600 hover:border-blue-700\"\n                    size=\"lg\"\n                  >\n                    <Users className=\"w-4 h-4 mr-2\" />\n                    {t(\"orders.pointsPaymentTitle\")}\n                  </Button>\n                  <Button\n                    onClick={async () => {\n                      console.log(\n                        \"🖨️ Print bill button clicked for order:\",\n                        selectedOrder?.orderNumber,\n                      );\n\n                      if (\n                        !selectedOrder ||\n                        !orderItems ||\n                        !Array.isArray(orderItems)\n                      ) {\n                        console.error(\"❌ Missing order data for print bill\");\n                        toast({\n                          title: \"Lỗi\",\n                          description:\n                            \"Không thể tạo hóa đơn. Vui lòng thử lại.\",\n                          variant: \"destructive\",\n                        });\n                        return;\n                      }\n\n                      try {\n                        // Use exact same calculation logic as Order Details display\n                        let subtotal = 0;\n                        let totalTax = 0;\n\n                        if (\n                          Array.isArray(orderItems) &&\n                          Array.isArray(products)\n                        ) {\n                          orderItems.forEach((item: any) => {\n                            const basePrice = Number(item.unitPrice || 0);\n                            const quantity = Number(item.quantity || 0);\n                            const product = products.find(\n                              (p: any) => p.id === item.productId,\n                            );\n\n                            // Calculate subtotal exactly as Order Details\n                            subtotal += basePrice * quantity;\n\n                            // Use EXACT same tax calculation logic as Order Details\n                            if (\n                              product?.afterTaxPrice &&\n                              product.afterTaxPrice !== null &&\n                              product.afterTaxPrice !== \"\"\n                            ) {\n                              const afterTaxPrice = parseFloat(\n                                product.afterTaxPrice,\n                              );\n                              const taxPerUnit = afterTaxPrice - basePrice;\n                              totalTax += taxPerUnit * quantity;\n                            }\n                          });\n                        }\n\n                        const grandTotal = subtotal + totalTax;\n\n                        // Create receipt data using EXACT same values as Order Details display\n                        const processedItems = orderItems.map((item: any) => ({\n                          id: item.id,\n                          productId: item.productId,\n                          productName:\n                            item.productName || getProductName(item.productId),\n                          price: item.unitPrice,\n                          quantity: item.quantity,\n                          total: item.total,\n                          sku: item.productSku || `SP${item.productId}`,\n                          taxRate: (() => {\n                            const product = Array.isArray(products)\n                              ? products.find(\n                                  (p: any) => p.id === item.productId,\n                                )\n                              : null;\n                            return product?.taxRate\n                              ? parseFloat(product.taxRate)\n                              : 10;\n                          })(),\n                        }));\n\n                        // Use exact same calculation values as displayed in Order Details\n                        let orderDetailsSubtotal = 0;\n                        let orderDetailsTax = 0;\n\n                        if (\n                          Array.isArray(orderItems) &&\n                          Array.isArray(products)\n                        ) {\n                          orderItems.forEach((item: any) => {\n                            const basePrice = Number(item.unitPrice || 0);\n                            const quantity = Number(item.quantity || 0);\n                            const product = products.find(\n                              (p: any) => p.id === item.productId,\n                            );\n\n                            // Calculate subtotal exactly as Order Details\n                            orderDetailsSubtotal += basePrice * quantity;\n\n                            // Use EXACT same tax calculation logic as Order Details\n                            if (\n                              product?.afterTaxPrice &&\n                              product.afterTaxPrice !== null &&\n                              product.afterTaxPrice !== \"\"\n                            ) {\n                              const afterTaxPrice = parseFloat(\n                                product.afterTaxPrice,\n                              );\n                              const taxPerUnit = afterTaxPrice - basePrice;\n                              orderDetailsTax += taxPerUnit * quantity;\n                            }\n                          });\n                        }\n\n                        const billData = {\n                          ...selectedOrder,\n                          transactionId:\n                            selectedOrder.orderNumber ||\n                            `BILL-${selectedOrder.id}`,\n                          items: processedItems,\n                          subtotal: orderDetailsSubtotal.toString(),\n                          tax: orderDetailsTax.toString(),\n                          total: (\n                            orderDetailsSubtotal + orderDetailsTax\n                          ).toString(),\n                          paymentMethod: \"unpaid\",\n                          amountReceived: \"0\",\n                          change: \"0\",\n                          cashierName: \"Table Service\",\n                          createdAt:\n                            selectedOrder.orderedAt || new Date().toISOString(),\n                          customerName: selectedOrder.customerName,\n                          customerTaxCode: null,\n                          invoiceNumber: null,\n                        };\n\n                        console.log(\n                          \"📄 Table: Showing receipt modal for bill printing\",\n                        );\n                        console.log(\"📊 Bill data:\", billData);\n\n                        // Show receipt modal without auto-printing\n                        setSelectedReceipt(billData);\n                        setOrderDetailsOpen(false);\n                        setShowReceiptModal(true);\n                      } catch (error) {\n                        console.error(\"❌ Error preparing bill:\", error);\n                        toast({\n                          title: \"Lỗi\",\n                          description:\n                            \"Không thể tạo hóa đơn. Vui lòng thử lại.\",\n                          variant: \"destructive\",\n                        });\n                      }\n                    }}\n                    className=\"w-full bg-gray-600 hover:bg-gray-700 text-white\"\n                    size=\"lg\"\n                  >\n                    <Printer className=\"w-4 h-4 mr-2\" />\n                    {t(\"orders.printBill\")}\n                  </Button>\n                </div>\n              )}\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/* Receipt Preview Modal - Step 1: \"Xem trước hóa đơn\" */}\n      <ReceiptModal\n        isOpen={showReceiptPreview}\n        onClose={() => {\n          console.log(\"🔴 Table: Closing receipt preview modal\");\n          setShowReceiptPreview(false);\n          setPreviewReceipt(null);\n        }}\n        receipt={previewReceipt}\n        onConfirm={() => {\n          console.log(\n            \"📄 Table: Receipt preview confirmed, starting payment flow\",\n          );\n\n          if (!previewReceipt) {\n            console.error(\"❌ No preview receipt data available\");\n            return;\n          }\n\n          // Prepare complete order data for payment flow\n          const completeOrderData = {\n            ...selectedOrder,\n            orderItems: previewReceipt.orderItems || orderItems || [],\n            exactSubtotal: previewReceipt.exactSubtotal,\n            exactTax: previewReceipt.exactTax,\n            exactTotal: previewReceipt.exactTotal,\n          };\n\n          console.log(\n            \"💾 Table: Setting order for payment with complete data:\",\n            completeOrderData,\n          );\n          setOrderForPayment(completeOrderData);\n\n          // Close preview and show payment method modal\n          setShowReceiptPreview(false);\n          setShowPaymentMethodModal(true);\n        }}\n        isPreview={true}\n        cartItems={\n          previewReceipt?.items?.map((item: any) => ({\n            id: item.productId || item.id,\n            name: item.productName || item.name,\n            price: parseFloat(item.price || item.unitPrice || \"0\"),\n            quantity: item.quantity,\n            sku: item.sku || `SP${item.productId}`,\n            taxRate: item.taxRate || 10,\n          })) || []\n        }\n        total={previewReceipt ? parseFloat(previewReceipt.total) : 0}\n      />\n\n      {/* Payment Method Modal - Step 2: Chọn phương thức thanh toán */}\n      <PaymentMethodModal\n        isOpen={showPaymentMethodModal}\n        onClose={() => {\n          console.log(\"🔴 Table: Closing payment method modal\");\n          setShowPaymentMethodModal(false);\n          setOrderForPayment(null);\n        }}\n        onSelectMethod={async (method: string, data?: any) => {\n          console.log(\"🎯 Table: Payment method selected:\", method, data);\n\n          if (method === \"paymentCompleted\" && data?.success) {\n            console.log(\"✅ Table: Payment completed successfully\", data);\n\n            try {\n              // Refresh data\n              await Promise.all([\n                refetchTables(),\n                refetchOrders()\n              ]);\n\n              console.log('✅ Table: Data refreshed after payment');\n\n              toast({\n                title: 'Thành công',\n                description: data.publishLater\n                  ? 'Đơn hàng đã được thanh toán và lưu để phát hành hóa đơn sau'\n                  : 'Đơn hàng đã được thanh toán và hóa đơn điện tử đã được phát hành',\n              });\n\n              // Show receipt if available\n              if (data.receipt && data.shouldShowReceipt) {\n                console.log('📄 Table: Showing receipt modal after successful payment');\n                setSelectedReceipt(data.receipt);\n                setShowReceiptModal(true);\n              }\n\n            } catch (error) {\n              console.error('❌ Error refreshing data after payment:', error);\n            }\n\n            // Close order details if open\n            setOrderDetailsOpen(false);\n            setSelectedOrder(null);\n          }\n\n          if (method === \"paymentError\" && data) {\n            console.error(\"❌ Table: Payment failed\", data);\n\n            toast({\n              title: 'Lỗi',\n              description: data.error || 'Không thể hoàn tất thanh toán. Vui lòng thử lại.',\n              variant: 'destructive',\n            });\n          }\n\n          // Always close payment modal\n          setShowPaymentMethodModal(false);\n          setOrderForPayment(null);\n        }}\n        total={(() => {\n          const orderTotal =\n            orderForPayment?.exactTotal ??\n            orderForPayment?.total ??\n            selectedOrder?.total ??\n            0;\n          return Math.floor(parseFloat(orderTotal.toString()) || 0);\n        })()}\n        orderForPayment={orderForPayment}\n        products={products}\n        getProductName={getProductName}\n        receipt={previewReceipt}\n      />\n\n      {/* E-Invoice Modal */}\n      {showEInvoiceModal && orderForPayment && (\n        <EInvoiceModal\n          isOpen={showEInvoiceModal}\n          onClose={() => {\n            setShowEInvoiceModal(false);\n            setOrderForPayment(null);\n          }}\n          onConfirm={handleEInvoiceConfirm}\n          total={(() => {\n            const orderTotal =\n              orderForPayment?.exactTotal ??\n              orderForPayment?.total ??\n              selectedOrder?.total ??\n              0;\n            return Math.floor(parseFloat(orderTotal.toString()) || 0);\n          })()}\n          cartItems={(() => {\n            // Use orderItems from orderForPayment if available\n            const itemsToMap = orderForPayment?.orderItems || orderItems || [];\n            console.log(\n              \"📦 Mapping cart items for E-invoice modal:\",\n              itemsToMap.length,\n            );\n\n            return itemsToMap.map((item: any) => {\n              const product = Array.isArray(products)\n                ? products.find((p: any) => p.id === item.productId)\n                : null;\n\n              return {\n                id: item.productId,\n                name: item.productName || getProductName(item.productId),\n                price: parseFloat(item.unitPrice || \"0\"),\n                quantity: item.quantity,\n                sku: item.productSku || `SP${item.productId}`,\n                taxRate: (() => {\n                  const product = Array.isArray(products)\n                    ? products.find((p: any) => p.id === item.productId)\n                    : null;\n                  return product?.taxRate ? parseFloat(product.taxRate) : 10;\n                })(),\n              };\n            });\n          })()}\n          source=\"table\"\n          orderId={orderForPayment.id}\n        />\n      )}\n\n      {/* Receipt Modal - Final receipt after payment */}\n      {showReceiptModal && selectedReceipt && (\n        <ReceiptModal\n          isOpen={showReceiptModal}\n          onClose={() => {\n            console.log(\n              \"🔴 Table: Closing final receipt modal and clearing all states\",\n            );\n            setShowReceiptModal(false);\n            setSelectedReceipt(null);\n            setOrderForPayment(null);\n            setShowPaymentMethodModal(false);\n            setShowEInvoiceModal(false);\n            setShowReceiptPreview(false);\n            setPreviewReceipt(null);\n            setOrderDetailsOpen(false);\n            setSelectedOrder(null);\n            setSelectedPaymentMethod(\"\"); // Clear selected payment method\n          }}\n          receipt={selectedReceipt}\n          cartItems={\n            selectedReceipt?.items?.map((item: any) => ({\n              id: item.productId || item.id,\n              name: item.productName || item.name,\n              price: parseFloat(item.price || item.unitPrice || \"0\"),\n              quantity: item.quantity,\n              sku: item.sku || `SP${item.productId}`,\n              taxRate: (() => {\n                const product = Array.isArray(products)\n                  ? products.find((p: any) => p.id === item.productId)\n                  : null;\n                return product?.taxRate ? parseFloat(product.taxRate) : 10;\n              })(),\n            })) || []\n          }\n          isPreview={!!orderForPayment} // Show as preview if there's an order waiting for payment\n          onConfirm={orderForPayment ? handleReceiptConfirm : undefined}\n        />\n      )}\n\n      {/* Points Payment Dialog */}\n      <Dialog open={pointsPaymentOpen} onOpenChange={setPointsPaymentOpen}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>{t(\"orders.pointsPaymentDialog.title\")}</DialogTitle>\n            <DialogDescription>\n              {t(\"orders.pointsPaymentDialog.description\")}\n            </DialogDescription>\n          </DialogHeader>\n\n          <div className=\"space-y-6\">\n            {/* Order Summary */}\n            {selectedOrder && (\n              <div className=\"p-4 bg-gray-50 rounded-lg\">\n                <h4 className=\"font-medium mb-2\">\n                  {t(\"orders.pointsPaymentDialog.orderInfo\")}\n                </h4>\n                <div className=\"flex justify-between text-sm\">\n                  <span>{t(\"orders.pointsPaymentDialog.orderCode\")}</span>\n                  <span className=\"font-medium\">\n                    {selectedOrder.orderNumber}\n                  </span>\n                </div>\n                <div className=\"flex justify-between text-sm\">\n                  <span>{t(\"orders.pointsPaymentDialog.totalAmount\")}</span>\n                  <span className=\"font-medium\">\n                    {Math.floor(Number(selectedOrder.total)).toLocaleString()} ₫\n                  </span>\n                </div>\n              </div>\n            )}\n\n            {/* Customer Selection */}\n            <div className=\"space-y-3\">\n              <Label>{t(\"orders.pointsPaymentDialog.searchCustomer\")}</Label>\n              <Input\n                placeholder={t(\"orders.pointsPaymentDialog.searchPlaceholder\")}\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n              />\n\n              <div className=\"max-h-64 overflow-y-auto border rounded-md\">\n                {filteredCustomers.map((customer: any) => (\n                  <div\n                    key={customer.id}\n                    className={`p-3 cursor-pointer hover:bg-gray-50 border-b ${\n                      selectedCustomer?.id === customer.id\n                        ? \"bg-blue-50 border-blue-200\"\n                        : \"\"\n                    }`}\n                    onClick={() => setSelectedCustomer(customer)}\n                  >\n                    <div className=\"flex justify-between items-center\">\n                      <div>\n                        <p className=\"font-medium\">{customer.name}</p>\n                        <p className=\"text-sm text-gray-600\">\n                          {customer.customerId}\n                        </p>\n                        {customer.phone && (\n                          <p className=\"text-sm text-gray-600\">\n                            {customer.phone}\n                          </p>\n                        )}\n                      </div>\n                      <div className=\"text-right\">\n                        <p className=\"font-medium text-green-600\">\n                          {(customer.points || 0).toLocaleString()}P\n                        </p>\n                        <p className=\"text-xs text-gray-500\">\n                          {t(\"orders.pointsPaymentDialog.accumulatedPoints\")}\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n                {filteredCustomers.length === 0 && searchTerm && (\n                  <div className=\"p-4 text-center text-gray-500\">\n                    {t(\"common.noData\")}\n                  </div>\n                )}\n              </div>\n            </div>\n\n            {/* Selected Customer Info */}\n            {selectedCustomer && selectedOrder && (\n              <div className=\"p-4 bg-green-50 rounded-lg\">\n                <h4 className=\"font-medium mb-2\">Khách hàng đã chọn</h4>\n                <div className=\"flex justify-between items-center mb-3\">\n                  <div>\n                    <p className=\"font-medium\">{selectedCustomer.name}</p>\n                    <p className=\"text-sm text-gray-600\">\n                      {selectedCustomer.customerId}\n                    </p>\n                  </div>\n                  <div className=\"text-right\">\n                    <p className=\"font-medium text-green-600\">\n                      {(selectedCustomer.points || 0).toLocaleString()}P\n                    </p>\n                    <p className=\"text-xs text-gray-500\">\n                      ≈{\" \"}\n                      {((selectedCustomer.points || 0) * 1000).toLocaleString()}{\" \"}\n                      ₫\n                    </p>\n                  </div>\n                </div>\n\n                {/* Payment calculation */}\n                <div className=\"pt-2 border-t border-green-200\">\n                  <div className=\"flex justify-between text-sm mb-1\">\n                    <span>Tổng đơn hàng:</span>\n                    <span className=\"font-medium\">\n                      {Number(selectedOrder.total).toLocaleString()} ₫\n                    </span>\n                  </div>\n                  {(selectedCustomer.points || 0) * 1000 >=\n                  Number(selectedOrder.total) ? (\n                    <div className=\"text-green-600 text-sm\">\n                      ✓ Đủ điểm để thanh toán toàn bộ\n                    </div>\n                  ) : (\n                    <div className=\"text-orange-600 text-sm\">\n                      ⚠ Cần thanh toán thêm:{\" \"}\n                      {(\n                        Number(selectedOrder.total) -\n                        (selectedCustomer.points || 0) * 1000\n                      ).toLocaleString()}{\" \"}\n                      ₫\n                    </div>\n                  )}\n                </div>\n              </div>\n            )}\n          </div>\n\n          <div className=\"flex justify-end gap-2 pt-4\">\n            <Button\n              variant=\"outline\"\n              onClick={() => setPointsPaymentOpen(false)}\n            >\n              {t(\"orders.cancel\")}\n            </Button>\n            <Button\n              onClick={handlePointsPayment}\n              disabled={\n                !selectedCustomer ||\n                (selectedCustomer.points || 0) === 0 ||\n                pointsPaymentMutation.isPending\n              }\n              className=\"bg-blue-600 hover:bg-blue-700\"\n            >\n              {pointsPaymentMutation.isPending\n                ? \"Đang xử lý...\"\n                : selectedCustomer &&\n                    selectedOrder &&\n                    (selectedCustomer.points || 0) * 1000 >=\n                      Number(selectedOrder.total)\n                  ? t(\"orders.pointsPaymentTitle\")\n                  : t(\"orders.mixedPaymentButton\")}\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* QR Payment Dialog */}\n      <Dialog open={showQRPayment} onOpenChange={setShowQRPayment}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <QrCode className=\"w-5 h-5\" />\n              Thanh toán {selectedPaymentMethod?.method?.name}\n            </DialogTitle>\n            <DialogDescription>\n              Quét mã QR để hoàn tất thanh toán\n            </DialogDescription>\n          </DialogHeader>\n\n          <div className=\"space-y-4 p-4\">\n            {/* Payment Amount Summary */}\n            {selectedOrder && (\n              <div className=\"text-center p-4 bg-gray-50 rounded-lg\">\n                <p className=\"text-sm text-gray-600\">\n                  Đơn hàng: {selectedOrder.orderNumber}\n                </p>\n                <p className=\"text-sm text-gray-500 mb-2\">\n                  Số tiền cần thanh toán:\n                </p>\n                <p className=\"text-3xl font-bold text-green-600\">\n                  {mixedPaymentData\n                    ? Math.floor(\n                        mixedPaymentData.remainingAmount,\n                      ).toLocaleString(\"vi-VN\")\n                    : Math.floor(\n                        Number(selectedOrder?.total || 0),\n                      ).toLocaleString(\"vi-VN\")}{\" \"}\n                  ₫\n                </p>\n                {mixedPaymentData && (\n                  <div className=\"mt-2 pt-2 border-t border-gray-300\">\n                    <p className=\"text-xs text-blue-600\">\n                      Đã sử dụng {mixedPaymentData.pointsToUse.toLocaleString()}\n                      P (-\n                      {(mixedPaymentData.pointsToUse * 1000).toLocaleString()}{\" \"}\n                      ₫)\n                    </p>\n                  </div>\n                )}\n              </div>\n            )}\n\n            {/* QR Code */}\n            {qrCodeUrl && (\n              <div className=\"flex justify-center\">\n                <div className=\"bg-white p-4 rounded-lg border-2 border-gray-200 shadow-lg\">\n                  <img\n                    src={qrCodeUrl}\n                    alt=\"QR Code for Payment\"\n                    className=\"w-64 h-64\"\n                  />\n                </div>\n              </div>\n            )}\n\n            <p className=\"text-sm text-gray-600 text-center\">\n              Sử dụng ứng dụng {selectedPaymentMethod?.method?.name} để quét mã\n              QR và thực hiện thanh toán\n            </p>\n\n            {/* Action Buttons */}\n            <div className=\"flex gap-3\">\n              <Button\n                variant=\"outline\"\n                onClick={handleQRPaymentClose}\n                className=\"flex-1\"\n              >\n                Quay lại\n              </Button>\n              <Button\n                onClick={handleQRPaymentConfirm}\n                className=\"flex-1 bg-green-600 hover:bg-green-700 text-white transition-colors duration-200\"\n              >\n                Xác nhận thanh toán\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Mixed Payment Dialog */}\n      <Dialog open={mixedPaymentOpen} onOpenChange={setMixedPaymentOpen}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <CreditCard className=\"w-5 h-5 text-orange-600\" />\n              Thanh toán hỗn hợp\n            </DialogTitle>\n            <DialogDescription>\n              Không đủ điểm, cần thanh toán thêm bằng tiền mặt hoặc chuyển khoản\n            </DialogDescription>\n          </DialogHeader>\n\n          {mixedPaymentData && (\n            <div className=\"space-y-4\">\n              {/* Payment Summary */}\n              <div className=\"p-4 bg-gray-50 rounded-lg\">\n                <h4 className=\"font-medium mb-2\">Tóm tắt thanh toán</h4>\n                <div className=\"space-y-2 text-sm\">\n                  <div className=\"flex justify-between\">\n                    <span>Tổng đơn hàng:</span>\n                    <span className=\"font-medium\">\n                      {Number(selectedOrder?.total || 0).toLocaleString()} ₫\n                    </span>\n                  </div>\n                  <div className=\"flex justify-between text-blue-600\">\n                    <span>Thanh toán bằng điểm:</span>\n                    <span className=\"font-medium\">\n                      {mixedPaymentData.pointsToUse.toLocaleString()}P\n                      <span className=\"ml-1\">\n                        (-\n                        {(mixedPaymentData.pointsToUse * 1000).toLocaleString()}{\" \"}\n                        ₫)\n                      </span>\n                    </span>\n                  </div>\n                  <div className=\"border-t pt-2 flex justify-between font-medium text-orange-600\">\n                    <span>Cần thanh toán thêm:</span>\n                    <p className=\"text-sm text-gray-500\">\n                      {Math.floor(\n                        mixedPaymentData.remainingAmount,\n                      ).toLocaleString()}{\" \"}\n                      ₫\n                    </p>\n                  </div>\n                </div>\n              </div>\n\n              {/* Payment Methods */}\n              <div className=\"space-y-3\">\n                <h4 className=\"font-medium\">\n                  Chọn phương thức thanh toán cho phần còn lại:\n                </h4>\n                <div className=\"grid grid-cols-1 gap-2\">\n                  <Button\n                    variant=\"outline\"\n                    className=\"justify-start h-auto p-4\"\n                    onClick={() =>\n                      mixedPaymentMutation.mutate({\n                        customerId: mixedPaymentData.customerId,\n                        points: mixedPaymentData.pointsToUse,\n                        orderId: mixedPaymentData.orderId,\n                        paymentMethod: \"cash\",\n                      })\n                    }\n                    disabled={mixedPaymentMutation.isPending}\n                  >\n                    <span className=\"text-2xl mr-3\">💵</span>\n                    <div className=\"text-left\">\n                      <p className=\"font-medium\">Tiền mặt</p>\n                      <p className=\"text-sm text-gray-500\">\n                        {Math.floor(\n                          mixedPaymentData.remainingAmount,\n                        ).toLocaleString()}{\" \"}\n                        ₫\n                      </p>\n                    </div>\n                  </Button>\n\n                  <Button\n                    variant=\"outline\"\n                    className=\"justify-start h-auto p-4\"\n                    onClick={async () => {\n                      // Use CreateQRPos API for transfer payment like QR Code\n                      try {\n                        setQrLoading(true);\n                        const transactionUuid = `TXN-TRANSFER-${Date.now()}`;\n                        const depositAmt = Number(\n                          mixedPaymentData.remainingAmount,\n                        );\n\n                        const qrRequest: CreateQRPosRequest = {\n                          transactionUuid,\n                          depositAmt: depositAmt,\n                          posUniqueId: \"ER002\",\n                          accntNo: \"0900993023\",\n                          posfranchiseeName: \"DOOKI-HANOI\",\n                          posCompanyName: \"HYOJUNG\",\n                          posBillNo: `TRANSFER-${Date.now()}`,\n                        };\n\n                        const bankCode = \"79616001\";\n                        const clientID = \"91a3a3668724e631e1baf4f8526524f3\";\n\n                        console.log(\n                          \"Calling CreateQRPos API for transfer payment:\",\n                          { qrRequest, bankCode, clientID },\n                        );\n\n                        const qrResponse = await createQRPosAsync(\n                          qrRequest,\n                          bankCode,\n                          clientID,\n                        );\n\n                        console.log(\n                          \"CreateQRPos API response for transfer:\",\n                          qrResponse,\n                        );\n\n                        // Generate QR code from the received QR data and show QR modal\n                        if (qrResponse.qrData) {\n                          let qrContent = qrResponse.qrData;\n                          try {\n                            // Try to decode if it's base64 encoded\n                            qrContent = atob(qrResponse.qrData);\n                          } catch (e) {\n                            // If decode fails, use the raw qrData\n                            console.log(\n                              \"Using raw qrData for transfer as it is not base64 encoded\",\n                            );\n                          }\n\n                          const qrUrl = await QRCodeLib.toDataURL(qrContent, {\n                            width: 256,\n                            margin: 2,\n                            color: {\n                              dark: \"#000000\",\n                              light: \"#FFFFFF\",\n                            },\n                          });\n\n                          // Set QR code data and show QR payment modal\n                          setQrCodeUrl(qrUrl);\n                          setSelectedPaymentMethod({\n                            key: \"transfer\",\n                            method: { name: \"Chuyển khoản\", icon: \"💳\" },\n                          });\n                          setShowQRPayment(true);\n                          setMixedPaymentOpen(false);\n                        } else {\n                          console.error(\n                            \"No QR data received from API for transfer\",\n                          );\n                          // Fallback to direct payment\n                          mixedPaymentMutation.mutate({\n                            customerId: mixedPaymentData.customerId,\n                            points: mixedPaymentData.pointsToUse,\n                            orderId: mixedPaymentData.orderId,\n                            paymentMethod: \"transfer\",\n                          });\n                        }\n                      } catch (error) {\n                        console.error(\n                          \"Error calling CreateQRPos API for transfer:\",\n                          error,\n                        );\n                        // Fallback to direct payment on error\n                        mixedPaymentMutation.mutate({\n                          customerId: mixedPaymentData.customerId,\n                          points: mixedPaymentData.pointsToUse,\n                          orderId: mixedPaymentData.orderId,\n                          paymentMethod: \"transfer\",\n                        });\n                      } finally {\n                        setQrLoading(false);\n                      }\n                    }}\n                    disabled={mixedPaymentMutation.isPending || qrLoading}\n                  >\n                    <span className=\"text-2xl mr-3\">💳</span>\n                    <div className=\"text-left\">\n                      <p className=\"font-medium\">Chuyển khoản</p>\n                      <p className=\"text-sm text-gray-500\">\n                        {Math.floor(\n                          mixedPaymentData.remainingAmount,\n                        ).toLocaleString()}{\" \"}\n                        ₫\n                      </p>\n                    </div>\n                  </Button>\n                </div>\n              </div>\n\n              <div className=\"flex justify-end gap-2 pt-4\">\n                <Button\n                  variant=\"outline\"\n                  onClick={() => setMixedPaymentOpen(false)}\n                >\n                  {t(\"orders.cancel\")}\n                </Button>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/* Edit Order Dialog */}\n      <OrderDialog\n        open={editOrderOpen}\n        onOpenChange={(open) => {\n          setEditOrderOpen(open);\n          // When dialog closes after editing, refresh all data\n          if (!open && editingOrder) {\n            console.log(\n              \"🔄 Edit dialog closed, triggering recalculation for order:\",\n              editingOrder.id,\n            );\n\n            // Add a small delay to ensure any pending API calls complete\n            setTimeout(() => {\n              // Recalculate order total first - this will also handle the data refresh\n              recalculateOrderMutation.mutate(editingOrder.id);\n            }, 100);\n\n            // Clear editing states\n            setEditingOrder(null);\n            setEditingTable(null);\n          }\n        }}\n        table={editingTable}\n        existingOrder={editingOrder}\n        mode=\"edit\"\n      />\n    </>\n  );\n}","size_bytes":114530},"client/src/components/tables/table-management.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Plus, Edit2, Trash2, Users, QrCode } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { Table as TableType } from \"@shared/schema\";\nimport { z } from \"zod\";\n\n// We'll create the schema inside the component to access translations\nconst createTableFormSchema = (t: any) =>\n  z.object({\n    tableNumber: z.string().min(1, t(\"tables.tableNumberRequired\")),\n    capacity: z.number().min(1, t(\"tables.capacityMinimum\")),\n    status: z.enum([\"available\", \"occupied\", \"reserved\", \"maintenance\"]),\n    qrCode: z.string().optional(),\n  });\n\ntype TableFormData = {\n  tableNumber: string;\n  capacity: number;\n  status: \"available\" | \"occupied\" | \"reserved\" | \"maintenance\";\n  qrCode?: string;\n};\n\nexport function TableManagement() {\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const [editingTable, setEditingTable] = useState<TableType | null>(null);\n  const { toast } = useToast();\n  const { t } = useTranslation();\n  const queryClient = useQueryClient();\n\n  const { data: tables, isLoading } = useQuery({\n    queryKey: [\"/api/tables\"],\n  });\n\n  const tableFormSchema = createTableFormSchema(t);\n\n  const form = useForm<TableFormData>({\n    resolver: zodResolver(tableFormSchema),\n    defaultValues: {\n      tableNumber: \"\",\n      capacity: 1,\n      status: \"available\",\n      qrCode: \"\",\n    },\n  });\n\n  const createTableMutation = useMutation({\n    mutationFn: (data: TableFormData) =>\n      apiRequest(\"POST\", \"/api/tables\", data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/tables\"] });\n      toast({\n        title: t(\"common.success\"),\n        description: t(\"tables.tableCreateSuccess\"),\n      });\n      handleCloseDialog();\n    },\n    onError: () => {\n      toast({\n        title: t(\"common.error\"),\n        description: t(\"common.error\"),\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateTableMutation = useMutation({\n    mutationFn: ({ id, data }: { id: number; data: TableFormData }) =>\n      apiRequest(\"PUT\", `/api/tables/${id}`, data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/tables\"] });\n      toast({\n        title: t(\"common.success\"),\n        description: t(\"tables.tableUpdateSuccess\"),\n      });\n      handleCloseDialog();\n    },\n    onError: () => {\n      toast({\n        title: t(\"common.error\"),\n        description: t(\"tables.tableUpdateError\"),\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteTableMutation = useMutation({\n    mutationFn: (id: number) => apiRequest(\"DELETE\", `/api/tables/${id}`, {}),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/tables\"] });\n      toast({\n        title: t(\"common.success\"),\n        description: t(\"tables.tableDeleteSuccess\"),\n      });\n    },\n    onError: () => {\n      toast({\n        title: t(\"common.error\"),\n        description: t(\"tables.tableDeleteError\"),\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleOpenDialog = (table?: TableType) => {\n    if (table) {\n      setEditingTable(table);\n      form.reset({\n        tableNumber: table.tableNumber,\n        capacity: table.capacity,\n        status: table.status as\n          | \"available\"\n          | \"occupied\"\n          | \"reserved\"\n          | \"maintenance\",\n        qrCode: table.qrCode || \"\",\n      });\n    } else {\n      setEditingTable(null);\n      form.reset({\n        tableNumber: \"\",\n        capacity: 1,\n        status: \"available\",\n        qrCode: \"\",\n      });\n    }\n    setDialogOpen(true);\n  };\n\n  const handleCloseDialog = () => {\n    setDialogOpen(false);\n    setEditingTable(null);\n    form.reset();\n  };\n\n  const onSubmit = (data: TableFormData) => {\n    if (editingTable) {\n      updateTableMutation.mutate({ id: editingTable.id, data });\n    } else {\n      createTableMutation.mutate(data);\n    }\n  };\n\n  const handleDelete = (id: number) => {\n    if (confirm(t(\"tables.confirmDelete\"))) {\n      deleteTableMutation.mutate(id);\n    }\n  };\n\n  const getStatusBadge = (status: string) => {\n    const statusConfig = {\n      available: { label: t(\"tables.available\"), variant: \"default\" as const },\n      occupied: {\n        label: t(\"tables.occupied\"),\n        variant: \"destructive\" as const,\n      },\n      reserved: { label: t(\"tables.reserved\"), variant: \"secondary\" as const },\n      maintenance: {\n        label: t(\"tables.outOfService\"),\n        variant: \"outline\" as const,\n      },\n    };\n\n    return (\n      statusConfig[status as keyof typeof statusConfig] ||\n      statusConfig.available\n    );\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center py-8\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h2 className=\"text-2xl font-bold text-gray-900\">\n            {t(\"tables.tableSettings\")}\n          </h2>\n          <p className=\"text-gray-600\">{t(\"tables.tableSettingsDesc\")}</p>\n        </div>\n        <Button onClick={() => handleOpenDialog()}>\n          <Plus className=\"w-4 h-4 mr-2\" />\n          {t(\"tables.addTable\")}\n        </Button>\n      </div>\n\n      {/* Tables List */}\n      <Card>\n        <CardHeader>\n          <CardTitle>{t(\"tables.tableList\")}</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>{t(\"tables.tableNumberLabel\")}</TableHead>\n                <TableHead>{t(\"tables.capacityLabel\")}</TableHead>\n                <TableHead>{t(\"tables.statusLabel\")}</TableHead>\n                <TableHead>{t(\"tables.qrCodeLabel\")}</TableHead>\n                <TableHead>{t(\"tables.createdDate\")}</TableHead>\n                <TableHead>{t(\"tables.actions\")}</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {tables && (tables as TableType[]).length > 0 ? (\n                (tables as TableType[]).map((table: TableType) => {\n                  const statusConfig = getStatusBadge(table.status);\n                  return (\n                    <TableRow key={table.id}>\n                      <TableCell className=\"font-medium\">\n                        {table.tableNumber}\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center gap-1\">\n                          <Users className=\"w-4 h-4\" />\n                          {table.capacity} {t(\"orders.people\")}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant={statusConfig.variant}>\n                          {statusConfig.label}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        {table.qrCode ? (\n                          <div className=\"flex items-center gap-1\">\n                            <QrCode className=\"w-4 h-4\" />\n                            <span className=\"text-xs\">\n                              {table.qrCode.substring(0, 10)}...\n                            </span>\n                          </div>\n                        ) : (\n                          <span className=\"text-xs text-gray-400\">\n                            {t(\"tables.none\")}\n                          </span>\n                        )}\n                      </TableCell>\n                      <TableCell>\n                        {new Date(table.createdAt).toLocaleDateString(\"ko-KR\")}\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex gap-2\">\n                          <Button\n                            size=\"sm\"\n                            variant=\"outline\"\n                            onClick={() => handleOpenDialog(table)}\n                          >\n                            <Edit2 className=\"w-3 h-3\" />\n                          </Button>\n                          <Button\n                            size=\"sm\"\n                            variant=\"destructive\"\n                            onClick={() => handleDelete(table.id)}\n                          >\n                            <Trash2 className=\"w-3 h-3\" />\n                          </Button>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  );\n                })\n              ) : (\n                <TableRow>\n                  <TableCell\n                    colSpan={6}\n                    className=\"text-center py-8 text-gray-500\"\n                  >\n                    {t(\"tables.noTables\")}\n                  </TableCell>\n                </TableRow>\n              )}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n\n      {/* Add/Edit Dialog */}\n      <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>\n              {editingTable ? t(\"tables.editTable\") : t(\"tables.addTable\")}\n            </DialogTitle>\n            <DialogDescription>\n              {editingTable\n                ? t(\"tables.editTableDesc\")\n                : t(\"tables.addTableDesc\")}\n            </DialogDescription>\n          </DialogHeader>\n\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n              <FormField\n                control={form.control}\n                name=\"tableNumber\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t(\"tables.tableNumberLabel\")}</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder={t(\"tables.tableNumberPlaceholder\")}\n                        {...field}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"capacity\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t(\"tables.capacityLabel\")}</FormLabel>\n                    <FormControl>\n                      <Input\n                        type=\"number\"\n                        min=\"1\"\n                        {...field}\n                        onChange={(e) =>\n                          field.onChange(parseInt(e.target.value) || 1)\n                        }\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"status\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t(\"tables.statusLabel\")}</FormLabel>\n                    <Select\n                      onValueChange={field.onChange}\n                      defaultValue={field.value}\n                    >\n                      <FormControl>\n                        <SelectTrigger>\n                          <SelectValue\n                            placeholder={t(\"tables.statusPlaceholder\")}\n                          />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        <SelectItem value=\"available\">\n                          {t(\"tables.available\")}\n                        </SelectItem>\n                        <SelectItem value=\"occupied\">\n                          {t(\"tables.occupied\")}\n                        </SelectItem>\n                        <SelectItem value=\"reserved\">\n                          {t(\"tables.reserved\")}\n                        </SelectItem>\n                        <SelectItem value=\"maintenance\">\n                          {t(\"tables.outOfService\")}\n                        </SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"qrCode\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t(\"tables.qrCodeLabel\")}</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder={t(\"tables.qrCodePlaceholder\")}\n                        {...field}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <div className=\"flex gap-2 justify-end\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={handleCloseDialog}\n                >\n                  {t(\"common.cancel\")}\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={\n                    createTableMutation.isPending ||\n                    updateTableMutation.isPending\n                  }\n                >\n                  {createTableMutation.isPending ||\n                  updateTableMutation.isPending\n                    ? t(\"common.loading\")\n                    : editingTable\n                      ? t(\"common.edit\")\n                      : t(\"common.add\")}\n                </Button>\n              </div>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":14756},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1419},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1128},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":1901},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","size_bytes":1858},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { useTranslation } from \"@/lib/i18n\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => {\n  const { t } = useTranslation();\n  \n  return (\n    <DialogPortal>\n      <DialogOverlay />\n      <DialogPrimitive.Content\n        ref={ref}\n        className={cn(\n          \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n        <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n          <X className=\"h-4 w-4\" />\n          <span className=\"sr-only\">{t('common.close')}</span>\n        </DialogPrimitive.Close>\n      </DialogPrimitive.Content>\n    </DialogPortal>\n  );\n})\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3993},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":791},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/ui/language-switcher.tsx":{"content":"import { Globe } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { useLanguageStore, type Language } from \"@/lib/i18n\";\n\nconst languages = [\n  { code: 'ko' as Language, name: '한국어', flag: '🇰🇷' },\n  { code: 'en' as Language, name: 'English', flag: '🇺🇸' },\n  { code: 'vi' as Language, name: 'Tiếng Việt', flag: '🇻🇳' },\n];\n\nexport function LanguageSwitcher() {\n  const { currentLanguage, setLanguage } = useLanguageStore();\n  \n  const currentLang = languages.find(lang => lang.code === currentLanguage);\n\n  const handleLanguageChange = (langCode: Language) => {\n    console.log('언어 변경 클릭:', langCode);\n    setLanguage(langCode);\n  };\n\n  return (\n    <DropdownMenu>\n      <DropdownMenuTrigger asChild>\n        <Button variant=\"outline\" size=\"sm\" className=\"gap-2 bg-white bg-opacity-20 hover:bg-opacity-30 border-white border-opacity-30 text-white hover:text-white\">\n          <Globe className=\"h-4 w-4\" />\n          <span>{currentLang?.flag}</span>\n          <span className=\"hidden sm:inline\">{currentLang?.name}</span>\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent align=\"end\">\n        {languages.map((language) => (\n          <DropdownMenuItem\n            key={language.code}\n            onClick={() => handleLanguageChange(language.code)}\n            className={currentLanguage === language.code ? \"bg-accent\" : \"\"}\n          >\n            <span className=\"mr-2\">{language.flag}</span>\n            {language.name}\n          </DropdownMenuItem>\n        ))}\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}","size_bytes":1740},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/components/ui/right-sidebar.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Link, useLocation } from \"wouter\";\nimport { \n  Home, \n  Utensils, \n  Users, \n  Clock, \n  BarChart3, \n  Settings, \n  ChevronRight,\n  ChevronLeft,\n  Menu,\n  Package,\n  ShoppingCart,\n  FileText\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { cn } from \"@/lib/utils\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\ninterface MenuItem {\n  icon: React.ComponentType<{ className?: string }>;\n  label: string;\n  href: string;\n  badge?: string;\n}\n\n// Menu items will be translated using the hook inside the component\n\nexport function RightSidebar() {\n  const [isExpanded, setIsExpanded] = useState(false);\n  const [isNavCollapsed, setIsNavCollapsed] = useState(true);\n  const [location] = useLocation();\n  const { t } = useTranslation();\n\n  // Query store settings to get business type\n  const { data: storeSettings } = useQuery({\n    queryKey: [\"/api/store-settings\"],\n    queryFn: async () => {\n      const response = await apiRequest(\"GET\", \"/api/store-settings\");\n      return response.json();\n    },\n  });\n\n  const baseMenuItems: MenuItem[] = [\n    {\n      icon: Utensils,\n      label: t('nav.tablesSales'),\n      href: \"/tables\",\n    },\n    {\n      icon: ShoppingCart,\n      label: t('nav.directSales'),\n      href: \"/pos\",\n    },\n    {\n      icon: FileText,\n      label: t('nav.salesOrders'),\n      href: \"/sales-orders\",\n    },\n    {\n      icon: Package,\n      label: t('nav.inventory'),\n      href: \"/inventory\",\n    },\n    {\n      icon: BarChart3,\n      label: t('nav.reports'),\n      href: \"/reports\",\n    },\n    {\n      icon: Users,\n      label: t('nav.employees'),\n      href: \"/employees\",\n    },\n    {\n      icon: Clock,\n      label: t('nav.attendance'),\n      href: \"/attendance\",\n    },\n    {\n      icon: Settings,\n      label: t('settings.title'),\n      href: \"/settings\",\n    },\n  ];\n\n  // Filter menu items based on business type\n  const menuItems = baseMenuItems.filter(item => {\n    // Hide tables (Bán theo bàn) for retail business type\n    if (item.href === \"/tables\" && storeSettings?.businessType === \"retail\") {\n      return false;\n    }\n    return true;\n  });\n\n  // Update CSS custom property for responsive margin\n  useEffect(() => {\n    document.documentElement.style.setProperty(\n      '--sidebar-width', \n      isExpanded ? '256px' : '64px'\n    );\n  }, [isExpanded]);\n\n  \n\n  return (\n    <div className={cn(\n      \"fixed left-0 top-16 bottom-0 bg-white border-r border-green-200 shadow-lg transition-all duration-300 z-40\",\n      isExpanded ? \"w-64\" : \"w-16\"\n    )}>\n      {/* Toggle Button */}\n      <div className=\"p-4 border-b border-green-200 bg-green-50 mt-2\">\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          className=\"w-full flex items-center justify-center mt-1\"\n          onClick={() => {\n            if (isExpanded) {\n              setIsNavCollapsed(true);\n              setIsExpanded(false);\n            } else {\n              setIsExpanded(true);\n              setIsNavCollapsed(false); // Auto show text when expanding\n            }\n          }}\n        >\n          {isExpanded ? (\n            <>\n              <ChevronLeft className=\"w-4 h-4 mr-2\" />\n              <span>{t('common.collapse')}</span>\n            </>\n          ) : (\n            <Menu className=\"w-4 h-4\" />\n          )}\n        </Button>\n      </div>\n\n      {/* Menu Items */}\n      <nav className=\"py-4 group\">\n        {menuItems.map((item, index) => {\n          const Icon = item.icon;\n          const isActive = location === item.href;\n          const showText = isExpanded && !isNavCollapsed;\n          \n          return (\n            <div \n              key={item.href}\n              className={cn(\n                \"relative\",\n                isNavCollapsed && \"group-hover:w-64\"\n              )}\n            >\n              <Link href={item.href}>\n                <Button\n                  variant={isActive ? \"secondary\" : \"ghost\"}\n                  className={cn(\n                    \"w-[calc(100%-16px)] justify-start mb-2 mx-2 h-12 rounded-lg font-semibold text-gray-700 transition-all duration-300 relative border border-transparent overflow-hidden\",\n                    \"bg-gradient-to-r from-gray-50 to-white hover:from-green-50 hover:to-green-100 hover:border-green-200 hover:text-green-700 hover:shadow-xl\",\n                    \"focus:outline-none focus:ring-0 focus-visible:ring-0 focus-visible:outline-none\",\n                    showText ? \"px-4\" : \"px-3\",\n                    isActive && \"bg-gradient-to-r from-green-100 to-green-50 text-green-800 border-green-300 shadow-lg font-bold\",\n                    isNavCollapsed && !showText && \"hover:w-64 group\"\n                  )}\n                >\n                  <Icon className={cn(\"w-6 h-6 flex-shrink-0\", showText && \"mr-4\", isActive && \"text-green-700\")} />\n                  {showText && (\n                    <span className=\"font-semibold text-base\">\n                      {item.label}\n                    </span>\n                  )}\n                  {isNavCollapsed && !showText && (\n                    <span className=\"ml-3 font-semibold text-base opacity-0 group-hover:opacity-100 transition-all duration-200 whitespace-nowrap\">\n                      {item.label}\n                    </span>\n                  )}\n                  \n                  {showText && item.badge && (\n                    <span className=\"ml-auto bg-red-600 text-white text-xs font-bold rounded-full px-3 py-1 shadow-md\">\n                      {item.badge}\n                    </span>\n                  )}\n                </Button>\n              </Link>\n              {/* Add separator after first item (기본 POS) and before employee section */}\n              {(index === 0 || index === 3) && showText && (\n                <div className=\"border-t border-gray-200 my-3 mx-4\"></div>\n              )}\n            </div>\n          );\n        })}\n      </nav>\n\n      {/* Bottom Section */}\n      {isExpanded && !isNavCollapsed && (\n        <div className=\"absolute bottom-0 left-0 right-0 p-4 border-t border-green-200 bg-green-50\">\n          <div className=\"text-sm text-gray-500 text-center\">\n            <div className=\"font-medium\">EDPOS System</div>\n            <div className=\"text-xs opacity-75\">v1.0.0</div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}","size_bytes":6445},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5742},"client/src/components/ui/separator.tsx":{"content":"import { forwardRef } from \"react\";\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\";\nimport { cn } from \"@/lib/utils\";\n\nconst Separator = forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n);\nSeparator.displayName = SeparatorPrimitive.Root.displayName;\n\nexport { Separator };","size_bytes":758},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContextProps>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <SheetHeader className=\"sr-only\">\n              <SheetTitle>Sidebar</SheetTitle>\n              <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n            </SheetHeader>\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden text-sidebar-foreground md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex w-full flex-1 flex-col bg-background\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":23567},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/table.tsx":{"content":"import { forwardRef } from \"react\";\nimport { cn } from \"@/lib/utils\";\n\nconst Table = forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n));\nTable.displayName = \"Table\";\n\nconst TableHeader = forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n));\nTableHeader.displayName = \"TableHeader\";\n\nconst TableBody = forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n));\nTableBody.displayName = \"TableBody\";\n\nconst TableFooter = forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n));\nTableFooter.displayName = \"TableFooter\";\n\nconst TableRow = forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n));\nTableRow.displayName = \"TableRow\";\n\nconst TableHead = forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n));\nTableHead.displayName = \"TableHead\";\n\nconst TableCell = forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n));\nTableCell.displayName = \"TableCell\";\n\nconst TableCaption = forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nTableCaption.displayName = \"TableCaption\";\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n};","size_bytes":2738},"client/src/components/ui/tabs.tsx":{"content":"import { forwardRef } from \"react\";\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\";\nimport { cn } from \"@/lib/utils\";\n\nconst Tabs = TabsPrimitive.Root;\n\nconst TabsList = forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n));\nTabsList.displayName = TabsPrimitive.List.displayName;\n\nconst TabsTrigger = forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName;\n\nconst TabsContent = forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n));\nTabsContent.displayName = TabsPrimitive.Content.displayName;\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent };","size_bytes":1878},"client/src/components/ui/textarea.tsx":{"content":"import { forwardRef } from \"react\";\nimport { cn } from \"@/lib/utils\";\n\nexport interface TextareaProps extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}\n\nconst Textarea = forwardRef<HTMLTextAreaElement, TextareaProps>(\n  ({ className, ...props }, ref) => {\n    return (\n      <textarea\n        className={cn(\n          \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    );\n  }\n);\nTextarea.displayName = \"Textarea\";\n\nexport { Textarea };","size_bytes":772},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 right-0 z-[100] flex max-h-screen w-full flex-col p-4 md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4798},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/components/ui/virtual-keyboard.tsx":{"content":"import React, { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { Delete, ChevronUp, Space } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface VirtualKeyboardProps {\n  onKeyPress: (key: string) => void;\n  onBackspace: () => void;\n  onEnter: () => void;\n  className?: string;\n  isVisible?: boolean;\n}\n\nconst VirtualKeyboard: React.FC<VirtualKeyboardProps> = ({\n  onKeyPress,\n  onBackspace,\n  onEnter,\n  className,\n  isVisible = true,\n}) => {\n  const [isShiftPressed, setIsShiftPressed] = useState(false);\n  const [isCapsLock, setIsCapsLock] = useState(false);\n\n  const numberKeys = [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"0\"];\n\n  const topRowKeys = [\"q\", \"w\", \"e\", \"r\", \"t\", \"y\", \"u\", \"i\", \"o\", \"p\"];\n  const middleRowKeys = [\"a\", \"s\", \"d\", \"f\", \"g\", \"h\", \"j\", \"k\", \"l\"];\n  const bottomRowKeys = [\"z\", \"x\", \"c\", \"v\", \"b\", \"n\", \"m\"];\n\n  const symbolKeys = [\"!\", \"@\", \"#\", \"$\", \"%\", \"^\", \"&\", \"*\", \"(\", \")\"];\n  const specialChars = [\"-\", \"=\", \"[\", \"]\", \"\\\\\", \";\", \"'\", \",\", \".\", \"/\"];\n\n  const handleKeyPress = (key: string) => {\n    let finalKey = key;\n\n    if (key.match(/[a-z]/)) {\n      if (isShiftPressed || isCapsLock) {\n        finalKey = key.toUpperCase();\n      }\n    } else if (key.match(/[0-9]/) && isShiftPressed) {\n      const symbolIndex = numberKeys.indexOf(key);\n      if (symbolIndex !== -1) {\n        finalKey = symbolKeys[symbolIndex];\n      }\n    }\n\n    onKeyPress(finalKey);\n\n    // Reset shift after key press (but not caps lock)\n    if (isShiftPressed) {\n      setIsShiftPressed(false);\n    }\n  };\n\n  const handleShift = () => {\n    setIsShiftPressed(!isShiftPressed);\n  };\n\n  const handleCapsLock = () => {\n    setIsCapsLock(!isCapsLock);\n    if (isShiftPressed) {\n      setIsShiftPressed(false);\n    }\n  };\n\n  if (!isVisible) return null;\n\n  return (\n    <Card className={cn(\"p-4 bg-gray-50 border shadow-lg\", className)}>\n      <div className=\"space-y-2\">\n        {/* Number Row */}\n        <div className=\"flex gap-1 justify-center\">\n          {numberKeys.map((key) => (\n            <Button\n              key={key}\n              variant=\"outline\"\n              size=\"sm\"\n              className=\"w-8 h-8 p-0 text-xs\"\n              onClick={() => handleKeyPress(key)}\n            >\n              {isShiftPressed ? symbolKeys[numberKeys.indexOf(key)] : key}\n            </Button>\n          ))}\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            className=\"w-12 h-8 p-0 text-xs\"\n            onClick={onBackspace}\n          >\n            <Delete className=\"w-3 h-3\" />\n          </Button>\n        </div>\n\n        {/* Top Row */}\n        <div className=\"flex gap-1 justify-center\">\n          {topRowKeys.map((key) => (\n            <Button\n              key={key}\n              variant=\"outline\"\n              size=\"sm\"\n              className=\"w-8 h-8 p-0 text-xs\"\n              onClick={() => handleKeyPress(key)}\n            >\n              {isShiftPressed || isCapsLock ? key.toUpperCase() : key}\n            </Button>\n          ))}\n        </div>\n\n        {/* Middle Row */}\n        <div className=\"flex gap-1 justify-center\">\n          <Button\n            variant={isCapsLock ? \"default\" : \"outline\"}\n            size=\"sm\"\n            className=\"w-12 h-8 p-0 text-xs\"\n            onClick={handleCapsLock}\n          >\n            Caps\n          </Button>\n          {middleRowKeys.map((key) => (\n            <Button\n              key={key}\n              variant=\"outline\"\n              size=\"sm\"\n              className=\"w-8 h-8 p-0 text-xs\"\n              onClick={() => handleKeyPress(key)}\n            >\n              {isShiftPressed || isCapsLock ? key.toUpperCase() : key}\n            </Button>\n          ))}\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            className=\"w-12 h-8 p-0 text-xs\"\n            onClick={onEnter}\n          >\n            Enter\n          </Button>\n        </div>\n\n        {/* Bottom Row */}\n        <div className=\"flex gap-1 justify-center\">\n          <Button\n            variant={isShiftPressed ? \"default\" : \"outline\"}\n            size=\"sm\"\n            className=\"w-12 h-8 p-0 text-xs\"\n            onClick={handleShift}\n          >\n            <ChevronUp className=\"w-3 h-3\" />\n          </Button>\n          {bottomRowKeys.map((key) => (\n            <Button\n              key={key}\n              variant=\"outline\"\n              size=\"sm\"\n              className=\"w-8 h-8 p-0 text-xs\"\n              onClick={() => handleKeyPress(key)}\n            >\n              {isShiftPressed || isCapsLock ? key.toUpperCase() : key}\n            </Button>\n          ))}\n        </div>\n\n        {/* Space and Special Characters */}\n        <div className=\"flex gap-1 justify-center\">\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            className=\"w-8 h-8 p-0 text-xs\"\n            onClick={() => handleKeyPress(\",\")}\n          >\n            ,\n          </Button>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            className=\"w-32 h-8 p-0 text-xs flex items-center justify-center\"\n            onClick={() => handleKeyPress(\" \")}\n          >\n            <Space className=\"w-4 h-4\" />\n          </Button>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            className=\"w-8 h-8 p-0 text-xs\"\n            onClick={() => handleKeyPress(\".\")}\n          >\n            .\n          </Button>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            className=\"w-8 h-8 p-0 text-xs\"\n            onClick={() => handleKeyPress(\"@\")}\n          >\n            @\n          </Button>\n        </div>\n      </div>\n    </Card>\n  );\n};\n\nexport default VirtualKeyboard;","size_bytes":5759},"client/src/lib/i18n/index.ts":{"content":"import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\nimport type { Language, TranslationKey } from './types';\nimport { translations } from './translations';\n\ninterface LanguageStore {\n  currentLanguage: Language;\n  renderTrigger: number;\n  setLanguage: (language: Language) => void;\n}\n\nexport const useLanguageStore = create<LanguageStore>()(\n  persist(\n    (set) => ({\n      currentLanguage: 'ko',\n      renderTrigger: 0,\n      setLanguage: (language: Language) => set((state) => ({ \n        currentLanguage: language,\n        renderTrigger: state.renderTrigger + 1\n      })),\n    }),\n    {\n      name: 'pos-language',\n    }\n  )\n);\n\nfunction getNestedTranslation(obj: any, key: string): string | undefined {\n  const keys = key.split('.');\n  let value = obj;\n\n  for (const k of keys) {\n    value = value?.[k];\n  }\n\n  return value;\n}\n\nexport function useTranslation() {\n  const currentLanguage = useLanguageStore(state => state.currentLanguage);\n  const renderTrigger = useLanguageStore(state => state.renderTrigger);\n  const setLanguage = useLanguageStore(state => state.setLanguage);\n\n  const t = (key: TranslationKey): string => {\n    // Force re-render by explicitly using both currentLanguage and renderTrigger\n    const value = getNestedTranslation(translations[currentLanguage], key);\n\n    // Development-time validation\n    if (!value && import.meta.env.DEV) {\n      console.warn(`Missing translation key: ${key} in language: ${currentLanguage}, trigger: ${renderTrigger}`);\n    }\n\n    return value || key;\n  };\n\n  return { t, currentLanguage, setLanguage };\n}\n\n// Re-export types for convenience\nexport type { Language, TranslationKey };","size_bytes":1672},"client/src/lib/i18n/translations.ts":{"content":"import { commonTranslations } from './modules/common';\nimport { navigationTranslations } from './modules/navigation';\nimport { attendanceTranslations } from './modules/attendance';\nimport { customersTranslations } from './modules/customers';\nimport { employeesTranslations } from './modules/employees';\nimport { inventoryTranslations } from './modules/inventory';\nimport { notFoundTranslations } from './modules/notFound';\nimport { ordersTranslations } from './modules/orders';\nimport { posTranslations } from './modules/pos';\nimport { reportsTranslations } from './modules/reports';\nimport { settingsTranslations } from './modules/settings';\nimport { tablesTranslations } from './modules/tables';\nimport { einvoiceTranslations } from './modules/einvoice';\nimport { suppliersTranslations } from './modules/suppliers';\nimport type { LanguageTranslations } from './types';\n\nexport const translations: LanguageTranslations = {\n  ko: {\n    common: commonTranslations.ko,\n    nav: navigationTranslations.ko,\n    attendance: attendanceTranslations.ko,\n    customers: customersTranslations.ko,\n    employees: employeesTranslations.ko,\n    inventory: inventoryTranslations.ko,\n    notFound: notFoundTranslations.ko,\n    orders: ordersTranslations.ko,\n    pos: posTranslations.ko,\n    reports: reportsTranslations.ko,\n    settings: settingsTranslations.ko,\n    tables: tablesTranslations.ko,\n    einvoice: einvoiceTranslations.ko,\n    suppliers: suppliersTranslations.ko,\n  },\n  en: {\n    common: commonTranslations.en,\n    nav: navigationTranslations.en,\n    attendance: attendanceTranslations.en,\n    customers: customersTranslations.en,\n    employees: employeesTranslations.en,\n    inventory: inventoryTranslations.en,\n    notFound: notFoundTranslations.en,\n    orders: ordersTranslations.en,\n    pos: posTranslations.en,\n    reports: reportsTranslations.en,\n    settings: settingsTranslations.en,\n    tables: tablesTranslations.en,\n    einvoice: einvoiceTranslations.en,\n    suppliers: suppliersTranslations.en,\n  },\n  vi: {\n    common: commonTranslations.vi,\n    nav: navigationTranslations.vi,\n    attendance: attendanceTranslations.vi,\n    customers: customersTranslations.vi,\n    employees: employeesTranslations.vi,\n    inventory: inventoryTranslations.vi,\n    notFound: notFoundTranslations.vi,\n    orders: ordersTranslations.vi,\n    pos: posTranslations.vi,\n    reports: reportsTranslations.vi,\n    settings: settingsTranslations.vi,\n    tables: tablesTranslations.vi,\n    einvoice: einvoiceTranslations.vi,\n    suppliers: suppliersTranslations.vi,\n  },\n};","size_bytes":2558},"client/src/lib/i18n/types.ts":{"content":"export type Language = \"ko\" | \"en\" | \"vi\";\n\n// Common translations interface\nexport interface CommonTranslations {\n  loading: string;\n  save: string;\n  cancel: string;\n  delete: string;\n  edit: string;\n  add: string;\n  search: string;\n  filter: string;\n  back: string;\n  next: string;\n  previous: string;\n  confirm: string;\n  success: string;\n  error: string;\n  warning: string;\n  info: string;\n  yes: string;\n  no: string;\n  items: string;\n  total: string;\n  subtotal: string;\n  tax: string;\n  discount: string;\n  date: string;\n  time: string;\n  status: string;\n  active: string;\n  submit: string;\n  inactive: string;\n  all: string;\n  none: string;\n  name: string;\n  description: string;\n  price: string;\n  quantity: string;\n  notes: string;\n  notesPlaceholder: string;\n  autoGenerated: string;\n  actions: string;\n  collapse: string;\n  expand: string;\n  restaurant: string;\n  noRecords: string;\n  selectOtherDate: string;\n  category: string;\n  available: string;\n  occupied: string;\n  reserved: string;\n  maintenance: string;\n  clear: string;\n  refresh: string;\n  update: string;\n  updating: string;\n  create: string;\n  creating: string;\n  disabled: string;\n  online: string;\n  reset: string;\n  enabled: string;\n  export: string;\n  import: string;\n  select: string;\n  selectAll: string;\n  showing: string;\n  for: string;\n  noData: string;\n  offline: string;\n  pending: string;\n  approved: string;\n  rejected: string;\n  completed: string;\n  cancelled: string;\n  draft: string;\n  published: string;\n  archived: string;\n  amount: string;\n  type: string;\n  code: string;\n  id: string;\n  email: string;\n  phone: string;\n  address: string;\n  options: string;\n  settings: string;\n  preferences: string;\n  profile: string;\n  account: string;\n  user: string;\n  admin: string;\n  manager: string;\n  employee: string;\n  customer: string;\n  supplier: string;\n  product: string;\n  service: string;\n  order: string;\n  payment: string;\n  invoice: string;\n  receipt: string;\n  report: string;\n  dashboard: string;\n  analytics: string;\n  statistics: string;\n  chart: string;\n  graph: string;\n  table: string;\n  list: string;\n  grid: string;\n  card: string;\n  form: string;\n  field: string;\n  label: string;\n  value: string;\n  key: string;\n  tag: string;\n  badge: string;\n  icon: string;\n  image: string;\n  file: string;\n  document: string;\n  folder: string;\n  link: string;\n  url: string;\n  path: string;\n  route: string;\n  page: string;\n  section: string;\n  header: string;\n  footer: string;\n  sidebar: string;\n  menu: string;\n  navigation: string;\n  breadcrumb: string;\n  tab: string;\n  panel: string;\n  modal: string;\n  dialog: string;\n  popup: string;\n  tooltip: string;\n  dropdown: string;\n  accordion: string;\n  carousel: string;\n  slider: string;\n  progress: string;\n  spinner: string;\n  skeleton: string;\n  placeholder: string;\n  empty: string;\n  notFound: string;\n  error404: string;\n  error500: string;\n  serverError: string;\n  networkError: string;\n  timeout: string;\n  retry: string;\n  reload: string;\n  upgrade: string;\n  download: string;\n  upload: string;\n  print: string;\n  share: string;\n  copy: string;\n  paste: string;\n  cut: string;\n  undo: string;\n  help: string;\n  redo: string;\n  filters: string;\n  logout: string;\n  about: string;\n  count: string;\n  people: string;\n  show: string;\n  rows: string;\n  regularCustomer: string;\n  goldCustomer: string;\n  customerGroup: string;\n  walkInCustomer: string;\n  transfer: string;\n  view: string;\n  backToPOS: string;\n  paid: string;\n  login: string;\n  register: string;\n  username: string;\n  password: string;\n  unavailable: string;\n  city: string;\n  country: string;\n  orderManagement: string;\n  allCategories: string;\n  additionalNotesPlaceholder: string;\n  templateUsage: string;\n  invoiceErrorIssuedDelete: string;\n  tableDeleteConfirm: string;\n  tableDeleteError: string;\n  remove: string;\n\n  // Payment method modal\n  selectPaymentMethod: string;\n  totalAmount: string;\n  cashPayment: string;\n  qrBanking: string;\n  close: string;\n  scanQrPayment: string;\n  amountToPay: string;\n  useBankingApp: string;\n  goBack: string;\n  complete: string;\n  customerAmount: string;\n  enterCustomerAmount: string;\n  change: string;\n  insufficient: string;\n  generatingQr: string;\n\n  // Payment method names\n  cash: string;\n  creditCard: string;\n  debitCard: string;\n  momo: string;\n  zalopay: string;\n  vnpay: string;\n  qrCode: string;\n  shopeepay: string;\n  grabpay: string;\n\n  // Payment method descriptions\n  visaMastercard: string;\n  atmCard: string;\n  momoWallet: string;\n  zalopayWallet: string;\n  vnpayWallet: string;\n  shopeepayWallet: string;\n  grabpayWallet: string;\n  paymentMethodGeneric: string;\n\n  // Combo values\n  comboValues: {\n    // Gender options\n    male: string;\n    female: string;\n    other: string;\n\n    // Size options\n    small: string;\n    medium: string;\n    large: string;\n    extraLarge: string;\n\n    // Priority levels\n    low: string;\n    normal: string;\n    high: string;\n    urgent: string;\n\n    // Order status\n    pending: string;\n    confirmed: string;\n    preparing: string;\n    ready: string;\n    served: string;\n    paid: string;\n    cancelled: string;\n    completed: string;\n\n    // Product types\n    food: string;\n    beverage: string;\n    snack: string;\n    dessert: string;\n\n    // Table status\n    occupied: string;\n    reserved: string;\n    cleaning: string;\n    outOfService: string;\n\n    // Payment status\n    unpaid: string;\n    partiallyPaid: string;\n    fullyPaid: string;\n    refunded: string;\n\n    // Stock levels\n    inStock: string;\n    lowStock: string;\n    outOfStock: string;\n\n    // Employee roles\n    admin: string;\n    manager: string;\n    cashier: string;\n    waiter: string;\n    chef: string;\n    cleaner: string;\n  };\n\n  // Time periods\n  days30: string;\n  days60: string;\n  days90: string;\n  days180: string;\n  days365: string;\n}\n\n// Navigation translations interface\nexport interface NavigationTranslations {\n  pos: string;\n  tables: string;\n  salesOrders: string;\n  inventory: string;\n  reports: string;\n  employees: string;\n  attendance: string;\n  suppliers: string;\n  salesReports: string;\n  inventoryReports: string;\n  expensesReports: string;\n  profitReports: string;\n  tablesSales: string;\n  directSales: string;\n  dashboard: string;\n  salesAnalysis: string;\n  menuAnalysis: string;\n  tableAnalysis: string;\n  salesChart: string;\n  purchaseReport: string;\n  warehouseReport: string;\n  orderReport: string;\n  customerDisplay: string;\n  logout: string;\n}\n\n// Reports translations interface\nexport interface ReportsTranslations {\n  title: string;\n  description: string;\n  dashboard: string;\n  dashboardDescription: string;\n  salesAnalysis: string;\n  periodRevenue: string;\n  occupiedTables: string;\n  monthRevenue: string;\n  inOutInventory: string;\n  detailedInOutInventory: string;\n  disposal: string;\n  profitReportByProduct: string;\n  inventoryValueReport: string;\n  inOutInventoryReport: string;\n  detailedInOutInventoryReport: string;\n  inSupplier: string;\n  inCheck: string;\n  inReturn: string;\n  inTransfer: string;\n  inProduction: string;\n  outSale: string;\n  outDisposal: string;\n  outSupplier: string;\n  outCheck: string;\n  outTransfer: string;\n  outProduction: string;\n  totalDisposed: string;\n  employeeCount: string;\n  quantityPurchased: string;\n  supplierCount: string;\n  inValue: string;\n  disposalReport: string;\n  supplierReportByProduct: string;\n  menuItems: string;\n  itemsSold: string;\n  revenueShare: string;\n  salesShare: string;\n  popularMenuByQuantity: string;\n  popularMenuByQuantityDesc: string;\n  highRevenueMenu: string;\n  highRevenueMenuDesc: string;\n  rank: string;\n  menuName: string;\n  salesCount: string;\n  noCategoryData: string;\n  noSalesData: string;\n  noRevenueData: string;\n  noPaymentDataDescription: string;\n  dineIn: string;\n  takeaway: string;\n  cancelled: string;\n  salePrice: string;\n  saleValue: string;\n  costPrice: string;\n  openingStock: string;\n  openingValue: string;\n  openingPrice: string;\n  closingStock: string;\n  closingValue: string;\n  inQuantity: string;\n  outQuantity: string;\n  outValue: string;\n  realTimeStatus: string;\n  pendingOrders: string;\n  count: string;\n  performanceMetrics: string;\n  menuAnalysis: string;\n  tableAnalysis: string;\n  backToTables: string;\n\n  // Date and time filters\n  startDate: string;\n  endDate: string;\n  refresh: string;\n  toDay: string;\n  lastWeek: string;\n  thisMonth: string;\n  lastMonth: string;\n  custom: string;\n\n  // Dashboard metrics\n  totalRevenue: string;\n  totalOrders: string;\n  totalQuantitySold: string;\n  averageOrderValue: string;\n\n  // Filter options\n  filterByDate: string;\n  dateRange: string;\n\n  // Chart titles\n  dailySalesChart: string;\n  paymentMethodChart: string;\n  hourlyBreakdownChart: string;\n  topProductsChart: string;\n\n  // Payment methods\n  paymentMethodBreakdown: string;\n  paymentMethodDetails: string;\n\n  // Tab names for reports\n  salesAnalysisTab: string;\n  menuAnalysisTab: string;\n  tableAnalysisTab: string;\n  salesChartTab: string;\n  purchaseTab: string;\n  warehouseTab: string;\n  dashboardTab: string;\n\n  // Analysis types\n  analysisType: string;\n  analyzeBy: string;\n  timeAnalysis: string;\n  productAnalysis: string;\n  employeeAnalysis: string;\n  customerAnalysis: string;\n  channelAnalysis: string;\n\n  // Chart and visual\n  chartView: string;\n  visualRepresentation: string;\n\n  // Filter labels\n  salesMethod: string;\n  salesChannel: string;\n  productFilter: string;\n  productFilterPlaceholder: string;\n  customerFilter: string;\n  customerFilterPlaceholder: string;\n\n  // Sales chart table columns\n  date: string;\n  orderNumber: string;\n  subtotal: string;\n  discount: string;\n  revenue: string;\n  tax: string;\n  total: string;\n  totalCustomerPayment: string;\n\n  // Product report columns\n  unit: string;\n  quantitySold: string;\n  totalAmount: string;\n  totalDiscount: string;\n  categoryName: string;\n\n  // Report titles\n  timeSalesReport: string;\n  inventoryReport: string;\n  salesReportByProduct: string;\n  profitByInvoiceReport: string;\n  invoiceDiscountReport: string;\n  returnByInvoiceReport: string;\n\n  // Additional comprehensive keys\n  endOfDayReport: string;\n  endOfDayReportTab: string;\n  revenueExpense: string;\n  mainConcern: string;\n  sales: string;\n  inventory: string;\n  summary: string;\n  dateType: string;\n  singleDate: string;\n  paymentMethodFilter: string;\n  transactionTypeFilter: string;\n  creator: string;\n  employee: string;\n  customerPayment: string;\n  customerRefund: string;\n  otherExpense: string;\n  supplierRefund: string;\n  supplierPayment: string;\n  printReport: string;\n  reportGenerated: string;\n  dataFrom: string;\n  to: string;\n  printOptions: string;\n\n  // Order report\n  orderReport: string;\n  orderReportTab: string;\n  orderReportDescription: string;\n  orderConcernType: string;\n  transactionConcern: string;\n  productConcern: string;\n  orderStatus: string;\n  draft: string;\n  confirmed: string;\n  delivering: string;\n  completed: string;\n  customerSearch: string;\n  customerSearchPlaceholder: string;\n  productSearch: string;\n  productSearchPlaceholder: string;\n\n  // Sales chart report\n  salesChart: string;\n  salesChartDescription: string;\n\n  // Comprehensive sales report\n  comprehensiveSalesReport: string;\n  concernType: string;\n  timeReport: string;\n  profitReport: string;\n  discountReport: string;\n  returnReport: string;\n  employeeReport: string;\n  customerReport: string;\n  supplierReport: string;\n  noDelivery: string;\n  delivery: string;\n  direct: string;\n  other: string;\n  totalCost: string;\n  grossProfit: string;\n  totalInvoices: string;\n  invoiceValue: string;\n  invoiceDiscount: string;\n  returnTicketCount: string;\n  seller: string;\n  saleDate: string;\n  paymentDate: string;\n  fromDate: string;\n  toDate: string;\n  barChart: string;\n  pieChart: string;\n  lineChart: string;\n  dailyRevenue: string;\n  paymentMethodDistribution: string;\n  hourlyRevenue: string;\n  barChartDesc: string;\n  pieChartDesc: string;\n  lineChartDesc: string;\n\n  // Table headers for reports\n  transactionCode: string;\n  time: string;\n  quantity: string;\n  otherRevenue: string;\n  vat: string;\n  actualRevenue: string;\n  receiptCode: string;\n  payerReceiver: string;\n  revenueExpenseType: string;\n  productCode: string;\n  productName: string;\n  soldQuantity: string;\n  returnQuantity: string;\n  returnValue: string;\n  netRevenue: string;\n\n  // Dashboard specific\n  dailySales: string;\n  paymentMethods: string;\n  hourlyBreakdown: string;\n  orders: string;\n  customers: string;\n  cash: string;\n  card: string;\n  credit_card: string;\n  qrbanking: string;\n  einvoice: string;\n  totalSalesRevenue: string;\n\n  // Table analysis specific\n  customerCount: string;\n  turnoverRate: string;\n  topRevenueTables: string;\n  topTurnoverTables: string;\n  topUtilizationTables: string;\n  averageUtilization: string;\n  averageOrdersPerTable: string;\n  allTables: string;\n  cumulativeVisitors: string;\n  totalByTable: string;\n  detailedTablePerformance: string;\n  detailedTablePerformanceDesc: string;\n  currentStatus: string;\n  orderCount: string;\n  peakTime: string;\n  timesPerDay: string;\n  hourUnit: string;\n  timesUnit: string;\n  hour: string;\n  times: string;\n\n  // Menu analysis\n  productPerformance: string;\n  categoryPerformance: string;\n  topSellingItems: string;\n  topRevenueItems: string;\n  categoryBreakdown: string;\n  itemPerformance: string;\n  salesTrend: string;\n  profitMargin: string;\n  costAnalysis: string;\n  stockMovement: string;\n  menuAnalysisDescription: string;\n  bestSellingProducts: string;\n  revenueByCategory: string;\n  productSalesVolume: string;\n  categoryRevenue: string;\n  productRevenue: string;\n  averagePrice: string;\n  totalSales: string;\n  menuItemAnalysis: string;\n  categoryAnalysis: string;\n  productTrends: string;\n  menuPerformanceMetrics: string;\n\n  // Table analysis\n  tablePerformance: string;\n  utilizationRate: string;\n  averageRevenue: string;\n  peakHours: string;\n  tableUtilization: string;\n  revenuePerTable: string;\n  ordersPerTable: string;\n\n  // Sales report specific\n  salesReport: string;\n  salesReportDescription: string;\n  loading: string;\n  noData: string;\n  noPaymentData: string;\n  salesDetails: string;\n  revenueExpenseDetails: string;\n  inventoryDetails: string;\n  noReportData: string;\n  centralBranch: string;\n\n  // Report specific content\n  salesReportTitle: string;\n  revenueReportTitle: string;\n  inventoryReportTitle: string;\n  summaryReportTitle: string;\n\n  // Table detail headers\n  salesDetailsHeader: string;\n  revenueExpenseDetailsHeader: string;\n  inventoryDetailsHeader: string;\n\n  // Additional transaction types\n  totalTransactions: string;\n  income: string;\n  expenses: string;\n  netProfit: string;\n  transactionDetails: string;\n  transactionId: string;\n  method: string;\n  amount: string;\n  notes: string;\n  cashPayment: string;\n  cardPayment: string;\n  transfer: string;\n  wallet: string;\n\n  // Status\n  status: string;\n\n  // Additional report sections\n  detailedAnalysis: string;\n  quickSummary: string;\n  comparisonReport: string;\n  trendsAndInsights: string;\n  performanceIndicators: string;\n  financialMetrics: string;\n  operationalMetrics: string;\n  customerMetrics: string;\n\n  // Financial reports\n  financialReport: string;\n  financialReportDescription: string;\n  profitLoss: string;\n  balanceSheet: string;\n  cashFlow: string;\n\n  // Customer reports\n  customerSalesReport: string;\n  channelSalesReport: string;\n  employeeSalesReport: string;\n\n  // Supplier reports\n  supplierReportDescription: string;\n  purchaseReport: string;\n  supplierPerformance: string;\n  targetAverageDailySales: string;\n\n  // Inventory reports\n  inventoryReportDescription: string;\n  stockLevel: string;\n  stockMovementReport: string;\n  lowStockAlert: string;\n  analyzeRevenue: string;\n  analyzeTableRevenueTrend: string;\n  employeeFilter: string;\n  employeeFilterPlaceholder: string;\n  employeeId: string;\n  customerId: string;\n  customerName: string;\n  vip: string;\n  tableName: string;\n  employeeName: string;\n  productType: string;\n  combo: string;\n  product: string;\n  service: string;\n  newCustomer: string;\n  customer: string;\n  customerCode: string;\n  orderReportByTransaction: string;\n  orderReportByProduct: string;\n  orderCode: string;\n  orderTime: string;\n  inactive: string;\n  searchOrderCode: string;\n  searchTable: string;\n  pending: string;\n  table: string;\n  taxRate: string;\n  taxAmount: string;\n  group: string;\n  note: string;\n  channel: string;\n  totalCustomers: string;\n  tableAnalysisDescription: string;\n  inventoryReportOfInterestType: string;\n  inventoryValue: string;\n  active: string;\n  orderQuantity: string;\n  orderValue: string;\n  unitPrice: string;\n  exportTax: string;\n  vatTax: string;\n  purchaseReportTitle: string;\n  purchaseReportDescription: string;\n  salesDetailReport: string;\n  productGroup: string;\n\n  // Additional menu items\n  warehouseReport: string;\n  salesAchievementRate: string;\n  tableTurnoverRate: string;\n\n  // Chart and filter labels\n  selectDateRange: string;\n  applyFilter: string;\n  clearFilter: string;\n  exportData: string;\n\n  // Data display\n  noDataAvailable: string;\n  loadingData: string;\n  errorLoadingData: string;\n\n  // Warehouse specific\n  warehouseReportTab: string;\n  warehouseReportDescription: string;\n\n  // Additional report keys\n  period: string;\n  noDataDescription: string;\n  monthAccumulated: string;\n  peakHour: string;\n  filters: string;\n  applyFilters: string;\n  resetFilters: string;\n  uniqueProducts: string;\n\n  // Chart specific\n  value: string;\n  chartData: string;\n  xAxis: string;\n  yAxis: string;\n  legend: string;\n  dataPoints: string;\n}\n\n// Not Found translations interface\nexport interface NotFoundTranslations {\n  title: string;\n  description: string;\n  backHome: string;\n  backToHome: string;\n}\n\n// Customers translations interface\nexport interface CustomersTranslations {\n  title: string;\n  description: string;\n  customerManagement: string;\n  addCustomer: string;\n  editCustomer: string;\n  deleteCustomer: string;\n  searchPlaceholder: string;\n  customerId: string;\n  name: string;\n  phone: string;\n  email: string;\n  visitCount: string;\n  totalSpent: string;\n  points: string;\n  noRegisteredCustomers: string;\n  status: string;\n  totalCustomers: string;\n  activeCustomers: string;\n  pointsIssued: string;\n  paymentCustomerSelection: string;\n  pointsUpdated: string;\n  averageSpent: string;\n  customerFormTitle: string;\n  customerFormDesc: string;\n  customerAdded: string;\n  customerUpdated: string;\n  customerDeleted: string;\n  customerError: string;\n  namePlaceholder: string;\n  phonePlaceholder: string;\n  emailPlaceholder: string;\n  addressPlaceholder: string;\n  birthday: string;\n  birthdayPlaceholder: string;\n  gender: string;\n  male: string;\n  female: string;\n  other: string;\n  address: string;\n  gold: string;\n  silver: string;\n  vip: string;\n  total: string;\n  totalCustomersRegistered: string;\n  pointsManagement: string;\n  membershipManagement: string;\n  pointsManagementTitle: string;\n  pointsManagementDesc: string;\n  pointsAdjustment: string;\n  pointsPayment: string;\n  history: string;\n  totalPoints: string;\n  averagePoints: string;\n  customers: string;\n  pointsEditTitle: string;\n  pointsEditDesc: string;\n  customerSelection: string;\n  searchCustomers: string;\n  currentPoints: string;\n  adjustmentType: string;\n  addPoints: string;\n  subtractPoints: string;\n  setPoints: string;\n  pointsToAdd: string;\n  pointsToSubtract: string;\n  pointsToSet: string;\n  adjustmentReason: string;\n  adjustmentReasonPlaceholder: string;\n  processing: string;\n  pointsPaymentTitle: string;\n  pointsPaymentDesc: string;\n  availablePoints: string;\n  pointsToUse: string;\n  pointsToUsePlaceholder: string;\n  insufficientPoints: string;\n  pointsAfterPayment: string;\n  processPayment: string;\n  historyTitle: string;\n  historyDesc: string;\n  loadingHistory: string;\n  noHistory: string;\n  earned: string;\n  redeemed: string;\n  adjusted: string;\n  expired: string;\n  unknown: string;\n  // Membership management\n  membershipManagementTitle: string;\n  membershipManagementDesc: string;\n  membershipTierGuide: string;\n  membershipLevel: string;\n  membershipBenefits: string;\n  minPurchaseAmount: string;\n  basicLevel: string;\n  basicLevelDesc: string;\n  premiumLevel: string;\n  premiumLevelDesc: string;\n  vipLevel: string;\n  vipLevelDesc: string;\n  basicPointsEarning: string;\n  birthdayDiscount5: string;\n  pointsEarning15: string;\n  birthdayDiscount10: string;\n  freeDrinkMonthly: string;\n  pointsEarning2x: string;\n  birthdayDiscount20: string;\n  freeDrink2Monthly: string;\n  vipRoomAccess: string;\n  customerMembershipManagement: string;\n  autoUpgrade: string;\n  filterByTier: string;\n  upgradeAvailable: string;\n  allTiers: string;\n  close: string;\n  pointManagement: string;\n  pointManagementDescription: string;\n  pointOverview: string;\n  updatePoints: string;\n  pointHistory: string;\n  recentPointHistory: string;\n  viewAllHistory: string;\n  transactionType: string;\n  selectTransactionType: string;\n  enterPoints: string;\n  reason: string;\n  enterReason: string;\n  processPoints: string;\n  balance: string;\n  previousBalance: string;\n  noPointHistory: string;\n  pointsUpdateFailed: string;\n  pointsUpdateError: string;\n}\n\n// Employees translations interface\nexport interface EmployeesTranslations {\n  title: string;\n  description: string;\n  employeeManagement: string;\n  total: string;\n  employeeList: string;\n  confirmDelete: string;\n  saving: string;\n  save: string;\n  add: string;\n  currentEmployeeCount: string;\n  updateEmployeeSuccess: string;\n  updateEmployeeError: string;\n  addEmployeeSuccess: string;\n  addEmployee: string;\n  editEmployee: string;\n  deleteEmployee: string;\n  searchPlaceholder: string;\n  employeeId: string;\n  name: string;\n  role: string;\n  phone: string;\n  email: string;\n  status: string;\n  hireDate: string;\n  salary: string;\n  department: string;\n  position: string;\n  employeeFormTitle: string;\n  employeeFormDesc: string;\n  employeeAdded: string;\n  employeeUpdated: string;\n  employeeDeleted: string;\n  employeeError: string;\n  namePlaceholder: string;\n  phonePlaceholder: string;\n  emailPlaceholder: string;\n  addEmployeeError: string;\n  salaryPlaceholder: string;\n  roles: {\n    admin: string;\n    manager: string;\n    cashier: string;\n    kitchen: string;\n    server: string;\n  };\n  active: string;\n  inactive: string;\n  deleteSuccess: string;\n  deleteError: string;\n  emailAlreadyExists: string;\n  emailAlreadyInSystem: string;\n  selectRole: string;\n  employeeIdRequired: string;\n  nameRequired: string;\n  emailInvalid: string;\n  noEmployeesFound: string;\n}\n\n// Attendance translations interface\nexport interface AttendanceTranslations {\n  title: string;\n  description: string;\n  clockInOut: string;\n  attendanceRecords: string;\n  statistics: string;\n  clockIn: string;\n  clockOut: string;\n  breakStart: string;\n  breakEnd: string;\n  selectEmployee: string;\n  notes: string;\n  recordsDescription: string;\n  selectedDate: string;\n  unknownEmployee: string;\n  noRecords: string;\n  selectOtherDate: string;\n  clockInTime: string;\n  clockOutTime: string;\n  breakTime: string;\n  totalHours: string;\n  overtime: string;\n  employeeSelect: string;\n  currentStatus: string;\n  refresh: string;\n  qrAttendance: string;\n  qrCodeTitle: string;\n  qrCodeDescription: string;\n  qrCodeInstructions: string;\n  urlCopy: string;\n  copySuccess: string;\n  copySuccessDesc: string;\n  breakEndSuccess: string;\n  breakEndSuccessDesc: string;\n  breakEndError: string;\n  loading: string;\n  noAttendanceData: string;\n  selectEmployeeFirst: string;\n  invalidEmployee: string;\n  alreadyClockedIn: string;\n  notClockedIn: string;\n  alreadyOnBreak: string;\n  notOnBreak: string;\n  confirmClockOut: string;\n  confirmBreakStart: string;\n  confirmBreakEnd: string;\n  processing: string;\n  attendanceHistory: string;\n  weeklyView: string;\n  monthlyView: string;\n  filterByEmployee: string;\n  exportData: string;\n  printReport: string;\n  status: {\n    present: string;\n    absent: string;\n    late: string;\n    halfDay: string;\n    working: string;\n    onBreak: string;\n    clockedOut: string;\n  };\n  clockInSuccess: string;\n  clockInSuccessDesc: string;\n  clockInError: string;\n  clockOutSuccess: string;\n  clockOutSuccessDesc: string;\n  clockOutError: string;\n  breakStartSuccess: string;\n  breakStartSuccessDesc: string;\n  breakStartError: string;\n  hours: string;\n  minutes: string;\n  notesPlaceholder: string;\n  workingTime: string;\n  monthPickerPlaceholder: string;\n  monthlyStats: string;\n  monthlyStatsDesc: string;\n  selectMonth: string;\n  totalWorkDays: string;\n  totalAttendance: string;\n  totalWorkHours: string;\n  totalOvertime: string;\n  averageWorkHours: string;\n  dailyAverageWorkHours: string;\n  attendanceRate: string;\n  overallAttendanceRate: string;\n  employeeStats: string;\n  employeeStatsDesc: string;\n  workDays: string;\n  days: string;\n  overtimeHours: string;\n  lateCount: string;\n  absentCount: string;\n  times: string;\n}\n\n// Main translations interface\nexport interface OrdersTranslations {\n  orderManagement: string;\n  orderDetails: string;\n  orderNumber: string;\n  orderFailed: string;\n  orderInfo: string;\n  orderItems: string;\n  orderStatus: string;\n  orderTime: string;\n  orderStatusUpdated: string;\n  orderStatusUpdateFailed: string;\n  viewDetails: string;\n  confirm: string;\n  startCooking: string;\n  ready: string;\n  served: string;\n  table: string;\n  customer: string;\n  customerCount: string;\n  customerName: string;\n  noCustomerName: string;\n  people: string;\n  unknownTable: string;\n  unknownProduct: string;\n  memo: string;\n  totalAmount: string;\n  subtotal: string;\n  tax: string;\n  statusAndTime: string;\n  realTimeOrderStatus: string;\n  ordersInProgress: string;\n  noActiveOrders: string;\n  newOrdersWillAppearHere: string;\n  noTableInfo: string;\n  selectPaymentMethod: string;\n  selectPaymentMethodDesc: string;\n  cancel: string;\n  pointsPaymentTitle: string;\n  pointsPaymentDesc: string;\n  searchCustomers: string;\n  availablePoints: string;\n  mixedPaymentTitle: string;\n  mixedPaymentCancel: string;\n  mixedPaymentDesc: string;\n  mixedPaymentSummary: string;\n  totalOrder: string;\n  pointsPayment: string;\n  remainingAmount: string;\n  addMore: string;\n  editOrder: string;\n  editOrderTitle: string;\n  editOrderDesc: string;\n  addNewItems: string;\n  previouslyOrdered: string;\n  alreadyOrdered: string;\n  newItemsToAdd: string;\n  itemsAndNewItems: string;\n  previousItems: string;\n  newItems: string;\n  updateOrder: string;\n  updating: string;\n  orderUpdateSuccess: string;\n  orderUpdateSuccessDesc: string;\n  updateAndRefresh: string;\n  noInput: string;\n  pointsPaymentDialog: {\n    title: string;\n    description: string;\n    orderInfo: string;\n    orderCode: string;\n    totalAmount: string;\n    searchCustomer: string;\n    searchPlaceholder: string;\n    accumulatedPoints: string;\n    mixedPayment: string;\n  };\n  paymentMethods: {\n    cash: string;\n    creditCard: string;\n    debitCard: string;\n    momo: string;\n    zalopay: string;\n    vnpay: string;\n    qrCode: string;\n    shopeepay: string;\n    grabpay: string;\n  };\n  payment: string;\n  tableOrder: string;\n  tableCapacity: string;\n  orderPlaced: string;\n  orderPlacedSuccess: string;\n  status: {\n    pending: string;\n    confirmed: string;\n    preparing: string;\n    ready: string;\n    served: string;\n    paid: string;\n    cancelled: string;\n    delivering: string;\n    completed: string;\n  };\n}\n\n// Inventory translations interface\nexport interface InventoryTranslations {\n  title: string;\n  description: string;\n  totalProducts: string;\n  lowStock: string;\n  outOfStock: string;\n  totalValue: string;\n  searchProducts: string;\n  stockStatus: string;\n  allStock: string;\n  inStock: string;\n  productName: string;\n  currentStock: string;\n  unitPrice: string;\n  stockValue: string;\n  management: string;\n  edit: string;\n  stockUpdate: string;\n  loading: string;\n  noProducts: string;\n  uncategorized: string;\n  currentStockLabel: string;\n  stockUpdateType: string;\n  quantity: string;\n  notesOptional: string;\n  selectUpdateType: string;\n  addStock: string;\n  subtractStock: string;\n  setStock: string;\n  quantityInput: string;\n  changeReason: string;\n  processing: string;\n  addNewItem: string;\n  newProduct: string;\n  productNameLabel: string;\n  productNamePlaceholder: string;\n  skuLabel: string;\n  skuPlaceholder: string;\n  priceLabel: string;\n  pricePlaceholder: string;\n  categoryLabel: string;\n  categoryPlaceholder: string;\n  initialStockQuantity: string;\n  initialStockPlaceholder: string;\n  stockQuantity: string;\n  editReason: string;\n  addNewStock: string;\n  save: string;\n  updateType: string;\n  delete: string;\n  confirmDelete: string;\n  deleteFailed: string;\n  deleteFailedDescription: string;\n  deleteSuccess: string;\n  deleteSuccessDescription: string;\n  createFailed: string;\n  createFailedDescription: string;\n  createSuccess: string;\n  createSuccessDescription: string;\n  updateFailed: string;\n  updateFailedDescription: string;\n  updateSuccess: string;\n  updateSuccessDescription: string;\n  duplicateSku: string;\n  duplicateSkuDescription: string;\n  quantityMinError: string;\n  trackInventory: string;\n}\n\n// E-Invoice translations interface\nexport interface EInvoiceTranslations {\n  title: string;\n  description: string;\n  invoiceNumber: string;\n  providerUnit: string;\n  providerInfo: string;\n  invoiceDate: string;\n  customerInfo: string;\n  selectProvider: string;\n  invoiceTemplate: string;\n  selectTemplate: string;\n  taxCode: string;\n  getInfo: string;\n  billingAddress: string;\n  address: string;\n  idNumber: string;\n  recipient: string;\n  email: string;\n  publish: string;\n  newOrder: string;\n  shippingAddress: string;\n  items: string;\n  quantity: string;\n  unitPrice: string;\n  amount: string;\n  subtotal: string;\n  taxAmount: string;\n  totalAmount: string;\n  paymentDetails: string;\n  paymentMethod: string;\n  paymentStatus: string;\n  generated: string;\n  paid: string;\n  unpaid: string;\n  viewInvoice: string;\n  downloadInvoice: string;\n  sendInvoice: string;\n  invoiceGeneratedSuccess: string;\n  invoiceGeneratedError: string;\n  invoiceSentSuccess: string;\n  invoiceSentError: string;\n  invoiceDownloadError: string;\n  addInvoiceItem: string;\n  editInvoiceItem: string;\n  deleteInvoiceItemConfirm: string;\n  invoiceItemAdded: string;\n  invoiceItemUpdated: string;\n  invoiceItemDeleted: string;\n  invoiceItemError: string;\n  itemNamePlaceholder: string;\n  itemDescriptionPlaceholder: string;\n  quantityPlaceholder: string;\n  unitPricePlaceholder: string;\n  customerNamePlaceholder: string;\n  billingAddressPlaceholder: string;\n  shippingAddressPlaceholder: string;\n  selectPaymentMethod: string;\n  selectStatus: string;\n  printInvoice: string;\n  printPreview: string;\n  saveAsDraft: string;\n  send: string;\n  preview: string;\n  generate: string;\n  customerDetails: string;\n  billingDetails: string;\n  shippingDetails: string;\n  invoiceDetails: string;\n  productName: string;\n  itemCode: string;\n  unit: string;\n  total: string;\n  discount: string;\n  taxRate: string;\n  taxDetails: string;\n  additionalCharges: string;\n  notes: string;\n  termsAndConditions: string;\n  companyName: string;\n  companyAddress: string;\n  companyPhone: string;\n  companyEmail: string;\n  companyTaxId: string;\n  customerSignature: string;\n  authorizedSignature: string;\n  thankYouMessage: string;\n  noInvoiceData: string;\n  generating: string;\n  sending: string;\n  downloading: string;\n  searchPlaceholder: string;\n  invoiceList: string;\n  filter: string;\n  sort: string;\n  invoiceNumberPlaceholder: string;\n  dateFrom: string;\n  dateTo: string;\n  statusFilter: string;\n  paymentMethodFilter: string;\n  view: string;\n  download: string;\n  sendEmail: string;\n  print: string;\n  edit: string;\n  delete: string;\n  confirmDeleteInvoice: string;\n  invoiceDeletedSuccess: string;\n  invoiceDeletedError: string;\n  filterOptions: string;\n  selectDateRange: string;\n  applyFilter: string;\n  resetFilter: string;\n  invalidInvoiceNumber: string;\n  invalidCustomerInfo: string;\n  invalidBillingAddress: string;\n  invalidShippingAddress: string;\n  invalidItemDetails: string;\n  invalidPaymentDetails: string;\n  enterItemName: string;\n  enterQuantity: string;\n  enterUnitPrice: string;\n  enterCustomerName: string;\n  enterBillingAddress: string;\n  enterShippingAddress: string;\n  enterPaymentMethod: string;\n  enterStatus: string;\n  enterNotes: string;\n  enterTerms: string;\n  updateInvoiceItem: string;\n  addInvoice: string;\n  createInvoice: string;\n  newInvoice: string;\n  invoiceFormTitle: string;\n  invoiceFormDescription: string;\n  invoiceAddedSuccess: string;\n  invoiceUpdatedSuccess: string;\n  invoiceError: string;\n  selectProduct: string;\n  noProductsFound: string;\n  customerOrderHistory: string;\n  invoiceHistory: string;\n  selectCustomer: string;\n  selectCustomerPlaceholder: string;\n  addCustomer: string;\n  editCustomer: string;\n  addBillingAddress: string;\n  addShippingAddress: string;\n  manageCustomers: string;\n  manageAddresses: string;\n  updateInvoice: string;\n  saveInvoice: string;\n  processing: string;\n  loading: string;\n  noData: string;\n  noDataDescription: string;\n  updateSuccess: string;\n  updateError: string;\n  addSuccess: string;\n  addError: string;\n  deleteSuccess: string;\n  deleteError: string;\n  printPreviewError: string;\n  cancel: string;\n  publishing: string;\n  checkout: string;\n}\n\n// POS translations interface\nexport interface POSTranslations {\n  title: string;\n  description: string;\n  orderManagement: string;\n  currentOrder: string;\n  menu: string;\n  categories: string;\n  items: string;\n  search: string;\n  addToOrder: string;\n  quantity: string;\n  price: string;\n  notes: string;\n  notesPlaceholder: string;\n  orderSummary: string;\n  subtotal: string;\n  tax: string;\n  total: string;\n  payment: string;\n  checkout: string;\n  pay: string;\n  cash: string;\n  card: string;\n  momo: string;\n  zalopay: string;\n  vnpay: string;\n  qrbanking: string;\n  shopeepay: string;\n  grabpay: string;\n  points: string;\n  cashPayment: string;\n  cardPayment: string;\n  momoPayment: string;\n  zalopayPayment: string;\n  vnpayPayment: string;\n  qrbankingPayment: string;\n  shopeepayPayment: string;\n  grabpayPayment: string;\n  pointsPayment: string;\n  mixedPayment: string;\n  selectPaymentMethod: string;\n  selectPaymentMethodDesc: string;\n  paymentSuccess: string;\n  paymentFailed: string;\n  orderPlaced: string;\n  orderPlacedSuccess: string;\n  orderPlacedFailed: string;\n  newOrder: string;\n  editOrder: string;\n  cancelOrder: string;\n  confirmCancelOrder: string;\n  orderCancelled: string;\n  orderCancelledFailed: string;\n  printReceipt: string;\n  printPreview: string;\n  holdOrder: string;\n  holdOrderSuccess: string;\n  holdOrderFailed: string;\n  retrieveOrder: string;\n  noHeldOrders: string;\n  placeOrder: string;\n  updateOrder: string;\n  updating: string;\n  orderUpdateSuccess: string;\n  orderUpdateSuccessDesc: string;\n  orderUpdateFailed: string;\n  addItems: string;\n  removeItems: string;\n  changeQuantity: string;\n  applyChanges: string;\n  noItemsInOrder: string;\n  customer: string;\n  selectCustomer: string;\n  selectCustomerPlaceholder: string;\n  addCustomer: string;\n  customerAddedSuccess: string;\n  customerAddedFailed: string;\n  customerUpdatedSuccess: string;\n  customerUpdatedFailed: string;\n  table: string;\n  selectTable: string;\n  selectTablePlaceholder: string;\n  addTable: string;\n  tableAddedSuccess: string;\n  tableAddedFailed: string;\n  tableUpdatedSuccess: string;\n  tableUpdatedFailed: string;\n  menuItemDetails: string;\n  itemDetails: string;\n  itemDescription: string;\n  itemPrice: string;\n  itemQuantity: string;\n  itemNotes: string;\n  itemNotesPlaceholder: string;\n  itemRemove: string;\n  itemEdit: string;\n  orderId: string;\n  orderTime: string;\n  orderStatus: string;\n  orderStatusUpdated: string;\n  orderStatusUpdateFailed: string;\n  processing: string;\n  loading: string;\n  noData: string;\n  noDataDescription: string;\n  updateSuccess: string;\n  updateError: string;\n  addSuccess: string;\n  addError: string;\n  deleteSuccess: string;\n  deleteError: string;\n  quantityMinError: string;\n  invalidItem: string;\n  invalidCustomer: string;\n  invalidTable: string;\n  invalidPayment: string;\n  confirmPayment: string;\n  confirmPaymentDesc: string;\n  orderTotal: string;\n  amountPaid: string;\n  changeDue: string;\n  close: string;\n  print: string;\n  receiptPreview: string;\n  thankYouMessage: string;\n  duplicateItem: string;\n  itemAlreadyInOrder: string;\n  addAnotherItem: string;\n  selectCategory: string;\n  selectCategoryPlaceholder: string;\n  viewOrder: string;\n  orderInprogress: string;\n  noActiveOrders: string;\n  newOrdersWillAppearHere: string;\n  orderSummaryDesc: string;\n  applyDiscount: string;\n  discountPlaceholder: string;\n  invalidDiscount: string;\n  discountApplied: string;\n  discountRemoved: string;\n  clearDiscount: string;\n  editItem: string;\n  editItemTitle: string;\n  editItemDescription: string;\n  editItemPrice: string;\n  editItemQuantity: string;\n  editItemNotes: string;\n  editItemNotesPlaceholder: string;\n  saveChanges: string;\n  cancelEditing: string;\n  remove: string;\n  confirmRemoveItem: string;\n  itemRemoved: string;\n  itemRemoveFailed: string;\n  clearOrder: string;\n  confirmClearOrder: string;\n  orderCleared: string;\n  orderClearFailed: string;\n  stickyFooter: string;\n  stickyFooterDescription: string;\n  stickyFooterOrderUpdated: string;\n  stickyFooterOrderUpdateFailed: string;\n  stickyFooterOrderPlaced: string;\n  stickyFooterOrderPlaceFailed: string;\n}\n\n// Suppliers translations interface\nexport interface SuppliersTranslations {\n  title: string;\n  description: string;\n  addSupplier: string;\n  editSupplier: string;\n  deleteSupplier: string;\n  searchPlaceholder: string;\n  name: string;\n  contactPerson: string;\n  phone: string;\n  email: string;\n  address: string;\n  paymentTerms: string;\n  active: string;\n  inactive: string;\n  noSuppliers: string;\n  confirmDelete: string;\n  deleteSuccess: string;\n  deleteSuccessDesc: string;\n  deleteFailed: string;\n  deleteFailedDesc: string;\n  addDescription: string;\n  editDescription: string;\n  code: string;\n  codePlaceholder: string;\n  namePlaceholder: string;\n  contactPersonPlaceholder: string;\n  phonePlaceholder: string;\n  emailPlaceholder: string;\n  addressPlaceholder: string;\n  taxId: string;\n  taxIdPlaceholder: string;\n  bankAccount: string;\n  bankAccountPlaceholder: string;\n  cash: string;\n  notes: string;\n  notesPlaceholder: string;\n  status: string;\n  createSuccess: string;\n  createSuccessDesc: string;\n  createFailed: string;\n  createFailedDesc: string;\n  updateSuccess: string;\n  updateSuccessDesc: string;\n  updateFailed: string;\n  updateFailedDesc: string;\n  validationError: string;\n  requiredFields: string;\n}\n\nexport interface TablesTranslations {\n  title: string;\n  description: string;\n  tableManagement: string;\n  addTable: string;\n  editTable: string;\n  deleteTable: string;\n  searchPlaceholder: string;\n  tableNumber: string;\n  capacity: string;\n  status: string;\n  actions: string;\n  noTables: string;\n  confirmDelete: string;\n  tableNumberRequired: string;\n  capacityMinimum: string;\n  tableUpdateError: string;\n  tableCreated: string;\n  tableUpdated: string;\n  tableDeleted: string;\n  tableError: string;\n  tableNumberPlaceholder: string;\n  capacityPlaceholder: string;\n  available: string;\n  occupied: string;\n  reserved: string;\n  maintenance: string;\n  cleaning: string;\n  outOfService: string;\n  selectStatus: string;\n  addTableSuccess: string;\n  addTableError: string;\n  updateTableSuccess: string;\n  updateTableError: string;\n  deleteTableSuccess: string;\n  deleteTableError: string;\n  duplicateTableNumber: string;\n  tableNumberAlreadyExists: string;\n  backToPOS: string;\n  tableStatus: string;\n  orderManagement: string;\n  tableSettings: string;\n  tableSettingsDesc: string;\n  tableCapacity: string;\n  qrCode: string;\n  qrCodePlaceholder: string;\n  tableCreateSuccess: string;\n  tableUpdateSuccess: string;\n  tableDeleteSuccess: string;\n  deleteConfirm: string;\n\n  totalTables: string;\n  availableTables: string;\n  occupiedTables: string;\n  cleanupComplete: string;\n  selectMenuToOrder: string;\n  customerName: string;\n  optional: string;\n  customerNamePlaceholder: string;\n  customerCount: string;\n  allCategories: string;\n  stockCount: string;\n  orderHistory: string;\n  itemsSelected: string;\n  noItemsSelected: string;\n  specialRequests: string;\n  subtotalLabel: string;\n  taxLabel: string;\n  totalLabel: string;\n  placing: string;\n  placeOrder: string;\n  tableList: string;\n  tableNumberLabel: string;\n  capacityLabel: string;\n  statusLabel: string;\n  qrCodeLabel: string;\n  createdDate: string;\n  none: string;\n  imageUrl: string;\n  productNamePlaceholder: string;\n  skuPlaceholder: string;\n  subtotal: string;\n  tax: string;\n  total: string;\n  paymentMethod: string;\n  cash: string;\n  card: string;\n  deleteOrder: string;\n  amountReceived: string;\n  change: string;\n  completeSale: string;\n  confirmDeleteProduct: string;\n  productNameRequired: string;\n  skuRequired: string;\n  categoryRequired: string;\n  productType: string;\n  selectProductType: string;\n  productTypeRequired: string;\n  goodsType: string;\n  materialType: string;\n  finishedProductType: string;\n  imageUrlOptional: string;\n  unitPrice: string;\n  taxRate: string;\n  productName: string;\n  editProduct: string;\n  productManagement: string;\n  addNewProduct: string;\n  bulkImport: string;\n  export: string;\n  product: string;\n  sku: string;\n  category: string;\n  price: string;\n  stock: string;\n  productTypeLabel: string;\n  productTypePlaceholder: string;\n  addTableDesc: string;\n  deleteorder: string;\n}\n\n// Type-safe translation keys\nexport type TranslationKey =\n  | `common.${keyof CommonTranslations}`\n  | `nav.${keyof NavigationTranslations}`\n  | `nav.${keyof TablesTranslations}`\n  | `inventory.${keyof InventoryTranslations}`\n  | `orders.${keyof OrdersTranslations}`\n  | `employees.${keyof EmployeesTranslations}`\n  | `attendance.${keyof AttendanceTranslations}`\n  | `settings.${keyof SettingsTranslations}`\n  | `customers.${keyof CustomersTranslations}`\n  | `reports.${keyof ReportsTranslations}`\n  | `notFound.${keyof NotFoundTranslations}`\n  | `einvoice.${keyof EInvoiceTranslations}`\n  | `pos.${keyof POSTranslations}`\n  | `suppliers.${keyof SuppliersTranslations}`;\n\n// Language-specific translations type\nexport interface LanguageTranslations {\n  common: CommonTranslations;\n  nav: NavigationTranslations;\n  attendance: AttendanceTranslations;\n  customers: CustomersTranslations;\n  employees: EmployeesTranslations;\n  inventory: InventoryTranslations;\n  notFound: NotFoundTranslations;\n  orders: OrdersTranslations;\n  pos: PosTranslations;\n  reports: ReportsTranslations;\n  settings: SettingsTranslations;\n  tables: TablesTranslations;\n  einvoice: EinvoiceTranslations;\n  suppliers: SuppliersTranslations;\n}\n","size_bytes":42691},"client/src/lib/i18n/modules/attendance.ts":{"content":"import type { AttendanceTranslations } from '../types';\n\nexport const attendanceTranslations: { [key: string]: AttendanceTranslations } = {\n  ko: {\n    title: '출근 관리',\n    description: '직원 출근을 관리합니다',\n    clockInOut: '출퇴근',\n    attendanceRecords: '출근 기록',\n    statistics: '통계',\n    clockIn: '출근',\n    clockOut: '퇴근',\n    breakStart: '휴식 시작',\n    breakEnd: '휴식 종료',\n    selectEmployee: '직원 선택',\n    notes: '메모',\n    recordsDescription: '일일 출근 기록 확인',\n    selectedDate: '선택된 날짜',\n    unknownEmployee: '알 수 없는 직원',\n    noRecords: '기록이 없습니다',\n    selectOtherDate: '다른 날짜를 선택해주세요',\n    clockInTime: '출근 시간',\n    clockOutTime: '퇴근 시간',\n    breakTime: '휴식 시간',\n    totalHours: '총 근무시간',\n    overtime: '초과근무',\n    employeeSelect: '직원 선택',\n    currentStatus: '현재 상태',\n    refresh: '새로고침',\n    qrAttendance: 'QR 출근체크',\n    qrCodeTitle: 'QR 출근체크 코드',\n    qrCodeDescription: 'QR 코드를 스캔하여 빠른 출근체크',\n    qrCodeInstructions: '휴대폰 카메라로 이 QR 코드를 스캔하여 출근체크 페이지에 접속하세요',\n    urlCopy: 'URL 복사',\n    copySuccess: '복사 완료',\n    copySuccessDesc: 'URL이 클립보드에 복사되었습니다',\n    breakStartSuccessDesc: '휴식이 시작되었습니다',\n    breakStartError: '휴식 시작 오류',\n    hours: '시간',\n    minutes: '분',\n    notesPlaceholder: '메모를 입력하세요',\n    workingTime: '근무 시간',\n    monthlyStats: '근태 통계',\n    monthlyStatsDesc: '월별 근태 현황과 직원별 통계를 확인합니다.',\n    selectMonth: '월 선택',\n    monthPickerPlaceholder: '월을 선택하세요',\n    totalWorkDays: '총 근무일',\n    totalAttendance: '총 출근 횟수',\n    totalWorkHours: '총 근무시간',\n    totalOvertime: '총 초과근무',\n    averageWorkHours: '평균 근무시간',\n    dailyAverageWorkHours: '일일 평균 근무시간',\n    attendanceRate: '출근율',\n    overallAttendanceRate: '전체 직원 평균 출근율',\n    employeeStats: '직원별 통계',\n    employeeStatsDesc: '각 직원의 근태 현황을 자세히 확인할 수 있습니다.',\n    workDays: '근무 일수',\n    days: '일',\n    overtimeHours: '초과근무',\n    lateCount: '지각',\n    absentCount: '결근',\n    times: '회',\n  },\n  en: {\n    title: 'Attendance Management',\n    description: 'Manage employee attendance',\n    clockInOut: 'Clock In/Out',\n    attendanceRecords: 'Attendance Records',\n    statistics: 'Statistics',\n    clockIn: 'Clock In',\n    clockOut: 'Clock Out',\n    breakStart: 'Start Break',\n    breakEnd: 'End Break',\n    selectEmployee: 'Select Employee',\n    notes: 'Notes',\n    recordsDescription: 'View daily attendance records',\n    selectedDate: 'Selected Date',\n    unknownEmployee: 'Unknown Employee',\n    noRecords: 'No records found',\n    selectOtherDate: 'Please select another date',\n    clockInTime: 'Clock In Time',\n    clockOutTime: 'Clock Out Time',\n    breakTime: 'Break Time',\n    totalHours: 'Total Hours',\n    overtime: 'Overtime',\n    employeeSelect: 'Select Employee',\n    currentStatus: 'Current Status',\n    refresh: 'Refresh',\n    qrAttendance: 'QR Attendance',\n    qrCodeTitle: 'QR Attendance Code',\n    qrCodeDescription: 'Scan QR code for quick attendance',\n    qrCodeInstructions: 'Scan this QR code with your phone camera to access the attendance page',\n    urlCopy: 'Copy URL',\n    copySuccess: 'Copied',\n    copySuccessDesc: 'URL has been copied to clipboard',\n    breakStartSuccessDesc: 'Break has been started',\n    breakStartError: 'Error starting break',\n    hours: 'hours',\n    minutes: 'minutes',\n    notesPlaceholder: 'Enter notes',\n    workingTime: 'Working Time',\n    monthlyStats: 'Attendance Statistics',\n    monthlyStatsDesc: 'View monthly attendance status and employee statistics.',\n    selectMonth: 'Select Month',\n    monthPickerPlaceholder: 'Select a month',\n    totalWorkDays: 'Total Work Days',\n    totalAttendance: 'Total Attendance',\n    totalWorkHours: 'Total Work Hours',\n    totalOvertime: 'Total Overtime',\n    averageWorkHours: 'Average Work Hours',\n    dailyAverageWorkHours: 'Daily Average Work Hours',\n    attendanceRate: 'Attendance Rate',\n    overallAttendanceRate: 'Overall Employee Attendance Rate',\n    employeeStats: 'Employee Statistics',\n    employeeStatsDesc: 'View detailed attendance status for each employee.',\n    workDays: 'Work Days',\n    days: 'days',\n    overtimeHours: 'Overtime',\n    lateCount: 'Late',\n    absentCount: 'Absent',\n    times: 'times',\n  },\n  vi: {\n    title: 'Quản lý chấm công',\n    description: 'Quản lý chấm công nhân viên',\n    clockInOut: 'Chấm công',\n    attendanceRecords: 'Bản ghi chấm công',\n    statistics: 'Thống kê',\n    clockIn: 'Vào ca',\n    clockOut: 'Tan ca',\n    breakStart: 'Bắt đầu nghỉ',\n    breakEnd: 'Kết thúc nghỉ',\n    selectEmployee: 'Chọn nhân viên',\n    notes: 'Ghi chú',\n    recordsDescription: 'Xem bản ghi chấm công hàng ngày',\n    selectedDate: 'Ngày đã chọn',\n    unknownEmployee: 'Nhân viên không xác định',\n    clockInSuccess: 'Chấm công vào thành công',\n    clockInSuccessDesc: 'Đã ghi nhận chấm công vào thành công',\n    clockInError: 'Lỗi chấm công vào',\n    clockOutSuccess: 'Chấm công ra thành công',\n    clockOutSuccessDesc: 'Đã ghi nhận chấm công ra thành công',\n    clockOutError: 'Lỗi chấm công ra',\n    breakStartSuccess: 'Bắt đầu nghỉ',\n    breakStartSuccessDesc: 'Đã bắt đầu thời gian nghỉ',\n    breakStartError: 'Lỗi bắt đầu nghỉ',\n    breakEndSuccess: 'Kết thúc nghỉ',\n    breakEndSuccessDesc: 'Đã kết thúc thời gian nghỉ',\n    breakEndError: 'Lỗi kết thúc nghỉ',\n    hours: 'giờ',\n    minutes: 'phút',\n    notesPlaceholder: 'Nhập ghi chú',\n    workingTime: 'Thời gian làm việc',\n    monthlyStats: 'Thống kê chấm công',\n    monthlyStatsDesc: 'Xem tình hình chấm công hàng tháng và thống kê nhân viên.',\n    selectMonth: 'Chọn tháng',\n    monthPickerPlaceholder: 'Chọn một tháng',\n    totalWorkDays: 'Tổng ngày làm việc',\n    totalAttendance: 'Tổng lần chấm công',\n    totalWorkHours: 'Tổng giờ làm việc',\n    totalOvertime: 'Tổng giờ làm thêm',\n    averageWorkHours: 'Giờ làm việc trung bình',\n    dailyAverageWorkHours: 'Giờ làm việc trung bình hàng ngày',\n    attendanceRate: 'Tỷ lệ chấm công',\n    overallAttendanceRate: 'Tỷ lệ chấm công trung bình toàn nhân viên',\n    employeeStats: 'Thống kê nhân viên',\n    employeeStatsDesc: 'Xem chi tiết tình hình chấm công của từng nhân viên.',\n    workDays: 'Ngày làm việc',\n    days: 'ngày',\n    overtimeHours: 'Làm thêm giờ',\n    lateCount: 'Trễ',\n    absentCount: 'Vắng mặt',\n    times: 'lần',\n    // Additional translations for UI/UX improvements\n    noRecords: 'Không có bản ghi nào',\n    selectOtherDate: 'Vui lòng chọn ngày khác',\n    clockInTime: 'Giờ vào ca',\n    clockOutTime: 'Giờ tan ca',\n    breakTime: 'Thời gian nghỉ',\n    totalHours: 'Tổng giờ làm',\n    overtime: 'Làm thêm giờ',\n    employeeSelect: 'Chọn nhân viên',\n    currentStatus: 'Trạng thái hiện tại',\n    refresh: 'Làm mới',\n    qrAttendance: 'Chấm công QR',\n    qrCodeTitle: 'Mã QR chấm công',\n    qrCodeDescription: 'Quét mã QR để chấm công nhanh',\n    qrCodeInstructions: 'Quét mã QR này bằng camera điện thoại để truy cập trang chấm công',\n    urlCopy: 'Sao chép URL',\n    copySuccess: 'Đã sao chép',\n    copySuccessDesc: 'URL đã được sao chép vào clipboard',\n\n    // Additional missing keys for attendance management\n    loading: 'Đang tải...',\n    noAttendanceData: 'Không có dữ liệu chấm công',\n    selectEmployeeFirst: 'Vui lòng chọn nhân viên trước',\n    invalidEmployee: 'Nhân viên không hợp lệ',\n    alreadyClockedIn: 'Nhân viên đã chấm công vào',\n    notClockedIn: 'Nhân viên chưa chấm công vào',\n    alreadyOnBreak: 'Nhân viên đang trong giờ nghỉ',\n    notOnBreak: 'Nhân viên không trong giờ nghỉ',\n    confirmClockOut: 'Xác nhận chấm công ra?',\n    confirmBreakStart: 'Xác nhận bắt đầu nghỉ?',\n    confirmBreakEnd: 'Xác nhận kết thúc nghỉ?',\n    processing: 'Đang xử lý...',\n    attendanceHistory: 'Lịch sử chấm công',\n    weeklyView: 'Xem theo tuần',\n    monthlyView: 'Xem theo tháng',\n    filterByEmployee: 'Lọc theo nhân viên',\n    exportData: 'Xuất dữ liệu',\n    printReport: 'In báo cáo',\n    status: {\n      present: 'Có mặt',\n      absent: 'Vắng mặt',\n      late: 'Trễ',\n      halfDay: 'Nửa ngày',\n      working: 'Đang làm việc',\n      onBreak: 'Đang nghỉ',\n      clockedOut: 'Đã tan ca',\n    },\n  },\n};","size_bytes":9063},"client/src/lib/i18n/modules/common.ts":{"content":"import type { CommonTranslations } from \"../types\";\n\nexport const commonTranslations: { [key: string]: CommonTranslations } = {\n  ko: {\n    loading: \"로딩 중...\",\n    save: \"저장\",\n    cancel: \"취소\",\n    delete: \"삭제\",\n    edit: \"편집\",\n    add: \"추가\",\n    search: \"검색\",\n    confirm: \"확인\",\n    yes: \"예\",\n    no: \"아니오\",\n    success: \"성공\",\n    error: \"오류\",\n    warning: \"경고\",\n    info: \"정보\",\n    close: \"닫기\",\n    open: \"열기\",\n    back: \"뒤로\",\n    next: \"다음\",\n    previous: \"이전\",\n    submit: \"제출\",\n    reset: \"재설정\",\n    clear: \"지우기\",\n    select: \"선택\",\n    all: \"모두\",\n    none: \"없음\",\n    total: \"총계\",\n    subtotal: \"소계\",\n    available: \"사용 가능\",\n    occupied: \"사용 중\",\n    reserved: \"예약됨\",\n    maintenance: \"정비 중\",\n    active: \"활성\",\n    inactive: \"비활성\",\n    enabled: \"활성화\",\n    disabled: \"비활성화\",\n    online: \"온라인\",\n    offline: \"오프라인\",\n    pending: \"대기 중\",\n    approved: \"승인됨\",\n    rejected: \"거부됨\",\n    completed: \"완료됨\",\n    cancelled: \"취소됨\",\n    draft: \"초안\",\n    published: \"게시됨\",\n    archived: \"보관됨\",\n    name: \"이름\",\n    description: \"설명\",\n    price: \"가격\",\n    quantity: \"수량\",\n    amount: \"금액\",\n    date: \"날짜\",\n    time: \"시간\",\n    category: \"카테고리\",\n    status: \"상태\",\n    type: \"유형\",\n    code: \"코드\",\n    id: \"ID\",\n    email: \"이메일\",\n    phone: \"전화번호\",\n    address: \"주소\",\n    notes: \"메모\",\n    notesPlaceholder: \"메모를 입력하세요\",\n    autoGenerated: \"Auto Generated\",\n    actions: \"작업\",\n    options: \"옵션\",\n    settings: \"설정\",\n    preferences: \"환경설정\",\n    profile: \"프로필\",\n    account: \"계정\",\n    user: \"사용자\",\n    admin: \"관리자\",\n    manager: \"매니저\",\n    employee: \"직원\",\n    customer: \"고객\",\n    supplier: \"공급업체\",\n    product: \"상품\",\n    service: \"서비스\",\n    order: \"주문\",\n    payment: \"결제\",\n    invoice: \"송장\",\n    receipt: \"영수증\",\n    report: \"보고서\",\n    dashboard: \"대시보드\",\n    analytics: \"분석\",\n    statistics: \"통계\",\n    chart: \"차트\",\n    graph: \"그래프\",\n    table: \"테이블\",\n    list: \"목록\",\n    grid: \"그리드\",\n    card: \"카드\",\n    form: \"폼\",\n    field: \"필드\",\n    label: \"라벨\",\n    value: \"값\",\n    key: \"키\",\n    tag: \"태그\",\n    badge: \"배지\",\n    icon: \"아이콘\",\n    image: \"이미지\",\n    file: \"파일\",\n    document: \"문서\",\n    folder: \"폴더\",\n    link: \"링크\",\n    url: \"URL\",\n    path: \"경로\",\n    route: \"라우트\",\n    page: \"페이지\",\n    section: \"섹션\",\n    header: \"헤더\",\n    footer: \"푸터\",\n    sidebar: \"사이드바\",\n    menu: \"메뉴\",\n    navigation: \"네비게이션\",\n    breadcrumb: \"브레드크럼\",\n    tab: \"탭\",\n    panel: \"패널\",\n    modal: \"모달\",\n    dialog: \"다이얼로그\",\n    popup: \"팝업\",\n    tooltip: \"툴팁\",\n    dropdown: \"드롭다운\",\n    accordion: \"아코디언\",\n    carousel: \"캐러셀\",\n    slider: \"슬라이더\",\n    progress: \"진행률\",\n    spinner: \"스피너\",\n    skeleton: \"스켈레톤\",\n    placeholder: \"플레이스홀더\",\n    empty: \"비어있음\",\n    noData: \"데이터가 없습니다\",\n    notFound: \"찾을 수 없음\",\n    error404: \"404 오류\",\n    error500: \"500 오류\",\n    serverError: \"서버 오류\",\n    networkError: \"네트워크 오류\",\n    timeout: \"시간 초과\",\n    retry: \"다시 시도\",\n    refresh: \"새로고침\",\n    reload: \"다시 로드\",\n    update: \"업데이트\",\n    updating: \"업데이트 중...\",\n    collapse: \"접기\",\n    upgrade: \"업그레이드\",\n    download: \"다운로드\",\n    upload: \"업로드\",\n    import: \"가져오기\",\n    export: \"내보내기\",\n    print: \"인쇄\",\n    share: \"공유\",\n    copy: \"복사\",\n    paste: \"붙여넣기\",\n    cut: \"잘라내기\",\n    undo: \"실행 취소\",\n    redo: \"다시 실행\",\n    filters: \"필터\",\n    items: \"개\",\n    count: \"개수\",\n    people: \"명\",\n    showing: \"표시\",\n    for: \"~에 대한\",\n    show: \"표시\",\n    rows: \"행\",\n    regularCustomer: \"일반고객\",\n    goldCustomer: \"골드고객\",\n    customerGroup: \"고객 그룹\",\n    walkInCustomer: \"일반 고객\",\n    backToPOS: \"POS로 돌아가기\",\n\n    // Payment method modal\n    selectPaymentMethod: \"결제 방법 선택\",\n    totalAmount: \"총 금액\",\n    cashPayment: \"현금 결제\",\n    qrBanking: \"QR 뱅킹\",\n    scanQrPayment: \"QR 코드를 스캔하여 결제\",\n    amountToPay: \"결제할 금액\",\n    useBankingApp: \"은행 앱을 사용하여 QR 코드를 스캔하고 결제하세요\",\n    goBack: \"뒤로\",\n    complete: \"완료\",\n    customerAmount: \"고객이 낸 금액\",\n    enterCustomerAmount: \"고객이 낸 금액을 입력하세요\",\n    change: \"거스름돈\",\n    insufficient: \"부족\",\n    generatingQr: \"QR 생성 중...\",\n\n    // Payment method names\n    cash: \"현금\",\n    creditCard: \"신용카드\",\n    debitCard: \"체크카드\",\n    transfer: \"계좌이체\",\n    momo: \"모모\",\n    zalopay: \"잘로페이\",\n    vnpay: \"VN페이\",\n    qrCode: \"QR 코드\",\n    shopeepay: \"쇼피페이\",\n    grabpay: \"그랩페이\",\n\n    // Payment method descriptions\n    visaMastercard: \"비자/마스터카드\",\n    atmCard: \"ATM 카드\",\n    momoWallet: \"MoMo 전자지갑\",\n    zalopayWallet: \"ZaloPay 전자지갑\",\n    vnpayWallet: \"VNPay 전자지갑\",\n    shopeepayWallet: \"ShopeePay 전자지갑\",\n    grabpayWallet: \"GrabPay 전자지갑\",\n    paymentMethodGeneric: \"결제 방법\",\n    paid: \"결제 완료\",\n\n    // Subtotal\n    subtotalLabel: \"소계:\",\n\n    // Usage status\n    usageStatus: \"사용 상태:\",\n\n    // E-invoice status\n    einvoiceStatus: \"전자세금계산서 상태:\",\n\n    // Combo values\n    comboValues: {\n      // Gender options\n      male: \"남성\",\n      female: \"여성\",\n      other: \"기타\",\n\n      // Size options\n      small: \"소\",\n      medium: \"중\",\n      large: \"대\",\n      extraLarge: \"특대\",\n\n      // Priority levels\n      low: \"낮음\",\n      normal: \"보통\",\n      high: \"높음\",\n      urgent: \"긴급\",\n\n      // Order status\n      pending: \"대기 중\",\n      confirmed: \"확인됨\",\n      preparing: \"준비 중\",\n      ready: \"준비 완료\",\n      served: \"서빙됨\",\n      paid: \"결제 완료\",\n      cancelled: \"취소됨\",\n      completed: \"완료\",\n\n      // Product types\n      food: \"음식\",\n      beverage: \"음료\",\n      snack: \"간식\",\n      dessert: \"디저트\",\n\n      // Table status\n      occupied: \"사용 중\",\n      reserved: \"예약됨\",\n      cleaning: \"정소 중\",\n      outOfService: \"서비스 중단\",\n\n      // Payment status\n      unpaid: \"미결제\",\n      partiallyPaid: \"부분 결제\",\n      fullyPaid: \"완전 결제\",\n      refunded: \"환불됨\",\n\n      // Stock levels\n      inStock: \"재고 있음\",\n      lowStock: \"재고 부족\",\n      outOfStock: \"재고 없음\",\n\n      // Employee roles\n      admin: \"관리자\",\n      manager: \"매니저\",\n      cashier: \"계산원\",\n      waiter: \"웨이터\",\n      chef: \"요리사\",\n      cleaner: \"청소원\",\n    },\n\n    // Time periods\n    days30: \"30일\",\n    days60: \"60일\",\n    days90: \"90일\",\n    days180: \"180일\",\n    days365: \"365일\",\n  },\n  en: {\n    loading: \"Loading...\",\n    save: \"Save\",\n    cancel: \"Cancel\",\n    delete: \"Delete\",\n    edit: \"Edit\",\n    add: \"Add\",\n    confirm: \"Confirm\",\n    yes: \"Yes\",\n    no: \"No\",\n    close: \"Close\",\n    back: \"Back\",\n    next: \"Next\",\n    previous: \"Previous\",\n    search: \"Search\",\n    filter: \"Filter\",\n    all: \"All\",\n    none: \"None\",\n    select: \"Select\",\n    clear: \"Clear\",\n    refresh: \"Refresh\",\n    update: \"Update\",\n    updating: \"Updating...\",\n    create: \"Create\",\n    creating: \"Creating...\",\n    reset: \"Reset\",\n    view: \"View\",\n    download: \"Download\",\n    collapse: \"Collapse\",\n    upload: \"Upload\",\n    import: \"Import\",\n    export: \"Export\",\n    print: \"Print\",\n    share: \"Share\",\n    copy: \"Copy\",\n    paste: \"Paste\",\n    cut: \"Cut\",\n    undo: \"Undo\",\n    redo: \"Redo\",\n    help: \"Help\",\n    about: \"About\",\n    settings: \"Settings\",\n    profile: \"Profile\",\n    logout: \"Logout\",\n    login: \"Login\",\n    register: \"Register\",\n    username: \"Username\",\n    password: \"Password\",\n    email: \"Email\",\n    name: \"Name\",\n    phone: \"Phone\",\n    address: \"Address\",\n    city: \"City\",\n    country: \"Country\",\n    date: \"Date\",\n    time: \"Time\",\n    price: \"Price\",\n    quantity: \"Quantity\",\n    total: \"Total\",\n    subtotal: \"Subtotal\",\n    tax: \"Tax\",\n    discount: \"Discount\",\n    items: \" items\",\n    category: \"Category\",\n    status: \"Status\",\n    active: \"Active\",\n    inactive: \"Inactive\",\n    enabled: \"Enabled\",\n    disabled: \"Disabled\",\n    available: \"Available\",\n    unavailable: \"Unavailable\",\n    occupied: \"Occupied\",\n    reserved: \"Reserved\",\n    maintenance: \"Maintenance\",\n    noData: \"No data available\",\n    count: \"Count\",\n    people: \"People\",\n    table: \"Table\",\n    orderManagement: \"Order Management\",\n    allCategories: \"All Categories\",\n    notes: \"Notes\",\n    notesPlaceholder: \"Enter notes\",\n    additionalNotesPlaceholder: \"Additional notes (optional)\",\n    templateUsage: \"Usage Status\",\n    autoGenerated: \"Auto Generated\",\n    actions: \"Action\",\n    invoiceErrorIssuedDelete:\n      \"Cannot delete an invoice that has already been issued.\",\n    success: \"Success\",\n    error: \"Error\",\n    warning: \"Warning\",\n    info: \"Information\",\n    restaurant: \"Restaurant\",\n    tableDeleteConfirm: \"Are you sure you want to delete this table?\",\n    tableDeleteError: \"Cannot delete a table that has been used.\",\n    showing: \"Showing\",\n    for: \"for\",\n    show: \"Show\",\n    rows: \"rows\",\n    page: \"Page\",\n    regularCustomer: \"Regular Customer\",\n    goldCustomer: \"Gold Customer\",\n    customerGroup: \"Customer Group\",\n    walkInCustomer: \"Walk-in Customer\",\n    backToPOS: \"Back to POS\",\n    description: \"Description\",\n\n    // Payment method modal\n    selectPaymentMethod: \"Select Payment Method\",\n    totalAmount: \"Total Amount\",\n    cashPayment: \"Cash Payment\",\n    qrBanking: \"QR Banking\",\n    scanQrPayment: \"Scan QR Code to Pay\",\n    amountToPay: \"Amount to Pay\",\n    useBankingApp: \"Use your banking app to scan the QR code and make payment\",\n    goBack: \"Go Back\",\n    complete: \"Complete\",\n    customerAmount: \"Amount Received\",\n    enterCustomerAmount: \"Enter amount received from customer\",\n    change: \"Change\",\n    insufficient: \"Insufficient\",\n    generatingQr: \"Generating QR...\",\n\n    // Payment method names\n    cash: \"Cash\",\n    creditCard: \"Credit Card\",\n    debitCard: \"Debit Card\",\n    transfer: \"Bank Transfer\",\n    momo: \"MoMo\",\n    zalopay: \"ZaloPay\",\n    vnpay: \"VNPay\",\n    qrCode: \"QR Code\",\n    shopeepay: \"ShopeePay\",\n    grabpay: \"GrabPay\",\n\n    // Payment method descriptions\n    visaMastercard: \"Visa/Mastercard\",\n    atmCard: \"ATM Card\",\n    momoWallet: \"MoMo Wallet\",\n    zalopayWallet: \"ZaloPay Wallet\",\n    vnpayWallet: \"VNPay Wallet\",\n    shopeepayWallet: \"ShopeePay Wallet\",\n    grabpayWallet: \"GrabPay Wallet\",\n    paymentMethodGeneric: \"Payment Method\",\n    paid: \"Paid\",\n\n    // Subtotal\n    subtotalLabel: \"Subtotal:\",\n\n    // Usage status\n    usageStatus: \"Usage Status:\",\n\n    // E-invoice status\n    einvoiceStatus: \"E-Invoice Status:\",\n\n    // Combo values\n    comboValues: {\n      // Gender options\n      male: \"Male\",\n      female: \"Female\",\n      other: \"Other\",\n\n      // Size options\n      small: \"Small\",\n      medium: \"Medium\",\n      large: \"Large\",\n      extraLarge: \"Extra Large\",\n\n      // Priority levels\n      low: \"Low\",\n      normal: \"Normal\",\n      high: \"High\",\n      urgent: \"Urgent\",\n\n      // Order status\n      pending: \"Pending\",\n      confirmed: \"Confirmed\",\n      preparing: \"Preparing\",\n      ready: \"Ready\",\n      served: \"Served\",\n      paid: \"Paid\",\n      cancelled: \"Cancelled\",\n      completed: \"Completed\",\n\n      // Product types\n      food: \"Food\",\n      beverage: \"Beverage\",\n      snack: \"Snack\",\n      dessert: \"Dessert\",\n\n      // Table status\n      occupied: \"Occupied\",\n      reserved: \"Reserved\",\n      cleaning: \"Cleaning\",\n      outOfService: \"Out of Service\",\n\n      // Payment status\n      unpaid: \"Unpaid\",\n      partiallyPaid: \"Partially Paid\",\n      fullyPaid: \"Fully Paid\",\n      refunded: \"Refunded\",\n\n      // Stock levels\n      inStock: \"In Stock\",\n      lowStock: \"Low Stock\",\n      outOfStock: \"Out of Stock\",\n\n      // Employee roles\n      admin: \"Administrator\",\n      manager: \"Manager\",\n      cashier: \"Cashier\",\n      waiter: \"Waiter\",\n      chef: \"Chef\",\n      cleaner: \"Cleaner\",\n    },\n\n    // Time periods\n    days30: \"30 days\",\n    days60: \"60 days\",\n    days90: \"90 days\",\n    days180: \"180 days\",\n    days365: \"365 days\",\n  },\n  vi: {\n    loading: \"Đang tải...\",\n    save: \"Lưu\",\n    cancel: \"Hủy\",\n    delete: \"Xóa\",\n    edit: \"Chỉnh sửa\",\n    add: \"Thêm\",\n    remove: \"Xóa\",\n    confirm: \"Xác nhận\",\n    yes: \"Có\",\n    no: \"Không\",\n    close: \"Đóng\",\n    back: \"Quay lại\",\n    next: \"Tiếp theo\",\n    previous: \"Trước\",\n    search: \"Tìm kiếm\",\n    filter: \"Lọc\",\n    all: \"Tất cả\",\n    none: \"Không có\",\n    select: \"Chọn\",\n    clear: \"Xóa\",\n    refresh: \"Làm mới\",\n    update: \"Cập nhật\",\n    updating: \"Đang cập nhật...\",\n    create: \"Tạo\",\n    creating: \"Đang tạo...\",\n    reset: \"Đặt lại\",\n    view: \"Xem\",\n    download: \"Tải xuống\",\n    collapse: \"Thu gọn\",\n    upload: \"Tải lên\",\n    import: \"Nhập\",\n    export: \"Xuất\",\n    print: \"In\",\n    share: \"Chia sẻ\",\n    copy: \"Sao chép\",\n    paste: \"Dán\",\n    cut: \"Cắt\",\n    undo: \"Hoàn tác\",\n    redo: \"Làm lại\",\n    help: \"Trợ giúp\",\n    about: \"Thông tin\",\n    settings: \"Cài đặt\",\n    profile: \"Hồ sơ\",\n    logout: \"Đăng xuất\",\n    login: \"Đăng nhập\",\n    register: \"Đăng ký\",\n    username: \"Tên người dùng\",\n    password: \"Mật khẩu\",\n    email: \"Email\",\n    name: \"Tên\",\n    phone: \"Số điện thoại\",\n    address: \"Địa chỉ\",\n    city: \"Thành phố\",\n    country: \"Quốc gia\",\n    date: \"Ngày\",\n    time: \"Thời gian\",\n    price: \"Giá\",\n    quantity: \"Số lượng\",\n    total: \"Tổng cộng\",\n    subtotal: \"Tạm tính\",\n    tax: \"Thuế\",\n    discount: \"Giảm giá\",\n    items: \" mục\",\n    category: \"Danh mục\",\n    status: \"Trạng thái\",\n    active: \"Hoạt động\",\n    inactive: \"Không hoạt động\",\n    enabled: \"Đã bật\",\n    disabled: \"Đã tắt\",\n    available: \"Có sẵn\",\n    unavailable: \"Không có sẵn\",\n    occupied: \"Đã có khách\",\n    reserved: \"Đã đặt\",\n    maintenance: \"Bảo trì\",\n    noData: \"Không có dữ liệu\",\n    count: \"Số\",\n    people: \"Người\",\n    table: \"Bàn\",\n    orderManagement: \"Quản lý đơn hàng\",\n    allCategories: \"Tất cả danh mục\",\n    notes: \"Ghi chú\",\n    notesPlaceholder: \"Nhập ghi chú\",\n    additionalNotesPlaceholder: \"Ghi chú thêm (tùy chọn)\",\n    templateUsage: \"Trạng thái sử dụng\",\n    autoGenerated: \"Tự động tạo\",\n    actions: \"Thao tác\",\n    invoiceErrorIssuedDelete: \"Không thể xóa hóa đơn đã được phát hành.\",\n    success: \"Thành công\",\n    error: \"Lỗi\",\n    warning: \"Cảnh báo\",\n    info: \"Thông tin\",\n    restaurant: \"Nhà hàng\",\n    tableDeleteConfirm: \"Bạn có chắc chắn muốn xóa bàn này?\",\n    tableDeleteError: \"Không thể xóa bàn đã được sử dụng.\",\n    showing: \"Hiển thị\",\n    for: \"cho\",\n    show: \"Hiển thị\",\n    rows: \"dòng\",\n    page: \"Trang\",\n    regularCustomer: \"Khách hàng thường\",\n    goldCustomer: \"Khách hàng vàng\",\n    customerGroup: \"Nhóm khách hàng\",\n    walkInCustomer: \"Khách lẻ\",\n    backToPOS: \"Quay lại POS\",\n    description: \"Mô tả\",\n\n    // Payment method modal\n    selectPaymentMethod: \"Chọn phương thức thanh toán\",\n    totalAmount: \"Tổng tiền\",\n    cashPayment: \"Thanh toán tiền mặt\",\n    qrBanking: \"QR Banking\",\n    scanQrPayment: \"Quét mã QR để thanh toán\",\n    amountToPay: \"Số tiền cần thanh toán\",\n    useBankingApp: \"Sử dụng ứng dụng ngân hàng để quét mã QR và thanh toán\",\n    goBack: \"Quay lại\",\n    complete: \"Hoàn thành\",\n    customerAmount: \"Số tiền khách đưa\",\n    enterCustomerAmount: \"Nhập số tiền khách đưa\",\n    change: \"Tiền thối\",\n    insufficient: \"Không đủ\",\n    generatingQr: \"Đang tạo mã QR...\",\n\n    // Payment method names\n    cash: \"Tiền mặt\",\n    creditCard: \"Thẻ tín dụng\",\n    debitCard: \"Thẻ ghi nợ\",\n    transfer: \"Chuyển khoản\",\n    momo: \"MoMo\",\n    zalopay: \"ZaloPay\",\n    vnpay: \"VNPay\",\n    qrCode: \"Mã QR\",\n    shopeepay: \"ShopeePay\",\n    grabpay: \"GrabPay\",\n\n    // Payment method descriptions\n    visaMastercard: \"Visa/Mastercard\",\n    atmCard: \"Thẻ ATM\",\n    momoWallet: \"Ví MoMo\",\n    zalopayWallet: \"ZaloPay Wallet\",\n    vnpayWallet: \"VNPay Wallet\",\n    shopeepayWallet: \"ShopeePay Wallet\",\n    grabpayWallet: \"GrabPay Wallet\",\n    paymentMethodGeneric: \"Phương thức thanh toán\",\n    paid: \"Đã thanh toán\",\n\n    // Subtotal\n    subtotalLabel: \"Tổng phụ:\",\n\n    // Usage status\n    usageStatus: \"Trạng thái sử dụng:\",\n\n    // E-invoice status\n    einvoiceStatus: \"Trạng thái hóa đơn điện tử:\",\n\n    // Combo values\n    comboValues: {\n      // Gender options\n      male: \"Nam\",\n      female: \"Nữ\",\n      other: \"Khác\",\n\n      // Size options\n      small: \"Nhỏ\",\n      medium: \"Vừa\",\n      large: \"Lớn\",\n      extraLarge: \"Cực lớn\",\n\n      // Priority levels\n      low: \"Thấp\",\n      normal: \"Bình thường\",\n      high: \"Cao\",\n      urgent: \"Khẩn cấp\",\n\n      // Order status\n      pending: \"Đang chờ\",\n      confirmed: \"Đã xác nhận\",\n      preparing: \"Đang chuẩn bị\",\n      ready: \"Sẵn sàng\",\n      served: \"Đã phục vụ\",\n      paid: \"Đã thanh toán\",\n      cancelled: \"Đã hủy\",\n      completed: \"Hoàn thành\",\n\n      // Product types\n      food: \"Thức ăn\",\n      beverage: \"Đồ uống\",\n      snack: \"Đồ ăn nhẹ\",\n      dessert: \"Tráng miệng\",\n\n      // Table status\n      occupied: \"Đã có khách\",\n      reserved: \"Đã đặt\",\n      cleaning: \"Đang dọn dẹp\",\n      outOfService: \"Ngừng phục vụ\",\n\n      // Payment status\n      unpaid: \"Chưa thanh toán\",\n      partiallyPaid: \"Thanh toán một phần\",\n      fullyPaid: \"Đã thanh toán đủ\",\n      refunded: \"Đã hoàn tiền\",\n\n      // Stock levels\n      inStock: \"Còn hàng\",\n      lowStock: \"Sắp hết hàng\",\n      outOfStock: \"Hết hàng\",\n\n      // Employee roles\n      admin: \"Quản trị viên\",\n      manager: \"Quản lý\",\n      cashier: \"Thu ngân\",\n      waiter: \"Phục vụ\",\n      chef: \"Đầu bếp\",\n      cleaner: \"Nhân viên vệ sinh\",\n\n      // Time periods\n      days30: \"30 ngày\",\n      days60: \"60 ngày\",\n      days90: \"90 ngày\",\n      days180: \"180 ngày\",\n      days365: \"365 ngày\",\n    },\n  },\n};","size_bytes":19036},"client/src/lib/i18n/modules/customers.ts":{"content":"import type { CustomersTranslations } from \"../types\";\n\nexport const customersTranslations: { [key: string]: CustomersTranslations } = {\n  ko: {\n    title: \"고객 관리\",\n    description: \"고객 정보를 관리합니다\",\n    customerManagement: \"고객 관리\",\n    addCustomer: \"고객 추가\",\n    editCustomer: \"고객 수정\",\n    deleteCustomer: \"고객 삭제\",\n    searchPlaceholder: \"고객명, 고객ID, 전화번호로 검색\",\n    customerId: \"고객 ID\",\n    name: \"이름\",\n    phone: \"전화번호\",\n    email: \"이메일\",\n    visitCount: \"방문 횟수\",\n    totalSpent: \"총 구매액\",\n    points: \"포인트\",\n    status: \"상태\",\n    totalCustomers: \"총 고객 수\",\n    activeCustomers: \"활성 고객\",\n    pointsIssued: \"발급된 포인트\",\n    averageSpent: \"평균 구매액\",\n    customerFormTitle: \"고객 정보\",\n    customerFormDesc: \"고객 정보를 입력하세요\",\n    customerAdded: \"고객이 추가되었습니다\",\n    customerUpdated: \"고객 정보가 업데이트되었습니다\",\n    customerDeleted: \"고객이 삭제되었습니다\",\n    customerError: \"고객 처리 중 오류가 발생했습니다\",\n    namePlaceholder: \"고객명을 입력하세요\",\n    phonePlaceholder: \"전화번호를 입력하세요\",\n    emailPlaceholder: \"이메일을 입력하세요\",\n    addressPlaceholder: \"주소를 입력하세요\",\n    birthday: \"생년월일\",\n    birthdayPlaceholder: \"생년월일을 선택하세요\",\n    gender: \"성별\",\n    male: \"남성\",\n    female: \"여성\",\n    other: \"기타\",\n    address: \"주소\",\n    gold: \"Vàng\",\n    silver: \"Bạc\",\n    vip: \"Vip\",\n    total: \"총\",\n    totalCustomersRegistered: \"고객이 등록됨\",\n    pointsManagement: \"포인트 관리\",\n    membershipManagement: \"멤버십 관리\",\n    pointsManagementTitle: \"포인트 관리\",\n    pointsManagementDesc: \"고객 포인트를 관리하고 사용 내역을 확인하세요\",\n    pointsAdjustment: \"포인트 조정\",\n    pointsPayment: \"포인트 결제\",\n    history: \"사용 내역\",\n    totalPoints: \"총 포인트\",\n    averagePoints: \"평균 포인트\",\n    customers: \"명\",\n    pointsEditTitle: \"포인트 편집 및 조정\",\n    pointsEditDesc: \"고객의 포인트를 추가, 차감 또는 설정할 수 있습니다\",\n    customerSelection: \"고객 선택\",\n    searchCustomers: \"고객명, ID, 전화번호로 검색...\",\n    currentPoints: \"현재 포인트\",\n    adjustmentType: \"조정 유형\",\n    addPoints: \"포인트 추가\",\n    subtractPoints: \"포인트 차감\",\n    setPoints: \"포인트 설정\",\n    pointsToAdd: \"추가할 포인트\",\n    pointsToSubtract: \"차감할 포인트\",\n    pointsToSet: \"설정할 포인트\",\n    adjustmentReason: \"조정 사유\",\n    adjustmentReasonPlaceholder: \"포인트 조정 사유를 입력하세요\",\n    processing: \"처리 중...\",\n    pointsPaymentTitle: \"포인트 결제\",\n    pointsPaymentDesc: \"고객의 포인트를 사용하여 결제를 처리합니다\",\n    paymentCustomerSelection: \"결제 고객 선택\",\n    availablePoints: \"사용 가능 포인트\",\n    pointsToUse: \"사용할 포인트\",\n    pointsToUsePlaceholder: \"사용할 포인트 입력\",\n    insufficientPoints: \"포인트가 부족합니다\",\n    pointsAfterPayment: \"결제 후 남은 포인트\",\n    processPayment: \"포인트 결제 처리\",\n    historyTitle: \"포인트 사용 내역\",\n    historyDesc: \"모든 포인트 거래 내역을 확인할 수 있습니다\",\n    loadingHistory: \"내역을 불러오는 중...\",\n    noHistory: \"포인트 사용 내역이 없습니다\",\n    earned: \"적립\",\n    redeemed: \"사용\",\n    adjusted: \"조정\",\n    expired: \"만료\",\n    unknown: \"알 수 없음\",\n    // Membership management\n    membershipManagementTitle: \"멤버십 관리\",\n    membershipManagementDesc: \"고객 멤버십 등급을 관리하고 혜택을 제공하세요\",\n    membershipTierGuide: \"멤버십 등급 안내\",\n    membershipLevel: \"멤버십 등급\",\n    membershipBenefits: \"혜택\",\n    minPurchaseAmount: \"최소 구매금액\",\n    basicLevel: \"기본 등급\",\n    basicLevelDesc: \"신규 고객을 위한 기본 등급\",\n    premiumLevel: \"프리미엄 등급\", \n    premiumLevelDesc: \"단골 고객을 위한 고급 등급\",\n    vipLevel: \"VIP 등급\",\n    vipLevelDesc: \"VIP 고객을 위한 최고 등급\",\n    basicPointsEarning: \"기본 포인트 적립\",\n    birthdayDiscount5: \"생일 할인 5%\",\n    pointsEarning15: \"포인트 적립 1.5배\",\n    birthdayDiscount10: \"생일 할인 10%\", \n    freeDrinkMonthly: \"월 1회 무료 음료\",\n    pointsEarning2x: \"포인트 적립 2배\",\n    birthdayDiscount20: \"생일 할인 20%\",\n    freeDrink2Monthly: \"월 2회 무료 음료\",\n    vipRoomAccess: \"VIP룸 이용 가능\",\n    customerMembershipManagement: \"고객 멤버십 관리\",\n    autoUpgrade: \"자동 등급 조정\",\n    filterByTier: \"등급별 필터\",\n    upgradeAvailable: \"승급 가능\",\n    allTiers: \"전체\",\n    close: \"닫기\",\n    pointsUpdated: \"포인트가 업데이트되었습니다\",\n    pointManagement: \"포인트 관리\",\n    pointManagementDescription: \"고객의 포인트 현황을 확인하고 포인트를 추가하거나 사용할 수 있습니다\",\n    pointOverview: \"포인트 현황\",\n    updatePoints: \"포인트 수정\",\n    pointHistory: \"포인트 내역\",\n    recentPointHistory: \"최근 포인트 내역\",\n    viewAllHistory: \"전체 내역 보기\",\n    transactionType: \"거래 유형\",\n    selectTransactionType: \"거래 유형을 선택하세요\",\n    enterPoints: \"포인트를 입력하세요\",\n    reason: \"사유\",\n    enterReason: \"사유를 입력하세요\",\n    processPoints: \"포인트 처리\",\n    balance: \"잔액\",\n    previousBalance: \"이전 잔액\",\n    noPointHistory: \"포인트 내역이 없습니다\",\n    pointsUpdateFailed: \"포인트 업데이트 실패\",\n    pointsUpdateError: \"포인트 업데이트 중 오류가 발생했습니다\",\n    noRegisteredCustomers: \"등록된 고객이 없습니다\",\n  },\n  en: {\n    title: \"Customer Management\",\n    description: \"Manage customer information\",\n    customerManagement: \"Customer Management\",\n    addCustomer: \"Add Customer\",\n    editCustomer: \"Edit Customer\",\n    deleteCustomer: \"Delete Customer\",\n    searchPlaceholder: \"Search by name, customer ID, or phone\",\n    customerId: \"Customer ID\",\n    name: \"Name\",\n    phone: \"Phone\",\n    email: \"Email\",\n    visitCount: \"Visit Count\",\n    totalSpent: \"Total Spent\",\n    points: \"Points\",\n    status: \"Status\",\n    totalCustomers: \"Total Customers\",\n    activeCustomers: \"Active Customers\",\n    pointsIssued: \"Points Issued\",\n    averageSpent: \"Average Spent\",\n    customerFormTitle: \"Customer Information\",\n    customerFormDesc: \"Enter customer information\",\n    customerAdded: \"Customer added successfully\",\n    customerUpdated: \"Customer updated successfully\",\n    customerDeleted: \"Customer deleted successfully\",\n    customerError: \"Error processing customer\",\n    namePlaceholder: \"Enter customer name\",\n    phonePlaceholder: \"Enter phone number\",\n    emailPlaceholder: \"Enter email address\",\n    addressPlaceholder: \"Enter address\",\n    birthday: \"Birthday\",\n    birthdayPlaceholder: \"Select birthday\",\n    gender: \"Gender\",\n    male: \"Male\",\n    female: \"Female\",\n    other: \"Other\",\n    address: \"Address\",\n    gold: \"Vàng\",\n    silver: \"Bạc\",\n    vip: \"Vip\",\n    total: \"Total\",\n    totalCustomersRegistered: \"customers registered\",\n    pointsManagement: \"Points Management\",\n    membershipManagement: \"Membership Management\",\n    pointsManagementTitle: \"Points Management\",\n    pointsManagementDesc: \"Manage customer points and view usage history\",\n    pointsAdjustment: \"Points Adjustment\",\n    pointsPayment: \"Points Payment\",\n    history: \"Usage History\",\n    totalPoints: \"Total Points\",\n    averagePoints: \"Average Points\",\n    customers: \"customers\",\n    pointsEditTitle: \"Points Edit and Adjustment\",\n    pointsEditDesc: \"You can add, subtract or set customer points\",\n    customerSelection: \"Customer Selection\",\n    searchCustomers: \"Search by name, ID, phone number...\",\n    currentPoints: \"Current Points\",\n    adjustmentType: \"Adjustment Type\",\n    addPoints: \"Add Points\",\n    subtractPoints: \"Subtract Points\",\n    setPoints: \"Set Points\",\n    pointsToAdd: \"Points to Add\",\n    pointsToSubtract: \"Points to Subtract\",\n    pointsToSet: \"Points to Set\",\n    adjustmentReason: \"Adjustment Reason\",\n    adjustmentReasonPlaceholder: \"Enter points adjustment reason\",\n    processing: \"Processing...\",\n    pointsPaymentTitle: \"Points Payment\",\n    pointsPaymentDesc: \"Process payment using customer points\",\n    paymentCustomerSelection: \"Select Payment Customer\",\n    availablePoints: \"Available Points\",\n    pointsToUse: \"Points to Use\",\n    pointsToUsePlaceholder: \"Enter points to use\",\n    insufficientPoints: \"Insufficient points\",\n    pointsAfterPayment: \"Points remaining after payment\",\n    processPayment: \"Process Points Payment\",\n    historyTitle: \"Points Usage History\",\n    historyDesc: \"You can view all point transaction history\",\n    loadingHistory: \"Loading history...\",\n    noHistory: \"No points usage history\",\n    earned: \"Earned\",\n    redeemed: \"Redeemed\",\n    adjusted: \"Adjusted\",\n    expired: \"Expired\",\n    unknown: \"Unknown\",\n    // Membership management\n    membershipManagementTitle: \"Membership Management\",\n    membershipManagementDesc: \"Manage customer membership levels and provide benefits\",\n    membershipTierGuide: \"Membership Tier Guide\",\n    membershipLevel: \"Membership Level\",\n    membershipBenefits: \"Benefits\",\n    minPurchaseAmount: \"Minimum Purchase Amount\",\n    basicLevel: \"Basic Level\",\n    basicLevelDesc: \"Basic level for new customers\",\n    premiumLevel: \"Premium Level\",\n    premiumLevelDesc: \"Premium level for loyal customers\", \n    vipLevel: \"VIP Level\",\n    vipLevelDesc: \"Highest level for VIP customers\",\n    basicPointsEarning: \"Basic points earning\",\n    birthdayDiscount5: \"5% birthday discount\",\n    pointsEarning15: \"1.5x points earning\",\n    birthdayDiscount10: \"10% birthday discount\",\n    freeDrinkMonthly: \"1 free drink per month\",\n    pointsEarning2x: \"2x points earning\", \n    birthdayDiscount20: \"20% birthday discount\",\n    freeDrink2Monthly: \"2 free drinks per month\",\n    vipRoomAccess: \"VIP room access\",\n    customerMembershipManagement: \"Customer Membership Management\",\n    autoUpgrade: \"Auto Grade Adjustment\",\n    filterByTier: \"Filter by Tier\",\n    upgradeAvailable: \"Upgrade Available\",\n    allTiers: \"All Tiers\",\n    close: \"Close\", \n    pointsUpdated: \"Points updated successfully\",\n    pointManagement: \"Points Management\",\n    pointManagementDescription: \"View customer point status and add or use points\",\n    pointOverview: \"Points Overview\",\n    updatePoints: \"Update Points\",\n    pointHistory: \"Point History\",\n    recentPointHistory: \"Recent Point History\",\n    viewAllHistory: \"View All History\",\n    transactionType: \"Transaction Type\",\n    selectTransactionType: \"Select transaction type\",\n    enterPoints: \"Enter points\",\n    reason: \"Reason\",\n    enterReason: \"Enter reason\",\n    processPoints: \"Process Points\",\n    balance: \"Balance\",\n    previousBalance: \"Previous Balance\",\n    noPointHistory: \"No point history\",\n    pointsUpdateFailed: \"Points Update Failed\",\n    pointsUpdateError: \"An error occurred while updating points\",\n    noRegisteredCustomers: \"No registered customers\",\n  },\n  vi: {\n    title: \"Quản lý khách hàng\",\n    description: \"Quản lý thông tin khách hàng\",\n    customerManagement: \"Quản lý khách hàng\",\n    addCustomer: \"Thêm khách hàng\",\n    editCustomer: \"Sửa khách hàng\",\n    deleteCustomer: \"Xóa khách hàng\",\n    searchPlaceholder: \"Tìm theo tên, ID khách hàng hoặc số điện thoại\",\n    customerId: \"ID khách hàng\",\n    name: \"Tên\",\n    phone: \"Điện thoại\",\n    email: \"Email\",\n    visitCount: \"Số lần ghé thăm\",\n    totalSpent: \"Tổng chi tiêu\",\n    points: \"Điểm\",\n    status: \"Trạng thái\",\n    totalCustomers: \"Tổng số khách hàng\",\n    activeCustomers: \"Khách hàng hoạt động\",\n    pointsIssued: \"Điểm đã phát hành\",\n    averageSpent: \"Chi tiêu trung bình\",\n    customerFormTitle: \"Thông tin khách hàng\",\n    customerFormDesc: \"Nhập thông tin khách hàng\",\n    customerAdded: \"Đã thêm khách hàng thành công\",\n    customerUpdated: \"Đã cập nhật khách hàng thành công\",\n    customerDeleted: \"Đã xóa khách hàng thành công\",\n    customerError: \"Lỗi xử lý khách hàng\",\n    namePlaceholder: \"Nhập tên khách hàng\",\n    phonePlaceholder: \"Nhập số điện thoại\",\n    emailPlaceholder: \"Nhập địa chỉ email\",\n    addressPlaceholder: \"Nhập địa chỉ\",\n    birthday: \"Ngày sinh\",\n    birthdayPlaceholder: \"Chọn ngày sinh\",\n    gender: \"Giới tính\",\n    male: \"Nam\",\n    female: \"Nữ\",\n    other: \"Khác\",\n    address: \"Địa chỉ\",\n    gold: \"Vàng\",\n    silver: \"Bạc\",\n    vip: \"Vip\",\n    total: \"Tổng\",\n    totalCustomersRegistered: \"khách hàng đã đăng ký\",\n    pointsManagement: \"Quản lý điểm\",\n    membershipManagement: \"Quản lý thành viên\",\n    pointsManagementTitle: \"Quản lý điểm\",\n    pointsManagementDesc: \"Quản lý điểm khách hàng và xem lịch sử sử dụng\",\n    pointsAdjustment: \"Điều chỉnh điểm\",\n    pointsPayment: \"Thanh toán điểm\",\n    history: \"Lịch sử sử dụng\",\n    totalPoints: \"Tổng điểm\",\n    averagePoints: \"Điểm trung bình\",\n    customers: \"khách hàng\",\n    pointsEditTitle: \"Chỉnh sửa và điều chỉnh điểm\",\n    pointsEditDesc: \"Bạn có thể thêm, trừ hoặc thiết lập điểm của khách hàng\",\n    customerSelection: \"Chọn khách hàng\",\n    searchCustomers: \"Tìm theo tên khách hàng, ID, số điện thoại...\",\n    currentPoints: \"Điểm hiện tại\",\n    adjustmentType: \"Loại điều chỉnh\",\n    addPoints: \"Thêm điểm\",\n    subtractPoints: \"Trừ điểm\",\n    setPoints: \"Thiết lập điểm\",\n    pointsToAdd: \"Điểm cần thêm\",\n    pointsToSubtract: \"Điểm cần trừ\",\n    pointsToSet: \"Điểm cần thiết lập\",\n    adjustmentReason: \"Lý do điều chỉnh\",\n    adjustmentReasonPlaceholder: \"Nhập lý do điều chỉnh điểm\",\n    processing: \"Đang xử lý...\",\n    pointsPaymentTitle: \"Thanh toán điểm\",\n    pointsPaymentDesc: \"Xử lý thanh toán bằng điểm của khách hàng\",\n    paymentCustomerSelection: \"Chọn khách hàng thanh toán\",\n    availablePoints: \"Điểm có thể sử dụng\",\n    pointsToUse: \"Điểm sử dụng\",\n    pointsToUsePlaceholder: \"Nhập điểm cần sử dụng\",\n    insufficientPoints: \"Điểm không đủ\",\n    pointsAfterPayment: \"Điểm còn lại sau thanh toán\",\n    processPayment: \"Xử lý thanh toán điểm\",\n    historyTitle: \"Lịch sử sử dụng điểm\",\n    historyDesc: \"Bạn có thể xem tất cả lịch sử giao dịch điểm\",\n    loadingHistory: \"Đang tải lịch sử...\",\n    noHistory: \"Không có lịch sử sử dụng điểm\",\n    earned: \"Tích lũy\",\n    redeemed: \"Sử dụng\",\n    adjusted: \"Điều chỉnh\",\n    expired: \"Hết hạn\",\n    unknown: \"Không rõ\",\n    // Membership management\n    membershipManagementTitle: \"Quản lý thành viên\",\n    membershipManagementDesc: \"Quản lý cấp độ thành viên khách hàng và cung cấp lợi ích\",\n    membershipTierGuide: \"Hướng dẫn cấp độ thành viên\",\n    membershipLevel: \"Cấp độ thành viên\", \n    membershipBenefits: \"Lợi ích\",\n    minPurchaseAmount: \"Số tiền mua tối thiểu\",\n    basicLevel: \"Cấp độ cơ bản\",\n    basicLevelDesc: \"Cấp độ cơ bản cho khách hàng mới\",\n    premiumLevel: \"Cấp độ cao cấp\",\n    premiumLevelDesc: \"Cấp độ cao cấp cho khách hàng thân thiết\",\n    vipLevel: \"Cấp độ VIP\", \n    vipLevelDesc: \"Cấp độ cao nhất cho khách hàng VIP\",\n    basicPointsEarning: \"Tích điểm cơ bản\",\n    birthdayDiscount5: \"Giảm giá sinh nhật 5%\",\n    pointsEarning15: \"Tích điểm x1.5\",\n    birthdayDiscount10: \"Giảm giá sinh nhật 10%\",\n    freeDrinkMonthly: \"Đồ uống miễn phí 1 lần/tháng\",\n    pointsEarning2x: \"Tích điểm x2\",\n    birthdayDiscount20: \"Giảm giá sinh nhật 20%\", \n    freeDrink2Monthly: \"Đồ uống miễn phí 2 lần/tháng\",\n    vipRoomAccess: \"Sử dụng phòng VIP\",\n    customerMembershipManagement: \"Quản lý thành viên khách hàng\",\n    autoUpgrade: \"Điều chỉnh cấp độ tự động\",\n    filterByTier: \"Lọc theo cấp độ\",\n    upgradeAvailable: \"Có thể nâng cấp\",\n    allTiers: \"Tất cả cấp độ\",\n    close: \"Đóng\",\n    pointsUpdated: \"Cập nhật điểm thành công\",\n    pointManagement: \"Quản lý điểm\",\n    pointManagementDescription: \"Xem tình trạng điểm khách hàng và thêm hoặc sử dụng điểm\",\n    pointOverview: \"Tổng quan điểm\",\n    updatePoints: \"Cập nhật điểm\",\n    pointHistory: \"Lịch sử điểm\",\n    recentPointHistory: \"Lịch sử điểm gần đây\",\n    viewAllHistory: \"Xem tất cả lịch sử\",\n    transactionType: \"Loại giao dịch\",\n    selectTransactionType: \"Chọn loại giao dịch\",\n    enterPoints: \"Nhập điểm\",\n    reason: \"Lý do\",\n    enterReason: \"Nhập lý do\",\n    processPoints: \"Xử lý điểm\",\n    balance: \"Số dư\",\n    previousBalance: \"Số dư trước đó\",\n    noPointHistory: \"Không có lịch sử điểm\",\n    pointsUpdateFailed: \"Cập nhật điểm thất bại\",\n    pointsUpdateError: \"Đã xảy ra lỗi khi cập nhật điểm\",\n    noRegisteredCustomers: \"Chưa có khách hàng nào được đăng ký\",\n  },\n};","size_bytes":17732},"client/src/lib/i18n/modules/einvoice.ts":{"content":"import { EInvoiceTranslations } from \"../types\";\n\nexport const einvoiceTranslations: { [key: string]: EInvoiceTranslations } = {\n  ko: {\n    title: \"전자 인보이스 발행\",\n    providerInfo: \"전자 인보이스 제공업체 정보\",\n    providerUnit: \"전자 인보이스 업체\",\n    selectProvider: \"전자 인보이스 업체 선택\",\n    invoiceTemplate: \"부가세 인보이스 템플릿 번호\",\n    selectTemplate: \"인보이스 템플릿 선택\",\n    customerInfo: \"고객 정보\",\n    taxCode: \"사업자등록번호\",\n    getInfo: \"정보 가져오기\",\n    companyName: \"회사명\",\n    address: \"주소\",\n    idNumber: \"신분증 번호\",\n    recipient: \"인보이스 수령인\",\n    email: \"이메일\",\n    totalAmount: \"인보이스 총액:\",\n    publish: \"발행\",\n    cancel: \"취소\",\n    publishing: \"발행 중...\",\n    notes: \"Ghi chú\",\n    newOrder: \"+ Đơn mới\",\n    checkout: \"Thanh toán\",\n  },\n  en: {\n    title: \"Issue Electronic Invoice\",\n    providerInfo: \"Electronic Invoice Provider Information\",\n    providerUnit: \"E-Invoice Provider\",\n    selectProvider: \"Select E-Invoice Provider\",\n    invoiceTemplate: \"VAT Invoice Template Number\",\n    selectTemplate: \"Select Invoice Template\",\n    customerInfo: \"Customer Information\",\n    taxCode: \"Tax Code\",\n    getInfo: \"Get Information\",\n    companyName: \"Company Name\",\n    address: \"Address\",\n    idNumber: \"ID Number\",\n    recipient: \"Invoice Recipient\",\n    email: \"Email\",\n    totalAmount: \"Total Invoice Amount:\",\n    publish: \"Publish\",\n    cancel: \"Cancel\",\n    publishing: \"Publishing...\",\n    notes: \"Ghi chú\",\n    newOrder: \"+ Đơn mới\",\n    checkout: \"Thanh toán\",\n  },\n  vi: {\n    title: \"Phát hành hóa đơn điện tử\",\n    providerInfo: \"Thông tin nhà cung cấp hóa đơn điện tử\",\n    providerUnit: \"Đơn vị HĐĐT\",\n    selectProvider: \"Chọn đơn vị HĐĐT\",\n    invoiceTemplate: \"Mẫu số Hóa đơn GTGT\",\n    selectTemplate: \"Chọn mẫu số hóa đơn\",\n    customerInfo: \"Thông tin khách hàng\",\n    taxCode: \"Mã số thuế\",\n    getInfo: \"Lấy thông tin\",\n    companyName: \"Tên đơn vị\",\n    address: \"Địa chỉ\",\n    idNumber: \"Số CMND/CCCD\",\n    recipient: \"Người nhận HĐ\",\n    email: \"Email\",\n    totalAmount: \"Tổng tiền hóa đơn:\",\n    publish: \"Phát hành\",\n    cancel: \"Hủy bỏ\",\n    publishing: \"Đang phát hành...\",\n    notes: \"Ghi chú\",\n    newOrder: \"+ Đơn mới\",\n    checkout: \"Thanh toán\",\n  },\n};\n","size_bytes":2489},"client/src/lib/i18n/modules/employees.ts":{"content":"import type { EmployeesTranslations } from \"../types\";\n\nexport const employeesTranslations: { [key: string]: EmployeesTranslations } = {\n  ko: {\n    title: \"직원 관리\",\n    description: \"직원 정보를 관리합니다\",\n    employeeManagement: \"직원 관리\",\n    addEmployee: \"직원 추가\",\n    editEmployee: \"직원 수정\",\n    deleteEmployee: \"직원 삭제\",\n    searchPlaceholder: \"이름, 직원 ID, 전화번호로 검색...\",\n    employeeId: \"직원 ID\",\n    name: \"이름\",\n    role: \"역할\",\n    phone: \"전화번호\",\n    email: \"이메일\",\n    status: \"상태\",\n    hireDate: \"입사일\",\n    salary: \"급여\",\n    department: \"부서\",\n    position: \"직책\",\n    employeeFormTitle: \"직원 정보\",\n    employeeFormDesc: \"직원 정보를 입력하세요\",\n    employeeAdded: \"직원이 추가되었습니다\",\n    employeeUpdated: \"직원 정보가 업데이트되었습니다\",\n    employeeDeleted: \"직원이 삭제되었습니다\",\n    employeeError: \"직원 처리 중 오류가 발생했습니다\",\n    namePlaceholder: \"직원명을 입력하세요\",\n    phonePlaceholder: \"전화번호를 입력하세요\",\n    emailPlaceholder: \"이메일을 입력하세요\",\n    salaryPlaceholder: \"급여를 입력하세요\",\n    roles: {\n      admin: \"관리자\",\n      manager: \"매니저\",\n      cashier: \"캐셔\",\n      kitchen: \"주방\",\n      server: \"서빙\",\n    },\n    active: \"활성\",\n    inactive: \"비활성\",\n    total: \"총 고객 수\",\n    employeeList: \"직원 목록\",\n    currentEmployeeCount: \"현재 직원 수: {{count}}\",\n    addEmployeeSuccess: \"직원이 성공적으로 추가되었습니다\",\n    addEmployeeError: \"직원 추가 중 오류가 발생했습니다\",\n    updateEmployeeSuccess: \"직원 정보가 성공적으로 업데이트되었습니다\",\n    updateEmployeeError: \"직원 정보 업데이트 중 오류가 발생했습니다\",\n    save: \"저장\",\n    add: \"추가\",\n    saving: \"저장 중...\",\n    confirmDelete: \"정말로 {{name}}을(를) 삭제하시겠습니까?\",\n    deleteSuccess: \"직원이 성공적으로 삭제되었습니다\",\n    deleteError: \"직원 삭제 중 오류가 발생했습니다\",\n    emailAlreadyExists: \"이메일이 이미 사용되고 있습니다\",\n    emailAlreadyInSystem: \"이메일이 이미 시스템에 존재합니다\",\n    selectRole: \"역할을 선택하세요\",\n    employeeIdRequired: \"직원 ID는 필수입니다\",\n    nameRequired: \"이름은 필수입니다\",\n    emailInvalid: \"유효한 이메일 주소를 입력하세요\",\n    noEmployeesFound: \"직원을 찾을 수 없습니다\",\n  },\n  en: {\n    title: \"Employee Management\",\n    description: \"Manage employee information\",\n    employeeManagement: \"Employee Management\",\n    addEmployee: \"Add Employee\",\n    editEmployee: \"Edit Employee\",\n    deleteEmployee: \"Delete Employee\",\n    searchPlaceholder: \"Search by name, employee ID, phone...\",\n    employeeId: \"Employee ID\",\n    name: \"Name\",\n    role: \"Role\",\n    phone: \"Phone\",\n    email: \"Email\",\n    status: \"Status\",\n    hireDate: \"Hire Date\",\n    salary: \"Salary\",\n    department: \"Department\",\n    position: \"Position\",\n    employeeFormTitle: \"Employee Information\",\n    employeeFormDesc: \"Enter employee information\",\n    employeeAdded: \"Employee added successfully\",\n    employeeUpdated: \"Employee updated successfully\",\n    employeeDeleted: \"Employee deleted successfully\",\n    employeeError: \"Error processing employee\",\n    namePlaceholder: \"Enter employee name\",\n    phonePlaceholder: \"Enter phone number\",\n    emailPlaceholder: \"Enter email address\",\n    salaryPlaceholder: \"Enter salary\",\n    roles: {\n      admin: \"Admin\",\n      manager: \"Manager\",\n      cashier: \"Cashier\",\n      kitchen: \"Kitchen\",\n      server: \"Server\",\n    },\n    active: \"Active\",\n    inactive: \"Inactive\",\n    total: \"Total number of customers\",\n    employeeList: \"Employee List\",\n    currentEmployeeCount: \"Current employee count: {{count}}\",\n    addEmployeeSuccess: \"Employee added successfully\",\n    addEmployeeError: \"Error adding employee\",\n    updateEmployeeSuccess: \"Employee updated successfully\",\n    updateEmployeeError: \"Error updating employee\",\n    save: \"Save\",\n    add: \"Add\",\n    saving: \"Saving...\",\n    confirmDelete: \"Are you sure you want to delete {{name}}?\",\n    deleteSuccess: \"Employee deleted successfully\",\n    deleteError: \"Error deleting employee\",\n    emailAlreadyExists: \"Email is already in use\",\n    emailAlreadyInSystem: \"Email already exists in the system\",\n    selectRole: \"Select a role\",\n    employeeIdRequired: \"Employee ID is required\",\n    nameRequired: \"Name is required\",\n    emailInvalid: \"Please enter a valid email address\",\n    noEmployeesFound: \"No employees found\",\n  },\n  vi: {\n    title: \"Quản lý nhân viên\",\n    description: \"Quản lý thông tin nhân viên\",\n    employeeManagement: \"Quản lý nhân viên\",\n    addEmployee: \"Thêm nhân viên\",\n    editEmployee: \"Sửa nhân viên\",\n    deleteEmployee: \"Xóa nhân viên\",\n    searchPlaceholder: \"Tìm kiếm theo tên, mã NV, số điện thoại...\",\n    employeeId: \"ID nhân viên\",\n    name: \"Tên\",\n    role: \"Vai trò\",\n    phone: \"Điện thoại\",\n    email: \"Email\",\n    status: \"Trạng thái\",\n    hireDate: \"Ngày thuê\",\n    salary: \"Lương\",\n    department: \"Phòng ban\",\n    position: \"Chức vụ\",\n    employeeFormTitle: \"Thông tin nhân viên\",\n    employeeFormDesc: \"Nhập thông tin nhân viên\",\n    employeeAdded: \"Đã thêm nhân viên thành công\",\n    employeeUpdated: \"Đã cập nhật nhân viên thành công\",\n    employeeDeleted: \"Đã xóa nhân viên thành công\",\n    employeeError: \"Lỗi xử lý nhân viên\",\n    namePlaceholder: \"Nhập tên nhân viên\",\n    phonePlaceholder: \"Nhập số điện thoại\",\n    emailPlaceholder: \"Nhập địa chỉ email\",\n    salaryPlaceholder: \"Nhập lương\",\n    roles: {\n      admin: \"Quản trị viên\",\n      manager: \"Quản lý\",\n      cashier: \"Thu ngân\",\n      kitchen: \"Bếp\",\n      server: \"Phục vụ\",\n    },\n    active: \"Hoạt động\",\n    inactive: \"Không hoạt động\",\n    total: \"Tổng số khách hàng\",\n    employeeList: \"Danh sách nhân viên\",\n    addEmployeeSuccess: \"Đã thêm nhân viên thành công\",\n    currentEmployeeCount: \"Số lượng nhân viên hiện tại: {{count}}\",\n    addEmployeeError: \"Lỗi khi thêm nhân viên\",\n    updateEmployeeSuccess: \"Đã cập nhật nhân viên thành công\",\n    updateEmployeeError: \"Lỗi khi cập nhật nhân viên\",\n    save: \"Lưu\",\n    add: \"Thêm\",\n    saving: \"Đang lưu...\",\n    confirmDelete: \"Bạn có chắc chắn muốn xóa {{name}}?\",\n    deleteSuccess: \"Đã xóa nhân viên thành công\",\n    deleteError: \"Lỗi khi xóa nhân viên\",\n    emailAlreadyExists: \"Email đã được sử dụng\",\n    emailAlreadyInSystem: \"Email đã tồn tại trong hệ thống\",\n    selectRole: \"Chọn vai trò\",\n    employeeIdRequired: \"ID nhân viên là bắt buộc\",\n    nameRequired: \"Tên nhân viên là bắt buộc\",\n    emailInvalid: \"Vui lòng nhập địa chỉ email hợp lệ\",\n    noEmployeesFound: \"Không tìm thấy nhân viên nào\",\n  },\n};\n","size_bytes":7168},"client/src/lib/i18n/modules/inventory.ts":{"content":"import type { InventoryTranslations } from '../types';\n\nexport const inventoryTranslations: { [key: string]: InventoryTranslations } = {\n  ko: {\n    title: '재고 관리',\n    description: '상품 재고를 관리합니다',\n    totalProducts: '총 상품',\n    lowStock: '재고 부족',\n    outOfStock: '품절',\n    totalValue: '총 재고 가치',\n    searchProducts: '상품 검색',\n    stockStatus: '재고 상태',\n    allStock: '전체 재고',\n    inStock: '재고 있음',\n    productName: '상품명',\n    currentStock: '현재 재고',\n    unitPrice: '단가',\n    stockValue: '재고 가치',\n    management: '관리',\n    edit: '편집',\n    stockUpdate: '재고 수정',\n    loading: '로딩 중...',\n    noProducts: '상품이 없습니다',\n    uncategorized: '미분류',\n    currentStockLabel: '현재 재고',\n    stockUpdateType: '재고 수정 유형',\n    quantity: '수량',\n    notesOptional: '메모 (선택사항)',\n    selectUpdateType: '수정 유형 선택',\n    addStock: '재고 추가',\n    subtractStock: '재고 차감',\n    setStock: '재고 설정',\n    quantityInput: '수량 입력',\n    changeReason: '변경 사유',\n    processing: '처리 중...',\n    addNewItem: '새 항목 추가',\n    newProduct: '새 상품',\n    productNameLabel: '상품명',\n    productNamePlaceholder: '상품명을 입력하세요',\n    skuLabel: 'SKU',\n    skuPlaceholder: 'SKU를 입력하세요',\n    priceLabel: '가격',\n    pricePlaceholder: '가격을 입력하세요',\n    categoryLabel: '카테고리',\n    categoryPlaceholder: '카테고리를 선택하세요',\n    initialStockQuantity: '초기 재고 수량',\n    initialStockPlaceholder: '초기 수량을 입력하세요',\n    stockQuantity: '재고 수량',\n    editReason: '수정 이유',\n    addNewStock: '새 재고 추가',\n    save: '저장',\n    updateType: '수정 유형',\n    delete: \"삭제\",\n    confirmDelete: \"삭제하시겠습니까?\",\n    deleteFailed: \"삭제에 실패했습니다\",\n    createFailed: \"상품 생성에 실패했습니다\",\n    updateFailed: \"상품 수정에 실패했습니다\",\n    duplicateSku: \"이미 존재하는 상품입니다\",\n    duplicateSkuDescription: \"이 SKU는 다른 상품에서 이미 사용되고 있습니다\",\n    quantityMinError: \"수량은 최소 1개 이상이어야 합니다\",\n    trackInventory: \"재고 추적\",\n  },\n  en: {\n    title: 'Inventory Management',\n    description: 'Manage product inventory',\n    totalProducts: 'Total Products',\n    lowStock: 'Low Stock',\n    outOfStock: 'Out of Stock',\n    totalValue: 'Total Value',\n    searchProducts: 'Search Products',\n    stockStatus: 'Stock Status',\n    allStock: 'All Stock',\n    inStock: 'In Stock',\n    productName: 'Product Name',\n    currentStock: 'Current Stock',\n    unitPrice: 'Unit Price',\n    stockValue: 'Stock Value',\n    management: 'Management',\n    edit: 'Edit',\n    stockUpdate: 'Stock Update',\n    loading: 'Loading...',\n    noProducts: 'No products found',\n    uncategorized: 'Uncategorized',\n    currentStockLabel: 'Current Stock',\n    stockUpdateType: 'Stock Update Type',\n    quantity: 'Quantity',\n    notesOptional: 'Notes (Optional)',\n    selectUpdateType: 'Select Update Type',\n    addStock: 'Add Stock',\n    subtractStock: 'Subtract Stock',\n    setStock: 'Set Stock',\n    quantityInput: 'Enter Quantity',\n    changeReason: 'Change Reason',\n    processing: 'Processing...',\n    addNewItem: 'Add New Item',\n    newProduct: 'New Product',\n    productNameLabel: 'Product Name',\n    productNamePlaceholder: 'Enter product name',\n    skuLabel: 'SKU',\n    skuPlaceholder: 'Enter SKU',\n    priceLabel: 'Price',\n    pricePlaceholder: 'Enter price',\n    categoryLabel: 'Category',\n    categoryPlaceholder: 'Select category',\n    initialStockQuantity: 'Initial Stock Quantity',\n    initialStockPlaceholder: 'Enter initial quantity',\n    stockQuantity: 'Stock Quantity',\n    editReason: 'Edit Reason',\n    addNewStock: 'Add New Stock',\n    save: 'Save',\n    updateType: 'Update Type',\n    delete: \"Delete\",\n    confirmDelete: \"Are you sure you want to delete\",\n    deleteFailed: \"Failed to delete product\",\n    createFailed: \"Failed to create product\",\n    updateFailed: \"Failed to update product\",\n    duplicateSku: \"Product already exists in inventory\",\n    duplicateSkuDescription: \"This SKU is already used by another product\",\n    quantityMinError: \"Quantity must be at least 1\",\n    trackInventory: \"Track Inventory\",\n  },\n  vi: {\n    title: 'Quản lý tồn kho',\n    description: 'Quản lý tồn kho sản phẩm',\n    totalProducts: 'Tổng sản phẩm',\n    lowStock: 'Sắp hết hàng',\n    outOfStock: 'Hết hàng',\n    totalValue: 'Tổng giá trị',\n    searchProducts: 'Tìm kiếm sản phẩm',\n    stockStatus: 'Trạng thái tồn kho',\n    allStock: 'Tất cả tồn kho',\n    inStock: 'Còn hàng',\n    productName: 'Tên sản phẩm',\n    currentStock: 'Tồn kho hiện tại',\n    unitPrice: 'Đơn giá',\n    stockValue: 'Giá trị tồn kho',\n    management: 'Quản lý',\n    edit: 'Chỉnh sửa',\n    stockUpdate: 'Cập nhật tồn kho',\n    loading: 'Đang tải...',\n    noProducts: 'Không tìm thấy sản phẩm',\n    uncategorized: 'Chưa phân loại',\n    currentStockLabel: 'Tồn kho hiện tại',\n    stockUpdateType: 'Loại cập nhật',\n    quantity: 'Số lượng tồn kho',\n    notesOptional: 'Lý do chỉnh sửa',\n    selectUpdateType: 'Chọn loại cập nhật',\n    addStock: 'Thêm tồn kho',\n    subtractStock: 'Trừ tồn kho',\n    setStock: 'Đặt tồn kho',\n    quantityInput: 'Nhập số lượng',\n    changeReason: 'Lý do thay đổi',\n    processing: 'Đang xử lý...',\n    addNewItem: 'Thêm mặt hàng mới',\n    newProduct: 'Sản phẩm mới',\n    productNameLabel: 'Tên sản phẩm',\n    productNamePlaceholder: 'Nhập tên sản phẩm',\n    skuLabel: 'SKU',\n    skuPlaceholder: 'Nhập SKU',\n    priceLabel: 'Giá',\n    pricePlaceholder: 'Nhập giá',\n    categoryLabel: 'Danh mục',\n    categoryPlaceholder: 'Chọn danh mục',\n    initialStockQuantity: 'Số lượng tồn kho ban đầu',\n    initialStockPlaceholder: 'Nhập số lượng ban đầu',\n    stockQuantity: 'Số lượng tồn kho',\n    editReason: 'Lý do chỉnh sửa',\n    addNewStock: 'Thêm mới tồn kho',\n    save: 'Lưu',\n    updateType: 'Loại cập nhật',\n    delete: \"Xóa\",\n    confirmDelete: \"Bạn có chắc chắn muốn xóa\",\n    deleteFailed: \"Xóa sản phẩm thất bại\",\n    deleteFailedDescription: \"Không thể xóa sản phẩm. Vui lòng thử lại.\",\n    deleteSuccess: \"Xóa thành công\",\n    deleteSuccessDescription: \"Sản phẩm đã được xóa khỏi kho hàng\",\n    createFailed: \"Tạo sản phẩm thất bại\",\n    createFailedDescription: \"Không thể tạo sản phẩm mới. Vui lòng thử lại.\",\n    createSuccess: \"Tạo mới thành công\",\n    createSuccessDescription: \"Sản phẩm mới đã được thêm vào kho hàng\",\n    updateFailed: \"Cập nhật sản phẩm thất bại\",\n    updateFailedDescription: \"Không thể cập nhật sản phẩm. Vui lòng thử lại.\",\n    updateSuccess: \"Cập nhật thành công\",\n    updateSuccessDescription: \"Thông tin sản phẩm đã được cập nhật\",\n    duplicateSku: \"Đã tồn tại sản phẩm trong kho\",\n    duplicateSkuDescription: \"SKU này đã được sử dụng cho sản phẩm khác\",\n    quantityMinError: \"Số lượng phải ít nhất là 1\",\n    trackInventory: \"Theo dõi tồn kho\",\n  }\n};","size_bytes":7535},"client/src/lib/i18n/modules/navigation.ts":{"content":"import type { NavigationTranslations } from '../types';\n\nexport const navigationTranslations: { [key: string]: NavigationTranslations } = {\n  ko: {\n    pos: 'POS',\n    tables: '테이블',\n    salesOrders: '주문 목록',\n    inventory: '재고',\n    reports: '보고서',\n    employees: '직원',\n    attendance: '출석',\n    suppliers: '공급업체',\n    salesReports: '매출 보고서',\n    inventoryReports: '재고 보고서',\n    expensesReports: '지출 보고서',\n    profitReports: '수익 보고서',\n    tablesSales: '테이블별 판매',\n    directSales: '직접 판매',\n    dashboard: '대시보드',\n    salesAnalysis: '매출 분석',\n    menuAnalysis: '메뉴 분석',\n    tableAnalysis: '테이블 분석',\n    salesChart: '매출 차트',\n    purchaseReport: '구매 보고서',\n    warehouseReport: '창고 보고서',\n    orderReport: '구매 주문 보고서',\n    customerDisplay: '고객 디스플레이',\n    tablesSales: '테이블 판매',\n    logout: '로그아웃',\n  },\n  en: {\n    pos: 'POS',\n    tables: \"Tables\",\n    salesOrders: \"Sales Orders\",\n    inventory: \"Inventory\",\n    reports: 'Reports',\n    employees: 'Employees',\n    attendance: 'Attendance',\n    suppliers: 'Suppliers',\n    salesReports: 'Sales Reports',\n    inventoryReports: 'Inventory Reports',\n    expensesReports: 'Expenses Reports',\n    profitReports: 'Profit Reports',\n    tablesSales: 'Table Sales',\n    directSales: 'Direct Sales',\n    dashboard: 'Dashboard',\n    salesAnalysis: 'Sales Analysis',\n    menuAnalysis: 'Menu Analysis',\n    tableAnalysis: 'Table Analysis',\n    salesChart: 'Sales Chart',\n    purchaseReport: 'Purchase Report',\n    warehouseReport: 'Warehouse Report',\n    orderReport: 'Purchase Order Report',\n    customerDisplay: 'Customer Display',\n    tablesSales: 'Table Sales',\n    logout: 'Logout',\n  },\n  vi: {\n    pos: 'Bán hàng',\n    tables: \"Bàn ăn\",\n    salesOrders: \"Danh sách đơn bán\",\n    inventory: \"Kho hàng\",\n    reports: 'Báo cáo',\n    employees: 'Nhân viên',\n    attendance: 'Chấm công',\n    suppliers: 'Nhà cung cấp',\n    salesReports: 'Báo cáo bán hàng',\n    inventoryReports: 'Báo cáo tồn kho',\n    expensesReports: 'Báo cáo chi phí',\n    profitReports: 'Báo cáo lợi nhuận',\n    tablesSales: 'Bán hàng tại bàn',\n    directSales: 'Bán hàng trực tiếp',\n    dashboard: 'Bảng điều khiển',\n    salesAnalysis: 'Phân tích bán hàng',\n    menuAnalysis: 'Phân tích menu',\n    tableAnalysis: 'Phân tích bàn',\n    salesChart: 'Báo cáo bán hàng',\n    purchaseReport: 'Báo cáo mua hàng',\n    warehouseReport: 'Báo cáo kho',\n    orderReport: 'Báo cáo mua hàng',\n    customerDisplay: 'Màn hình khách hàng',\n    tablesSales: 'Bán hàng tại bàn',\n    logout: 'Đăng xuất',\n  },\n};","size_bytes":2794},"client/src/lib/i18n/modules/notFound.ts":{"content":"import type { NotFoundTranslations } from '../types';\n\nexport const notFoundTranslations: { [key: string]: NotFoundTranslations } = {\n  ko: {\n    title: '페이지를 찾을 수 없습니다',\n    description: '죄송합니다. 찾고 계신 페이지를 찾을 수 없습니다.',\n    backHome: '홈으로 돌아가기',\n    backToHome: 'POS로 돌아가기',\n  },\n  en: {\n    title: 'Page Not Found',\n    description: 'Sorry, we could not find the page you are looking for.',\n    backHome: 'Back to Home',\n    backToHome: 'Back to POS',\n  },\n  vi: {\n    title: 'Không tìm thấy trang',\n    description: 'Xin lỗi, chúng tôi không thể tìm thấy trang bạn đang tìm kiếm.',\n    backHome: 'Về trang chủ',\n    backToHome: 'Quay lại POS',\n  },\n};","size_bytes":765},"client/src/lib/i18n/modules/orders.ts":{"content":"import type { OrdersTranslations } from \"../types\";\n\nexport const ordersTranslations: { [key: string]: OrdersTranslations } = {\n  ko: {\n    orderManagement: \"주문 관리\",\n    orderDetails: \"주문 상세\",\n    orderNumber: \"주문 번호\",\n    orderInfo: \"주문 정보\",\n    orderItems: \"주문 항목\",\n    orderStatus: \"주문 상태\",\n    orderTime: \"주문 시간\",\n    orderStatusUpdated: \"주문 상태가 업데이트되었습니다\",\n    orderStatusUpdateFailed: \"주문 상태 업데이트에 실패했습니다\",\n    viewDetails: \"상세 보기\",\n    confirm: \"확인\",\n    startCooking: \"조리 시작\",\n    ready: \"준비 완료\",\n    served: \"서빙 완료\",\n    table: \"테이블\",\n    customer: \"고객\",\n    customerCount: \"고객 수\",\n    customerName: \"고객명\",\n    noCustomerName: \"고객명 없음\",\n    people: \"명\",\n    unknownTable: \"알 수 없는 테이블\",\n    unknownProduct: \"알 수 없는 상품\",\n    memo: \"메모\",\n    totalAmount: \"총 금액\",\n    subtotal: \"소계\",\n    tax: \"세금\",\n    statusAndTime: \"상태 및 시간\",\n    realTimeOrderStatus: \"실시간 주문 현황을 확인하고 관리하세요\",\n    ordersInProgress: \"개 진행중\",\n    noActiveOrders: \"진행중인 주문이 없습니다\",\n    newOrdersWillAppearHere: \"새로운 주문이 들어오면 여기에 표시됩니다\",\n    selectPaymentMethod: \"결제 방법 선택\",\n    selectPaymentMethodDesc: \"주문에 대한 결제 방법을 선택하세요\",\n    cancel: \"취소\",\n    pointsPaymentTitle: \"포인트로 결제\",\n    pointsPaymentDesc: \"고객을 선택하고 포인트를 사용하여 주문 결제\",\n    searchCustomers: \"고객 검색\",\n    availablePoints: \"사용 가능한 포인트\",\n    mixedPaymentTitle: \"혼합 결제\",\n    mixedPaymentButton: \"혼합 결제\",\n    mixedPaymentCancel: \"취소\",\n    mixedPaymentDesc:\n      \"포인트가 부족하여 현금 또는 이체로 추가 결제가 필요합니다\",\n    mixedPaymentSummary: \"결제 요약\",\n    printBill: \"청구서 인쇄\",\n    totalOrder: \"주문 총액\",\n    pointsPayment: \"포인트 결제\",\n    remainingAmount: \"남은 금액\",\n    addMore: \"추가 주문\",\n    editOrder: \"주문 수정\",\n    editOrderTitle: \"주문 수정 - 테이블\",\n    editOrderDesc: \"주문 {orderNumber} | 메뉴 추가 또는 수량 수정\",\n    addNewItems: \"새 메뉴 추가\",\n    previouslyOrdered: \"이전 주문 메뉴:\",\n    alreadyOrdered: \"주문됨\",\n    newItemsToAdd: \"새로 추가할 메뉴:\",\n    itemsAndNewItems: \"주문 메뉴 & 새 메뉴\",\n    previousItems: \"이전 메뉴\",\n    newItems: \"새 메뉴 추가\",\n    updateOrder: \"주문 업데이트\",\n    updating: \"업데이트 중...\",\n    orderUpdateSuccess: \"주문 업데이트\",\n    orderUpdateSuccessDesc: \"주문에 새 메뉴가 성공적으로 추가되었습니다\",\n    updateAndRefresh: \"업데이트 및 새로고침\",\n    pointsPaymentDialog: {\n      title: \"포인트 결제\",\n      description: \"고객을 선택하고 포인트로 주문을 결제하세요\",\n      orderInfo: \"주문 정보\",\n      orderCode: \"주문 코드:\",\n      totalAmount: \"총액:\",\n      searchCustomer: \"고객 검색\",\n      searchPlaceholder: \"이름, 전화번호 또는 고객 코드로 검색...\",\n      accumulatedPoints: \"적립 포인트\",\n      mixedPayment: \"혼합 결제\",\n    },\n    paymentMethods: {\n      cash: \"현금\",\n      creditCard: \"신용카드\",\n      debitCard: \"체크카드\",\n      momo: \"모모\",\n      zalopay: \"잘로페이\",\n      vnpay: \"VN페이\",\n      qrCode: \"QR 코드\",\n      shopeepay: \"쇼피페이\",\n      grabpay: \"그랩페이\",\n    },\n    noTableInfo: \"테이블 정보 없음\",\n    noInput: \"미입력\",\n    payment: \"결제\",\n    orderPlaced: \"주문 완료\",\n    orderPlacedSuccess: \"주문이 성공적으로 접수되었습니다\",\n    orderFailed: \"주문 접수에 실패했습니다\",\n    tableOrder: \"테이블 주문\",\n    tableCapacity: \"테이블 정원\",\n    status: {\n      pending: \"대기중\",\n      confirmed: \"확인됨\",\n      preparing: \"조리중\",\n      ready: \"준비완료\",\n      served: \"서빙완료\",\n      paid: \"결제완료\",\n      cancelled: \"취소됨\",\n      delivering: \"배송중\",\n      completed: \"완료됨\",\n    },\n  },\n  en: {\n    orderManagement: \"Order Management\",\n    orderDetails: \"Order Details\",\n    orderNumber: \"Order Number\",\n    orderInfo: \"Order Information\",\n    orderItems: \"Order Items\",\n    orderStatus: \"Order Status\",\n    orderTime: \"Order Time\",\n    orderStatusUpdated: \"Order status updated successfully\",\n    orderStatusUpdateFailed: \"Failed to update order status\",\n    viewDetails: \"View Details\",\n    confirm: \"Confirm\",\n    startCooking: \"Start Cooking\",\n    ready: \"Ready\",\n    served: \"Served\",\n    table: \"Table\",\n    customer: \"Customer\",\n    customerCount: \"Customer Count\",\n    customerName: \"Customer Name\",\n    noCustomerName: \"No customer name\",\n    people: \" people\",\n    unknownTable: \"Unknown Table\",\n    unknownProduct: \"Unknown Product\",\n    memo: \"Memo\",\n    totalAmount: \"Total Amount\",\n    subtotal: \"Subtotal\",\n    tax: \"Tax\",\n    statusAndTime: \"Status & Time\",\n    realTimeOrderStatus: \"Check and manage real-time order status\",\n    ordersInProgress: \" orders in progress\",\n    noActiveOrders: \"No active orders\",\n    newOrdersWillAppearHere: \"New orders will appear here\",\n    selectPaymentMethod: \"Select Payment Method\",\n    selectPaymentMethodDesc: \"Choose payment method for the order\",\n    cancel: \"Cancel\",\n    pointsPaymentTitle: \"Pay with Points\",\n    pointsPaymentDesc: \"Select customer and points to pay for order\",\n    searchCustomers: \"Search customers\",\n    availablePoints: \"Available points\",\n    mixedPaymentTitle: \"Mixed Payment\",\n    mixedPaymentButton: \"Mixed Payment\",\n    mixedPaymentCancel: \"Cancel Mixed Payment\",\n    mixedPaymentCompleted: \"Mixed Payment Completed\",\n    mixedPaymentError: \"Mixed Payment Error\",\n    mixedPaymentDesc:\n      \"Insufficient points, need additional payment by cash or transfer\",\n    mixedPaymentSummary: \"Payment Summary\",\n    printBill: \"Print Bill\",\n    totalOrder: \"Order Total\",\n    pointsPayment: \"Points Payment\",\n    remainingAmount: \"Remaining Amount\",\n    addMore: \"Add More\",\n    editOrder: \"Edit Order\",\n    editOrderTitle: \"Edit Order - Table\",\n    editOrderDesc: \"Order {orderNumber} | Add items or edit quantity\",\n    addNewItems: \"Add New Items\",\n    previouslyOrdered: \"Previously ordered:\",\n    alreadyOrdered: \"Ordered\",\n    newItemsToAdd: \"New items to add:\",\n    itemsAndNewItems: \"Ordered Items & New Items\",\n    previousItems: \"Previous Items\",\n    newItems: \"New Items\",\n    updateOrder: \"Update Order\",\n    updating: \"Updating...\",\n    orderUpdateSuccess: \"Order Updated\",\n    orderUpdateSuccessDesc:\n      \"New items have been successfully added to the order\",\n    updateAndRefresh: \"Update & Refresh\",\n    pointsPaymentDialog: {\n      title: \"Points Payment\",\n      description: \"Select customer and use points to pay for the order\",\n      orderInfo: \"Order Information\",\n      orderCode: \"Order Code:\",\n      totalAmount: \"Total Amount:\",\n      searchCustomer: \"Search Customer\",\n      searchPlaceholder: \"Search by name, phone, or customer code...\",\n      accumulatedPoints: \"Accumulated Points\",\n      mixedPayment: \"Mixed Payment\",\n    },\n    paymentMethods: {\n      cash: \"Cash\",\n      creditCard: \"Credit Card\",\n      debitCard: \"Debit Card\",\n      momo: \"MoMo\",\n      zalopay: \"ZaloPay\",\n      vnpay: \"VNPay\",\n      qrCode: \"QR Code\",\n      shopeepay: \"ShopeePay\",\n      grabpay: \"GrabPay\",\n    },\n    noTableInfo: \"No table information\",\n    noInput: \"Not entered\",\n    payment: \"Payment\",\n    orderPlaced: \"Order Placed\",\n    orderPlacedSuccess: \"Order has been successfully placed\",\n    orderFailed: \"Failed to place order\",\n    tableOrder: \"Table Order\",\n    tableCapacity: \"Table Capacity\",\n    status: {\n      pending: \"Pending\",\n      confirmed: \"Confirmed\",\n      preparing: \"Preparing\",\n      ready: \"Ready\",\n      served: \"Served\",\n      paid: \"Paid\",\n      cancelled: \"Cancelled\",\n      delivering: \"Delivering\",\n      completed: \"Completed\",\n    },\n  },\n  vi: {\n    orderManagement: \"Quản lý đơn hàng\",\n    orderDetails: \"Chi tiết đơn hàng\",\n    orderNumber: \"Số đơn hàng\",\n    orderInfo: \"Thông tin đơn hàng\",\n    orderItems: \"Món trong đơn\",\n    orderStatus: \"Trạng thái đơn hàng\",\n    orderTime: \"Thời gian đặt\",\n    orderStatusUpdated: \"Cập nhật trạng thái đơn hàng thành công\",\n    orderStatusUpdateFailed: \"Cập nhật trạng thái đơn hàng thất bại\",\n    viewDetails: \"Xem chi tiết\",\n    confirm: \"Xác nhận\",\n    startCooking: \"Bắt đầu nấu\",\n    ready: \"Sẵn sàng\",\n    served: \"Đã phục vụ\",\n    table: \"Bàn\",\n    customer: \"Khách hàng\",\n    customerCount: \"Số khách\",\n    customerName: \"Tên khách hàng\",\n    noCustomerName: \"Chưa có tên khách\",\n    people: \" người\",\n    unknownTable: \"Bàn không xác định\",\n    unknownProduct: \"Sản phẩm không xác định\",\n    memo: \"Ghi chú\",\n    totalAmount: \"Tổng tiền\",\n    subtotal: \"Tổng phụ\",\n    tax: \"Thuế\",\n    statusAndTime: \"Trạng thái & Thời gian\",\n    realTimeOrderStatus:\n      \"Kiểm tra và quản lý tình trạng đơn hàng theo thời gian thực\",\n    ordersInProgress: \" đơn đang xử lý\",\n    noActiveOrders: \"Không có đơn hàng đang hoạt động\",\n    newOrdersWillAppearHere: \"Đơn hàng mới sẽ xuất hiện ở đây\",\n    selectPaymentMethod: \"Chọn phương thức thanh toán\",\n    selectPaymentMethodDesc: \"Chọn phương thức thanh toán cho đơn hàng\",\n    cancel: \"Hủy\",\n    pointsPaymentTitle: \"Thanh toán bằng điểm\",\n    pointsPaymentDesc: \"Chọn khách hàng và số điểm để thanh toán đơn hàng\",\n    searchCustomers: \"Tìm kiếm khách hàng\",\n    availablePoints: \"Điểm có sẵn\",\n    mixedPaymentTitle: \"Thanh toán hỗn hợp\",\n    mixedPaymentButton: \"Thanh toán hỗn hợp\",\n    mixedPaymentCancel: \"Hủy thanh toán hỗn hợp\",\n    mixedPaymentCompleted: \"Thanh toán hỗn hợp hoàn tất\",\n    mixedPaymentError: \"Lỗi thanh toán hỗn hợp\",\n    mixedPaymentDesc:\n      \"Không đủ điểm, cần thanh toán thêm bằng tiền mặt hoặc chuyển khoản\",\n    mixedPaymentSummary: \"Tóm tắt thanh toán\",\n    printBill: \"In hóa đơn\",\n    totalOrder: \"Tổng đơn hàng\",\n    pointsPayment: \"Thanh toán bằng điểm\",\n    remainingAmount: \"Cần thanh toán thêm\",\n    addMore: \"Gọi thêm\",\n    editOrder: \"Chỉnh sửa đơn hàng\",\n    editOrderTitle: \"Chỉnh sửa đơn hàng - Bàn\",\n    editOrderDesc: \"Đơn hàng {orderNumber} | Thêm món hoặc chỉnh sửa số lượng\",\n    addNewItems: \"Thêm món mới\",\n    previouslyOrdered: \"Món đã gọi trước đó:\",\n    alreadyOrdered: \"Đã gọi\",\n    newItemsToAdd: \"Món mới thêm:\",\n    itemsAndNewItems: \"Món đã gọi & Món mới\",\n    previousItems: \"Món đã gọi\",\n    newItems: \"Món mới thêm\",\n    updateOrder: \"Cập nhật đơn hàng\",\n    updating: \"Đang cập nhật...\",\n    orderUpdateSuccess: \"Cập nhật đơn hàng\",\n    orderUpdateSuccessDesc: \"Đã thêm món mới vào đơn hàng thành công\",\n    updateAndRefresh: \"Cập nhật & Làm mới\",\n    pointsPaymentDialog: {\n      title: \"Thanh toán bằng điểm\",\n      description: \"Chọn khách hàng và số điểm để thanh toán đơn hàng\",\n      orderInfo: \"Thông tin đơn hàng\",\n      orderCode: \"Mã đơn:\",\n      totalAmount: \"Tổng tiền:\",\n      searchCustomer: \"Tìm kiếm khách hàng\",\n      searchPlaceholder: \"Tìm theo tên, số điện thoại hoặc mã khách hàng...\",\n      accumulatedPoints: \"Điểm tích lũy\",\n      mixedPayment: \"Thanh toán hỗn hợp\",\n    },\n    paymentMethods: {\n      cash: \"Tiền mặt\",\n      creditCard: \"Thẻ tín dụng\",\n      debitCard: \"Thẻ ghi nợ\",\n      momo: \"MoMo\",\n      zalopay: \"ZaloPay\",\n      vnpay: \"VNPay\",\n      qrCode: \"QR Code\",\n      shopeepay: \"ShopeePay\",\n      grabpay: \"GrabPay\",\n    },\n    noTableInfo: \"Không có thông tin bàn\",\n    noInput: \"Chưa nhập\",\n    payment: \"Thanh toán\",\n    orderPlaced: \"Đặt hàng\",\n    orderPlacedSuccess: \"Đơn hàng đã được đặt thành công\",\n    orderFailed: \"Đặt hàng thất bại\",\n    tableOrder: \"Đặt hàng bàn\",\n    tableCapacity: \"Số Người\",\n    status: {\n      pending: \"Chờ xử lý\",\n      confirmed: \"Đã xác nhận\",\n      preparing: \"Đang chuẩn bị\",\n      ready: \"Sẵn sàng\",\n      served: \"Đã phục vụ\",\n      paid: \"Đã thanh toán\",\n      cancelled: \"Đã hủy\",\n      delivering: \"Đang giao hàng\",\n      completed: \"Hoàn thành\",\n    },\n  },\n};","size_bytes":12776},"client/src/lib/i18n/modules/pos.ts":{"content":"export interface POSTranslations {\n  title: string;\n  cashierName: string;\n  beforeWork: string;\n  defaultCashier: string;\n  currentlyOutOfStock: string;\n  outOfStock: string;\n  inStock: string;\n  addedToCart: string;\n  categories: string;\n  allCategories: string;\n  selectCategory: string;\n  product: string;\n  products: string;\n  cart: string;\n  quantity: string;\n  totalAmount: string;\n  receiptNumber: string;\n  transactionId: string;\n  customerInfo: string;\n  customerName: string;\n  customerPhone: string;\n  paymentComplete: string;\n  thankYou: string;\n  receipt: string;\n  purchaseHistory: string;\n  today: string;\n  yesterday: string;\n  thisWeek: string;\n  thisMonth: string;\n  thisYear: string;\n  productsAvailable: string;\n  gridView: string;\n  listView: string;\n  sortByName: string;\n  sortByPrice: string;\n  sortByStock: string;\n  noProductsFound: string;\n  searchProducts: string;\n  scanBarcode: string;\n  productScanned: string;\n  scanFailed: string;\n  productNotFound: string;\n  addItemsToCart: string;\n  emptyCart: string;\n  clearCart: string;\n  checkout: string;\n  payment: string;\n  cash: string;\n  card: string;\n  debitCard: string;\n  change: string;\n  orderComplete: string;\n  printReceipt: string;\n  newOrder: string;\n  newTransaction: string;\n  paymentMethodLabel: string;\n  transactionComplete: string;\n  transactionFailed: string;\n  manageProducts: string;\n  productManager: string;\n  productName: string;\n  sku: string;\n  stock: string;\n  imageUrl: string;\n  isActive: string;\n  addProductsToStart: string;\n  allProducts: string;\n  popular: string;\n  lowStock: string;\n  stockCount: string;\n  price: string;\n  category: string;\n  description: string;\n  barcode: string;\n  costPrice: string;\n  sellingPrice: string;\n  taxRate: string;\n  discount: string;\n  unit: string;\n  supplier: string;\n  expiryDate: string;\n  batchNumber: string;\n  location: string;\n  minStock: string;\n  maxStock: string;\n  reorderPoint: string;\n  notes: string;\n  addedToCartShort: string;\n  hasBeenAddedToOrder: string;\n  receiptPreview: string;\n  cancel: string;\n  confirmAndSelectPayment: string;\n  thankYouBusiness: string;\n  keepReceiptRecords: string;\n  bulkImport: string;\n  bulkImportTitle: string;\n  bulkImportInstructions: string;\n  downloadTemplate: string;\n  fillProductInfo: string;\n  uploadAndPreview: string;\n  clickImportToComplete: string;\n  downloadTemplateButton: string;\n  selectExcelFile: string;\n  processing: string;\n  dataErrors: string;\n  dataPreview: string;\n  productsCount: string;\n  importProducts: string;\n  importing: string;\n  completedWithErrors: string;\n  errorReportDownloaded: string;\n  bulkImportSuccess: string;\n  bulkImportError: string;\n  cannotReadFile: string;\n  missingRequiredInfo: string;\n  productNameRequired: string;\n  skuRequired: string;\n  invalidPrice: string;\n  amountReceivedLabel: string;\n  invalidCategoryId: string;\n  invalidTaxRate: string;\n  duplicateSku: string;\n  productsSuccessful: string;\n  productsWithErrors: string;\n  duplicateSkuCount: string;\n  each: string;\n  mainStoreLocation: string;\n  transactionNumber: string;\n  date: string;\n  cashier: string;\n  subtotal: string;\n  tax: string;\n  total: string;\n  paymentMethod: string;\n  amountReceived: string;\n  phone: string;\n}\n\nexport const posTranslations: { [key: string]: POSTranslations } = {\n  ko: {\n    title: \"POS 시스템\",\n    cashierName: \"계산원 이름\",\n    beforeWork: \"근무자 출근전\",\n    defaultCashier: \"김담당자\",\n    currentlyOutOfStock: \"현재 품절입니다\",\n    outOfStock: \"품절\",\n    inStock: \"재고 있음\",\n    addedToCart: \"장바구니에 추가됨\",\n    categories: \"카테고리\",\n    allCategories: \"전체\",\n    selectCategory: \"카테고리 선택\",\n    product: \"상품\",\n    products: \"상품\",\n    cart: \"장바구니\",\n    quantity: \"수량\",\n    totalAmount: \"총 금액\",\n    receiptNumber: \"영수증 번호\",\n    transactionId: \"거래 ID\",\n    customerInfo: \"고객 정보\",\n    customerName: \"고객명\",\n    customerPhone: \"고객 전화번호\",\n    paymentComplete: \"결제 완료\",\n    thankYou: \"감사합니다\",\n    receipt: \"영수증\",\n    purchaseHistory: \"구매 내역\",\n    today: \"오늘\",\n    yesterday: \"어제\",\n    thisWeek: \"이번 주\",\n    thisMonth: \"이번 달\",\n    thisYear: \"올해\",\n    productsAvailable: \"개 상품 사용 가능\",\n    gridView: \"그리드 보기\",\n    listView: \"목록 보기\",\n    sortByName: \"이름순 정렬\",\n    sortByPrice: \"가격순 정렬\",\n    sortByStock: \"재고순 정렬\",\n    noProductsFound: \"상품을 찾을 수 없습니다\",\n    searchProducts: \"상품 검색...\",\n    scanBarcode: \"바코드 스캔\",\n    productScanned: \"상품 스캔됨\",\n    scanFailed: \"스캔 실패\",\n    productNotFound: \"상품을 찾을 수 없습니다\",\n    addItemsToCart: \"상품을 장바구니에 추가하여 시작하세요\",\n    emptyCart: \"장바구니가 비어있습니다\",\n    clearCart: \"장바구니 비우기\",\n    checkout: \"결제\",\n    payment: \"결제\",\n    cash: \"현금\",\n    card: \"카드\",\n    debitCard: \"직불카드\",\n    amountReceived: \"받은 금액\",\n    change: \"거스름돈\",\n    paymentMethod: \"결제 방법\",\n    orderComplete: \"주문 완료\",\n    printReceipt: \"영수증 출력\",\n    newOrder: \"새 주문\",\n    newTransaction: \"새 거래\",\n    transactionComplete: \"거래 완료\",\n    transactionFailed: \"거래 실패\",\n    manageProducts: \"상품 관리\",\n    productManager: \"상품 관리\",\n    productName: \"상품명\",\n    sku: \"SKU\",\n    stock: \"재고\",\n    imageUrl: \"이미지 URL\",\n    isActive: \"활성 상태\",\n    addProductsToStart: \"시작하려면 상품을 추가하세요\",\n    allProducts: \"모든 상품\",\n    popular: \"인기\",\n    lowStock: \"재고 부족\",\n    stockCount: \"재고 수량\",\n    price: \"가격\",\n    category: \"카테고리\",\n    description: \"설명\",\n    barcode: \"바코드\",\n    costPrice: \"원가\",\n    sellingPrice: \"판매가\",\n    taxRate: \"세율\",\n    discount: \"할인\",\n    unit: \"단위\",\n    supplier: \"공급업체\",\n    expiryDate: \"유효기간\",\n    batchNumber: \"배치 번호\",\n    location: \"위치\",\n    minStock: \"최소 재고\",\n    maxStock: \"최대 재고\",\n    reorderPoint: \"재주문 시점\",\n    notes: \"메모\",\n    addedToCartShort: \"장바구니에 추가됨\",\n    hasBeenAddedToOrder: \"이(가) 주문에 추가되었습니다\",\n    receiptPreview: \"영수증 미리보기\",\n    cancel: \"취소\",\n    confirmAndSelectPayment: \"확인 및 결제 선택\",\n    thankYouBusiness: \"이용해 주셔서 감사합니다!\",\n    bulkImport: \"일괄 가져오기\",\n    bulkImportTitle: \"일괄 가져오기\",\n    bulkImportInstructions:\n      \"Excel 파일을 다운로드하고 제품 정보를 채운 다음 업로드하여 제품을 가져옵니다.\",\n    downloadTemplate: \"템플릿 다운로드\",\n    fillProductInfo: \"제품 정보 채우기\",\n    uploadAndPreview: \"업로드 및 미리보기\",\n    clickImportToComplete: \"가져오기를 완료하려면 클릭\",\n    downloadTemplateButton: \"템플릿 다운로드\",\n    selectExcelFile: \"Excel 파일 선택\",\n    processing: \"처리 중\",\n    dataErrors: \"데이터 오류\",\n    dataPreview: \"데이터 미리보기\",\n    productsCount: \"제품 수\",\n    importProducts: \"제품 가져오기\",\n    importing: \"가져오는 중\",\n    completedWithErrors: \"오류로 완료됨\",\n    errorReportDownloaded: \"오류 보고서가 다운로드되었습니다\",\n    bulkImportSuccess: \"일괄 가져오기 성공\",\n    bulkImportError: \"일괄 가져오기 오류\",\n    cannotReadFile: \"파일을 읽을 수 없습니다\",\n    missingRequiredInfo: \"필수 정보 누락\",\n    productNameRequired: \"제품 이름을 입력해야 합니다\",\n    skuRequired: \"SKU는 필수입니다\",\n    invalidPrice: \"가격이 올바르지 않습니다\",\n    invalidCategoryId: \"잘못된 카테고리 ID\",\n    invalidTaxRate: \"잘못된 세율\",\n    duplicateSku: \"중복 SKU\",\n    productsSuccessful: \"성공적으로 가져온 제품\",\n    productsWithErrors: \"오류가 있는 제품\",\n    duplicateSkuCount: \"중복 SKU 수\",\n    each: \"개당\",\n    mainStoreLocation: \"본점 위치\",\n    transactionNumber: \"거래번T��:\",\n    date: \"날짜:\",\n    cashier: \"계산원:\",\n    subtotal: \"소계:\",\n    tax: \"세금 (8.25%):\",\n    total: \"총계:\",\n    phone: \"전화:\",\n  },\n  en: {\n    title: \"POS System\",\n    cashierName: \"Cashier Name\",\n    beforeWork: \"Before Work Start\",\n    defaultCashier: \"Default Cashier\",\n    currentlyOutOfStock: \"Currently out of stock\",\n    outOfStock: \"Out of Stock\",\n    inStock: \"In Stock\",\n    addedToCart: \"Added to cart\",\n    categories: \"Categories\",\n    allCategories: \"All\",\n    selectCategory: \"Select Category\",\n    product: \"Product\",\n    products: \"Products\",\n    cart: \"Cart\",\n    quantity: \"Quantity\",\n    totalAmount: \"Total Amount\",\n    receiptNumber: \"Receipt Number\",\n    transactionId: \"Transaction ID\",\n    customerInfo: \"Customer Info\",\n    customerName: \"Customer Name\",\n    customerPhone: \"Customer Phone\",\n    paymentComplete: \"Payment Complete\",\n    thankYou: \"Thank You\",\n    receipt: \"Receipt\",\n    purchaseHistory: \"Purchase History\",\n    today: \"Today\",\n    yesterday: \"Yesterday\",\n    thisWeek: \"This Week\",\n    thisMonth: \"This Month\",\n    thisYear: \"This Year\",\n    productsAvailable: \"products available\",\n    gridView: \"Grid View\",\n    listView: \"List View\",\n    sortByName: \"Sort by Name\",\n    sortByPrice: \"Sort by Price\",\n    sortByStock: \"Sort by Stock\",\n    noProductsFound: \"No products found\",\n    searchProducts: \"Search products...\",\n    scanBarcode: \"Scan Barcode\",\n    productScanned: \"Product Scanned\",\n    scanFailed: \"Scan Failed\",\n    productNotFound: \"Product not found\",\n    addItemsToCart: \"Add items to cart to get started\",\n    emptyCart: \"Your cart is empty\",\n    clearCart: \"Clear Cart\",\n    checkout: \"Checkout\",\n    payment: \"Payment\",\n    cash: \"Cash\",\n    card: \"Card\",\n    debitCard: \"Debit Card\",\n    amountReceived: \"Amount Received\",\n    change: \"Change\",\n    paymentMethod: \"Payment Method\",\n    orderComplete: \"Order Complete\",\n    printReceipt: \"Print Receipt\",\n    newOrder: \"New Order\",\n    newTransaction: \"New Transaction\",\n    transactionComplete: \"Transaction Complete\",\n    transactionFailed: \"Transaction Failed\",\n    manageProducts: \"Manage Products\",\n    productManager: \"Product Manager\",\n    productName: \"Product Name\",\n    sku: \"SKU\",\n    stock: \"Stock\",\n    imageUrl: \"Image URL\",\n    isActive: \"Active\",\n    addProductsToStart: \"Add products to get started\",\n    allProducts: \"All Products\",\n    popular: \"Popular\",\n    lowStock: \"Low Stock\",\n    stockCount: \"Stock Count\",\n    price: \"Price\",\n    category: \"Category\",\n    description: \"Description\",\n    barcode: \"Barcode\",\n    costPrice: \"Cost Price\",\n    sellingPrice: \"Selling Price\",\n    taxRate: \"Tax Rate\",\n    discount: \"Discount\",\n    unit: \"Unit\",\n    supplier: \"Supplier\",\n    expiryDate: \"Expiry Date\",\n    batchNumber: \"Batch Number\",\n    location: \"Location\",\n    minStock: \"Min Stock\",\n    maxStock: \"Max Stock\",\n    reorderPoint: \"Reorder Point\",\n    notes: \"Notes\",\n    addedToCartShort: \"Added to cart\",\n    hasBeenAddedToOrder: \" has been added to order\",\n    receiptPreview: \"Receipt Preview\",\n    cancel: \"Cancel\",\n    confirmAndSelectPayment: \"Confirm & Select Payment\",\n    thankYouBusiness: \"Thank you for your business!\",\n    keepReceiptRecords: \"Please keep this receipt for your records\",\n    bulkImport: \"Bulk Import\",\n    bulkImportTitle: \"Bulk Import Products\",\n    bulkImportInstructions:\n      \"Download the Excel file, fill in product information, then upload to import products.\",\n    downloadTemplate: \"Download Template\",\n    fillProductInfo: \"Fill Product Info\",\n    uploadAndPreview: \"Upload & Preview\",\n    clickImportToComplete: \"Click to Complete Import\",\n    downloadTemplateButton: \"Download Template\",\n    selectExcelFile: \"Select Excel File\",\n    processing: \"Processing\",\n    dataErrors: \"Data Errors\",\n    dataPreview: \"Data Preview\",\n    productsCount: \"Products Count\",\n    importProducts: \"Import Products\",\n    importing: \"Importing\",\n    completedWithErrors: \"Completed with Errors\",\n    errorReportDownloaded: \"Error report downloaded\",\n    bulkImportSuccess: \"Bulk Import Success\",\n    bulkImportError: \"Bulk Import Error\",\n    cannotReadFile: \"Cannot read file\",\n    missingRequiredInfo: \"Missing required info\",\n    productNameRequired: \"Product name is required\",\n    skuRequired: \"SKU is required\",\n    invalidPrice: \"Invalid price\",\n    invalidCategoryId: \"Invalid category ID\",\n    invalidTaxRate: \"Invalid tax rate\",\n    duplicateSku: \"Duplicate SKU\",\n    productsSuccessful: \"Products successful\",\n    productsWithErrors: \"Products with errors\",\n    duplicateSkuCount: \"Duplicate SKU count\",\n    each: \"each\",\n    mainStoreLocation: \"Main Store Location\",\n    transactionNumber: \"Transaction #:\",\n    date: \"Date:\",\n    cashier: \"Cashier:\",\n    subtotal: \"Subtotal:\",\n    tax: \"Tax (8.25%):\",\n    total: \"Total:\",\n    paymentMethodLabel: \"Payment Method:\",\n    amountReceivedLabel: \"Amount Received:\",\n    phone: \"Phone:\",\n  },\n  vi: {\n    title: \"Hệ thống POS\",\n    cashierName: \"Tên thu ngân\",\n    beforeWork: \"Trước khi làm việc\",\n    defaultCashier: \"Thu ngân mặc định\",\n    currentlyOutOfStock: \"Hiện tại hết hàng\",\n    outOfStock: \"Hết hàng\",\n    inStock: \"Còn hàng\",\n    addedToCart: \"Đã thêm vào giỏ\",\n    categories: \"Danh mục\",\n    allCategories: \"Tất cả\",\n    selectCategory: \"Chọn danh mục\",\n    product: \"Sản phẩm\",\n    products: \"Sản phẩm\",\n    cart: \"Giỏ hàng\",\n    quantity: \"Số lượng\",\n    totalAmount: \"Tổng tiền\",\n    receiptNumber: \"Số hóa đơn\",\n    transactionId: \"Mã giao dịch\",\n    customerInfo: \"Thông tin khách hàng\",\n    customerName: \"Tên khách hàng\",\n    customerPhone: \"Số điện thoại khách hàng\",\n    paymentComplete: \"Thanh toán hoàn tất\",\n    thankYou: \"Cảm ơn bạn\",\n    receipt: \"Hóa đơn\",\n    purchaseHistory: \"Lịch sử mua hàng\",\n    today: \"Hôm nay\",\n    yesterday: \"Hôm qua\",\n    thisWeek: \"Tuần này\",\n    thisMonth: \"Tháng này\",\n    thisYear: \"Năm nay\",\n    productsAvailable: \"sản phẩm có sẵn\",\n    gridView: \"Xem dạng lưới\",\n    listView: \"Xem dạng danh sách\",\n    sortByName: \"Sắp xếp theo tên\",\n    sortByPrice: \"Sắp xếp theo giá\",\n    sortByStock: \"Sắp xếp theo tồn kho\",\n    noProductsFound: \"Không tìm thấy sản phẩm\",\n    searchProducts: \"Tìm kiếm sản phẩm...\",\n    scanBarcode: \"Quét mã vạch\",\n    productScanned: \"Đã quét sản phẩm\",\n    scanFailed: \"Quét thất bại\",\n    productNotFound: \"Không tìm thấy sản phẩm\",\n    addItemsToCart: \"Thêm sản phẩm vào giỏ để bắt đầu\",\n    emptyCart: \"Giỏ hàng trống\",\n    clearCart: \"Xóa giỏ hàng\",\n    checkout: \"Thanh toán\",\n    payment: \"Thanh toán\",\n    cash: \"Tiền mặt\",\n    card: \"Thẻ\",\n    debitCard: \"Thẻ ghi nợ\",\n    amountReceived: \"Số tiền nhận\",\n    change: \"Tiền thối\",\n    paymentMethod: \"Phương thức thanh toán\",\n    orderComplete: \"Đơn hàng hoàn tất\",\n    printReceipt: \"In hóa đơn\",\n    newOrder: \"+ Đơn mới\",\n    newTransaction: \"Giao dịch mới\",\n    transactionComplete: \"Giao dịch hoàn tất\",\n    transactionFailed: \"Giao dịch thất bại\",\n    manageProducts: \"Quản lý sản phẩm\",\n    productManager: \"Quản lý sản phẩm\",\n    productName: \"Tên sản phẩm\",\n    sku: \"SKU\",\n    stock: \"Tồn kho\",\n    imageUrl: \"URL hình ảnh\",\n    isActive: \"Hoạt động\",\n    addProductsToStart: \"Thêm sản phẩm để bắt đầu\",\n    allProducts: \"Tất cả sản phẩm\",\n    popular: \"Phổ biến\",\n    lowStock: \"Tồn kho thấp\",\n    stockCount: \"Số lượng tồn kho\",\n    price: \"Giá\",\n    category: \"Danh mục\",\n    description: \"Mô tả\",\n    barcode: \"Mã vạch\",\n    costPrice: \"Giá gốc\",\n    sellingPrice: \"Giá bán\",\n    taxRate: \"Thuế suất\",\n    discount: \"Giảm giá\",\n    unit: \"Đơn vị\",\n    supplier: \"Nhà cung cấp\",\n    expiryDate: \"Ngày hết hạn\",\n    batchNumber: \"Số lô\",\n    location: \"Vị trí\",\n    minStock: \"Tồn kho tối thiểu\",\n    maxStock: \"Tồn kho tối đa\",\n    reorderPoint: \"Điểm đặt hàng lại\",\n    notes: \"Ghi chú\",\n    addedToCartShort: \"Đã thêm vào giỏ\",\n    hasBeenAddedToOrder: \" đã được thêm vào đơn hàng\",\n    receiptPreview: \"Xem trước hóa đơn\",\n    cancel: \"Hủy\",\n    confirmAndSelectPayment: \"Xác nhận & Chọn thanh toán\",\n    thankYouBusiness: \"Cảm ơn bạn đã mua hàng!\",\n    keepReceiptRecords: \"Vui lòng giữ hóa đơn để làm bằng chứng\",\n    bulkImport: \"Nhập hàng loạt\",\n    bulkImportTitle: \"Nhập sản phẩm hàng loạt\",\n    bulkImportInstructions:\n      \"Tải tệp Excel, điền thông tin sản phẩm, sau đó tải lên để nhập sản phẩm.\",\n    downloadTemplate: \"Tải xuống mẫu\",\n    fillProductInfo: \"Điền thông tin sản phẩm\",\n    uploadAndPreview: \"Tải lên & Xem trước\",\n    clickImportToComplete: \"Nhấp để hoàn tất nhập\",\n    downloadTemplateButton: \"Tải xuống mẫu\",\n    selectExcelFile: \"Chọn tệp Excel\",\n    processing: \"Đang xử lý\",\n    dataErrors: \"Lỗi dữ liệu\",\n    dataPreview: \"Xem trước dữ liệu\",\n    productsCount: \"Số lượng sản phẩm\",\n    importProducts: \"Nhập sản phẩm\",\n    importing: \"Đang nhập\",\n    completedWithErrors: \"Hoàn thành với lỗi\",\n    errorReportDownloaded: \"Báo cáo lỗi đã được tải xuống\",\n    bulkImportSuccess: \"Nhập hàng loạt thành công\",\n    bulkImportError: \"Lỗi nhập hàng loạt\",\n    cannotReadFile: \"Không thể đọc tệp\",\n    missingRequiredInfo: \"Thiếu thông tin bắt buộc\",\n    productNameRequired: \"Tên sản phẩm là bắt buộc\",\n    skuRequired: \"SKU là bắt buộc\",\n    invalidPrice: \"Giá không hợp lệ\",\n    invalidCategoryId: \"ID danh mục không hợp lệ\",\n    invalidTaxRate: \"Thuế suất không hợp lệ\",\n    duplicateSku: \"SKU trùng lặp\",\n    productsSuccessful: \"Sản phẩm nhập thành công\",\n    productsWithErrors: \"Sản phẩm có lỗi\",\n    duplicateSkuCount: \"Số lượng SKU trùng lặp\",\n    each: \"mỗi cái\",\n    mainStoreLocation: \"Vị trí cửa hàng chính\",\n    transactionNumber: \"Số giao dịch:\",\n    date: \"Ngày:\",\n    cashier: \"Thu ngân:\",\n    subtotal: \"Tạm tính:\",\n    tax: \"Thuế (8.25%):\",\n    total: \"Tổng cộng:\",\n    paymentMethodLabel: \"Phương thức thanh toán:\",\n    amountReceivedLabel: \"Số tiền nhận:\",\n    phone: \"Điện thoại:\",\n  },\n};\n","size_bytes":18751},"client/src/lib/i18n/modules/reports.ts":{"content":"import { type ReportsTranslations } from \"../types\";\n\nexport const reportsTranslations: { [key: string]: ReportsTranslations } = {\n  vi: {\n    title: \"Báo cáo\",\n    description: \"Xem báo cáo bán hàng và vận hành\",\n    dashboard: \"Bảng điều khiển\",\n    dashboardDescription: \"Tổng quan về doanh số và trạng thái hoạt động\",\n    salesAnalysis: \"Phân tích bán hàng\",\n    menuAnalysis: \"Phân tích menu\",\n    tableAnalysis: \"Phân tích bàn\",\n    backToTables: \"Quay lại Bàn\",\n\n    // Date and time filters\n    startDate: \"Từ ngày\",\n    endDate: \"Đến ngày\",\n    refresh: \"Làm mới\",\n    toDay: \"Hôm nay\",\n    lastWeek: \"Tuần trước\",\n    thisMonth: \"Tháng này\",\n    lastMonth: \"Tháng trước\",\n    custom: \"Tùy chỉnh\",\n\n    // Dashboard metrics\n    totalRevenue: \"Tổng thu từ bán hàng\",\n    totalOrders: \"Tổng đơn hàng\",\n    totalQuantitySold: \"Tổng số lượng bán\",\n    averageOrderValue: \"Giá trị đơn hàng trung bình\",\n    periodRevenue: \"Doanh thu kỳ\",\n    occupiedTables: \"Bàn đang sử dụng\",\n    monthRevenue: \"Doanh thu tháng\",\n    realTimeStatus: \"Trạng thái thời gian thực\",\n    pendingOrders: \"Đơn hàng đang chờ\",\n    count: \"đơn\",\n    tableUtilization: \"Sử dụng bàn\",\n    performanceMetrics: \"Chỉ số hiệu suất\",\n    salesAchievementRate: \"Tỷ lệ đạt mục tiêu bán hàng\",\n    tableTurnoverRate: \"Tỷ lệ luân chuyển bàn\",\n    targetAverageDailySales:\n      \"Mục tiêu doanh thu trung bình hàng ngày {amount}, luân chuyển {turnovers} lần/bàn\",\n\n    // Filter options\n    filterByDate: \"Lọc theo ngày\",\n    dateRange: \"Khoảng thời gian\",\n\n    // Chart titles\n    dailySalesChart: \"Biểu đồ doanh số hàng ngày\",\n    paymentMethodChart: \"Biểu đồ phương thức thanh toán\",\n    hourlyBreakdownChart: \"Phân tích theo giờ\",\n    topProductsChart: \"Sản phẩm bán chạy\",\n\n    // Payment methods\n    paymentMethodBreakdown: \"Phân tích phương thức thanh toán\",\n    paymentMethodDetails:\n      \"Chi tiết phương thức thanh toán và phân tích doanh số hàng ngày\",\n\n    // Tab names for reports\n    salesAnalysisTab: \"Báo cáo phân tích bán hàng\",\n    menuAnalysisTab: \"Báo cáo phân tích menu\",\n    tableAnalysisTab: \"Báo cáo phân tích bàn\",\n    salesChartTab: \"Báo cáo bán hàng\",\n    purchaseTab: \"Báo cáo mua hàng\",\n    warehouseTab: \"Báo cáo kho hàng\",\n    dashboardTab: \"Báo cáo bảng điều khiển\",\n\n    // Analysis types\n    analysisType: \"Loại phân tích\",\n    analyzeBy: \"Phân tích theo\",\n    analyzeRevenue: \"Phân tích doanh thu và hiệu suất\",\n    analyzeTableRevenueTrend: \"Phân tích xu hướng doanh thu theo bàn\",\n    timeAnalysis: \"Thời gian\",\n    productAnalysis: \"Sản phẩm\",\n    employeeAnalysis: \"Nhân viên\",\n    customerAnalysis: \"Khách hàng\",\n    channelAnalysis: \"Kênh bán hàng\",\n\n    // Chart and visual\n    chartView: \"Xem biểu đồ\",\n    visualRepresentation: \"Trực quan hóa dữ liệu\",\n\n    // Filter labels\n    salesMethod: \"Phương thức bán hàng\",\n    salesChannel: \"Kênh bán hàng\",\n    productFilter: \"Sản phẩm\",\n    customerFilter: \"Khách hàng\",\n    customerFilterPlaceholder: \"Tìm theo tên, số điện thoại hoặc mã\",\n    employeeFilter: \"Tìm kiếm nhân viên\",\n    employeeFilterPlaceholder: \"Tìm theo tên nhân viên\",\n    employeeId: \"Mã nhân viên\",\n    customerId: \"Mã khách hàng\",\n    customerName: \"Tên khách hàng\",\n    vip: \"Khách VIP\",\n    newCustomer: \"Khách hàng mới\",\n    inactive: \"Không hoạt động\",\n    active: \"Hoạt động\",\n\n    // Time analysis specific keys\n    timeSalesReport: \"Báo cáo bán hàng theo thời gian\",\n    invoiceDiscountReport: \"Báo cáo giảm giá hóa đơn\",\n    returnByInvoiceReport: \"Báo cáo trả hàng theo hóa đơn\",\n\n    // Sales chart table columns\n    date: \"Ngày\",\n    orderNumber: \"Số đơn hàng\",\n    subtotal: \"Tạm tính\",\n    discount: \"Giảm giá\",\n    revenue: \"Doanh thu\",\n    tax: \"Thuế\",\n    total: \"Tổng cộng\",\n    unitPrice: \"Đơn giá\",\n    amount: \"Thành tiền\",\n    exportTax: \"Thuế xuất\",\n    vatTax: \"Thuế GTGT\",\n    tableName: \"Bàn\",\n    employeeName: \"Tên nhân viên\",\n    totalCustomerPayment: \"Tổng thanh toán khách hàng\",\n    combo: \"Combo\",\n    service: \"Dịch vụ\",\n    productFilterPlaceholder: \"Tìm theo tên hoặc mã\",\n\n    // Product report columns\n    productCode: \"Mã hàng\",\n    productName: \"Tên sản phẩm\",\n    unit: \"Đơn vị\",\n    quantitySold: \"Số lượng bán\",\n    totalAmount: \"Tổng số tiền\",\n    totalDiscount: \"Tổng giảm giá\",\n    categoryName: \"Danh mục\",\n\n    // Report titles\n    inventoryReport: \"Báo cáo kho\",\n    salesReportByProduct: \"Báo cáo bán hàng theo sản phẩm\",\n    profitByInvoiceReport: \"Báo cáo lợi nhuận theo hóa đơn\",\n\n    // End of day report\n    endOfDayReport: \"Báo cáo cuối ngày\",\n    endOfDayReportTab: \"Báo cáo cuối ngày\",\n    revenueExpense: \"Thu chi\",\n    mainConcern: \"Mối quan tâm chính\",\n    sales: \"Bán hàng\",\n    inventory: \"Hàng hóa\",\n    summary: \"Tóm tắt\",\n    dateType: \"Loại ngày\",\n    singleDate: \"Ngày đơn\",\n    paymentMethodFilter: \"Lọc phương thức thanh toán\",\n    transactionTypeFilter: \"Lọc loại giao dịch\",\n    creator: \"Người tạo\",\n    employee: \"Nhân viên\",\n    customerPayment: \"Thanh toán khách hàng\",\n    customerRefund: \"Hoàn tiền khách hàng\",\n    otherExpense: \"Chi phí khác\",\n    supplierRefund: \"Hoàn tiền nhà cung cấp\",\n    supplierPayment: \"Thanh toán nhà cung cấp\",\n    printReport: \"In báo cáo\",\n    reportGenerated: \"Báo cáo được tạo\",\n    dataFrom: \"Dữ liệu từ\",\n    to: \"đến\",\n    printOptions: \"Tùy chọn in\",\n\n    // Order report - Updated to Purchase Report\n    orderReport: \"Báo cáo mua hàng\",\n    orderReportTab: \"Báo cáo mua hàng\",\n    orderReportDescription: \"Phân tích đơn mua hàng và sản phẩm\",\n    orderConcernType: \"Loại quan tâm mua hàng\",\n    transactionConcern: \"Giao dịch\",\n    productConcern: \"Sản phẩm\",\n    orderStatus: \"Trạng thái\",\n    draft: \"Nháp\",\n    confirmed: \"Đã xác nhận\",\n    delivering: \"Đang giao\",\n    completed: \"Hoàn thành\",\n    customer: \"Khách hàng\",\n    customerSearch: \"Khách hàng\",\n    customerSearchPlaceholder: \"Tìm theo tên hoặc số điện thoại\",\n    productSearch: \"Loại sản phẩm\",\n    productSearchPlaceholder: \"Tìm theo tên hoặc mã\",\n\n    // Additional order report keys\n    orderReportByTransaction: \"Báo cáo đơn hàng theo giao dịch\",\n    orderReportByProduct: \"Báo cáo đơn hàng theo sản phẩm\",\n    orderCode: \"Mã đơn hàng\",\n    orderTime: \"Thời gian đặt\",\n    orderQuantity: \"Số lượng đặt\",\n    orderValue: \"Giá trị đơn hàng\",\n    productGroup: \"Nhóm sản phẩm\",\n\n    // Purchase Report specific\n    purchaseReport: \"Báo cáo mua hàng\",\n    purchaseReportTitle: \"Báo cáo mua hàng\",\n    purchaseReportDescription: \"Báo cáo chi tiết về hoạt động mua hàng\",\n\n    // Sales chart report\n    salesChart: \"Biểu đồ bán hàng\",\n    salesChartDescription:\n      \"Báo cáo chi tiết về doanh số và phân tích theo thời gian\",\n    salesReport: \"Báo cáo bán hàng\",\n\n    // Comprehensive sales report\n    comprehensiveSalesReport: \"Báo cáo bán hàng toàn diện\",\n    timeReport: \"Báo cáo thời gian\",\n    profitReport: \"Báo cáo lợi nhuận\",\n    discountReport: \"Báo cáo giảm giá\",\n    returnReport: \"Báo cáo trả hàng\",\n    salesDetailReport: \"Chi tiết bán hàng\",\n    searchOrderCode: \"Tìm theo mã đơn bán\",\n    searchTable: \"Tìm theo bàn\",\n    pending: \"Đang chờ\",\n    table: \"Bàn\",\n    taxRate: \"Thuế suất\",\n    taxAmount: \"Số tiền thuế\",\n    group: \"Nhóm\",\n    note: \"Ghi chú\",\n    channel: \"Kênh\",\n    employeeReport: \"Báo cáo nhân viên\",\n    customerReport: \"Báo cáo khách hàng\",\n    supplierReport: \"Báo cáo nhà cung cấp\",\n    noDelivery: \"Không giao hàng\",\n    delivery: \"Giao hàng\",\n    direct: \"Trực tiếp\",\n    other: \"Khác\",\n    returnValue: \"Giá trị trả hàng\",\n    netRevenue: \"Doanh thu ròng\",\n    totalCost: \"Tổng chi phí\",\n    grossProfit: \"Lợi nhuận gộp\",\n    totalInvoices: \"Tổng hóa đơn\",\n    invoiceValue: \"Giá trị hóa đơn\",\n    invoiceDiscount: \"Giảm giá hóa đơn\",\n    returnTicketCount: \"Số vé trả hàng\",\n    seller: \"Người bán\",\n    saleDate: \"Ngày bán\",\n    paymentDate: \"Ngày thanh toán\",\n    fromDate: \"Từ ngày\",\n    toDate: \"Đến ngày\",\n    barChart: \"Biểu đồ cột\",\n    pieChart: \"Biểu đồ tròn\",\n    lineChart: \"Biểu đồ đường\",\n    dailyRevenue: \"Doanh thu hàng ngày\",\n    paymentMethodDistribution: \"Phân bổ phương thức thanh toán\",\n    hourlyRevenue: \"Doanh thu theo giờ\",\n    barChartDesc: \"Phân tích xu hướng doanh thu theo thời gian\",\n    pieChartDesc:\n      \"Phân tích phương thức thanh toán và phân tích doanh số hàng ngày\",\n    lineChartDesc:\n      \"Phân tích xu hướng doanh thu theo thời gian với biểu đồ đường\",\n\n    // Table headers for reports\n    transactionCode: \"Mã giao dịch\",\n    time: \"Thời gian\",\n    quantity: \"Số lượng\",\n    otherRevenue: \"Doanh thu khác\",\n    vat: \"VAT\",\n    actualRevenue: \"Doanh thu thực tế\",\n    receiptCode: \"Mã biên lai\",\n    payerReceiver: \"Người trả/Nhận\",\n    revenueExpenseType: \"Loại thu chi\",\n    soldQuantity: \"Số lượng bán\",\n    returnQuantity: \"Số lượng trả\",\n\n    // Dashboard specific\n    dailySales: \"Bán hàng hàng ngày\",\n    paymentMethods: \"Phương thức thanh toán\",\n    hourlyBreakdown: \"Phân tích theo giờ\",\n    orders: \"Đơn hàng\",\n    customers: \"Khách hàng\",\n    cash: \"Tiền mặt\",\n    card: \"Thẻ\",\n    credit_card: \"Thẻ tín dụng\",\n    qrbanking: \"QR Code\",\n    einvoice: \"Hóa đơn điện tử\",\n\n    // Table analysis specific\n    customerCount: \"Số lượng khách hàng\",\n    totalCustomers: \"Tổng khách hàng\",\n    turnoverRate: \"Tỷ lệ luân chuyển\",\n    tableAnalysisDescription: \"Phân tích chi tiết hiệu suất và sử dụng bàn\",\n    topRevenueTables: \"Bàn doanh thu cao nhất\",\n    topTurnoverTables: \"Bàn luân chuyển cao nhất\",\n    topUtilizationTables: \"Bàn sử dụng cao nhất\",\n    averageUtilization: \"Sử dụng trung bình\",\n    averageOrdersPerTable: \"Số đơn hàng trung bình mỗi bàn\",\n    allTables: \"Tất cả bàn\",\n    cumulativeVisitors: \"Khách tích lũy\",\n    totalByTable: \"Tổng theo bàn\",\n    detailedTablePerformance: \"Hiệu suất bàn chi tiết\",\n    detailedTablePerformanceDesc:\n      \"Xem các chỉ số hoạt động chi tiết của từng bàn\",\n    currentStatus: \"Trạng thái hiện tại\",\n    orderCount: \"Số đơn hàng\",\n    peakTime: \"Giờ cao điểm\",\n    timesPerDay: \" lần/ngày\",\n    hourUnit: \" giờ\",\n    timesUnit: \" lần\",\n    hour: \"giờ\",\n    times: \"lần\",\n\n    // Warehouse Report\n    warehouseReportTab: \"Báo cáo kho hàng\",\n    inventoryReportOfInterestType: \"Phân tích theo\",\n    warehouseReportDescription: \"Báo cáo chi tiết về hoạt động kho hàng\",\n\n    // Inventory report concern types\n    concernType: \"Phân tích theo\",\n    inOutInventory: \"Xuất nhập tồn\",\n    detailedInOutInventory: \"Xuất nhập tồn chi tiết\",\n    disposal: \"Xuất hủy\",\n\n    // Inventory report additional keys\n    inventoryValue: \"Giá trị tồn kho\",\n    profitReportByProduct: \"Báo cáo lợi nhuận theo sản phẩm\",\n    inventoryValueReport: \"Báo cáo giá trị tồn kho\",\n    inOutInventoryReport: \"Báo cáo xuất nhập tồn\",\n    detailedInOutInventoryReport: \"Báo cáo chi tiết xuất nhập tồn\",\n    disposalReport: \"Báo cáo hủy hàng\",\n    employeeSalesReport: \"Báo cáo bán hàng nhân viên\",\n    customerSalesReport: \"Báo cáo bán hàng khách hàng\",\n    supplierReportByProduct: \"Báo cáo nhà cung cấp theo sản phẩm\",\n    salePrice: \"Giá bán\",\n    saleValue: \"Giá trị bán\",\n    costPrice: \"Giá vốn\",\n    openingStock: \"Tồn đầu kỳ\",\n    openingValue: \"Giá trị đầu kỳ\",\n    openingPrice: \"Giá đầu kỳ\",\n    closingStock: \"Tồn cuối kỳ\",\n    closingValue: \"Giá trị cuối kỳ\",\n    inQuantity: \"Số lượng nhập\",\n    outQuantity: \"Số lượng xuất\",\n    outValue: \"Giá trị xuất\",\n    inSupplier: \"Nhập từ NCC\",\n    inCheck: \"Nhập kiểm kê\",\n    inReturn: \"Nhập trả lại\",\n    inTransfer: \"Nhập điều chuyển\",\n    inProduction: \"Nhập sản xuất\",\n    outSale: \"Xuất bán hàng\",\n    outDisposal: \"Xuất hủy\",\n    outSupplier: \"Xuất trả NCC\",\n    outCheck: \"Xuất kiểm kê\",\n    outTransfer: \"Xuất điều chuyển\",\n    outProduction: \"Xuất sản xuất\",\n    totalDisposed: \"Tổng hủy\",\n    employeeCount: \"Số nhân viên\",\n    quantityPurchased: \"Số lượng mua\",\n    supplierCount: \"Số nhà cung cấp\",\n    inValue: \"Giá trị nhập\",\n\n    // Additional missing keys\n    period: \"Kỳ\",\n    noDataDescription: \"Không có dữ liệu để hiển thị\",\n    monthAccumulated: \"Tháng tích lũy\",\n    peakHour: \"Giờ cao điểm\",\n    filters: \"Bộ lọc\",\n    applyFilters: \"Áp dụng bộ lọc\",\n    resetFilters: \"Đặt lại bộ lọc\",\n    uniqueProducts: \"Sản phẩm độc đáo\",\n\n    // Chart specific\n    value: \"Giá trị\",\n    chartData: \"Dữ liệu biểu đồ\",\n    xAxis: \"Trục X\",\n    yAxis: \"Trục Y\",\n    legend: \"Chú thích\",\n    dataPoints: \"Điểm dữ liệu\",\n\n    // Menu analysis\n    productPerformance: \"Hiệu suất sản phẩm\",\n    categoryPerformance: \"Hiệu suất danh mục\",\n    topSellingItems: \"Sản phẩm bán chạy nhất\",\n    topRevenueItems: \"Sản phẩm doanh thu cao nhất\",\n    categoryBreakdown: \"Phân tích theo danh mục\",\n    itemPerformance: \"Hiệu suất sản phẩm\",\n    salesTrend: \"Xu hướng bán hàng\",\n    profitMargin: \"Tỷ suất lợi nhuận\",\n    costAnalysis: \"Phân tích chi phí\",\n    stockMovement: \"Di chuyển tồn kho\",\n    menuAnalysisDescription: \"Phân tích hiệu suất menu và sản phẩm bán chạy\",\n    // Missing keys for menu report\n    menuItems: \"Món ăn\",\n    itemsSold: \"Đã bán\",\n    revenueShare: \"Phần doanh thu\",\n    salesShare: \"Phần bán hàng\",\n    popularMenuByQuantity: \"Món phổ biến theo số lượng\",\n    popularMenuByQuantityDesc: \"Top món được bán nhiều nhất theo số lượng\",\n    highRevenueMenu: \"Món doanh thu cao\",\n    highRevenueMenuDesc: \"Top món có doanh thu cao nhất\",\n    rank: \"Xếp hạng\",\n    menuName: \"Tên món\",\n    salesCount: \"Số lượng bán\",\n    noCategoryData: \"Không có dữ liệu danh mục\",\n    noSalesData: \"Không có dữ liệu bán hàng\",\n    noRevenueData: \"Không có dữ liệu doanh thu\",\n    productType: \"Loại sản phẩm\",\n    product: \"Sản phẩm\",\n    // Table analysis\n    tablePerformance: \"Hiệu suất bàn\",\n    utilizationRate: \"Tỷ lệ sử dụng\",\n    averageRevenue: \"Doanh thu trung bình\",\n    peakHours: \"Giờ cao điểm\",\n    revenuePerTable: \"Doanh thu mỗi bàn\",\n    ordersPerTable: \"Đn hàng mỗi bàn\",\n\n    // Sales report specific\n    salesReportDescription: \"Phân tích chi tiết về doanh số bán hàng\",\n    loading: \"Đang tải\",\n    noData: \"Không có dữ liệu\",\n    noPaymentData: \"Không có dữ liệu thanh toán\",\n    noPaymentDataDescription:\n      \"Chưa có giao dịch thanh toán nào trong khoảng thời gian được chọn\",\n    salesDetails: \"Chi tiết bán hàng\",\n    revenueExpenseDetails: \"Chi tiết thu chi\",\n    inventoryDetails: \"Chi tiết hàng hóa\",\n    noReportData: \"Không có dữ liệu báo cáo\",\n    centralBranch: \"Chi nhánh trung tâm\",\n\n    // Report specific content\n    salesReportTitle: \"Báo cáo bán hàng\",\n    revenueReportTitle: \"Báo cáo doanh thu\",\n    inventoryReportTitle: \"Báo cáo hàng hóa\",\n    summaryReportTitle: \"Báo cáo tóm tắt\",\n\n    // Table detail headers\n    salesDetailsHeader: \"Chi tiết bán hàng\",\n    revenueExpenseDetailsHeader: \"Chi tiết thu chi\",\n    inventoryDetailsHeader: \"Chi tiết hàng hóa\",\n\n    // Additional transaction types\n    totalTransactions: \"Tổng giao dịch\",\n    income: \"Thu nhập\",\n    expenses: \"Chi phí\",\n    netProfit: \"Lợi nhuận ròng\",\n    transactionDetails: \"Chi tiết giao dịch\",\n    transactionId: \"ID giao dịch\",\n    method: \"Phương thức\",\n    notes: \"Ghi chú\",\n    cashPayment: \"Thanh toán tiền mặt\",\n    cardPayment: \"Thanh toán thẻ\",\n    transfer: \"Chuyển khoản\",\n    wallet: \"Ví điện tử\",\n    // Status\n    status: \"Trạng thái\",\n    // Additional report sections\n    detailedAnalysis: \"Phân tích chi tiết\",\n    quickSummary: \"Tóm tắt nhanh\",\n    comparisonReport: \"Báo cáo so sánh\",\n    trendsAndInsights: \"Xu hướng và thông tin chi tiết\",\n    performanceIndicators: \"Chỉ số hiệu suất\",\n    financialMetrics: \"Chỉ số tài chính\",\n    operationalMetrics: \"Chỉ số vận hành\",\n    customerMetrics: \"Chỉ số khách hàng\",\n\n    // Sales channel report specific\n    dineIn: \"Ăn tại chỗ\",\n    takeaway: \"Mang về\",\n    cancelled: \"Đã hủy\",\n\n    // Financial reports\n    financialReport: \"Báo cáo tài chính\",\n    financialReportDescription: \"Báo cáo chi tiết về tình hình tài chính\",\n    profitLoss: \"Lãi lỗ\",\n    balanceSheet: \"Bảng cân đối kế toán\",\n    cashFlow: \"Dòng tiền\",\n\n    // Customer reports\n    channelSalesReport: \"Báo cáo bán hàng kênh\",\n\n    // Supplier reports\n    supplierReportDescription: \"Báo cáo chi tiết về nhà cung cấp\",\n    supplierPerformance: \"Hiệu suất nhà cung cấp\",\n\n    // Inventory reports\n    inventoryReportDescription: \"Báo cáo chi tiết về tồn kho\",\n    stockLevel: \"Mức tồn kho\",\n    stockMovementReport: \"Báo cáo di chuyển kho\",\n    lowStockAlert: \"Cảnh báo tồn kho thấp\",\n\n    // Additional menu items\n    warehouseReport: \"Báo cáo kho\",\n    // Chart and filter labels\n    selectDateRange: \"Chọn khoảng thời gian\",\n    applyFilter: \"Áp dụng bộ lọc\",\n    clearFilter: \"Xóa bộ lọc\",\n    exportData: \"Xuất dữ liệu\",\n\n    // Data display\n    noDataAvailable: \"Không có dữ liệu\",\n    loadingData: \"Đang tải dữ liệu...\",\n    errorLoadingData: \"Lỗi khi tải dữ liệu\",\n  },\n\n  ko: {\n    title: \"보고서\",\n    description: \"판매 및 운영 보고서 보기\",\n    dashboard: \"대시보드\",\n    dashboardDescription: \"총 매출 및 운영 상태 대시보드\",\n    salesAnalysis: \"매출 분석\",\n    menuAnalysis: \"메뉴 분석\",\n    tableAnalysis: \"테이블 분석\",\n    backToTables: \"테이블로 돌아가기\",\n\n    // Date and time filters\n    startDate: \"시작일\",\n    endDate: \"종료일\",\n    refresh: \"새로고침\",\n    toDay: \"오늘\",\n    lastWeek: \"지난주\",\n    thisMonth: \"이번 달\",\n    lastMonth: \"지난 달\",\n    custom: \"사용자 정의\",\n\n    // Dashboard metrics\n    totalRevenue: \"총 매출\",\n    totalOrders: \"총 주문\",\n    totalQuantitySold: \"총 판매량\",\n    averageOrderValue: \"평균 주문 가치\",\n    periodRevenue: \"기간 매출\",\n    occupiedTables: \"사용 중인 테이블\",\n    monthRevenue: \"월 매출\",\n    realTimeStatus: \"실시간 현황\",\n    pendingOrders: \"대기 주문\",\n    count: \"개\",\n    tableUtilization: \"테이블 이용률\",\n    performanceMetrics: \"성과 지표\",\n    salesAchievementRate: \"매출 달성률\",\n    tableTurnoverRate: \"테이블 회전율\",\n    targetAverageDailySales:\n      \"목표 일평균 매출 {amount}, 회전율 {turnovers}회/테이블\",\n\n    // Filter options\n    filterByDate: \"날짜별 필터\",\n    dateRange: \"날짜 범위\",\n\n    // Chart titles\n    dailySalesChart: \"일일 매출 차트\",\n    paymentMethodChart: \"결제 방법 차트\",\n    hourlyBreakdownChart: \"시간별 분석\",\n    topProductsChart: \"인기 상품\",\n\n    // Payment methods\n    paymentMethodBreakdown: \"결제 방법 분석\",\n    paymentMethodDetails: \"결제 방법별 세부 분석 및 일일 매출 분석\",\n\n    // Tab names for reports\n    salesAnalysisTab: \"매출 분석 보고서\",\n    menuAnalysisTab: \"메뉴 분석 보고서\",\n    tableAnalysisTab: \"테이블 분석 보고서\",\n    salesChartTab: \"매출 보고서\",\n    purchaseTab: \"구매 보고서\",\n    warehouseTab: \"창고 보고서\",\n    dashboardTab: \"대시보드 보고서\",\n\n    // Analysis types\n    analysisType: \"분석 유형\",\n    analyzeBy: \"분석 기준\",\n    analyzeRevenue: \"매출 및 성과 분석\",\n    analyzeTableRevenueTrend: \"테이블별 매출 동향 분석\",\n    timeAnalysis: \"시간\",\n    productAnalysis: \"상품\",\n    employeeAnalysis: \"직원\",\n    customerAnalysis: \"고객\",\n    channelAnalysis: \"판매 채널\",\n\n    // Chart and visual\n    chartView: \"차트 보기\",\n    visualRepresentation: \"데이터 시각화\",\n\n    // Filter labels\n    salesMethod: \"판매 방법\",\n    salesChannel: \"판매 채널\",\n    productFilter: \"상품\",\n    productFilterPlaceholder: \"코드, 이름으로 검색\",\n    customerFilter: \"고객\",\n    customerFilterPlaceholder: \"이름, 전화번호 또는 코드로 검색\",\n    employeeFilter: \"직원 검색\",\n    employeeFilterPlaceholder: \"직원 이름으로 검색\",\n    employeeId: \"직원 ID\",\n    customerId: \"고객 ID\",\n    customerName: \"고객명\",\n\n    // Sales chart table columns\n    date: \"날짜\",\n    orderNumber: \"주문 번호\",\n    subtotal: \"소계\",\n    discount: \"할인\",\n    revenue: \"매출\",\n    tax: \"세금\",\n    total: \"합계\",\n    totalCustomerPayment: \"총 고객 결제\",\n    productType: \"상품 유형\",\n    productGroup: \"상품 그룹\",\n    combo: \"콤보\",\n    product: \"상품\",\n    service: \"서비스\",\n\n    // Product report columns\n    productCode: \"상품 코드\",\n    productName: \"상품명\",\n    unit: \"단위\",\n    quantitySold: \"판매 수량\",\n    totalAmount: \"총 금액\",\n    totalDiscount: \"총 할인\",\n    categoryName: \"카테고리\",\n\n    // Report titles\n    timeSalesReport: \"시간별 매출 보고서\",\n    inventoryReport: \"창고 보고서\",\n    salesReportByProduct: \"상품별 매출 보고서\",\n    profitByInvoiceReport: \"송장별 수익 보고서\",\n    invoiceDiscountReport: \"송장 할인 보고서\",\n    returnByInvoiceReport: \"송장별 반품 보고서\",\n\n    // End of day report\n    endOfDayReport: \"마감 보고서\",\n    endOfDayReportTab: \"마감 보고서\",\n    revenueExpense: \"수입 지출\",\n    mainConcern: \"주요 관심사\",\n    sales: \"판매\",\n    inventory: \"재고\",\n    summary: \"요약\",\n    dateType: \"날짜 유형\",\n    singleDate: \"단일 날짜\",\n    paymentMethodFilter: \"결제 방법 필터\",\n    transactionTypeFilter: \"거래 유형 필터\",\n    creator: \"생성자\",\n    employee: \"직원\",\n    customerPayment: \"고객 결제\",\n    customerRefund: \"고객 환불\",\n    otherExpense: \"기타 비용\",\n    supplierRefund: \"공급업체 환불\",\n    supplierPayment: \"공급업체 지불\",\n    printReport: \"보고서 인쇄\",\n    reportGenerated: \"보고서 생성됨\",\n    dataFrom: \"데이터 기간\",\n    to: \"~\",\n    printOptions: \"인쇄 옵션\",\n\n    // Order report - Updated to Purchase Report\n    orderReport: \"구매 보고서\",\n    orderReportTab: \"구매 보고서\",\n    orderReportDescription: \"구매 주문 및 상품 분석\",\n    orderConcernType: \"구매 관심사 유형\",\n    transactionConcern: \"거래\",\n    productConcern: \"상품\",\n    orderStatus: \"상태\",\n    draft: \"임시저장\",\n    confirmed: \"확인됨\",\n    delivering: \"배송중\",\n    customer: \"고객\",\n    customerSearch: \"고객\",\n    customerSearchPlaceholder: \"이름 또는 전화번호로 검색\",\n    productSearch: \"상품 유형\",\n    productSearchPlaceholder: \"이름 또는 코드로 검색\",\n\n    // Additional order report keys\n    orderReportByTransaction: \"거래별 주문 보고서\",\n    orderReportByProduct: \"상품별 주문 보고서\",\n    orderCode: \"주문 코드\",\n    customerCode: \"고객 코드\",\n    orderTime: \"주문 시간\",\n    orderQuantity: \"주문 수량\",\n    orderValue: \"주문 가치\",\n\n    // Purchase Report specific\n    purchaseReport: \"구매 보고서\",\n    purchaseReportTitle: \"구매 보고서\",\n    purchaseReportDescription: \"구매 활동에 대한 상세 보고서\",\n\n    // Sales chart report\n    salesChart: \"매출 차트\",\n    salesChartDescription: \"매출 세부 분석 및 시간별 분석\",\n    salesReport: \"매출 보고서\",\n\n    // Comprehensive sales report\n    comprehensiveSalesReport: \"종합 매출 보고서\",\n    concernType: \"관심사 유형\",\n    timeReport: \"시간 보고서\",\n    profitReport: \"수익 보고서\",\n    discountReport: \"할인 보고서\",\n    returnReport: \"반품 보고서\",\n    salesDetailReport: \"판매 세부사항\",\n    searchOrderCode: \"판매 코드로 검색\",\n    searchTable: \"테이블로 검색\",\n    pending: \"대기중\",\n    completed: \"완료됨\",\n    unitPrice: \"단가\",\n    amount: \"금액\",\n    exportTax: \"수출세\",\n    vatTax: \"부가세\",\n    tableName: \"테이블명\",\n    table: \"테이블\",\n    employeeName: \"직원명\",\n    taxRate: \"세율\",\n    taxAmount: \"세액\",\n    group: \"그룹\",\n    note: \"메모\",\n    channel: \"채널\",\n    employeeReport: \"직원 보고서\",\n    customerReport: \"고객 보고서\",\n    supplierReport: \"공급업체 보고서\",\n    noDelivery: \"배송 없음\",\n    delivery: \"배송\",\n    direct: \"직접\",\n    other: \"기타\",\n    returnValue: \"반품 가치\",\n    netRevenue: \"순매출\",\n    totalCost: \"총 비용\",\n    grossProfit: \"총 이익\",\n    totalInvoices: \"총 송장\",\n    invoiceValue: \"송장 가치\",\n    invoiceDiscount: \"송장 할인\",\n    returnTicketCount: \"반품 티켓 수\",\n    seller: \"판매자\",\n    saleDate: \"판매일\",\n    paymentDate: \"결제일\",\n    fromDate: \"시작일\",\n    toDate: \"종료일\",\n    barChart: \"막대 차트\",\n    pieChart: \"원형 차트\",\n    lineChart: \"선형 차트\",\n    dailyRevenue: \"일일 매출\",\n    paymentMethodDistribution: \"결제 방법 분포\",\n    hourlyRevenue: \"시간별 매출\",\n    barChartDesc: \"시간에 따른 매출 추세 분석\",\n    pieChartDesc: \"결제 방법별 세부 분석 및 일일 매출 분석\",\n    lineChartDesc: \"선형 차트로 시간에 따른 매출 추세 분석\",\n\n    // Table headers for reports\n    transactionCode: \"거래 코드\",\n    time: \"시간\",\n    quantity: \"수량\",\n    otherRevenue: \"기타 수익\",\n    vat: \"VAT\",\n    actualRevenue: \"실제 수익\",\n    receiptCode: \"영수증 코드\",\n    payerReceiver: \"지불자/수취인\",\n    revenueExpenseType: \"수입 지출 유형\",\n    soldQuantity: \"판매 수량\",\n    returnQuantity: \"반품 수량\",\n\n    // Dashboard specific\n    dailySales: \"일일 판매\",\n    paymentMethods: \"결제 방법\",\n    hourlyBreakdown: \"시간별 분석\",\n    orders: \"주문\",\n    customers: \"고객\",\n    cash: \"현금\",\n    card: \"카드\",\n    credit_card: \"신용카드\",\n    qrbanking: \"QR 코드\",\n    einvoice: \"전자 인보이스\",\n\n    // Table analysis specific\n    customerCount: \"고객 수\",\n    totalCustomers: \"총 고객\",\n    turnoverRate: \"회전율\",\n    tableAnalysisDescription: \"테이블 성과 및 이용률에 대한 상세 분석\",\n    topRevenueTables: \"최고 매출 테이블\",\n    topTurnoverTables: \"최고 회전율 테이블\",\n    topUtilizationTables: \"최고 이용률 테이블\",\n    averageUtilization: \"평균 이용률\",\n    averageOrdersPerTable: \"테이블당 평균 주문 수\",\n    allTables: \"모든 테이블\",\n    cumulativeVisitors: \"누적 방문자\",\n    totalByTable: \"테이블별 총계\",\n    detailedTablePerformance: \"상세 테이블 성과\",\n    detailedTablePerformanceDesc: \"각 테이블의 상세 운영 지표 확인\",\n    currentStatus: \"현재 상태\",\n    orderCount: \"주문 수\",\n    peakTime: \"피크 시간\",\n    timesPerDay: \" 회/일\",\n    hourUnit: \" 시간\",\n    timesUnit: \" 회\",\n    hour: \"시\",\n    times: \"회\",\n\n    // Warehouse Report\n    warehouseReportTab: \"창고 활동 보고서\",\n    inventoryReportOfInterestType: \"분석 기준\",\n    warehouseReportDescription: \"창고 활동에 대한 상세 보고서\",\n\n    // Inventory report concern types\n    inventoryValue: \"재고 가치\",\n    inOutInventory: \"입출고\",\n    detailedInOutInventory: \"상세 입출고\",\n    disposal: \"폐기\",\n\n    // Inventory report additional keys\n    profitReportByProduct: \"상품별 수익 보고서\",\n    inventoryValueReport: \"재고 가치 보고서\",\n    inOutInventoryReport: \"입출고 보고서\",\n    detailedInOutInventoryReport: \"상세 입출고 보고서\",\n    disposalReport: \"폐기 보고서\",\n    employeeSalesReport: \"직원 판매 보고서\",\n    customerSalesReport: \"고객 판매 보고서\",\n    supplierReportByProduct: \"상품별 공급업체 보고서\",\n    salePrice: \"판매가\",\n    saleValue: \"판매 가치\",\n    costPrice: \"원가\",\n    openingStock: \"기초 재고\",\n    openingValue: \"기초 가치\",\n    openingPrice: \"기초 가격\",\n    closingStock: \"기말 재고\",\n    closingValue: \"기말 가치\",\n    inQuantity: \"입고 수량\",\n    outQuantity: \"출고 수량\",\n    outValue: \"출고 가치\",\n    inSupplier: \"공급업체 입고\",\n    inCheck: \"점검 입고\",\n    inReturn: \"반품 입고\",\n    inTransfer: \"이동 입고\",\n    inProduction: \"생산 입고\",\n    outSale: \"판매 출고\",\n    outDisposal: \"폐기 출고\",\n    outSupplier: \"공급업체 출고\",\n    outCheck: \"점검 출고\",\n    outTransfer: \"이동 출고\",\n    outProduction: \"생산 출고\",\n    totalDisposed: \"총 폐기량\",\n    employeeCount: \"직원 수\",\n    quantityPurchased: \"구매 수량\",\n    supplierCount: \"공급업체 수\",\n    inValue: \"입고 가치\",\n\n    // Additional missing keys\n    period: \"기간\",\n    noDataDescription: \"표시할 데이터가 없습니다\",\n    monthAccumulated: \"월 누적\",\n    peakHour: \"피크 시간\",\n    filters: \"필터\",\n    applyFilters: \"필터 적용\",\n    resetFilters: \"필터 재설정\",\n    uniqueProducts: \"고유 상품\",\n\n    // Chart specific\n    value: \"값\",\n    chartData: \"차트 데이터\",\n    xAxis: \"X축\",\n    yAxis: \"Y축\",\n    legend: \"범례\",\n    dataPoints: \"데이터 포인트\",\n\n    // Menu analysis\n    productPerformance: \"상품 성과\",\n    categoryPerformance: \"카테고리 성과\",\n    topSellingItems: \"최고 판매 상품\",\n    topRevenueItems: \"최고 매출 상품\",\n    categoryBreakdown: \"카테고리별 분석\",\n    itemPerformance: \"상품 성과\",\n    salesTrend: \"판매 트렌드\",\n    profitMargin: \"이rt률\",\n    costAnalysis: \"비용 분석\",\n    stockMovement: \"재고 움직임\",\n    menuAnalysisDescription: \"메뉴 및 상품 성과에 대한 상세 분석\",\n\n    // Table Analysis\n\n    // Missing keys for menu report\n    menuItems: \"메뉴 항목\",\n    itemsSold: \"판매됨\",\n    revenueShare: \"매출 점유율\",\n    salesShare: \"판매 점유율\",\n    popularMenuByQuantity: \"인기 메뉴(수량별)\",\n    popularMenuByQuantityDesc: \"수량별 가장 많이 팔린 메뉴\",\n    highRevenueMenu: \"고수익 메뉴\",\n    highRevenueMenuDesc: \"매출이 가장 높은 메뉴\",\n    rank: \"순위\",\n    menuName: \"메뉴명\",\n    salesCount: \"판매 수량\",\n    noCategoryData: \"카테고리 데이터 없음\",\n    noSalesData: \"판매 데이터 없음\",\n    noRevenueData: \"매출 데이터 없음\",\n\n    // Table analysis\n    tablePerformance: \"테이블 성과\",\n    utilizationRate: \"이용률\",\n    averageRevenue: \"평균 매출\",\n    peakHours: \"피크 시간대\",\n    revenuePerTable: \"테이블당 매출\",\n    ordersPerTable: \"테이블당 주문\",\n\n    // Sales report specific\n    salesReportDescription: \"매출에 대한 상세 분석\",\n    loading: \"로딩 중\",\n    noData: \"데이터 없음\",\n    noPaymentData: \"결제 데이터 없음\",\n    noPaymentDataDescription: \"선택한 기간에 결제 거래가 없습니다\",\n    salesDetails: \"매출 세부사항\",\n    revenueExpenseDetails: \"수입 지출 세부사항\",\n    inventoryDetails: \"재고 세부사항\",\n    noReportData: \"보고서 데이터 없음\",\n    centralBranch: \"중앙 지점\",\n\n    // Report specific content\n    salesReportTitle: \"매출 보고서\",\n    revenueReportTitle: \"수익 보고서\",\n    inventoryReportTitle: \"재고 보고서\",\n    summaryReportTitle: \"요약 보고서\",\n\n    // Table detail headers\n    salesDetailsHeader: \" 출 세부사항\",\n    revenueExpenseDetailsHeader: \"수입 지출 세부사항\",\n    inventoryDetailsHeader: \"재고 세부사항\",\n\n    // Additional transaction types\n    totalTransactions: \"총 거래\",\n    income: \"수입\",\n    expenses: \"지출\",\n    netProfit: \"순이익\",\n    transactionDetails: \"거래 세부사항\",\n    transactionId: \"거래 ID\",\n    method: \"방법\",\n    notes: \"메모\",\n    cashPayment: \"현금 결제\",\n    cardPayment: \"카드 결제\",\n    transfer: \"이체\",\n    wallet: \"전자지갑\",\n\n    // Status\n    status: \"상태\",\n    active: \"활성\",\n    inactive: \"비활성\",\n\n    // Additional report sections\n    detailedAnalysis: \"상세 분석\",\n    quickSummary: \"빠른 요약\",\n    comparisonReport: \"비교 보고서\",\n    trendsAndInsights: \"트렌드 및 인사이트\",\n    performanceIndicators: \"성과 지표\",\n    financialMetrics: \"재무 지표\",\n    operationalMetrics: \"운영 지표\",\n    customerMetrics: \"고객 지표\",\n\n    // Sales channel report specific\n    dineIn: \"매장 식사\",\n    takeaway: \"포장\",\n    cancelled: \"취소됨\",\n\n    // Financial reports\n    financialReport: \"재무 보고서\",\n    financialReportDescription: \"재무 상황에 대한 상세 보고서\",\n    profitLoss: \"손익\",\n    balanceSheet: \"대차대조표\",\n    cashFlow: \"현금 흐름\",\n\n    // Customer reports\n    channelSalesReport: \"채널 매출 보고서\",\n\n    // Supplier reports\n    supplierReportDescription: \"공급업체에 대한 상세 보고서\",\n    supplierPerformance: \"공급업체 성과\",\n\n    // Inventory reports\n    inventoryReportDescription: \"재고에 대한 상세 보고서\",\n    stockLevel: \"재고 수준\",\n    stockMovementReport: \"재고 이동 보고서\",\n    lowStockAlert: \"낮은 재고 경고\",\n\n    // Additional menu items\n    warehouseReport: \"창고 보고서\",\n\n    // Chart and filter labels\n    selectDateRange: \"날짜 범위 선택\",\n    applyFilter: \"필터 적용\",\n    clearFilter: \"필터 지우기\",\n    exportData: \"데이터 내보내기\",\n\n    // Data display\n    noDataAvailable: \"데이터 없음\",\n    loadingData: \"데이터 로딩 중...\",\n    errorLoadingData: \"데이터 로딩 오류\",\n    totalSalesRevenue: \"총 판매 수익\",\n  },\n\n  en: {\n    title: \"Tổng thu từ bán hàng\",\n    description: \"View sales and operational reports\",\n    dashboard: \"Dashboard\",\n    dashboardDescription: \"Dashboard of total sales and operational status\",\n    salesAnalysis: \"Sales Analysis\",\n    menuAnalysis: \"Menu Analysis\",\n    tableAnalysis: \"Table Analysis\",\n    backToTables: \"Back to Tables\",\n\n    // Date and time filters\n    startDate: \"Start Date\",\n    endDate: \"End Date\",\n    refresh: \"Refresh\",\n    toDay: \"Today\",\n    lastWeek: \"Last Week\",\n    thisMonth: \"This Month\",\n    lastMonth: \"Last Month\",\n    custom: \"Custom\",\n\n    // Dashboard metrics\n    totalRevenue: \"Total Sales Revenue\",\n    totalOrders: \"Total Orders\",\n    totalQuantitySold: \"Total Quantity Sold\",\n    averageOrderValue: \"Average Order Value\",\n    periodRevenue: \"Period Revenue\",\n    occupiedTables: \"Occupied Tables\",\n    monthRevenue: \"Monthly Revenue\",\n    realTimeStatus: \"Real-time Status\",\n    pendingOrders: \"Pending Orders\",\n    count: \"orders\",\n    tableUtilization: \"Table Utilization\",\n    performanceMetrics: \"Performance Metrics\",\n    salesAchievementRate: \"Sales Achievement Rate\",\n    tableTurnoverRate: \"Table Turnover Rate\",\n    targetAverageDailySales:\n      \"Target daily average sales {amount}, turnovers {turnovers} times/table\",\n\n    // Filter options\n    filterByDate: \"Filter by Date\",\n    dateRange: \"Date Range\",\n\n    // Chart titles\n    dailySalesChart: \"Daily Sales Chart\",\n    paymentMethodChart: \"Payment Method Chart\",\n    hourlyBreakdownChart: \"Hourly Breakdown\",\n    topProductsChart: \"Top Products\",\n\n    // Payment methods\n    paymentMethodBreakdown: \"Payment Method Breakdown\",\n    paymentMethodDetails:\n      \"Payment method detailed analysis and daily sales breakdown\",\n\n    // Tab names for reports\n    salesAnalysisTab: \"Sales Analysis Report\",\n    menuAnalysisTab: \"Menu Analysis Report\",\n    tableAnalysisTab: \"Table Analysis Report\",\n    salesChartTab: \"Sales Report\",\n    purchaseTab: \"Purchase Report\",\n    warehouseTab: \"Warehouse Report\",\n    dashboardTab: \"Dashboard Report\",\n\n    // Analysis types\n    analysisType: \"Analysis Type\",\n    analyzeBy: \"Analyze By\",\n    analyzeRevenue: \"Analyze revenue and performance\",\n    analyzeTableRevenueTrend: \"Analyze table revenue trends\",\n    timeAnalysis: \"Time\",\n    productAnalysis: \"Product\",\n    employeeAnalysis: \"Employee\",\n    customerAnalysis: \"Customer\",\n    channelAnalysis: \"Sales Channel\",\n\n    // Chart and visual\n    chartView: \"Chart View\",\n    visualRepresentation: \"Visual representation of data\",\n\n    // Filter labels\n    salesMethod: \"Sales Method\",\n    salesChannel: \"Sales Channel\",\n    productFilter: \"Product\",\n    productFilterPlaceholder: \"Search by code, name\",\n    customerFilter: \"Customer\",\n    customerFilterPlaceholder: \"Search by name, phone or code\",\n    employeeFilter: \"Employee Search\",\n    employeeFilterPlaceholder: \"Search by employee name\",\n    employeeId: \"Employee ID\",\n    customerId: \"Customer ID\",\n    customerName: \"Customer Name\",\n    vip: \"VIP Customer\",\n    newCustomer: \"New Customer\",\n    inactive: \"Inactive\",\n    active: \"Active\",\n\n    // Sales chart table columns\n    date: \"Date\",\n    orderNumber: \"Order Number\",\n    subtotal: \"Subtotal\",\n    discount: \"Discount\",\n    revenue: \"Revenue\",\n    tax: \"Tax\",\n    total: \"Total\",\n    totalCustomerPayment: \"Total Customer Payment\",\n\n    // Product report columns\n    productCode: \"Product Code\",\n    productName: \"Product Name\",\n    unit: \"Unit\",\n    quantitySold: \"Quantity Sold\",\n    totalAmount: \"Total Amount\",\n    totalDiscount: \"Total Discount\",\n    categoryName: \"Category\",\n\n    // Report titles\n    timeSalesReport: \"Time Sales Report\",\n    inventoryReport: \"Warehouse Report\",\n    salesReportByProduct: \"Sales Report by Product\",\n    profitByInvoiceReport: \"Profit by Invoice Report\",\n    invoiceDiscountReport: \"Invoice Discount Report\",\n    returnByInvoiceReport: \"Return by Invoice Report\",\n\n    // End of day report\n    endOfDayReport: \"End of Day Report\",\n    endOfDayReportTab: \"End of Day Report\",\n    revenueExpense: \"Revenue Expense\",\n    mainConcern: \"Main Concern\",\n    sales: \"Sales\",\n    inventory: \"Inventory\",\n    summary: \"Summary\",\n    dateType: \"Date Type\",\n    singleDate: \"Single Date\",\n    paymentMethodFilter: \"Payment Method Filter\",\n    transactionTypeFilter: \"Transaction Type Filter\",\n    creator: \"Creator\",\n    employee: \"Employee\",\n    customerPayment: \"Customer Payment\",\n    customerRefund: \"Customer Refund\",\n    otherExpense: \"Other Expense\",\n    supplierRefund: \"Supplier Refund\",\n    supplierPayment: \"Supplier Payment\",\n    printReport: \"Print Report\",\n    reportGenerated: \"Report Generated\",\n    dataFrom: \"Data From\",\n    to: \"to\",\n    printOptions: \"Print Options\",\n\n    // Order report - Updated to Purchase Report\n    orderReport: \"Purchase Report\",\n    orderReportTab: \"Purchase Report\",\n    orderReportDescription: \"Purchase order and product analysis\",\n    orderConcernType: \"Purchase Concern Type\",\n    transactionConcern: \"Transaction\",\n    productConcern: \"Product\",\n    orderStatus: \"Status\",\n    draft: \"Draft\",\n    confirmed: \"Confirmed\",\n    delivering: \"Delivering\",\n    completed: \"Completed\",\n    customer: \"Customer\",\n    customerSearch: \"Customer\",\n    customerSearchPlaceholder: \"Search by name or phone\",\n    productSearchPlaceholder: \"Search by name or code\",\n\n    // Additional order report keys\n    orderReportByTransaction: \"Order Report by Transaction\",\n    orderReportByProduct: \"Order Report by Product\",\n    orderCode: \"Order Code\",\n    customerCode: \"Customer Code\",\n    orderTime: \"Order Time\",\n    orderQuantity: \"Order Quantity\",\n    orderValue: \"Order Value\",\n    productGroup: \"Product Group\",\n\n    // Purchase Report specific\n    purchaseReport: \"Purchase Report\",\n    purchaseReportTitle: \"Purchase Report\",\n    purchaseReportDescription: \"Detailed purchase activity report\",\n\n    // Sales chart report\n    salesChart: \"Sales Chart\",\n    salesChartDescription: \"Detailed sales analysis and time-based breakdown\",\n    salesReport: \"Sales Report\",\n\n    // Comprehensive sales report\n    comprehensiveSalesReport: \"Comprehensive Sales Report\",\n    timeReport: \"Time Report\",\n    profitReport: \"Profit Report\",\n    discountReport: \"Discount Report\",\n    returnReport: \"Return Report\",\n    salesDetailReport: \"Sales Detail Report\",\n    searchOrderCode: \"Search by Order Code\",\n    searchTable: \"Search by Table\",\n    pending: \"Pending\",\n    unitPrice: \"Unit Price\",\n    amount: \"Amount\",\n    exportTax: \"Export Tax\",\n    vatTax: \"VAT Tax\",\n    tableName: \"Table Name\",\n    table: \"Table\",\n    employeeName: \"Employee Name\",\n    taxRate: \"Tax Rate\",\n    taxAmount: \"Tax Amount\",\n    group: \"Group\",\n    note: \"Note\",\n    channel: \"Channel\",\n    employeeReport: \"Employee Report\",\n    customerReport: \"Customer Report\",\n    supplierReport: \"Supplier Report\",\n    noDelivery: \"No Delivery\",\n    delivery: \"Delivery\",\n    direct: \"Direct\",\n    other: \"Other\",\n    returnValue: \"Return Value\",\n    netRevenue: \"Net Revenue\",\n    totalCost: \"Total Cost\",\n    grossProfit: \"Gross Profit\",\n    totalInvoices: \"Total Invoices\",\n    invoiceValue: \"Invoice Value\",\n    invoiceDiscount: \"Invoice Discount\",\n    returnTicketCount: \"Return Ticket Count\",\n    seller: \"Seller\",\n    saleDate: \"Sale Date\",\n    paymentDate: \"Payment Date\",\n    fromDate: \"From Date\",\n    toDate: \"To Date\",\n    barChart: \"Bar Chart\",\n    pieChart: \"Pie Chart\",\n    lineChart: \"Line Chart\",\n    dailyRevenue: \"Daily Revenue\",\n    paymentMethodDistribution: \"Payment Method Distribution\",\n    hourlyRevenue: \"Hourly Revenue\",\n    barChartDesc: \"Analyze revenue trends over time\",\n    pieChartDesc: \"Payment method detailed analysis and daily sales breakdown\",\n    lineChartDesc: \"Analyze revenue trends over time with line chart\",\n\n    // Table headers for reports\n    transactionCode: \"Transaction Code\",\n    time: \"Time\",\n    quantity: \"Quantity\",\n    otherRevenue: \"Other Revenue\",\n    vat: \"VAT\",\n    actualRevenue: \"Actual Revenue\",\n    receiptCode: \"Receipt Code\",\n    payerReceiver: \"Payer/Receiver\",\n    revenueExpenseType: \"Revenue Expense Type\",\n    soldQuantity: \"Sold Quantity\",\n    returnQuantity: \"Return Quantity\",\n\n    // Dashboard specific\n    dailySales: \"Daily Sales\",\n    paymentMethods: \"Payment Methods\",\n    hourlyBreakdown: \"Hourly Breakdown\",\n    orders: \"Orders\",\n    customers: \"Customers\",\n    cash: \"Cash\",\n    card: \"Card\",\n    credit_card: \"Credit Card\",\n    qrbanking: \"QR Code\",\n    einvoice: \"E-Invoice\",\n\n    // Table analysis specific\n    customerCount: \"Customer Count\",\n    totalCustomers: \"Total Customers\",\n    turnoverRate: \"Turnover Rate\",\n    tableAnalysisDescription:\n      \"Detailed analysis of table performance and utilization\",\n    topRevenueTables: \"Top Revenue Tables\",\n    topTurnoverTables: \"Top Turnover Tables\",\n    topUtilizationTables: \"Top Utilization Tables\",\n    averageUtilization: \"Average Utilization\",\n    averageOrdersPerTable: \"Average Orders Per Table\",\n    allTables: \"All Tables\",\n    cumulativeVisitors: \"Cumulative Visitors\",\n    totalByTable: \"Total by Table\",\n    detailedTablePerformance: \"Detailed Table Performance\",\n    detailedTablePerformanceDesc:\n      \"View detailed operational metrics for each table\",\n    currentStatus: \"Current Status\",\n    orderCount: \"Order Count\",\n    peakTime: \"Peak Time\",\n    timesPerDay: \" times/day\",\n    hourUnit: \" hours\",\n    timesUnit: \" times\",\n    hour: \"hour\",\n    times: \"times\",\n\n    // Warehouse Report\n    warehouseReportTab: \"Warehouse Activity Report\",\n    inventoryReportOfInterestType: \"Analyze By\",\n    warehouseReportDescription: \"Detailed warehouse activity report\",\n\n    // Inventory report concern types\n    concernType: \"Analyze By\",\n    inventoryValue: \"Inventory Value\",\n    inOutInventory: \"In/Out Inventory\",\n    detailedInOutInventory: \"Detailed In/Out Inventory\",\n    disposal: \"Disposal\",\n\n    // Inventory report additional keys\n    profitReportByProduct: \"Profit Report by Product\",\n    inventoryValueReport: \"Inventory Value Report\",\n    inOutInventoryReport: \"In/Out Inventory Report\",\n    detailedInOutInventoryReport: \"Detailed In/Out Inventory Report\",\n    disposalReport: \"Disposal Report\",\n    employeeSalesReport: \"Employee Sales Report\",\n    customerSalesReport: \"Customer Sales Report\",\n    supplierReportByProduct: \"Supplier Report by Product\",\n    salePrice: \"Sale Price\",\n    saleValue: \"Sale Value\",\n    costPrice: \"Cost Price\",\n    openingStock: \"Opening Stock\",\n    openingValue: \"Opening Value\",\n    openingPrice: \"Opening Price\",\n    closingStock: \"Closing Stock\",\n    closingValue: \"Closing Value\",\n    inQuantity: \"In Quantity\",\n    outQuantity: \"Out Quantity\",\n    outValue: \"Out Value\",\n    inSupplier: \"In Supplier\",\n    inCheck: \"In Check\",\n    inReturn: \"In Return\",\n    inTransfer: \"In Transfer\",\n    inProduction: \"In Production\",\n    outSale: \"Out Sale\",\n    outDisposal: \"Out Disposal\",\n    outSupplier: \"Out Supplier\",\n    outCheck: \"Out Check\",\n    outTransfer: \"Out Transfer\",\n    outProduction: \"Out Production\",\n    totalDisposed: \"Total Disposed\",\n    employeeCount: \"Employee Count\",\n    quantityPurchased: \"Quantity Purchased\",\n    supplierCount: \"Supplier Count\",\n    inValue: \"In Value\",\n    productSearch: \"Product Search\",\n\n    // Additional missing keys\n    period: \"Period\",\n    noDataDescription: \"No data to display\",\n    monthAccumulated: \"Month Accumulated\",\n    peakHour: \"Peak Hour\",\n    filters: \"Filters\",\n    applyFilters: \"Apply Filters\",\n    resetFilters: \"Reset Filters\",\n    uniqueProducts: \"Unique Products\",\n\n    // Chart specific\n    value: \"Value\",\n    chartData: \"Chart Data\",\n    xAxis: \"X-Axis\",\n    yAxis: \"Y-Axis\",\n    legend: \"Legend\",\n    dataPoints: \"Data Points\",\n\n    // Menu analysis\n    productPerformance: \"Product Performance\",\n    categoryPerformance: \"Category Performance\",\n    topSellingItems: \"Top Selling Items\",\n    topRevenueItems: \"Top Revenue Items\",\n    categoryBreakdown: \"Category Breakdown\",\n    itemPerformance: \"Item Performance\",\n    salesTrend: \"Sales Trend\",\n    profitMargin: \"Profit Margin\",\n    costAnalysis: \"Cost Analysis\",\n    stockMovement: \"Stock Movement\",\n    menuAnalysisDescription:\n      \"Detailed analysis of menu and product performance\",\n\n    // Table Analysis\n\n    // Missing keys for menu report\n    menuItems: \"Menu Items\",\n    itemsSold: \"Items Sold\",\n    revenueShare: \"Revenue Share\",\n    salesShare: \"Sales Share\",\n    popularMenuByQuantity: \"Popular Menu by Quantity\",\n    popularMenuByQuantityDesc: \"Top selling items by quantity\",\n    highRevenueMenu: \"High Revenue Menu\",\n    highRevenueMenuDesc: \"Top revenue generating items\",\n    rank: \"Rank\",\n    menuName: \"Menu Name\",\n    salesCount: \"Sales Count\",\n    noCategoryData: \"No category data\",\n    noSalesData: \"No sales data\",\n    noRevenueData: \"No revenue data\",\n    productType: \"Product Type\",\n    combo: \"Combo\",\n    product: \"Product\",\n    service: \"Service\",\n\n    // Table analysis\n    tablePerformance: \"Table Performance\",\n    utilizationRate: \"Utilization Rate\",\n    averageRevenue: \"Average Revenue\",\n    peakHours: \"Peak Hours\",\n    revenuePerTable: \"Revenue per Table\",\n    ordersPerTable: \"Orders per Table\",\n\n    // Sales report specific\n    salesReportDescription: \"Detailed analysis of sales performance\",\n    loading: \"Loading\",\n    noData: \"No Data\",\n    noPaymentData: \"No Payment Data\",\n    noPaymentDataDescription:\n      \"No payment transactions found in the selected period\",\n    salesDetails: \"Sales Details\",\n    revenueExpenseDetails: \"Revenue Expense Details\",\n    inventoryDetails: \"Inventory Details\",\n    noReportData: \"No Report Data\",\n    centralBranch: \"Central Branch\",\n\n    // Report specific content\n    salesReportTitle: \"Sales Report\",\n    revenueReportTitle: \"Revenue Report\",\n    inventoryReportTitle: \"Inventory Report\",\n    summaryReportTitle: \"Summary Report\",\n\n    // Table detail headers\n    salesDetailsHeader: \"Sales Details\",\n    revenueExpenseDetailsHeader: \"Revenue Expense Details\",\n    inventoryDetailsHeader: \"Inventory Details\",\n\n    // Additional transaction types\n    totalTransactions: \"Total Transactions\",\n    income: \"Income\",\n    expenses: \"Expenses\",\n    netProfit: \"Net Profit\",\n    transactionDetails: \"Transaction Details\",\n    transactionId: \"Transaction ID\",\n    method: \"Method\",\n    notes: \"Notes\",\n    cashPayment: \"Cash Payment\",\n    cardPayment: \"Card Payment\",\n    transfer: \"Transfer\",\n    wallet: \"Wallet\",\n\n    // Status\n    status: \"Status\",\n\n    // Additional report sections\n    detailedAnalysis: \"Detailed Analysis\",\n    quickSummary: \"Quick Summary\",\n    comparisonReport: \"Comparison Report\",\n    trendsAndInsights: \"Trends & Insights\",\n    performanceIndicators: \"Performance Indicators\",\n    financialMetrics: \"Financial Metrics\",\n    operationalMetrics: \"Operational Metrics\",\n    customerMetrics: \"Customer Metrics\",\n\n    // Sales channel report specific\n    dineIn: \"Dine In\",\n    takeaway: \"Takeaway\",\n    cancelled: \"Cancelled\",\n\n    // Financial reports\n    financialReport: \"Financial Report\",\n    financialReportDescription: \"Detailed financial situation report\",\n    profitLoss: \"Profit & Loss\",\n    balanceSheet: \"Balance Sheet\",\n    cashFlow: \"Cash Flow\",\n\n    // Customer reports\n    channelSalesReport: \"Channel Sales Report\",\n\n    // Supplier reports\n    supplierReportDescription: \"Detailed supplier report\",\n    supplierPerformance: \"Supplier Performance\",\n\n    // Inventory reports\n    inventoryReportDescription: \"Detailed inventory report\",\n    stockLevel: \"Stock Level\",\n    stockMovementReport: \"Stock Movement Report\",\n    lowStockAlert: \"Low Stock Alert\",\n\n    // Additional menu items\n    warehouseReport: \"Warehouse Report\",\n\n    // Chart and filter labels\n    selectDateRange: \"Select Date Range\",\n    applyFilter: \"Apply Filter\",\n    clearFilter: \"Clear Filter\",\n    exportData: \"Export Data\",\n\n    // Data display\n    noDataAvailable: \"No Data Available\",\n    loadingData: \"Loading Data...\",\n    errorLoadingData: \"Error Loading Data\",\n    totalSalesRevenue: \"Total Sales Revenue\",\n  },\n};","size_bytes":51061},"client/src/lib/i18n/modules/settings.ts":{"content":"import type { SettingsTranslations } from \"../types\";\n\nexport const settingsTranslations: { [key: string]: SettingsTranslations } = {\n  ko: {\n    title: \"설정\",\n    description: \"시스템 설정을 관리합니다\",\n    storeInfo: \"매장 정보\",\n    categories: \"품목관리\",\n    employees: \"직원\",\n    basicInfo: \"기본 정보\",\n    basicInfoDesc: \"매장의 기본 정보를 설정합니다\",\n    contactInfo: \"연락처 정보\",\n    contactInfoDesc: \"매장의 연락처 정보를 설정합니다\",\n    operationHours: \"운영 시간\",\n    operationHoursDesc: \"매장 운영 시간을 설정합니다\",\n    storeName: \"매장명\",\n    storeCode: \"매장 코드\",\n    address: \"주소\",\n    phone: \"전화번호\",\n    email: \"이메일\",\n    website: \"웹사이트\",\n    openTime: \"오픈 시간\",\n    closeTime: \"마감 시간\",\n    categoryManagement: \"카테고리 관리\",\n    categoryManagementDesc: \"상품 카테고리를 관리합니다\",\n    goToCategories: \"카테고리로 이동\",\n    categoriesRedirect: \"카테고리로 이동\",\n    employeeManagement: \"직원 관리\",\n    employeeManagementDesc: \"직원 정보를 관리합니다\",\n    goToEmployees: \"직원으로 이동\",\n    goToInventory: \"재고로 이동\",\n    paymentMethodsDesc: \"결제 방법을 설정합니다\",\n    availablePayments: \"사용 가능한 결제 방법\",\n    addPayment: \"결제 방법 추가\",\n    enabled: \"활성화\",\n    storeUpdated: \"매장 정보가 업데이트되었습니다\",\n    updateError: \"업데이트 중 오류가 발생했습니다\",\n    paymentMethods: \"결제 방법\",\n    payments: {\n      cash: \"현금\",\n      creditCard: \"신용카드\",\n      debitCard: \"체크카드\",\n      momo: \"MoMo\",\n      zalopay: \"ZaloPay\",\n      vnpay: \"VNPay\",\n      qrCode: \"QR 코드\",\n      banking: \"온라인 뱅킹\",\n      shopeepay: \"ShopeePay\",\n      grabpay: \"GrabPay\",\n      newPayment: \"새 결제 방법\",\n    },\n    disabled: \"비활성화\",\n    backToPos: \"POS로 돌아가기\",\n    storeNamePlaceholder: \"매장명을 입력하세요\",\n    storeCodePlaceholder: \"매장 코드를 입력하세요\",\n    taxId: \"사업자등록번호\",\n    taxIdLabel: \"사업자등록번호\",\n    taxIdPlaceholder: \"사업자등록번호를 입력하세요\",\n    taxIdRequired: \"사업자등록번호\",\n    pinCodeLabel: \"PIN 코드\",\n    pinCodePlaceholder: \"PIN 코드 4-6자리를 입력하세요\",\n    loginIdLabel: \"로그인 ID\",\n    passwordLabel: \"비밀번호\",\n    loginUrlLabel: \"로그인 URL\",\n    signMethodLabel: \"서명 방법\",\n    softwareLabel: \"전자세금계산서 소프트웨어\",\n    cqtCodeLabel: \"CQT 코드 유형\",\n    selectSoftwarePlaceholder: \"소프트웨어 선택\",\n    signMethodServer: \"서버 서명\",\n    signMethodUsbToken: \"USB Token 서명\",\n    signMethodHsm: \"HSM 서명\",\n    cqtCodeLevel1: \"1급\",\n    cqtCodeLevel2: \"2급\",\n    businessType: \"POS 업종\",\n    businessTypePlaceholder: \"업종을 선택하세요\",\n    posRetail: \"POS 소매업\",\n    posRestaurant: \"POS 레스토랑\",\n    addressPlaceholder: \"주소를 입력하세요\",\n    phonePlaceholder: \"전화번호를 입력하세요\",\n    emailPlaceholder: \"이메일을 입력하세요\",\n    // E-invoice management\n    einvoiceSetup: \"전자세금계산서 설정\",\n    einvoiceDesc: \"전자세금계산서 서비스 제공업체와의 연결을 관리합니다\",\n    connectionManagement: \"연결 관리\",\n    templateManagement: \"양식 관리\",\n    connectionsList: \"연결 목록\",\n    connectionsDesc: \"HĐĐT 제공업체와의 연결을 관리합니다\",\n    templatesDesc: \"전자세금계산서 양식을 관리합니다\",\n    addConnection: \"연결 추가\",\n    addConnectionTitle: \"HĐĐT 연결 추가\",\n    addConnectionDesc: \"HĐĐT 제공업체와의 새 연결 정보를 입력하세요\",\n    editConnectionTitle: \"HĐĐT 연결 수정\",\n    editConnectionDesc: \"HĐĐT 제공업체 연결 정보를 업데이트하세요\",\n    addTemplate: \"템플릿 추가\",\n    templateSymbol: \"기호\",\n    templateIndex: \"번호\",\n    templateName: \"템플릿 이름\",\n    templateNumber: \"템플릿 번호\",\n    templateCode: \"템플릿 코드\",\n    templateUsage: \"사용 상태\",\n    templateUsageStatus: \"사용 여부\",\n    templateNotes: \"템플릿 노트\",\n    templateSetDefault: \"기본 템플릿으로 설정\",\n    addTemplateTitle: \"템플릿 추가\",\n    addTemplateDesc: \"새 인보이스 템플릿의 세부 정보 입력\",\n    editTemplateTitle: \"템플릿 수정\",\n    editTemplateDesc: \"인보이스 템플릿의 세부 정보 업데이트\",\n    templateNameLabel: \"템플릿 이름\",\n    templateNumberLabel: \"템플릿 번호\",\n    templateCodeLabel: \"템플릿 코드\",\n    templateSymbolLabel: \"기호\",\n    symbolLabel: \"기호\",\n    templateDefault: \"기본값\",\n    defaultConnection: \"기본 연결\",\n    setAsDefaultConnection: \"기본 연결로 설정\",\n    notesLabel: \"메모\",\n    notesPlaceholder: \"메모를 입력하세요 (선택사항)\",\n    operations: \"운영\",\n    cancel: \"취소\",\n    // Product Management\n    totalCategories: \"총 카테고리\",\n    totalProducts: \"총 상품\",\n    lowStock: \"재고 부족\",\n    outOfStock: \"품절\",\n    totalValue: \"재고 총 가치\",\n    totalStockQuantity: \"재고 총량\",\n    categoryTitle: \"카테고리 관리\",\n    productTitle: \"상품 관리\",\n    addCategory: \"카테고리 추가\",\n    addCustomer: \"고객 추가\",\n    addProduct: \"제품 추가\",\n    editCategory: \"카테고리 수정\",\n    editProduct: \"상품 수정\",\n    categoryName: \"카테고리 이름\",\n    categoryIcon: \"카테고리 아이콘\",\n    productName: \"상품명\",\n    productNamePlaceholder: \"상품명을 입력하세요\",\n    productSku: \"SKU\",\n    productSkuPlaceholder: \"SKU를 입력하세요\",\n    productCategory: \"카테고리\",\n    productPrice: \"가격\",\n    productPricePlaceholder: \"가격을 입력하세요\",\n    productStock: \"재고\",\n    productStockPlaceholder: \"재고 수량을 입력하세요\",\n    selectCategory: \"카테고리 선택\",\n    allCategories: \"모든 카테고리\",\n    searchCategoriesPlaceholder: \"품목군 검색...\",\n    noCategories: \"등록된 카테고리가 없습니다\",\n    noProducts: \"등록된 상품이 없습니다\",\n    deleteConfirm: \"정말로 삭제하시겠습니까?\",\n    categoryDeleteConfirm: \"이 카테고리를 삭제하시겠습니까?\",\n    categoryCreateSuccess: \"카테고리가 생성되었습니다\",\n    categoryUpdateSuccess: \"카테고리가 수정되었습니다\",\n    categoryDeleteSuccess: \"카테고리가 삭제되었습니다\",\n    productCreateSuccess: \"상품이 생성되었습니다\",\n    productUpdateSuccess: \"상품이 수정되었습니다\",\n    productDeleteSuccess: \"상품이 삭제되었습니다\",\n    total: \"총\",\n    productsShowing: \"상품이 표시됩니다\",\n    productDescriptionPlaceholder: \"상품 설명을 입력하세요 (선택사항)\",\n    productDescriptionLabel: \"상품 설명\",\n    afterTaxPrice: \"세금 포함 가격\",\n    afterTaxPricePlaceholder: \"세금 포함 가격을 입력하세요\",\n    productManagementDesc: \"상품 정보와 가격을 관리합니다\",\n    stockStatus: \"재고 상태\",\n    usageStatus: \"사용 상태\",\n    updateProductInfo: \"Update product information\",\n    enterProductInfo: \"Enter new product information\",\n    trackInventory: \"Track Inventory\",\n    enableInventoryTracking: \"Enable inventory tracking for this product\",\n    yes: \"네\",\n    // Product form dialog\n    addProductTitle: \"상품 추가\",\n    addProductDesc: \"새 상품 정보를 입력하세요\",\n    editProductDesc: \"상품 정보를 수정하세요\",\n    productDescriptionPlaceholder: \"상품 설명을 입력하세요 (선택사항)\",\n    productDescriptionLabel: \"상품 설명\",\n    afterTaxPrice: \"세후 가격\",\n    afterTaxPricePlaceholder: \"세후 가격을 입력하세요\",\n    trackInventory: \"재고 추적\",\n    enableInventoryTracking: \"이 상품의 재고 추적을 활성화\",\n    taxRatePercent: \"세율 (%)\",\n    taxRatePlaceholder: \"0.00\",\n    usageStatusLabel: \"사용 상태\",\n    usageStatusActive: \"활성\",\n    usageStatusInactive: \"비활성\",\n    selectUsageStatus: \"상태를 선택하세요\",\n    \n    // Placeholders\n    categoryNamePlaceholder: \"카테고리 이름을 입력하세요\",\n    templateNumberPlaceholder: \"예: 01GTKT0/001\",\n    templateCodePlaceholder: \"예: 123451/88890345\", \n    symbolPlaceholder: \"예: AA/19E\",\n    templateNamePlaceholder: \"예: 템플릿 1\",\n  },\n  en: {\n    title: \"Settings\",\n    description: \"Manage system settings\",\n    storeInfo: \"Store Info\",\n    categories: \"Categories\",\n    employees: \"Employees\",\n    basicInfo: \"Basic Information\",\n    basicInfoDesc: \"Configure basic store information\",\n    contactInfo: \"Contact Information\",\n    contactInfoDesc: \"Configure store contact information\",\n    operationHours: \"Operation Hours\",\n    operationHoursDesc: \"Set store operation hours\",\n    storeName: \"Store Name\",\n    storeCode: \"Store Code\",\n    address: \"Address\",\n    phone: \"Phone\",\n    email: \"Email\",\n    website: \"Website\",\n    openTime: \"Open Time\",\n    closeTime: \"Close Time\",\n    categoryManagement: \"Category Management\",\n    categoryManagementDesc: \"Manage product categories\",\n    goToCategories: \"Go to Categories\",\n    categoriesRedirect: \"Go to Categories\",\n    employeeManagement: \"Employee Management\",\n    employeeManagementDesc: \"Manage employee information\",\n    goToEmployees: \"Go to Employees\",\n    goToInventory: \"Go to Inventory\",\n    paymentMethodsDesc: \"Configure payment methods\",\n    availablePayments: \"Available Payment Methods\",\n    addPayment: \"Add Payment Method\",\n    enabled: \"Enabled\",\n    storeUpdated: \"Store information updated\",\n    updateError: \"Error occurred during update\",\n    paymentMethods: \"Payment Methods\",\n    payments: {\n      cash: \"Cash\",\n      creditCard: \"Credit Card\",\n      debitCard: \"Debit Card\",\n      momo: \"MoMo\",\n      zalopay: \"ZaloPay\",\n      vnpay: \"VNPay\",\n      qrCode: \"QR Code\",\n      banking: \"Online Banking\",\n      shopeepay: \"ShopeePay\",\n      grabpay: \"GrabPay\",\n      newPayment: \"New Payment Method\",\n    },\n    disabled: \"Disabled\",\n    backToPos: \"Back to POS\",\n    storeNamePlaceholder: \"Enter store name\",\n    storeCodePlaceholder: \"Enter store code\",\n    taxId: \"Tax ID\",\n    taxIdLabel: \"Tax ID\",\n    taxIdPlaceholder: \"Enter tax ID\",\n    taxIdRequired: \"Tax ID\",\n    pinCodeLabel: \"PIN Code\",\n    pinCodePlaceholder: \"Enter 4-6 digit PIN code\",\n    loginIdLabel: \"Login ID\",\n    passwordLabel: \"Password\",\n    loginUrlLabel: \"Login URL\",\n    signMethodLabel: \"Sign Method\",\n    softwareLabel: \"E-Invoice Software\",\n    cqtCodeLabel: \"CQT Code Type\",\n    selectSoftwarePlaceholder: \"Select software\",\n    signMethodServer: \"Server Sign\",\n    signMethodUsbToken: \"USB Token Sign\",\n    signMethodHsm: \"HSM Sign\",\n    cqtCodeLevel1: \"Level 1\",\n    cqtCodeLevel2: \"Level 2\",\n    businessType: \"POS Business Type\",\n    businessTypePlaceholder: \"Select business type\",\n    posRetail: \"POS Retail\",\n    posRestaurant: \"POS Restaurant\",\n    addressPlaceholder: \"Enter address\",\n    phonePlaceholder: \"Enter phone number\",\n    emailPlaceholder: \"Enter email address\",\n    // E-invoice management\n    einvoiceSetup: \"E-Invoice Setup\",\n    einvoiceDesc:\n      \"Manage connections with electronic invoice service providers\",\n    connectionManagement: \"Connection Management\",\n    templateManagement: \"Template Management\",\n    connectionsList: \"Connections List\",\n    connectionsDesc: \"Manage connections with HĐĐT providers\",\n    templatesDesc: \"Manage electronic invoice templates\",\n    addConnection: \"Add Connection\",\n    addConnectionTitle: \"Add HĐĐT Connection\",\n    addConnectionDesc: \"Enter new connection information with HĐĐT provider\",\n    editConnectionTitle: \"Edit HĐĐT Connection\",\n    editConnectionDesc: \"Update connection information with HĐĐT provider\",\n    addTemplate: \"Add Template\",\n    templateSymbol: \"Symbol\",\n    templateIndex: \"No.\",\n    templateName: \"Template Name\",\n    templateNumber: \"Template Number\",\n    templateCode: \"Template Code\",\n    templateUsage: \"Usage Status\",\n    templateUsageStatus: \"Usage Status\",\n    templateNotes: \"Template Notes\",\n    templateSetDefault: \"Set as default template\",\n    addTemplateTitle: \"Add Template\",\n    addTemplateDesc: \"Enter detailed information for the new template\",\n    editTemplateTitle: \"Edit Template\",\n    editTemplateDesc: \"Update detailed information for the template\",\n    templateNameLabel: \"Template Name\",\n    templateNumberLabel: \"Template Number\",\n    templateCodeLabel: \"Template Code\",\n    templateSymbolLabel: \"Symbol\",\n    symbolLabel: \"Symbol\",\n    templateDefault: \"Default\",\n    defaultConnection: \"Default\",\n    setAsDefaultConnection: \"Set as default connection\",\n    notesLabel: \"Notes\",\n    notesPlaceholder: \"Enter notes (optional)\",\n    operations: \"Operations\",\n    cancel: \"Cancel\",\n    // Product Management\n    totalCategories: \"Total Categories\",\n    totalProducts: \"Total Products\",\n    lowStock: \"Low Stock\",\n    outOfStock: \"Out of Stock\",\n    totalValue: \"Total Value\",\n    totalStockQuantity: \"Total Stock Quantity\",\n    categoryTitle: \"Category Management\",\n    productTitle: \"Product Management\",\n    addCategory: \"Add Category\",\n    addCustomer: \"Add Customer\",\n    addProduct: \"Add Product\",\n    editCategory: \"Edit Category\",\n    editProduct: \"Edit Product\",\n    categoryName: \"Category Name\",\n    categoryIcon: \"Category Icon\",\n    productName: \"Product Name\",\n    productNamePlaceholder: \"Enter product name\",\n    productSku: \"SKU\",\n    productSkuPlaceholder: \"Enter SKU\",\n    productCategory: \"Category\",\n    productPrice: \"Price\",\n    productPricePlaceholder: \"Enter price\",\n    productStock: \"Stock\",\n    productStockPlaceholder: \"Enter stock quantity\",\n    selectCategory: \"Select Category\",\n    allCategories: \"All Categories\",\n    searchCategoriesPlaceholder: \"Search categories...\",\n    noCategories: \"No categories found\",\n    noProducts: \"No products found\",\n    deleteConfirm: \"Are you sure you want to delete?\",\n    categoryDeleteConfirm: \"this category?\",\n    categoryCreateSuccess: \"Category created successfully\",\n    categoryUpdateSuccess: \"Category updated successfully\",\n    categoryDeleteSuccess: \"Category deleted successfully\",\n    productCreateSuccess: \"Product created successfully\",\n    productUpdateSuccess: \"Product updated successfully\",\n    productDeleteSuccess: \"Product deleted successfully\",\n    total: \"Total\",\n    productsShowing: \"products showing\",\n    productDescriptionPlaceholder: \"Enter product description (optional)\",\n    productDescriptionLabel: \"Product Description\",\n    afterTaxPrice: \"After Tax Price\",\n    afterTaxPricePlaceholder: \"Enter after tax price\",\n    productManagementDesc: \"Manage product information and pricing\",\n    stockStatus: \"Stock Status\",\n    usageStatus: \"Usage Status\",\n    updateProductInfo: \"Update product information\",\n    enterProductInfo: \"Enter new product information\",\n    trackInventory: \"Track Inventory\",\n    enableInventoryTracking: \"Enable inventory tracking for this product\",\n    yes: \"Yes\",\n    inStock: \"In Stock\",\n    outOfStock: \"Out of Stock\",\n    // Product form dialog\n    addProductTitle: \"Add Product\",\n    addProductDesc: \"Enter new product information\",\n    editProductDesc: \"Update product information\",\n    productDescriptionPlaceholder: \"Enter product description (optional)\",\n    productDescriptionLabel: \"Product Description\",\n    afterTaxPrice: \"After Tax Price\",\n    afterTaxPricePlaceholder: \"Enter after tax price\",\n    trackInventory: \"Track Inventory\",\n    enableInventoryTracking: \"Enable inventory tracking for this product\",\n    taxRatePercent: \"Tax Rate (%)\",\n    taxRatePlaceholder: \"0.00\",\n    usageStatusLabel: \"Usage Status\",\n    usageStatusActive: \"Active\",\n    usageStatusInactive: \"Inactive\",\n    selectUsageStatus: \"Select status\",\n    \n    // Placeholders\n    categoryNamePlaceholder: \"Enter category name\",\n    templateNumberPlaceholder: \"e.g., 01GTKT0/001\",\n    templateCodePlaceholder: \"e.g., 123451/88890345\",\n    symbolPlaceholder: \"e.g., AA/19E\", \n    templateNamePlaceholder: \"e.g., Template 1\",\n  },\n  vi: {\n    title: \"Cài đặt\",\n    description: \"Quản lý cài đặt hệ thống\",\n    storeInfo: \"Thông tin cửa hàng\",\n    categories: \"Danh mục sản phẩm\",\n    employees: \"Nhân viên\",\n    basicInfo: \"Thông tin cơ bản\",\n    basicInfoDesc: \"Cấu hình thông tin cơ bản của cửa hàng\",\n    contactInfo: \"Thông tin liên hệ\",\n    contactInfoDesc: \"Cấu hình thông tin liên hệ của cửa hàng\",\n    operationHours: \"Giờ hoạt động\",\n    operationHoursDesc: \"Thiết lập giờ hoạt động của cửa hàng\",\n    storeName: \"Tên cửa hàng\",\n    storeCode: \"Mã cửa hàng\",\n    address: \"Địa chỉ\",\n    phone: \"Số điện thoại\",\n    email: \"Email\",\n    website: \"Trang web\",\n    openTime: \"Giờ mở cửa\",\n    closeTime: \"Giờ đóng cửa\",\n    categoryManagement: \"Quản lý danh mục\",\n    categoryManagementDesc: \"Quản lý danh mục sản phẩm\",\n    goToCategories: \"Đến danh mục\",\n    categoriesRedirect: \"Đến danh mục\",\n    employeeManagement: \"Quản lý nhân viên\",\n    employeeManagementDesc: \"Quản lý thông tin nhân viên\",\n    goToEmployees: \"Đến nhân viên\",\n    goToInventory: \"Đến kho hàng\",\n    paymentMethodsDesc: \"Cấu hình phương thức thanh toán\",\n    availablePayments: \"Phương thức thanh toán có sẵn\",\n    addPayment: \"Thêm phương thức thanh toán\",\n    enabled: \"Đã kích hoạt\",\n    storeUpdated: \"Thông tin cửa hàng đã được cập nhật\",\n    updateError: \"Có lỗi xảy ra trong quá trình cập nhật\",\n    paymentMethods: \"Phương thức thanh toán\",\n    payments: {\n      cash: \"Tiền mặt\",\n      creditCard: \"Thẻ tín dụng\",\n      debitCard: \"Thẻ ghi nợ\",\n      momo: \"MoMo\",\n      zalopay: \"ZaloPay\",\n      vnpay: \"VNPay\",\n      qrCode: \"Mã QR\",\n      banking: \"Ngân hàng trực tuyến\",\n      shopeepay: \"ShopeePay\",\n      grabpay: \"GrabPay\",\n      newPayment: \"Phương thức thanh toán mới\",\n    },\n    disabled: \"Đã tắt\",\n    backToPos: \"Quay lại POS\",\n    storeNamePlaceholder: \"Nhập tên cửa hàng\",\n    storeCodePlaceholder: \"Nhập mã cửa hàng\",\n    taxId: \"Mã số thuế\",\n    taxIdLabel: \"Mã số thuế\",\n    taxIdPlaceholder: \"Nhập mã số thuế\",\n    taxIdRequired: \"Mã số thuế\",\n    pinCodeLabel: \"Mã PIN\",\n    pinCodePlaceholder: \"Nhập mã PIN 4-6 chữ số\",\n    loginIdLabel: \"ID đăng nhập\",\n    passwordLabel: \"Mật khẩu\",\n    loginUrlLabel: \"Đường dẫn\",\n    signMethodLabel: \"Phương thức ký\",\n    softwareLabel: \"Phần mềm HĐ\",\n    cqtCodeLabel: \"Loại mã CQT\",\n    selectSoftwarePlaceholder: \"Chọn phần mềm HĐĐT\",\n    signMethodServer: \"Ký server\",\n    signMethodUsbToken: \"Ký USB Token\",\n    signMethodHsm: \"Ký HSM\",\n    cqtCodeLevel1: \"Cấp nhật\",\n    cqtCodeLevel2: \"Cấp hai\",\n    businessType: \"Loại hình kinh doanh POS\",\n    businessTypePlaceholder: \"Chọn loại hình kinh doanh\",\n    posRetail: \"POS Bán lẻ\",\n    posRestaurant: \"POS Nhà hàng\",\n    addressPlaceholder: \"Nhập địa chỉ\",\n    phonePlaceholder: \"Nhập số điện thoại\",\n    emailPlaceholder: \"Nhập địa chỉ email\",\n    // E-invoice management\n    einvoiceSetup: \"Thiết lập HĐĐT\",\n    einvoiceDesc:\n      \"Quản lý kết nối với các nhà cung cấp dịch vụ hóa đơn điện tử\",\n    connectionManagement: \"Kênh kết nối HĐĐT\",\n    templateManagement: \"Mẫu số HĐĐT\",\n    connectionsList: \"Danh sách kết nối\",\n    connectionsDesc: \"Quản lý các kết nối với nhà cung cấp HĐĐT\",\n    templatesDesc: \"Quản lý các mẫu số hóa đơn điện tử\",\n    addConnection: \"Thêm kết nối\",\n    addConnectionTitle: \"Thêm kết nối HĐĐT\",\n    addConnectionDesc: \"Nhập thông tin kết nối mới với nhà cung cấp HĐĐT\",\n    editConnectionTitle: \"Sửa kết nối HĐĐT\",\n    editConnectionDesc: \"Cập nhật thông tin kết nối với nhà cung cấp HĐĐT\",\n    addTemplate: \"Thêm mẫu\",\n    templateSymbol: \"Ký hiệu\",\n    templateIndex: \"STT\",\n    templateName: \"Tên\",\n    templateNumber: \"Mẫu số\",\n    templateCode: \"Mã mẫu\",\n    templateUsage: \"C/K sử dụng\",\n    templateUsageStatus: \"Trạng thái sử dụng\",\n    templateNotes: \"Ghi chú mẫu số\",\n    templateSetDefault: \"Đặt làm mẫu số mặc định\",\n    addTemplateTitle: \"Thêm mẫu số HĐĐT\",\n    addTemplateDesc: \"Nhập thông tin chi tiết của mẫu số HĐĐT\",\n    editTemplateTitle: \"Sửa mẫu số HĐĐT\",\n    editTemplateDesc: \"Cập nhật thông tin chi tiết của mẫu số HĐĐT\",\n    templateNameLabel: \"Tên mẫu số\",\n    templateNumberLabel: \"Mẫu số\",\n    templateCodeLabel: \"Mã mẫu\",\n    templateSymbolLabel: \"Ký hiệu\",\n    symbolLabel: \"Ký hiệu\",\n    templateDefault: \"Mặc định\",\n    defaultConnection: \"Mặc định\",\n    setAsDefaultConnection: \"Đặt làm kết nối mặc định\",\n    notesLabel: \"Ghi chú\",\n    notesPlaceholder: \"Nhập ghi chú (tùy chọn)\",\n    operations: \"Hoạt động\",\n    cancel: \"Hủy bỏ\",\n    // Product Management\n    totalCategories: \"Tổng số danh mục\",\n    totalProducts: \"Tổng số sản phẩm\",\n    lowStock: \"Sắp hết hàng\",\n    outOfStock: \"Hết hàng\",\n    totalValue: \"Tổng giá trị kho\",\n    totalStockQuantity: \"Tổng số lượng tồn kho\",\n    categoryTitle: \"Quản lý danh mục\",\n    productTitle: \"Quản lý sản phẩm\",\n    addCategory: \"Thêm danh mục\",\n    addCustomer: \"Thêm khách hàng\",\n    addProduct: \"Thêm sản phẩm\",\n    editCategory: \"Sửa danh mục\",\n    editProduct: \"Sửa sản phẩm\",\n    categoryName: \"Tên danh mục\",\n    categoryIcon: \"Biểu tượng danh mục\",\n    productName: \"Tên sản phẩm\",\n    productNamePlaceholder: \"Nhập tên sản phẩm\",\n    productSku: \"Mã SKU\",\n    productSkuPlaceholder: \"Nhập mã SKU\",\n    productCategory: \"Danh mục\",\n    productPrice: \"Giá bán\",\n    productPricePlaceholder: \"Nhập giá bán\",\n    productStock: \"Tồn kho\",\n    productStockPlaceholder: \"Nhập số lượng tồn kho\",\n    selectCategory: \"Chọn danh mục\",\n    allCategories: \"Tất cả danh mục\",\n    searchCategoriesPlaceholder: \"Tìm kiếm danh mục...\",\n    noCategories: \"Không có danh mục nào\",\n    noProducts: \"Không có sản phẩm nào\",\n    deleteConfirm: \"Bạn có chắc chắn muốn xóa?\",\n    categoryDeleteConfirm: \"danh mục này?\",\n    categoryCreateSuccess: \"Tạo danh mục thành công\",\n    categoryUpdateSuccess: \"Cập nhật danh mục thành công\",\n    categoryDeleteSuccess: \"Xóa danh mục thành công\",\n    productCreateSuccess: \"Tạo sản phẩm thành công\",\n    productUpdateSuccess: \"Cập nhật sản phẩm thành công\",\n    productDeleteSuccess: \"Xóa sản phẩm thành công\",\n    total: \"Tổng cộng\",\n    productsShowing: \"sản phẩm đang hiển thị\",\n    productDescriptionPlaceholder: \"Nhập mô tả sản phẩm (tùy chọn)\",\n    productDescriptionLabel: \"Mô tả sản phẩm\",\n    afterTaxPrice: \"Giá sau thuế\",\n    afterTaxPricePlaceholder: \"Nhập giá sau thuế\",\n    productManagementDesc: \"Quản lý thông tin sản phẩm và giá cả\",\n    stockStatus: \"Trạng thái kho\",\n    usageStatus: \"Trạng thái sử dụng\",\n    updateProductInfo: \"Cập nhật thông tin sản phẩm\",\n    enterProductInfo: \"Nhập thông tin sản phẩm mới\",\n    trackInventory: \"Theo dõi tồn kho\",\n    enableInventoryTracking: \"Kích hoạt theo dõi tồn kho cho sản phẩm này\",\n    yes: \"Có\",\n    inStock: \"Còn hàng\",\n    outOfStock: \"Hết hàng\",\n    // Product form dialog\n    addProductTitle: \"Thêm sản phẩm\",\n    addProductDesc: \"Nhập thông tin sản phẩm mới\",\n    editProductDesc: \"Cập nhật thông tin sản phẩm\",\n    productDescriptionPlaceholder: \"Nhập mô tả sản phẩm (tùy chọn)\",\n    productDescriptionLabel: \"Mô tả sản phẩm\",\n    afterTaxPrice: \"Giá sau thuế\",\n    afterTaxPricePlaceholder: \"Nhập giá sau thuế\",\n    trackInventory: \"Theo dõi tồn kho\",\n    enableInventoryTracking: \"Kích hoạt theo dõi tồn kho cho sản phẩm này\",\n    taxRatePercent: \"Thuế suất (%)\",\n    taxRatePlaceholder: \"0.00\",\n    usageStatusLabel: \"Trạng thái sử dụng\",\n    usageStatusActive: \"Hoạt động\",\n    usageStatusInactive: \"Không hoạt động\",\n    selectUsageStatus: \"Chọn trạng thái\",\n    \n    // Placeholders\n    categoryNamePlaceholder: \"Nhập tên danh mục\",\n    templateNumberPlaceholder: \"Ví dụ: 01GTKT0/001\",\n    templateCodePlaceholder: \"Ví dụ: 123451/88890345\",\n    symbolPlaceholder: \"Ví dụ: AA/19E\",\n    templateNamePlaceholder: \"Ví dụ: Mẫu số 1\",\n  },\n};","size_bytes":24987},"client/src/lib/i18n/modules/suppliers.ts":{"content":"import type { SuppliersTranslations } from \"../types\";\n\nexport const suppliersTranslations: { [key: string]: SuppliersTranslations } = {\n  ko: {\n    title: \"공급업체 관리\",\n    description: \"공급업체 정보 관리\",\n    addSupplier: \"공급업체 추가\",\n    editSupplier: \"공급업체 편집\",\n    deleteSupplier: \"공급업체 삭제\",\n    searchPlaceholder: \"공급업체 검색...\",\n    name: \"이름\",\n    contactPerson: \"담당자\",\n    phone: \"전화번호\",\n    email: \"이메일\",\n    address: \"주소\",\n    paymentTerms: \"결제 조건\",\n    active: \"활성\",\n    inactive: \"비활성\",\n    noSuppliers: \"공급업체가 없습니다\",\n    confirmDelete: \"이 공급업체를 삭제하시겠습니까?\",\n    deleteSuccess: \"삭제 성공\",\n    deleteSuccessDesc: \"공급업체가 성공적으로 삭제되었습니다\",\n    deleteFailed: \"삭제 실패\",\n    deleteFailedDesc: \"공급업체 삭제에 실패했습니다\",\n    addDescription: \"새 공급업체 정보를 입력하세요\",\n    editDescription: \"공급업체 정보를 수정하세요\",\n    code: \"코드\",\n    codePlaceholder: \"공급업체 코드 입력\",\n    namePlaceholder: \"공급업체 이름 입력\",\n    contactPersonPlaceholder: \"담당자 이름 입력\",\n    phonePlaceholder: \"전화번호 입력\",\n    emailPlaceholder: \"이메일 주소 입력\",\n    addressPlaceholder: \"주소 입력\",\n    taxId: \"사업자등록번호\",\n    taxIdPlaceholder: \"사업자등록번호 입력\",\n    bankAccount: \"은행 계좌\",\n    bankAccountPlaceholder: \"은행 계좌 입력\",\n    cash: \"현금\",\n    notes: \"메모\",\n    notesPlaceholder: \"추가 메모 입력\",\n    status: \"상태\",\n    createSuccess: \"생성 성공\",\n    createSuccessDesc: \"공급업체가 성공적으로 생성되었습니다\",\n    createFailed: \"생성 실패\",\n    createFailedDesc: \"공급업체 생성에 실패했습니다\",\n    updateSuccess: \"수정 성공\",\n    updateSuccessDesc: \"공급업체가 성공적으로 수정되었습니다\",\n    updateFailed: \"수정 실패\",\n    updateFailedDesc: \"공급업체 수정에 실패했습니다\",\n    validationError: \"유효성 검사 오류\",\n    requiredFields: \"필수 항목을 모두 입력해주세요\",\n  },\n  en: {\n    title: \"Supplier Management\",\n    description: \"Manage supplier information\",\n    addSupplier: \"Add Supplier\",\n    editSupplier: \"Edit Supplier\",\n    deleteSupplier: \"Delete Supplier\",\n    searchPlaceholder: \"Search suppliers...\",\n    name: \"Name\",\n    contactPerson: \"Contact Person\",\n    phone: \"Phone\",\n    email: \"Email\",\n    address: \"Address\",\n    paymentTerms: \"Payment Terms\",\n    active: \"Active\",\n    inactive: \"Inactive\",\n    noSuppliers: \"No suppliers found\",\n    confirmDelete: \"Are you sure you want to delete this supplier?\",\n    deleteSuccess: \"Delete Successful\",\n    deleteSuccessDesc: \"Supplier has been successfully deleted\",\n    deleteFailed: \"Delete Failed\",\n    deleteFailedDesc: \"Failed to delete supplier\",\n    addDescription: \"Enter new supplier information\",\n    editDescription: \"Edit supplier information\",\n    code: \"Code\",\n    codePlaceholder: \"Enter supplier code\",\n    namePlaceholder: \"Enter supplier name\",\n    contactPersonPlaceholder: \"Enter contact person name\",\n    phonePlaceholder: \"Enter phone number\",\n    emailPlaceholder: \"Enter email address\",\n    addressPlaceholder: \"Enter address\",\n    taxId: \"Tax ID\",\n    taxIdPlaceholder: \"Enter tax ID\",\n    bankAccount: \"Bank Account\",\n    bankAccountPlaceholder: \"Enter bank account\",\n    cash: \"Cash\",\n    notes: \"Notes\",\n    notesPlaceholder: \"Enter additional notes\",\n    status: \"Status\",\n    createSuccess: \"Create Successful\",\n    createSuccessDesc: \"Supplier has been successfully created\",\n    createFailed: \"Create Failed\",\n    createFailedDesc: \"Failed to create supplier\",\n    updateSuccess: \"Update Successful\",\n    updateSuccessDesc: \"Supplier has been successfully updated\",\n    updateFailed: \"Update Failed\",\n    updateFailedDesc: \"Failed to update supplier\",\n    validationError: \"Validation Error\",\n    requiredFields: \"Please fill in all required fields\",\n  },\n  vi: {\n    title: \"Quản lý nhà cung cấp\",\n    description: \"Quản lý thông tin nhà cung cấp\",\n    addSupplier: \"Thêm nhà cung cấp\",\n    editSupplier: \"Sửa nhà cung cấp\",\n    deleteSupplier: \"Xóa nhà cung cấp\",\n    searchPlaceholder: \"Tìm kiếm nhà cung cấp...\",\n    name: \"Tên\",\n    contactPerson: \"Người liên hệ\",\n    phone: \"Số điện thoại\",\n    email: \"Email\",\n    address: \"Địa chỉ\",\n    paymentTerms: \"Điều khoản thanh toán\",\n    active: \"Hoạt động\",\n    inactive: \"Không hoạt động\",\n    noSuppliers: \"Không tìm thấy nhà cung cấp nào\",\n    confirmDelete: \"Bạn có chắc chắn muốn xóa nhà cung cấp này?\",\n    deleteSuccess: \"Xóa thành công\",\n    deleteSuccessDesc: \"Nhà cung cấp đã được xóa thành công\",\n    deleteFailed: \"Xóa thất bại\",\n    deleteFailedDesc: \"Không thể xóa nhà cung cấp\",\n    addDescription: \"Nhập thông tin nhà cung cấp mới\",\n    editDescription: \"Chỉnh sửa thông tin nhà cung cấp\",\n    code: \"Mã\",\n    codePlaceholder: \"Nhập mã nhà cung cấp\",\n    namePlaceholder: \"Nhập tên nhà cung cấp\",\n    contactPersonPlaceholder: \"Nhập tên người liên hệ\",\n    phonePlaceholder: \"Nhập số điện thoại\",\n    emailPlaceholder: \"Nhập địa chỉ email\",\n    addressPlaceholder: \"Nhập địa chỉ\",\n    taxId: \"Mã số thuế\",\n    taxIdPlaceholder: \"Nhập mã số thuế\",\n    bankAccount: \"Tài khoản ngân hàng\",\n    bankAccountPlaceholder: \"Nhập tài khoản ngân hàng\",\n    cash: \"Tiền mặt\",\n    notes: \"Ghi chú\",\n    notesPlaceholder: \"Nhập ghi chú thêm\",\n    status: \"Trạng thái\",\n    createSuccess: \"Tạo thành công\",\n    createSuccessDesc: \"Nhà cung cấp đã được tạo thành công\",\n    createFailed: \"Tạo thất bại\",\n    createFailedDesc: \"Không thể tạo nhà cung cấp\",\n    updateSuccess: \"Cập nhật thành công\",\n    updateSuccessDesc: \"Nhà cung cấp đã được cập nhật thành công\",\n    updateFailed: \"Cập nhật thất bại\",\n    updateFailedDesc: \"Không thể cập nhật nhà cung cấp\",\n    validationError: \"Lỗi xác thực\",\n    requiredFields: \"Vui lòng điền đầy đủ các trường bắt buộc\",\n  },\n};\n","size_bytes":6380},"client/src/lib/i18n/modules/tables.ts":{"content":"import type { TablesTranslations } from \"../types\";\n\nexport const tablesTranslations: { [key: string]: TablesTranslations } = {\n  ko: {\n    title: \"테이블 관리\",\n    description: \"테이블 상태를 확인하고 주문을 관리하세요\",\n    backToPOS: \"POS로 돌아가기\",\n    tableStatus: \"테이블 현황\",\n    orderManagement: \"주문 관리\",\n    tableSettings: \"테이블 설정\",\n    tableSettingsDesc: \"테이블을 추가, 편집, 삭제할 수 있습니다\",\n    tableNumber: \"테이블 번호\",\n    tableCapacity: \"테이블 정원\",\n    capacity: \"정원\",\n    status: \"상태\",\n    actions: \"작업\",\n    addTable: \"테이블 추가\",\n    editTable: \"테이블 편집\",\n    addTableDesc: \"새 테이블을 추가하세요\",\n\n    deleteTable: \"테이블 삭제\",\n    available: \"이용 가능\",\n    occupied: \"사용중\",\n    reserved: \"예약됨\",\n    cleaning: \"청소중\",\n    outOfService: \"이용 불가\",\n    tableNumberPlaceholder: \"테이블 번호를 입력하세요\",\n    capacityPlaceholder: \"정원을 입력하세요\",\n    qrCodePlaceholder: \"QR 코드를 입력하세요\",\n    selectStatus: \"상태를 선택하세요\",\n    tableCreateSuccess: \"테이블이 성공적으로 생성되었습니다\",\n    tableUpdateSuccess: \"테이블이 성공적으로 수정되었습니다\",\n    tableDeleteSuccess: \"테이블이 성공적으로 삭제되었습니다\",\n    deleteConfirm: \"정말로 이 테이블을 삭제하시겠습니까?\",\n    deleteOrder: \"주문 삭제\",\n    noTables: \"등록된 테이블이 없습니다\",\n    totalTables: \"전체 테이블\",\n    availableTables: \"이용 가능한 테이블\",\n    occupiedTables: \"사용중인 테이블\",\n    cleanupComplete: \"청소 완료\",\n    selectMenuToOrder: \"메뉴를 선택하여 주문하세요\",\n    customerName: \"고객명\",\n    optional: \"선택사항\",\n    customerNamePlaceholder: \"고객명을 입력하세요\",\n    customerCount: \"고객 수\",\n    allCategories: \"전체 카테고리\",\n    stockCount: \"재고\",\n    orderHistory: \"주문 내역\",\n    itemsSelected: \"개 선택됨\",\n    noItemsSelected: \"선택된 항목이 없습니다\",\n    specialRequests: \"특별 요청사항\",\n    subtotalLabel: \"소계\",\n    taxLabel: \"세금\",\n    totalLabel: \"총액\",\n    placing: \"주문 중...\",\n    placeOrder: \"주문하기\",\n    tableList: \"테이블 목록\",\n    tableNumberLabel: \"테이블 번호\",\n    capacityLabel: \"정원\",\n    statusLabel: \"상태\",\n    qrCodeLabel: \"QR 코드\",\n    createdDate: \"생성일\",\n    none: \"없음\",\n    imageUrl: \"이미지 URL\",\n    productNamePlaceholder: \"상품명을 입력하세요\",\n    skuPlaceholder: \"SKU를 입력하세요\",\n    // Payment related\n    subtotal: \"소계\",\n    tax: \"세금\",\n    total: \"총액\",\n    paymentMethod: \"결제 방법\",\n    cash: \"현금\",\n    card: \"카드\",\n    amountReceived: \"받은 금액\",\n    change: \"거스름돈\",\n    completeSale: \"결제 완료\",\n    confirmDelete: \"이 테이블을 삭제하시겠습니까?\",\n    tableNumberRequired: \"테이블 번호가 필요합니다\",\n    capacityMinimum: \"수용 인원은 최소 1명이어야 합니다\",\n    tableUpdateError: \"테이블 업데이트 오류\",\n    tableDeleteError: \"테이블 삭제 중 오류가 발생했습니다\",\n\n    statusPlaceholder: \"상태를 선택하세요\",\n    unitPrice: \"단가\",\n    taxRate: \"세율\",\n    productName: \"상품명\",\n    editProduct: \"상품 편집\",\n    productManagement: \"상품 관리\",\n    addNewProduct: \"새 상품 추가\",\n    bulkImport: \"대량 가져오기\",\n    export: \"내보내기\",\n    product: \"상품\",\n    sku: \"SKU\",\n    category: \"카테고리\",\n    productType: \"상품 유형\",\n    selectProductType: \"상품 유형을 선택하세요\",\n    productTypeRequired: \"상품 유형은 필수입니다\",\n    goodsType: \"상품\",\n    materialType: \"원자재\",\n    finishedProductType: \"완제품\",\n    imageUrlOptional: \"이미지 URL (선택 사항)\",\n    price: \"가격\",\n    stock: \"재고\",\n    loading: \"로딩 중...\",\n  },\n  en: {\n    title: \"Table Management\",\n    description: \"Check table status and manage orders\",\n    backToPOS: \"Back to POS\",\n    tableStatus: \"Table Status\",\n    orderManagement: \"Order Management\",\n    tableSettings: \"Table Settings\",\n    tableSettingsDesc: \"Add, edit, and delete tables\",\n    tableNumber: \"Table Number\",\n    tableCapacity: \"Table Capacity\",\n    capacity: \"Capacity\",\n    status: \"Status\",\n    actions: \"Actions\",\n    addTable: \"Add Table\",\n    editTable: \"Edit Table\",\n    addTableDesc: \"Add a new table\",\n    editTableDesc: \"Edit table information\",\n    deleteTable: \"Delete Table\",\n    available: \"Available\",\n    occupied: \"Occupied\",\n    reserved: \"Reserved\",\n    cleaning: \"Cleaning\",\n    outOfService: \"Out of Service\",\n    tableNumberPlaceholder: \"Enter table number\",\n    capacityPlaceholder: \"Enter capacity\",\n    qrCodePlaceholder: \"Enter QR code\",\n    selectStatus: \"Select status\",\n    tableCreateSuccess: \"Table created successfully\",\n    tableUpdateSuccess: \"Table updated successfully\",\n    tableDeleteSuccess: \"Table deleted successfully\",\n    deleteConfirm: \"Are you sure you want to delete this table?\",\n    deleteOrder: \"Delete Order\",\n    noTables: \"No tables registered\",\n    totalTables: \"Total Tables\",\n    availableTables: \"Available Tables\",\n    occupiedTables: \"Occupied Tables\",\n    cleanupComplete: \"Cleanup Complete\",\n    selectMenuToOrder: \"Select menu items to order\",\n    customerName: \"Customer Name\",\n    optional: \"Optional\",\n    customerNamePlaceholder: \"Enter customer name\",\n    imageUrl: \"Image URL\",\n    productNamePlaceholder: \"Enter product name\",\n    skuPlaceholder: \"Enter SKU\",\n    customerCount: \"Customer Count\",\n    allCategories: \"All Categories\",\n    stockCount: \"Stock\",\n    orderHistory: \"Order History\",\n    itemsSelected: \" items selected\",\n    noItemsSelected: \"No items selected\",\n    specialRequests: \"Special requests\",\n    subtotalLabel: \"Subtotal\",\n    taxLabel: \"Tax\",\n    totalLabel: \"Total\",\n    placing: \"Placing...\",\n    placeOrder: \"Place Order\",\n    tableList: \"Table List\",\n    tableNumberLabel: \"Table Number\",\n    capacityLabel: \"Capacity\",\n    statusLabel: \"Status\",\n    qrCodeLabel: \"QR Code\",\n    createdDate: \"Created Date\",\n    none: \"None\",\n    // Payment related\n    subtotal: \"Subtotal\",\n    tax: \"Tax\",\n    total: \"Total\",\n    paymentMethod: \"Payment Method\",\n    cash: \"Cash\",\n    card: \"Card\",\n    amountReceived: \"Amount Received\",\n    change: \"Change\",\n    completeSale: \"Complete Sale\",\n    tableNumberRequired: \"Table number is required\",\n    capacityMinimum: \"Capacity must be at least 1 person\",\n    tableUpdateError: \"Error updating table\",\n    tableDeleteError: \"Error deleting table\",\n\n    statusPlaceholder: \"Select status\",\n    confirmDeleteProduct: \"Are you sure you want to delete this product?\",\n    productNameRequired: \"Product name is required\",\n    skuRequired: \"SKU is required\",\n    categoryRequired: \"Category is required\",\n    productType: \"Product Type\",\n    selectProductType: \"Select product type\",\n    productTypeRequired: \"Product type is required\",\n    goodsType: \"Goods\",\n    materialType: \"Raw Materials\",\n    finishedProductType: \"Finished Products\",\n    imageUrlOptional: \"Image URL (optional)\",\n    unitPrice: \"Unit Price\",\n    taxRate: \"Tax Rate\",\n    productName: \"Product Name\",\n    editProduct: \"Edit Product\",\n    productManagement: \"Product Management\",\n    addNewProduct: \"Add New Product\",\n    bulkImport: \"Bulk Import\",\n    export: \"Export\",\n    product: \"Product\",\n    sku: \"SKU\",\n    category: \"Category\",\n    price: \"Price\",\n    stock: \"Stock\",\n    loading: \"Loading...\",\n  },\n  vi: {\n    title: \"Quản lý bàn\",\n    description: \"Kiểm tra trạng thái bàn và quản lý đơn hàng\",\n    backToPOS: \"Về POS\",\n    tableStatus: \"Trạng thái bàn\",\n    orderManagement: \"Quản lý đơn hàng\",\n    tableSettings: \"Cài đặt bàn\",\n    tableSettingsDesc: \"Thêm, chỉnh sửa và xóa bàn\",\n    tableNumber: \"Số bàn\",\n    tableCapacity: \"Sức chứa bàn\",\n    capacity: \"Sức chứa\",\n    status: \"Trạng thái\",\n    actions: \"Hành động\",\n    addTable: \"Thêm bàn\",\n    editTable: \"Sửa bàn\",\n    addTableDesc: \"Thêm bàn mới\",\n    editTableDesc: \"Chỉnh sửa thông tin bàn\",\n    deleteTable: \"Xóa bàn\",\n    available: \"Có sẵn\",\n    occupied: \"Đang sử dụng\",\n    reserved: \"Đã đặt\",\n    cleaning: \"Đang dọn\",\n    outOfService: \"Ngưng phục vụ\",\n    tableNumberPlaceholder: \"Nhập số bàn\",\n    capacityPlaceholder: \"Nhập sức chứa\",\n    qrCodePlaceholder: \"Nhập mã QR\",\n    selectStatus: \"Chọn trạng thái\",\n    tableCreateSuccess: \"Tạo bàn thành công\",\n    tableUpdateSuccess: \"Cập nhật bàn thành công\",\n    tableDeleteSuccess: \"Xóa bàn thành công\",\n    deleteConfirm: \"Bạn có chắc chắn muốn xóa bàn này?\",\n    noTables: \"Chưa có bàn nào được đăng ký\",\n    totalTables: \"Tổng số bàn\",\n    availableTables: \"Bàn có sẵn\",\n    occupiedTables: \"Bàn đang sử dụng\",\n    cleanupComplete: \"Dọn dẹp hoàn tất\",\n    selectMenuToOrder: \"Chọn món để đặt hàng\",\n    customerName: \"Tên khách hàng\",\n    optional: \"Tùy chọn\",\n    customerNamePlaceholder: \"Nhập tên khách hàng\",\n    customerCount: \"Số khách\",\n    allCategories: \"Tất cả danh mục\",\n    stockCount: \"Tồn kho\",\n    orderHistory: \"Lịch sử đặt hàng\",\n    itemsSelected: \" món đã chọn\",\n    noItemsSelected: \"Chưa chọn món nào\",\n    specialRequests: \"Yêu cầu đặc biệt\",\n    subtotalLabel: \"Tạm tính\",\n    taxLabel: \"Thuế\",\n    totalLabel: \"Tổng cộng\",\n    placing: \"Đang đặt...\",\n    placeOrder: \"Đặt hàng\",\n    tableList: \"Danh sách bàn\",\n    tableNumberLabel: \"Số bàn\",\n    capacityLabel: \"Sức chứa\",\n    statusLabel: \"Trạng thái\",\n    qrCodeLabel: \"Mã QR\",\n    createdDate: \"Ngày tạo\",\n    none: \"Không có\",\n    // Payment related\n    subtotal: \"Tạm tính\",\n    tax: \"Thuế\",\n    total: \"Tổng cộng\",\n    paymentMethod: \"Phương thức thanh toán\",\n    cash: \"Tiền mặt\",\n    card: \"Thẻ\",\n    amountReceived: \"Số tiền nhận\",\n    change: \"Tiền thừa\",\n    completeSale: \"Hoàn thành bán hàng\",\n    confirmDelete: \"Bạn có chắc chắn muốn xóa bàn này?\",\n    tableNumberRequired: \"Số bàn là bắt buộc\",\n    capacityMinimum: \"Sức chứa phải ít nhất 1 người\",\n    tableUpdateError: \"Lỗi khi cập nhật bàn\",\n    tableDeleteError: \"Lỗi khi xóa bàn\",\n    statusPlaceholder: \"Chọn trạng thái\",\n    // Product Management\n    productManagement: \"Quản lý sản phẩm\",\n    addNewProduct: \"Thêm sản phẩm mới\",\n    bulkImport: \"Nhập hàng loạt\",\n    export: \"Xuất dữ liệu\",\n    product: \"Sản phẩm\",\n    sku: \"SKU\",\n    category: \"Danh mục\",\n    price: \"Giá\",\n    stock: \"Tồn kho\",\n    editProduct: \"Sửa sản phẩm\",\n    deleteProduct: \"Xóa sản phẩm\",\n    productName: \"Tên sản phẩm\",\n    productPrice: \"Giá sản phẩm\",\n    productStock: \"Tồn kho sản phẩm\",\n    productCategory: \"Danh mục sản phẩm\",\n    imageUrl: \"URL hình ảnh\",\n    createProduct: \"Tạo sản phẩm\",\n    updateProduct: \"Cập nhật sản phẩm\",\n    cancel: \"Hủy\",\n    loading: \"Đang tải...\",\n    productNamePlaceholder: \"Nhập tên sản phẩm\",\n    skuPlaceholder: \"Nhập SKU\",\n    pricePlaceholder: \"Nhập giá\",\n    stockPlaceholder: \"Nhập số lượng tồn kho\",\n    selectCategory: \"Chọn danh mục\",\n    categoryRequired: \"Danh mục là bắt buộc\",\n    productType: \"Loại sản phẩm\",\n    selectProductType: \"Chọn loại sản phẩm\",\n    productTypeRequired: \"Loại sản phẩm là bắt buộc\",\n    goodsType: \"Hàng hóa\",\n    materialType: \"Nguyên vật liệu\",\n    finishedProductType: \"Thành phẩm\",\n    imageUrlOptional: \"URL hình ảnh (tùy chọn)\",\n    confirmDeleteProduct: \"Bạn có chắc chắn muốn xóa sản phẩm này?\",\n    productNameRequired: \"Tên sản phẩm là bắt buộc\",\n    skuRequired: \"SKU là bắt buộc\",\n    unitPrice: \"Đơn giá\",\n    taxRate: \"Thuế suất\",\n  },\n};\n","size_bytes":12197}},"version":1}